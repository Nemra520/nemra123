(window.webpackJsonp=window.webpackJsonp||[]).push([["bundle_feature_smart_selection"],{"../node_modules/core-js/modules/es.string.sub.js":function(e,t,n){"use strict";var r=n("../node_modules/core-js/internals/export.js"),l=n("../node_modules/core-js/internals/create-html.js");r({target:"String",proto:!0,forced:n("../node_modules/core-js/internals/string-html-forced.js")("sub")},{sub:function(){return l(this,"sub","","")}})},"./src/core/feature/cellImage/index.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s}));n("../node_modules/core-js/modules/es.array.filter.js"),n("../node_modules/core-js/modules/es.array.from.js"),n("../node_modules/core-js/modules/es.array.includes.js"),n("../node_modules/core-js/modules/es.string.includes.js"),n("../node_modules/core-js/modules/es.string.iterator.js");var r=n("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),l=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=n("./src/base/index.ts"),i=n("./src/core/view/level-1/drag-operate/index.tsx"),a=(n("../node_modules/core-js/modules/es.array.for-each.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),function(){function e(t){Object(r.a)(this,e),this.app=t}return Object(l.a)(e,[{key:"onParse",value:function(e,t,n,r,l){var o=this,i=this.app.view.canvas,a=1===r;if(e)return Array.from(e).forEach((function(e){a&&(null===l||void 0===l||l.start()),i.shapeUpload.handleImage(e,"parse").then((function(e){var r=e.url,i=e.id,u=e.width,s=e.height,c={url:r,sheetId:o.app.spreadsheet.activeSheetId,id:i,width:u,height:s,x:n,y:t};return a&&(null===l||void 0===l||l.end()),o.app.requestApi.addImage(c,a)}))}))}}]),e}()),u=n("./src/core/ui/loading/index.ts"),s=function(){function e(t){Object(r.a)(this,e),this.app=t,this.parseImg=new a(t),this.initEvent()}return Object(l.a)(e,[{key:"initEvent",value:function(){o.a.event.dragCenterEvent.listen(i.a.EVENT.DROP,this.handleDrop.bind(this))}},{key:"handleDrop",value:function(e){var t,n=this.app.view.canvas.normalSelectData.activeCol,r=this.app.view.canvas.normalSelectData.activeRow,l=null===(t=e.dataTransfer)||void 0===t?void 0:t.files;l&&(l=Array.from(l).filter((function(e){return e.type.includes("image/")})));try{var o;if(n<0||r<0)throw new Error("\u9009\u533a\u72b6\u6001\u5f02\u5e38\uff0c\u65e0\u6cd5\u52a0\u5165\u56fe\u7247");if(!(null===(o=l)||void 0===o?void 0:o.length))throw new Error("\u6ca1\u6709\u62d6\u52a8\u56fe\u7247")}catch(c){return void console.error("cellimage handleDrop",c)}var i=this.app.spreadsheet.getActiveSheetId(),a=u.b.createInstance(window.SpreadsheetApp,r,n,i),s=l.length;this.parseImg.onParse(l,r,n,s,{start:function(){null===a||void 0===a||a.show()},end:function(){null===a||void 0===a||a.hide(),u.b.removeInstance(r,n,i)}})}}]),e}()},"./src/core/feature/smartSelection/smartSelection.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"SMART_SELECTION_TYPE",(function(){return de})),n.d(t,"smartSelection",(function(){return ve}));n("../node_modules/core-js/modules/es.array.for-each.js"),n("../node_modules/core-js/modules/es.array.index-of.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js");var r=n("./src/base/index.ts"),l=(n("../node_modules/core-js/modules/es.symbol.js"),n("../node_modules/core-js/modules/es.array.filter.js"),n("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),n("../node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),n("../node_modules/core-js/modules/es.object.keys.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js"),n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js")),o=n("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),i=n("../node_modules/@babel/runtime/helpers/esm/createClass.js");function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var u=function(){function e(t,n){Object(o.a)(this,e),this._length=t.length||0,this._index=0,this._list=t||[],this._sheet=n}return Object(i.a)(e,[{key:"reset",value:function(){this._index=0}},{key:"getList",value:function(){return this._list}},{key:"getNode",value:function(){return this._list[this._index]||null?function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},this._list[this._index]):null}},{key:"next",value:function(){return this._index+=1,this._index>this._length-1&&(this._index=0),this._index}},{key:"getStyle",value:function(){var e=this.getNode(),t=e.x,n=e.y,r=this._sheet.getCellDataAtPosition(n,t);if(r){var l=r.clone();return r.getConditionalFormatResult()&&l.setUserEnteredFormat(r.getConditionalFormatResult()),l}return null}},{key:"getData",value:function(){var e,t=this.getNode(),n=t.x,r=t.y,l=this._sheet.getCellDataAtPosition(r,n);return l?l.getFormula()?e=l.getFormula().toString(r,n,this._sheet.spreadsheetReference.sheetManager):(e=l.getEffectiveValue())?e.value:null:null}},{key:"getHyperLink",value:function(){var e=this.getNode(),t=e.x,n=e.y,r=this._sheet.getCellDataAtPosition(n,t);return r?r.getHyperlink():null}},{key:"getHyperLinkRuns",value:function(){var e=this.getNode(),t=e.x,n=e.y,r=this._sheet.getCellDataAtPosition(n,t);return r?r.getHyperlinkRuns():null}}]),e}(),s=u,c=(n("../node_modules/core-js/modules/es.reflect.construct.js"),n("../node_modules/@babel/runtime/helpers/esm/get.js")),f=n("../node_modules/@babel/runtime/helpers/esm/inherits.js"),d=n("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),m=n("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js");function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var l=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,l)}else n=r.apply(this,arguments);return Object(d.a)(this,n)}}var g=function(e){Object(f.a)(n,e);var t=h(n);function n(e,r,l){var i;return Object(o.a)(this,n),(i=t.call(this,e,l))._old=new s(r,l),i}return Object(i.a)(n,[{key:"next",value:function(){return Object(c.a)(Object(m.a)(n.prototype),"next",this).call(this),this._old.next(),this._index}},{key:"getStyle",value:function(){return this._old.getStyle()}},{key:"getData",value:function(){return this._old.getData()}},{key:"getHyperLink",value:function(){return this._old.getHyperLink()}},{key:"getHyperLinkRuns",value:function(){return this._old.getHyperLinkRuns()}},{key:"reset",value:function(){this._old.reset(),this._index=0}},{key:"traverse",value:function(){var e,t=[];for(e=0;e<this._length;e++){var n=this.getNode(),r=(n.x,n.y,this._old.getNode());n.oldX=r.x,n.oldY=r.y;var l=this.getNodeStyle(n);n.oldStyle=null===l||void 0===l?void 0:l.clone(),n.style=this.getStyle(),n.oldData=this.getNodeData(n),n.data=this.getData(),n.oldHyperLink=this.getNodeHyperLink(n),n.hyperLink=this.getHyperLink(),n.oldHyperLinkRuns=this.getNodeHyperLinkRuns(n),n.hyperLinkRuns=this.getHyperLinkRuns(),this.next(),t.push(n)}return this.reset(),t}},{key:"getNodeStyle",value:function(e){var t=e.x,n=e.y,r=this._sheet.getCellDataAtPosition(n,t);return r||null}},{key:"getNodeData",value:function(e){var t,n=e.x,r=e.y,l=this._sheet.getCellDataAtPosition(r,n);return l?l.getFormula()?t=l.getFormula().toString(r,n,this._sheet.spreadsheetReference.sheetManager):(t=l.getEffectiveValue())?t.value:null:null}},{key:"getNodeHyperLink",value:function(e){var t=e.x,n=e.y,r=this._sheet.getCellDataAtPosition(n,t);return r?r.getHyperlink():null}},{key:"getNodeHyperLinkRuns",value:function(e){var t=e.x,n=e.y,r=this._sheet.getCellDataAtPosition(n,t);return r?r.getHyperlinkRuns():null}}]),n}(s),v=(n("../node_modules/core-js/modules/es.array.slice.js"),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.match.js"),n("../node_modules/core-js/modules/es.string.repeat.js"),n("../node_modules/core-js/modules/es.array.every.js"),n("../node_modules/core-js/modules/es.array.map.js"),n("../node_modules/core-js/modules/es.string.sub.js"),n("../node_modules/core-js/modules/es.number.to-fixed.js"),n("../node_modules/decimal.js/decimal.js")),p=n("./src/core/utils/index.ts"),y=n("../packages/model/src/index.ts");function b(e,t){var n=e;return _((function(e,t){var r=new v.Decimal(0).sub(1).toNumber(),l=parseInt(new v.Decimal(e).times(1).plus(r).valueOf(),10)%n.length;return l<0&&(l+=n.length),n[l],y.Cell.Formula.FormulaModel,n[l]}),e.length)}function _(e,t){return function(n,r,l,o,i,a){var u;return"right"===r?(u=n.col+t+1,e(u,"right")):"left"===r?(u=n.col-(a.col-1),e(u,"left")):"bottom"===r?(u=n.row+t+1,e(u,"bottom")):"top"===r?(u=n.row-(a.row-1),e(u,"top")):void 0}}function w(e,t){var n,r,l,o,i=[];return e.forEach((function(e,a){for(i[a]=[],-1,n=-1,l=t(e,a),r=0;r<e.length;r++){for(n=r+1,o=r;o<n;o++)i[a][o]=l;r=n-1}})),i}function x(e,t){var n=e.sub(t).toFixed(8);return new v.Decimal(n).equals(0)}function C(e,t){var n=null;return(n=t||function(e){if(1===e.length)return null;for(var t=new v.Decimal(1),n=null,r=null,l=new v.Decimal(NaN),o={isSeqAri:!1,gap:1,firstNum:NaN},i=0;i<e.length;i++){if(n=r,null===(r=e[i])||""===r||!j(r))return null;if(0!==i){var a=new v.Decimal(n||0),u=new v.Decimal(r);if(1===i&&(t=u.sub(a)),!x(t,u.sub(a)))return null}else l=new v.Decimal(r)}return o.isSeqAri=!0,o.gap=t.toNumber(),o.firstNum=l.toNumber(),o}(e))?_((function(e){var t=new v.Decimal(n.firstNum).sub(n.gap).toNumber(),r=n.gap;return new v.Decimal(e).times(r).plus(t).absoluteValue().valueOf()}),e.length):null}function j(e){return"number"===typeof e}var N=[["\u661f\u671f\u4e00","\u661f\u671f\u4e8c","\u661f\u671f\u4e09","\u661f\u671f\u56db","\u661f\u671f\u4e94","\u661f\u671f\u516d","\u661f\u671f\u65e5"],["\u661f\u671f1","\u661f\u671f2","\u661f\u671f3","\u661f\u671f4","\u661f\u671f5","\u661f\u671f6","\u661f\u671f7"],["\u5468\u4e00","\u5468\u4e8c","\u5468\u4e09","\u5468\u56db","\u5468\u4e94","\u5468\u516d","\u5468\u65e5"],["\u54681","\u54682","\u54683","\u54684","\u54685","\u54686","\u54687"],["\u7b2c\u4e00\u5b63","\u7b2c\u4e8c\u5b63","\u7b2c\u4e09\u5b63","\u7b2c\u56db\u5b63"],["\u7b2c1\u5b63","\u7b2c2\u5b63","\u7b2c3\u5b63","\u7b2c4\u5b63"],["\u5b63\u5ea61","\u5b63\u5ea62","\u5b63\u5ea63","\u5b63\u5ea64"],["\u5b63\u5ea6\u4e00","\u5b63\u5ea6\u4e8c","\u5b63\u5ea6\u4e09","\u5b63\u5ea6\u56db"],["\u4e00\u5b63\u5ea6","\u4e8c\u5b63\u5ea6","\u4e09\u5b63\u5ea6","\u56db\u5b63\u5ea6"],["q1","q2","q3","q4"],["Q1","Q2","Q3","Q4"]];function O(e){var t=-1,n=-1,r=[],l=e;if(N.forEach((function(r,l){null!==e[0]&&-1!==r.indexOf(e[0])&&(t=l,n=r.indexOf(e[0]))})),t<0)return null;if(1===l.length)return{sequence:N[t],verb:1,sequenceStartIndex:n};r=N[t];var o=function(e,t){if(!(e instanceof Array)||0===e.length)return!1;if(1===e.length&&-1!==e[0])return{verb:0};var n,r,l=e[1]-e[0];for(n=1;n<e.length;n++){if(r=e[n]-e[n-1],-1===e[n])return!1;if(r!==l&&r-t!==l&&r+t!==l)return!1}return{verb:l}}(e.map((function(e){return r.indexOf(e)})),r.length);return o?{verb:o.verb,sequence:N[t],sequenceStartIndex:n}:null}var k=function(e){return(e="".concat(e)).match(/^\d\.\d+$/i)};function D(e){var t=[];return e.forEach((function(e,n){e.forEach((function(e,r){void 0===t[r]&&(t[r]=[]),t[r][n]=e}))})),t}function R(e,t,n){return t>>=0,n=String("undefined"!==typeof n?n:" "),e.length>t||""===n?String(e):((t-=e.length)>n.length&&(n+=n.repeat(t/n.length)),n.slice(0,t)+String(e))}var I=n("../node_modules/@tencent/docs-user-agent/dist/index.js"),S=n.n(I),L=n("../packages/report/src/index.ts"),A=L.b.tdwReport;var F={fill_drag:function(){A&&A({module:"doc_excel_editor",opername:"excel_fill",action:"fill_drag"})},fill_series:function(){A&&A({module:"doc_excel_editor",opername:"excel_fill",action:"fill_series"})},fill_copy:function(){A&&A({module:"doc_excel_editor",opername:"excel_fill",action:"fill_copy"})},fill_option:function(){A&&A({module:"doc_excel_editor",opername:"excel_fill",action:"fill_option"})},fill_option_copy:function(){A&&A({module:"doc_excel_editor",opername:"excel_fill",action:"fill_option_copy"})},fill_option_series:function(){A&&A({module:"doc_excel_editor",opername:"excel_fill",action:"fill_option_series"})},fill_format:function(){A&&A({module:"doc_excel_editor",opername:"excel_fill",action:"fill_format"})},fill_without_format:function(){A&&A({module:"doc_excel_editor",opername:"excel_fill",action:"fill_without_format"})},mobile_fill_series:function(){A&&A({module:"doc_excel_editor",opername:"excel_fill_mobile",action:"mobile_fill_series"})},mobile_fill_copy:function(){A&&A({module:"doc_excel_editor",opername:"excel_fill_mobile",action:"mobile_fill_copy"})},clk_fill_success:function(){A&&A({module:"doc_excel_editor",opername:"excel_fill_mobile",action:"clk_fill_success"})}};n("../node_modules/core-js/modules/es.array.concat.js");function E(e,t){return e.y<t.y?-1:e.y>t.y?1:e.x<t.x?-1:e.x===t.x?0:1}var P=n("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),B=n("../node_modules/@babel/runtime/helpers/esm/typeof.js");n("../node_modules/core-js/modules/es.number.constructor.js"),n("../node_modules/core-js/modules/es.number.is-nan.js");function M(e){var t,n=null;return 1===e.length&&(t=e[0],n={isSeqAri:!0,gap:1,firstNum:new v.Decimal(t).toNumber()}),C(e,n)}function T(e){var t,n=null;if(1===e.length)t=e[0],n={isSeqAri:!0,gap:.0416666667,firstNum:new v.Decimal(t).toNumber()};else{if(null==(n=function(e){if(1===e.length)return null;for(var t=new v.Decimal(1),n=null,r=null,l=new v.Decimal(NaN),o={isSeqAri:!1,gap:1,firstNum:NaN},i=0;i<e.length;i++){if(n=r,null===(r=e[i])||""===r||!j(r))return null;if(0!==i){var a=new v.Decimal(n||0),u=new v.Decimal(r);1===i&&(t=u.sub(a));var s=u.sub(a);if(!V(t,s))return null}else l=new v.Decimal(r)}return o.isSeqAri=!0,o.gap=t.toNumber(),o.firstNum=l.toNumber(),o}(e)))return null;n.gap<0&&(n.gap+=1)}return n?_((function(e){var t=new v.Decimal(n.firstNum).sub(n.gap).toNumber(),r=n.gap,l=new v.Decimal(e).times(r).plus(t);return(l=function(e){for(;e.toNumber()<0;)e=e.plus(1);for(;e.toNumber()>1;)e=e.sub(1);return e}(l)).valueOf()}),e.length):null}function V(e,t){var n=e.sub(t).toFixed(6);return new v.Decimal(n).equals(0)}n("../node_modules/core-js/modules/es.regexp.constructor.js");function q(e,t){return 1===e.length?function(e){var t=e.contentParse.char,n=e.contentParse.number,r=e.contentParse.numberLength,l=e.contentParse.isCharAtLeft;switch(e.contentParse.type){case"FLOAT":return{isSeqAri:!0,gap:.1,char:t,firstNum:n,numberLength:r,isCharAtLeft:l,type:"FLOAT"};case"INT":return{isSeqAri:!0,gap:1,char:t,firstNum:n,numberLength:r,isCharAtLeft:l,type:"INT"}}return null}(t):function(e){var t={isSeqAri:!1,gap:1,char:"",firstNum:NaN,isCharAtLeft:!0,numberLength:0,type:"INT"},n=function(e){for(var t,n,r=new v.Decimal(1),l="",o=new v.Decimal(NaN),i=null,a=null,u=0;u<e.length;u++){var s;if(i=a,null===(a=U(e[u]).contentParse))return null;if(0!==u){var c=new v.Decimal((null===(s=i)||void 0===s?void 0:s.number)||0),f=new v.Decimal(a.number);if(1===u&&(r=f.sub(c)),a.char!==l)return null;if(!x(f.sub(c).absoluteValue(),r.absoluteValue()))return null}else{var d;o=new v.Decimal(a.number),n=a,t=null===(d=a)||void 0===d?void 0:d.isCharAtLeft,l=a.char||""}}return{isCharAtLeft:t,gap:r,firstNum:o,char:l,firstNumParseResult:n}}(e),r=n.isCharAtLeft,l=n.gap,o=n.firstNum,i=n.char,a=n.firstNumParseResult;if(l.isNaN()||o.isNaN())return null;return t.isCharAtLeft=r,t.isSeqAri=!0,t.gap=l.toNumber(),t.char=i,t.firstNum=o.toNumber(),t.numberLength=(null===a||void 0===a?void 0:a.numberLength)||0,t.type=(null===a||void 0===a?void 0:a.type)||"INT",t}(e)}function H(e){if(null===e||0===e.length)return null;var t=U(e[0]);if(!t.isHybrid)return null;var n=q(e,t);return n?_((function(e){if(null!==n){var t=new v.Decimal(n.firstNum).sub(n.gap).toNumber(),r=n.gap;return function(e,t,n,r,l){var o="";try{o="INT"===l?R(e,r,"0"):e}catch(i){o=e}if(n)return t+o;return o+t}(new v.Decimal(e).times(r).plus(t).absoluteValue().valueOf(),n.char,n.isCharAtLeft,n.numberLength,n.type)}}),e.length):null}function U(e){var t=new RegExp("^(".concat("(\\d+|\\d+\\.\\d+)").concat("[^0-9]+",")$|^(").concat("[^0-9]+").concat("(\\d+|\\d+\\.\\d+)",")$")),n="".concat(e).match(t),r=null!==n,l=null;function o(t){var n=0!==t.index,r=t[0].length;return{isCharAtLeft:n,numberLength:r,char:n?e.slice(0,e.length-r):e.slice(r),number:t[0].match(".")?parseFloat(t[0]):parseInt(t[0],10)}}if(r){var i=null===n||void 0===n?void 0:n[0].match(/\d+/i);if(i){var a=o(i),u=a.char,s=a.number,c=a.numberLength;l={type:"INT",char:u,isCharAtLeft:a.isCharAtLeft,number:s,numberLength:c}}var f=null===n||void 0===n?void 0:n[0].match(/\d+\.\d+/i);if(f){var d=o(f),m=d.char,h=d.number,g=d.numberLength;l={type:"FLOAT",char:m,isCharAtLeft:d.isCharAtLeft,number:h,numberLength:g}}}return{isHybrid:r,contentParse:l}}function Y(e,t){var n=null;return 1===e.length?(n=function(e){if(k(e))return{isSeqAri:!0,gap:.1,firstNum:e};return{isSeqAri:!0,gap:1,firstNum:e}}(e[0]),_((function(e){var r=new v.Decimal(n.firstNum).sub(n.gap).toNumber(),l=n.gap;return G(new v.Decimal(e).times(l).plus(r).absoluteValue().valueOf(),t[0][0])}),e.length)):function(e,t){if(!function(e){return e.every(j)}(e))return null;var n=function(e){for(var t=new v.Decimal(NaN),n=new v.Decimal(NaN),r=new v.Decimal(0),l=new v.Decimal(0),o=1;o<e.length+1;o++)r=r.plus(o),l=l.plus(e[o-1]);for(var i=r.dividedBy(e.length),a=l.dividedBy(e.length),u=new v.Decimal(0),s=new v.Decimal(0),c=1;c<e.length+1;c++){var f=new v.Decimal(c),d=new v.Decimal(e[c-1]);u=u.plus(f.sub(i).times(d.sub(a))),s=s.plus(f.sub(i).times(f.sub(i)))}return t=u.dividedBy(s),n=a.sub(t.times(i)),{b1:t.toNumber(),b0:n.toNumber()}}(e);return _((function(e){var r=n.b0,l=n.b1;return G(new v.Decimal(e).times(l).plus(r).valueOf(),t[0][0])}),e.length)}(e,t)}function G(e,t){return t instanceof y.Cell.Formula.FormulaModel?e:(t="".concat(t))&&t.match(/^0+/)?R(e,t.length,"0"):e}var Q=n("../node_modules/@tencent/txdoc_dayjs/dayjs.min.js"),$=n.n(Q),J=n("../packages/model/src/cell/ExtendedValueType.ts"),W=n("../packages/model/src/factory/index.ts");function X(e,t){var n="date"===t?"YYYY-MM-DD":"YYYY-MM-DD hh:mm:ss";if(1===e.length)return null;var r=function(e,t,n){for(var r,l=-1,o=-1,i=0;i<e.length;i++){var a=e[i];if(null===a||""===a||!j(a))return null;if(0!=i){var u=K(r,a,t,n);if(null==u)return null;if(r=a,1!==i){if(o!=u)return null}else o=u}else l=a,r=a}return{gap:o,firstDate:l}}(e,n,t);return r?_((function(e){if(null!==r){var l=z(r.firstDate,n),o=(e-1)*r.gap;return function(e,t,n){var r=$()(e).format(t);"date"==n&&(r+="T00:00:00");return y.Utils.numberFormatUtils.formatParseEngine.datetime2Numeric(r)}(l.add(o,"month"),n,t)}}),e.length):null}function z(e,t){var n=W.ExtendedValueFactory.createInstance({type:J.a.STRING,value:e}),r=y.Utils.numberFormatUtils.formatRenderEngine.render(n,t);return $()(r.data.value)}function K(e,t,n,r){if(e=z(e,n),t=z(t,n),e.date()!=t.date())return null;if("date-time"===r){if(e.hour()!=t.hour())return null;if(e.minute()!=t.minute())return null;if(e.second()!=t.second())return null}return t.diff(e,"month")}var Z=n("../node_modules/@tencent/tdocs-format-render/lib/index.js");function ee(e){return/^([+|-])?[0-9]+\.?[0-9]*$/.test(e)}function te(e){return(e+="").length>15}function ne(e){var t=e.data,n=e.style,r=e.direction,l=e.ctrl,o=e.fillConfig,i=function(e){return e.map((function(e){return e.map((function(e){return null===e||void 0===e?null:e instanceof y.Cell.Formula.FormulaModel||!ee(e)||Number.isNaN(parseFloat(e))||te(e)?e:parseFloat(e)}))}))}(t);switch(r){case"left":case"right":return re(i,l,n,o,t);case"top":case"bottom":return D(re(D(i),l,D(n),o,t))}return[]}function re(e,t,n,r,l){return t?function(e,t,n,r){return w(e,(function(e,t){return b(e,r[t])}))}(e,0,0,l):w(e,(function(e,t){var o,i=[];try{var a=n[t][0];if((null===a||void 0===a?void 0:a.numberFormat)&&Object(Z.isDateCell)(e[0],a.numberFormat)){var u=Object(Z.getFormatType)(a.numberFormat.pattern);switch(u.group){case"date":case"date-time":if(i=X(e,u.group))return i;if(i=M(e))return i;break;case"time":if(i=T(e))return i;break;default:return b(e,l[t])}return b(e,l[t])}if(function(e){var t,n,r=-1;return N.forEach((function(t,n){null!==e[0]&&-1!==t.indexOf(e[0])&&(r=n,t.indexOf(e[0]))})),-1!=r&&(t=e,n=N[r],!!t.every((function(e,r){return-1!==n.indexOf(t[r])})))}(e)&&(i=function(e){var t=O(e);return t?_((function(e){if(!t)return null;var n=t.sequenceStartIndex,r=t.verb,l=t.sequence,o=new v.Decimal(n).sub(r).toNumber(),i=r,a=parseInt(new v.Decimal(e).times(i).plus(o).valueOf(),10)%l.length;return a<0&&(a+=l.length),l[a]}),e.length):null}(e)))return i;if(ee(e[0])&&((1===e.length&&(o=l[0][0],!(o="".concat(o)).match(/^0+/)||k(o))||te(e[0].length))&&(r.fillByOrder=!1,r.fillByCopy=!0),i=Y(e,l)))return i;if(i=H(e))return i}catch(s){console.warn(s)}return b(e,l[t])}))}var le=n("../packages/model/src/cell/cellFormatUtils.ts");function oe(e,t){var n=t.sheet,r=t.oldCells,l=t.fillConfig,o=t.range,i=t.direction,a=t.ctrl,u=t.newLinks,s=function(e,t){if(0===e.length)return[];function n(e,n){var r,l=t.getCellDataAtPosition(e,n),o=null;if(l){l.getMergeReference();return l.getFormula()?o=l.getFormula():null!==(r=l.getEffectiveValue())&&(o="number"===typeof r.value?"".concat(r.value):"boolean"===typeof r.value||"object"===Object(B.a)(r.value)?"":r.value),null!==o?o:""}return""}var r=e[0],l=r[0],o=r[1],i=r[0],a=r[1];e.forEach((function(e){var t=e[0],n=e[1];t<l&&(l=t),t>i&&(i=t),n<o&&(o=n),n>a&&(a=n)}));var u,s,c,f,d,m,h=i-l+1,g=a-o+1,v=[];for(s=0,f=o;s<g;s++,f++)if(u=[],!t.data.isRowHiddenByFilter(f)){for(c=0,d=l;c<h;c++,d++)m=n(f,d),u.push(m);v.push(u)}return v}(r,n),c=function(e,t){if(0===e.length)return[];function n(e,n){var r=t.getCellDataAtPosition(n,e),l=null;if(r){var o=[],i=[r.getConditionalFormatResult(),r.getEffectiveFormat(),r.getUserEnteredFormat()].filter((function(e){return null!==e}));o.push.apply(o,Object(P.a)(i)),o.length>0&&(l=Object(le.mergeCellFormats)(o))}return l}var r=e[0],l=r[0],o=r[1],i=r[0],a=r[1];e.forEach((function(e){var t=e[0],n=e[1];t<l&&(l=t),t>i&&(i=t),n<o&&(o=n),n>a&&(a=n)}));var u,s,c,f,d,m,h=i-l+1,g=a-o+1,v=[];for(s=0,f=o;s<g;s++,f++)if(!t.data.isRowHiddenByFilter(f)){for(u=[],c=0,d=l;c<h;c++,d++)m=n(d,f),u.push(m);v.push(u)}return v}(r,n);s[0].length;l.fillByOrder=!0,l.fillByCopy=!1;var f=ie({range:o,data:s,style:c,direction:i,ctrl:!1,fillConfig:l,newLinks:u,sheet:n}),d=ie({range:o,data:s,style:c,direction:i,ctrl:!0,fillConfig:l,newLinks:u,sheet:n});return a&&(l.fillByOrder=!1,l.fillByCopy=!0),{fillByOrderValue:ae(e,o,f),fillByCopyValue:ae(e,o,d)}}function ie(e){var t=e.range,n=e.data,r=e.style,l=e.direction,o=e.ctrl,i=e.fillConfig;e.newLinks,e.sheet;return function(e,t,n,r,l){var o,i,a,u,s=[],c={};if(0===(i=t.length))return!1;c.row=e.startRowIndex,c.col=e.startColIndex;var f={row:e.endRowIndex-e.startRowIndex+1,col:e.endColIndex-e.startColIndex+1},d=t.length,m=e.endRowIndex-e.startRowIndex+1;for(i=m,o=0;o<i&&!(c.row>e.endRowIndex&&m>d);o++){var h=b(o);null!==h&&void 0!==h||(h="");var g=h.length,v=e.endColIndex-e.startColIndex+1;for(u=v,c.col=e.startColIndex,s[o]=[],a=0;a<u&&!(c.col>e.endColIndex&&v>g);a++){var p=se({row:o,col:a},r,t,n,{},f);"string"===typeof p||p instanceof y.Cell.Formula.FormulaModel?s[o][a]=p:s[o][a]=""}c.row+=1}return s;function b(e){var n,r,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,u=e,s=l;switch(o){case"top":n=i.length,u=(Math.ceil(a.row/n)*n-a.row+e)%n;break;case"bottom":u=e%i.length;break;case"left":r=i[0].length,s=(Math.ceil(a.col/r)*r-a.col+l)%r;break;case"right":s=l%i[0].length}var c=t[u%t.length];return null!==s?c[s%c.length]:c}}(t,n,ne({data:n,style:r,direction:l,ctrl:o,fillConfig:i}),l)}var ae=function(e,t,n){var r,l,o,i,a,u=[],s=t.endRowIndex-t.startRowIndex+1,c=t.endColIndex-t.startColIndex+1,f=e.spreadsheet.activeSheet.getBasicFilter();null===f||void 0===f||f.getHiddenRows();for(r=0,o=t.startRowIndex;r<s&&!(o>t.endRowIndex);r++,o++)for(l=0,i=t.startColIndex;l<c;l++,i++)a=n[r][l],u.push([o,i,a]);return u};function ue(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=[];return e.forEach((function(e){return e.traverse().forEach((function(e){var t,l,o=p.a.formula.util.getRelativeFormulaWithFormula(e.data,e.oldY,e.oldX),i=p.a.formula.util.getFormulaWithRelativeFormula(o,e.y,e.x);n?(t=i||e.data,l=e.hyperLink):(t=e.oldData,l=e.oldHyperLink),r.push([e.y,e.x,t,l])}))})),r}function se(e,t,n,r,l,o){var i,a=e.row,u=e.col;if("number"===typeof a&&"number"===typeof u){switch(t){case"top":var s=n.length;a=(Math.ceil(o.row/s)*s-o.row+e.row)%s;break;case"bottom":a=e.row%n.length;break;case"left":var c=n[0].length;u=(Math.ceil(o.col/c)*c-o.col+e.col)%c;break;case"right":u=e.col%n[0].length}if((i=function(e,t,n){var r=e[t%e.length];return null!==n?r[n%r.length]:r}(n,a,u))instanceof y.Cell.Formula.FormulaModel)return i;var f,d=(f=r[a])?f[u]:null;if("function"===typeof d){var m=d(e,t,n,r,l,o);if("number"===typeof m)return m.toString();if("string"===typeof m)return m}return""}}function ce(e,t,n,r){var l=[];return t.forEach((function(e){e.traverse().forEach((function(e){var t,r=e.x,o=e.y,i=e.style,a=e.oldStyle;"before"===n&&(t=a),"updated"===n&&(t=i),void 0===l[o]&&(l[o]=[]),l[o][r]=t||null}))})),l}function fe(e){var t=e.mergeCells,n=e.newLinks;return{before:function(){var e,r=[];return n.forEach((function(n){n.traverse().forEach((function(n){(e=function(e){var n,r,l,o,i,a;for(n=0;n<t.length;n++)if(l=(r=t[n]).startRowIndex,o=r.endRowIndex,i=r.startColIndex,a=r.endColIndex,i<=e.x&&e.x<=a&&l<=e.y&&e.y<=o)return r;return null}(n))&&(function(e,t){var n,r;for(n=0;n<t.length;n++)if(r=t[n],e.startRowIndex===r.startRowIndex&&e.startColIndex===r.startColIndex)return!0;return!1}(e,r)||r.push(e))}))})),r}(),update:function(){var e,r,l,o=[];return n.forEach((function(n){r=n._old.getList(),n.traverse().forEach((function(n,i){i%=r.length,(e=function(e){var n,r,l,o,i,a;for(n=0;n<t.length;n++)if(l=(r=t[n]).startRowIndex,o=r.endRowIndex,i=r.startColIndex,a=r.endColIndex,i<=e.x&&e.x<=a&&l<=e.y&&e.y<=o)return r;return null}({x:r[i].x,y:r[i].y}))&&(function(e,t){var n,r;for(n=0;n<t.length;n++)if(r=t[n],e.startRowIndex>=r.startRowIndex&&e.startColIndex>=r.startColIndex&&e.startColIndex<=r.endColIndex&&e.startRowIndex<=r.endRowIndex)return!0;return!1}(l=new y.Range.GridRange(e.sheetId,n.y,n.y+(e.endRowIndex-e.startRowIndex),n.x,n.x+(e.endColIndex-e.startColIndex)),o)||o.push(l))}))})),o}()}}var de,me=function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,[{key:"updateSmartSelection",value:function(e,t,n,r){t.oldLinks;var l=t.newLinks,o=n.direction,i=n.oldCells,a=(n.newCells,n.ctrl);this.fillConfig={fillByCopy:!0,fillByOrder:!1,fillStyle:!0,fillValue:!0,originCell:i,onlyCanCopyRows:[]};var u=function(e,t){var n=[],r=e.getSheetId();return t.forEach((function(e){n=n.concat(e.getList())})),(n=n.sort(E)).length>0?new y.Range.GridRange(r,n[0].y,n[n.length-1].y,n[0].x,n[n.length-1].x):null}(r,l);if(null===u)throw"can't smartSelection because of useless range ".concat(u);this.fillConfig.range=u;var s=fe({mergeCells:r.mergeManager.mergeList,newLinks:l}),c=oe(e,{sheet:r,oldCells:i,fillConfig:this.fillConfig,range:u,direction:o,ctrl:a,newLinks:l});this.fillConfig.newValue=c,this.fillConfig.oldValue=function(e,t){return ue(e,t,!1)}(l,r);var f,d=function(e){var t=e.range,n=e.newLinks,r=e.direction;return{before:{style:ce(t,n,"before",r)},update:{style:ce(t,n,"updated",r)}}}({range:u,newLinks:l,direction:o});this.fillConfig.stateBefore=d.before,this.fillConfig.stateUpdate=d.update,this.fillConfig.mergeCellsBefore=s.before,this.fillConfig.mergeCellsUpdate=s.update,S.a.isMobilePhone||S.a.isAndroidPad||e.view.canvas.smartDrag.showButton(u.endRowIndex,u.endColIndex,(f=this,[{name:"\u590d\u5236\u5355\u5143\u683c",validClass:"component-vaild menu-component",invalidClass:"component-invaild menu-component",init:function(e){e.className=this.validClass,e.innerText="\u590d\u5236\u5355\u5143\u683c"},callback:function(){F.fill_option_copy(),he(de.COPY,f)}},{name:"\u586b\u5145\u5e8f\u5217",validClass:"component-vaild menu-component",invalidClass:"component-invaild menu-component",init:function(e){e.className=this.validClass,e.innerText="\u586b\u5145\u5e8f\u5217"},callback:function(){F.fill_option_series(),he(de.ORDER,f)}},{name:"\u4ec5\u586b\u5145\u683c\u5f0f",validClass:"component-vaild menu-component",invalidClass:"component-invaild menu-component",init:function(e){e.className=this.validClass,e.innerText="\u4ec5\u586b\u5145\u683c\u5f0f"},callback:function(){F.fill_format(),he(de.FORMAT,f)}},{name:"\u4e0d\u5e26\u683c\u5f0f\u586b\u5145",validClass:"component-vaild menu-component",invalidClass:"component-invaild menu-component",init:function(e){e.className=this.validClass,e.innerText="\u4e0d\u5e26\u683c\u5f0f\u586b\u5145"},callback:function(){F.fill_without_format(),he(de.NO_FORMAT,f)}}])),this.fillSmartSelection(this.fillConfig)}},{key:"fillSmartSelection",value:function(e){var t,n=this.fillConfig,r=n.newValue.fillByCopyValue;e.fillByOrder?(S.a.isMobilePhone||S.a.isAndroidPad?F.mobile_fill_series():F.fill_series(),r=n.newValue.fillByOrderValue):e.fillByCopy&&(S.a.isMobilePhone||S.a.isAndroidPad?F.mobile_fill_copy():F.fill_copy(),r=n.newValue.fillByCopyValue),e.fillValue||(r=n.oldValue);var l=[];for(t=0;t<r.length;t++)try{var o=r[t][0],i=r[t][1];l.push([o,i,r[t][2],n.stateUpdate.style[o][i].hyperlink,e.fillStyle?n.stateUpdate.style[o][i]:n.stateBefore.style[o][i]])}catch(a){}(S.a.isMobilePhone||S.a.isAndroidPad)&&F.clk_fill_success(),window.SpreadsheetApp.requestApi.smartSelection({originCell:n.originCell,changes:l,range:n.range,mergeCells:n.mergeCellsUpdate||[]})}},{key:"getFillConfig",value:function(){return this.fillConfig}}]),e}();function he(e,t){switch(e){case de.COPY:return t.fillSmartSelection({fillByCopy:!0,fillStyle:!0,fillValue:!0,fillByOrder:!1});case de.ORDER:return t.fillSmartSelection({fillByCopy:!1,fillStyle:!0,fillValue:!0,fillByOrder:!0});case de.FORMAT:return t.fillSmartSelection({fillByCopy:!0,fillStyle:!0,fillValue:!1,fillByOrder:!1});case de.NO_FORMAT:var n=t.getFillConfig(),r=n.originCell&&n.originCell.length>=2;return t.fillSmartSelection({fillByCopy:!r,fillStyle:!1,fillValue:!0,fillByOrder:r})}}!function(e){e.COPY="copy",e.ORDER="order",e.FORMAT="format",e.NO_FORMAT="no-format"}(de||(de={}));var ge=function(e,t,n){var r=function(e,t){var n=e.spreadsheet.sheetManager.getSheetBySheetId(t),r=[];if(null===n)return[];var l=n.getBasicFilter();return l&&(r=l.getHiddenRows()),r}(e,t),l=[];return n.forEach((function(e){-1===r.indexOf(e[1])&&l.push(e)})),l.length?l:n},ve=function(e,t){var n=t.direction,l=t.oldCells,o=t.newCells,i=e.spreadsheet.activeSheetId,a=e.spreadsheet.activeSheet;if(l=ge(e,i,l),o=ge(e,i,o),n&&l&&l.length&&o&&o.length){var s=function(e,t,n){var r,l,o=function(e,t){var n={direction:t};return e.forEach((function(e){var r="top"===t||"bottom"===t?e[0]:e[1],l={x:e[0],y:e[1]};n[r]||(n[r]=[]),n[r].push(l)})),n};if("left"===n||"right"===n)r=o(e,n),l=o(t,n);else{if("top"!==n&&"bottom"!==n)throw"smart selection direction error. direction: ".concat(n);r=o(e,n),l=o(t,n)}return{oldObj:r,newObj:l}}(l,o,n),c=s.oldObj,f=s.newObj,d={oldLinks:function(e,t){for(var n=[],r=e.type,l=0,o=Object.keys(e);l<o.length;l++){var i=e[o[l]];"top"!==r&&"left"!==r||(i=i.reverse()),i instanceof Array&&n.push(new u(i,t))}return n}(c,a),newLinks:function(e,t,n){for(var r=[],l=e.type,o=0,i=Object.keys(e);o<i.length;o++){var a=i[o],u=t[a],s=e[a];"top"!==l&&"left"!==l||(u=u.reverse(),s=s.reverse()),u instanceof Array&&s instanceof Array&&r.push(new g(s,u,n))}return r}(f,c,a)};!S.a.isMobilePhone&&!S.a.isAndroidPad&&L.b.run(r.a.config.report.CONFIG.FILL_DRAG);var m=new me;try{m.updateSmartSelection(e,d,{oldCells:l,newCells:o,direction:n,ctrl:t.ctrl},a)}catch(h){console.error(h),L.b.run(r.a.config.report.CONFIG.UPDATE_SMART_SELECTION_ERROR,t,h)}}else console.warn("\u667a\u80fd\u62d6\u62fd\u53c2\u6570\u5f02\u5e38: ",t)};t.default=ve}}]);
//# sourceMappingURL=pc-bundle_feature_smart_selection-52cd14bd34.js.map