(window.webpackJsonp=window.webpackJsonp||[]).push([["bundle_plugin_mention"],{"./src/external/mention/mentionPlugin.ts":function(e,n,t){"use strict";t.r(n),function(e){t.d(n,"default",(function(){return p}));t("../node_modules/core-js/modules/es.array.concat.js"),t("../node_modules/core-js/modules/es.array.for-each.js"),t("../node_modules/core-js/modules/es.array.index-of.js"),t("../node_modules/core-js/modules/es.array.map.js"),t("../node_modules/core-js/modules/es.object.to-string.js"),t("../node_modules/core-js/modules/es.promise.js"),t("../node_modules/core-js/modules/es.reflect.construct.js"),t("../node_modules/core-js/modules/es.regexp.exec.js"),t("../node_modules/core-js/modules/es.regexp.to-string.js"),t("../node_modules/core-js/modules/es.string.search.js"),t("../node_modules/core-js/modules/web.dom-collections.for-each.js"),t("../node_modules/regenerator-runtime/runtime.js");var r=t("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),o=t("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),s=t("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=t("../node_modules/@babel/runtime/helpers/esm/inherits.js"),a=t("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),c=t("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),u=t("./src/core/ui/toast/index.ts"),l=t("./src/base/event/eventName.ts"),d=t("./src/base/event/event.ts");function m(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=Object(c.a)(e);if(n){var o=Object(c.a)(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return Object(a.a)(this,t)}}var p=function(n){Object(i.a)(a,n);var t=m(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this)).moveToRowColForMention=function(e,t){var r=n.app.spreadsheet.activeSheet.mentionManager.getMention(e);if(r){var o=r.rowIndex,s=r.colIndex;n.app.view.canvas.scrollApi.scrollToRenderFrom({row:o,col:s}),n.app.view.canvas.selectApi.selectCells({xRange:[s,s],yRange:[o,o]})}else Object(u.showToast)("\u5f53\u524d\u5b50\u8868@\u4eba\u7684\u4fe1\u606f\u5df2\u88ab\u5220\u9664")},n.initEvent=function(){d.c.mentionEvent.listen("addMentionAction",n.addMentionAction),d.c.mentionEvent.listen("setMentionMenu",n.setMentionMenu),d.c.mentionEvent.listen("sendMentionAction",n.sendMentionAction),d.c.mentionEvent.listen("cancelMentionAction",n.cancelMentionAction),d.c.mentionEvent.listen("deleteMentionAction",n.deleteMentionAction),d.c.mentionEvent.listen("searchMention",n.searchMention),d.c.mentionEvent.listen("setQuickRemindMenu",n.setQuickRemindMenu),d.c.mentionEvent.listen("keyboardDown",n.keyboardDown),d.c.mentionEvent.listen("hideQuickRemindMenu",n.hideQuickRemindMenu),d.c.mentionEvent.listen("autoCreateMention",n.autoCreateMention),n._register(n.app.spreadsheet.onAddMention(n.sendMentionRemote)),n._register(n.app.spreadsheet.onDeleteMention(n.deleteMentionRemote)),n._register(n.app.spreadsheet.onUpdateMention(n.debounceUpdateDocMention)),n.app.event.sheetsBar.listen("switchSheetStart",n.hideQuickRemindMenu)},n.addMentionAction=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t,r,o,s){var i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getAtMessage();case 2:a=e.sent,null===(i=a.addMentionAction)||void 0===i||i.call(a,{pos:t,rowHeight:r,targetId:o},s);case 4:case"end":return e.stop()}}),e)})));return function(n,t,r,o){return e.apply(this,arguments)}}(),n.setMentionMenu=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t,r,o){var s,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getAtMessage();case 2:i=e.sent,null===(s=i.setMentionMenu)||void 0===s||s.call(i,{visible:t,pos:r,rowHeight:o});case 4:case"end":return e.stop()}}),e)})));return function(n,t,r){return e.apply(this,arguments)}}(),n.sendMentionAction=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t,r){var o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getAtMessage();case 2:s=e.sent,null===(o=s.sendMentionAction)||void 0===o||o.call(s,t,r);case 4:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),n.cancelMentionAction=Object(r.a)(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getAtMessage();case 2:r=e.sent,null===(t=r.cancelMentionAction)||void 0===t||t.call(r),n.hideQuickRemindMenu();case 5:case"end":return e.stop()}}),e)}))),n.deleteMentionAction=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t,r){var o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getAtMessage();case 2:s=e.sent,null===(o=s.deleteMentionAction)||void 0===o||o.call(s,t,r);case 4:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),n.searchMention=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t,r){var o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getAtMessage();case 2:s=e.sent,null===(o=s.search)||void 0===o||o.call(s,t,r);case 4:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),n.autoCreateMention=Object(r.a)(regeneratorRuntime.mark((function e(){var t,r,o,s,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>0&&void 0!==i[0]?i[0]:{counts:0,targetId:""},o=i.length>1?i[1]:void 0,e.next=4,n.getAtMessage();case 4:s=e.sent,null===(t=s.autoCreateMention)||void 0===t||t.call(s,r,o);case 6:case"end":return e.stop()}}),e)}))),n.updateDocMention=Object(r.a)(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getAtMessage();case 2:r=e.sent,null===(t=r.updateDocMention)||void 0===t||t.call(r);case 4:case"end":return e.stop()}}),e)}))),n.setQuickRemindMenu=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t){var r,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getAtMessage();case 2:o=e.sent,t.visible&&(null===(s=o.hideQuickRemindMenu)||void 0===s||s.call(o)),null===(r=o.setQuickRemindMenu)||void 0===r||r.call(o,t),n.isShowQuickRemindMenu=t.visible;case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),n.keyboardDown=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getAtMessage();case 2:o=e.sent,null===(r=o.keyboardDown)||void 0===r||r.call(o,{type:t});case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),n.hideQuickRemindMenu=Object(r.a)(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.isShowQuickRemindMenu){e.next=5;break}return e.next=3,n.getAtMessage();case 3:r=e.sent,null===(t=r.hideQuickRemindMenu)||void 0===t||t.call(r);case 5:n.isShowQuickRemindMenu=!1;case 6:case"end":return e.stop()}}),e)}))),n.sendMentionRemote=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t){var r,o,s,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[].concat(t.actionIds),o=[],r.forEach((function(e){o.push({mentionId:e,targetId:t.sheetId})})),!(o.length>0)){e.next=10;break}return e.next=7,n.getAtMessage();case 7:i=e.sent,null===(s=i.sendMentionAction)||void 0===s||s.call(i,o,(function(e){0!==e.retcode&&Object(u.showToast)("\u8fdc\u7a0b\u589e\u52a0@\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u64a4\u9500\u540e\u91cd\u8bd5")})),console.info("%csend actionId:".concat(t.actionIds),"color:red");case 10:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),n.deleteMentionRemote=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t){var r,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.hideQuickRemindMenu(),0!==(o=[].concat(t.actionIds)).length){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,n.getAtMessage();case 7:s=e.sent,null===(r=s.deleteMentionAction)||void 0===r||r.call(s,o,(function(e){0!==e.retcode&&Object(u.showToast)("\u8fdc\u7a0b\u5220\u9664@\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u64a4\u9500\u540e\u91cd\u8bd5")})),console.info("%cdelete actionId:".concat(t.actionIds),"color:red");case 10:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),n.debounceUpdateDocMention=function(){n.timerhandle&&(clearTimeout(n.timerhandle),n.timerhandle=null),n.timerhandle=setTimeout((function(){n.updateDocMention()}),500)},n.app=e,n.initEvent(),n}return Object(s.a)(a,[{key:"getAtMessage",value:function(){var n=this;return new Promise((function(t,r){n.AtMessage?t(n.AtMessage):e.CoreSheet.loadModule("AtMessage",(function(e){var r=document.createElement("div");document.body.appendChild(r),e.init(r,{updateSource:function(e){return[]},onToastClick:function(e){var t=n.app.spreadsheet.getActiveSheetId(),r=e.targetId,o=e.mentionId;if(null!==r&&r!==t){if(-1===n.app.spreadsheet.sheetManager.sheetList.map((function(e){return e.getSheetId?e.getSheetId():""})).indexOf(r))return void Object(u.showToast)("@\u4eba\u6240\u5728\u7684\u5b50\u8868\u5df2\u88ab\u5220\u9664");d.c.sheetsBar.trigger("switchSheet",r,t,{onSuccess:function(){n.moveToRowColForMention(o,t)},onFail:function(){}})}else n.moveToRowColForMention(o,t)},onShow:function(){n.app.event.default.trigger(l.a.UI_SHOW,"at-message")},onClose:function(){n.app.event.default.trigger(l.a.UI_HIDE,"at-message")}}),n.AtMessage=e,t(n.AtMessage)}))}))}}]),a}(t("../packages/services/src/dispose.ts").a)}.call(this,t("../node_modules/webpack/buildin/global.js"))}}]);
//# sourceMappingURL=pc-bundle_plugin_mention-634f3971c3.js.map