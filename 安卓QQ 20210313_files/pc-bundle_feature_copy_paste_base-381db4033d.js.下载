(window.webpackJsonp=window.webpackJsonp||[]).push([["bundle_feature_copy_paste_base"],{"./src/core/feature/copyPaste/index.ts":function(e,t,a){"use strict";a.r(t);a("../node_modules/regenerator-runtime/runtime.js");var n=a("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),r=(a("../node_modules/core-js/modules/es.object.assign.js"),a("../packages/model/src/range/DimensionRange.ts")),s=a("../packages/model/src/dimension/DimensionType.ts");function c(e){var t=e.currentSelect,a=e.pasteData,n=e.cutDataSheetId,c=e.activeSheetId,i=e.dimensionType,o=e.cacheState,u=e.isSingle,l=function(e){var t=e.currentSelect,a=e.cutDataSheetId,n=e.activeSheetId,c=e.dimensionType,i=e.cacheStateFrom,o=e.isSingle,u=(c==s.a.ROWS?t.yRange:t.xRange)[0],l=[],p=c==s.a.ROWS?i.yRange:i.xRange,m=p[0],d=p[1],h=d-m+1,S=d-m+u;o||(a==n&&u>d&&(u-=h,S-=h),l=[new r.a(a,p[0],p[1],c)]);var g={deleteDimensionRanges:l,insertDimensionRanges:[new r.a(n,u,S,c)]},f=c==s.a.ROWS?i.xRange:i.yRange;return{infoDimension:g,range:{xRange:c==s.a.ROWS?f:[u,S],yRange:c==s.a.ROWS?[u,S]:f}}}({currentSelect:t,cutDataSheetId:n,activeSheetId:c,dimensionType:i,cacheStateFrom:o.from,isSingle:u}),p=l.infoDimension,m=l.range,d=Object.assign({},a);return d.infoDimension=p,{pasteData:d,range:m}}function i(e){var t=e.currentSelect,a=e.pasteData,n=function(e){var t=e.currentSelect,a=e.activeSheetId,n=e.dimensionType,c=e.cacheStateFrom,i=(n==s.a.ROWS?t.yRange:t.xRange)[0],o=n==s.a.ROWS?c.yRange:c.xRange,u=o[0],l=o[1]-u+i,p={insertDimensionRanges:[new r.a(a,i,l,n)]},m=n==s.a.ROWS?c.xRange:c.yRange;return{infoDimension:p,range:{xRange:n==s.a.ROWS?m:[i,l],yRange:n==s.a.ROWS?[i,l]:m}}}({currentSelect:t,activeSheetId:e.activeSheetId,dimensionType:e.dimensionType,cacheStateFrom:e.cacheState.from}),c=n.infoDimension,i=n.range,o=Object.assign({},a);return o.infoDimension=c,{pasteData:o,range:i}}var o=a("../packages/model/src/index.ts"),u=a("./src/core/feature/copyPaste/interfaces.ts"),l=a("./src/core/feature/copyPaste/copyPasteCache.ts"),p=a("./src/core/view/level-1/select-data/utils.ts");function m(e,t){return d.apply(this,arguments)}function d(){return(d=Object(n.a)(regeneratorRuntime.mark((function e(t,a){var n,r,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.copyType,r=a.previewActiveSheetId,e.next=3,t.feature.getCopyPaste();case 3:return s=e.sent,e.abrupt("return",s.doCopy({copyType:n,previewActiveSheetId:r}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return S.apply(this,arguments)}function S(){return(S=Object(n.a)(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.feature.getCopyPaste();case 2:return a=e.sent,e.next=5,a.judgeForInsertCopy();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e,t){return f.apply(this,arguments)}function f(){return(f=Object(n.a)(regeneratorRuntime.mark((function e(t,a){var n,r,s,c,l,m,d,h,S,g,f,y,b,C,v,R,x,D;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.cbSucc,r=a.cbFail,e.next=3,t.feature.getCopyPaste();case 3:if(s=e.sent,c=s.copyPasteCache,1===(l=t.view.canvas).normalSelectData.selectQueue.length){e.next=8;break}return e.abrupt("return");case 8:if(m=t.spreadsheet.activeSheet,d=m.getSheetId(),h=c.getCacheData(),S=c.getCacheState(),g=l.normalSelectData.selectQueue[0],f=S.select,y=o.Dimension.DIMENSION_TYPE,!g.selectRow){e.next=24;break}if(!f.selectCol){e.next=19;break}return r(),e.abrupt("return");case 19:b=i({cacheState:S,currentSelect:{yRange:Object(p.p)(l.rowcolAccessor,l.normalSelectData.selectQueue)[0],xRange:[0,0]},pasteData:h,activeSheetId:d,dimensionType:y.ROWS}),C=b.pasteData,v=b.range,s.doImageTextPaste({type:u.a.table,pasteData:C,selectAreaCellRange:v,pasteHtmlString:c.getCacheState().clipboardCopyData.html}),n(y.ROWS),e.next=31;break;case 24:if(!g.selectCol){e.next=31;break}if(!f.selectRow){e.next=28;break}return r(),e.abrupt("return");case 28:R=i({cacheState:S,currentSelect:{xRange:Object(p.n)(l.rowcolAccessor,l.normalSelectData.selectQueue)[0],yRange:[0,0]},pasteData:h,activeSheetId:d,dimensionType:y.COLUMNS}),x=R.pasteData,D=R.range,s.doImageTextPaste({type:u.a.table,pasteData:x,selectAreaCellRange:D,pasteHtmlString:c.getCacheState().clipboardCopyData.html}),n(y.COLUMNS);case 31:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var y=function(e,t,a,n,r,s,i,o,l,m,d){if(t.selectRow&&a&&n){var h=c({cacheState:r,currentSelect:{yRange:Object(p.p)(s.tableView,s.normalSelectData.selectQueue)[0],xRange:[0,0]},pasteData:e,cutDataSheetId:n,activeSheetId:i,dimensionType:o.ROWS,isSingle:!0}),S=h.pasteData,g=h.range;l.doImageTextPaste({type:u.a.table,pasteData:S,selectAreaCellRange:g,pasteHtmlString:m.getCacheState().clipboardCopyData.html}),d(o.ROWS)}else if(t.selectCol&&a&&n){var f=c({cacheState:r,currentSelect:{xRange:Object(p.n)(s.tableView,s.normalSelectData.selectQueue)[0],yRange:[0,0]},pasteData:e,cutDataSheetId:n,activeSheetId:i,dimensionType:o.COLUMNS,isSingle:!0}),y=f.pasteData,b=f.range;l.doImageTextPaste({type:u.a.table,pasteData:y,selectAreaCellRange:b,pasteHtmlString:m.getCacheState().clipboardCopyData.html}),d(o.COLUMNS)}},b=function(e,t,a,n,r,s,i,o,l,m,d,h){if(e.yRange[0]>t.from.yRange[0]&&e.yRange[0]<=t.from.yRange[1])return!1;if(e.selectCol)return!1;if(e.selectRow&&n&&r){var S=c({cacheState:t,currentSelect:{yRange:Object(p.p)(s.tableView,s.normalSelectData.selectQueue)[0],xRange:[0,0]},pasteData:i,cutDataSheetId:r,activeSheetId:o,dimensionType:d.ROWS,isSingle:!1}),g=S.pasteData,f=S.range;h.doImageTextPaste({type:u.a.table,pasteData:g,selectAreaCellRange:f,pasteHtmlString:m.getCacheState().clipboardCopyData.html}),l(d.ROWS)}return!0},C=function(e,t,a,n,r,s,i,o,l,m,d,h){if(e.xRange[0]>t.from.xRange[0]&&e.xRange[0]<=t.from.xRange[1])return!1;if(e.selectRow)return!1;if(e.selectCol&&n&&r){var S=c({cacheState:t,currentSelect:{xRange:Object(p.n)(s.tableView,s.normalSelectData.selectQueue)[0],yRange:[0,0]},pasteData:i,cutDataSheetId:r,activeSheetId:o,dimensionType:d.COLUMNS,isSingle:!1}),g=S.pasteData,f=S.range;h.doImageTextPaste({type:u.a.table,pasteData:g,selectAreaCellRange:f,pasteHtmlString:m.getCacheState().clipboardCopyData.html}),l(d.COLUMNS)}return!0};function v(e,t){return R.apply(this,arguments)}function R(){return(R=Object(n.a)(regeneratorRuntime.mark((function e(t,a){var n,r,s,c,i,l,p,m,d,h,S,g,f,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.cbSucc,r=a.cbFail,e.next=3,t.feature.getCopyPaste();case 3:if(s=e.sent,c=s.copyPasteCache,1===(i=t.view.canvas).normalSelectData.selectQueue.length){e.next=8;break}return e.abrupt("return");case 8:if(l=t.spreadsheet.activeSheet,p=l.getSheetId(),m=c.getCacheState(),d=m.valid,h=c.getCacheData(),S=d&&m.pasteType==u.b.cut,g=m.sheetId,f=i.normalSelectData.selectQueue[0],v=o.Dimension.DIMENSION_TYPE,!h||1!=h.isSingle||0!=h.isMerge){e.next=21;break}y(h,f,S,g,m,i,p,v,s,c,n),e.next=32;break;case 21:if(!(h&&m.select.selectRow&&f.selectRow)){e.next=26;break}if(b(f,m,0,S,g,i,h,p,n,c,v,s)){e.next=24;break}return e.abrupt("return",r());case 24:e.next=32;break;case 26:if(!(h&&m.select.selectCol&&f.selectCol)){e.next=31;break}if(C(f,m,0,S,g,i,h,p,n,c,v,s)){e.next=29;break}return e.abrupt("return",r());case 29:e.next=32;break;case 31:return e.abrupt("return",r());case 32:case"end":return e.stop()}}),e)})))).apply(this,arguments)}a("../node_modules/core-js/modules/es.number.constructor.js"),a("../node_modules/core-js/modules/es.object.to-string.js"),a("../node_modules/core-js/modules/es.promise.js");var x=a("../packages/report/src/index.ts"),D=a("./src/core/feature/copyPaste/clipboardCopy.ui.ts"),P=a("./src/core/feature/copyPaste/copyPaste2.ui.ts"),T=a("./src/core/feature/copyPaste/wxCopyPaste.ui.ts"),O=a("./src/core/ui/toast/index.ts"),w=a("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),I=a("../node_modules/@babel/runtime/helpers/esm/createClass.js"),k=function(){function e(){Object(w.a)(this,e),this.isAppended=!1,this.refCounter=0}return Object(I.a)(e,[{key:"append",value:function(){if(this.hasBeenDestroyed()&&this.create(),this.refCounter++,!this.isAppended&&document.body){var e=window.SpreadsheetApp;e&&(this.isAppended=!0,e.view.canvas.container.appendChild(this.element))}}},{key:"changeParentNode",value:function(e){this.element&&(this.element.remove(),e.appendChild(this.element))}},{key:"create",value:function(){var e;this.element=document.createElement("textarea"),this.element.id="CopyPasteDiv",(e=this.element.style).position="fixed",e.top="-10000px",e.left="-10000px",this.element.className="copyPaste",this.element.tabIndex=-1,this.element.autocomplete="off",this.element.wrap="hard",this.element.value=" "}},{key:"deselect",value:function(){this.element===document.activeElement&&document.activeElement.blur()}},{key:"destroy",value:function(){this.refCounter--,this.refCounter=this.refCounter<0?0:this.refCounter,this.hasBeenDestroyed()&&this.element&&this.element.parentNode&&(this.element.parentNode.removeChild(this.element),delete this.element,this.isAppended=!1)}},{key:"getValue",value:function(){return this.element.value}},{key:"hasBeenDestroyed",value:function(){return this.refCounter<1}},{key:"isActive",value:function(){return this.element===document.activeElement}},{key:"select",value:function(){this.element.focus(),this.element.select()}},{key:"setValue",value:function(e){this.element.value=e}}],[{key:"getSingleton",value:function(){return j.append(),j}}]),e}(),j=new k,A=k,N=a("../node_modules/@tencent/docs-user-agent/dist/index.js"),E=a.n(N),_=A.getSingleton();function W(){_.select()}var M=function(e,t){if(e===P.CANPASTETYPE.NONE&&T.a.isCopyInEnv()){var a=T.a.getServerCopyData();if(a.plain)return t.doClipboardPaste({html:a.html||"",plain:a.plain}),!0}return!1},F=function(e){Object(D.h)((function(t){var a={},n=0,r=e.copyPasteCache.getCacheState().clipboardCopyData;parseInt(r.timeStamp,10)>n&&(n=parseInt(r.timeStamp,10),a=r);var s=Object(D.d)();if(parseInt(s.timeStamp,10)>n){n=parseInt(s.timeStamp,10),a=s;try{a===s&&x.b.tdwReport({module:"excel_picture",opername:"doc_excel_editor",action:"picture_menu_ctrl_paste"})}catch(c){}}t.timeStamp>n&&(n=t.timeStamp,a=t),e.doClipboardPaste({html:a.html||"",plain:a.plain||""})}))},Q=function(){E.a.isPCTencentDocsClient&&(Object(O.hideToast)(),Object(O.showToast)("\u526a\u5207\u677f\u91cc\u7684\u5185\u5bb9\u53ef\u80fd\u88ab\u5916\u90e8\u7a0b\u5e8f\u6e05\u9664\u4e86\uff0c\u5f53\u524d\u6ca1\u6709\u53ef\u4ee5\u7c98\u8d34\u7684\u5185\u5bb9",void 0,{isNeedBtn:!0,btnText:"\u6211\u77e5\u9053\u4e86",btnTextAfter:"",btnCallBack:function(){Object(O.hideToast)()}}))},L=function(e,t){try{e===t&&x.b.tdwReport({module:"excel_picture",opername:"doc_excel_editor",action:"picture_menu_ctrl_paste"})}catch(a){}};function Y(e){return B.apply(this,arguments)}function B(){return(B=Object(n.a)(regeneratorRuntime.mark((function e(t){var a,n,r,s,c,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.feature.getCopyPaste();case 2:a=e.sent,n=a.getPasteType()!==P.CANPASTETYPE.NONE,r=T.a.isCopyInEnv()&&T.a.isCopyDataAvailable(),s=!1,e.next=13;break;case 11:o=Object(D.e)(),s=c||i||o;case 13:return!0,!!t.view.canvas.shapeEdit.focusing,e.abrupt("return",{canPaste:s||n||r,visable:!0});case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e){return U.apply(this,arguments)}function U(){return(U=Object(n.a)(regeneratorRuntime.mark((function e(t){var a,n,r,s,c,i,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.feature.getCopyPaste();case 2:if(a=e.sent,n=a.getPasteType(),!E.a.isIPad){e.next=10;break}if(!M(n,a)){e.next=7;break}return e.abrupt("return");case 7:if(!E.a.isTencentDocsApp){e.next=10;break}return F(a),e.abrupt("return");case 10:if(n!==P.CANPASTETYPE.NONE){e.next=13;break}return Q(),e.abrupt("return");case 13:if(n!==P.CANPASTETYPE.CLIPBOARD){e.next=17;break}a.onPastePCClient(),e.next=22;break;case 17:if((r=a.getPasteType())!==P.CANPASTETYPE.NONE){e.next=21;break}return Q(),e.abrupt("return");case 21:r===P.CANPASTETYPE.CLIPBOARD?a.onPastePCClient():(s=a.copyPasteCache.getCacheState().clipboardCopyData,c=Object(D.d)(),i=s.timeStamp>c.timeStamp?s:c,o={html:i.html,plain:i.plain},T.a.isCopyInEnv()&&(u=T.a.getServerCopyData()).timeStamp>Number(s.timeStamp)&&u.plain!==o.plain&&(o.html=u.html||"",o.plain=u.plain),a.doClipboardPaste(o),L(i,c));case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var V,J,G=a("./src/core/feature/copyPaste/api/copyPasteAPI.m.ts"),q=a("./src/core/feature/copyPaste/lib/smartSplit/SmartSplit.ts"),z=a("./src/core/feature/copyPaste/iconSource.tsx");(J=V||(V={})).apiDoCopy=m,J.apiInsertCopy=g,J.apiInsertCut=v,J.apiJudgeForInsertCopy=h,J.CopyIconSource=z.a,J.CopyPasteCache=l.default,J.apiDoPaste=H,J.apiJudgeForPaste=Y,J.apiSelectTextarea=W,J.apiDoPasteM=G.c,J.apiJudgeForPasteM=G.d,J.CopyType=u.b,J.CopyHTMLType=u.a,J.needCheckSmartSplit=q.f,J.getResultSP=q.d,J.showToastSPMobile=q.i,J.doSmartSplit=q.a,J.hideToastSP=q.e,J.showToastSP=q.h;t.default=V}}]);
//# sourceMappingURL=pc-bundle_feature_copy_paste_base-381db4033d.js.map