(window.webpackJsonp=window.webpackJsonp||[]).push([["bundle_messageService","bundle_spreadsheet_tool_lazy"],{"../node_modules/@tencent/netcheck/lib/index.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var o,r=n("../node_modules/@tencent/docs-user-agent/dist/index.js"),s=n.n(r),i=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{c(o.next(e))}catch(t){s(t)}}function a(e){try{c(o.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))},a=function(e,t){var n,o,r,s,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=(r=i.trys).length>0&&r[r.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(a){s=[6,a],o=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};!function(e){e.OFF_LINE="offline",e.ON_LINE="online"}(o||(o={}));window.__offlinetest=!1;var c=function(){function e(){this.duration=15e3,this.status=navigator.onLine?o.ON_LINE:o.OFF_LINE,this.callbacks=[],this.handleVisibility=this.handleVisibility.bind(this),this.bindVisibility()}return e.prototype.bindVisibility=function(){var e;"undefined"!==typeof document.hidden?e="visibilitychange":"undefined"!==typeof document.mozHidden?e="mozvisibilitychange":"undefined"!==typeof document.msHidden?e="msvisibilitychange":"undefined"!==typeof document.webkitHidden&&(e="webkitvisibilitychange"),window.mqq&&s.a.isAndroid&&(s.a.isTencentDocsApp||s.a.isTimOrQQ)&&!s.a.isQQMiniProgram?window.mqq.addEventListener("qbrowserVisibilityChange",this.handleVisibility):document.addEventListener(e,this.handleVisibility)},e.prototype.handleVisibility=function(){document.hidden||document.webkitHidden||document.msHidden||document.mozHidden?this.pause():this.startChect()},e.prototype.pause=function(){clearTimeout(this.Timer),this.Timer=null},e.prototype.init=function(){var e=this;return this.netcheck().then((function(t){e.status=t})),window.addEventListener("online",this.handleNetstatus.bind(this)),window.addEventListener("offline",this.handleNetstatus.bind(this)),this.startChect(),this},e.prototype.startChect=function(){this.Timer||(this.Timer=setInterval(this.polling.bind(this),this.duration))},e.prototype.polling=function(){return i(this,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return[4,this.netcheck()];case 1:return e=t.sent(),this.status!==e&&(this.status=e,this.handleCalback()),[2]}}))}))},e.prototype.netcheck=function(){return i(this,void 0,void 0,(function(){var e=this;return a(this,(function(t){return this.netcheckImage||(this.netcheckImage=new Image),this.netcheckImage.src="https://pub.idqqimg.com/pc/misc/files/20200114/390bc96befed3c9fe3aa1d013695fb41.gif?t="+Date.now(),[2,new Promise((function(t){e.netcheckImage.onload=function(){t(o.ON_LINE)},e.netcheckImage.onerror=function(){t(o.OFF_LINE)}}))]}))}))},Object.defineProperty(e.prototype,"isOnline",{get:function(){return!window.__offlinetest&&this.status===o.ON_LINE},enumerable:!0,configurable:!0}),e.prototype.handleNetstatus=function(){return i(this,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return e=this,[4,this.netcheck()];case 1:return e.status=t.sent(),this.handleCalback(),[2]}}))}))},e.prototype.handleCalback=function(){var e=this;this.callbacks.forEach((function(t){t(e.status)}))},e.prototype.changeEnd=function(e){this.callbacks.push(e)},e.prototype.remove=function(e){for(var t=this.callbacks.slice(0,this.callbacks.length),n=0;n<t.length;n++)t[n]===e&&(t.splice(n,1),this.callbacks=t)},e}(),l=(new c).init()},"../node_modules/after/index.js":function(e,t){function n(){}e.exports=function(e,t,o){var r=!1;return o=o||n,s.count=e,0===e?t():s;function s(e,n){if(s.count<=0)throw new Error("after called too many times");--s.count,e?(r=!0,t(e),t=o):0!==s.count||r||t(null,n)}}},"../node_modules/arraybuffer.slice/index.js":function(e,t){e.exports=function(e,t,n){var o=e.byteLength;if(t=t||0,n=n||o,e.slice)return e.slice(t,n);if(t<0&&(t+=o),n<0&&(n+=o),n>o&&(n=o),t>=o||t>=n||0===o)return new ArrayBuffer(0);for(var r=new Uint8Array(e),s=new Uint8Array(n-t),i=t,a=0;i<n;i++,a++)s[a]=r[i];return s.buffer}},"../node_modules/atob/browser-atob.js":function(e,t,n){(function(e,t){!function(n){"use strict";var o,r="function"===typeof(o=n.atob)?o:"function"===typeof e?function(t){return new e(t,"base64").toString("binary")}:"object"===typeof n.base64js?function(e){var t=n.base64js.b64ToByteArray(e);return Array.prototype.map.call(t,(function(e){return String.fromCharCode(e)})).join("")}:function(){throw new Error("You're probably in an old browser or an iOS webworker. It might help to include beatgammit's base64-js.")};n.atob=r,t&&t.exports&&(t.exports=r)}(window)}).call(this,n("../node_modules/buffer/index.js").Buffer,n("../node_modules/webpack/buildin/module.js")(e))},"../node_modules/backo2/index.js":function(e,t){function n(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=n,n.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(e){this.ms=e},n.prototype.setMax=function(e){this.max=e},n.prototype.setJitter=function(e){this.jitter=e}},"../node_modules/base64-arraybuffer/lib/base64-arraybuffer.js":function(e,t){!function(e){"use strict";t.encode=function(t){var n,o=new Uint8Array(t),r=o.length,s="";for(n=0;n<r;n+=3)s+=e[o[n]>>2],s+=e[(3&o[n])<<4|o[n+1]>>4],s+=e[(15&o[n+1])<<2|o[n+2]>>6],s+=e[63&o[n+2]];return r%3===2?s=s.substring(0,s.length-1)+"=":r%3===1&&(s=s.substring(0,s.length-2)+"=="),s},t.decode=function(t){var n,o,r,s,i,a=.75*t.length,c=t.length,l=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var u=new ArrayBuffer(a),d=new Uint8Array(u);for(n=0;n<c;n+=4)o=e.indexOf(t[n]),r=e.indexOf(t[n+1]),s=e.indexOf(t[n+2]),i=e.indexOf(t[n+3]),d[l++]=o<<2|r>>4,d[l++]=(15&r)<<4|s>>2,d[l++]=(3&s)<<6|63&i;return u}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},"../node_modules/blob/index.js":function(e,t){var n="undefined"!==typeof n?n:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!==typeof MSBlobBuilder?MSBlobBuilder:"undefined"!==typeof MozBlobBuilder&&MozBlobBuilder,o=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),r=o&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),s=n&&n.prototype.append&&n.prototype.getBlob;function i(e){return e.map((function(e){if(e.buffer instanceof ArrayBuffer){var t=e.buffer;if(e.byteLength!==t.byteLength){var n=new Uint8Array(e.byteLength);n.set(new Uint8Array(t,e.byteOffset,e.byteLength)),t=n.buffer}return t}return e}))}function a(e,t){t=t||{};var o=new n;return i(e).forEach((function(e){o.append(e)})),t.type?o.getBlob(t.type):o.getBlob()}function c(e,t){return new Blob(i(e),t||{})}"undefined"!==typeof Blob&&(a.prototype=Blob.prototype,c.prototype=Blob.prototype),e.exports=o?r?Blob:c:s?a:void 0},"../node_modules/component-bind/index.js":function(e,t){var n=[].slice;e.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var o=n.call(arguments,2);return function(){return t.apply(e,o.concat(n.call(arguments)))}}},"../node_modules/component-emitter/index.js":function(e,t,n){function o(e){if(e)return function(e){for(var t in o.prototype)e[t]=o.prototype[t];return e}(e)}e.exports=o,o.prototype.on=o.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},o.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},o.prototype.off=o.prototype.removeListener=o.prototype.removeAllListeners=o.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,o=this._callbacks["$"+e];if(!o)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r=0;r<o.length;r++)if((n=o[r])===t||n.fn===t){o.splice(r,1);break}return 0===o.length&&delete this._callbacks["$"+e],this},o.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],o=1;o<arguments.length;o++)t[o-1]=arguments[o];if(n){o=0;for(var r=(n=n.slice(0)).length;o<r;++o)n[o].apply(this,t)}return this},o.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},o.prototype.hasListeners=function(e){return!!this.listeners(e).length}},"../node_modules/component-inherit/index.js":function(e,t){e.exports=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},"../node_modules/debug/src/browser.js":function(e,t,n){(function(o){function r(){var e;try{e=t.storage.debug}catch(n){}return!e&&"undefined"!==typeof o&&"env"in o&&(e=o.env.DEBUG),e}(t=e.exports=n("../node_modules/debug/src/debug.js")).log=function(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return;var o="color: "+this.color;e.splice(1,0,o,"color: inherit");var r=0,s=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(r++,"%c"===e&&(s=r))})),e.splice(s,0,o)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(n){}},t.load=r,t.useColors=function(){if("undefined"!==typeof window&&window.process&&"renderer"===window.process.type)return!0;return"undefined"!==typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!==typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},t.enable(r())}).call(this,n("../node_modules/process/browser.js"))},"../node_modules/debug/src/debug.js":function(e,t,n){var o;function r(e){function n(){if(n.enabled){var e=n,r=+new Date,s=r-(o||r);e.diff=s,e.prev=o,e.curr=r,o=r;for(var i=new Array(arguments.length),a=0;a<i.length;a++)i[a]=arguments[a];i[0]=t.coerce(i[0]),"string"!==typeof i[0]&&i.unshift("%O");var c=0;i[0]=i[0].replace(/%([a-zA-Z%])/g,(function(n,o){if("%%"===n)return n;c++;var r=t.formatters[o];if("function"===typeof r){var s=i[c];n=r.call(e,s),i.splice(c,1),c--}return n})),t.formatArgs.call(e,i);var l=n.log||t.log||console.log.bind(console);l.apply(e,i)}}return n.namespace=e,n.enabled=t.enabled(e),n.useColors=t.useColors(),n.color=function(e){var n,o=0;for(n in e)o=(o<<5)-o+e.charCodeAt(n),o|=0;return t.colors[Math.abs(o)%t.colors.length]}(e),"function"===typeof t.init&&t.init(n),n}(t=e.exports=r.debug=r.default=r).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e),t.names=[],t.skips=[];for(var n=("string"===typeof e?e:"").split(/[\s,]+/),o=n.length,r=0;r<o;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){var n,o;for(n=0,o=t.skips.length;n<o;n++)if(t.skips[n].test(e))return!1;for(n=0,o=t.names.length;n<o;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n("../node_modules/ms/index.js"),t.names=[],t.skips=[],t.formatters={}},"../node_modules/engine.io-client/lib/globalThis.browser.js":function(e,t){e.exports="undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")()},"../node_modules/engine.io-client/lib/index.js":function(e,t,n){e.exports=n("../node_modules/engine.io-client/lib/socket.js"),e.exports.parser=n("../node_modules/engine.io-parser/lib/browser.js")},"../node_modules/engine.io-client/lib/socket.js":function(e,t,n){var o=n("../node_modules/engine.io-client/lib/transports/index.js"),r=n("../node_modules/component-emitter/index.js"),s=n("../node_modules/debug/src/browser.js")("engine.io-client:socket"),i=n("../node_modules/indexof/index.js"),a=n("../node_modules/engine.io-parser/lib/browser.js"),c=n("../node_modules/parseuri/index.js"),l=n("../node_modules/parseqs/index.js");function u(e,t){if(!(this instanceof u))return new u(e,t);t=t||{},e&&"object"===typeof e&&(t=e,e=null),e?(e=c(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=c(t.host).host),this.secure=null!=t.secure?t.secure:"undefined"!==typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||("undefined"!==typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!==typeof location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"===typeof this.query&&(this.query=l.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.withCredentials=!1!==t.withCredentials,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode,this.isReactNative="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"===typeof self||this.isReactNative)&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}e.exports=u,u.priorWebsocketSuccess=!1,r(u.prototype),u.protocol=a.protocol,u.Socket=u,u.Transport=n("../node_modules/engine.io-client/lib/transport.js"),u.transports=n("../node_modules/engine.io-client/lib/transports/index.js"),u.parser=n("../node_modules/engine.io-parser/lib/browser.js"),u.prototype.createTransport=function(e){s('creating transport "%s"',e);var t=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(this.query);t.EIO=a.protocol,t.transport=e;var n=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new o[e]({query:t,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,withCredentials:n.withCredentials||this.withCredentials,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0,isReactNative:this.isReactNative})},u.prototype.open=function(){var e;if(this.rememberUpgrade&&u.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout((function(){t.emit("error","No transports available")}),0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(n){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},u.prototype.setTransport=function(e){s("setting transport %s",e.name);var t=this;this.transport&&(s("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",(function(){t.onDrain()})).on("packet",(function(e){t.onPacket(e)})).on("error",(function(e){t.onError(e)})).on("close",(function(){t.onClose("transport close")}))},u.prototype.probe=function(e){s('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),n=!1,o=this;function r(){if(o.onlyBinaryUpgrades){var r=!this.supportsBinary&&o.transport.supportsBinary;n=n||r}n||(s('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",(function(r){if(!n)if("pong"===r.type&&"probe"===r.data){if(s('probe transport "%s" pong',e),o.upgrading=!0,o.emit("upgrading",t),!t)return;u.priorWebsocketSuccess="websocket"===t.name,s('pausing current transport "%s"',o.transport.name),o.transport.pause((function(){n||"closed"!==o.readyState&&(s("changing transport and sending upgrade packet"),h(),o.setTransport(t),t.send([{type:"upgrade"}]),o.emit("upgrade",t),t=null,o.upgrading=!1,o.flush())}))}else{s('probe transport "%s" failed',e);var i=new Error("probe error");i.transport=t.name,o.emit("upgradeError",i)}})))}function i(){n||(n=!0,h(),t.close(),t=null)}function a(n){var r=new Error("probe error: "+n);r.transport=t.name,i(),s('probe transport "%s" failed because of error: %s',e,n),o.emit("upgradeError",r)}function c(){a("transport closed")}function l(){a("socket closed")}function d(e){t&&e.name!==t.name&&(s('"%s" works - aborting "%s"',e.name,t.name),i())}function h(){t.removeListener("open",r),t.removeListener("error",a),t.removeListener("close",c),o.removeListener("close",l),o.removeListener("upgrading",d)}u.priorWebsocketSuccess=!1,t.once("open",r),t.once("error",a),t.once("close",c),this.once("close",l),this.once("upgrading",d),t.open()},u.prototype.onOpen=function(){if(s("socket open"),this.readyState="open",u.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){s("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},u.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(s('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else s('packet received with socket readyState "%s"',this.readyState)},u.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},u.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout((function(){"closed"!==t.readyState&&t.onClose("ping timeout")}),e||t.pingInterval+t.pingTimeout)},u.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout((function(){s("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)}),e.pingInterval)},u.prototype.ping=function(){var e=this;this.sendPacket("ping",(function(){e.emit("ping")}))},u.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},u.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(s("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},u.prototype.write=u.prototype.send=function(e,t,n){return this.sendPacket("message",e,t,n),this},u.prototype.sendPacket=function(e,t,n,o){if("function"===typeof t&&(o=t,t=void 0),"function"===typeof n&&(o=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var r={type:e,data:t,options:n};this.emit("packetCreate",r),this.writeBuffer.push(r),o&&this.once("flush",o),this.flush()}},u.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",(function(){this.upgrading?o():t()})):this.upgrading?o():t()}function t(){e.onClose("forced close"),s("socket closing - telling transport to close"),e.transport.close()}function n(){e.removeListener("upgrade",n),e.removeListener("upgradeError",n),t()}function o(){e.once("upgrade",n),e.once("upgradeError",n)}return this},u.prototype.onError=function(e){s("socket error %j",e),u.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},u.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){s('socket close with reason: "%s"',e);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0}},u.prototype.filterUpgrades=function(e){for(var t=[],n=0,o=e.length;n<o;n++)~i(this.transports,e[n])&&t.push(e[n]);return t}},"../node_modules/engine.io-client/lib/transport.js":function(e,t,n){var o=n("../node_modules/engine.io-parser/lib/browser.js"),r=n("../node_modules/component-emitter/index.js");function s(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.withCredentials=e.withCredentials,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.isReactNative=e.isReactNative,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}e.exports=s,r(s.prototype),s.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},s.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},s.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},s.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},s.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},s.prototype.onData=function(e){var t=o.decodePacket(e,this.socket.binaryType);this.onPacket(t)},s.prototype.onPacket=function(e){this.emit("packet",e)},s.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},"../node_modules/engine.io-client/lib/transports/index.js":function(e,t,n){var o=n("../node_modules/engine.io-client/lib/xmlhttprequest.js"),r=n("../node_modules/engine.io-client/lib/transports/polling-xhr.js"),s=n("../node_modules/engine.io-client/lib/transports/polling-jsonp.js"),i=n("../node_modules/engine.io-client/lib/transports/websocket.js");t.polling=function(e){var t=!1,n=!1,i=!1!==e.jsonp;if("undefined"!==typeof location){var a="https:"===location.protocol,c=location.port;c||(c=a?443:80),t=e.hostname!==location.hostname||c!==e.port,n=e.secure!==a}if(e.xdomain=t,e.xscheme=n,"open"in new o(e)&&!e.forceJSONP)return new r(e);if(!i)throw new Error("JSONP disabled");return new s(e)},t.websocket=i},"../node_modules/engine.io-client/lib/transports/polling-jsonp.js":function(e,t,n){var o=n("../node_modules/engine.io-client/lib/transports/polling.js"),r=n("../node_modules/component-inherit/index.js"),s=n("../node_modules/engine.io-client/lib/globalThis.browser.js");e.exports=u;var i,a=/\n/g,c=/\\n/g;function l(){}function u(e){o.call(this,e),this.query=this.query||{},i||(i=s.___eio=s.___eio||[]),this.index=i.length;var t=this;i.push((function(e){t.onData(e)})),this.query.j=this.index,"function"===typeof addEventListener&&addEventListener("beforeunload",(function(){t.script&&(t.script.onerror=l)}),!1)}r(u,o),u.prototype.supportsBinary=!1,u.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),o.prototype.doClose.call(this)},u.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(t,n):(document.head||document.body).appendChild(t),this.script=t,"undefined"!==typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout((function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)}),100)},u.prototype.doWrite=function(e,t){var n=this;if(!this.form){var o,r=document.createElement("form"),s=document.createElement("textarea"),i=this.iframeId="eio_iframe_"+this.index;r.className="socketio",r.style.position="absolute",r.style.top="-1000px",r.style.left="-1000px",r.target=i,r.method="POST",r.setAttribute("accept-charset","utf-8"),s.name="d",r.appendChild(s),document.body.appendChild(r),this.form=r,this.area=s}function l(){u(),t()}function u(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(t){n.onError("jsonp polling iframe removal error",t)}try{var e='<iframe src="javascript:0" name="'+n.iframeId+'">';o=document.createElement(e)}catch(t){(o=document.createElement("iframe")).name=n.iframeId,o.src="javascript:0"}o.id=n.iframeId,n.form.appendChild(o),n.iframe=o}this.form.action=this.uri(),u(),e=e.replace(c,"\\\n"),this.area.value=e.replace(a,"\\n");try{this.form.submit()}catch(d){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===n.iframe.readyState&&l()}:this.iframe.onload=l}},"../node_modules/engine.io-client/lib/transports/polling-xhr.js":function(e,t,n){var o=n("../node_modules/engine.io-client/lib/xmlhttprequest.js"),r=n("../node_modules/engine.io-client/lib/transports/polling.js"),s=n("../node_modules/component-emitter/index.js"),i=n("../node_modules/component-inherit/index.js"),a=n("../node_modules/debug/src/browser.js")("engine.io-client:polling-xhr"),c=n("../node_modules/engine.io-client/lib/globalThis.browser.js");function l(){}function u(e){if(r.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,"undefined"!==typeof location){var t="https:"===location.protocol,n=location.port;n||(n=t?443:80),this.xd="undefined"!==typeof location&&e.hostname!==location.hostname||n!==e.port,this.xs=e.secure!==t}}function d(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.withCredentials=e.withCredentials,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}if(e.exports=u,e.exports.Request=d,i(u,r),u.prototype.supportsBinary=!0,u.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.withCredentials=this.withCredentials,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new d(e)},u.prototype.doWrite=function(e,t){var n="string"!==typeof e&&void 0!==e,o=this.request({method:"POST",data:e,isBinary:n}),r=this;o.on("success",t),o.on("error",(function(e){r.onError("xhr post error",e)})),this.sendXhr=o},u.prototype.doPoll=function(){a("xhr poll");var e=this.request(),t=this;e.on("data",(function(e){t.onData(e)})),e.on("error",(function(e){t.onError("xhr poll error",e)})),this.pollXhr=e},s(d.prototype),d.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new o(e),n=this;try{a("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var r in t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(r)&&t.setRequestHeader(r,this.extraHeaders[r])}catch(s){}if("POST"===this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(s){}try{t.setRequestHeader("Accept","*/*")}catch(s){}"withCredentials"in t&&(t.withCredentials=this.withCredentials),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){n.onLoad()},t.onerror=function(){n.onError(t.responseText)}):t.onreadystatechange=function(){if(2===t.readyState)try{var e=t.getResponseHeader("Content-Type");(n.supportsBinary&&"application/octet-stream"===e||"application/octet-stream; charset=UTF-8"===e)&&(t.responseType="arraybuffer")}catch(s){}4===t.readyState&&(200===t.status||1223===t.status?n.onLoad():setTimeout((function(){n.onError("number"===typeof t.status?t.status:0)}),0))},a("xhr data %s",this.data),t.send(this.data)}catch(s){return void setTimeout((function(){n.onError(s)}),0)}"undefined"!==typeof document&&(this.index=d.requestsCount++,d.requests[this.index]=this)},d.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},d.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},d.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},d.prototype.cleanup=function(e){if("undefined"!==typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=l:this.xhr.onreadystatechange=l,e)try{this.xhr.abort()}catch(t){}"undefined"!==typeof document&&delete d.requests[this.index],this.xhr=null}},d.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(n){}e=("application/octet-stream"===t||"application/octet-stream; charset=UTF-8"===t)&&this.xhr.response||this.xhr.responseText}catch(n){this.onError(n)}null!=e&&this.onData(e)},d.prototype.hasXDR=function(){return"undefined"!==typeof XDomainRequest&&!this.xs&&this.enablesXDR},d.prototype.abort=function(){this.cleanup()},d.requestsCount=0,d.requests={},"undefined"!==typeof document)if("function"===typeof attachEvent)attachEvent("onunload",h);else if("function"===typeof addEventListener){addEventListener("onpagehide"in c?"pagehide":"unload",h,!1)}function h(){for(var e in d.requests)d.requests.hasOwnProperty(e)&&d.requests[e].abort()}},"../node_modules/engine.io-client/lib/transports/polling.js":function(e,t,n){var o=n("../node_modules/engine.io-client/lib/transport.js"),r=n("../node_modules/parseqs/index.js"),s=n("../node_modules/engine.io-parser/lib/browser.js"),i=n("../node_modules/component-inherit/index.js"),a=n("../node_modules/yeast/index.js"),c=n("../node_modules/debug/src/browser.js")("engine.io-client:polling");e.exports=u;var l=null!=new(n("../node_modules/engine.io-client/lib/xmlhttprequest.js"))({xdomain:!1}).responseType;function u(e){var t=e&&e.forceBase64;l&&!t||(this.supportsBinary=!1),o.call(this,e)}i(u,o),u.prototype.name="polling",u.prototype.doOpen=function(){this.poll()},u.prototype.pause=function(e){var t=this;function n(){c("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var o=0;this.polling&&(c("we are currently polling - waiting to pause"),o++,this.once("pollComplete",(function(){c("pre-pause polling complete"),--o||n()}))),this.writable||(c("we are currently writing - waiting to pause"),o++,this.once("drain",(function(){c("pre-pause writing complete"),--o||n()})))}else n()},u.prototype.poll=function(){c("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},u.prototype.onData=function(e){var t=this;c("polling got data %s",e);s.decodePayload(e,this.socket.binaryType,(function(e,n,o){if("opening"===t.readyState&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():c('ignoring poll - transport state "%s"',this.readyState))},u.prototype.doClose=function(){var e=this;function t(){c("writing close packet"),e.write([{type:"close"}])}"open"===this.readyState?(c("transport open - closing"),t()):(c("transport not open - deferring close"),this.once("open",t))},u.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")};s.encodePayload(e,this.supportsBinary,(function(e){t.doWrite(e,n)}))},u.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=a()),this.supportsBinary||e.sid||(e.b64=1),e=r.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e}},"../node_modules/engine.io-client/lib/transports/websocket.js":function(e,t,n){(function(t){var o,r,s=n("../node_modules/engine.io-client/lib/transport.js"),i=n("../node_modules/engine.io-parser/lib/browser.js"),a=n("../node_modules/parseqs/index.js"),c=n("../node_modules/component-inherit/index.js"),l=n("../node_modules/yeast/index.js"),u=n("../node_modules/debug/src/browser.js")("engine.io-client:websocket");if("undefined"!==typeof WebSocket?o=WebSocket:"undefined"!==typeof self&&(o=self.WebSocket||self.MozWebSocket),"undefined"===typeof window)try{r=n(0)}catch(f){}var d=o||r;function h(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=o&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(d=r),s.call(this,e)}e.exports=h,c(h,s),h.prototype.name="websocket",h.prototype.supportsBinary=!0,h.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,n={};this.isReactNative||(n.agent=this.agent,n.perMessageDeflate=this.perMessageDeflate,n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized),this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?t?new d(e,t):new d(e):new d(e,t,n)}catch(o){return this.emit("error",o)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},h.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},h.prototype.write=function(e){var n=this;this.writable=!1;for(var o=e.length,r=0,s=o;r<s;r++)!function(e){i.encodePacket(e,n.supportsBinary,(function(r){if(!n.usingBrowserWebSocket){var s={};if(e.options&&(s.compress=e.options.compress),n.perMessageDeflate)("string"===typeof r?t.byteLength(r):r.length)<n.perMessageDeflate.threshold&&(s.compress=!1)}try{n.usingBrowserWebSocket?n.ws.send(r):n.ws.send(r,s)}catch(f){u("websocket closed before onclose event")}--o||a()}))}(e[r]);function a(){n.emit("flush"),setTimeout((function(){n.writable=!0,n.emit("drain")}),0)}},h.prototype.onClose=function(){s.prototype.onClose.call(this)},h.prototype.doClose=function(){"undefined"!==typeof this.ws&&this.ws.close()},h.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=l()),this.supportsBinary||(e.b64=1),(e=a.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e},h.prototype.check=function(){return!!d&&!("__initialize"in d&&this.name===h.prototype.name)}}).call(this,n("../node_modules/buffer/index.js").Buffer)},"../node_modules/engine.io-client/lib/xmlhttprequest.js":function(e,t,n){var o=n("../node_modules/has-cors/index.js"),r=n("../node_modules/engine.io-client/lib/globalThis.browser.js");e.exports=function(e){var t=e.xdomain,n=e.xscheme,s=e.enablesXDR;try{if("undefined"!==typeof XMLHttpRequest&&(!t||o))return new XMLHttpRequest}catch(i){}try{if("undefined"!==typeof XDomainRequest&&!n&&s)return new XDomainRequest}catch(i){}if(!t)try{return new(r[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(i){}}},"../node_modules/engine.io-parser/lib/browser.js":function(e,t,n){var o,r=n("../node_modules/engine.io-parser/lib/keys.js"),s=n("../node_modules/has-binary2/index.js"),i=n("../node_modules/arraybuffer.slice/index.js"),a=n("../node_modules/after/index.js"),c=n("../node_modules/engine.io-parser/lib/utf8.js");"undefined"!==typeof ArrayBuffer&&(o=n("../node_modules/base64-arraybuffer/lib/base64-arraybuffer.js"));var l="undefined"!==typeof navigator&&/Android/i.test(navigator.userAgent),u="undefined"!==typeof navigator&&/PhantomJS/i.test(navigator.userAgent),d=l||u;t.protocol=3;var h=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},f=r(h),p={type:"error",data:"parser error"},m=n("../node_modules/blob/index.js");function g(e,t,n){for(var o=new Array(e.length),r=a(e.length,n),s=function(e,n,r){t(n,(function(t,n){o[e]=n,r(t,o)}))},i=0;i<e.length;i++)s(i,e[i],r)}t.encodePacket=function(e,n,o,r){"function"===typeof n&&(r=n,n=!1),"function"===typeof o&&(r=o,o=null);var s=void 0===e.data?void 0:e.data.buffer||e.data;if("undefined"!==typeof ArrayBuffer&&s instanceof ArrayBuffer)return function(e,n,o){if(!n)return t.encodeBase64Packet(e,o);var r=e.data,s=new Uint8Array(r),i=new Uint8Array(1+r.byteLength);i[0]=h[e.type];for(var a=0;a<s.length;a++)i[a+1]=s[a];return o(i.buffer)}(e,n,r);if("undefined"!==typeof m&&s instanceof m)return function(e,n,o){if(!n)return t.encodeBase64Packet(e,o);if(d)return function(e,n,o){if(!n)return t.encodeBase64Packet(e,o);var r=new FileReader;return r.onload=function(){t.encodePacket({type:e.type,data:r.result},n,!0,o)},r.readAsArrayBuffer(e.data)}(e,n,o);var r=new Uint8Array(1);r[0]=h[e.type];var s=new m([r.buffer,e.data]);return o(s)}(e,n,r);if(s&&s.base64)return function(e,n){var o="b"+t.packets[e.type]+e.data.data;return n(o)}(e,r);var i=h[e.type];return void 0!==e.data&&(i+=o?c.encode(String(e.data),{strict:!1}):String(e.data)),r(""+i)},t.encodeBase64Packet=function(e,n){var o,r="b"+t.packets[e.type];if("undefined"!==typeof m&&e.data instanceof m){var s=new FileReader;return s.onload=function(){var e=s.result.split(",")[1];n(r+e)},s.readAsDataURL(e.data)}try{o=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(l){for(var i=new Uint8Array(e.data),a=new Array(i.length),c=0;c<i.length;c++)a[c]=i[c];o=String.fromCharCode.apply(null,a)}return r+=btoa(o),n(r)},t.decodePacket=function(e,n,o){if(void 0===e)return p;if("string"===typeof e){if("b"===e.charAt(0))return t.decodeBase64Packet(e.substr(1),n);if(o&&!1===(e=function(e){try{e=c.decode(e,{strict:!1})}catch(t){return!1}return e}(e)))return p;var r=e.charAt(0);return Number(r)==r&&f[r]?e.length>1?{type:f[r],data:e.substring(1)}:{type:f[r]}:p}r=new Uint8Array(e)[0];var s=i(e,1);return m&&"blob"===n&&(s=new m([s])),{type:f[r],data:s}},t.decodeBase64Packet=function(e,t){var n=f[e.charAt(0)];if(!o)return{type:n,data:{base64:!0,data:e.substr(1)}};var r=o.decode(e.substr(1));return"blob"===t&&m&&(r=new m([r])),{type:n,data:r}},t.encodePayload=function(e,n,o){"function"===typeof n&&(o=n,n=null);var r=s(e);if(n&&r)return m&&!d?t.encodePayloadAsBlob(e,o):t.encodePayloadAsArrayBuffer(e,o);if(!e.length)return o("0:");g(e,(function(e,o){t.encodePacket(e,!!r&&n,!1,(function(e){o(null,function(e){return e.length+":"+e}(e))}))}),(function(e,t){return o(t.join(""))}))},t.decodePayload=function(e,n,o){if("string"!==typeof e)return t.decodePayloadAsBinary(e,n,o);var r;if("function"===typeof n&&(o=n,n=null),""===e)return o(p,0,1);for(var s,i,a="",c=0,l=e.length;c<l;c++){var u=e.charAt(c);if(":"===u){if(""===a||a!=(s=Number(a)))return o(p,0,1);if(a!=(i=e.substr(c+1,s)).length)return o(p,0,1);if(i.length){if(r=t.decodePacket(i,n,!1),p.type===r.type&&p.data===r.data)return o(p,0,1);if(!1===o(r,c+s,l))return}c+=s,a=""}else a+=u}return""!==a?o(p,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,n){if(!e.length)return n(new ArrayBuffer(0));g(e,(function(e,n){t.encodePacket(e,!0,!0,(function(e){return n(null,e)}))}),(function(e,t){var o=t.reduce((function(e,t){var n;return e+(n="string"===typeof t?t.length:t.byteLength).toString().length+n+2}),0),r=new Uint8Array(o),s=0;return t.forEach((function(e){var t="string"===typeof e,n=e;if(t){for(var o=new Uint8Array(e.length),i=0;i<e.length;i++)o[i]=e.charCodeAt(i);n=o.buffer}r[s++]=t?0:1;var a=n.byteLength.toString();for(i=0;i<a.length;i++)r[s++]=parseInt(a[i]);r[s++]=255;for(o=new Uint8Array(n),i=0;i<o.length;i++)r[s++]=o[i]})),n(r.buffer)}))},t.encodePayloadAsBlob=function(e,n){g(e,(function(e,n){t.encodePacket(e,!0,!0,(function(e){var t=new Uint8Array(1);if(t[0]=1,"string"===typeof e){for(var o=new Uint8Array(e.length),r=0;r<e.length;r++)o[r]=e.charCodeAt(r);e=o.buffer,t[0]=0}var s=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),i=new Uint8Array(s.length+1);for(r=0;r<s.length;r++)i[r]=parseInt(s[r]);if(i[s.length]=255,m){var a=new m([t.buffer,i.buffer,e]);n(null,a)}}))}),(function(e,t){return n(new m(t))}))},t.decodePayloadAsBinary=function(e,n,o){"function"===typeof n&&(o=n,n=null);for(var r=e,s=[];r.byteLength>0;){for(var a=new Uint8Array(r),c=0===a[0],l="",u=1;255!==a[u];u++){if(l.length>310)return o(p,0,1);l+=a[u]}r=i(r,2+l.length),l=parseInt(l);var d=i(r,0,l);if(c)try{d=String.fromCharCode.apply(null,new Uint8Array(d))}catch(m){var h=new Uint8Array(d);d="";for(u=0;u<h.length;u++)d+=String.fromCharCode(h[u])}s.push(d),r=i(r,l)}var f=s.length;s.forEach((function(e,r){o(t.decodePacket(e,n,!0),r,f)}))}},"../node_modules/engine.io-parser/lib/keys.js":function(e,t){e.exports=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var o in e)n.call(e,o)&&t.push(o);return t}},"../node_modules/engine.io-parser/lib/utf8.js":function(e,t){var n,o,r,s=String.fromCharCode;function i(e){for(var t,n,o=[],r=0,s=e.length;r<s;)(t=e.charCodeAt(r++))>=55296&&t<=56319&&r<s?56320==(64512&(n=e.charCodeAt(r++)))?o.push(((1023&t)<<10)+(1023&n)+65536):(o.push(t),r--):o.push(t);return o}function a(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function c(e,t){return s(e>>t&63|128)}function l(e,t){if(0==(4294967168&e))return s(e);var n="";return 0==(4294965248&e)?n=s(e>>6&31|192):0==(4294901760&e)?(a(e,t)||(e=65533),n=s(e>>12&15|224),n+=c(e,6)):0==(4292870144&e)&&(n=s(e>>18&7|240),n+=c(e,12),n+=c(e,6)),n+=s(63&e|128)}function u(){if(r>=o)throw Error("Invalid byte index");var e=255&n[r];if(r++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function d(e){var t,s;if(r>o)throw Error("Invalid byte index");if(r==o)return!1;if(t=255&n[r],r++,0==(128&t))return t;if(192==(224&t)){if((s=(31&t)<<6|u())>=128)return s;throw Error("Invalid continuation byte")}if(224==(240&t)){if((s=(15&t)<<12|u()<<6|u())>=2048)return a(s,e)?s:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&(s=(7&t)<<18|u()<<12|u()<<6|u())>=65536&&s<=1114111)return s;throw Error("Invalid UTF-8 detected")}e.exports={version:"2.1.2",encode:function(e,t){for(var n=!1!==(t=t||{}).strict,o=i(e),r=o.length,s=-1,a="";++s<r;)a+=l(o[s],n);return a},decode:function(e,t){var a=!1!==(t=t||{}).strict;n=i(e),o=n.length,r=0;for(var c,l=[];!1!==(c=d(a));)l.push(c);return function(e){for(var t,n=e.length,o=-1,r="";++o<n;)(t=e[o])>65535&&(r+=s((t-=65536)>>>10&1023|55296),t=56320|1023&t),r+=s(t);return r}(l)}}},"../node_modules/has-binary2/index.js":function(e,t,n){(function(t){var o=n("../node_modules/isarray/index.js"),r=Object.prototype.toString,s="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===r.call(Blob),i="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===r.call(File);e.exports=function e(n){if(!n||"object"!==typeof n)return!1;if(o(n)){for(var r=0,a=n.length;r<a;r++)if(e(n[r]))return!0;return!1}if("function"===typeof t&&t.isBuffer&&t.isBuffer(n)||"function"===typeof ArrayBuffer&&n instanceof ArrayBuffer||s&&n instanceof Blob||i&&n instanceof File)return!0;if(n.toJSON&&"function"===typeof n.toJSON&&1===arguments.length)return e(n.toJSON(),!0);for(var c in n)if(Object.prototype.hasOwnProperty.call(n,c)&&e(n[c]))return!0;return!1}}).call(this,n("../node_modules/buffer/index.js").Buffer)},"../node_modules/has-cors/index.js":function(e,t){try{e.exports="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(n){e.exports=!1}},"../node_modules/indexof/index.js":function(e,t){var n=[].indexOf;e.exports=function(e,t){if(n)return e.indexOf(t);for(var o=0;o<e.length;++o)if(e[o]===t)return o;return-1}},"../node_modules/ms/index.js":function(e,t){var n=1e3,o=6e4,r=60*o,s=24*r;function i(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}e.exports=function(e,t){t=t||{};var a,c=typeof e;if("string"===c&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var i=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*i;case"days":case"day":case"d":return i*s;case"hours":case"hour":case"hrs":case"hr":case"h":return i*r;case"minutes":case"minute":case"mins":case"min":case"m":return i*o;case"seconds":case"second":case"secs":case"sec":case"s":return i*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return}}(e);if("number"===c&&!1===isNaN(e))return t.long?i(a=e,s,"day")||i(a,r,"hour")||i(a,o,"minute")||i(a,n,"second")||a+" ms":function(e){if(e>=s)return Math.round(e/s)+"d";if(e>=r)return Math.round(e/r)+"h";if(e>=o)return Math.round(e/o)+"m";if(e>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},"../node_modules/pako/index.js":function(e,t,n){"use strict";var o={};(0,n("../node_modules/pako/lib/utils/common.js").assign)(o,n("../node_modules/pako/lib/deflate.js"),n("../node_modules/pako/lib/inflate.js"),n("../node_modules/pako/lib/zlib/constants.js")),e.exports=o},"../node_modules/pako/lib/deflate.js":function(e,t,n){"use strict";var o=n("../node_modules/pako/lib/zlib/deflate.js"),r=n("../node_modules/pako/lib/utils/common.js"),s=n("../node_modules/pako/lib/utils/strings.js"),i=n("../node_modules/pako/lib/zlib/messages.js"),a=n("../node_modules/pako/lib/zlib/zstream.js"),c=Object.prototype.toString;function l(e){if(!(this instanceof l))return new l(e);this.options=r.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var n=o.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==n)throw new Error(i[n]);if(t.header&&o.deflateSetHeader(this.strm,t.header),t.dictionary){var u;if(u="string"===typeof t.dictionary?s.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(n=o.deflateSetDictionary(this.strm,u)))throw new Error(i[n]);this._dict_set=!0}}function u(e,t){var n=new l(t);if(n.push(e,!0),n.err)throw n.msg||i[n.err];return n.result}l.prototype.push=function(e,t){var n,i,a=this.strm,l=this.options.chunkSize;if(this.ended)return!1;i=t===~~t?t:!0===t?4:0,"string"===typeof e?a.input=s.string2buf(e):"[object ArrayBuffer]"===c.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new r.Buf8(l),a.next_out=0,a.avail_out=l),1!==(n=o.deflate(a,i))&&0!==n)return this.onEnd(n),this.ended=!0,!1;0!==a.avail_out&&(0!==a.avail_in||4!==i&&2!==i)||("string"===this.options.to?this.onData(s.buf2binstring(r.shrinkBuf(a.output,a.next_out))):this.onData(r.shrinkBuf(a.output,a.next_out)))}while((a.avail_in>0||0===a.avail_out)&&1!==n);return 4===i?(n=o.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==i||(this.onEnd(0),a.avail_out=0,!0)},l.prototype.onData=function(e){this.chunks.push(e)},l.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=l,t.deflate=u,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,u(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,u(e,t)}},"../node_modules/pako/lib/inflate.js":function(e,t,n){"use strict";var o=n("../node_modules/pako/lib/zlib/inflate.js"),r=n("../node_modules/pako/lib/utils/common.js"),s=n("../node_modules/pako/lib/utils/strings.js"),i=n("../node_modules/pako/lib/zlib/constants.js"),a=n("../node_modules/pako/lib/zlib/messages.js"),c=n("../node_modules/pako/lib/zlib/zstream.js"),l=n("../node_modules/pako/lib/zlib/gzheader.js"),u=Object.prototype.toString;function d(e){if(!(this instanceof d))return new d(e);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var n=o.inflateInit2(this.strm,t.windowBits);if(n!==i.Z_OK)throw new Error(a[n]);if(this.header=new l,o.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"===typeof t.dictionary?t.dictionary=s.string2buf(t.dictionary):"[object ArrayBuffer]"===u.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=o.inflateSetDictionary(this.strm,t.dictionary))!==i.Z_OK))throw new Error(a[n])}function h(e,t){var n=new d(t);if(n.push(e,!0),n.err)throw n.msg||a[n.err];return n.result}d.prototype.push=function(e,t){var n,a,c,l,d,h=this.strm,f=this.options.chunkSize,p=this.options.dictionary,m=!1;if(this.ended)return!1;a=t===~~t?t:!0===t?i.Z_FINISH:i.Z_NO_FLUSH,"string"===typeof e?h.input=s.binstring2buf(e):"[object ArrayBuffer]"===u.call(e)?h.input=new Uint8Array(e):h.input=e,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new r.Buf8(f),h.next_out=0,h.avail_out=f),(n=o.inflate(h,i.Z_NO_FLUSH))===i.Z_NEED_DICT&&p&&(n=o.inflateSetDictionary(this.strm,p)),n===i.Z_BUF_ERROR&&!0===m&&(n=i.Z_OK,m=!1),n!==i.Z_STREAM_END&&n!==i.Z_OK)return this.onEnd(n),this.ended=!0,!1;h.next_out&&(0!==h.avail_out&&n!==i.Z_STREAM_END&&(0!==h.avail_in||a!==i.Z_FINISH&&a!==i.Z_SYNC_FLUSH)||("string"===this.options.to?(c=s.utf8border(h.output,h.next_out),l=h.next_out-c,d=s.buf2string(h.output,c),h.next_out=l,h.avail_out=f-l,l&&r.arraySet(h.output,h.output,c,l,0),this.onData(d)):this.onData(r.shrinkBuf(h.output,h.next_out)))),0===h.avail_in&&0===h.avail_out&&(m=!0)}while((h.avail_in>0||0===h.avail_out)&&n!==i.Z_STREAM_END);return n===i.Z_STREAM_END&&(a=i.Z_FINISH),a===i.Z_FINISH?(n=o.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===i.Z_OK):a!==i.Z_SYNC_FLUSH||(this.onEnd(i.Z_OK),h.avail_out=0,!0)},d.prototype.onData=function(e){this.chunks.push(e)},d.prototype.onEnd=function(e){e===i.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=d,t.inflate=h,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,h(e,t)},t.ungzip=h},"../node_modules/pako/lib/utils/common.js":function(e,t,n){"use strict";var o="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Int32Array;function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!==typeof n)throw new TypeError(n+"must be non-object");for(var o in n)r(n,o)&&(e[o]=n[o])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var s={arraySet:function(e,t,n,o,r){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+o),r);else for(var s=0;s<o;s++)e[r+s]=t[n+s]},flattenChunks:function(e){var t,n,o,r,s,i;for(o=0,t=0,n=e.length;t<n;t++)o+=e[t].length;for(i=new Uint8Array(o),r=0,t=0,n=e.length;t<n;t++)s=e[t],i.set(s,r),r+=s.length;return i}},i={arraySet:function(e,t,n,o,r){for(var s=0;s<o;s++)e[r+s]=t[n+s]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,s)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,i))},t.setTyped(o)},"../node_modules/pako/lib/utils/strings.js":function(e,t,n){"use strict";var o=n("../node_modules/pako/lib/utils/common.js"),r=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(l){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(l){s=!1}for(var i=new o.Buf8(256),a=0;a<256;a++)i[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;function c(e,t){if(t<65534&&(e.subarray&&s||!e.subarray&&r))return String.fromCharCode.apply(null,o.shrinkBuf(e,t));for(var n="",i=0;i<t;i++)n+=String.fromCharCode(e[i]);return n}i[254]=i[254]=1,t.string2buf=function(e){var t,n,r,s,i,a=e.length,c=0;for(s=0;s<a;s++)55296===(64512&(n=e.charCodeAt(s)))&&s+1<a&&56320===(64512&(r=e.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(r-56320),s++),c+=n<128?1:n<2048?2:n<65536?3:4;for(t=new o.Buf8(c),i=0,s=0;i<c;s++)55296===(64512&(n=e.charCodeAt(s)))&&s+1<a&&56320===(64512&(r=e.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(r-56320),s++),n<128?t[i++]=n:n<2048?(t[i++]=192|n>>>6,t[i++]=128|63&n):n<65536?(t[i++]=224|n>>>12,t[i++]=128|n>>>6&63,t[i++]=128|63&n):(t[i++]=240|n>>>18,t[i++]=128|n>>>12&63,t[i++]=128|n>>>6&63,t[i++]=128|63&n);return t},t.buf2binstring=function(e){return c(e,e.length)},t.binstring2buf=function(e){for(var t=new o.Buf8(e.length),n=0,r=t.length;n<r;n++)t[n]=e.charCodeAt(n);return t},t.buf2string=function(e,t){var n,o,r,s,a=t||e.length,l=new Array(2*a);for(o=0,n=0;n<a;)if((r=e[n++])<128)l[o++]=r;else if((s=i[r])>4)l[o++]=65533,n+=s-1;else{for(r&=2===s?31:3===s?15:7;s>1&&n<a;)r=r<<6|63&e[n++],s--;s>1?l[o++]=65533:r<65536?l[o++]=r:(r-=65536,l[o++]=55296|r>>10&1023,l[o++]=56320|1023&r)}return c(l,o)},t.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128===(192&e[n]);)n--;return n<0||0===n?t:n+i[e[n]]>t?n:t}},"../node_modules/pako/lib/zlib/adler32.js":function(e,t,n){"use strict";e.exports=function(e,t,n,o){for(var r=65535&e|0,s=e>>>16&65535|0,i=0;0!==n;){n-=i=n>2e3?2e3:n;do{s=s+(r=r+t[o++]|0)|0}while(--i);r%=65521,s%=65521}return r|s<<16|0}},"../node_modules/pako/lib/zlib/constants.js":function(e,t,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},"../node_modules/pako/lib/zlib/crc32.js":function(e,t,n){"use strict";var o=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t,n,r){var s=o,i=r+n;e^=-1;for(var a=r;a<i;a++)e=e>>>8^s[255&(e^t[a])];return-1^e}},"../node_modules/pako/lib/zlib/deflate.js":function(e,t,n){"use strict";var o,r=n("../node_modules/pako/lib/utils/common.js"),s=n("../node_modules/pako/lib/zlib/trees.js"),i=n("../node_modules/pako/lib/zlib/adler32.js"),a=n("../node_modules/pako/lib/zlib/crc32.js"),c=n("../node_modules/pako/lib/zlib/messages.js");function l(e,t){return e.msg=c[t],t}function u(e){return(e<<1)-(e>4?9:0)}function d(e){for(var t=e.length;--t>=0;)e[t]=0}function h(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(r.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function f(e,t){s._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,h(e.strm)}function p(e,t){e.pending_buf[e.pending++]=t}function m(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function g(e,t,n,o){var s=e.avail_in;return s>o&&(s=o),0===s?0:(e.avail_in-=s,r.arraySet(t,e.input,e.next_in,s,n),1===e.state.wrap?e.adler=i(e.adler,t,s,n):2===e.state.wrap&&(e.adler=a(e.adler,t,s,n)),e.next_in+=s,e.total_in+=s,s)}function b(e,t){var n,o,r=e.max_chain_length,s=e.strstart,i=e.prev_length,a=e.nice_match,c=e.strstart>e.w_size-262?e.strstart-(e.w_size-262):0,l=e.window,u=e.w_mask,d=e.prev,h=e.strstart+258,f=l[s+i-1],p=l[s+i];e.prev_length>=e.good_match&&(r>>=2),a>e.lookahead&&(a=e.lookahead);do{if(l[(n=t)+i]===p&&l[n+i-1]===f&&l[n]===l[s]&&l[++n]===l[s+1]){s+=2,n++;do{}while(l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&s<h);if(o=258-(h-s),s=h-258,o>i){if(e.match_start=t,i=o,o>=a)break;f=l[s+i-1],p=l[s+i]}}}while((t=d[t&u])>c&&0!==--r);return i<=e.lookahead?i:e.lookahead}function _(e){var t,n,o,s,i,a=e.w_size;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=a+(a-262)){r.arraySet(e.window,e.window,a,a,0),e.match_start-=a,e.strstart-=a,e.block_start-=a,t=n=e.hash_size;do{o=e.head[--t],e.head[t]=o>=a?o-a:0}while(--n);t=n=a;do{o=e.prev[--t],e.prev[t]=o>=a?o-a:0}while(--n);s+=a}if(0===e.strm.avail_in)break;if(n=g(e.strm,e.window,e.strstart+e.lookahead,s),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=(e.ins_h<<e.hash_shift^e.window[i+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[i+3-1])&e.hash_mask,e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<262&&0!==e.strm.avail_in)}function v(e,t){for(var n,o;;){if(e.lookahead<262){if(_(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-262&&(e.match_length=b(e,n)),e.match_length>=3)if(o=s._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else o=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(o&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}function y(e,t){for(var n,o,r;;){if(e.lookahead<262){if(_(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-262&&(e.match_length=b(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-3,o=s._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=r&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,o&&(f(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((o=s._tr_tally(e,0,e.window[e.strstart-1]))&&f(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(o=s._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}function w(e,t,n,o,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=o,this.func=r}function k(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(1146),this.dyn_dtree=new r.Buf16(122),this.bl_tree=new r.Buf16(78),d(this.dyn_ltree),d(this.dyn_dtree),d(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(16),this.heap=new r.Buf16(573),d(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(573),d(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function C(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:113,e.adler=2===t.wrap?0:1,t.last_flush=0,s._tr_init(t),0):l(e,-2)}function S(e){var t,n=C(e);return 0===n&&((t=e.state).window_size=2*t.w_size,d(t.head),t.max_lazy_match=o[t.level].max_lazy,t.good_match=o[t.level].good_length,t.nice_match=o[t.level].nice_length,t.max_chain_length=o[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n}function E(e,t,n,o,s,i){if(!e)return-2;var a=1;if(-1===t&&(t=6),o<0?(a=0,o=-o):o>15&&(a=2,o-=16),s<1||s>9||8!==n||o<8||o>15||t<0||t>9||i<0||i>4)return l(e,-2);8===o&&(o=9);var c=new k;return e.state=c,c.strm=e,c.wrap=a,c.gzhead=null,c.w_bits=o,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=s+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+3-1)/3),c.window=new r.Buf8(2*c.w_size),c.head=new r.Buf16(c.hash_size),c.prev=new r.Buf16(c.w_size),c.lit_bufsize=1<<s+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new r.Buf8(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=t,c.strategy=i,c.method=n,S(e)}o=[new w(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(_(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var o=e.block_start+n;if((0===e.strstart||e.strstart>=o)&&(e.lookahead=e.strstart-o,e.strstart=o,f(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-262&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(f(e,!1),e.strm.avail_out),1)})),new w(4,4,8,4,v),new w(4,5,16,8,v),new w(4,6,32,32,v),new w(4,4,16,16,y),new w(8,16,32,32,y),new w(8,16,128,128,y),new w(8,32,128,256,y),new w(32,128,258,1024,y),new w(32,258,258,4096,y)],t.deflateInit=function(e,t){return E(e,t,8,15,8,0)},t.deflateInit2=E,t.deflateReset=S,t.deflateResetKeep=C,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?-2:(e.state.gzhead=t,0):-2},t.deflate=function(e,t){var n,r,i,c;if(!e||!e.state||t>5||t<0)return e?l(e,-2):-2;if(r=e.state,!e.output||!e.input&&0!==e.avail_in||666===r.status&&4!==t)return l(e,0===e.avail_out?-5:-2);if(r.strm=e,n=r.last_flush,r.last_flush=t,42===r.status)if(2===r.wrap)e.adler=0,p(r,31),p(r,139),p(r,8),r.gzhead?(p(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),p(r,255&r.gzhead.time),p(r,r.gzhead.time>>8&255),p(r,r.gzhead.time>>16&255),p(r,r.gzhead.time>>24&255),p(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),p(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(p(r,255&r.gzhead.extra.length),p(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=a(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(p(r,0),p(r,0),p(r,0),p(r,0),p(r,0),p(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),p(r,3),r.status=113);else{var g=8+(r.w_bits-8<<4)<<8;g|=(r.strategy>=2||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(g|=32),g+=31-g%31,r.status=113,m(r,g),0!==r.strstart&&(m(r,e.adler>>>16),m(r,65535&e.adler)),e.adler=1}if(69===r.status)if(r.gzhead.extra){for(i=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>i&&(e.adler=a(e.adler,r.pending_buf,r.pending-i,i)),h(e),i=r.pending,r.pending!==r.pending_buf_size));)p(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>i&&(e.adler=a(e.adler,r.pending_buf,r.pending-i,i)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){i=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>i&&(e.adler=a(e.adler,r.pending_buf,r.pending-i,i)),h(e),i=r.pending,r.pending===r.pending_buf_size)){c=1;break}c=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,p(r,c)}while(0!==c);r.gzhead.hcrc&&r.pending>i&&(e.adler=a(e.adler,r.pending_buf,r.pending-i,i)),0===c&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){i=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>i&&(e.adler=a(e.adler,r.pending_buf,r.pending-i,i)),h(e),i=r.pending,r.pending===r.pending_buf_size)){c=1;break}c=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,p(r,c)}while(0!==c);r.gzhead.hcrc&&r.pending>i&&(e.adler=a(e.adler,r.pending_buf,r.pending-i,i)),0===c&&(r.status=103)}else r.status=103;if(103===r.status&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&h(e),r.pending+2<=r.pending_buf_size&&(p(r,255&e.adler),p(r,e.adler>>8&255),e.adler=0,r.status=113)):r.status=113),0!==r.pending){if(h(e),0===e.avail_out)return r.last_flush=-1,0}else if(0===e.avail_in&&u(t)<=u(n)&&4!==t)return l(e,-5);if(666===r.status&&0!==e.avail_in)return l(e,-5);if(0!==e.avail_in||0!==r.lookahead||0!==t&&666!==r.status){var b=2===r.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(_(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}(r,t):3===r.strategy?function(e,t){for(var n,o,r,i,a=e.window;;){if(e.lookahead<=258){if(_(e),e.lookahead<=258&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(o=a[r=e.strstart-1])===a[++r]&&o===a[++r]&&o===a[++r]){i=e.strstart+258;do{}while(o===a[++r]&&o===a[++r]&&o===a[++r]&&o===a[++r]&&o===a[++r]&&o===a[++r]&&o===a[++r]&&o===a[++r]&&r<i);e.match_length=258-(i-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=s._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}(r,t):o[r.level].func(r,t);if(3!==b&&4!==b||(r.status=666),1===b||3===b)return 0===e.avail_out&&(r.last_flush=-1),0;if(2===b&&(1===t?s._tr_align(r):5!==t&&(s._tr_stored_block(r,0,0,!1),3===t&&(d(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),h(e),0===e.avail_out))return r.last_flush=-1,0}return 4!==t?0:r.wrap<=0?1:(2===r.wrap?(p(r,255&e.adler),p(r,e.adler>>8&255),p(r,e.adler>>16&255),p(r,e.adler>>24&255),p(r,255&e.total_in),p(r,e.total_in>>8&255),p(r,e.total_in>>16&255),p(r,e.total_in>>24&255)):(m(r,e.adler>>>16),m(r,65535&e.adler)),h(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?0:1)},t.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&103!==t&&113!==t&&666!==t?l(e,-2):(e.state=null,113===t?l(e,-3):0):-2},t.deflateSetDictionary=function(e,t){var n,o,s,a,c,l,u,h,f=t.length;if(!e||!e.state)return-2;if(2===(a=(n=e.state).wrap)||1===a&&42!==n.status||n.lookahead)return-2;for(1===a&&(e.adler=i(e.adler,t,f,0)),n.wrap=0,f>=n.w_size&&(0===a&&(d(n.head),n.strstart=0,n.block_start=0,n.insert=0),h=new r.Buf8(n.w_size),r.arraySet(h,t,f-n.w_size,n.w_size,0),t=h,f=n.w_size),c=e.avail_in,l=e.next_in,u=e.input,e.avail_in=f,e.next_in=0,e.input=t,_(n);n.lookahead>=3;){o=n.strstart,s=n.lookahead-2;do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[o+3-1])&n.hash_mask,n.prev[o&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=o,o++}while(--s);n.strstart=o,n.lookahead=2,_(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=l,e.input=u,e.avail_in=c,n.wrap=a,0},t.deflateInfo="pako deflate (from Nodeca project)"},"../node_modules/pako/lib/zlib/gzheader.js":function(e,t,n){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},"../node_modules/pako/lib/zlib/inffast.js":function(e,t,n){"use strict";e.exports=function(e,t){var n,o,r,s,i,a,c,l,u,d,h,f,p,m,g,b,_,v,y,w,k,C,S,E,T;n=e.state,o=e.next_in,E=e.input,r=o+(e.avail_in-5),s=e.next_out,T=e.output,i=s-(t-e.avail_out),a=s+(e.avail_out-257),c=n.dmax,l=n.wsize,u=n.whave,d=n.wnext,h=n.window,f=n.hold,p=n.bits,m=n.lencode,g=n.distcode,b=(1<<n.lenbits)-1,_=(1<<n.distbits)-1;e:do{p<15&&(f+=E[o++]<<p,p+=8,f+=E[o++]<<p,p+=8),v=m[f&b];t:for(;;){if(f>>>=y=v>>>24,p-=y,0===(y=v>>>16&255))T[s++]=65535&v;else{if(!(16&y)){if(0===(64&y)){v=m[(65535&v)+(f&(1<<y)-1)];continue t}if(32&y){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}w=65535&v,(y&=15)&&(p<y&&(f+=E[o++]<<p,p+=8),w+=f&(1<<y)-1,f>>>=y,p-=y),p<15&&(f+=E[o++]<<p,p+=8,f+=E[o++]<<p,p+=8),v=g[f&_];n:for(;;){if(f>>>=y=v>>>24,p-=y,!(16&(y=v>>>16&255))){if(0===(64&y)){v=g[(65535&v)+(f&(1<<y)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(k=65535&v,p<(y&=15)&&(f+=E[o++]<<p,(p+=8)<y&&(f+=E[o++]<<p,p+=8)),(k+=f&(1<<y)-1)>c){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=y,p-=y,k>(y=s-i)){if((y=k-y)>u&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(C=0,S=h,0===d){if(C+=l-y,y<w){w-=y;do{T[s++]=h[C++]}while(--y);C=s-k,S=T}}else if(d<y){if(C+=l+d-y,(y-=d)<w){w-=y;do{T[s++]=h[C++]}while(--y);if(C=0,d<w){w-=y=d;do{T[s++]=h[C++]}while(--y);C=s-k,S=T}}}else if(C+=d-y,y<w){w-=y;do{T[s++]=h[C++]}while(--y);C=s-k,S=T}for(;w>2;)T[s++]=S[C++],T[s++]=S[C++],T[s++]=S[C++],w-=3;w&&(T[s++]=S[C++],w>1&&(T[s++]=S[C++]))}else{C=s-k;do{T[s++]=T[C++],T[s++]=T[C++],T[s++]=T[C++],w-=3}while(w>2);w&&(T[s++]=T[C++],w>1&&(T[s++]=T[C++]))}break}}break}}while(o<r&&s<a);o-=w=p>>3,f&=(1<<(p-=w<<3))-1,e.next_in=o,e.next_out=s,e.avail_in=o<r?r-o+5:5-(o-r),e.avail_out=s<a?a-s+257:257-(s-a),n.hold=f,n.bits=p}},"../node_modules/pako/lib/zlib/inflate.js":function(e,t,n){"use strict";var o=n("../node_modules/pako/lib/utils/common.js"),r=n("../node_modules/pako/lib/zlib/adler32.js"),s=n("../node_modules/pako/lib/zlib/crc32.js"),i=n("../node_modules/pako/lib/zlib/inffast.js"),a=n("../node_modules/pako/lib/zlib/inftrees.js");function c(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function l(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function u(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new o.Buf32(852),t.distcode=t.distdyn=new o.Buf32(592),t.sane=1,t.back=-1,0):-2}function d(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,u(e)):-2}function h(e,t){var n,o;return e&&e.state?(o=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?-2:(null!==o.window&&o.wbits!==t&&(o.window=null),o.wrap=n,o.wbits=t,d(e))):-2}function f(e,t){var n,o;return e?(o=new l,e.state=o,o.window=null,0!==(n=h(e,t))&&(e.state=null),n):-2}var p,m,g=!0;function b(e){if(g){var t;for(p=new o.Buf32(512),m=new o.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(a(1,e.lens,0,288,p,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;a(2,e.lens,0,32,m,0,e.work,{bits:5}),g=!1}e.lencode=p,e.lenbits=9,e.distcode=m,e.distbits=5}function _(e,t,n,r){var s,i=e.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new o.Buf8(i.wsize)),r>=i.wsize?(o.arraySet(i.window,t,n-i.wsize,i.wsize,0),i.wnext=0,i.whave=i.wsize):((s=i.wsize-i.wnext)>r&&(s=r),o.arraySet(i.window,t,n-r,s,i.wnext),(r-=s)?(o.arraySet(i.window,t,n-r,r,0),i.wnext=r,i.whave=i.wsize):(i.wnext+=s,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=s))),0}t.inflateReset=d,t.inflateReset2=h,t.inflateResetKeep=u,t.inflateInit=function(e){return f(e,15)},t.inflateInit2=f,t.inflate=function(e,t){var n,l,u,d,h,f,p,m,g,v,y,w,k,C,S,E,T,O,j,x,R,D,I,N,A=0,M=new o.Buf8(4),P=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return-2;12===(n=e.state).mode&&(n.mode=13),h=e.next_out,u=e.output,p=e.avail_out,d=e.next_in,l=e.input,f=e.avail_in,m=n.hold,g=n.bits,v=f,y=p,D=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;g<16;){if(0===f)break e;f--,m+=l[d++]<<g,g+=8}if(2&n.wrap&&35615===m){n.check=0,M[0]=255&m,M[1]=m>>>8&255,n.check=s(n.check,M,2,0),m=0,g=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&m)<<8)+(m>>8))%31){e.msg="incorrect header check",n.mode=30;break}if(8!==(15&m)){e.msg="unknown compression method",n.mode=30;break}if(g-=4,R=8+(15&(m>>>=4)),0===n.wbits)n.wbits=R;else if(R>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<R,e.adler=n.check=1,n.mode=512&m?10:12,m=0,g=0;break;case 2:for(;g<16;){if(0===f)break e;f--,m+=l[d++]<<g,g+=8}if(n.flags=m,8!==(255&n.flags)){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=m>>8&1),512&n.flags&&(M[0]=255&m,M[1]=m>>>8&255,n.check=s(n.check,M,2,0)),m=0,g=0,n.mode=3;case 3:for(;g<32;){if(0===f)break e;f--,m+=l[d++]<<g,g+=8}n.head&&(n.head.time=m),512&n.flags&&(M[0]=255&m,M[1]=m>>>8&255,M[2]=m>>>16&255,M[3]=m>>>24&255,n.check=s(n.check,M,4,0)),m=0,g=0,n.mode=4;case 4:for(;g<16;){if(0===f)break e;f--,m+=l[d++]<<g,g+=8}n.head&&(n.head.xflags=255&m,n.head.os=m>>8),512&n.flags&&(M[0]=255&m,M[1]=m>>>8&255,n.check=s(n.check,M,2,0)),m=0,g=0,n.mode=5;case 5:if(1024&n.flags){for(;g<16;){if(0===f)break e;f--,m+=l[d++]<<g,g+=8}n.length=m,n.head&&(n.head.extra_len=m),512&n.flags&&(M[0]=255&m,M[1]=m>>>8&255,n.check=s(n.check,M,2,0)),m=0,g=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((w=n.length)>f&&(w=f),w&&(n.head&&(R=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),o.arraySet(n.head.extra,l,d,w,R)),512&n.flags&&(n.check=s(n.check,l,w,d)),f-=w,d+=w,n.length-=w),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===f)break e;w=0;do{R=l[d+w++],n.head&&R&&n.length<65536&&(n.head.name+=String.fromCharCode(R))}while(R&&w<f);if(512&n.flags&&(n.check=s(n.check,l,w,d)),f-=w,d+=w,R)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===f)break e;w=0;do{R=l[d+w++],n.head&&R&&n.length<65536&&(n.head.comment+=String.fromCharCode(R))}while(R&&w<f);if(512&n.flags&&(n.check=s(n.check,l,w,d)),f-=w,d+=w,R)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;g<16;){if(0===f)break e;f--,m+=l[d++]<<g,g+=8}if(m!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}m=0,g=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;g<32;){if(0===f)break e;f--,m+=l[d++]<<g,g+=8}e.adler=n.check=c(m),m=0,g=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=h,e.avail_out=p,e.next_in=d,e.avail_in=f,n.hold=m,n.bits=g,2;e.adler=n.check=1,n.mode=12;case 12:if(5===t||6===t)break e;case 13:if(n.last){m>>>=7&g,g-=7&g,n.mode=27;break}for(;g<3;){if(0===f)break e;f--,m+=l[d++]<<g,g+=8}switch(n.last=1&m,g-=1,3&(m>>>=1)){case 0:n.mode=14;break;case 1:if(b(n),n.mode=20,6===t){m>>>=2,g-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}m>>>=2,g-=2;break;case 14:for(m>>>=7&g,g-=7&g;g<32;){if(0===f)break e;f--,m+=l[d++]<<g,g+=8}if((65535&m)!==(m>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&m,m=0,g=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(w=n.length){if(w>f&&(w=f),w>p&&(w=p),0===w)break e;o.arraySet(u,l,d,w,h),f-=w,d+=w,p-=w,h+=w,n.length-=w;break}n.mode=12;break;case 17:for(;g<14;){if(0===f)break e;f--,m+=l[d++]<<g,g+=8}if(n.nlen=257+(31&m),m>>>=5,g-=5,n.ndist=1+(31&m),m>>>=5,g-=5,n.ncode=4+(15&m),m>>>=4,g-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;g<3;){if(0===f)break e;f--,m+=l[d++]<<g,g+=8}n.lens[P[n.have++]]=7&m,m>>>=3,g-=3}for(;n.have<19;)n.lens[P[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,I={bits:n.lenbits},D=a(0,n.lens,0,19,n.lencode,0,n.work,I),n.lenbits=I.bits,D){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;E=(A=n.lencode[m&(1<<n.lenbits)-1])>>>16&255,T=65535&A,!((S=A>>>24)<=g);){if(0===f)break e;f--,m+=l[d++]<<g,g+=8}if(T<16)m>>>=S,g-=S,n.lens[n.have++]=T;else{if(16===T){for(N=S+2;g<N;){if(0===f)break e;f--,m+=l[d++]<<g,g+=8}if(m>>>=S,g-=S,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}R=n.lens[n.have-1],w=3+(3&m),m>>>=2,g-=2}else if(17===T){for(N=S+3;g<N;){if(0===f)break e;f--,m+=l[d++]<<g,g+=8}g-=S,R=0,w=3+(7&(m>>>=S)),m>>>=3,g-=3}else{for(N=S+7;g<N;){if(0===f)break e;f--,m+=l[d++]<<g,g+=8}g-=S,R=0,w=11+(127&(m>>>=S)),m>>>=7,g-=7}if(n.have+w>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;w--;)n.lens[n.have++]=R}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,I={bits:n.lenbits},D=a(1,n.lens,0,n.nlen,n.lencode,0,n.work,I),n.lenbits=I.bits,D){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,I={bits:n.distbits},D=a(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,I),n.distbits=I.bits,D){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(f>=6&&p>=258){e.next_out=h,e.avail_out=p,e.next_in=d,e.avail_in=f,n.hold=m,n.bits=g,i(e,y),h=e.next_out,u=e.output,p=e.avail_out,d=e.next_in,l=e.input,f=e.avail_in,m=n.hold,g=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;E=(A=n.lencode[m&(1<<n.lenbits)-1])>>>16&255,T=65535&A,!((S=A>>>24)<=g);){if(0===f)break e;f--,m+=l[d++]<<g,g+=8}if(E&&0===(240&E)){for(O=S,j=E,x=T;E=(A=n.lencode[x+((m&(1<<O+j)-1)>>O)])>>>16&255,T=65535&A,!(O+(S=A>>>24)<=g);){if(0===f)break e;f--,m+=l[d++]<<g,g+=8}m>>>=O,g-=O,n.back+=O}if(m>>>=S,g-=S,n.back+=S,n.length=T,0===E){n.mode=26;break}if(32&E){n.back=-1,n.mode=12;break}if(64&E){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&E,n.mode=22;case 22:if(n.extra){for(N=n.extra;g<N;){if(0===f)break e;f--,m+=l[d++]<<g,g+=8}n.length+=m&(1<<n.extra)-1,m>>>=n.extra,g-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;E=(A=n.distcode[m&(1<<n.distbits)-1])>>>16&255,T=65535&A,!((S=A>>>24)<=g);){if(0===f)break e;f--,m+=l[d++]<<g,g+=8}if(0===(240&E)){for(O=S,j=E,x=T;E=(A=n.distcode[x+((m&(1<<O+j)-1)>>O)])>>>16&255,T=65535&A,!(O+(S=A>>>24)<=g);){if(0===f)break e;f--,m+=l[d++]<<g,g+=8}m>>>=O,g-=O,n.back+=O}if(m>>>=S,g-=S,n.back+=S,64&E){e.msg="invalid distance code",n.mode=30;break}n.offset=T,n.extra=15&E,n.mode=24;case 24:if(n.extra){for(N=n.extra;g<N;){if(0===f)break e;f--,m+=l[d++]<<g,g+=8}n.offset+=m&(1<<n.extra)-1,m>>>=n.extra,g-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===p)break e;if(w=y-p,n.offset>w){if((w=n.offset-w)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}w>n.wnext?(w-=n.wnext,k=n.wsize-w):k=n.wnext-w,w>n.length&&(w=n.length),C=n.window}else C=u,k=h-n.offset,w=n.length;w>p&&(w=p),p-=w,n.length-=w;do{u[h++]=C[k++]}while(--w);0===n.length&&(n.mode=21);break;case 26:if(0===p)break e;u[h++]=n.length,p--,n.mode=21;break;case 27:if(n.wrap){for(;g<32;){if(0===f)break e;f--,m|=l[d++]<<g,g+=8}if(y-=p,e.total_out+=y,n.total+=y,y&&(e.adler=n.check=n.flags?s(n.check,u,y,h-y):r(n.check,u,y,h-y)),y=p,(n.flags?m:c(m))!==n.check){e.msg="incorrect data check",n.mode=30;break}m=0,g=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;g<32;){if(0===f)break e;f--,m+=l[d++]<<g,g+=8}if(m!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}m=0,g=0}n.mode=29;case 29:D=1;break e;case 30:D=-3;break e;case 31:return-4;case 32:default:return-2}return e.next_out=h,e.avail_out=p,e.next_in=d,e.avail_in=f,n.hold=m,n.bits=g,(n.wsize||y!==e.avail_out&&n.mode<30&&(n.mode<27||4!==t))&&_(e,e.output,e.next_out,y-e.avail_out)?(n.mode=31,-4):(v-=e.avail_in,y-=e.avail_out,e.total_in+=v,e.total_out+=y,n.total+=y,n.wrap&&y&&(e.adler=n.check=n.flags?s(n.check,u,y,e.next_out-y):r(n.check,u,y,e.next_out-y)),e.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0===v&&0===y||4===t)&&0===D&&(D=-5),D)},t.inflateEnd=function(e){if(!e||!e.state)return-2;var t=e.state;return t.window&&(t.window=null),e.state=null,0},t.inflateGetHeader=function(e,t){var n;return e&&e.state?0===(2&(n=e.state).wrap)?-2:(n.head=t,t.done=!1,0):-2},t.inflateSetDictionary=function(e,t){var n,o=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?-2:11===n.mode&&r(1,t,o,0)!==n.check?-3:_(e,t,o,o)?(n.mode=31,-4):(n.havedict=1,0):-2},t.inflateInfo="pako inflate (from Nodeca project)"},"../node_modules/pako/lib/zlib/inftrees.js":function(e,t,n){"use strict";var o=n("../node_modules/pako/lib/utils/common.js"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],i=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],a=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,c,l,u,d,h){var f,p,m,g,b,_,v,y,w,k=h.bits,C=0,S=0,E=0,T=0,O=0,j=0,x=0,R=0,D=0,I=0,N=null,A=0,M=new o.Buf16(16),P=new o.Buf16(16),L=null,B=0;for(C=0;C<=15;C++)M[C]=0;for(S=0;S<c;S++)M[t[n+S]]++;for(O=k,T=15;T>=1&&0===M[T];T--);if(O>T&&(O=T),0===T)return l[u++]=20971520,l[u++]=20971520,h.bits=1,0;for(E=1;E<T&&0===M[E];E++);for(O<E&&(O=E),R=1,C=1;C<=15;C++)if(R<<=1,(R-=M[C])<0)return-1;if(R>0&&(0===e||1!==T))return-1;for(P[1]=0,C=1;C<15;C++)P[C+1]=P[C]+M[C];for(S=0;S<c;S++)0!==t[n+S]&&(d[P[t[n+S]]++]=S);if(0===e?(N=L=d,_=19):1===e?(N=r,A-=257,L=s,B-=257,_=256):(N=i,L=a,_=-1),I=0,S=0,C=E,b=u,j=O,x=0,m=-1,g=(D=1<<O)-1,1===e&&D>852||2===e&&D>592)return 1;for(;;){v=C-x,d[S]<_?(y=0,w=d[S]):d[S]>_?(y=L[B+d[S]],w=N[A+d[S]]):(y=96,w=0),f=1<<C-x,E=p=1<<j;do{l[b+(I>>x)+(p-=f)]=v<<24|y<<16|w|0}while(0!==p);for(f=1<<C-1;I&f;)f>>=1;if(0!==f?(I&=f-1,I+=f):I=0,S++,0===--M[C]){if(C===T)break;C=t[n+d[S]]}if(C>O&&(I&g)!==m){for(0===x&&(x=O),b+=E,R=1<<(j=C-x);j+x<T&&!((R-=M[j+x])<=0);)j++,R<<=1;if(D+=1<<j,1===e&&D>852||2===e&&D>592)return 1;l[m=I&g]=O<<24|j<<16|b-u|0}}return 0!==I&&(l[b+I]=C-x<<24|64<<16|0),h.bits=O,0}},"../node_modules/pako/lib/zlib/messages.js":function(e,t,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},"../node_modules/pako/lib/zlib/trees.js":function(e,t,n){"use strict";var o=n("../node_modules/pako/lib/utils/common.js");function r(e){for(var t=e.length;--t>=0;)e[t]=0}var s=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],i=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],c=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],l=new Array(576);r(l);var u=new Array(60);r(u);var d=new Array(512);r(d);var h=new Array(256);r(h);var f=new Array(29);r(f);var p,m,g,b=new Array(30);function _(e,t,n,o,r){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=o,this.max_length=r,this.has_stree=e&&e.length}function v(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function y(e){return e<256?d[e]:d[256+(e>>>7)]}function w(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function k(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,w(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function C(e,t,n){k(e,n[2*t],n[2*t+1])}function S(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function E(e,t,n){var o,r,s=new Array(16),i=0;for(o=1;o<=15;o++)s[o]=i=i+n[o-1]<<1;for(r=0;r<=t;r++){var a=e[2*r+1];0!==a&&(e[2*r]=S(s[a]++,a))}}function T(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function O(e){e.bi_valid>8?w(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function j(e,t,n,o){var r=2*t,s=2*n;return e[r]<e[s]||e[r]===e[s]&&o[t]<=o[n]}function x(e,t,n){for(var o=e.heap[n],r=n<<1;r<=e.heap_len&&(r<e.heap_len&&j(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!j(t,o,e.heap[r],e.depth));)e.heap[n]=e.heap[r],n=r,r<<=1;e.heap[n]=o}function R(e,t,n){var o,r,a,c,l=0;if(0!==e.last_lit)do{o=e.pending_buf[e.d_buf+2*l]<<8|e.pending_buf[e.d_buf+2*l+1],r=e.pending_buf[e.l_buf+l],l++,0===o?C(e,r,t):(C(e,(a=h[r])+256+1,t),0!==(c=s[a])&&k(e,r-=f[a],c),C(e,a=y(--o),n),0!==(c=i[a])&&k(e,o-=b[a],c))}while(l<e.last_lit);C(e,256,t)}function D(e,t){var n,o,r,s=t.dyn_tree,i=t.stat_desc.static_tree,a=t.stat_desc.has_stree,c=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<c;n++)0!==s[2*n]?(e.heap[++e.heap_len]=l=n,e.depth[n]=0):s[2*n+1]=0;for(;e.heap_len<2;)s[2*(r=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[r]=0,e.opt_len--,a&&(e.static_len-=i[2*r+1]);for(t.max_code=l,n=e.heap_len>>1;n>=1;n--)x(e,s,n);r=c;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],x(e,s,1),o=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=o,s[2*r]=s[2*n]+s[2*o],e.depth[r]=(e.depth[n]>=e.depth[o]?e.depth[n]:e.depth[o])+1,s[2*n+1]=s[2*o+1]=r,e.heap[1]=r++,x(e,s,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,o,r,s,i,a,c=t.dyn_tree,l=t.max_code,u=t.stat_desc.static_tree,d=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(s=0;s<=15;s++)e.bl_count[s]=0;for(c[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(s=c[2*c[2*(o=e.heap[n])+1]+1]+1)>p&&(s=p,m++),c[2*o+1]=s,o>l||(e.bl_count[s]++,i=0,o>=f&&(i=h[o-f]),a=c[2*o],e.opt_len+=a*(s+i),d&&(e.static_len+=a*(u[2*o+1]+i)));if(0!==m){do{for(s=p-1;0===e.bl_count[s];)s--;e.bl_count[s]--,e.bl_count[s+1]+=2,e.bl_count[p]--,m-=2}while(m>0);for(s=p;0!==s;s--)for(o=e.bl_count[s];0!==o;)(r=e.heap[--n])>l||(c[2*r+1]!==s&&(e.opt_len+=(s-c[2*r+1])*c[2*r],c[2*r+1]=s),o--)}}(e,t),E(s,l,e.bl_count)}function I(e,t,n){var o,r,s=-1,i=t[1],a=0,c=7,l=4;for(0===i&&(c=138,l=3),t[2*(n+1)+1]=65535,o=0;o<=n;o++)r=i,i=t[2*(o+1)+1],++a<c&&r===i||(a<l?e.bl_tree[2*r]+=a:0!==r?(r!==s&&e.bl_tree[2*r]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,a=0,s=r,0===i?(c=138,l=3):r===i?(c=6,l=3):(c=7,l=4))}function N(e,t,n){var o,r,s=-1,i=t[1],a=0,c=7,l=4;for(0===i&&(c=138,l=3),o=0;o<=n;o++)if(r=i,i=t[2*(o+1)+1],!(++a<c&&r===i)){if(a<l)do{C(e,r,e.bl_tree)}while(0!==--a);else 0!==r?(r!==s&&(C(e,r,e.bl_tree),a--),C(e,16,e.bl_tree),k(e,a-3,2)):a<=10?(C(e,17,e.bl_tree),k(e,a-3,3)):(C(e,18,e.bl_tree),k(e,a-11,7));a=0,s=r,0===i?(c=138,l=3):r===i?(c=6,l=3):(c=7,l=4)}}r(b);var A=!1;function M(e,t,n,r){k(e,0+(r?1:0),3),function(e,t,n,r){O(e),r&&(w(e,n),w(e,~n)),o.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n,!0)}t._tr_init=function(e){A||(!function(){var e,t,n,o,r,c=new Array(16);for(n=0,o=0;o<28;o++)for(f[o]=n,e=0;e<1<<s[o];e++)h[n++]=o;for(h[n-1]=o,r=0,o=0;o<16;o++)for(b[o]=r,e=0;e<1<<i[o];e++)d[r++]=o;for(r>>=7;o<30;o++)for(b[o]=r<<7,e=0;e<1<<i[o]-7;e++)d[256+r++]=o;for(t=0;t<=15;t++)c[t]=0;for(e=0;e<=143;)l[2*e+1]=8,e++,c[8]++;for(;e<=255;)l[2*e+1]=9,e++,c[9]++;for(;e<=279;)l[2*e+1]=7,e++,c[7]++;for(;e<=287;)l[2*e+1]=8,e++,c[8]++;for(E(l,287,c),e=0;e<30;e++)u[2*e+1]=5,u[2*e]=S(e,5);p=new _(l,s,257,286,15),m=new _(u,i,0,30,15),g=new _(new Array(0),a,0,19,7)}(),A=!0),e.l_desc=new v(e.dyn_ltree,p),e.d_desc=new v(e.dyn_dtree,m),e.bl_desc=new v(e.bl_tree,g),e.bi_buf=0,e.bi_valid=0,T(e)},t._tr_stored_block=M,t._tr_flush_block=function(e,t,n,o){var r,s,i=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),D(e,e.l_desc),D(e,e.d_desc),i=function(e){var t;for(I(e,e.dyn_ltree,e.l_desc.max_code),I(e,e.dyn_dtree,e.d_desc.max_code),D(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*c[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),r=e.opt_len+3+7>>>3,(s=e.static_len+3+7>>>3)<=r&&(r=s)):r=s=n+5,n+4<=r&&-1!==t?M(e,t,n,o):4===e.strategy||s===r?(k(e,2+(o?1:0),3),R(e,l,u)):(k(e,4+(o?1:0),3),function(e,t,n,o){var r;for(k(e,t-257,5),k(e,n-1,5),k(e,o-4,4),r=0;r<o;r++)k(e,e.bl_tree[2*c[r]+1],3);N(e,e.dyn_ltree,t-1),N(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,i+1),R(e,e.dyn_ltree,e.dyn_dtree)),T(e),o&&O(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(h[n]+256+1)]++,e.dyn_dtree[2*y(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){k(e,2,3),C(e,256,l),function(e){16===e.bi_valid?(w(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},"../node_modules/pako/lib/zlib/zstream.js":function(e,t,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},"../node_modules/parseqs/index.js":function(e,t){t.encode=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},t.decode=function(e){for(var t={},n=e.split("&"),o=0,r=n.length;o<r;o++){var s=n[o].split("=");t[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return t}},"../node_modules/parseuri/index.js":function(e,t){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,o=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var t=e,r=e.indexOf("["),s=e.indexOf("]");-1!=r&&-1!=s&&(e=e.substring(0,r)+e.substring(r,s).replace(/:/g,";")+e.substring(s,e.length));for(var i=n.exec(e||""),a={},c=14;c--;)a[o[c]]=i[c]||"";return-1!=r&&-1!=s&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=function(e,t){var n=t.replace(/\/{2,9}/g,"/").split("/");"/"!=t.substr(0,1)&&0!==t.length||n.splice(0,1);"/"==t.substr(t.length-1,1)&&n.splice(n.length-1,1);return n}(0,a.path),a.queryKey=function(e,t){var n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,o){t&&(n[t]=o)})),n}(0,a.query),a}},"../node_modules/socket.io-client/lib/index.js":function(e,t,n){var o=n("../node_modules/socket.io-client/lib/url.js"),r=n("../node_modules/socket.io-parser/index.js"),s=n("../node_modules/socket.io-client/lib/manager.js"),i=n("../node_modules/debug/src/browser.js")("socket.io-client");e.exports=t=c;var a=t.managers={};function c(e,t){"object"===typeof e&&(t=e,e=void 0),t=t||{};var n,r=o(e),c=r.source,l=r.id,u=r.path,d=a[l]&&u in a[l].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||d?(i("ignoring socket cache for %s",c),n=s(c,t)):(a[l]||(i("new io instance for %s",c),a[l]=s(c,t)),n=a[l]),r.query&&!t.query&&(t.query=r.query),n.socket(r.path,t)}t.protocol=r.protocol,t.connect=c,t.Manager=n("../node_modules/socket.io-client/lib/manager.js"),t.Socket=n("../node_modules/socket.io-client/lib/socket.js")},"../node_modules/socket.io-client/lib/manager.js":function(e,t,n){var o=n("../node_modules/engine.io-client/lib/index.js"),r=n("../node_modules/socket.io-client/lib/socket.js"),s=n("../node_modules/component-emitter/index.js"),i=n("../node_modules/socket.io-parser/index.js"),a=n("../node_modules/socket.io-client/lib/on.js"),c=n("../node_modules/component-bind/index.js"),l=n("../node_modules/debug/src/browser.js")("socket.io-client:manager"),u=n("../node_modules/indexof/index.js"),d=n("../node_modules/backo2/index.js"),h=Object.prototype.hasOwnProperty;function f(e,t){if(!(this instanceof f))return new f(e,t);e&&"object"===typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new d({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=t.parser||i;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}e.exports=f,f.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)h.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},f.prototype.updateSocketIds=function(){for(var e in this.nsps)h.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},f.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},s(f.prototype),f.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},f.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},f.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},f.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},f.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},f.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},f.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},f.prototype.open=f.prototype.connect=function(e,t){if(l("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;l("opening %s",this.uri),this.engine=o(this.uri,this.opts);var n=this.engine,r=this;this.readyState="opening",this.skipReconnect=!1;var s=a(n,"open",(function(){r.onopen(),e&&e()})),i=a(n,"error",(function(t){if(l("connect_error"),r.cleanup(),r.readyState="closed",r.emitAll("connect_error",t),e){var n=new Error("Connection error");n.data=t,e(n)}else r.maybeReconnectOnOpen()}));if(!1!==this._timeout){var c=this._timeout;l("connect attempt will timeout after %d",c),0===c&&s.destroy();var u=setTimeout((function(){l("connect attempt timed out after %d",c),s.destroy(),n.close(),n.emit("error","timeout"),r.emitAll("connect_timeout",c)}),c);this.subs.push({destroy:function(){clearTimeout(u)}})}return this.subs.push(s),this.subs.push(i),this},f.prototype.onopen=function(){l("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(a(e,"data",c(this,"ondata"))),this.subs.push(a(e,"ping",c(this,"onping"))),this.subs.push(a(e,"pong",c(this,"onpong"))),this.subs.push(a(e,"error",c(this,"onerror"))),this.subs.push(a(e,"close",c(this,"onclose"))),this.subs.push(a(this.decoder,"decoded",c(this,"ondecoded")))},f.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},f.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},f.prototype.ondata=function(e){this.decoder.add(e)},f.prototype.ondecoded=function(e){this.emit("packet",e)},f.prototype.onerror=function(e){l("error",e),this.emitAll("error",e)},f.prototype.socket=function(e,t){var n=this.nsps[e];if(!n){n=new r(this,e,t),this.nsps[e]=n;var o=this;n.on("connecting",s),n.on("connect",(function(){n.id=o.generateId(e)})),this.autoConnect&&s()}function s(){~u(o.connecting,n)||o.connecting.push(n)}return n},f.prototype.destroy=function(e){var t=u(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},f.prototype.packet=function(e){l("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,(function(n){for(var o=0;o<n.length;o++)t.engine.write(n[o],e.options);t.encoding=!1,t.processPacketQueue()})))},f.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},f.prototype.cleanup=function(){l("cleanup");for(var e=this.subs.length,t=0;t<e;t++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},f.prototype.close=f.prototype.disconnect=function(){l("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},f.prototype.onclose=function(e){l("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},f.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)l("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();l("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var n=setTimeout((function(){e.skipReconnect||(l("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open((function(t){t?(l("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(l("reconnect success"),e.onreconnect())})))}),t);this.subs.push({destroy:function(){clearTimeout(n)}})}},f.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},"../node_modules/socket.io-client/lib/on.js":function(e,t){e.exports=function(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}}},"../node_modules/socket.io-client/lib/socket.js":function(e,t,n){var o=n("../node_modules/socket.io-parser/index.js"),r=n("../node_modules/component-emitter/index.js"),s=n("../node_modules/to-array/index.js"),i=n("../node_modules/socket.io-client/lib/on.js"),a=n("../node_modules/component-bind/index.js"),c=n("../node_modules/debug/src/browser.js")("socket.io-client:socket"),l=n("../node_modules/parseqs/index.js"),u=n("../node_modules/has-binary2/index.js");e.exports=f;var d={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},h=r.prototype.emit;function f(e,t,n){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}r(f.prototype),f.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[i(e,"open",a(this,"onopen")),i(e,"packet",a(this,"onpacket")),i(e,"close",a(this,"onclose"))]}},f.prototype.open=f.prototype.connect=function(){return this.connected||(this.subEvents(),this.io.reconnecting||this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting")),this},f.prototype.send=function(){var e=s(arguments);return e.unshift("message"),this.emit.apply(this,e),this},f.prototype.emit=function(e){if(d.hasOwnProperty(e))return h.apply(this,arguments),this;var t=s(arguments),n={type:(void 0!==this.flags.binary?this.flags.binary:u(t))?o.BINARY_EVENT:o.EVENT,data:t,options:{}};return n.options.compress=!this.flags||!1!==this.flags.compress,"function"===typeof t[t.length-1]&&(c("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),n.id=this.ids++),this.connected?this.packet(n):this.sendBuffer.push(n),this.flags={},this},f.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},f.prototype.onopen=function(){if(c("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"===typeof this.query?l.encode(this.query):this.query;c("sending connect packet with query %s",e),this.packet({type:o.CONNECT,query:e})}else this.packet({type:o.CONNECT})},f.prototype.onclose=function(e){c("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},f.prototype.onpacket=function(e){var t=e.nsp===this.nsp,n=e.type===o.ERROR&&"/"===e.nsp;if(t||n)switch(e.type){case o.CONNECT:this.onconnect();break;case o.EVENT:case o.BINARY_EVENT:this.onevent(e);break;case o.ACK:case o.BINARY_ACK:this.onack(e);break;case o.DISCONNECT:this.ondisconnect();break;case o.ERROR:this.emit("error",e.data)}},f.prototype.onevent=function(e){var t=e.data||[];c("emitting event %j",t),null!=e.id&&(c("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?h.apply(this,t):this.receiveBuffer.push(t)},f.prototype.ack=function(e){var t=this,n=!1;return function(){if(!n){n=!0;var r=s(arguments);c("sending ack %j",r),t.packet({type:u(r)?o.BINARY_ACK:o.ACK,id:e,data:r})}}},f.prototype.onack=function(e){var t=this.acks[e.id];"function"===typeof t?(c("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):c("bad ack %s",e.id)},f.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},f.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)h.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},f.prototype.ondisconnect=function(){c("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},f.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},f.prototype.close=f.prototype.disconnect=function(){return this.connected&&(c("performing disconnect (%s)",this.nsp),this.packet({type:o.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},f.prototype.compress=function(e){return this.flags.compress=e,this},f.prototype.binary=function(e){return this.flags.binary=e,this}},"../node_modules/socket.io-client/lib/url.js":function(e,t,n){var o=n("../node_modules/parseuri/index.js"),r=n("../node_modules/debug/src/browser.js")("socket.io-client:url");e.exports=function(e,t){var n=e;t=t||"undefined"!==typeof location&&location,null==e&&(e=t.protocol+"//"+t.host);"string"===typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(r("protocol-less url %s",e),e="undefined"!==typeof t?t.protocol+"//"+e:"https://"+e),r("parse %s",e),n=o(e));n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443"));n.path=n.path||"/";var s=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+s+":"+n.port,n.href=n.protocol+"://"+s+(t&&t.port===n.port?"":":"+n.port),n}},"../node_modules/socket.io-parser/binary.js":function(e,t,n){var o=n("../node_modules/isarray/index.js"),r=n("../node_modules/socket.io-parser/is-buffer.js"),s=Object.prototype.toString,i="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===s.call(Blob),a="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===s.call(File);t.deconstructPacket=function(e){var t=[],n=e.data,s=e;return s.data=function e(t,n){if(!t)return t;if(r(t)){var s={_placeholder:!0,num:n.length};return n.push(t),s}if(o(t)){for(var i=new Array(t.length),a=0;a<t.length;a++)i[a]=e(t[a],n);return i}if("object"===typeof t&&!(t instanceof Date)){i={};for(var c in t)i[c]=e(t[c],n);return i}return t}(n,t),s.attachments=t.length,{packet:s,buffers:t}},t.reconstructPacket=function(e,t){return e.data=function e(t,n){if(!t)return t;if(t&&t._placeholder)return n[t.num];if(o(t))for(var r=0;r<t.length;r++)t[r]=e(t[r],n);else if("object"===typeof t)for(var s in t)t[s]=e(t[s],n);return t}(e.data,t),e.attachments=void 0,e},t.removeBlobs=function(e,t){var n=0,s=e;!function e(c,l,u){if(!c)return c;if(i&&c instanceof Blob||a&&c instanceof File){n++;var d=new FileReader;d.onload=function(){u?u[l]=this.result:s=this.result,--n||t(s)},d.readAsArrayBuffer(c)}else if(o(c))for(var h=0;h<c.length;h++)e(c[h],h,c);else if("object"===typeof c&&!r(c))for(var f in c)e(c[f],f,c)}(s),n||t(s)}},"../node_modules/socket.io-parser/index.js":function(e,t,n){var o=n("../node_modules/debug/src/browser.js")("socket.io-parser"),r=n("../node_modules/component-emitter/index.js"),s=n("../node_modules/socket.io-parser/binary.js"),i=n("../node_modules/isarray/index.js"),a=n("../node_modules/socket.io-parser/is-buffer.js");function c(){}t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=c,t.Decoder=d;var l=t.ERROR+'"encode error"';function u(e){var n=""+e.type;if(t.BINARY_EVENT!==e.type&&t.BINARY_ACK!==e.type||(n+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(n+=e.nsp+","),null!=e.id&&(n+=e.id),null!=e.data){var r=function(e){try{return JSON.stringify(e)}catch(t){return!1}}(e.data);if(!1===r)return l;n+=r}return o("encoded %j as %s",e,n),n}function d(){this.reconstructor=null}function h(e){this.reconPack=e,this.buffers=[]}function f(e){return{type:t.ERROR,data:"parser error: "+e}}c.prototype.encode=function(e,n){(o("encoding packet %j",e),t.BINARY_EVENT===e.type||t.BINARY_ACK===e.type)?function(e,t){s.removeBlobs(e,(function(e){var n=s.deconstructPacket(e),o=u(n.packet),r=n.buffers;r.unshift(o),t(r)}))}(e,n):n([u(e)])},r(d.prototype),d.prototype.add=function(e){var n;if("string"===typeof e)n=function(e){var n=0,r={type:Number(e.charAt(0))};if(null==t.types[r.type])return f("unknown packet type "+r.type);if(t.BINARY_EVENT===r.type||t.BINARY_ACK===r.type){for(var s="";"-"!==e.charAt(++n)&&(s+=e.charAt(n),n!=e.length););if(s!=Number(s)||"-"!==e.charAt(n))throw new Error("Illegal attachments");r.attachments=Number(s)}if("/"===e.charAt(n+1))for(r.nsp="";++n;){if(","===(c=e.charAt(n)))break;if(r.nsp+=c,n===e.length)break}else r.nsp="/";var a=e.charAt(n+1);if(""!==a&&Number(a)==a){for(r.id="";++n;){var c;if(null==(c=e.charAt(n))||Number(c)!=c){--n;break}if(r.id+=e.charAt(n),n===e.length)break}r.id=Number(r.id)}if(e.charAt(++n)){var l=function(e){try{return JSON.parse(e)}catch(t){return!1}}(e.substr(n));if(!(!1!==l&&(r.type===t.ERROR||i(l))))return f("invalid payload");r.data=l}return o("decoded %s as %j",e,r),r}(e),t.BINARY_EVENT===n.type||t.BINARY_ACK===n.type?(this.reconstructor=new h(n),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",n)):this.emit("decoded",n);else{if(!a(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(n=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",n))}},d.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},h.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=s.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},h.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},"../node_modules/socket.io-parser/is-buffer.js":function(e,t,n){(function(t){e.exports=function(e){return n&&t.isBuffer(e)||o&&(e instanceof ArrayBuffer||function(e){return"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer}(e))};var n="function"===typeof t&&"function"===typeof t.isBuffer,o="function"===typeof ArrayBuffer}).call(this,n("../node_modules/buffer/index.js").Buffer)},"../node_modules/to-array/index.js":function(e,t){e.exports=function(e,t){for(var n=[],o=(t=t||0)||0;o<e.length;o++)n[o-t]=e[o];return n}},"../node_modules/yeast/index.js":function(e,t,n){"use strict";var o,r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),s={},i=0,a=0;function c(e){var t="";do{t=r[e%64]+t,e=Math.floor(e/64)}while(e>0);return t}function l(){var e=c(+new Date);return e!==o?(i=0,o=e):e+"."+c(i++)}for(;a<64;a++)s[r[a]]=a;l.encode=c,l.decode=function(e){var t=0;for(a=0;a<e.length;a++)t=64*t+s[e.charAt(a)];return t},e.exports=l},"./src/core/app/lazytool/index.ts":function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"createDataKeyframeStr",(function(){return l})),n.d(t,"createZipKeyframe",(function(){return u})),n.d(t,"getKeyframe",(function(){return d})),n.d(t,"createSheetWithKeyframe",(function(){return h}));n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js");var o=n("../packages/report/src/index.ts"),r=n("./src/base/config/version.ts"),s=n("./src/base/event/event.ts"),i=n("./src/base/config/report.ts"),a=n("./src/core/data/converter/tencentdoc/keyframeToSheetConverter.ts"),c=n("./src/core/data/converter/keyframe/zip.ts");function l(t){var n;t=t||e.SpreadsheetApp.spreadsheet.activeSheetId;var s=e.SpreadsheetApp.spreadsheet.sheetManager.getSheetBySheetId(t);return(null===s||void 0===s?void 0:s.isLoaded)?(n=JSON.stringify(s.serialize()),function(e){try{if(!e)return;for(var t=e.data.rowData,n=!1,r=0,s=t.length;r<s&&!n;r++){var i=t[r];if(i&&i.values)for(var a=0,c=i.values.length;a<c;a++){var l=i.values[a];if(l){var u=l.getFormula();if(u){var d=u.getParts();if(d&&0===d.length){o.b.monitor(33613232),n=!0;break}}}}}}catch(h){}}(s),{type:"k",k:n,startRow:0,startCol:0,ver:r.a.KEYFRAME_VER,sheetId:t}):null}function u(t){console.error("createZipKeyframe \u5df2\u7ecf\u5e9f\u5f03, \u8bf7\u4f7f\u7528 createKeyframe \u4ee3\u66ff."),o.b.jank.stopReport(),o.b.jank.log({moduleValue:"keyframe",actionValue:"createKeyframe"}),o.b.jank.restartReport();var n=l(t);if(!n){o.b.monitor(33711501);var r=e.SpreadsheetApp.spreadsheet.sheetManager.getSheetBySheetId(t);return o.b.run(i.CONFIG.CREATE_ZIPKETFRAME,[t,null===r||void 0===r?void 0:r.isFetching,null===r||void 0===r?void 0:r.isLoaded]),null}var s=Object(c.c)(n);return s||JSON.stringify([n])}function d(){var e,t,n=null===(e=clientVars.collab_client_vars)||void 0===e||null===(t=e.initialAttributedText)||void 0===t?void 0:t.text;return n?n=JSON.stringify(n):(console.error("\u83b7\u53d6\u4e0d\u5230\u5b50\u8868 keyframe."),"")}function h(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"BB08J2",o=e.SpreadsheetApp,r=o.spreadsheet.sheetManager.getSheetBySheetId(n);r?(o.spreadsheet.sheetManager.reInitSheetBySheetId(n),r=o.spreadsheet.sheetManager.getSheetBySheetId(n)):(r=o.spreadsheet.sheetManager.createSheet({id:n,name:n}),o.spreadsheet.sheetManager.insertSheet(r)),o.getCurrentMainThreadWorker().sheetData.clearAndReInitOneSheet({sheetId:n}),o.calcController.resetSheet(n),Object(a.a)(o.spreadsheet,n,JSON.parse(t));for(var i=r.getRowCount(),c=r.getColCount(),l=0;l<i;l++)for(var u=0;u<c;u++)o.spreadsheet.autoUpdateCellData(n,l,u);r.isLoaded=!0,o.spreadsheet.activeSheetId=n,s.c.sheetsBar.trigger("switchSheet",n),o.getCurrentMainThreadWorker().loadSheetToWorkerIfNeeded(n)}}.call(this,n("../node_modules/webpack/buildin/global.js"))},"./src/core/data/converter/keyframe/zip.ts":function(e,t,n){"use strict";n.d(t,"c",(function(){return c})),n.d(t,"b",(function(){return u})),n.d(t,"a",(function(){return h}));n("../node_modules/core-js/modules/es.array.concat.js"),n("../node_modules/core-js/modules/es.array.for-each.js"),n("../node_modules/core-js/modules/es.array.index-of.js"),n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/es.array.join.js"),n("../node_modules/core-js/modules/es.array.map.js"),n("../node_modules/core-js/modules/es.array.slice.js"),n("../node_modules/core-js/modules/es.array-buffer.slice.js"),n("../node_modules/core-js/modules/es.object.get-own-property-names.js"),n("../node_modules/core-js/modules/es.object.keys.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.regexp.constructor.js"),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js"),n("../node_modules/core-js/modules/es.string.match.js"),n("../node_modules/core-js/modules/es.string.split.js"),n("../node_modules/core-js/modules/es.typed-array.uint8-array.js"),n("../node_modules/core-js/modules/es.typed-array.copy-within.js"),n("../node_modules/core-js/modules/es.typed-array.every.js"),n("../node_modules/core-js/modules/es.typed-array.fill.js"),n("../node_modules/core-js/modules/es.typed-array.filter.js"),n("../node_modules/core-js/modules/es.typed-array.find.js"),n("../node_modules/core-js/modules/es.typed-array.find-index.js"),n("../node_modules/core-js/modules/es.typed-array.for-each.js"),n("../node_modules/core-js/modules/es.typed-array.includes.js"),n("../node_modules/core-js/modules/es.typed-array.index-of.js"),n("../node_modules/core-js/modules/es.typed-array.iterator.js"),n("../node_modules/core-js/modules/es.typed-array.join.js"),n("../node_modules/core-js/modules/es.typed-array.last-index-of.js"),n("../node_modules/core-js/modules/es.typed-array.map.js"),n("../node_modules/core-js/modules/es.typed-array.reduce.js"),n("../node_modules/core-js/modules/es.typed-array.reduce-right.js"),n("../node_modules/core-js/modules/es.typed-array.reverse.js"),n("../node_modules/core-js/modules/es.typed-array.set.js"),n("../node_modules/core-js/modules/es.typed-array.slice.js"),n("../node_modules/core-js/modules/es.typed-array.some.js"),n("../node_modules/core-js/modules/es.typed-array.sort.js"),n("../node_modules/core-js/modules/es.typed-array.subarray.js"),n("../node_modules/core-js/modules/es.typed-array.to-locale-string.js"),n("../node_modules/core-js/modules/es.typed-array.to-string.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js");var o=n("../node_modules/@babel/runtime/helpers/esm/typeof.js"),r=n("../node_modules/pako/index.js"),s=n.n(r),i=(n("../node_modules/atob/browser-atob.js"),n("../packages/report/src/index.ts")),a=n("./src/base/config/report.ts");function c(e){var t="";try{!function(e){if(!e||!e.k)return;var t,n=e.k.st,o=e.k.s;if("set"===n){var r,s=0,i=0;try{i=l(JSON.stringify(o)).length}catch(a){r=f(o),n="z",t=r}r||(r=f(o),s=l(JSON.stringify(r)).length,.9*i>s?(n="z",t=r):(n="set",t=o)),e.k.st=n,e.k.s=t}}(e);var n=JSON.stringify([e]),o=s.a.deflate(n);if(o){var r={type:"k",z:u(o)};t=JSON.stringify([r])}else i.b.run(a.CONFIG.ZIP_KEYFRAME)}catch(c){i.b.run(a.CONFIG.ZIP_KEYFRAME_CATCH_ERROR,[c&&c.stack])}return t}function l(e){return u(s.a.deflate(e))}function u(e){for(var t="",n=0,o=e.length;6e3*n<o;)t+=btoa(String.fromCharCode.apply(null,Array.prototype.slice.call(e,6e3*n,6e3*(n+1)))),n++;return t}function d(e){if(!e||!e.from||!e.to)return"";var t=function(e){if(!e||!e.from||!e.to)return[];var t,n;return t={row:Math.min(e.from.row,e.to.row),col:Math.min(e.from.col,e.to.col)},n={row:Math.max(e.from.row,e.to.row),col:Math.max(e.from.col,e.to.col)},[t,n]}(e),n=t[0],o=t[1];if(n&&o){if(n.col===o.col&&n.row===o.row)return h(n);var r=h(n),s=h(o);if(r&&s)return"".concat(r,":").concat(s);if(r)return r;if(s)return s}return""}function h(e){var t="";if(e&&"number"===typeof e.col){var n="A".charCodeAt(0),o="Z".charCodeAt(0)-"A".charCodeAt(0)+1;if(!o)return"";var r=e.col||0,s=0,i=!0;do{s=Math.floor(r%o-(i?0:1)),r=Math.floor(r/o),t=String.fromCharCode(s+n)+t,i=!1}while(r);t+=e.row+1}return t}function f(e){return function(e){if(!e||!e.length)return;for(var t=g(e),n=[],r=0,s=t.length;r<s;r++)for(var i=0,a=t[r].length;i<a;i++){var c=t[r][i];if(c&&(!c.isSearched||1!==c.isSearched)){var l={row:r,col:r},u=m(t,l,_(c));if(u){p(t,c,l,u);var h={from:l,to:u},f=g(c);delete f.isSearched;var b=[d(h),f];n.push(b)}}}return n;function _(e){return function(t){return function(e,t){if(null===e&&null===t)return!0;if(null===e||null===t)return!1;if("object"!==Object(o.a)(e)||"object"!==Object(o.a)(t))return!1;if(e.isSearched&&1===e.isSearched)return!1;var n=!0;for(var r in t)t[r]!==e[r]&&(n=!1);return n}(t,e)}}}(e)}function p(e,t,n,o){if(n&&"number"===typeof n.row&&"number"===typeof n.col&&o&&"number"===typeof o.row&&"number"===typeof o.col){n||(n={row:0,col:0});for(var r=Object.getOwnPropertyNames(t).length-(t.isSearched?1:0),s=n.row;s<=o.row;s++)for(var i=n.col;i<=o.col;i++){var a=e[s][i];a&&(r===Object.getOwnPropertyNames(a).length-(a.isSearched?1:0)?a.isSearched=1:a.isSearched=2)}}}function m(e,t,n){if(e&&e.length&&e[t.row].length){var o,r,s;t||(t={row:0,col:0});var i=0,a={row:t.row,col:t.col};for(o=t.row,r=e.length;o<r;o++){var c=e[o];for(s=t.col,i=i?Math.min(i,c.length):c.length;s<i;s++){if(!n(c[s])){if(o===t.row)a.col=s-1,i=s;else if(o===e.length-1)a.row=e.length-1;else if(s<a.col+1)return a.row=o-1,a;break}s===c.length-1?(a.col=c.length-1,o===e.length-1&&(a.row=e.length-1)):o===e.length-1&&s===i-1&&(a.row=e.length-1)}}return a}}var g=function e(t){if(!t||"object"!==Object(o.a)(t))return t;var n={};return Array.isArray(t)?n=t.map((function(t){return e(t)})):Object.keys(t).forEach((function(o){return n[o]=e(t[o])})),n}},"./src/core/network/NetStatus.ts":function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return c}));var o,r=n("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),s=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=n("./src/base/event/event.ts"),a=n("../node_modules/@tencent/netcheck/lib/index.js");!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.SOCKET=1]="SOCKET"}(o||(o={}));var c=function(){function t(n){var s=this;Object(r.a)(this,t),this.socketNetworkStatus=!0,this.networkChange=function(t){var n;null===(n=e.log)||void 0===n||n.warn("flow NetStatus \u7f51\u7edc\u53d8\u5316\u4e86\uff0cstatus=",t),"online"===t?s.handleStatusChange({online:!0,type:o.DEFAULT}):s.handleStatusChange({online:!1,type:o.DEFAULT})},this.handleStatusChange=function(t){var n,r=s.isNetworkOnline();t.type===o.DEFAULT?s.browserNetworkStatus=t.online:t.type===o.SOCKET&&(s.socketNetworkStatus=t.online);var a=s.isNetworkOnline();r!==a&&(null===(n=e.log)||void 0===n||n.warn("flow NetStatus \u5168\u5c40\u7f51\u7edc\u72b6\u6001\u53d8\u5316\u4e86\uff0cisOnline=".concat(a)),s.app.permissions.setWorkbookStatusOnline(a),i.c.spreadsheetEvent.trigger("NetworkStatusChanged",a))},this.app=n,this.handleStatusChange({online:a.a.isOnline,type:o.DEFAULT}),this.initListeners()}return Object(s.a)(t,[{key:"destroy",value:function(){var t;null===(t=e.log)||void 0===t||t.debug("flow NetStatus destroy()"),this.removeListeners()}},{key:"initListeners",value:function(){a.a.changeEnd(this.networkChange)}},{key:"removeListeners",value:function(){a.a.remove(this.networkChange)}},{key:"setSocketOnline",value:function(t){var n;null===(n=e.log)||void 0===n||n.warn("flow NetStatus Socket\u53d8\u5316\u4e86\uff0cisOnline=",t),this.handleStatusChange({online:t,type:o.SOCKET})}},{key:"isNetworkOnline",value:function(){return this.browserNetworkStatus&&this.socketNetworkStatus}}]),t}()}).call(this,n("../node_modules/webpack/buildin/global.js"))},"./src/core/network/message-center/MessageCenter.interface.ts":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var o=n("../packages/services/src/instantiation.ts"),r=Object(o.c)("IMessageCenter")},"./src/core/network/message-center/MessageCenter.ts":function(e,t,n){"use strict";(function(e){n("../node_modules/core-js/modules/es.array.for-each.js"),n("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.reflect.construct.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js");var o=n("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),r=n("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),s=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=n("../node_modules/@babel/runtime/helpers/esm/inherits.js"),a=n("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),c=n("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),l=n("../node_modules/@babel/runtime/helpers/esm/typeof.js"),u=n("./src/core/network/message-center/base/BaseMessageCenter.ts"),d=n("./src/core/network/message-center/SendMessageCenter.ts"),h=n("./src/core/network/message-center/ReceiveMessageCenter.ts"),f=n("./src/core/app/SpreadsheetApp.interface.ts"),p=n("./src/base/event/event.ts"),m=n("./src/core/network/message-center/model/PendingControl.ts"),g=n("../packages/model/src/spreadsheet/SpreadsheetType.ts"),b=n("./src/core/network/message-center/model/task/MissChangeTask.ts"),_=n("./src/base/error/errCodeType.ts"),v=n("../packages/services/src/dispose.ts");function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(c.a)(e);if(t){var r=Object(c.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(a.a)(this,n)}}var w=function(e,t,n,o){var r,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"===typeof Reflect?"undefined":Object(l.a)(Reflect))&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(i=(s<3?r(i):s>3?r(t,n,i):r(t,n))||i);return s>3&&i&&Object.defineProperty(t,n,i),i},k=function(e,t){return function(n,o){t(n,o,e)}},C=function(t){Object(i.a)(a,t);var n=y(a);function a(t,o){var s,i;return Object(r.a)(this,a),(i=n.call(this,o))._app=t,i._onTaskError=function(t){var n;null===(n=e.log)||void 0===n||n.error("onTaskError in MessageCenter",null===t||void 0===t?void 0:t.stack),i._shutdown("string"===typeof t?t:_.a.TASK_RUN_ERROR)},i._updateBaseVersion=function(){},i._shutdown=function(e){i._taskQueue.shutdown(),i._app.socket.client.shutDown(e)},i._handleStartLoadData=function(e){var t=e.sheetId;i._pendingControl.startLoadSheet(t)&&1===i._pendingControl.loadingCount&&i._taskQueue.pause()},i._handleAfterLoadData=function(e){var t=e.sheetId;i._pendingControl.finishLoadSheet(t)&&0===i._pendingControl.loadingCount&&(i._taskQueue.resume(),i._applyFormulaModel())},i._handleSyncLatestData=function(e){var t=i._version.version;if(!(t>=e)){var n=new b.a(i._taskQueue,{from:t+1,to:e,parent:i._receiveMessageCenter});i._taskQueue.pushTask(n)}},null===(s=e.log)||void 0===s||s.info("flow MessageService new MessageCenter()"),i.taskQueue.pause(),i._pendingControl=new m.a,i._init(),i._containerID=e.containerID,i}return Object(s.a)(a,[{key:"_init",value:function(){var e=this;this._sendMessageCenter=this._register(new d.a(this._app,{version:this._version,taskQueue:this._taskQueue})),this._receiveMessageCenter=new h.a(this._app,{version:this._version,taskQueue:this._taskQueue}),this._register(this._receiveMessageCenter.onBeforeApplyCollabMutations((function(t){return e._sendMessageCenter.handleBeforeApplyCollabMutations(t)}))),this._register(this._receiveMessageCenter.onBeforeApplyNewChanges((function(t){return e._sendMessageCenter.handleBeforeApplyNewChanges(t)}))),this._register(this._receiveMessageCenter.onAfterApplyNewChanges((function(t){return e._sendMessageCenter.handleAfterApplyNewChanges(t)}))),this._register(this._receiveMessageCenter.onShutDown((function(t){return e._shutdown(t)}))),this._register(this._sendMessageCenter.onShutDown((function(t){return e._shutdown(t)}))),this._register(this._version.onUpdate((function(t){return e._updateBaseVersion()}))),this._register(this._taskQueue.onTaskError((function(t){return e._onTaskError(t)}))),p.c.default.listen("startLoadData",this._handleStartLoadData),p.c.default.listen("afterLoadData",this._handleAfterLoadData),p.c.spreadsheetEvent.listen("syncLatestData",this._handleSyncLatestData),this._register(Object(v.g)((function(){p.c.default.remove("startLoadData",e._handleStartLoadData),p.c.default.remove("afterLoadData",e._handleAfterLoadData),p.c.spreadsheetEvent.remove("syncLatestData",e._handleSyncLatestData)})))}},{key:"_applyFormulaModel",value:function(){var e=this,t=this._sendMessageCenter.commitingQueue,n=this._sendMessageCenter.waitingQueue,r=[];(null===t||void 0===t?void 0:t.mutations)&&t.mutations.length>0&&t.mutations.forEach((function(e){r.push.apply(r,Object(o.a)(e))})),n.forEach((function(e){e.mutations&&e.mutations.length>0&&e.mutations.forEach((function(e){r.push.apply(r,Object(o.a)(e))}))}));var s=this._pendingControl.sheet;r.forEach((function(t){p.c.spreadsheetEvent.trigger(e._app.mutationBehavior.EVENT.AFTER_MUTATION_RUN,{sheetId:s,mutation:t,sType:g.a.NORMAL,isLocal:!0,isFromFormula:!1,isCollab:!1,isReplay:!1})}))}},{key:"sendMessageCenter",get:function(){return this._sendMessageCenter}},{key:"receiveMessageCenter",get:function(){return this._receiveMessageCenter}}]),a}(u.a);C=w([k(0,f.a)],C),t.a=C}).call(this,n("../node_modules/webpack/buildin/global.js"))},"./src/core/network/message-center/ReceiveMessageCenter.ts":function(e,t,n){"use strict";(function(e){n("../node_modules/core-js/modules/es.array.concat.js"),n("../node_modules/core-js/modules/es.array.for-each.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.reflect.construct.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js");var o=n("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),r=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=n("../node_modules/@babel/runtime/helpers/esm/inherits.js"),i=n("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),a=n("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),c=n("./src/core/network/message-center/base/BaseReceiveMessageCenter.ts"),l=n("./src/core/network/message-center/model/MissChange.ts"),u=n("../packages/mutation/src/MutationOperationType.ts"),d=n("../packages/report/src/index.ts"),h=n("./src/base/config/report.ts"),f=n("./src/core/network/message-center/model/task/PushTask.ts"),p=n("./src/core/network/message-center/model/task/MissChangeTask.ts"),m=n("./src/base/error/errCodeType.ts"),g=n("../packages/lib/index.ts");function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(a.a)(e);if(t){var r=Object(a.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(i.a)(this,n)}}var _=function(t){Object(s.a)(i,t);var n=b(i);function i(t,r){var s;return Object(o.a)(this,i),(s=n.call(this,t,r))._receiveCrossSheetMutation=!0,s._applyNewChangesError=!1,s._onBeforeApplyNewChanges=new g.a,s.onBeforeApplyNewChanges=s._onBeforeApplyNewChanges.event,s._onAfterApplyNewChanges=new g.a,s.onAfterApplyNewChanges=s._onAfterApplyNewChanges.event,s._onBeforeApplyCollabMutations=new g.a,s.onBeforeApplyCollabMutations=s._onBeforeApplyCollabMutations.event,s._onAfterApplyCollabMutations=new g.a,s.onAfterApplyCollabMutations=s._onAfterApplyCollabMutations.event,s._onShutDown=new g.a,s.onShutDown=s._onShutDown.event,s._app=t,void 0!==r.receiveCrossSheetMutation&&(s._receiveCrossSheetMutation=r.receiveCrossSheetMutation),s._containerID=e.containerID,s}return Object(r.a)(i,[{key:"isSheetNotReady",value:function(e,t){return!t||!(!t.isFetching&&(t.isLoaded||e===this.app.spreadsheet.activeSheetId))}},{key:"handleNewChanges",value:function(e){var t,n=null===(t=e.body)||void 0===t?void 0:t.data,o=e.new_rev;if(d.b.run(h.CONFIG.HANDLE_NEW_CHANGES,[this._containerID,o,null===n||void 0===n?void 0:n.commitId,e.socketId,e.ts]),n){n.newRev=e.new_rev;var r=new l.a(n),s=new f.a(this._taskQueue,{newChange:r,parent:this});this._taskQueue.pushTask(s)}}},{key:"handleLastRervesion",value:function(e){var t=e.body.notice.lastRev;if(this.currentVersion<t){var n=new p.a(this._taskQueue,{from:this.currentVersion+1,to:t,parent:this});this._taskQueue.pushTask(n)}}},{key:"handleCommitVersionBreak",value:function(){var e=this,t=new p.a(this._taskQueue,{from:this.currentVersion+1,parent:this});t.onFinish=function(){e._app.messageCenter.sendMessageCenter.retryCommit(100)},this._taskQueue.pushTask(t,0)}},{key:"applyNewChanges",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"collab",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(!this._applyNewChangesError){try{this._onBeforeApplyNewChanges.fire({changeInfo:e,changesOrigin:o,extra:r})}catch(s){return}e.isValid&&(e.newVersion<=this._version.version?d.b.run(h.CONFIG.APPLY_NEWCHANGES_VERROR,[this._containerID,o,t,n,e],o):(this.app.requestApi.applyCollab({sheetId:e.sheetId,requestId:-1,canUndoRedo:!1,opt:e}),this._onAfterApplyNewChanges.fire({changeInfo:e})))}}},{key:"onApplyNewChanges",value:function(e){var t=e.changeInfo,n=e.mutations;try{t.revert||this._applyCollabMutations(n,t),this._version.update(t.newVersion),d.b.run(h.CONFIG.APPLY_NEWCHANGES,[this._containerID,t.newVersion])}catch(o){this._applyError(t,o)}}},{key:"_applyCollabMutations",value:function(e,t){var n=t.sheetId,o=t.newVersion,r=t.head,s=t.isWorkbook,i=this._app.spreadsheet.sheetManager.getSheetBySheetId(n);if(!r&&!s){if(this._app.spreadsheet.activeSheetId!==n&&!this._receiveCrossSheetMutation)return;if(!i||0===e.length)return}var a=this._app.mutationBehavior.deSerializeRequests(e),c={newVersion:o,requestMutations:a};this._onBeforeApplyCollabMutations.fire(c);var l=[];(a=c.requestMutations).forEach((function(e){l=l.concat(e)})),(r||s||!this.isSheetNotReady(n,i))&&(this._applyInUndoRedo(n,l),this._applyInDataAndView(l)),this._onAfterApplyCollabMutations.fire({changeInfo:t,mutations:l})}},{key:"_applyError",value:function(e,t){d.b.run(h.CONFIG.APPLY_NEWCHANGES_CATCH_ERROR,[this._containerID,e,t]),this._applyNewChangesError=!0,this._onShutDown.fire(m.a.APPLY_NEW_CHANGE_ERROR)}},{key:"_applyInUndoRedo",value:function(e,t){var n=this._app.undoredoStack.createUndoRedoMutations({sheetId:e,local:!1});n.add(t),this._app.undoredoStack.sync(n)}},{key:"_applyInDataAndView",value:function(e){var t=this;e.forEach((function(e){e.operationType=u.a.COLLAB,t._app.mutationBehavior.applyMutation(e,{isLocal:!1,isCollab:!0})}))}},{key:"app",get:function(){return this._app}}]),i}(c.a);t.a=_}).call(this,n("../node_modules/webpack/buildin/global.js"))},"./src/core/network/message-center/SendMessageCenter.ts":function(e,t,n){"use strict";(function(e){n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/es.map.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.reflect.construct.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/esnext.map.delete-all.js"),n("../node_modules/core-js/modules/esnext.map.every.js"),n("../node_modules/core-js/modules/esnext.map.filter.js"),n("../node_modules/core-js/modules/esnext.map.find.js"),n("../node_modules/core-js/modules/esnext.map.find-key.js"),n("../node_modules/core-js/modules/esnext.map.includes.js"),n("../node_modules/core-js/modules/esnext.map.key-of.js"),n("../node_modules/core-js/modules/esnext.map.map-keys.js"),n("../node_modules/core-js/modules/esnext.map.map-values.js"),n("../node_modules/core-js/modules/esnext.map.merge.js"),n("../node_modules/core-js/modules/esnext.map.reduce.js"),n("../node_modules/core-js/modules/esnext.map.some.js"),n("../node_modules/core-js/modules/esnext.map.update.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js");var o,r=n("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),s=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=n("../node_modules/@babel/runtime/helpers/esm/get.js"),a=n("../node_modules/@babel/runtime/helpers/esm/inherits.js"),c=n("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),l=n("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),u=n("./src/core/network/message-center/base/BaseSendMessageCenter.ts"),d=n("../packages/report/src/index.ts"),h=n("./src/base/config/report.ts"),f=n("./src/core/network/message-center/model/UserChange.ts"),p=n("./src/core/network/message-center/model/userChange-helper.ts"),m=n("./src/core/app/lazytool/index.ts"),g=n("./src/base/error/errCodeType.ts"),b=n("./src/core/network/message-center/model/layer/ConnectionLayer.ts"),_=n("./src/core/network/message-center/model/layer/RoomLayer.ts"),v=n("./src/core/network/message-center/model/layer/EditLayer.ts"),y=n("./src/base/event/event.ts"),w=n("./src/base/util/timer.ts"),k=n("../packages/lib/index.ts");function C(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(l.a)(e);if(t){var r=Object(l.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(c.a)(this,n)}}!function(e){e.INIT="INIT",e.RETRY="RETRY",e.ERROR="ERROR"}(o||(o={}));var S=function(t){Object(a.a)(c,t);var n=C(c);function c(t,s){var i;return Object(r.a)(this,c),(i=n.call(this,t,s))._messageLoopInterval=500,i._lastCommitTime=null,i._commitingQueueTimeoutStatus=o.INIT,i._needKeyDataFlagMap=new Map,i._retryTime=0,i._maxRequestCount=1,i._disableSendUserChange=!1,i._onUserChangeNew=new k.a,i.onUserChangeNew=i._onUserChangeNew.event,i._onUserChangeUpdate=new k.a,i.onUserChangeUpdate=i._onUserChangeUpdate.event,i._onAfterApplyNewChanges=new k.a,i.onAfterApplyNewChanges=i._onAfterApplyNewChanges.event,i._onApplyCt=new k.a,i.onApplyCt=i._onApplyCt.event,i._onAcceptCommit=new k.a,i.onAcceptCommit=i._onAcceptCommit.event,i._onResetCommitingQueue=new k.a,i.onResetCommitingQueue=i._onResetCommitingQueue.event,i._onShutDown=new k.a,i.onShutDown=i._onShutDown.event,i._onUserChangeRetryCommit=new k.a,i.onUserChangeRetryCommit=i._onUserChangeRetryCommit.event,i._onUserChangeCommit=new k.a,i.onUserChangeCommit=i._onUserChangeCommit.event,i._onCommitWithErrorCode=new k.a,i.onCommitWithErrorCode=i._onCommitWithErrorCode.event,i.handleAfterApplyNewChanges=function(e){var t=e.changeInfo;i._onAfterApplyNewChanges.fire({changeInfo:t})},i.handleBeforeApplyNewChanges=function(t){var n=t.changeInfo,o=t.changesOrigin,r=t.extra;if(n.isNeedKeyframe&&!i._needKeyDataFlagMap.get(n.sheetId)&&i._app.spreadsheet.activeSheetId===n.sheetId&&i._needKeyDataFlagMap.set(n.sheetId,n.isNeedKeyframe),i._isDuplicateMessage(n.commitId)){var s;if("taskDuplicate"===r.reason&&"missing"===o)null===(s=e.log)||void 0===s||s.info("SendMessageCenter handleBeforeApplyNewChanges _isDuplicateMessage. ".concat(JSON.stringify(t)));else d.b.run(h.CONFIG.DUPLICATE_MESSAGE,[i._containerID,n]);i.acceptCommit(n.sheetId,n.newVersion,n.isNeedKeyframe,n.commitId),n.isValid=!1}else i._isChangeTitleMessage(n)&&(i._version.update(n.newVersion),i._onApplyCt.fire({changeInfo:n}),n.isValid=!1)},i.handleBeforeApplyCollabMutations=function(e){var t,n=e.requestMutations,o=[];(null===(t=i._commitingQueue)||void 0===t?void 0:t.mutations)&&i._commitingQueue.mutations.length&&(o=i._app.mutationBehavior.followRequestMutations(n,i._commitingQueue.mutations,!1),n=i._app.mutationBehavior.followRequestMutations(i._commitingQueue.mutations,n,!0),i._commitingQueue.mutations=o);for(var r=0;r<i.waitingQueue.length;r++){var s=i.waitingQueue[r];(null===s||void 0===s?void 0:s.mutations)&&s.mutations.length>0&&(o=i._app.mutationBehavior.followRequestMutations(n,s.mutations,!1),n=i._app.mutationBehavior.followRequestMutations(s.mutations,n,!0),s.mutations=o)}e.requestMutations=n},i._checkAndSend=function(){if(i._loop(),i._app.socket&&i._app.socket.client&&"OPENED"===i._app.socket.client.getRoomState()){var e=(new Date).getTime();if(i._retryTime>0&&e>=i._retryTime){if(i._retryTime=0,!i._commitingQueue)return;d.b.run(h.CONFIG.RETRY_SENDMESSAGE,[i._containerID,e,i._commitingQueue.taskId]),i._sendUserChanges(),i._onUserChangeRetryCommit.fire()}else null===i._commitingQueue&&i._waitingQueue.length>0&&(i._commitingQueue=i._waitingQueue.shift(),i._retryTime=0,d.b.run(h.CONFIG.MOVE_MESSAGEINFO_COMMITING_QUEUE,[i._containerID,i._commitingQueue.taskId,i._commitingQueue.key,i._commitingQueue.isMutationChange(),i._commitingQueue.mutations.length,i.waitingQueue.length]),i._commitingQueue.status=f.a.COMMITING,i._sendUserChanges(),i._onUserChangeCommit.fire({userChange:i._commitingQueue})),i._detectCommitingQueueHasBlock()}},i._onSend=function(e,t,n,o){0===o.errCode&&o.response?i._roomLayer.handleSend(e,t,o):i._connectionLayer.handleConnectionLayerErrorCode(e,t,o)},i._onSendAccept=function(e,t,n,o,r,s){"USER_CHANGES"===t&&(0===r.errCode&&r.response?i._editLayer.handleSendAccept(e,t,r,o,s):i._connectionLayer.handleConnectionLayerErrorCode(e,t,r,o,s))},i._containerID=e.containerID,i._app=t,i._connectionLayer=new b.a(i._app),i._roomLayer=new _.a(i._app),i._editLayer=new v.a(i._app),i._loop(),i._initEventListeners(),i}return Object(s.a)(c,[{key:"baseVersion",value:function(){return this.currentVersion}},{key:"addUserChange",value:function(e){var t=e.sheetId,n=e.taskId,o=e.data,r=(e.requestId,e.head),s=e.isWorkbook,i=void 0!==s&&s,a=e.oSubId,c=void 0===a?null:a,l=e.withKeyData,u=void 0!==l&&l,p=e.isOfflineMessage,g=void 0!==p&&p,b=e.allowAutoMerge,_=void 0!==b&&b,v=e.keyframe,y=void 0===v?null:v,w=e.createTime,k=void 0===w?Date.now():w,C=e.syncToOffline,S=void 0===C||C;this._app.socket&&this._app.socket.client&&"OPENED"===this._app.socket.client.getRoomState()||this._app.socket.onceOpened&&!g&&this._app.networkStatus.setSocketOnline(!1);var E=null,T={globalPadId:this._app.spreadsheet.getSpreadsheetId(),sheetId:t,baseVersion:this._version.version,data:{taskId:n},isOfflineMessage:g,time:k};r&&(T.data.head=!0,T.data.oSubId=c||null),i&&(T.data.isWorkbook=!0);var O=!0;if(0===this._waitingQueue.length||n||r||i)(E=new f.b(T)).setOrAppendMutations(o),this._waitingQueue.push(E);else{var j=this._waitingQueue[this._waitingQueue.length-1];_&&j.allowAutoMerge&&j.isMutationChange()&&j.requestCount<this._maxRequestCount&&j.sheetId===t&&(E=j,O=!1),E?E.setOrAppendMutations(o):((E=new f.b(T)).setOrAppendMutations(o),this._waitingQueue.push(E))}if(u||this._needKeyDataFlagMap.get(t)){var x=Object(m.createZipKeyframe)(t);this._needKeyDataFlagMap.delete(t),E.setKeyData(x||null)}else y&&E.setKeyData(y);O?this._onUserChangeNew.fire({userChange:E,syncToOffline:S}):this._onUserChangeUpdate.fire({userChange:E,syncToOffline:S}),d.b.run(h.CONFIG.ADD_USER_CHANGE,[this._containerID,t,E.taskId,u,E.isWithKeyData(),r,c,null===o||void 0===o?void 0:o.length])}},{key:"acceptCommit",value:function(e,t,n,o){var r=this._commitingQueue,s=r.isOfflineMessage?"acceptOfflineCommit":"acceptCommit";d.b.run(h.CONFIG.ACCEPT_COMMIT_2,[this._containerID,e,t,n,o],s),!this._needKeyDataFlagMap.get(e)&&n&&this._needKeyDataFlagMap.set(e,n),this._version.update(t),this._onAcceptCommit.fire({sheetId:e,newVersion:t,userChange:r}),this.resetCommitingQueue(),y.c.network.trigger("commitSuccess"),y.c.notificationCenter.trigger("localChangeContentExcelEdit")}},{key:"hasUncommittedChanges",value:function(e){if(e){if(this._commitingQueue&&!this._commitingQueue.isEmpty&&this._commitingQueue.sheetId===e)return!0;for(var t=0;t<this._waitingQueue.length;t++){if(this._waitingQueue[t].sheetId===e)return!0}return!1}return this._commitingQueue&&!this._commitingQueue.isEmpty||this._waitingQueue.length>0}},{key:"restart",value:function(){this.retryCommit(0),this._commitingQueueTimeoutStatus=o.INIT}},{key:"retryCommit",value:function(e){this._retryTime=(new Date).getTime()+e.valueOf(),d.b.run(h.CONFIG.RETRY_COMMIT,[this._containerID,this._retryTime])}},{key:"resetCommitingQueue",value:function(){this._onResetCommitingQueue.fire({userChange:this._commitingQueue}),this._commitingQueue=null,this._commitingQueueTimeoutStatus=o.INIT,this._lastCommitTime=null}},{key:"commitError",value:function(e,t,n){var o=!!this._commitingQueue&&this._commitingQueue.isOfflineMessage;switch(d.b.run(h.CONFIG.HANDLE_COMMIT_ERROR,[this._containerID,n.seq,n.cmd,n.result],t,e,o),t){case 101:case 104:case 106:this._app.messageCenter.sendMessageCenter.retryCommit(3e3);break;case 102:this._app.event.errorCode.trigger("errorCode",{type:"socket",code:"102"});break;case 103:case 105:break;case 40006:case 40035:case 60018:case 60019:case 60020:if(this._editLayer.retryCommitCount<3){var r,s;this._editLayer.retryCommitCount+=1,this._app.socket.client.cancelMessageBySeq(n.seq);var i=3e3;(null===(r=n.result.response.body)||void 0===r||null===(s=r.data)||void 0===s?void 0:s.retry_interval)&&(i=n.result.response.body.data.retry_interval),this._app.messageCenter.sendMessageCenter.retryCommit(i)}else this._editLayer.retryCommitCount=0,this._onShutDown.fire(String(t));break;case 40021:case 40027:this._app.messageCenter.receiveMessageCenter.handleCommitVersionBreak();break;case 40203:case 1e4:case 10001:case 4e4:case 40001:case 40002:case 40003:case 40005:case 40020:case 40022:case 40023:case 40024:case 40025:case 40026:case 40028:case 40030:case 40034:case 40036:case 40037:case 40100:case 41001:case 41002:case 60003:case 60007:case 60008:case 60016:case 60017:case 60007:case 60015:this._onShutDown.fire(String(t));break;case 60002:case 60004:case 60005:case 60011:case 60013:case 60014:case 60021:case 60022:if(this._roomLayer.retryPostCount<3){var a;this._roomLayer.retryPostCount+=1,this._app.socket.client.cancelMessageBySeq(n.seq);var c=3e3;(null===(a=n.result.response.onpost)||void 0===a?void 0:a.retry_interval)&&(c=n.result.response.onpost.retry_interval),this._app.messageCenter.sendMessageCenter.retryCommit(c)}else this._roomLayer.retryPostCount=0,this._onShutDown.fire(String(t));break;default:"connectionLayer"===e?this._onShutDown.fire(g.a.FRONTEND_SOCKET_ERROR_CODE_UNDEFINED):"editLayer"===e&&this._onShutDown.fire(g.a.COMMIT_ERROR_CODE_UNDEFINED)}this._onCommitWithErrorCode.fire({type:e,errCode:t})}},{key:"__sendChangeForTest",value:function(e,t,n){}},{key:"dispose",value:function(){Object(i.a)(Object(l.a)(c.prototype),"dispose",this).call(this),w.a.erase(this._timer)}},{key:"_loop",value:function(){var e=this;this._timer=w.a.wait(this._messageLoopInterval).run((function(){e._checkAndSend()}))}},{key:"_detectCommitingQueueHasBlock",value:function(){if(this._commitingQueueTimeoutStatus!==o.ERROR){var e=(new Date).getTime();null===this._commitingQueue||null===this._lastCommitTime||e-this._lastCommitTime<6e4||(this._commitingQueueTimeoutStatus===o.INIT?(this.retryCommit(100),this._commitingQueueTimeoutStatus=o.RETRY):this._commitingQueueTimeoutStatus===o.RETRY&&(d.b.run(h.CONFIG.COMMITING_QUEUE_BLOCK,[this._containerID,this.commitingQueue,this._lastCommitTime,e,this._commitingQueueTimeoutStatus,this.waitingQueue.length]),this._app.event.errorCode.trigger("errorCode",{type:"front",code:g.a.COMMITING_QUEUE_BLOCK}),this._commitingQueueTimeoutStatus=o.ERROR))}}},{key:"_sendUserChanges",value:function(){if(null!==this._commitingQueue&&!this.disableUserChange){var e=Object(p.d)(this._commitingQueue);this._lastCommitTime=(new Date).getTime();var t=this._app.socket.client.sendMessageWaitAcceptCmd("USER_CHANGES",this._commitingQueue.taskId,e,this._prepareSendParams(),this._onSend,this._onSendAccept),n=0===this._commitingQueue.commitTimes;this._commitingQueue.commitTimes=this._commitingQueue.commitTimes+1,this._commitingQueue.taskId=t.seq;var o=this._commitingQueue.isOfflineMessage?"sendOfflineUserChange":"sendUserChange";t&&0!==t.errCode?(n&&d.b.run(h.CONFIG.SEND_USERCHANGE,[this._containerID,this._commitingQueue.taskId,Object(p.e)(this._commitingQueue),t,this._commitingQueue.commitTimes],o,this._commitingQueue.requestCount),this._connectionLayer.handleConnectionLayerErrorCode(0,"",t)):n&&d.b.run(h.CONFIG.SEND_USERCHANGE_1,[this._containerID,this._commitingQueue.taskId,Object(p.e)(this._commitingQueue),this._commitingQueue.commitTimes],o,this._commitingQueue.requestCount)}}},{key:"_prepareSendParams",value:function(){return{timeout:15e3,maxRetryCount:3,waitAcceptCmd:["ACCEPT_COMMIT","COMMIT_ERROR","TASK_DUPLICATE"]}}},{key:"_isChangeTitleMessage",value:function(e){try{if(e.changeset){var t,n=JSON.parse(e.changeset);if(n&&"ct"===(null===(t=n[0])||void 0===t?void 0:t.type))return!0}return!1}catch(o){return console.error("\u89e3\u6790misschange\u5931\u8d25",o),!1}}},{key:"_isDuplicateMessage",value:function(e){return this._commitingQueue?this._commitingQueue.taskId===e:this._waitingQueue.length>0&&this._waitingQueue[0].taskId===e}},{key:"_initEventListeners",value:function(){var e=this;y.c.spreadsheetEvent.listen("onShowHowToHandleDataLostModal",(function(){var t,n=e._commitingQueue?1+e.waitingQueue.length:e.waitingQueue.length;d.b.run(h.CONFIG.CLEAR_OFFLINE_DATA_SIZE,n,[e._containerID,!!e._commitingQueue,null===(t=e.waitingQueue)||void 0===t?void 0:t.length])}))}},{key:"disableUserChange",get:function(){return this._disableSendUserChange},set:function(e){this._disableSendUserChange=e}}]),c}(u.a);t.a=S}).call(this,n("../node_modules/webpack/buildin/global.js"))},"./src/core/network/message-center/model/layer/ConnectionLayer.ts":function(e,t,n){"use strict";var o=n("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),r=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=n("../packages/report/src/index.ts"),i=n("./src/base/config/report.ts"),a=n("./src/base/error/errorCodeModalProxy.ts"),c=function(){function e(t){Object(o.a)(this,e),this._app=t}return Object(r.a)(e,[{key:"handleConnectionLayerErrorCode",value:function(e,t,n,o,r){switch(o){case"ACCEPT_COMMIT":s.b.run(i.CONFIG.ACCEPT_COMMIT,[e,t,n]),a.b.client.showUserChangeSaveFailTip();break;case"COMMIT_ERROR":"handleCommitError result=".concat(n),a.b.client.showUserChangeSaveFailTip();break;case"TASK_DUPLICATE":"handleTaskDuplicate result=".concat(n)}this._app.messageCenter.sendMessageCenter.commitError("connectionLayer",n.errCode,{seq:e,cmd:t,result:n})}}]),e}();t.a=c},"./src/core/network/message-center/model/layer/EditLayer.ts":function(e,t,n){"use strict";n("../node_modules/core-js/modules/es.array.concat.js");var o=n("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),r=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=n("../packages/report/src/index.ts"),i=n("./src/base/config/report.ts"),a=n("./src/base/error/errCodeType.ts"),c=n("./src/core/network/message-center/model/task/AcceptTask.ts"),l=n("./src/core/network/message-center/model/task/MissChangeTask.ts"),u=n("./src/base/event/event.ts"),d=n("./src/external/offlineEdit/model/ClearType.ts"),h=n("./src/base/error/errorCodeModalProxy.ts"),f=window,p=function(){function e(t){Object(o.a)(this,e),this._retryCommitCount=0,this._app=t}return Object(r.a)(e,[{key:"handleSendAccept",value:function(e,t,n,o,r){"ACCEPT_COMMIT"===o?this._handleAcceptCommit(e,t,n):"COMMIT_ERROR"===o?this._handleCommitError(e,t,n):"TASK_DUPLICATE"===o&&this._handleTaskDuplicate(e,t,n,r)}},{key:"_handleAcceptCommit",value:function(e,t,n){this.retryCommitCount=0;var o=n.response.new_rev,r=n.response.body,s=null===r||void 0===r?void 0:r.data,i=(null===s||void 0===s?void 0:s.need)||!1,a=null===s||void 0===s?void 0:s.subId,l=null===s||void 0===s?void 0:s.commitId,u=new c.a(this._app.messageCenter.taskQueue,{sheetId:a,to:o,taskId:l,isNeedKeyframe:i,parent:this._app.messageCenter});this._app.messageCenter.taskQueue.pushTask(u)}},{key:"_handleCommitError",value:function(e,t,n){h.b.client.showUserChangeSaveFailTip();var o=n.response.body,r=null===o||void 0===o?void 0:o.data,s=(null===r||void 0===r?void 0:r.reason)||0;this._app.messageCenter.sendMessageCenter.commitError("editLayer",s,{seq:e,cmd:t,result:n})}},{key:"_handleTaskDuplicate",value:function(e,t,n,o){var r,c,h;this._retryCommitCount=0,s.b.run(i.CONFIG.HANDLE_TASK_DUPLICATE,[e,t,n]);var p=null===n||void 0===n||null===(r=n.response)||void 0===r||null===(c=r.body)||void 0===c||null===(h=c.data)||void 0===h?void 0:h.lastRev,m=null===o||void 0===o?void 0:o.task_id;if(void 0!==p&&p<=this._app.messageCenter.currentVersion){var g,b,_=null===(g=this._app.messageCenter.sendMessageCenter.commitingQueue)||void 0===g?void 0:g.taskId;if(m!==_)return void(null===(b=f.log)||void 0===b||b.info("EditLayer _handleTaskDuplicate.seq=".concat(e," cmd=").concat(t," lastRev=").concat(p," head=").concat(o," currentCommitingTaskId=").concat(_)));s.b.run(i.CONFIG.TASK_DUPLICATE_VERSION_TOO_LOW,[e,t,n,this._app.messageCenter.currentVersion]),this._app.socket.client.shutDown(a.a.TASK_DUPLICATE_VERSION_TOO_LOW),u.c.spreadsheetEvent.trigger("clearOfflineStore",{type:d.a.UN_COMMITTED})}else{var v=new l.a(this._app.messageCenter.taskQueue,{from:this._app.messageCenter.currentVersion+1,to:p,parent:this._app.messageCenter.receiveMessageCenter,extra:{reason:"taskDuplicate"}});this._app.messageCenter.taskQueue.pushTask(v,0)}}},{key:"retryCommitCount",get:function(){return this._retryCommitCount},set:function(e){this._retryCommitCount=e}}]),e}();t.a=p},"./src/core/network/message-center/model/layer/RoomLayer.ts":function(e,t,n){"use strict";var o=n("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),r=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=function(){function e(t){Object(o.a)(this,e),this._retryPostCount=0,this._app=t}return Object(r.a)(e,[{key:"handleSend",value:function(e,t,n){n.response.onpost&&0===n.response.onpost.result?this._handleCommitSuccess():this._handleCommitOnSendError(e,t,n)}},{key:"_handleCommitSuccess",value:function(){this._retryPostCount=0}},{key:"_handleCommitOnSendError",value:function(e,t,n){var o=n.response.onpost.result;this._app.messageCenter.sendMessageCenter.commitError("roomLayer",o,{seq:e,cmd:t,result:n})}},{key:"retryPostCount",get:function(){return this._retryPostCount},set:function(e){this._retryPostCount=e}}]),e}();t.a=s},"./src/core/network/message-center/model/task/PushTask.ts":function(e,t,n){"use strict";n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.reflect.construct.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js"),n("../node_modules/regenerator-runtime/runtime.js");var o=n("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),r=n("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),s=n("../node_modules/@babel/runtime/helpers/esm/inherits.js"),i=n("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),a=n("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),c=n("./src/core/network/message-center/model/task/TaskType.ts"),l=n("./src/core/network/message-center/model/task/BaseTask.ts"),u=n("./src/core/network/message-center/model/task/MissChangeTask.ts"),d=n("../packages/report/src/index.ts"),h=n("./src/base/config/report.ts");function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(a.a)(e);if(t){var r=Object(a.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(i.a)(this,n)}}var p=function(e){Object(s.a)(n,e);var t=f(n);function n(e,s){var i;return Object(r.a)(this,n),(i=t.call(this,e,s)).type=c.a.PUSH,i.onInit=function(){return!(i.newChange.newVersion<=i.parent.currentVersion)},i.onPrepare=Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)}))),i.onStart=function(){if(i.newChange.newVersion===i.parent.currentVersion+1)i.parent.applyNewChanges(i.newChange,0,1,"collab");else if(i.newChange.newVersion>i.parent.currentVersion+1){d.b.run(h.CONFIG.APPLY_NEWCHANGES_VERROR2,[i.newChange.newVersion,i.parent.currentVersion]);var e=new n(i.queue,{newChange:i.newChange,parent:i.parent}),t=new u.a(i.queue,{from:i.parent.currentVersion+1,to:i.newChange.newVersion-1,parent:i.parent});i.queue.pushTask([t,e],0)}else i.newChange.newVersion===i.parent.currentVersion?d.b.run(h.CONFIG.APPLY_NEWCHANGES_VERROR5,[i.newChange.newVersion,i.parent.currentVersion]):d.b.run(h.CONFIG.APPLY_NEWCHANGES_VERROR6,[i.newChange.newVersion,i.parent.currentVersion])},i.onFinish=function(){},i.newChange=s.newChange,i.parent=s.parent,i}return n}(l.a);t.a=p},"./src/core/network/message-center/utils.ts":function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return a}));var o,r=n("./src/base/error/errCodeType.ts"),s=n("./src/base/error/errorCodeModalProxy.ts"),i=n("./src/core/utils/config.ts");function a(e){if(!Object(i.a)()&&e.socket.onceOpened)if(e.socket&&e.socket.client){var t,n,o=e.socket.client.getRoomState(),a=(null===(t=e.offlineEdit)||void 0===t||t.status,null===(n=e.offlineEdit)||void 0===n?void 0:n.isShield);if((!e.sheetStatus.workbookStatus.isOnline||"RECONNECTING_In_CLOSED"===o||"SHUTDOWN"===o)&&a)return e.socket.hideOfflineTips(),e.socket.hadShowOfflineTip=!0,e.event.errorCode.trigger("errorCode",{type:"front",code:r.a.OFFLINE_INDEXDB_NOT_AVAILABLE}),void e.permissions.activeTempStatus(!1);if(!e.sheetStatus.workbookStatus.isOnline&&!e.socket.hadShowOfflineTip){if(!e.offlineEdit.isDBAvaliable())return e.permissions.activeTempStatus(!1),void e.event.errorCode.trigger("errorCode",{type:"front",code:r.a.OFFLINE_INDEXDB_NOT_AVAILABLE});e.socket.hadShowOfflineTip=!0,s.b.client.showNetworkOfflineTip(e.sheetStatus.workbookStatus.canEdit,(function(t){e.socket.offlineSnackbar=t}))}}else e.socket.hadShowOfflineTip||(e.socket.hadShowOfflineTip=!0,s.b.client.showNetworkOfflineTip())}!function(e){e.USER_CHANGE_NEW="userChangeNew",e.USER_CHANGE_UPDATE="userChangeUpdate",e.USER_CHANGE_COMMIT="userChangeCommit",e.USER_CHANGE_RETRY_COMMIT="userChangeRetryCommit",e.COMMITING_QUEUE_RESET="commitingQueueReset",e.UPDATE_WAITING_QUEUE_VERSION="updateWaitingQueueVersion",e.APPLY_CT="applyCt",e.ACCEPT_COMMIT="acceptCommit",e.COMMIT_WITH_ERROR_CODE="commitWithErrorCode",e.AFTER_APPLY_COLLAB_MUTATIONS="afterApplyCollabMutations"}(o||(o={}))},"./src/core/network/socket/collab_room_channel.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));n("../node_modules/core-js/modules/es.array.concat.js"),n("../node_modules/core-js/modules/es.array.index-of.js"),n("../node_modules/core-js/modules/es.array.join.js"),n("../node_modules/core-js/modules/es.array.splice.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js"),n("../node_modules/core-js/modules/es.string.replace.js"),n("../node_modules/core-js/modules/es.string.split.js");var o=n("../node_modules/@babel/runtime/helpers/esm/typeof.js"),r=(n("../node_modules/core-js/modules/es.symbol.js"),n("../node_modules/core-js/modules/es.symbol.description.js"),n("../node_modules/core-js/modules/es.function.name.js"),n("../node_modules/core-js/modules/es.string.search.js"),n("../packages/report/src/index.ts")),s=n("./src/base/config/report.ts"),i=n("../node_modules/socket.io-client/lib/index.js"),a=n.n(i),c=!1,l=!1;function u(e,t,n,o,i,u,d,h){var f=this;this.name="socketing",this.md=u,this.reconnectMaxTimes=3,this.connectTimeout=5e3,this.reconnectionDelay=3e3,this.reconnectionDelayMax=5e3,this.randomizationFactor=1;var p=null,m=null,g=!1;this.onSocketOpened=function(){},this.onSocketClosed=function(){},this.onmessage=function(){},this.onpostmessage=function(){},this.onlogmessage=function(){},this.onSocketStatusChanged=function(){},this.onReopenCount=function(){},this.onlogWarn=function(){};var b={},_=function(){};function v(e,t,n,o){function r(e,t){e[t]&&(e[t](),e[t]=_)}var s=setTimeout((function(){r(e,t),o()}),n),i=function(){clearTimeout(s)};return r(e,t),e[t]=i,i}function y(e){var t,n,o,r;if(window.location.search&&window.location.search.length>=1&&(r=window.location.search.substring(1)),r)for(t=r.split("&"),n=0;n<t.length;n++)if((o=t[n].split("="))[0]===e)return o[1];return null}function w(e){e||(e="Closed by socket internal. forceClosed "),k(e),!1===g&&(f.onSocketClosed(e),g=!0)}function k(t){C("doDisconnect id = ".concat(e,"reason: ").concat(t,",hasWebSocketClosed: ").concat(g)),p&&(t&&(m=t),p.disconnect(),p=null)}function C(e){f.onlogmessage("(comet @t: ".concat(Math.floor((new Date).valueOf()/100)%1e7,") ").concat(e))}this.connect=function(){v(b,"connect",3e4,(function(){w("Timeout connecting to server:")})),function(){var e=y("uid"),u=y("uid_key"),_="wss://".concat(window.location.host),k=window.nowUserIndex,S={w:["websocket"],l:["polling"],b:["polling","websocket"]},E=f.md||"ww",T=S[E.charAt(0)]||S.w,O=S[E.charAt(1)]||S.b,j=void 0===d?2:d,x=void 0===h?3:h,R=a.a.connect(_,{query:{tag:t,gtag:n,utag:o,u:k,sig:i,uid:e,uid_key:u},transports:T,reconnection:!0,reconnectionAttempts:f.reconnectMaxTimes,reconnectionDelay:f.reconnectionDelay,reconnectionDelayMax:f.reconnectionDelayMax,randomizationFactor:f.randomizationFactor,timeout:f.connectTimeout,path:"/websocket"});if(C("connecting channel io transports".concat(R.io.opts.transports," pollingReopenCount = ").concat(j," pollingAttemptNumber=").concat(x)),p=R,R.on("reconnect_attempt",(function(){C("".concat("socket io reconnect_attempt time=").concat(new Date))})),R.on("connect_error",(function(e){f.onlogWarn("socket io connect_error obj time:".concat(new Date," code:").concat(void 0!==e.description&&null!==e.description?e.description.code:90009));var t=f.getSocketChannelInfo();t||(t={}),t.event="connect_error",t.failReason="io connect_error unknown",e&&e.type&&(t.failReason=e.type),f.onSocketStatusChanged(R.io.readyState,t)})),R.on("connect_timeout",(function(){var e=f.getSocketChannelInfo();e||(e={}),e.event="connect_timeout",e.failReason="connect_timeout",f.onSocketStatusChanged(R.io.readyState,e)})),R.on("get",(function(e){f.onmessage(e)})),R.on("post",(function(e){f.onpostmessage(e)})),R.on("connect",(function(){b.socketing&&b.socketing(),g=!1,c=!0,C("socket io connect readyState: ".concat(R.io.readyState)),b.connect(),f.onSocketOpened()})),R.on("reconnect",(function(e){var t=new Date;C("socket io reconnect number: ".concat(e,",time: ").concat(t,",channel.readyState: ").concat(R.io.readyState))})),R.on("reconnecting",(function(e){var t=new Date;R.io.opts.transports=T,"socket io reconnecting number: ".concat(e,",time: ").concat(t,",channel.readyState: ").concat(R.io.readyState," attempt_transports:").concat(O," pollingReopenCount:").concat(j," pollingAttemptNumber:").concat(x),f.onReopenCount()>=j&&R.io.backoff.attempts>=x&&(R.io.opts.transports=O,r.b.run(s.CONFIG.REPORT_FOR_PLATFORM,{PC:33862722,Android:33862727,IOS:33862728}));var n=f.getSocketChannelInfo();n||(n={}),C("reconnecting channel io transports".concat(R.io.opts.transports," pollingReopenCount = ").concat(j," pollingAttemptNumber=").concat(x)),n.event="reconnecting",f.onSocketStatusChanged(R.io.readyState,n)})),R.on("retry",(function(e){"ok"!=e&&2==e.length&&(f.md=e);var t=new Date;C("".concat("socket io retry ,time: ").concat(t)),w("Server restarted or socket timed out on server. serverRetry offlineEdit")})),R.on("disconnect",(function(e){var t=new Date;C("socket io disconnect, msg: ".concat(JSON.stringify(e),",time: ").concat(t,",channel.readyState: ").concat(R.io.readyState));var n=f.getSocketChannelInfo();n||(n={}),n.event="disconnect",m||(m="".concat(JSON.stringify(e)," ClosedByOthers. WS disconnect offlineEdit")),n.disconnectReason="".concat(JSON.stringify(e)," ").concat(m),f.onSocketStatusChanged(R.io.readyState,n)})),R.on("connect_failed",(function(e){C("socket io connect_failed"),v(b,"socketing",500,(function(){w("".concat(JSON.stringify(e)," connect_failed Closed by client. WS connect_failed offlineEdit"))}))})),R.on("error",(function(e){C("socket io error"),v(b,"socketing",500,(function(){w("".concat(JSON.stringify(e)," socket io error Closed by client. WS error offlineEdit"))}))})),R.on("reconnect_failed",(function(e){C("socket io reconnect_failed"),w("".concat(JSON.stringify(e)," reconnect_failed Closed by client. WS reconnect_failed offlineEdit"))})),R.io&&R.io.engine&&R.io.engine.transport&&R.io.engine.transport.ws){var D=R.io.engine.transport.ws.onclose;R.io.engine.transport.ws.onclose=function(e){if(D&&D(),!c){if(f.onlogWarn("websocket close code = ".concat(e.code," reason = ").concat(e.reason)),!l){r.b.run(s.CONFIG.REPORT_FOR_PLATFORM,{PC:35056762,Android:35056763,IOS:35056764});var t=new Date;setTimeout((function(){r.b.run(s.CONFIG.WEBSOCKET_CLOSE,[t])}),6e4)}l=!0}}}}()},this.disconnect=function(e){e||(e="Closed by client. forceClosed "),k(e),g=!0},this.postMessageForWebSocket=function(e){var t=+new Date;" ================= doPostMessages  officialChannel.send id: ".concat(t," ========= data: ").concat(JSON.stringify(e)),p&&p.emit("post",e)},this.getSocketChannelInfo=function(){var e=null;return p&&((e={}).connected=p.connected,e.disconnected=p.disconnected,p.io&&(e.readyState=p.io.readyState,e.reconnecting=p.io.reconnecting)),e},this.describe=function(){return name}}function d(e){var t=0,n=0,o=0,s=!1,i=0,a=0,c=0,l="unknow",u=0,d=0,h=0,f=0,p="unknow";function m(){t=0,n=0,o=0,i=0,a=0,c=0,l="unknow",u=0,p="unknow",s=!1,d=0,h=0}function g(){var s={module:e,type:"room_open",closeReason:"unknow",roomState:p,startOpenTime:0,endOpenTime:0,openTotalTime:0,connectTime:0,loginTime:0,delayOpenTime:0,reconnectCount:0,loginCount:0,bShutDown:0,bNeedNotify:0,bFirstConnect:0};s.bShutDown=d,s.bNeedNotify=h,s.bFirstConnect=f,l&&(s.closeReason=l),s.startOpenTime=t,s.endOpenTime=n,n&&t&&n-t>0&&(s.openTotalTime=n-t),a&&t&&a-t>0&&(s.connectTime=a-t),a&&n&&n-a>0&&(s.loginTime=n-a),o&&t&&t>o&&(s.delayOpenTime=t-o),s.reconnectCount=c,s.loginCount=u;var i=s.module+"TDSP"+s.type+"TDSP"+s.closeReason+"TDSP"+s.roomState+"TDSP"+s.startOpenTime+"TDSP"+s.endOpenTime+"TDSP"+s.openTotalTime+"TDSP"+s.connectTime+"TDSP"+s.loginTime+"TDSP"+s.delayOpenTime+"TDSP"+s.reconnectCount+"TDSP"+s.loginCount+"TDSP"+s.bShutDown+"TDSP"+s.bNeedNotify+"TDSP"+s.bFirstConnect+"TDSP",m={opername:"tech_doc_websocket",module:"websocket_collab",action:"room_connect",table:"dc03111",ver6:i};c>1&&(m.ver8=window.__globalReleaseVersion),r.b.tdwReport(m)}function b(t,n){var o={module:e,type:"socket_connect",roomState:p,closeReason:"unkown",startConnectTime:0,endConnectTime:0,connecTotalTime:0,connectNum:0},s=(new Date).getTime();o.startConnectTime=i,o.endConnectTime=s,o.connecTotalTime=o.endConnectTime-o.startConnectTime,o.connectNum=c,!0===t?o.closeReason="suc":(o.closeReason="unkown",n&&(o.closeReason=n));var a=[o.module,o.type,o.roomState,o.closeReason,o.startConnectTime,o.endConnectTime,o.connecTotalTime,o.connectNum].join("TDSP")+"TDSP",l={opername:"tech_doc_websocket",module:"websocket_collab",action:"socket_connect",table:"dc03111",ver6:a};r.b.tdwReport(l)}e||(e="unknow"),this.reportRoomState=function(e){p=e},this.reportNetWorkEvent=function(e,r){"setupSocket"===e?(m(),c=1,t=(new Date).getTime(),i=(new Date).getTime(),s=!0):"connectfail"===e?(b(!1,r.reason),s=!1,i=0):"reconnecting"===e?(!0===s&&b(!1,"reconnecting unknow"),c+=1,i=(new Date).getTime(),s=!0,0===t&&(m(),c=1,t=(new Date).getTime(),i=(new Date).getTime(),s=!0)):"connect"===e?(a=(new Date).getTime(),b(!0),i=0,s=!1):"open"===e?(n=(new Date).getTime(),l="suc",h=1,f=!0===r.bFirstConnect?1:0,g(),m()):"close"===e?(!0===s&&r.closeReason&&r.closeReason.indexOf("Timeout connecting")>=0&&b(!1,r.closeReason),n=(new Date).getTime(),l=r.closeReason,d=!0===r.bShutDown?1:0,h=!0===r.bNeedNotify?1:0,f=!0===r.bFirstConnect?1:0,g(),m(),o=(new Date).getTime()):"login"===e&&(u+=1)}}function h(e){e||(e="unkown"),this.reportMsg=function(t,n){var s={seq:0,cmd:"null",errCode:0,errMsg:"",retryCount:0,dataSize:0,postTime:0,waitAcceptTime:0,totoalTime:0,allTotoalTime:0,waitAcceptCmd:"null",bFinish:1,module:e};s.seq=t.seq,s.cmd=t.cmd,s.retryCount=t.retryCount,s.dataSize=t.postData.length,!0===n.needRetry?s.bFinish=0:s.bFinish=1,t.postTime&&t.lastSendTime&&t.postTime>t.lastSendTime&&(s.postTime=t.postTime-t.lastSendTime);var i=(new Date).getTime();if(t.lastSendTime&&i>t.lastSendTime&&(s.totoalTime=i-t.lastSendTime),s.waitAcceptTime=s.totoalTime-s.postTime,t.firstSendTime&&i>t.firstSendTime&&(s.allTotoalTime=i-t.firstSendTime),n.waitAcceptCmd&&(s.waitAcceptCmd=n.waitAcceptCmd),"netStatusChange"===n.event&&(s.errCode=n.errCode,s.errMsg=n.errMsg),"onpost"===n.event&&(s.errCode=n.errCode,0===n.errCode?s.errMsg="suc":n.errMsg&&0!==n.errMsg.length?s.errMsg=n.errMsg:s.errMsg="onpost error"),"onsendAccept"===n.event)if("ACCEPT_COMMIT"===n.waitAcceptCmd)s.errCode=0,s.errMsg="suc";else if("COMMIT_ERROR"===n.waitAcceptCmd){var a=n.response.data;s.errCode=a.reason,a.msg&&(s.errMsg=a.msg)}else"TASK_DUPLICATE"===n.waitAcceptCmd&&(s.errCode=0,s.errMsg="suc");a={opername:"tech_doc_websocket",module:"websocket_collab",action:"sendMsg",table:"dc03111",ver6:s.module+"TDSP"+s.seq+"TDSP"+s.cmd+"TDSP"+s.errCode+"TDSP"+s.errMsg+"TDSP"+s.retryCount+"TDSP"+s.dataSize+"TDSP"+s.postTime+"TDSP"+s.waitAcceptTime+"TDSP"+s.totoalTime+"TDSP"+s.allTotoalTime+"TDSP"+s.waitAcceptCmd+"TDSP"+s.bFinish+"TDSP"};if(t.postData&&t.postData.indexOf("changeSetCount")>0&&t.postData.indexOf("\n")>0)for(var c=t.postData.split("\n"),l=0;l<c.length;l++){var u=c[l];"object"===Object(o.a)(JSON.parse(u))&&(JSON.parse(u).hasOwnProperty("changeSetCount")&&(a.obj3=JSON.parse(u).changeSetCount),JSON.parse(u).hasOwnProperty("offlineMsg")&&(a.ver5=JSON.parse(u).offlineMsg))}"USER_CHANGES"===t.cmd&&(a.ver3="USER_CHANGES",a.ver4=s.errCode,a.ver8=window.__globalReleaseVersion),r.b.tdwReport(a)}}var f=n("../packages/common-utils/src/cookie.ts");function p(e,t,n){var r=this;this.emRoomState={INIT:"INIT",CONNECTING:"CONNECTING",OPENED:"OPENED",RECONNECTING_In_CLOSED:"RECONNECTING_In_CLOSED",SHUTDOWN:"SHUTDOWN"},this.emRoomErrCode={suc:0,timeout:101,parameterErr:102,exist:103,roomDisconnect:104,roomClose:105,roomStateErr:106};var s,i,a=new d(n),c=new h(n),l=e.padId,p=e.globalPadId,m=e.pver,g=e.apid,b=e.wmode,_=e.websocketReopenCount,v=e.pollingAttemptNumber,y=e.client&&e.client.upid,w=e.client&&e.client.sid,k=e.client&&e.client.tid,C=e.client&&e.client.sig,S=t,E=0,T=5e3,O=0,j=0,x=0,R=0,D=0,I=[],N=0,A=0,M=0,P=0,L=[],B=[],F=r.emRoomState.INIT,U=!0,z=0,H=!0,q=!1;function Q(){ve("socket  reopen "),G(),de(),oe(),r.open()}function V(){return N}function G(){i&&(i.onmessage=function(){},i.onpostmessage=function(){},i.onSocketClosed=function(){},i.onSocketOpened=function(){},i.onSocketStatusChanged=function(){},i.onlogmessage=function(){},i.onReopenCount=function(){},i.onlogWarn=function(){},i.disconnect()),i=null}function W(e,t,n){we("socket notifyRoomClosed, closeReason = ".concat(e,",bShutDown= ").concat(t,", delayOpenTime =").concat(n,", time:").concat(new Date,", socketId:").concat(r.socketId)),A&&(clearTimeout(A),A=0),U=!0;var o=r.getRoomState();de(),oe(),function(){for(var e=function(e){var t=L[e];!function(){var e=t,n={errCode:r.emRoomErrCode.roomClose,errMsg:"room close"};e.onsendAccept&&e.waitAcceptCmd?setTimeout((function(){e.onsendAccept(e.seq,e.cmd,e.data,null,n)}),10):e.onsend&&setTimeout((function(){e.onsend(e.seq,e.cmd,e.data,n)}),10)}();var n={errCode:r.emRoomErrCode.roomClose,errMsg:"room close",event:"netStatusChange",needRetry:!1};c.reportMsg(t,n)},t=0;t<L.length;t++)e(t);L=[],P&&(clearTimeout(P),P=0)}();var s=!0===t;o!==r.emRoomState.RECONNECTING_In_CLOSED&&(s=!0);var l={closeReason:e,bShutDown:t,bNeedNotify:s,bFirstConnect:H};if(a.reportNetWorkEvent("close",l),H=!1,!0===t)return function(){i=null,N=0,I=[],M&&(clearTimeout(M),M=0);A&&(clearTimeout(A),A=0);oe(),de()}(),le(r.emRoomState.SHUTDOWN,e),void(o!==r.emRoomState.SHUTDOWN&&r.onShutDown(e));le(r.emRoomState.RECONNECTING_In_CLOSED,e),function(e,t){if(M)return;I.push(+new Date),N+=1;var n,o=t;if(!t){var s=Math.min(3e4,1e3*Math.pow(2,N+1));i=.4*s,n=s+Math.floor(Math.random()*(2*i+1)-i),ve("socket delayReopen delayTime = ".concat(o=n,", fuzzedRetryDelay  =  ").concat(n))}var i;M=setTimeout((function(){M&&(clearTimeout(M),M=0),r.open()}),o)}(0,n),o!==r.emRoomState.RECONNECTING_In_CLOSED&&r.onClose(e)}function Y(){N=0,I=[],q=!1,U=!1,ve("socket onSocketOpenEvent : ".concat(new Date)),A&&(clearTimeout(A),A=0),M&&(clearTimeout(M),M=0),a.reportNetWorkEvent("connect"),de(),oe(),te()}function K(e){we("socket onSocketClosedEvent : ".concat(new Date)),i&&(i.onmessage=function(){},i.onpostmessage=function(){},i.onSocketClosed=function(){},i.onSocketOpened=function(){},i.onSocketStatusChanged=function(){},i.onlogmessage=function(){},i.onReopenCount=function(){},i.onlogWarn=function(){}),i=null,W(e,!1),q&&r.onNetReconnectedFail()}function J(e,t){if(e&&t&&t.event){var n=t.event;if("reconnecting"===n)ve("socket onSocketStatusChanged receive reconnecting time: ".concat(new Date)),q=!0,a.reportNetWorkEvent(n);else if("connect_timeout"===n||"connect_error"===n){ve("socket onSocketStatusChanged receive connect_timeout or connect_error time: ".concat(new Date));var o={failReason:t.failReason};a.reportNetWorkEvent("connectfail",o)}else if("disconnect"===n){ve("socket onSocketStatusChanged receive disconnect time: ".concat(new Date)),U=!0;var s="close by disconnect ";t.disconnectReason&&(s+=t.disconnectReason),A||(oe(),de(),function(){for(var e=0;e<L.length;)if(("sending"===L[e].state||"waitAccept"===L[e].state)&&L[e].retryCount>=L[e].maxRetryCount){if("continue"===function(){var t=L[e];!function(){var e=t,n={errCode:r.emRoomErrCode.roomDisconnect,errMsg:"room Disconnect"};e.onsendAccept&&e.waitAcceptCmd?setTimeout((function(){e.onsendAccept(e.seq,e.cmd,e.data,null,n)}),10):e.onsend&&setTimeout((function(){e.onsend(e.seq,e.cmd,e.data,n)}),10)}(),B.push(L[e]),L.splice(e,1);var n={errCode:r.emRoomErrCode.roomDisconnect,errMsg:"room Disconnect",event:"netStatusChange",needRetry:!1};return c.reportMsg(t,n),"continue"}())continue}else{if("sending"===L[e].state||"waitAccept"===L[e].state){var t=L[e];L[e].state="waiting";var n={errCode:r.emRoomErrCode.roomDisconnect,errMsg:"room Disconnect",event:"netStatusChange",needRetry:!0};c.reportMsg(t,n)}e+=1}}(),A=setTimeout((function(){ve("socket onSocketStatusChanged do disconnect time: ".concat(new Date)),G(),W(s,!1)}),15e3)),a.reportNetWorkEvent(n)}}}function Z(e){x=setTimeout((function(){te()}),e)}this.onRoomStateChange=function(){},this.onOpen=function(){},this.onClose=function(){},this.onShutDown=function(){},this.onReceivMessageFromServer=function(){},this.onNetReconnectedFail=function(){},this.getPadRev=function(){},this.getHeaderGeneralPacket=function(){},this.getRoomState=function(){return F},this.open=function(){i?ye("socket open setUpSocket socket has exist"):r.getRoomState()!==r.emRoomState.shutDown?(s=String(Math.floor(1e12*Math.random())),ve("socket open setUpSocket ".concat(s)),(i=new u(s,l,p,y,C,b,_,v)).onmessage=he,i.onpostmessage=ae,i.onSocketClosed=K,i.onSocketOpened=Y,i.onSocketStatusChanged=J,i.onlogmessage=ve,i.onReopenCount=V,i.onlogWarn=ye,i.connect(),r.socketId=s,r.socket=i,z=(new Date).getTime(),r.getRoomState()===r.emRoomState.INIT?le(r.emRoomState.CONNECTING):le(r.emRoomState.RECONNECTING_In_CLOSED),a.reportNetWorkEvent("setupSocket")):we("socket open setUpSocket socket error: the room state is shutdown")},this.reOpenAfterShutDown=function(){le(r.emRoomState.INIT,"reOpenCollabRoom"),Q()},this.closeAndDelayReopen=function(e,t){setTimeout((function(){e||(e="close by client"),ve("closeAndDelayReopen closeReason = ".concat(e," delayOpenTime = ").concat(t)),G(),W(e,!1,t)}),0)},this.shutDown=function(e){setTimeout((function(){ve("shutDown  closeReason =".concat(e,", shutDown socketId =").concat(r.socketId)),e||(e="close by client"),G(),W(e,!0)}),0)},$(window).on("online",(function(){ve(" browser online time: ".concat(new Date))})),$(window).on("offline",(function(){ve(" browser offline time: ".concat(new Date))}));var X=0,ee=null;function te(){ve("loginRoom"),D&&(clearTimeout(D),D=0),j+=1,R=r.createMessageSeq();var e={roomType:"padpage",roomName:"padpage/".concat(p),upid:y,gid:p,sid:w,tid:k,sig:C,data:{stats:ce()}};ee=re("CLIENT_READY",R,JSON.stringify(e)),i.postMessageForWebSocket(ee),X=(new Date).getTime(),D=setTimeout((function(){ve("loginRoom loginTimeout seq = ".concat(R));var e={errCode:r.emRoomErrCode.timeout,errMsg:"timeout error"};ne(R,"CLIENT_READY",e)}),3e3),a.reportNetWorkEvent("login")}function ne(e,t,n){D&&(clearTimeout(D),D=0);var o=(new Date).getTime(),s={cmd:"CLIENT_READY",seq:R,postData:ee,retryCount:j,lastSendTime:X,onpostTime:o,firstSendTime:X},i={errCode:0,event:"onpost",needRetry:!1};if(R=0,0===n.errCode&&n.response&&n.response.onpost&&(0===n.response.onpost.result||60009===n.response.onpost.result))!function(e){le(r.emRoomState.OPENED),oe(),de(),ue(e.heartbeat_interval),L.length&&setTimeout((function(){se()}),0);var t={bFirstConnect:H};a.reportNetWorkEvent("open",t),H=!1,setTimeout((function(){r.onOpen()}),0)}(n.response.onpost),i.errCode=n.response.onpost.result;else if(0!==n.errCode)we("handleLoginResponse onpost fail, retry, client result = ".concat(n.errCode)),j>=2?(we("handleLoginResponse login fail loginCount = ".concat(j,", errCode =").concat(n.errCode)),oe(),r.closeAndDelayReopen(me(n.errCode,"login fail")),i.needRetry=!1):(Z(1500),i.needRetry=!0),i.errCode=n.errCode,i.event="netStatusChange";else{var l=n.response.onpost.result;i.errCode=l,i.event="onpost";var u=1500;n.response.onpost.retry_interval&&(u=n.response.onpost.retry_interval),we("handleLoginResponse login fail loginCount = ".concat(j,", errCode =").concat(l)),60004===l||60005===l||60011===l||60013===l||60014===l||60021===l||60022===l?j>=2?(oe(),60021===l||60022===l?r.shutDown(me(l," login fail timeout")):r.closeAndDelayReopen(me(l," login fail timeout")),i.needRetry=!1):(we("".concat(" collab Room ","handleLoginResponse onpost fail, retry, server result = ").concat(l)),Z(u),i.needRetry=!0):60001===l||60002===l?(r.closeAndDelayReopen(me(l,"login fail")),i.needRetry=!1):60003===l||60007===l||60008===l||60010===l||60015===l||6e4===l||60006===l?(r.shutDown(me(l,"login fail")),i.needRetry=!1):40029===l?(r.shutDown(me(l,"")),i.needRetry=!1):(r.shutDown(me(l,"login fail")),i.needRetry=!1)}0!==i.errCode&&(i.errMsg=me(i.errCode)),c.reportMsg(s,i)}function oe(){j=0,R=0,D&&(clearTimeout(D),D=0),x&&(clearTimeout(x),x=0)}function re(e,t,n){var o=0;0===S.indexOf("g")&&(o=1);var s=S.replace("p.","").replace("g.",""),i=Object(f.getCookie)("wl"),a={type:e,task_id:t,docid:p,uid:s,u:window.nowUserIndex,cookie:ge(),base_rev:r.getPadRev(),code_ver:m,session_type:o,gray:0,dver:window._grayVersion||"1.0.0",wl:i,generalpacket:r.getHeaderGeneralPacket()};g&&(a.apid=g);var c="".concat(JSON.stringify(a),"\n");return n&&(c+=n),c}function se(){if(!0!==ie()){if(!1!==function(){if(L.length<=0)return ve("Can't sendMessage messageQueue.length = 0"),!1;if(r.getRoomState()!==r.emRoomState.OPENED||!1!==U)return we("Can't sendMessage the room state not open, state = ".concat(r.getRoomState()," bWebsocketDisconneted = ").concat(U)),!1;for(var e=0;e<L.length;e++)if("sending"===L[e].state)return ve("Can't sendMessage there is a sending message, seq = ".concat(L[e].seq," cmd=").concat(L[e].cmd)),!1;return!0}())for(var e=0;e<L.length;e++)if("waiting"===L[e].state){0!==L[e].retryCount&&L[e].firstSendTime||(L[e].firstSendTime=(new Date).getTime()),L[e].retryCount=L[e].retryCount+1,L[e].lastSendTime=(new Date).getTime(),L[e].onpostTime=0,L[e].state="sending",i.postMessageForWebSocket(L[e].postData),pe();break}}else Q()}function ie(){if(r.getRoomState()===r.emRoomState.CONNECTING||r.getRoomState()===r.emRoomState.RECONNECTING_In_CLOSED||r.getRoomState()===r.emRoomState.RECONNECTING_In_CLOSED){var e=(new Date).getTime();if(z&&e>z&&e-z>5e4)return!0}return!1}function ae(e){try{var t=e.split("\n");if(t.length<2)return void we(" onPostFromServer error\uff1a msg is not right");var n=JSON.parse(t[0]);if("HEART_BEAT"===n.type)return void function(e,t){var n;O=0,t&&t.onpost&&t.onpost.heartbeat_interval&&(n=t.onpost.heartbeat_interval);ue(n)}(0,JSON.parse(t[1]));if("CLIENT_READY"===n.type&&n.task_id===R){var s=JSON.parse(t[1]),i={errCode:r.emRoomErrCode.suc,errMsg:"",response:s};return void ne(n.task_id,n.type,i)}for(var a=!1,l=0;l<L.length;l++)if(L[l].seq===n.task_id&&L[l].cmd===n.type){var u=function(){a=!0,L[l].onpostTime=(new Date).getTime();var e=L[l],n=JSON.parse(t[1]),o=n.onpost.result,s=n.onpost.retry_interval;if(0!==o&&we("onPostFromServer end to parse  errcode = ".concat(n.onpost.result)),!L[l].waitAcceptCmd||0!==o){var i="suc";0!==o&&(i=me(o));var u={errCode:o,errMsg:i,event:"onpost",response:n,needRetry:!1};c.reportMsg(e,u)}if(6e4===o||60006===o)return r.shutDown(me(o)),{v:void 0};if(60001===o)return r.closeAndDelayReopen(me(o),s),{v:void 0};var d={errCode:r.emRoomErrCode.suc,errMsg:"",response:n};return e.onsend&&function(){var t=d,n=e;setTimeout((function(){n.onsend(n.seq,n.cmd,n.data,t)}),10)}(),L[l].waitAcceptCmd&&0===o?L[l].state="waitAccept":(B.push(L[l]),L.splice(l,1)),L.length&&setTimeout((function(){se()}),10),"break"}();if("break"===u)break;if("object"===Object(o.a)(u))return u.v}var d=!1;if(!1===a)for(var h=0;h<B.length;h++)if(B[h].seq===n.task_id&&B[h].cmd===n.type){d=!0;break}!1===d&&!1===a&&ye("the onPostFromServer not found\uff1a seq=".concat(n.task_id," cmd = ").concat(n.type)),B.length>50&&B.splice(0,B.length-50)}catch(f){we("".concat(" collab Room ","onPostFromServer error parse msg exception = ").concat(f))}}function ce(){var t={};return t.screen=[$(window).width(),$(window).height(),window.screen.availWidth,window.screen.availHeight,window.screen.width,window.screen.height].join(","),t.ip=e.clientIp,t.useragent=e.clientAgent,t}function le(e,t){var n="Channel state being set to ".concat(e);e!=F&&(F=e,setTimeout((function(){r.onRoomStateChange(F,t)}),0),a.reportRoomState(F),ve(n))}function ue(e){if(e&&(T=e),!E){var t=function(){for(var e=0,t=0;t<L.length;t++)"sending"===L[t].state&&(e=L[t].postData.length);if(e>2097152){var n=be(e)/2;return n>T?n:T}return T}();E=setTimeout((function(){!function(){E&&(clearTimeout(E),E=0);if(r.getRoomState()!==r.emRoomState.OPENED||!i)return void we("sendBeatHeartOnTimer the room state not open state =  ".concat(r.getRoomState()));O>0&&ye("sendBeatHeartOnTimer fail count over 1, the fail beatHeartCount = ".concat(O));if(O>=3)return we("sendBeatHeartOnTimer  reach to max BeatHeartCount closeAndDelayReopen"),void r.closeAndDelayReopen("close by beatHeart fail");O+=1;var e=r.createMessageSeq(),t=S.replace("p.","").replace("g.",""),n={type:"HEART_BEAT",task_id:e,docid:p,uid:t},o="".concat(JSON.stringify(n),"\n");i.postMessageForWebSocket(o),ue()}()}),t)}}function de(){E&&(clearTimeout(E),E=0),O=0,T=5e3}function he(e){try{var t=e.split("\r\n");if("[object Array]"!==Object.prototype.toString.call(t))return void we("===== onGetMessageFromServer  parse msg error\uff0c is not Array =====");for(var n=function(e){var n=t[e].split("\n");if(n.length<2)return we("".concat(" collab Room ","onGetMessageFromServer error\uff1a msg is not right")),{v:void 0};var o=JSON.parse(n[0]),s=void 0;if(n[1]&&(s=JSON.parse(n[1])),"QUIT_NOTICE"===o.type&&"INACTIVE"===s.notice.quit_type)return function(){if(L.length>0)return;r.shutDown("close by server INACTIVE")}(),"continue";if(L.length<=0){for(var i=!1,a=0;a<B.length;a++)if(B[a].seq===o.task_id){i=!0;break}return!1===i&&fe(o,s),"continue"}for(var l=!1,u=0;u<L.length;u++){if(o.task_id===L[u].seq)if("break"===function(){var e=L[u];if(l=!0,L[u].waitAcceptCmd&&L[u].waitAcceptCmd.indexOf(o.type)>=0){var t=o.type,n={errCode:0,errMsg:"",response:{new_rev:o.new_rev,body:s}};e.onsendAccept&&function(){var r=e,s=t,i=n;setTimeout((function(){r.onsendAccept(r.seq,r.cmd,r.data,s,i,o)}),10)}(),B.push(L[u]),L.splice(u,1);var r={waitAcceptCmd:t,event:"onsendAccept",response:s,needRetry:!1};return c.reportMsg(e,r),"break"}return we("".concat("===== onGetMessageFromServer the msg found in messageQueue, but waitcmd not equal (error) ===== the seq = ").concat(o.task_id," the msg cmd =").concat(L[u].cmd," the server wait cmd =").concat(o.type)),"break"}())break}var d=!1;if(!1===l)for(var h=0;h<B.length;h++)if(B[h].seq===o.task_id&&B[h].waitAcceptCmd&&B[h].waitAcceptCmd.indexOf(o.type)>=0){d=!0;break}!1===l&&!1===d&&fe(o,s)},s=0;s<t.length;s++){var i=n(s);if("continue"!==i&&"object"===Object(o.a)(i))return i.v}}catch(a){we("onGetMessageFromServer error parse msg exception = ".concat(a))}}function fe(e,t){var n={new_rev:e.new_rev,body:t,socketId:r.socketId,ts:e.ts};setTimeout((function(){r.onReceivMessageFromServer(e.type,n)}),10)}function pe(){P||(P=setTimeout((function(){!function(){P&&(clearTimeout(P),P=0);for(var e=!1,t=!1,n=!1,o=0;o<L.length;){var s=(new Date).getTime();("sending"===L[o].state||"waitAccept"===L[o].state)&&s>L[o].lastSendTime&&s-L[o].lastSendTime>L[o].timeout?function(){e=!0;var t=!1,n=L[o];L[o].retryCount<L[o].maxRetryCount?(we("handleMessageTimer the msg timeout error, try again, the seq = ".concat(L[o].seq," the msg cmd =").concat(L[o].cmd," messageQueue[i].retryCount = ").concat(L[o].retryCount," maxRetryCount = ").concat(L[o].maxRetryCount," state = ").concat(L[o].state)),L[o].state="waiting",t=!0,o+=1):(we("handleMessageTimer the msg timeout error, the seq = ".concat(L[o].seq," the msg cmd =").concat(L[o].cmd)),t=!1,function(){var e={errCode:r.emRoomErrCode.timeout,errMsg:"timeout error"},t=n;t.onsend&&setTimeout((function(){t.onsend(t.seq,t.cmd,t.data,e)}),10),t.onsendAccept&&t.waitAcceptCmd&&setTimeout((function(){t.onsendAccept(t.seq,t.cmd,t.data,null,e)}),10)}(),B.push(L[o]),L.splice(o,1));var s={errCode:r.emRoomErrCode.timeout,errMsg:"timeout error",event:"netStatusChange",needRetry:t};c.reportMsg(n,s)}():("sending"===L[o].state&&(t=!0),"waiting"===L[o].state&&(n=!0),o+=1)}B.length>50&&B.splice(0,B.length-50);!1===t&&!0===n&&(e=!0);L.length&&!0===e&&setTimeout((function(){se()}),10);L.length&&pe()}()}),1e3))}function me(e,t){var n=" errMsg, code ".concat(e);switch(e){case 6e4:n="Server Internal Error code ".concat(e);break;case 60001:n="Connection Not Exist code ".concat(e);break;case 60006:n="TX-LOGIN-PSKEY-EXPIRED code ".concat(e);break;case 60003:case 60004:case 60005:case 60011:case 60013:n="TimeOut code ".concat(e);break;case 60007:case 60015:n="UnAuth code ".concat(e);break;case 60008:n="BigData code ".concat(e);break;case 60010:n="MemberFull code ".concat(e);break;case 60014:n="Frequently code ".concat(e);break;case 60021:n="TX-LOGIN-PSKEY-EXPIRED TIMEOUT ".concat(e);break;case 60022:n="UnAuth TIMEOUT code ".concat(e);break;case 40029:n="JS Code Expired ".concat(e)}return t&&(n="".concat(t," ").concat(n)),n}function ge(){var e="";return Object(f.getCookie)("p_luin")&&(e="".concat(e,"p_luin=").concat(Object(f.getCookie)("p_luin"),";")),Object(f.getCookie)("p_lskey")&&(e="".concat(e,"p_lskey=").concat(Object(f.getCookie)("p_lskey"),";")),Object(f.getCookie)("p_skey")&&(e="".concat(e,"p_skey=").concat(Object(f.getCookie)("p_skey"),";")),Object(f.getCookie)("p_uin")&&(e="".concat(e,"p_uin=").concat(Object(f.getCookie)("p_uin"),";")),Object(f.getCookie)("uid")&&(e="".concat(e,"uid=").concat(Object(f.getCookie)("uid"),";")),Object(f.getCookie)("uid_key")&&(e="".concat(e,"uid_key=").concat(Object(f.getCookie)("uid_key"),";")),Object(f.getCookie)("ww_utoken")&&(e="".concat(e,"ww_utoken=").concat(Object(f.getCookie)("ww_utoken"),";")),Object(f.getCookie)("SID")&&(e="".concat(e,"SID=").concat(Object(f.getCookie)("SID"),";")),Object(f.getCookie)("SID_S")&&(e="".concat(e,"SID_S=").concat(Object(f.getCookie)("SID_S"),";")),e}function be(e){return!e||e<5120?3e3:e<1048576||e<2097152?1e4:e<4194304?15e3:e<6291456?2e4:25e3}function _e(){return N<5}function ve(e){var t,n;_e()&&(window.log&&window.log.info&&(null===(t=(n=window.log).info)||void 0===t||t.call(n," collab Room "+e)))}function ye(e){_e()&&window.log&&window.log.warn&&window.log.warn(" collab Room "+e)}function we(e){_e&&window.log&&window.log.error&&window.log.error(" collab Room "+e)}this.sendMessage=function(e,t,n,o,s){return r.sendMessageWaitAcceptCmd(e,t,n,o,s)},this.sendMessageWaitAcceptCmd=function(e,t,n,o,s,i){return!i||o&&o.waitAcceptCmd&&"[object Array]"===Object.prototype.toString.call(o.waitAcceptCmd)?r.getRoomState()!==r.emRoomState.OPENED?(ye(" send message before the room open, state =".concat(r.getRoomState(),", seq = ").concat(t,", cmd=").concat(e)),!0===ie()&&(ye("trySendPendingMessage can not send msg, socket needReopen"),Q()),{errCode:r.emRoomErrCode.roomStateErr,errMsg:"room state can not send msg",cmd:e,seq:t}):function(e,t,n,o,s,i){var a=t;if(a)for(var c=0;c<L.length;c++)if(L[c].cmd===e&&L[c].messageSeq===t){var l={errCode:r.emRoomErrCode.exist,errMsg:"the msg has exist",cmd:e,seq:a};return ye("sendMessageWaitAcceptCmd the message has exist seq = ".concat(a," cmd=").concat(e)),l}a||(a=r.createMessageSeq());var u=re(e,a,n),d=be(u.length);o&&o.timeout&&(o.maxRetryCount>3e4&&(o.maxRetryCount=3e4),d=o.timeout>d?o.timeout:d);var h,f=1;o&&o.maxRetryCount&&(o.maxRetryCount>5&&(o.maxRetryCount=5),f=o.maxRetryCount);o&&o.waitAcceptCmd&&(h=o.waitAcceptCmd);var p={cmd:e,seq:a,data:n,postData:u,timeout:d,maxRetryCount:f,waitAcceptCmd:h,onsend:s,onsendAccept:i,retryCount:0,lastSendTime:0,onpostTime:0,firstSendTime:0,state:"waiting"};return L.push(p),setTimeout((function(){se()}),10),pe(),{errCode:0,errMsg:"",cmd:e,seq:a}}(e,t,n,o,s,i):(we("checkParameter waitAcceptCmd invalid"),{errCode:r.emRoomErrCode.parameterErr,errMsg:"msg custom_param invalid",cmd:e,seq:t})},this.createMessageSeq=function(){var e=(new Date).getTime();return Math.ceil(2147483648*Math.random(e))},this.cancelMessageBySeq=function(e){for(var t=0;t<L.length;t++)if(L[t].seq===e){ve("cancelMessageBySeq seq = ".concat(e));var n=L[t].state;B.push(L[t]),L.splice(t,1),L.length&&"sending"===n&&setTimeout((function(){se()}),10);break}}}},"./src/core/network/socket/socket.ts":function(e,t,n){"use strict";(function(e){n("../node_modules/core-js/modules/es.array.index-of.js"),n("../node_modules/core-js/modules/es.array.join.js"),n("../node_modules/core-js/modules/es.array.slice.js"),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.match.js"),n("../node_modules/core-js/modules/es.string.replace.js"),n("../node_modules/regenerator-runtime/runtime.js");var o=n("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),r=n("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),s=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=n("./src/core/ui/toast/index.ts"),a=n("./src/core/network/socket/collab_room_channel.js"),c=n("./src/base/error/errCodeType.ts"),l=n("../packages/report/src/index.ts"),u=n("./src/base/config/report.ts"),d=n("./src/core/data/configService/spreadConfig.ts"),h=n("../packages/common-utils/src/cookie.ts"),f=n("../node_modules/@tencent/docs-user-agent/dist/index.js"),p=n.n(f),m=n("./src/base/util/timer.ts"),g=n("../node_modules/@tencent/docs_offline/lib/index.js"),b=n("./src/base/error/errorCodeModalProxy.ts"),_=n("./src/base/index.ts"),v=n("./src/base/event/event.ts"),y=n("./src/core/utils/config.ts"),w=n("./src/external/waterMark/config.ts"),k=function(e,t){var n=/^\d+\.\d+/gi,o=e.match(n),r=t.match(n);return!(!o||!r)&&(e=o[0])===(t=r[0])};function C(t,n){var o,r,s;this.hadShowOfflineTip||(this.hadShowOfflineTip=!0,e.navigator.onLine?b.b.server.showServerConnectTimeout("60001",n):(null===(o=this.app.view)||void 0===o||null===(r=o.canvas)||void 0===r||null===(s=r.inputManager)||void 0===s?void 0:s.isInputtingState())&&b.b.client.showNetworkOfflineTip(t,n))}var S=[{errorcode:"60000",monitor:33712329},{errorcode:"60001"},{errorcode:"60002",monitor:33712365},{errorcode:"code=60003",monitor:33712374,code:"60003"},{errorcode:"60003"},{errorcode:"code=60004",monitor:33712379},{errorcode:"code=60004",monitor:33712380},{errorcode:"60005"},{errorcode:"60006",monitor:33713563},{errorcode:"code=60007",monitor:33713595,code:"60007"},{errorcode:"60007"},{errorcode:"code=60008",monitor:33713473,code:"60008"},{errorcode:"60008"},{errorcode:"60010",monitor:33686978},{errorcode:"code=60011",monitor:33712550,code:"60011"},{errorcode:"60011",monitor:33712549},{errorcode:"code=60013",monitor:33712556,code:"60013"},{errorcode:"60013",monitor:33712557},{errorcode:"code=60014",monitor:33712559,code:"60014"},{errorcode:"60014",monitor:33712558},{errorcode:"code=60015",monitor:33712568,code:"60015"},{errorcode:"60015"},{errorcode:"60016"},{errorcode:"code=60017",monitor:33712574,code:"60017"},{errorcode:"INACTIVE",monitor:33712576},{errorcode:"60018",monitor:33712583},{errorcode:"60019",monitor:33712584},{errorcode:"60020",monitor:33712585},{errorcode:"code=60021",monitor:33713418,code:"60021"},{errorcode:"60021",monitor:33713444},{errorcode:"60022",monitor:33713469},{errorcode:"60030",monitor:35454579},{errorcode:"60031",monitor:35463395},{errorcode:"60032",monitor:35463396},{errorcode:"60033",monitor:35463397},{errorcode:"40000"},{errorcode:"40001"},{errorcode:"40002"},{errorcode:"40003"},{errorcode:"40005"},{errorcode:"40006",monitor:33712775},{errorcode:"40020"},{errorcode:"40022"},{errorcode:"40023"},{errorcode:"40024"},{errorcode:"40025"},{errorcode:"40026"},{errorcode:"40028"},{errorcode:"40029"},{errorcode:"40030"},{errorcode:"40034"},{errorcode:"40035",monitor:34834688},{errorcode:"40036"},{errorcode:"40037"},{errorcode:"40203"},{errorcode:"41001"},{errorcode:"41002"},{errorcode:"10000"},{errorcode:"10001"},{errorcode:"70001",code:c.a.NOT_VIP_FULL}],E=[{errorcode:c.a.SOCKET_NOT_SET_UP},{errorcode:c.a.PERMISSION_CHANGE},{errorcode:c.a.APPLY_NEW_CHANGE_ERROR},{errorcode:c.a.KICK},{errorcode:c.a.SHEET_ID_ERROR_1},{errorcode:c.a.DATABASE_ERROR},{errorcode:c.a.TASK_RUN_ERROR},{errorcode:c.a.FRONTEND_SOCKET_ERROR_CODE_UNDEFINED},{errorcode:c.a.COMMIT_ERROR_CODE_UNDEFINED},{errorcode:c.a.TASK_DUPLICATE_VERSION_TOO_LOW}],T=function(){function t(n,o){var s,i;if(Object(r.a)(this,t),this.onceOpened=!1,this.hadShowOfflineTip=!1,null===(s=e.log)||void 0===s||s.info("flow MessageService new Socket()"),this.app=n,this.messageCenter=(null===o||void 0===o?void 0:o.messageCenter)||null,this._containerID=e.containerID,!e.WebSocket||!e.WebSocket.prototype||!e.WebSocket.prototype.send)return i=p.a.isIOS?3078272:p.a.isAndroid?3078271:3078270,void l.b.monitor(i);this.loopProbe()}return Object(s.a)(t,[{key:"dispose",value:function(){this.destroy()}},{key:"destroy",value:function(){var t,n;null===(t=e.log)||void 0===t||t.debug("flow socket destroy()",this.containerID),null===(n=this.client)||void 0===n||n.shutDown("LOAD_NEW_DOC"),this.onceOpened=!1,this.hadShowOfflineTip=!1,this.offlineSnackbar=void 0,this.timer=void 0,this.lastShutDownReason=""}},{key:"restart",value:function(){this.init()}},{key:"handleRevert",value:function(){Object(i.showToast)("\u6587\u6863\u5df2\u88ab\u8fd8\u539f",{},{supportMobile:!0,toolToastCloseTime:2e3}),m.a.wait(2e3).run((function(){e.location.reload()}))}},{key:"hideOfflineTips",value:function(){var e,t;null===(e=this.offlineSnackbar)||void 0===e||null===(t=e.close)||void 0===t||t.call(e)}},{key:"reOpen",value:function(){this.client?this.client.reOpenAfterShutDown():this.init()}},{key:"init",value:function(){var t=this;this.client=new a.a(e.clientVars.collab_client_vars,e.clientVars.userId,"excel"),this.client.onReceivMessageFromServer=this.handleMessageFromServer.bind(this),this.client.onRoomStateChange=this.handleRoomStateChange.bind(this),this.client.onNetReconnectedFail=this.handleNetReconnectedFail.bind(this),this.client.getHeaderGeneralPacket=this.getHeaderGeneralPacket.bind(this),this.client.onShutDown=this.handleShutDown.bind(this),this.client.onOpen=this.handleSocketOpen.bind(this),this.client.getPadRev=this.getPadRev.bind(this),this.client.open(),$(window).bind("unload",(function(){t.client.shutDown("unload")}))}},{key:"loopProbe",value:function(){var e=this;d.a.getConfig("isOverConNum")&&!d.a.getConfig("isCreator")||d.a.getConfig("isSnapshot")||d.a.getConfig("isPreview")||d.a.getConfig("isFormPreview")||Object(y.a)()||"D0000000000000001"===d.a.getConfig("upid")||(this.init(),m.a.wait(9e4).run((function(){var t;(null===(t=e.app.offlineEdit)||void 0===t?void 0:t.isFullOffline())||e.client&&"SHUTDOWN"===e.client.getRoomState()||e.client&&e.onceOpened||(l.b.run(u.CONFIG.NETWORK_ERROR),e.client?e.client.shutDown(c.a.SOCKET_NOT_SET_UP):e.app.event.errorCode.trigger("errorCode",{type:"front",code:c.a.SOCKET_NOT_SET_UP}))})))}},{key:"paddingNumber",value:function(e,t){return(Array(t).join("0")+e).slice(-t)}},{key:"getTimeStr",value:function(){var e=new Date;return e.getFullYear()+this.paddingNumber(e.getMonth()+1,2)+this.paddingNumber(e.getDate(),2)}},{key:"getHeaderGeneralPacket",value:function(){var t={};return e.__globalReleaseVersion&&(t.rel_rev=e.__globalReleaseVersion),e.__globalCodeVersion&&(t.dver=e.__globalCodeVersion),t.right_tag=this.app.sheetStatus.workbookStatus.canEdit?1:0,t}},{key:"getPadRev",value:function(){return this.app.messageCenter.sendMessageCenter.commitingQueue?this.app.messageCenter.sendMessageCenter.commitingQueue.baseVersion:this.app.messageCenter.currentVersion}},{key:"handleSocketOpen",value:function(){this.onceOpened=!0}},{key:"handleMessageFromServer",value:function(e,t){var n,o,r;"CODEREV_NEW"!==e&&"LAST_REVERSION"!==e&&"RIGHT_MESSAGE"!==e&&"REVERT_MESSAGE"!==e||l.b.run(u.CONFIG.ACCEPT_MESSAGE,[e,t]);var s={NEW_CHANGES:null===(n=this.messageCenter)||void 0===n?void 0:n.receiveMessageCenter.handleNewChanges.bind(this.messageCenter.receiveMessageCenter),USER_NEWINFO:this.handleUserNewInfo.bind(this),USER_LEAVE:this.handleUserLeave.bind(this),CURSOR_MESSAGE:this.handleCursorMessage.bind(this),RIGHT_MESSAGE:this.handleRightMessage.bind(this),TITLE_MESSAGE:this.handleTitleMessage.bind(this),HANDLE_DELETE:this.handleDeletePad.bind(this),COMM_NOTICE:this.handleCommonNotice.bind(this),CODEREV_NEW:this.handleCodeRevNew.bind(this),LAST_REVERSION:null===(o=this.messageCenter)||void 0===o?void 0:o.receiveMessageCenter.handleLastRervesion.bind(this.messageCenter.receiveMessageCenter),REVERT_MESSAGE:this.handleRevert.bind(this),COMMERCIALIZE_MESSAGE:this.handleCommercializeMessage.bind(this),MARK_MESSAGE:this.handleWatermark.bind(this)};(null===(r=s[e])||void 0===r||r.call(s,t),"READY_ERROR"===e)&&(40029===t.body.data.reason&&this.handleShutDown("40029"))}},{key:"handleWatermark",value:function(e){var t;w.a&&v.c.network.trigger("newWatermark",null===e||void 0===e||null===(t=e.body)||void 0===t?void 0:t.notice)}},{key:"handleCommercializeMessage",value:function(t){e.CollaboratorListInit?document.dispatchEvent(new CustomEvent("commercializeMessage",{detail:t})):function n(){e.CollaboratorListInit?document.dispatchEvent(new CustomEvent("commercializeMessage",{detail:t})):m.a.wait(3e3).run((function(){n()}))}()}},{key:"handleUserNewInfo",value:function(e){var t;v.c.network.trigger("userNewInfo",null===(t=e.body)||void 0===t?void 0:t.notice)}},{key:"handleUserLeave",value:function(e){var t;v.c.network.trigger("userLeave",null===(t=e.body)||void 0===t?void 0:t.notice)}},{key:"handleCursorMessage",value:function(e){var t;v.c.network.trigger("cursor",null===(t=e.body)||void 0===t?void 0:t.notice)}},{key:"handleRightMessage",value:function(e){var t;this.notifyRightChange(null===e||void 0===e||null===(t=e.body)||void 0===t?void 0:t.notice),this.comparePrivilege()}},{key:"handleTitleMessage",value:function(e){var t,n;(null===e||void 0===e||null===(t=e.body)||void 0===t||null===(n=t.notice)||void 0===n?void 0:n.title)&&this.app.spreadsheet.setTitle(e.body.notice.title,!0)}},{key:"handleDeletePad",value:function(e){_.a.event.network.trigger("deletePad")}},{key:"handleCommonNotice",value:function(e){var t;if(null===e||void 0===e||null===(t=e.body)||void 0===t?void 0:t.notice){var n=e.body.notice,o=e.body.notice.type;if("push_message"===o)this.handlePushMessage(n);else if("RELOAD"===o)this.handleReloadMessage(n);else if("DOCCOMMENT_TYPE"===o);else if("DISCUSS_TYPE"===o){var r;(null===(r=this.app.view)||void 0===r?void 0:r.discuss)&&this.app.view.discuss.onReceiveMessagePush(n.payload)}else"RANGE_PRIV_CHANGE"===o&&this.handleRangeAuthMessage(e)}}},{key:"handlePushMessage",value:function(t){if(null===t||void 0===t?void 0:t.message){var n=null,o="";try{o=(n=JSON.parse(t.message)).type}catch(c){var r,s;console.error(c),null===(r=e.log)||void 0===r||r.error(t.message,c.stack),l.b.run(u.CONFIG.PARSE_PUSH_MESSAGE_ERROR,[null===t||void 0===t||null===(s=t.message)||void 0===s?void 0:s.substr(0,1e4)])}if("unbind"===o)this.unbindAccount(n);else if("wl"===o){var i,a;null===(i=e.log)||void 0===i||null===(a=i.ws)||void 0===a||a.call(i,n)}$(window).trigger("notification_message",[t.message])}}},{key:"handleReloadMessage",value:function(e){this.app.event.errorCode.trigger("errorCode",{type:"front",code:c.a.RELOAD}),this.app.permissions.activeShutdownStatus(!1)}},{key:"handleCodeRevNew",value:function(){var t=Object(o.a)(regeneratorRuntime.mark((function t(n){var o,r,s,i,a,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(null===n||void 0===n||null===(o=n.body)||void 0===o?void 0:o.notice)){t.next=16;break}r=n.body.notice,s=r.code_ver,i=r.dver,t.next=5;break;case 5:if(k(i,e._grayVersion)&&s===d.a.getConfig("pver")){t.next=16;break}if(l.b.monitor(33624154),u=location.pathname.replace("/sheet/",""),this.app.offlineEdit.shutDown(),null===(a=this.app.documentManager)||void 0===a||a.notifyNativeSingleDocVersionMap(u,i,!0),t.t0=e.__SUPPORT_FULL_OFFLINE_MODE,!t.t0){t.next=14;break}return t.next=14,g.OfflineAPI.clearDocumentCache(u,d.a.getConfig("uid"));case 14:this.client.shutDown(c.a.KICK),this.app.permissions.activeShutdownStatus(!1);case 16:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"handleRoomStateChange",value:function(e,t){var n=e.toUpperCase();l.b.run(u.CONFIG.ROOM_STATE_CHANGE,[n,t],n),"RECONNECTING_IN_CLOSED"===n?(l.b.monitor(33612136),this.handleOffline(t)):"OPENED"===n&&this.handleOnline(t)}},{key:"handleShutDown",value:function(t){var n,o;if(this.lastShutDownReason=t,l.b.run(u.CONFIG.HANDLE_SHUTDOWN,t),"LOAD_NEW_DOC"!==t&&(this.app.permissions.activeShutdownStatus(!1),"unload"!==t&&t!==c.a.LONG_TIME_HIDDEN)){l.b.monitor(33612127),null===(n=e.log)||void 0===n||n.info("SocketshutDownCommitingQueue",this.app.messageCenter.sendMessageCenter.commitingQueue),null===(o=e.log)||void 0===o||o.info("SocketshutDownWaitingQueue",this.app.messageCenter.sendMessageCenter.waitingQueue.slice(0,3));for(var r=0;r<S.length;r++){var s=S[r];if(-1!==t.indexOf(s.errorcode))return void this.handleErrorCode(s,"socket")}for(var i=0;i<E.length;i++){var a=E[i];if(-1!==t.indexOf(a.errorcode))return void this.handleErrorCode(a,"front")}this.app.event.errorCode.trigger("errorCode",{type:"socket",code:"UNKNOWN"})}}},{key:"handleOffline",value:function(e){var t=this;this.onceOpened&&(this.hadShowOfflineTip||($(window).trigger("networkOffline"),this.app.networkStatus.setSocketOnline(!1),p.a.isIOS&&e&&-1!==e.indexOf("socket io error")||this.app.offlineEdit&&!this.app.offlineEdit.isFullOffline()&&C.call(this,this.app.sheetStatus.canEdit&&!this.app.offlineEdit.isShield,(function(e){t.offlineSnackbar=e})),this.app.getCurrentMainThreadWorker().sheetData.informNetworkChange({type:"networkOffline"})))}},{key:"handleNetReconnectedFail",value:function(){var e=this;p.a.isIOS&&!this.app.offlineEdit.isFullOffline()&&C.call(this,this.app.sheetStatus.canEdit&&!this.app.offlineEdit.isShield,(function(t){e.offlineSnackbar=t}))}},{key:"handleOnline",value:function(e){this.app.messageCenter.sendMessageCenter.restart(),this.hideOfflineTips(),$(window).trigger("networkOnline"),this.app.networkStatus.setSocketOnline(!0),this.hadShowOfflineTip=!1,this.app.getCurrentMainThreadWorker().sheetData.informNetworkChange({type:"networkOnline"})}},{key:"handleRangeAuthMessage",value:function(e){v.c.rangeAuthEvent.trigger("rangeAuthChange",e)}},{key:"notifyRightChange",value:function(t){try{var n;if(""===t.payload||null===t.payload)return void(null===(n=e.SLR)||void 0===n||n.dispatch("TX-AUTH-UPDATED"));var o=JSON.parse(t.payload);if(null===o)return;var r=o.seq;"undefined"===typeof(e.clientVars||{}).msgFilterData&&(e.clientVars.msgFilterData={}),1===o.action?this.handlePermissionChanged(o,r):2===o.action||this.handleExpDate(o)}catch(s){}}},{key:"handlePermissionChanged",value:function(t,n){var o;t&&"undefined"===typeof t[n]?4&d.a.getConfig("rightFlag")&&(null===(o=window.SLR)||void 0===o||o.dispatch("TX-AUTH-UPDATED"),$(window).trigger("permissionChanged"),b.b.changePermission()):delete e.clientVars.msgFilterData[n]}},{key:"handleExpDate",value:function(t){if("undefined"!==t.exptime&&"undefined"!==t.settime&&"undefined"!==t.starttime){var n=t.exptime-t.starttime,o=n;if(n&&n>0){var r={};r.exptime=t.exptime,r.remaintime=o,r.settime=n,r.starttime=t.starttime,e.CoreSheet.advPermissions.onUpdateAuthExpInfo(r)}else console.error("\u6709\u6548\u671f\u53d8\u66f4\u9519\u8bef")}}},{key:"comparePrivilege",value:function(){var e=this;4&d.a.getConfig("rightFlag")||this.app.socket.client.sendMessage("GET_PRIVILEGE",void 0,JSON.stringify({}),void 0,(function(t,n,o,r){var s,i;if(0===r.errCode&&0===(null===(s=r.response)||void 0===s||null===(i=s.onpost)||void 0===i?void 0:i.result)){var a=r.response.onpost.privilege_attribute;d.a.getConfig("canEdit")===a.can_edit&&d.a.getConfig("canRead")===a.can_read||(e.app.socket.client.shutDown(c.a.PERMISSION_CHANGE),e.app.permissions.activeShutdownStatus(!1),$("#editor").blur()),d.a.getConfig("canComment")!==a.can_comment&&(e.app.permissions.setWorkbookStatusCanComment(!1),e.app.socket.client.shutDown(c.a.PERMISSION_CHANGE)),d.a.getConfig("canCopy")!==a.can_copy&&(e.app.permissions.setWorkbookStatusCanCopy(!1),e.app.socket.client.shutDown(c.a.PERMISSION_CHANGE))}}))}},{key:"unbindAccount",value:function(t){var n=Object(h.getCookie)("utype");if(n||console.error("handlePushMessage unbind utype is null!"),"wx"===t.unbind&&"wx"===n)return l.b.monitor(33612279),void e.SpreadsheetApp.socket.client.shutDown("TX-LOGIN-PSKEY-EXPIRED")}},{key:"handleErrorCode",value:function(e,t){e.monitor&&l.b.monitor(e.monitor),this.app.event.errorCode.trigger("errorCode",{type:t,code:e.code||e.errorcode})}},{key:"containerID",get:function(){return this._containerID}}]),t}();t.a=T}).call(this,n("../node_modules/webpack/buildin/global.js"))},"./src/core/ui/toast/domToast.ts":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));n("../node_modules/core-js/modules/es.array.concat.js");function o(e){var t=document.createElement("div");return t.innerHTML=e,t.children[0]}function r(e,t,n){var r=o('\n        <div class="offline-modal-mask" style="\n            opacity: 1;\n            visibility: visible;\n            transition: all .3s cubic-bezier(.4,0,.2,1);\n            pointer-events: auto;\n            background-color: hsla(0,0%,100%,.65);\n            position: fixed;\n            z-index: 9998;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            display: flex;\n            -webkit-box-pack: center;\n            justify-content: center;\n            -webkit-box-align: center;\n            align-items: center;\n        ">\n            <div class="offline-model-container" style="\n                user-select: auto;\n                opacity: 1;\n                transform: scale3d(1,1,1);\n                position: relative;\n                width: 386px;\n                box-sizing: border-box;\n                padding: 20px 23px 24px 23px;\n                border-radius: 4px;\n                box-shadow: 0 2px 6px 0 rgba(0,0,0,.12);\n                background-color: #fff;\n                pointer-events: auto;border: 1px solid #eee;\n                box-shadow: 0 2px 6px 0 rgba(0,0,0,.12);\n                background-color: #fff;\n                pointer-events: auto;\n                -webkit-tap-highlight-color: transparent;\n\n            ">\n                <div class="offline-model-close" style="\n                    position: absolute;\n                    z-index: 1;\n                    width: 20px;\n                    height: 20px;\n                    right: 22px;\n                    top: 23px;\n                    background-size: 16px 16px;\n                    background-image: url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2216%22%20height%3D%2216%22%3E%3Cpath%20fill-rule%3D%22evenodd%22%20d%3D%22M8.977%208.047l4.93%204.97-.976.984L8%209.03%203.07%2014l-.977-.984%204.93-4.97L2%202.984%202.977%202%208%207.062%2013.023%202l.977.984-5.023%205.063z%22%20opacity%3D%22.64%22%2F%3E%3C%2Fsvg%3E);\n                    background-position: center;\n                    background-repeat: no-repeat;\n                    cursor: pointer; \n                "></div>\n                <div class="offline-model-title" style="\n                    font-weight: 500;\n                    font-size: 18px;\n                    margin-bottom: 20px;\n                ">\u7cfb\u7edf\u6d88\u606f</div>\n                <div class="offline-model-content" style="\n                    font-size: 14px;\n                    color: rgba(0,0,0,.88);\n                    height: -webkit-max-content;\n                    height: -moz-max-content;\n                    height: max-content;\n                    min-height: 88px;\n                    display: -webkit-box;\n                    display: -webkit-flex;\n                    display: -ms-flexbox;\n                    display: flex;\n                    -webkit-box-orient: vertical;\n                    -webkit-box-direction: normal;\n                    -webkit-flex-flow: column nowrap;\n                    -ms-flex-flow: column nowrap;\n                    flex-flow: column nowrap;\n                    -webkit-box-pack: center;\n                    -webkit-justify-content: center;\n                    -ms-flex-pack: center;\n                    justify-content: center;\n                    -webkit-box-align: start;\n                    -webkit-align-items: flex-start;\n                    -ms-flex-align: start;\n                    align-items: flex-start;\n                ">'.concat(e,'</div>\n                <div class="offline-model-footer" style="\n                    display: -webkit-box;\n                    display: -webkit-flex;\n                    display: -ms-flexbox;\n                    display: flex;\n                    -webkit-box-pack: end;\n                    -webkit-justify-content: flex-end;\n                    -ms-flex-pack: end;\n                    justify-content: flex-end;\n                    margin-top: 24px;\n                    position: relative;\n                ">\n                    <button class="offline-model-ok" style="\n                        margin-left: 16px;\n                        height: 28px;\n                        background: #0188fb;\n                        color: #fff;\n                        outline: 0;\n                        cursor: pointer;\n                        -webkit-user-select: none;\n                        -moz-user-select: none;\n                        -ms-user-select: none;\n                        user-select: none;\n                        -webkit-box-sizing: border-box;\n                        box-sizing: border-box;\n                        display: inline-block;\n                        white-space: nowrap;\n                        border-radius: 2px;\n                        border: 1px solid transparent;\n                        font-size: 14px;\n                        padding: 0 20px;\n                        -webkit-tap-highlight-color: transparent;\n                    ">\n                        <div class="offline-model-button-content" style="\n                            display: -webkit-box;\n                            display: -webkit-flex;\n                            display: -ms-flexbox;\n                            display: flex;\n                            -webkit-box-orient: horizontal;\n                            -webkit-box-direction: normal;\n                            -webkit-flex-flow: row nowrap;\n                            -ms-flex-flow: row nowrap;\n                            flex-flow: row nowrap;\n                            -webkit-box-pack: center;\n                            -webkit-justify-content: center;\n                            -ms-flex-pack: center;\n                            justify-content: center;\n                            -webkit-box-align: center;\n                            -webkit-align-items: center;\n                            -ms-flex-align: center;\n                            align-items: center;\n                        ">').concat(t,"</div>\n                    </button>\n                </div>\n            </div>\n        </div>\n    "));return r.querySelector(".offline-model-close").addEventListener("click",(function(){document.body.removeChild(r)})),r.querySelector(".offline-model-ok").addEventListener("click",n),document.body.appendChild(r),r}},"./src/core/utils/config.ts":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));n("../node_modules/core-js/modules/es.array.index-of.js");var o=n("./src/core/data/configService/spreadConfig.ts");function r(){return-1!==["local","new"].indexOf(o.a.getConfig("padStatus"))}},"./src/external/offlineEdit/Constant.ts":function(e,t,n){"use strict";var o,r;n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return r})),function(e){e[e.PART=0]="PART",e[e.FULL=1]="FULL"}(o||(o={})),function(e){e[e.CLOSE=0]="CLOSE",e[e.INITING=1]="INITING",e[e.OPEN=2]="OPEN",e[e.INIT_FAILED=3]="INIT_FAILED",e[e.NOT_SUPPORT=4]="NOT_SUPPORT",e[e.ERROR=5]="ERROR"}(r||(r={}))},"./src/external/offlineEdit/hanlder/LocalOfflineDataHandler.ts":function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return g}));n("../node_modules/core-js/modules/es.array.filter.js"),n("../node_modules/core-js/modules/es.array.for-each.js"),n("../node_modules/core-js/modules/es.array.map.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/regenerator-runtime/runtime.js");var o=n("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),r=n("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),s=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=n("../node_modules/@tencent/docs_offline/lib/index.js"),a=n("../packages/report/src/index.ts"),c=n("./src/base/config/report.ts"),l=n("./src/core/network/message-center/model/UserChange.ts"),u=n("./src/core/network/message-center/model/missChange-helper.ts"),d=n("./src/base/index.ts"),h=n("../node_modules/@tencent/dui/lib/components/Snackbar/index.js"),f=n.n(h),p=n("./src/base/error/errCodeType.ts"),m=n("./src/base/error/errorCodeModalProxy.ts"),g=function(){function t(n){Object(r.a)(this,t),this.lastTipsShowTime=0,this.isNeedSyncDataToDatabase=!0,this.parent=n.parent,this.database=n.database,this.isNeedSyncDataToDatabase=n.isNeedSyncDataToDatabase,this._containerID=e.containerID}return Object(s.a)(t,[{key:"destroy",value:function(){this.hideToastTips(!0)}},{key:"syncLocalOfflineData",value:function(){var t=Object(o.a)(regeneratorRuntime.mark((function t(n,o){var r,s,c,u,d,h,f,g,b,_,v,y,w,k,C,S=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return null===(r=e.log)||void 0===r||r.info("call syncLocalOfflineData()",n,o,this.isNeedSyncDataToDatabase,this.containerID),t.next=3,this.getLocalUncommitedOfflineData(n);case 3:if(!(c=t.sent).error){t.next=7;break}return null===(u=e.log)||void 0===u||u.error("getLocalUncommitedOfflineData Error",c.error,this.containerID),t.abrupt("return",!1);case 7:if(0!==(d=c.data.filter((function(e){return!(e.isMutationChange()&&e.mutations&&1===e.mutations.length&&0===e.mutations[0].length)}))).length){t.next=11;break}return null===(h=e.log)||void 0===h||h.info("\u6ca1\u6709\u53ef\u7528\u7684\u672c\u5730\u79bb\u7ebf\u6570\u636e\uff0c\u4e0d\u9700\u8981\u540c\u6b65",c.data.length,this.containerID),t.abrupt("return",!0);case 11:if(this.showToastTips(),f=0,d.length>0&&(f=d[0].baseVersion),g=d.map((function(e){return{version:e.baseVersion,taskId:e.taskId,dver:e.dver}})),null===(s=e.log)||void 0===s||s.warn("\u79bb\u7ebf\u6570\u636e\u4fe1\u606f\uff1a",g),!(f<o)){t.next=38;break}return t.next=19,this.fetchMisschanges(n,f+1,o);case 19:if(!(b=t.sent).error){t.next=26;break}return null===(_=e.log)||void 0===_||_.warn("\u79bb\u7ebf\u63d0\u4ea4\u524d\u8865\u62c9misschange\u5e94\u7528\u9519\u8bef\u3002",null===(v=b.error)||void 0===v?void 0:v.stack,this.containerID),this.hideToastTips(),this.parent.app.permissions.activeTempStatus(!1),m.b.client.showOfflineSyncError(p.a.OFFLINE_SYNC_ERROR),t.abrupt("return",!1);case 26:if(a.b.jank.log({moduleValue:"messageOfflineStore",actionValue:"followAndApply",lockJankKey:!0}),y=b.data,y.map((function(e){var t=e.head?"[[]]":e.changeset,n={globalPadId:S.parent.globalPadId,sheetId:e.sheetId,baseVersion:e.newVersion,data:{mutations:JSON.parse(t),head:e.head,changeData:e.head?e.changeset:void 0,taskId:e.commitId}};return new l.b(n)})).forEach((function(t){if(d.length>0&&d[0].taskId===t.taskId){for(var n=1;n<d.length;n++){var o;d[n].baseVersion=t.baseVersion,null===(o=e.log)||void 0===o||o.info("\u8865\u62c9\u56de\u6765\u7684\u534f\u540c\u6570\u636e\u548c\u63d0\u4ea4\u4e2d\u7684\u6570\u636etaskId\u76f8\u7b49\uff0c\u76f4\u63a5\u5347\u7248\u672c\u5373\u53ef\u3002taskId=",t.taskId,S.containerID)}d.shift()}else for(var r=t.mutations,s=0;s<d.length;s++){var i=d[s];if(t.sheetId===i.sheetId&&i.isMutationChange()&&i.mutations.length>0){var a=S.parent.app.mutationBehavior.followRequestMutations(r,i.mutations,!1);i.mutations=a}i.baseVersion=t.baseVersion}})),!this.isNeedSyncDataToDatabase){t.next=35;break}return w=d.map((function(e){return S.parent.offlineEventHandler.userChange2OfflineData(e)})),k=i.QueryCondition.newInstance().addCondition("globalPadId",i.QUERY_CONDITION_TYPE.ONLY,n).addCondition("type",i.QUERY_CONDITION_TYPE.IN,[i.OFFLINE_ITEM_TYPE.COMMITING,i.OFFLINE_ITEM_TYPE.WATTING]).addCondition("uid",i.QUERY_CONDITION_TYPE.ONLY,this.parent.uid),t.next=35,this.database.deleteAndWrite(i.TableName.OFFLINE_DATA,k,w);case 35:this.applyLocalOfflineChanges(d),t.next=48;break;case 38:if(f!==o){t.next=44;break}return t.next=41,this.applyLocalOfflineChanges(d);case 41:a.b.jank.log({moduleValue:"messageOfflineStore",actionValue:"apply",lockJankKey:!0}),t.next=48;break;case 44:null===(C=e.log)||void 0===C||C.warn("\u672c\u5730\u79bb\u7ebf\u6570\u636e\u7248\u672c\u5927\u4e8e\u670d\u52a1\u5668\u7248\u672c",this.containerID),this.hideToastTips(),this.parent.app.permissions.activeTempStatus(!1),m.b.client.showOfflineSyncError(p.a.OFFLINE_SYNC_ERROR);case 48:return t.abrupt("return",!0);case 49:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getLocalUncommitedOfflineData",value:function(){var e=Object(o.a)(regeneratorRuntime.mark((function e(t){var n,o,r,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.QueryCondition.newInstance().addCondition("globalPadId",i.QUERY_CONDITION_TYPE.ONLY,t).addCondition("type",i.QUERY_CONDITION_TYPE.IN,[i.OFFLINE_ITEM_TYPE.COMMITING,i.OFFLINE_ITEM_TYPE.WATTING]).addCondition("uid",i.QUERY_CONDITION_TYPE.ONLY,this.parent.uid),e.next=3,this.database.getAll(i.TableName.OFFLINE_DATA,n);case 3:if(!(o=e.sent).error){e.next=7;break}return console.warn(o.error),e.abrupt("return",new i.Result(o.error));case 7:return r=o.data,a.b.run(c.CONFIG.GET_OFFLINE_DATA,[null===r||void 0===r?void 0:r.length]),r.sort((function(e,t){return e.createTime-t.createTime})),s=r.map((function(e){return new l.b(e.data)})),e.abrupt("return",new i.Result(void 0,s));case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchMisschanges",value:function(e,t,n){return new Promise((function(o,r){var s={padId:e,revLower:t,revUpper:n,callback:function(e,t,n,r){o(e?new i.Result(void 0,t):new i.Result(new Error(n)))}};Object(u.a)(s)}))}},{key:"applyLocalOfflineChanges",value:function(){var t=Object(o.a)(regeneratorRuntime.mark((function t(n){var r,s,i=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a.b.jank.stopReport(),null===(r=e.log)||void 0===r||r.info("call applyLocalOfflineChanges",n.length);try{n.forEach(function(){var t=Object(o.a)(regeneratorRuntime.mark((function t(n){var o,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.isMutationChange()?n.mutations.forEach((function(e){i.parent.app.messageCenter.sendMessageCenter.addUserChange({sheetId:n.sheetId,taskId:n.taskId,data:e,requestId:-1,head:n.head,oSubId:n.originSheetId,withKeyData:!1,isOfflineMessage:!0,allowAutoMerge:!0,keyframe:n.keyData,createTime:n.time,syncToOffline:!1})})):i.parent.app.messageCenter.sendMessageCenter.addUserChange({sheetId:n.sheetId,taskId:n.taskId,data:n.changeData,requestId:-1,head:n.head,oSubId:n.originSheetId,withKeyData:!1,isOfflineMessage:!0,allowAutoMerge:!1,keyframe:n.keyData,createTime:n.time,syncToOffline:!1}),null===(o=e.log)||void 0===o||o.info("applyLocalOfflineChanges applyOffline start",n.mutations.length),t.next=4,i.parent.app.requestApi.applyOffline({sheetId:n.sheetId,requestId:-1,canUndoRedo:!1,opt:n});case 4:null===(r=e.log)||void 0===r||r.info("applyLocalOfflineChanges applyOffline end",n.mutations.length);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}catch(c){null===(s=e.log)||void 0===s||s.error("applyLocalOfflineChanges Error",c,this.containerID)}finally{this.hideToastTips(),a.b.jank.restartReport()}case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"showToastTips",value:function(t){var n;null===(n=e.log)||void 0===n||n.info("LocalOfflineDatahandler call showToastTips",t,!!this.toastTips,this.containerID),this.parent.app.permissions.activeTempStatus(!1),this.toastTips||(this.lastTipsShowTime=Date.now(),this.toastTips=f.a.show({message:"\u79bb\u7ebf\u6570\u636e\u540c\u6b65\u4e2d\uff0c\u8bf7\u7a0d\u5019...",type:"loading",style:{zIndex:10003},autoClose:!1,onClose:function(){return!1}}))}},{key:"hideToastTips",value:function(){var t,n=this,o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];null===(t=e.log)||void 0===t||t.info("LocalOfflineDatahandler call hideToastTips",o,this.lastTipsShowTime,this.containerID);var r=Date.now()-this.lastTipsShowTime;if(r>1e3||o)try{var s,i;null===(s=e.log)||void 0===s||s.info("hideSyncOfflineToastTips now",this.containerID),null===(i=this.toastTips)||void 0===i||i.close(),this.toastTips=null,this.parent.app.permissions.unactiveTempStatus()}catch(c){var a;null===(a=e.log)||void 0===a||a.error("LocalOfflineDatahandler hideToastTips error",null===c||void 0===c?void 0:c.stack)}else d.a.util.timer.wait(1e3-r).run((function(){try{var t,o;null===(t=e.log)||void 0===t||t.info("hideSyncOfflineToastTips sync",n.containerID),null===(o=n.toastTips)||void 0===o||o.close(),n.toastTips=null,n.parent.app.permissions.unactiveTempStatus()}catch(c){var r;null===(r=e.log)||void 0===r||r.error("LocalOfflineDatahandler hideToastTips error",null===c||void 0===c?void 0:c.stack)}}))}},{key:"containerID",get:function(){return this._containerID}}]),t}()}).call(this,n("../node_modules/webpack/buildin/global.js"))},"./src/external/offlineEdit/hanlder/OfflineEventHandler.ts":function(e,t,n){"use strict";(function(e){n("../node_modules/core-js/modules/es.array.map.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.reflect.construct.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js"),n("../node_modules/regenerator-runtime/runtime.js");var o=n("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),r=n("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),s=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=n("../node_modules/@babel/runtime/helpers/esm/get.js"),a=n("../node_modules/@babel/runtime/helpers/esm/inherits.js"),c=n("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),l=n("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),u=n("./src/base/event/event.ts"),d=n("./src/core/network/message-center/model/UserChange.ts"),h=n("../node_modules/@tencent/docs_offline/lib/index.js"),f=n("./src/core/network/message-center/model/userChange-helper.ts"),p=n("./src/external/offlineEdit/model/ClearType.ts"),m=n("./src/core/network/message-center/utils.ts"),g=n("./src/external/offlineEdit/Constant.ts");function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(l.a)(e);if(t){var r=Object(l.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(c.a)(this,n)}}var _=function(t){Object(a.a)(c,t);var n=b(c);function c(t){var s;return Object(r.a)(this,c),(s=n.call(this)).userChangeNewHandleFun=function(){var t=Object(o.a)(regeneratorRuntime.mark((function t(n){var o,r,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s.parent.isDBAvaliable()&&n.syncToOffline){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,o=s.userChange2OfflineData(n.userChange),t.next=6,s.parent.offlineDataManager.getDatabase().update(h.TableName.OFFLINE_DATA,o);case 6:if(!(r=t.sent).error){t.next=9;break}throw r.error;case 9:t.next=15;break;case 11:t.prev=11,t.t0=t.catch(2),null===(i=e.log)||void 0===i||i.error("\u6570\u636e\u5e93\u64cd\u4f5c\u5931\u8d25 userChangeNewHandleFun",null===t.t0||void 0===t.t0?void 0:t.t0.stack),s.parent.switchStatus(g.b.ERROR);case 15:case"end":return t.stop()}}),t,null,[[2,11]])})));return function(e){return t.apply(this,arguments)}}(),s.userChangeUpdateHandleFun=function(){var t=Object(o.a)(regeneratorRuntime.mark((function t(n){var o,r,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s.parent.isDBAvaliable()&&n.syncToOffline){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,o=s.userChange2OfflineData(n.userChange),t.next=6,s.parent.offlineDataManager.getDatabase().update(h.TableName.OFFLINE_DATA,o);case 6:if(!(r=t.sent).error){t.next=9;break}throw r.error;case 9:t.next=15;break;case 11:t.prev=11,t.t0=t.catch(2),null===(i=e.log)||void 0===i||i.error("\u6570\u636e\u5e93\u64cd\u4f5c\u5931\u8d25 userChangeUpdateHandleFun",null===t.t0||void 0===t.t0?void 0:t.t0.stack),s.parent.switchStatus(g.b.ERROR);case 15:case"end":return t.stop()}}),t,null,[[2,11]])})));return function(e){return t.apply(this,arguments)}}(),s.userChangeAcceptHandleFun=function(){var t=Object(o.a)(regeneratorRuntime.mark((function t(n){var o,r,i,a,c,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s.parent.isDBAvaliable()){t.next=2;break}return t.abrupt("return");case 2:return(o=n.userChange).status=d.a.ACCEPT,(r=s.userChange2OfflineData(o)).version=n.newVersion,t.prev=6,i=h.QueryCondition.newInstance().addCondition("key",h.QUERY_CONDITION_TYPE.ONLY,r.key),t.next=10,s.parent.offlineDataManager.getDatabase().delete(h.TableName.OFFLINE_DATA,i);case 10:if(!(a=t.sent).error){t.next=13;break}throw a.error;case 13:if(s.parent.isFullOffline()){t.next=15;break}return t.abrupt("return");case 15:return t.next=17,s.parent.offlineDataManager.getDatabase().update(h.TableName.DOCUMENT_DATA,r);case 17:if(!(c=t.sent).error){t.next=20;break}throw c.error;case 20:t.next=26;break;case 22:t.prev=22,t.t0=t.catch(6),null===(l=e.log)||void 0===l||l.error("\u6570\u636e\u5e93\u64cd\u4f5c\u5931\u8d25 userChangeAcceptHandleFun",null===t.t0||void 0===t.t0?void 0:t.t0.stack),s.parent.switchStatus(g.b.ERROR);case 26:case"end":return t.stop()}}),t,null,[[6,22]])})));return function(e){return t.apply(this,arguments)}}(),s.commitingQueueResetHandleFun=function(){var t=Object(o.a)(regeneratorRuntime.mark((function t(n){var o,r,i,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s.parent.isDBAvaliable()){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,o=s.userChange2OfflineData(n.userChange),r=h.QueryCondition.newInstance().addCondition("key",h.QUERY_CONDITION_TYPE.ONLY,o.key),t.next=7,s.parent.offlineDataManager.getDatabase().delete(h.TableName.OFFLINE_DATA,r);case 7:if(!(i=t.sent).error){t.next=10;break}throw i.error;case 10:t.next=16;break;case 12:t.prev=12,t.t0=t.catch(2),null===(a=e.log)||void 0===a||a.error("\u6570\u636e\u5e93\u64cd\u4f5c\u5931\u8d25 commitingQueueResetHandleFun",null===t.t0||void 0===t.t0?void 0:t.t0.stack),s.parent.switchStatus(g.b.ERROR);case 16:case"end":return t.stop()}}),t,null,[[2,12]])})));return function(e){return t.apply(this,arguments)}}(),s.updateWatingQueueVersionHandleFun=function(){var t=Object(o.a)(regeneratorRuntime.mark((function t(n){var o,r,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s.parent.isDBAvaliable()){t.next=2;break}return t.abrupt("return");case 2:if(0!==n.waitingQueue.length){t.next=4;break}return t.abrupt("return");case 4:return o=n.waitingQueue.map((function(e){return{tableName:h.TableName.OFFLINE_DATA,data:s.userChange2OfflineData(e)}})),t.prev=5,t.next=8,s.parent.offlineDataManager.getDatabase().updateMultiTableData(o);case 8:if(!(r=t.sent).error){t.next=11;break}throw r.error;case 11:t.next=17;break;case 13:t.prev=13,t.t0=t.catch(5),null===(i=e.log)||void 0===i||i.error("\u6570\u636e\u5e93\u64cd\u4f5c\u5931\u8d25 updateWatingQueueVersionHandleFun",null===t.t0||void 0===t.t0?void 0:t.t0.stack),s.parent.switchStatus(g.b.ERROR);case 17:case"end":return t.stop()}}),t,null,[[5,13]])})));return function(e){return t.apply(this,arguments)}}(),s.afterApplyNewChangeHandleFun=function(){var t=Object(o.a)(regeneratorRuntime.mark((function t(n){var o,r,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s.parent.isDBAvaliable()){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,o=s.missChange2OfflineData(n.changeInfo),t.next=6,s.parent.offlineDataManager.getDatabase().update(h.TableName.DOCUMENT_DATA,o);case 6:if(!(r=t.sent).error){t.next=9;break}throw r.error;case 9:t.next=15;break;case 11:t.prev=11,t.t0=t.catch(2),null===(i=e.log)||void 0===i||i.error("\u6570\u636e\u5e93\u64cd\u4f5c\u5931\u8d25 afterApplyNewChangeHandleFun",null===t.t0||void 0===t.t0?void 0:t.t0.stack),s.parent.switchStatus(g.b.ERROR);case 15:case"end":return t.stop()}}),t,null,[[2,11]])})));return function(e){return t.apply(this,arguments)}}(),s.clearOfflineStoreHandleFun=function(){var t=Object(o.a)(regeneratorRuntime.mark((function t(n){var o,r,i,a,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=n.type,r=n.callback,s.parent.isDBAvaliable()){t.next=4;break}return null===r||void 0===r||r(!1),t.abrupt("return");case 4:return t.prev=4,i=o===p.a.ALL,t.next=8,s.parent.offlineDataManager.getHelper().clearDocOfflineData(s.parent.globalPadId,i);case 8:if(!(a=t.sent).error){t.next=11;break}throw a.error;case 11:null===r||void 0===r||r(!0),t.next=19;break;case 14:t.prev=14,t.t0=t.catch(4),null===r||void 0===r||r(!1),null===(c=e.log)||void 0===c||c.error("\u6570\u636e\u5e93\u64cd\u4f5c\u5931\u8d25 clearOfflineStoreHandleFun",null===t.t0||void 0===t.t0?void 0:t.t0.stack),s.parent.switchStatus(g.b.ERROR);case 19:case"end":return t.stop()}}),t,null,[[4,14]])})));return function(e){return t.apply(this,arguments)}}(),s.commitWithErrorCodeHandleFun=function(){var t=Object(o.a)(regeneratorRuntime.mark((function t(n){var o,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s.parent.isDBAvaliable()){t.next=2;break}return t.abrupt("return");case 2:t.t0=n.errCode,t.next=60007===t.t0||60015===t.t0||40001===t.t0?5:18;break;case 5:return t.prev=5,t.next=8,s.parent.offlineDataManager.getHelper().clearDocOfflineData(s.parent.globalPadId,!0);case 8:if(!(o=t.sent).error){t.next=11;break}throw o.error;case 11:t.next=17;break;case 13:t.prev=13,t.t1=t.catch(5),null===(r=e.log)||void 0===r||r.error("\u6570\u636e\u5e93\u64cd\u4f5c\u5931\u8d25 commitWithErrorCodeHandleFun",null===t.t1||void 0===t.t1?void 0:t.t1.stack),s.parent.switchStatus(g.b.ERROR);case 17:return t.abrupt("break",18);case 18:case"end":return t.stop()}}),t,null,[[5,13]])})));return function(e){return t.apply(this,arguments)}}(),s.parent=t,s.initListener(),s}return Object(s.a)(c,[{key:"userChangeStatus2OfflineType",value:function(e){var t=h.OFFLINE_ITEM_TYPE.WATTING;switch(e){case d.a.WATING:t=h.OFFLINE_ITEM_TYPE.WATTING;break;case d.a.COMMITING:t=h.OFFLINE_ITEM_TYPE.COMMITING;break;case d.a.ACCEPT:t=h.OFFLINE_ITEM_TYPE.ACCEPTED}return t}},{key:"userChange2OfflineData",value:function(t){return new h.OfflineData({uid:this.parent.uid,globalPadId:this.parent.globalPadId,secretId:this.parent.secretId,subSheetId:t.sheetId,type:this.userChangeStatus2OfflineType(t.status),docType:h.FILE_TYPE.EXCEL,taskId:t.taskId,version:t.baseVersion,data:Object(f.f)(t),createTime:t.time,dver:e.__globalCodeVersion})}},{key:"missChange2OfflineData",value:function(t){return new h.OfflineData({uid:this.parent.uid,globalPadId:this.parent.globalPadId,secretId:this.parent.secretId,subSheetId:t.sheetId,type:h.OFFLINE_ITEM_TYPE.NEW_CHANGE,docType:h.FILE_TYPE.EXCEL,taskId:t.commitId,version:t.newVersion,data:t,createTime:Date.now(),dver:e.__globalCodeVersion})}},{key:"destroy",value:function(){this.dispose()}},{key:"dispose",value:function(){Object(i.a)(Object(l.a)(c.prototype),"dispose",this).call(this),u.c.spreadsheetEvent.remove("clearOfflineStore",this.clearOfflineStoreHandleFun),u.c.spreadsheetEvent.remove(m.a.COMMIT_WITH_ERROR_CODE,this.commitWithErrorCodeHandleFun)}},{key:"initListener",value:function(){var e=this;this._register(this.parent.offlineEventDispatcher.onUserChangeNew((function(t){return e.userChangeNewHandleFun(t)}))),this._register(this.parent.offlineEventDispatcher.onUserChangeUpdate((function(t){return e.userChangeUpdateHandleFun(t)}))),this._register(this.parent.offlineEventDispatcher.onUserChangeCommit((function(t){return e.userChangeUpdateHandleFun(t)}))),this._register(this.parent.offlineEventDispatcher.onAcceptCommit((function(t){return e.userChangeAcceptHandleFun(t)}))),this._register(this.parent.offlineEventDispatcher.onResetCommitingQueue((function(t){return e.commitingQueueResetHandleFun(t)}))),this._register(this.parent.offlineEventDispatcher.onUpdateBaseVersion((function(t){return e.updateWatingQueueVersionHandleFun(t)}))),this._register(this.parent.offlineEventDispatcher.onAfterApplyNewChanges((function(t){return e.afterApplyNewChangeHandleFun(t)}))),u.c.spreadsheetEvent.listen("clearOfflineStore",this.clearOfflineStoreHandleFun),u.c.spreadsheetEvent.listen(m.a.COMMIT_WITH_ERROR_CODE,this.commitWithErrorCodeHandleFun)}}]),c}(n("../packages/services/src/dispose.ts").a);t.a=_}).call(this,n("../node_modules/webpack/buildin/global.js"))},"./src/external/offlineEdit/index.ts":function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return D}));n("../node_modules/core-js/modules/es.array.concat.js"),n("../node_modules/core-js/modules/es.function.name.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js"),n("../node_modules/core-js/modules/es.promise.finally.js"),n("../node_modules/core-js/modules/es.reflect.construct.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js"),n("../node_modules/regenerator-runtime/runtime.js");var o=n("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),r=n("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),s=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=n("../node_modules/@babel/runtime/helpers/esm/get.js"),a=n("../node_modules/@babel/runtime/helpers/esm/inherits.js"),c=n("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),l=n("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),u=n("../node_modules/@tencent/docs_offline/lib/index.js"),d=n("./src/external/offlineEdit/hanlder/LocalOfflineDataHandler.ts"),h=n("./src/base/event/event.ts"),f=n("./src/external/offlineEdit/Constant.ts"),p=n("./src/external/offlineEdit/hanlder/OfflineEventHandler.ts"),m=n("./src/core/ui/toast/domToast.ts"),g=n("../packages/report/src/index.ts"),b=n("./src/base/config/report.ts"),_=n("../packages/common-utils/src/cookie.ts"),v=n("./src/core/data/configService/spreadConfig.ts"),y=n("./src/base/util/timer.ts"),w=n("./src/base/index.ts"),k=n("../node_modules/@tencent/docs-user-agent/dist/index.js"),C=n.n(k),S=n("../node_modules/@tencent/dui/lib/components/Snackbar/index.js"),E=n.n(S),T=n("./src/base/error/errorCodeModalProxy.ts"),O=n("../packages/services/src/dispose.ts"),j=n("./src/core/utils/config.ts"),x=n("../packages/common-utils/src/url.ts");function R(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(l.a)(e);if(t){var r=Object(l.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(c.a)(this,n)}}var D=function(t){Object(a.a)(c,t);var n=R(c);function c(t){var s,i;return Object(r.a)(this,c),(i=n.call(this)).status=f.b.CLOSE,i.isTempShield=!1,i.isWattingCreateFileResponse=!1,i.syncOfflineDataFun=Object(o.a)(regeneratorRuntime.mark((function t(){var n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===(n=e.log)||void 0===n||n.info("syncOfflineDataFun \u5f00\u59cb\u540c\u6b65\u79bb\u7ebf\u6570\u636e\u3002",i.isDBAvaliable(),i.containerID),i.isDBAvaliable()){t.next=3;break}return t.abrupt("return");case 3:if(!v.a.getConfig("isNewDoc")){t.next=10;break}return t.next=6,i.handleLocalCreateDocData();case 6:if(t.sent){t.next=10;break}return null===(o=e.log)||void 0===o||o.error("\u672c\u5730\u65b0\u5efa\u6587\u6863\u6570\u636e\u5199\u5165\u53d1\u751f\u9519\u8bef\u3002"),t.abrupt("return");case 10:return i.isNeedCreateFile()&&i.tryToCreateFile(),t.next=13,i.localOfflineDataHandler.syncLocalOfflineData(i.globalPadId,i.networkHelper.baseVersion());case 13:case"end":return t.stop()}}),t)}))),i.handleLocalCreateDocData=Object(o.a)(regeneratorRuntime.mark((function t(){var n,o,r,s,a,c,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=u.FILE_TYPE.EXCEL,s=i.getLocalCreateDocOptions(),a=s.folder,c=s.isShareme,l=s.isOnlineBorrowed,t.next=4,i.offlineDataManager.getHelper().storeNewDocData(r,a,i.globalPadId,i.secretId,e.clientVars,c);case 4:if(!t.sent.error){t.next=8;break}return E.a.show({message:"\u65b0\u5efa\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\u3002",autoClose:!1,type:"error",zIndex:100002}),t.abrupt("return",!1);case 8:return v.a.setConfig({isNewDoc:!1}),null===(n=e.mqq)||void 0===n||null===(o=n.invoke)||void 0===o||o.call(n,"docx","docDBOperation",{isOnlineBorrowed:l,folder:a,globalId:i.globalPadId,listTypes:[u.AppDocsListType.listTypeOffline,u.AppDocsListType.listTypeCreated,u.AppDocsListType.listTypeMyDoc,u.AppDocsListType.listTypeRecent],operation:"addDocToList"}),t.abrupt("return",!0);case 11:case"end":return t.stop()}}),t)}))),i.networkStatusChangedFun=function(){var t=Object(o.a)(regeneratorRuntime.mark((function t(n,o){var r,s,a,c,l,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.isOnline!==o.isOnline){t.next=2;break}return t.abrupt("return");case 2:if(null===(r=e.log)||void 0===r||r.info("NetworkStatusChanged. newStatus=".concat(o.isOnline," "),i.isDBAvaliable(),i.containerID),!o.isOnline){t.next=8;break}i.hideToastTips(),i.isNeedCreateFile()&&i.tryToCreateFile(),t.next=15;break;case 8:if(i.isDBAvaliable()){t.next=15;break}return t.next=11,i.mutexLock.detectKey("offline_".concat(i.secretId));case 11:a=t.sent,c=!a.error&&a.data,null===(s=e.log)||void 0===s||s.info("NetworkStatusChanged. newStatus=".concat(o.isOnline," \u68c0\u6d4b\u9501\u5360\u7528\u7ed3\u679c\uff1a").concat(JSON.stringify(a),"  DBStatus: ").concat(i.isDBAvaliable()),i.containerID),(null===c||void 0===c?void 0:c.optional)&&"edit"===c.optional.source?(l=C.a.isMobile?"\u7f51\u7edc\u5f02\u5e38\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5\u3002":"\u6587\u6863\u5df2\u5728\u53e6\u4e00\u4e2a\u6807\u7b7e\u9875\u4e2d\u6253\u5f00\u79bb\u7ebf\u7f16\u8f91\uff0c\u8bf7\u5173\u95ed\u5bf9\u5e94\u6807\u7b7e\u9875\u540e\u518d\u91cd\u65b0\u52a0\u8f7d\u3002",i.showToastTips(l)):(u=C.a.isMobile?"\u7f51\u7edc\u5f02\u5e38\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5\u3002":"\u79bb\u7ebf\u7f16\u8f91\u6682\u65e0\u6cd5\u4f7f\u7528\uff0c\u8bf7\u5c1d\u8bd5\u91cd\u65b0\u52a0\u8f7d\u6216\u8fde\u63a5\u7f51\u7edc\u540e\u4f7f\u7528\u3002",i.showToastTips(u));case 15:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),i.dbVersionChangedFun=function(){var t;null===(t=e.log)||void 0===t||t.info("OnTencentDocsDBVersionChanged",i.containerID),i.shutDown(!0),i.app.permissions.activeTempStatus(!1),T.b.server.showUpgradeTip("DB_UPGRADE")},i.tryToCreateFile=function(){var t;if(null===(t=e.log)||void 0===t||t.info("tryToCreateFile",i.globalPadId,i.containerID),i.isWattingCreateFileResponse){var n;null===(n=e.log)||void 0===n||n.warn("\u6b63\u5728\u521b\u5efa\u4e2d\uff0c\u8be5\u521b\u5efa\u6587\u4ef6\u8bf7\u6c42\u76f4\u63a5\u629b\u5f03")}else{if(i.isNeedCreateFile())return i.isWattingCreateFileResponse=!0,i.offlineDataManager.getHelper().createFile(i.globalPadId,1,!0).then((function(t){var n;if(t.error){var o,r;if(null===(o=e.log)||void 0===o||o.error("\u521b\u5efa\u6587\u4ef6\u5931\u8d25\uff1a",null===(r=t.error)||void 0===r?void 0:r.stack,i.containerID),t.error instanceof u.HttpError&&10033===t.error.errorCode){var s=t.data.url;Object(m.a)("\u4e0e\u670d\u52a1\u5668\u540c\u6b65\u5b8c\u6210\uff0c\u8bf7\u5237\u65b0\u3002","\u91cd\u65b0\u52a0\u8f7d",(function(){location.href=s}))}else i.createFileTimer=y.a.wait(5e3).run(i.tryToCreateFile)}else{var a,c=t.data;if(null===(n=e.log)||void 0===n||n.error("\u521b\u5efa\u6587\u4ef6\u6210\u529f  retCode=",null===c||void 0===c?void 0:c.retcode,i.containerID),c&&0===c.retcode)e.clientVars=c.data,v.a.reloadConfig(e.clientVars),i.app.spreadsheet.setTitle(v.a.getConfig("title")),w.a.event.network.trigger("userNewInfo",i.userInfoConfig(e.clientVars)),h.c.spreadsheetEvent.trigger("createFileSuccess"),null===(a=i.app.socket)||void 0===a||a.init()}})).catch((function(t){var n;null===(n=e.log)||void 0===n||n.error("\u8c03\u7528\u521b\u5efa\u63a5\u53e3\u5f02\u5e38",null===t||void 0===t?void 0:t.stack),i.createFileTimer=y.a.wait(5e3).run(i.tryToCreateFile)})).finally((function(){i.isWattingCreateFileResponse=!1}));var o;null===(o=e.log)||void 0===o||o.warn("\u4e0d\u7b26\u5408\u6761\u4ef6\uff0c\u629b\u5f03\u521b\u5efa\u6587\u4ef6\u4efb\u52a1",e.clientVars.padStatus,e.clientVars.isUserChangeTitle)}},i.registerCallbackOnWindow=function(){e.onbeforeclosetab||(e.onbeforeclosetab=function(){i.shutDown()})},null===(s=e.log)||void 0===s||s.info("flow MessageService new OfflineEdit() mode = ".concat(t.mode,"  _containerID=").concat(e.containerID)),i._containerID=e.containerID,i.app=t.app,i.mode=t.mode,i.secretId=t.secretId,i.globalPadId=t.globalPadId,i.uid=t.uid||Object(_.getCookie)("uid"),i.offlineEventDispatcher=t.offlineEventDispatcher,i.networkHelper=t.networkHelper,i}return Object(s.a)(c,[{key:"checkDocTabLock",value:function(){var t=Object(o.a)(regeneratorRuntime.mark((function t(){var n,o,r,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.mutexLock=new u.Lock({period:1e3}),t.next=3,this.mutexLock.lock("offline_".concat(this.secretId),{source:"edit"});case 3:if(r=t.sent,null===(n=e.log)||void 0===n||n.info("\u7ade\u4e89\u9501\u7ed3\u679c\uff1a".concat(JSON.stringify(r))),s=null===(o=r.data)||void 0===o?void 0:o.optional,r.isSuccess){t.next=13;break}if("list"!==(null===s||void 0===s?void 0:s.source)){t.next=11;break}return this.showToastTips(),this.deteckLockAndRefresh(),t.abrupt("return",{isLockedByOtherTab:!r.isSuccess,isDBAvaliable:!1});case 11:if("edit"!==(null===s||void 0===s?void 0:s.source)){t.next=13;break}return t.abrupt("return",{isLockedByOtherTab:!r.isSuccess,isDBAvaliable:!0});case 13:return t.abrupt("return",{isLockedByOtherTab:!r.isSuccess,isDBAvaliable:!0});case 14:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"init",value:function(){var e=Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initDatabaseConnection();case 2:this.offlineEventHandler=this._register(new p.a(this)),this.initListeners(),this.registerCallbackOnWindow();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initDatabaseConnection",value:function(){var t=Object(o.a)(regeneratorRuntime.mark((function t(){var n,o,r,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.checkDocTabLock();case 2:if(n=t.sent,o=n.isLockedByOtherTab,!n.isDBAvaliable){t.next=22;break}return this.switchStatus(f.b.INITING),t.prev=7,t.next=10,this.initOfflineDataManager();case 10:this.offlineDataManager.getHelper().setDefaultCodeVersion("sheet",e.__globalCodeVersion),this.switchStatus(o?f.b.CLOSE:f.b.OPEN),r=this.offlineDataManager.getDatabase(),this.localOfflineDataHandler=new d.a({parent:this,database:r,isNeedSyncDataToDatabase:!o}),t.next=20;break;case 16:t.prev=16,t.t0=t.catch(7),null===(s=e.log)||void 0===s||s.error("init OfflineDatamanager error",null===t.t0||void 0===t.t0?void 0:t.t0.name,null===t.t0||void 0===t.t0?void 0:t.t0.stack,this.containerID),t.t0&&t.t0.name===u.DBErrorType.NOT_SUPPORT_INDEXEDDB?(this.switchStatus(f.b.NOT_SUPPORT),g.b.run(b.CONFIG.NOT_SUPPORT_INDEXEDDB)):(this.switchStatus(f.b.INIT_FAILED),g.b.run(b.CONFIG.OPEN_INDEXED_DB_FAIL,"1",t.t0||{}));case 20:t.next=23;break;case 22:this.switchStatus(f.b.CLOSE);case 23:case"end":return t.stop()}}),t,this,[[7,16]])})));return function(){return t.apply(this,arguments)}}()},{key:"initOfflineDataManager",value:function(){var e=Object(o.a)(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){if(u.OfflineAPI.offlineDataManager)return t.offlineDataManager=u.OfflineAPI.offlineDataManager,void e();t.offlineDataManager=new u.OfflineDataManager({businessType:u.FILE_TYPE.EXCEL,user:new u.UserInfo({uid:t.uid})});var r=w.a.util.timer.wait(2e3).run((function(){n(new Error("InitDatabaseTimeoutError"))}));setTimeout(Object(o.a)(regeneratorRuntime.mark((function o(){var s;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,t.offlineDataManager.init();case 2:s=o.sent,w.a.util.timer.erase(r),s.error&&n(s.error),e(s);case 6:case"end":return o.stop()}}),o)}))),0)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){Object(i.a)(Object(l.a)(c.prototype),"dispose",this).call(this),this.destroy()}},{key:"destroy",value:function(){var t,n;null===(t=e.log)||void 0===t||t.debug("flow OfflineEdit destroy()",this.containerID),y.a.erase(this.createFileTimer),this.app.emitter.off(this.app.EVENT.SPREAD_SHEET_EDITABLE,this.syncOfflineDataFun),this.app.sheetStatus.workbookStatus.status.offChange(this.networkStatusChangedFun),window.removeEventListener("OnTencentDocsDBVersionChanged",this.dbVersionChangedFun),this.offlineEventHandler.destroy(),null===(n=this.localOfflineDataHandler)||void 0===n||n.destroy(),this.shutDown(!1)}},{key:"initListeners",value:function(){var t;null===(t=e.log)||void 0===t||t.info("initListeners OfflineEdit",this.containerID),this.app.emitter.on(this.app.EVENT.SPREAD_SHEET_EDITABLE,this.syncOfflineDataFun),this.app.sheetStatus.workbookStatus.status.change(this.networkStatusChangedFun),window.addEventListener("OnTencentDocsDBVersionChanged",this.dbVersionChangedFun)}},{key:"getLocalCreateDocOptions",value:function(){var t=Object(x.getQueryObject)(e.__originUrl);return{folder:decodeURIComponent(t.folder||"/"),isShareme:"true"===t.isShareme,isOnlineBorrowed:"true"===t.isOnlineBorrowed}}},{key:"isDBAvaliable",value:function(){var t;this.status!==f.b.OPEN&&(null===(t=e.log)||void 0===t||t.error("\u6570\u636e\u5e93\u4e0d\u53ef\u7528"));return this.status===f.b.OPEN}},{key:"isFullOffline",value:function(){return this.mode===f.a.FULL}},{key:"switchStatus",value:function(t){var n,o,r=this.status;(this.status=t,null===(n=e.log)||void 0===n||n.info("switchOfflineDatabaseStatus",r,t,this.containerID),r===f.b.OPEN&&t!==f.b.OPEN)&&(null===(o=e.log)||void 0===o||o.error("\u6570\u636e\u5e93\u5207\u6362\u72b6\u6001 oldStatus=".concat(r,"  newStatus=").concat(t)),g.b.run(b.CONFIG.OFFLINE_DATABASE_ERROR,[r,t]))}},{key:"updateDocumentCache",value:function(){var t=Object(o.a)(regeneratorRuntime.mark((function t(n){var o,r,s,i,a,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.app.sheetStatus.workbookStatus.isOnline){t.next=14;break}return t.next=3,this.offlineDataManager.getHelper().getPadInfo(this.globalPadId);case 3:if(!t.sent.isOfflineCache){t.next=13;break}return o=u.QueryCondition.newInstance().addCondition("globalPadId",u.QUERY_CONDITION_TYPE.ONLY,this.globalPadId).addCondition("uid",u.QUERY_CONDITION_TYPE.ONLY,this.uid),t.next=8,this.offlineDataManager.getDatabase().updateField(u.TableName.PAD_INFO,o,{isManualOffline:!0});case 8:if(!(r=t.sent).error){t.next=12;break}return null===(s=e.log)||void 0===s||s.error("offlineEdit updateDocumentCache updateField error",r.error.stack),t.abrupt("return",{resultCode:u.SyncResultCode.UpdatePreFetchOfflienDataError,subResultCode:-1e3,message:"updateDocumentCache updateField\u53d1\u751f\u9519\u8bef\u3002",error:r.error});case 12:return t.abrupt("return",{resultCode:u.SyncResultCode.Success,subResultCode:0,message:""});case 13:return t.abrupt("return",{resultCode:u.SyncResultCode.UpdatePreFetchOfflienDataError,subResultCode:-1001,message:"\u65e0\u7f51\u7edc\uff0c\u4e5f\u6ca1\u6709\u81ea\u52a8\u7f13\u5b58\uff0c\u56de\u5305\u5931\u8d25\u3002"});case 14:return void 0===(i=n)&&(i=this.networkHelper.baseVersion()),t.next=18,this.offlineDataManager.getHelper().fetchAndStoreDocumentCache({padId:v.a.getConfig("globalPadId"),secretId:this.secretId,source:"edit",force:!0,padType:u.FILE_TYPE.EXCEL,deleteOldCache:!1,isManualOffline:!0,rev:i});case 18:return(a=t.sent).error&&(null===(c=e.log)||void 0===c||c.error("offlineEdit updateDocumentCache fetchAndStoreDocumentCache error",a.error.stack)),t.abrupt("return",a);case 21:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"clearManualCache",value:function(){var t=Object(o.a)(regeneratorRuntime.mark((function t(){var n,o,r,s,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=u.QueryCondition.newInstance().addCondition("globalPadId",u.QUERY_CONDITION_TYPE.ONLY,this.globalPadId).addCondition("uid",u.QUERY_CONDITION_TYPE.ONLY,this.uid),t.next=3,this.offlineDataManager.getDatabase().updateField(u.TableName.PAD_INFO,o,{isManualOffline:!1});case 3:if(!(r=t.sent).error){t.next=7;break}return null===(s=e.log)||void 0===s||s.error("offlineEdit clearManualCache updateField error",r.error.stack),t.abrupt("return",!1);case 7:return i="https://".concat(location.host,"/sheet/").concat(this.secretId),null===(n=e.log)||void 0===n||n.info("\u53d6\u6d88\u7f13\u5b58\u56fe\u7247",i),u.JSApi.invokeNative("docx","removeManualSaveDoc",{docUrl:i},(function(){})),t.abrupt("return",!0);case 11:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getDocCacheStatus",value:function(){var e=Object(o.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.offlineDataManager.getHelper().getPadInfo(this.globalPadId);case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",-1);case 5:if(!t.isManualOffline){e.next=7;break}return e.abrupt("return",1);case 7:if(!t.isOfflineCache){e.next=9;break}return e.abrupt("return",2);case 9:return e.abrupt("return",-1);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getManualOfflineDocSize",value:function(){var t=Object(o.a)(regeneratorRuntime.mark((function t(){var n,o,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=u.QueryCondition.newInstance().addCondition("uid",u.QUERY_CONDITION_TYPE.ONLY,this.uid).addCondition("isManualOffline",u.QUERY_CONDITION_TYPE.ONLY,!0),this.isDBAvaliable){t.next=3;break}return t.abrupt("return",-1);case 3:return t.next=5,this.offlineDataManager.getDatabase().getAll(u.TableName.PAD_INFO,n);case 5:if(!(o=t.sent).error){t.next=9;break}return null===(r=e.log)||void 0===r||r.error("offlineEdit getManualOfflineDocSize error",o.error.stack),t.abrupt("return",-1);case 9:return t.abrupt("return",o.data.length);case 10:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"handleClearDocManualOffline",value:function(){var t=Object(o.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.clearManualCache();case 2:t.sent?(this.app.emitter.emit("updateMoreMenu"),E.a.show({message:"\u5df2\u53d6\u6d88\u7f13\u5b58\u8be5\u6587\u6863",autoClose:!0,type:"success",duration:2e3,zIndex:100002}),null===(n=e.mqq)||void 0===n||n.invoke("docx","notifyNative",{status:2,url:location.href,retCode:0,globalPadId:v.a.getConfig("globalPadId")||"",source:"edit"})):E.a.show({message:"\u53d6\u6d88\u7f13\u5b58\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\u3002",autoClose:!0,type:"error",duration:2e3,zIndex:100002});case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"handleCacheDocManualOffline",value:function(){var e=Object(o.a)(regeneratorRuntime.mark((function e(t){var n,o,r,s,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getManualOfflineDocSize();case 2:if(!((n=e.sent)>=100)){e.next=6;break}return E.a.show({message:"\u5df2\u8fbe\u5230\u4e0a\u9650\uff0c\u8bf7\u53d6\u6d88\u5176\u4ed6\u7f13\u5b58\u7684\u6587\u6863\u540e\u518d\u8bd5\u3002",autoClose:!0,type:"error",duration:2e3,zIndex:100002}),e.abrupt("return");case 6:if(!(n>=0)){e.next=20;break}return null===(o=window.mqq)||void 0===o||o.invoke("docx","notifyNative",{status:0,url:location.href,retCode:0,globalPadId:v.a.getConfig("globalPadId")||"",source:"edit"}),e.next=10,this.updateDocumentCache();case 10:if((s=e.sent).resultCode!==u.SyncResultCode.Success){e.next=16;break}return this.app.emitter.emit("updateMoreMenu"),E.a.show({message:"\u6210\u529f\u7f13\u5b58\u8be5\u6587\u6863",autoClose:!0,type:"success",duration:2e3,zIndex:100002}),null===(i=window.mqq)||void 0===i||i.invoke("docx","notifyNative",{status:1,url:location.href,retCode:0,globalPadId:v.a.getConfig("globalPadId")||"",source:"edit"}),e.abrupt("return");case 16:if(null===(r=window.mqq)||void 0===r||r.invoke("docx","notifyNative",{status:1,url:location.href,retCode:-1,globalPadId:v.a.getConfig("globalPadId")||"",source:"edit"}),s.resultCode!==u.SyncResultCode.PreFetchDocDataError||200058!==s.subResultCode){e.next=20;break}return E.a.show({message:"\u6587\u4ef6\u8fc7\u5927\uff0c\u6682\u4e0d\u652f\u6301\u7f13\u5b58\u3002",autoClose:!0,type:"error",duration:2e3,zIndex:100002}),e.abrupt("return");case 20:E.a.show({message:"\u7f13\u5b58\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\u3002",autoClose:!0,type:"error",duration:2e3,zIndex:100002});case 21:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isNeedCreateFile",value:function(){return Object(j.a)()&&1===e.clientVars.isUserChangeTitle}},{key:"userInfoConfig",value:function(e){return{userId:e.userId,name:e.userInfo.fullName,userPic:e.userInfo.userPic,uin:e.userInfo.uin}}},{key:"shutDown",value:function(){var t,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];null===(t=e.log)||void 0===t||t.info("offline edit shutdown.",this.containerID);try{var o,r;if(this.releaseMutexLock(),n)null===(r=this.offlineDataManager)||void 0===r||r.getDatabase().disConnect(!1);null===(o=e.log)||void 0===o||o.info("offline edit shutdown.",this.containerID)}catch(i){var s;null===(s=e.log)||void 0===s||s.error("offline edit shutdown. error",null===i||void 0===i?void 0:i.stack,this.containerID)}}},{key:"releaseMutexLock",value:function(){try{var t;null===(t=this.mutexLock)||void 0===t||t.release("offline_".concat(this.secretId))}catch(o){var n;null===(n=e.log)||void 0===n||n.error("release mutexLock error",null===o||void 0===o?void 0:o.stack,this.containerID)}}},{key:"deteckLockAndRefresh",value:function(){var t=this;w.a.util.timer.wait(200).run(Object(o.a)(regeneratorRuntime.mark((function n(){var o,r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.mutexLock.detectKey("offline_".concat(t.secretId));case 2:if(r=n.sent,null===(o=e.log)||void 0===o||o.info("deteckLockAndRefresh. lockResult = ",r,t.containerID),r.error||void 0!==r.data){n.next=7;break}return location.reload(),n.abrupt("return");case 7:t.deteckLockAndRefresh();case 8:case"end":return n.stop()}}),n)}))))}},{key:"showToastTips",value:function(t){var n,o;null===(n=e.log)||void 0===n||n.info("offlineEdit call showToastTips",t,this.containerID),null===(o=this.toastTips)||void 0===o||o.close(),this.app.permissions.activeTempStatus(!1),this.toastTips=E.a.show({message:t||"\u6b63\u5728\u540c\u6b65\u79bb\u7ebf\u6570\u636e\uff0c\u8bf7\u7a0d\u5019...",type:"info",style:{zIndex:10003},autoClose:!1,onClose:function(){return!1}})}},{key:"hideToastTips",value:function(){var t,n;null===(t=e.log)||void 0===t||t.info("offlineEdit call hideToastTips",this.containerID),this.app.permissions.unactiveTempStatus(),null===(n=this.toastTips)||void 0===n||n.close(),this.toastTips=void 0}},{key:"containerID",get:function(){return this._containerID}},{key:"isShield",get:function(){return this.isTempShield||!this.isDBAvaliable()}}]),c}(O.a)}).call(this,n("../node_modules/webpack/buildin/global.js"))},"./src/external/offlineEdit/model/ClearType.ts":function(e,t,n){"use strict";var o;n.d(t,"a",(function(){return o})),function(e){e.ALL="all",e.COMMITTED="committed",e.UN_COMMITTED="unCommitted"}(o||(o={}))},"./src/external/waterMark/config.ts":function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var o=!0},"./src/flow/phase/services/messageService.ts":function(e,t,n){"use strict";n.r(t),function(e){n("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.replace.js"),n("../node_modules/regenerator-runtime/runtime.js");var o=n("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),r=n("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),s=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=n("../node_modules/@babel/runtime/helpers/esm/typeof.js"),a=n("./src/core/app/SpreadsheetApp.interface.ts"),c=n("./src/core/network/message-center/MessageCenter.interface.ts"),l=n("./src/core/network/message-center/MessageCenter.ts"),u=n("./src/core/data/configService/spreadConfig.ts"),d=n("./src/external/offlineEdit/index.ts"),h=n("./src/core/network/socket/socket.ts"),f=n("./src/external/offlineEdit/Constant.ts"),p=n("./src/core/network/NetStatus.ts"),m=n("../packages/services/src/instantiation.ts"),g=n("./src/flow/lifecycle.ts"),b=n("../packages/services/src/dispose.ts"),_=n("./src/flow/utils.ts"),v=function(e,t,n,o){var r,s=arguments.length,a=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"===typeof Reflect?"undefined":Object(i.a)(Reflect))&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(s<3?r(a):s>3?r(t,n,a):r(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},y=function(e,t){return function(n,o){t(n,o,e)}},w=function(){function t(e,n,o){Object(r.a)(this,t),this.lifecycle=e,this.app=n,this.instantiationService=o,this.initMessageCenter()}return Object(s.a)(t,[{key:"initMessageCenter",value:function(){var t=Object(o.a)(regeneratorRuntime.mark((function t(){var n,o,r,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.lifecycle.phase=g.b.SPREAD_SHEET_MESSAGE_START,null===(n=e.log)||void 0===n||n.info("flow MessageService initMessage()"),this.app.emitter.emit(this.app.EVENT.SPREAD_SHEET_MESSAGE_START),this.initNetworkStatus(),o=new l.a(this.app,{baseVersion:u.a.getConfig("rev")}),this.instantiationService.addService(c.a,o),this.app.initMessageCenter(o),r=new h.a(this.app,{messageCenter:o}),this.app.initSocket(r),s=new d.a({app:this.app,mode:window.__SUPPORT_FULL_OFFLINE_MODE?f.a.FULL:f.a.PART,secretId:u.a.getConfig("upid")||location.pathname.replace("/sheet/",""),globalPadId:u.a.getConfig("globalPadId"),uid:u.a.getConfig("uid"),networkHelper:o.sendMessageCenter,offlineEventDispatcher:o.sendMessageCenter}),Object(b.f)(s),t.next=13,s.init();case 13:this.app.initOfflineEdit(s),this.app.emitter.emit(this.app.EVENT.SPREAD_SHEET_MESSAGE_END),this.lifecycle.phase=g.b.SPREAD_SHEET_MESSAGE_END;case 16:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"initNetworkStatus",value:function(){var t;null===(t=e.log)||void 0===t||t.debug("flow MessageService initNetworkStatus()");var n=new p.a(this.app);this.app.initNetworkStatus(n)}}]),t}();v([Object(_.a)("F_Init_Message_Center")],w.prototype,"initMessageCenter",null),v([Object(_.a)("F_Init_Network_Status")],w.prototype,"initNetworkStatus",null),w=v([Object(_.a)("M_Message_Service"),y(0,g.a),y(1,a.a),y(2,m.a)],w),t.default=w}.call(this,n("../node_modules/webpack/buildin/global.js"))},0:function(e,t){}}]);
//# sourceMappingURL=pc-bundle_messageService-c3602725f9.js.map