(window.webpackJsonp=window.webpackJsonp||[]).push([["bundle_module_preview"],{"./src/external/revisionRecord/preview.ts":function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"default",(function(){return S}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.find.js"),r("../node_modules/core-js/modules/es.array.slice.js");var a,s=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),i=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),n=r("../node_modules/axios/index.js"),o=r.n(n),c=r("../packages/model/src/spreadsheet/Spreadsheet.ts"),h=r("./src/base/event/event.ts"),u=r("./src/core/data/converter/tencentdoc/keyframeToSheetConverter.ts"),l=r("./src/external/revisionRecord/view.ts"),d=r("./src/external/revisionRecord/record.ts"),p=r("./src/core/worker/index.ts"),v=r("../packages/model/src/spreadsheet/SpreadsheetType.ts"),f=r("./src/base/util/timer.ts"),_=r("../packages/report/src/index.ts"),w=r("./src/base/config/report.ts"),m=r("./src/core/feature/formula/controller.ts"),b=r("./src/core/data/configService/spreadConfig.ts"),g=r("./src/core/feature/formula/utils.ts"),y=r("../packages/utils/src/safe.ts"),R=r("../packages/services/src/dispose.ts"),O=!1,S=function(){function t(e){Object(s.a)(this,t),this.parent=e,this.isActive=!1,this.spreadsheetId=b.a.getConfig("globalPadId")}return Object(i.a)(t,[{key:"setRevertMode",value:function(e,t,r){if(e){if(this.isActive||("function"===typeof r&&r(),this.initPreview()),this.isActive=!0,t){var a=t.header,s=(null===a||void 0===a?void 0:a.length)&&a[0].d.slice();if(!s)return;this.clearAndReInitSheets(s);var i=this.parent.preview.previewsheet.activeSheetId;this.switchSheet(i)}}else this.disablePreview(),this.isActive=!1,"function"===typeof r&&r()}},{key:"setPreviewMode",value:function(e,t,r){if(!O)if(e){if(this.isActive||("function"===typeof r&&r(),this.initPreview()),this.isActive=!0,this.recordInfo=null,t&&0===t.retcode){O=!0;var s=t.version,i=(t.padID,t.fRev),n=t.header,o=t.isRevertVersion,c=t.revertAuthor;this.recordInfo={ver:s,fRev:i,isRevertVersion:o,revertAuthor:c};var h=n[0].d.slice();this.clearAndReInitSheets(h),a=a?this.parent.preview.previewsheet.activeSheetId:this.parent.spreadsheet.activeSheetId;var u=h.find((function(e){return e.id===a}));u&&!u.hidden?this.switchSheet(u.id,!0):this.switchSheet(h[0].id,!0)}}else this.disablePreview(),this.isActive=!1,"function"===typeof r&&r()}},{key:"switchSheet",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=window,a=r.showOfflineData;this.previewsheet.activeSheetId=e;this.previewsheet.sheetManager.getSheetBySheetId(e);if(_.b.run(w.CONFIG.SWITCH_SHEET_IN_PREVIEW,[e,!!a]),a)"".concat(b.a.getConfig("padId"),"_").concat(e);else this.getPreviewServerSheetData(e,t)}},{key:"getPreviewServerSheetData",value:function(t,r,a){var s=this,i=this.previewsheet.sheetManager.getSheetBySheetId(t);if(i){if(i.isLoaded)return void this.handleResponse();var n={sheetId:t,padId:this.spreadsheetId,withWb:r};this.recordInfo&&(n.ver=this.recordInfo.ver,n.fRev=this.recordInfo.fRev),_.b.run(w.CONFIG.PREVIEW_SERVER_SHEET_DATA,[n]),i.startLoading(),this.fetch(n).then((function(t){if(200===t.status&&t.data&&0===t.data.retcode){var r=t.data;_.b.run(w.CONFIG.PREVIEW_SERVER_SHEET_DATA_ON_RESPONSE,[n]);var o=r.data.initialAttributedText.text,c=r.data.actionlist;s.onRecordResponse(i,o,c),i.stopLoading(!0),"function"===typeof a&&a()}else i.stopLoading(!1);e.previewLoading=!1,O=!1})).catch((function(e){i.stopLoading(!1)}))}}},{key:"initPreview",value:function(){this.previewMainThreadWorker=Object(p.a)({workerName:"previewWorker"}),Object(R.f)(this.previewMainThreadWorker);var e=this.parent.spreadsheet.getSpreadsheetId(),t=this.parent.spreadsheet.sheetManager.getSheetOptionsList(),r=t[0].id,a={spreadsheetId:e,type:v.a.PREVIEW,title:this.parent.spreadsheet.getTitle(),sheetList:t,activeSheetId:r};this.previewsheet?this.previewsheet.reInit(a):this.previewsheet=new c.a(this.parent,a),this.calcController=new m.a(this.parent,{isPreview:!0,previewMainThreadWorker:this.previewMainThreadWorker}),this.previewMainThreadWorker.sheetData.initSpreadsheetApp({activeSheetId:r,header:t,spreadsheetId:e,title:"",waitForFormulaLayerToBeInitialized:!1,baseVersion:0}),this.view?this.view.canvas.dataCallView.start():(this.view=new l.a(this.parent),this.view.initCanvas()),this.lastPermission=this.parent.sheetStatus.canEdit}},{key:"disablePreview",value:function(){var e,t=this;null===(e=this.previewMainThreadWorker)||void 0===e||e.dispose(),delete this.previewMainThreadWorker,this.parent.spreadsheet.type=v.a.NORMAL,a="",this.view.canvas.dataCallView.stop(),f.a.wait(100).run((function(){var e;t.parent.permissions.unactiveTempStatus(),null===(e=t.parent.view.sheetsBar)||void 0===e||e.refreshUI(),t.parent.view.canvas.resize.resize()}))}},{key:"clearAndReInitSheets",value:function(e){this.previewMainThreadWorker.sheetData.clearAndReInitSheets({sheetList:e}),this.previewsheet.workbookRangeManager.clear(),this.previewsheet.embeddedObjectManager.clear(),this.previewsheet.sheetManager.setSheets(e)}},{key:"onRecordResponse",value:function(e,t,r){var a=this,s=e.getSheetId(),i=this.previewsheet;this.handleResponse((function(){Object(u.a)(i,s,t,{afterConvert:function(){var t;if(null===r||void 0===r?void 0:r.length)for(var n=0;n<r.length;n++)Object(d.a)(i,s,r[n]);else(null===(t=a.recordInfo)||void 0===t?void 0:t.isRevertVersion)&&Object(d.b)(e,{author:a.recordInfo.revertAuthor})}})})),Object(g.g)(i,s).needLoadInWorker&&this.previewMainThreadWorker.sheetData.initSheet({sheetData:t,sheetId:s,sheetTitle:e.getTitle()})}},{key:"handleResponse",value:function(e){var t,r=this;(_.b.jank.log({moduleValue:"keyframeMutation",actionValue:"switchRecordSheet"}),this.parent.view.canvas.dataCallView.stop(),this.view.canvas.dataCallView.stop(),"function"===typeof e&&e(),this.parent.view.canvas.dataCallView.start(),this.view.canvas.dataCallView.start(),this.view.canvas.resize.resize(),this.view.render(this.previewsheet.activeSheetId),this.parent.view.sheetsBar)?(this.parent.view.sheetsBar.spreadsheet=this.previewsheet,null===(t=this.parent.view.sheetsBar)||void 0===t||t.refreshUI(),h.c.sheetsBar.trigger("switchSheetEnd")):h.c.sheetsBar.listen("loadEnd",(function(){r.parent.view.sheetsBar.spreadsheet=r.previewsheet,h.c.sheetsBar.trigger("switchSheetEnd")}))}},{key:"getPreviewUrl",value:function(e){var t="",r="",a="";return void 0!=e.fRev&&parseInt(e.fRev)>=0&&(t="&fRev=".concat(e.fRev)),void 0!=e.ver&&(r="&rev=".concat(e.ver)),a=e.withWb?"&wb=1&nowb=0":"&wb=0&nowb=1","/dop-api/get/sheet?padId=".concat(e.padId).concat(r).concat(t,"&_r=").concat(parseInt(String(1e4*Math.random())),"&subId=").concat(e.sheetId,"&xsrf=").concat(Object(y.b)(),"&revdata=1").concat(a)}},{key:"fetch",value:function(e){return o()({method:"get",url:this.getPreviewUrl(e),responseType:"json"})}}]),t}()}.call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/external/revisionRecord/record.ts":function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return w})),r.d(t,"b",(function(){return m}));r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var a=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),s=r("../packages/mutation/src/MutationOperationType.ts"),i=r("../packages/mutation/src/MutationId.ts"),n=r("../packages/mutation/src/embedded/UpdateEmbeddedObjectMutation.ts"),o=r("../packages/model/src/cell/format/colorUtils.ts"),c=r("../packages/model/src/range/GridRange.ts"),h=r("../packages/mutation/src/cell/SetCellPropertiesMutation.ts"),u=r("../packages/model/src/cell/CellFormatDelta.ts"),l=r("../packages/model/src/cell/CellDataDelta.ts"),d=r("../packages/model/src/cell/CellDataSlot.ts"),p=r("../packages/model/src/cell/CellFormatSlot.ts"),v=r("../packages/model/src/dimension/DimensionType.ts");function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){Object(a.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function w(t,r,a){var h=t.sheetManager.getSheetBySheetId(r),u=[];return h&&function(){var r=a.author,l=JSON.parse(a.action),d=[];l.forEach((function(e){"ms"!==e.type&&"ct"!==e.type&&"revert"!==e.type&&d.push(t.parent.mutationBehavior.getCollabMutations(e))}));var p={},f=function(e,t,r){var a,u,l=Object(o.transparentColor)(r,.8);switch(e.operationType=s.a.HISTORY,e.id){case i.b.INSERT_DIMENSION_MUTATION:e.type===v.a.COLUMNS?a=new c.b(h.getSheetId(),0,h.getRowCount()-1,e.index,e.index+e.amount-1):e.type===v.a.ROWS&&(a=new c.b(h.getSheetId(),e.index,e.index+e.amount-1,0,h.getColCount()-1)),b(h,{gridRange:a,isBackground:!0,author:t,color:r});break;case i.b.SET_DIMENSION_PROPERTIES_MUTATION:case i.b.SET_DIMENSION_PROPERTIES_MUTATION:(u=e.ranges[0])&&(e.type===v.a.COLUMNS?a=new c.b(h.getSheetId(),0,h.getRowCount()-1,u.startIndex,u.endIndex):e.type===v.a.ROWS&&(a=new c.b(h.getSheetId(),u.startIndex,u.endIndex,0,h.getColCount()-1)),b(h,{gridRange:a,isBackground:!0,author:t,color:r}));break;case i.b.SET_CELL_PROPERTIES_MUTATION:case i.b.SET_RANGE_MUTATION:case i.b.DEFINE_FILTER_MUTATION:b(h,{gridRange:e.gridRange,isBackground:!0,author:t,color:r});break;case i.b.REORDER_RANGE_MUTATION:b(h,{gridRange:e.range,isBackground:!0,author:t,color:r});break;case i.b.MERGE_CELLS_MUTATION:case i.b.UNMERGE_CELLS_MUTATION:a=new c.b(h.getSheetId(),e.startRowIndex,e.endRowIndex,e.startColIndex,e.endColIndex),b(h,{gridRange:a,isBackground:!0,author:t,color:r});break;case i.b.ADD_EMBEDDED_OBJECT_MUTATION:case i.b.UPDATE_EMBEDDED_OBJECT_MUTATION:var d=e.data.id,f=new n.a({data:_(_({},e.data),{},{previewInfo:{recordAuthor:t,borderColor:"1px solid ".concat(l)}})});p[d]||(p[d]=f);break;case i.b.DELETE_EMBEDDED_OBJECT_MUTATION:var w=e.key;p[w]&&delete p[w];break;default:e.getAffectedGridRanges().forEach((function(e){return b(h,{gridRange:e,isBackground:!0,author:t,color:r})}))}};d&&r&&e.CoreSheet.historylist.getColorFromId(r)&&function(){for(var t=e.CoreSheet.historylist.getColorFromId(r),a=0,s=d.length;a<s;a++){d[a].forEach((function(e){f(e,r,t),u.push(e)}))}}()}(),u}function m(t,r){var a=t.data.getGridRangeHasData();if(a.isValid()){var s=r.author;b(t,{gridRange:a,isBackground:!0,author:s,color:e.CoreSheet.historylist.getColorFromId(s)})}}function b(e,t){var r=t.gridRange,a=t.color,s=t.isBackground,i=t.author,n=Object(o.transparentColor)(a,.2);if(r){var c=new u.a;s&&c.setSlot(p.b.BACKGROUND_COLOR,n);var v=new l.a;v.setSlot(d.b.SLOT_EFFIECTIVE_FORMAT_DELTA,c),v.setSlot(d.b.SLOT_AUTHOR,i);var f=new h.a({gridRange:r,cellDataDelta:v});e.spreadsheetReference.parent.mutationBehavior.applyMutation(f,{isLocal:!0},e)}}}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/external/revisionRecord/view.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/regenerator-runtime/runtime.js");var a=r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),s=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),i=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),n=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),o=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),c=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),h=r("./src/core/view/layout/view.ts"),u=r("./src/base/event/event.ts"),l=(r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/@babel/runtime/helpers/esm/get.js")),d=r("./src/core/view/View.level1.pc.ts"),p=(r("../node_modules/core-js/modules/es.array.find.js"),r("../node_modules/core-js/modules/es.function.name.js"),r("./src/base/index.ts")),v=function(){function e(t){var r=this;Object(s.a)(this,e),this._handleMove=function(e){if(e.isHoverCell()){var t=e.currRow,a=e.currCol,s=r._spreadsheet.activeSheet.getCellDataAtPosition(t,a),i=null===s||void 0===s?void 0:s.getMergeReference();i&&(t=i.startRowIndex,a=i.startColIndex);var n=r._getAuthor(t,a);if(n){var o=r._areaData.getDisplayViewLeftByCol(a)+r._headSize.displayRowHeadWidth,c=r._areaData.getDisplayViewTopByRow(t)+r._headSize.displayColHeadHeight;r._updateRecordViewHover({x:o,y:c},r._container.offsetWidth,r._container.offsetHeight,n)}else r._hoverTips.hide()}},this._spreadsheet=t.spreadsheet,this._mouseOperate=t.mouseOperate,this._container=t.container,this._areaData=t.areaData,this._headSize=t.headSize,this._hoverTips=this._makeHoverTips(),this._container.appendChild(this._hoverTips.element),this._container.onmouseleave=function(){r._hoverTips.hide()},this._mouseOperate.emitter.on(this._mouseOperate.EVENT.MOVE,this._handleMove)}return Object(i.a)(e,[{key:"_getAuthor",value:function(e,t){var r=this._spreadsheet.activeSheet.getCellDataAtPosition(e,t);return r&&r.getAuthor()||""}},{key:"_makeHoverTips",value:function(){var e=$("<div class='history-preview-user-tip user-select-none'>").html("<span class='history-preview-user-tip-content user-select-none'></span>"),t=$("<div class='history-preview-user-tip-wrapper user-select-none'>").css({position:"absolute",left:0,top:0});t.append(e);var r=null,a={element:t[0],hover:function(){return t},setPosition:function(e,t){this.hover().css({left:e,top:t})},setNickName:function(t){t||(t=""),e.find("span").text(t)},setBgColor:function(t){e.css("background-color",t||"black")},show:function(e,s){r&&(p.a.util.timer.erase(r),r=null),!0,p.a.util.timer.wait(0).run((function(){t.css("visibility","visible");var r=e.x;r+a.width()+16>s&&(r=s-a.width()-16);var i=e.y-a.height();i<2&&(i=2),a.setPosition(r,i)}))},hide:function(){r&&p.a.util.timer.erase(r),!1,r=p.a.util.timer.wait(200).run((function(){t.css("visibility","hidden")}))},width:function(){return e.width()+12},height:function(){return e.height()}};return a}},{key:"_updateRecordViewHover",value:function(e,t,r,a){var s=null,i=null,n=window.CoreSheet;if(a&&n&&n.historylist&&n.historylist.authorInfoForID&&n.historylist.getColorFromId){n.historylist.authorInfoForID(a)&&(i=n.historylist.authorInfoForID(a)),n.historylist.getColorFromId(a)&&(s=n.historylist.getColorFromId(a));var o=(i||{}).name,c=void 0===o?"\u534f\u4f5c\u8005":o;this._hoverTips.setBgColor(s),this._hoverTips.setNickName(c),this._hoverTips.show(e,t,r)}}}]),e}(),f=r("./src/core/view/level-2/LazyIndex.pc.ts");function _(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,a=Object(c.a)(e);if(t){var s=Object(c.a)(this).constructor;r=Reflect.construct(a,arguments,s)}else r=a.apply(this,arguments);return Object(o.a)(this,r)}}var w=function(e){Object(n.a)(r,e);var t=_(r);function r(e,a,i){var n;return Object(s.a)(this,r),(n=t.call(this,e,a,i))._levelPreviewInited=!1,n}return Object(i.a)(r,[{key:"_initScrollBar",value:function(){var e=Object(a.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.b)(f.a.SCROLL_BAR);case 2:t=e.sent.default,this._scrollBar=new t({mainBoard:this._mainBoard,areaData:this._areaData,scale:this._scale});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initContextMenu",value:function(){var e=Object(a.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.b)(f.a.CONTEXT_MENU_CENTER);case 2:t=e.sent.default,this._contextMenuCenter=new t({spreadsheetApp:this._spreadsheetApp,sheetStatus:this._spreadsheetApp.sheetStatus,container:this._container,mouseOperate:this._mouseOperate,scale:this._scale,areaData:this._areaData,operateData:this._operateData,mutexManagement:this._mutexManagement});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initRenderPluginExtension",value:function(){var e=Object(a.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.b)(f.a.RENDER_PLUGIN_EXTENSION);case 2:t=e.sent.default,this._renderPluginExtension=new t({alloyExcel:this._alloyExcel});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initFilterHeader",value:function(){var e=Object(a.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.b)(f.a.FILTER_CENTER);case 2:t=e.sent.default,this._filterCenter=new t({spreadsheetApp:this._spreadsheetApp,spreadsheet:this._spreadsheet,alloyExcel:this._alloyExcel,rowcolAccessor:this._rowcolAccessor,areaData:this._areaData,headSize:this._headSize,renderApi:this._renderApi,tableView:this._tableView,transformTable:this._transformTable,dataCallView:this._dataCallView,operateData:this._operateData});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initValidationList",value:function(){var e=Object(a.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.b)(f.a.PC_DATA_VALIDATION_CENTER);case 2:t=e.sent.default,this._dataValidationCenter=new t({spreadsheetApp:this._spreadsheetApp,spreadsheet:this._spreadsheet,alloyExcel:this._alloyExcel,normalSelectData:this._normalSelectData,tableView:this._tableView,rowcolAccessor:this._rowcolAccessor,areaData:this._areaData,headSize:this._headSize,renderApi:this._renderApi,mouseOperate:this._mouseOperate,touchOperate:this._touchOperate,operateData:this._operateData,clientRect:this._clientRect,mainBoard:this._mainBoard,mutexManagement:this._mutexManagement,sheetStatus:this._spreadsheetApp.sheetStatus,spreadsheetView:this._spreadsheetView});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initCopyFrame",value:function(){var e=Object(a.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.b)(f.a.COPY_FRAME);case 2:t=e.sent.default,this._copyFrame=new t({alloyExcel:this._alloyExcel,areaData:this._areaData,headSize:this._headSize,renderApi:this._renderApi,spreadsheet:this._spreadsheet});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initTableKeyboard",value:function(){var e=Object(a.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.b)(f.a.TABLE_KEYBOARD);case 2:t=e.sent.default,this._tableKeyboard=new t({spreadsheetApp:this._spreadsheetApp,board:this._container,config:{copyPaste:!0}});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initShapeEdit",value:function(){var e=Object(a.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.b)(f.a.SHAPE_EDIT_CENTER);case 2:t=e.sent.default,this._shapeEditCenter=new t({mainBoard:this._mainBoard,shapeStage:this._shapeStage,areaData:this._areaData,scale:this._scale,modifyShapeBroker:this._modifyBrokerCenter.shape,operateData:this._operateData,sheetStatus:this._spreadsheetApp.sheetStatus,normalSelectStage:this._normalSelectionStage,selectCells:this._selectCellsCenter.selectOperate,menu:this._contextMenuCenter.contextMenu,menuConfig:this._contextMenuCenter.config,mutexManagement:this._mutexManagement,spreadsheet:this._spreadsheet,autoScroll:this._autoScroll,dataCallView:this._dataCallView});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initRecordHover",value:function(){var e=Object(a.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:new v({spreadsheet:this._spreadsheet,mouseOperate:this._mouseOperate,container:this._container,areaData:this._areaData,headSize:this._headSize});case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initPreivew",value:function(){var e=Object(a.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(l.a)(Object(c.a)(r.prototype),"_level1Inited",this)){e.next=3;break}return e.next=3,Object(l.a)(Object(c.a)(r.prototype),"initLevel1",this).call(this);case 3:if(!this._levelPreviewInited){e.next=6;break}return console.info("view.preview \u5df2\u7ecf\u521d\u59cb\u5316"),e.abrupt("return");case 6:return console.info("view.preview \u521d\u59cb\u5316"),t=[f.a.SCROLL_BAR,f.a.RENDER_PLUGIN_EXTENSION,f.a.CONTEXT_MENU_CENTER,f.a.COPY_FRAME],e.next=10,Promise.all(t.map((function(e){return Object(f.b)(e)})));case 10:return e.next=12,this._initScrollBar();case 12:return e.next=14,this._initRenderPluginExtension();case 14:return e.next=16,this._initContextMenu();case 16:return e.next=18,this._initFilterHeader();case 18:return e.next=20,this._initValidationList();case 20:return e.next=22,this._initCopyFrame();case 22:return e.next=24,this._initTableKeyboard();case 24:return e.next=26,this._initShapeEdit();case 26:this._initRecordHover(),this._levelPreviewInited=!0;case 28:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"copyFrame",get:function(){return this._copyFrame}}]),r}(d.a),m=r("./src/core/view/spreadsheet-view/table-view/utils.ts");function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,a=Object(c.a)(e);if(t){var s=Object(c.a)(this).constructor;r=Reflect.construct(a,arguments,s)}else r=a.apply(this,arguments);return Object(o.a)(this,r)}}var g=function(e){Object(n.a)(o,e);var t=b(o);function o(e){var r;return Object(s.a)(this,o),(r=t.call(this,e)).parent=e,r}return Object(i.a)(o,[{key:"initCanvas",value:function(){var e=Object(a.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.canvas){e.next=2;break}throw new Error("\u89c6\u56fe\u5df2\u7ecf\u521d\u59cb\u5316");case 2:return t=document.querySelector("#canvasContainerPreview"),this.canvas=new w(this.parent,this.parent.preview.previewsheet,t),e.next=6,this.canvas.initLevel1({preview:!0});case 6:return Object(m.a)(this.canvas.tableView,0,this.parent.preview.previewsheet.activeSheet.getRowCount(),0,this.parent.preview.previewsheet.activeSheet.getColCount()),e.next=9,this.canvas.initPreivew();case 9:this.canvas.renderApi.renderNextTick(),this._afterCanvasLoaded();case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_afterCanvasLoaded",value:function(){this.initSheetsbar()}},{key:"initSheetsbar",value:function(){var e=this;r.e("bundle_sheetsbar_preview").then(r.bind(null,"./src/external/view/sheetsbar/pc-index.ts")).then((function(t){e.sheetsBar=new t.default({spreadsheet:e.parent.preview.previewsheet,app:e.parent}),u.c.sheetsBar.trigger("loadEnd")}))}},{key:"getActiveSheet",value:function(){return this.parent.preview.previewsheet.activeSheet}}]),o}(h.a);t.a=g}}]);
//# sourceMappingURL=pc-bundle_module_preview-81e7173e53.js.map