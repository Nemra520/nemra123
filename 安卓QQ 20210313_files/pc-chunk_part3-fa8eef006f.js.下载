(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk_part3"],{"../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!../packages/editor/src/blocks/mention-block/MentionBlock.less":function(e,t,r){(e.exports=r("../node_modules/css-loader/dist/runtime/api.js")(!1)).push([e.i,'#alloy-rich-text-editor .alloy-mention-block{display:inline-block;position:relative;width:auto;height:22px;line-height:22px;font-size:10pt;font-style:normal;font-weight:400;text-decoration:none;color:#0188fb;background-color:#fff;font-family:PingFang SC,Microsoft YaHei,\u9ed1\u4f53,\u5b8b\u4f53,sans-serif;border:1px solid rgba(0,0,0,.12);border-radius:11px;box-sizing:border-box;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;padding-left:7px;padding-right:20px;margin-left:1px;margin-right:1px;vertical-align:text-bottom;max-width:100px;white-space:nowrap;box-shadow:0 2px 5px #ececec}#alloy-rich-text-editor .alloy-mention-block:hover{background-color:#f4f4f4}#alloy-rich-text-editor .alloy-mention-block:active{background-color:#eaeaea}.alloy-mention-block:after{content:" ";display:inline-block;position:absolute;border-color:#0188fb transparent transparent;border-style:solid;border-width:5px 4px;top:50%;right:0;transform:translate(-50%,-25%);margin-right:4px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mention-block-content{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}span[fake-text=end],span[fake-text=start]{line-height:20px}',""])},"../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/board/main/BlockBoard.less":function(e,t,r){(e.exports=r("../node_modules/css-loader/dist/runtime/api.js")(!1)).push([e.i,".block-board{position:relative;height:100%;display:none}",""])},"../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/board/main/LineBoard.less":function(e,t,r){(e.exports=r("../node_modules/css-loader/dist/runtime/api.js")(!1)).push([e.i,".line-board{font-size:0;position:relative;display:none;white-space:nowrap}",""])},"../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/board/main/MainBoard.less":function(e,t,r){(e.exports=r("../node_modules/css-loader/dist/runtime/api.js")(!1)).push([e.i,".main-board{font-size:0;right:0;bottom:0;position:absolute;overflow:hidden}.main-board,.main-board .col-frozen,.main-board .row-frozen{box-sizing:border-box}",""])},"../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/board/main/feature-board/FeatureBoard.less":function(e,t,r){(e.exports=r("../node_modules/css-loader/dist/runtime/api.js")(!1)).push([e.i,".feature-board{position:absolute;left:0;top:0;transform-origin:left top;pointer-events:fill;z-index:3}",""])},"../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/board/main/feature-board/HiddenBoard.less":function(e,t,r){(e.exports=r("../node_modules/css-loader/dist/runtime/api.js")(!1)).push([e.i,".hidden-board{overflow:hidden;pointer-events:none}",""])},"../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/board/main/feature-board/WrapBoard.less":function(e,t,r){(e.exports=r("../node_modules/css-loader/dist/runtime/api.js")(!1)).push([e.i,".wrap-board{width:100%;height:100%;position:absolute;top:0;left:0}",""])},"../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/freeze-line/FreezeLine.less":function(e,t,r){(e.exports=r("../node_modules/css-loader/dist/runtime/api.js")(!1)).push([e.i,".freeze-horizontal{height:3px;width:100%;left:0}.freeze-horizontal,.freeze-vertical{background-color:#d6d6d6;position:absolute;display:none;z-index:10;visibility:hidden}.freeze-vertical{width:3px;height:100%;top:0}",""])},"../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/input-manager/formula-input-stage/FormulaBar.less":function(e,t,r){(e.exports=r("../node_modules/css-loader/dist/runtime/api.js")(!1)).push([e.i,".formula-bar{display:block;position:relative;width:100%;height:25px;line-height:25px;min-height:25px;max-height:75px;z-index:99;font-size:12px;border-top:1px solid #e2e4e8}",""])},"../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/input-manager/formula-input-stage/components/bar-dragger/BarDragger.less":function(e,t,r){(e.exports=r("../node_modules/css-loader/dist/runtime/api.js")(!1)).push([e.i,".bar-dragger{position:absolute;bottom:0;left:0;height:3px;width:100%}.bar-dragger:hover{background:#4b8cff;cursor:row-resize}",""])},"../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/input-manager/formula-input-stage/components/bar-label/BarLabel.less":function(e,t,r){(e.exports=r("../node_modules/css-loader/dist/runtime/api.js")(!1)).push([e.i,".bar-label{display:inline-block;width:50px;height:100%;box-sizing:border-box;border-right:1px solid #e0e2e4;text-align:center;line-height:inherit;background-color:#fff;color:#777;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;padding:0 4px}",""])},"../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/input-manager/formula-input-stage/components/formula-input/FormulaInput.less":function(e,t,r){(e.exports=r("../node_modules/css-loader/dist/runtime/api.js")(!1)).push([e.i,".formula-input{position:absolute;left:50px;top:0;padding:4px 8px;width:calc(100% - 66px);height:calc(100% - 8px);line-height:17px;font-size:12px;overflow-y:auto;background:#fff}",""])},"../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/input-manager/table-input-stage/InputStage.less":function(e,t,r){(e.exports=r("../node_modules/css-loader/dist/runtime/api.js")(!1)).push([e.i,".table-input-board{position:absolute;left:0;top:0;z-index:105;width:100%;-webkit-user-select:auto;-moz-user-select:auto;-ms-user-select:auto;user-select:auto}.table-input-stage{position:absolute;width:auto;height:auto;border:2px solid #4b8cff;z-index:105;background-color:#fff;box-sizing:border-box;transform-origin:top left}.table-input-container{overflow:auto}",""])},"../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/input-manager/table-input-stage/components/table-input/BaseTableInput.less":function(e,t,r){(e.exports=r("../node_modules/css-loader/dist/runtime/api.js")(!1)).push([e.i,".table-input [contenteditable=true]{caret-color:#1e6fff}",""])},"../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/input-manager/table-input-stage/components/tooltip-card/TooltipCard.less":function(e,t,r){(e.exports=r("../node_modules/css-loader/dist/runtime/api.js")(!1)).push([e.i,".tooltip-card{background-color:#4589eb;border-radius:1px;box-shadow:0 1px 2px rgba(0,0,0,.5);color:#fff;font-size:12px;line-height:14px;padding:6px 7px 4px;display:none;position:absolute;top:-26px;left:-2px;white-space:nowrap}",""])},"../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/operate-context/operate-board/OperateBoard.less":function(e,t,r){(e.exports=r("../node_modules/css-loader/dist/runtime/api.js")(!1)).push([e.i,".operate-board{width:100%;height:100%;position:absolute;top:0;left:0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}",""])},"../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/selection-stage/selection-ui/pc/FormulaSelection.less":function(e,t,r){(e.exports=r("../node_modules/css-loader/dist/runtime/api.js")(!1)).push([e.i,".formula-selection{position:absolute;border-width:2px;border-style:dashed;box-sizing:border-box;box-shadow:0 0 6px 2px #ddd;pointer-events:none}",""])},"../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/selection-stage/selection-ui/pc/MultipleSelection.less":function(e,t,r){(e.exports=r("../node_modules/css-loader/dist/runtime/api.js")(!1)).push([e.i,".multiple-selection{border:solid rgba(1,136,251,.1);display:none;pointer-events:none}.multiple-selection,.multiple-selection-active{position:absolute;box-shadow:0 0 0 1px #4b8cff;box-sizing:border-box}.multiple-selection-active{width:100%;height:100%;background:hsla(0,0%,100%,.1)}",""])},"../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/selection-stage/selection-ui/pc/SingleSelection.less":function(e,t,r){(e.exports=r("../node_modules/css-loader/dist/runtime/api.js")(!1)).push([e.i,".single-selection{position:absolute;border:solid rgba(1,136,251,.1);box-shadow:0 0 0 2px #4b8cff;box-sizing:border-box;display:none;pointer-events:none}",""])},"../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/selection-stage/smart-corner/SmartCorner.less":function(e,t,r){(e.exports=r("../node_modules/css-loader/dist/runtime/api.js")(!1)).push([e.i,".smart-corner{position:absolute;background-color:#4b8cff;height:5px;width:5px;border:2px solid #fff;cursor:crosshair;z-index:4;display:none;transform:translate(-4px,-5px)}",""])},"../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/shape-stage/image/BaseImage.less":function(e,t,r){(e.exports=r("../node_modules/css-loader/dist/runtime/api.js")(!1)).push([e.i,".shape-wrap{position:absolute;z-index:10}.shape-image-box{overflow:hidden;width:100%;height:100%;position:relative;background-size:100% 100%;background-repeat:no-repeat}.shape-image-box img{pointer-events:none;position:absolute;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}",""])},"../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/shape-stage/stage/board/DomShapeBoard.less":function(e,t,r){(e.exports=r("../node_modules/css-loader/dist/runtime/api.js")(!1)).push([e.i,"",""])},"../node_modules/raw-loader/dist/cjs.js!./src/core/view/spreadsheet-view/render-manager/alloy-excel/virtual-element/virtual-formulabar/Formulabar.css":function(e,t,r){"use strict";r.r(t),t.default=""},"../node_modules/raw-loader/dist/cjs.js!./src/core/view/spreadsheet-view/render-manager/alloy-excel/virtual-element/virtual-table/Table.css":function(e,t,r){"use strict";r.r(t),t.default=".ae_table {\n    border-collapse: collapse;\n    border-spacing: 0;\n    margin: 0;\n    border-width: 0;\n    table-layout: fixed;\n    width: 0;\n    outline-width: 0;\n    cursor: default;\n    max-width: none;\n    max-height: none;\n}\n\n.ae_table div, \n.ae_table input, \n.ae_table table, \n.ae_table tbody, \n.ae_table td, \n.ae_table textarea, \n.ae_table th, \n.ae_table thead {\n    box-sizing: content-box;\n}\n\n.ae_table_col,\n.ae_table_row {\n    text-align: center;\n    vertical-align: middle;\n}\n\n.ae_table_master,\n.ae_table_row,\n.ae_table_corner,\n.ae_table_col {\n    font-family: PingFang SC,Microsoft YaHei,\u9ed1\u4f53,\u5b8b\u4f53,sans-serif;\n    position: absolute;\n    left: 0;\n    top: 0;\n}"},"../node_modules/raw-loader/dist/cjs.js!./src/core/view/spreadsheet-view/render-manager/alloy-excel/virtual-element/virtual-td/Td.css":function(e,t,r){"use strict";r.r(t),t.default="/* .ae_table tr:first-child td {\n    border-top: 1px solid #ccc;\n} */\n\n.ae_table td {\n    border-top-width: 0;\n    border-left-width: 0;\n    border-right: 1px solid #ccc;\n    border-bottom: 1px solid #ccc;\n    empty-cells: show;\n    line-height: 21px;\n    padding: 0 4px;\n    background-color: #fff;\n    vertical-align: top;\n    overflow: hidden;\n    outline-width: 0;\n    word-break: break-word;\n    white-space: pre-line;\n    background-clip: padding-box;\n}\n\n.ae_table td>div {\n    line-height: 1.3;\n}\n\n.ae_table_row td {\n    vertical-align: middle !important;\n}"},"../node_modules/raw-loader/dist/cjs.js!./src/core/view/spreadsheet-view/render-manager/alloy-excel/virtual-element/virtual-th/Th.css":function(e,t,r){"use strict";r.r(t),t.default="/* .ae_table tr:first-child th {\n    border-top: 1px solid #ccc;\n} */\n\n.ae_table th {\n    border-top-width: 0;\n    border-left-width: 0;\n    border-right: 1px solid #ccc;\n    border-bottom: 1px solid #ccc;\n    empty-cells: show;\n    line-height: 21px;\n    padding: 0 4px;\n    background-color: #fff;\n    overflow: hidden;\n    outline-width: 0;\n    white-space: pre-line;\n    background-clip: padding-box;\n    font-weight: normal;\n}\n\n.ae_table th:first-child {\n    border-left: 1px solid #ccc;\n}"},"../packages/editor/src/AlloyBaseTextEditor.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js");var n,a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=r("../packages/lib/EventEmitter.ts"),s=r("../packages/lib/Keyboard.ts"),l=r("../packages/editor/src/helper/Env.ts"),c=function(){function e(t){Object(a.a)(this,e),this._inputDom=t.inputDom,this._emitter=t.emitter,this._editorInterface=t.editorInterface,this.handleCopy(),this.handlePaste()}return Object(o.a)(e,[{key:"handleCopy",value:function(){var e=this;l.a.ie&&!l.a.edge&&this._inputDom.addEventListener("copy",(function(t){var r,n;null===(r=window.clipboardData)||void 0===r||null===(n=r.setData)||void 0===n||n.call(r,"Text",e._editorInterface.getSelectedText()),t.preventDefault()}))}},{key:"handlePaste",value:function(){var e=this;this._inputDom.addEventListener("paste",(function(t){var r;if(e._editorInterface.active){t.preventDefault();var n="";if((null===t||void 0===t?void 0:t.clipboardData)||(null===t||void 0===t||null===(r=t.originalEvent)||void 0===r?void 0:r.clipboardData)?n=(t.originalEvent||t).clipboardData.getData("text/plain"):window.clipboardData&&(n=window.clipboardData.getData("Text")),0!==n.length){var a=document.createTextNode(n),o=document.getSelection();if(null===o||void 0===o?void 0:o.rangeCount){var i=o.getRangeAt(0);i.deleteContents(),i.insertNode(a),(i=i.cloneRange()).setStartAfter(a),i.setEndAfter(a),o.removeAllRanges(),o.addRange(i)}e._emitter.emit(w.EVENT.VALUE_CHANGE,{source:w.SOURCE.USER}),e._emitter.emit(w.EVENT.ON_PASTE,n,t)}}}))}}]),e}(),u=(r("../node_modules/core-js/modules/es.array.splice.js"),r("../packages/editor/src/helper/utils.ts")),d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,r=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;Object(a.a)(this,e),this.index=t,this.content=r,this.selection=n}return Object(o.a)(e,[{key:"equalsContent",value:function(e){return!!e&&Object(u.e)(this.content,!1)===Object(u.e)(e.content,!1)}},{key:"equalsSelection",value:function(e){return!!(this.selection&&e&&e.selection&&this.selection.start===e.selection.start&&this.selection.end===e.selection.end)}},{key:"equals",value:function(e){return this.equalsContent(e)&&this.equalsSelection(e)}}]),e}();!function(e){e[e.PRINTABLE_KEYS=0]="PRINTABLE_KEYS",e[e.NAVIGATION_KEYS=1]="NAVIGATION_KEYS",e[e.DELETE_KEYS=2]="DELETE_KEYS"}(n||(n={}));var h={8:1,46:1},f={37:1,38:1,39:1,40:1,36:1,35:1,33:1,34:1},p=function(){function e(t){Object(a.a)(this,e),this.hasUndo=!1,this.hasRedo=!1,this.snapShots=[],this.index=-1,this.currState=null,this.locked=!1,this.composing=!1,this.typing=!1,this.previousKeyGroup=-1,this.lastRecorded=0,this._inputDom=t.inputDom,this._emitter=t.emitter,this._editorInterface=t.editorInterface,this.clear(),this.setupNativeEditingHandler()}return Object(o.a)(e,[{key:"isComposing",value:function(){return this.composing}},{key:"setupNativeEditingHandler",value:function(){var e=this,t=this._inputDom;t.addEventListener("keydown",this.handleKeydown.bind(this)),t.addEventListener(l.a.ie&&!l.a.edge?"keypress":"input",this.handleInput.bind(this)),t.addEventListener("keyup",this.handleKeyup.bind(this)),t.addEventListener("compositionstart",(function(t){e.composing=!0,e.typing||e.onTypingStart()})),t.addEventListener("compositionend",(function(t){e.composing=!1,e._editorInterface.removeFillingCharNode(),e._emitter.emit(w.EVENT.VALUE_CHANGE,{source:w.SOURCE.USER})})),t.addEventListener(l.a.mobile?"touchend":"click",this.onClick.bind(this)),t.addEventListener("paste",this.handlePasteAndDrop.bind(this)),t.addEventListener("drop",this.handlePasteAndDrop.bind(this)),l.a.mobile&&window.document.addEventListener("selectionchange",(function(){window.document.activeElement===t&&(e.updateSelection(),e._emitter.emit(w.EVENT.SELECTION_CHANGE))}))}},{key:"onClick",value:function(){var e=this;setTimeout((function(){e.typing?(e.save(!0)||e.updateSelection(),e.resetTypingVars()):e.updateSelection();e._emitter.emit(w.EVENT.SELECTION_CHANGE)}),0)}},{key:"handlePasteAndDrop",value:function(){var e=this;setTimeout((function(){e.save(!0),e.refreshState()}),0)}},{key:"handleKeydown",value:function(e){var t=e.keyCode,r=this.getKeyGroup(t);if(e[u.b]&&("z"===e.key||90===e.keyCode)||e[u.b]&&("y"===e.key||89===e.keyCode)||e[u.b]&&e.shiftKey&&("z"===e.key||90===e.keyCode))e.preventDefault();else if(!this.composing&&(e[u.b]||e.altKey||e.ctrlKey||e.shiftKey))this.save(!0),this.previousKeyGroup=r;else if(r===n.PRINTABLE_KEYS)this.previousKeyGroup===n.DELETE_KEYS&&(this.save(!0),this.resetTypingVars()),this.typing||this.onTypingStart(),this.previousKeyGroup=r;else if(r===n.NAVIGATION_KEYS)this._editorInterface.removeFillingCharNode(),this.typing&&(this.save(!0),this.resetTypingVars()),this.previousKeyGroup=r;else{if(this._editorInterface.removeFillingCharNode(),this.composing)return;this.typing?this.typing&&this.previousKeyGroup===n.PRINTABLE_KEYS&&(this.save(!0),this.resetTypingVars()):this.onTypingStart()}}},{key:"updateSelection",value:function(e){if(!this.snapShots.length)return!1;e||(e=this.getCurrentHistoryState());var t=this.index,r=this.snapShots[t];return(null===r||void 0===r?void 0:r.equalsContent(e))&&!r.equalsSelection(e)?(e.index=t,this.snapShots[t]=e,this.currState=e,!0):!(!r||r.equalsContent(e)||r.equalsSelection(e))&&this.save(!0)}},{key:"onTypingStart",value:function(){this.typing=!0,this.hasUndo=!0,this.hasRedo=!1,this.onChange()}},{key:"handleInput",value:function(){var e=this;this.composing||this._editorInterface.removeFillingCharNode(),l.a.ie?setTimeout((function(){e._emitter.emit(w.EVENT.VALUE_CHANGE,{source:w.SOURCE.USER})}),0):this._emitter.emit(w.EVENT.VALUE_CHANGE,{source:w.SOURCE.USER})}},{key:"handleKeyup",value:function(t){var r=t.keyCode,a=this.getKeyGroup(r),o=Date.now();if(a===n.DELETE_KEYS){if(this.composing)return;o-this.lastRecorded>=e.DEFAULTS.delay&&this.save(!0),this.previousKeyGroup=a,this._emitter.emit(w.EVENT.SELECTION_CHANGE)}a===n.NAVIGATION_KEYS&&(this.updateSelection(),this._emitter.emit(w.EVENT.SELECTION_CHANGE)),this.lastRecorded=o}},{key:"getKeyGroup",value:function(e){if("number"!==typeof e)throw new Error("keyCode should be number!");return h[e]?n.DELETE_KEYS:f[e]?n.NAVIGATION_KEYS:n.PRINTABLE_KEYS}},{key:"keyGroupChanged",value:function(e){return this.getKeyGroup(e)!==this.previousKeyGroup}},{key:"onChange",value:function(){this._emitter.emit(w.EVENT.UNDO_REDO_CHANGE,{canUndo:this.hasUndo,canRedo:this.hasRedo})}},{key:"clear",value:function(){this.hasUndo=!1,this.hasRedo=!1,this.snapShots=[],this.index=-1,this.currState=null,this.locked=!1,this.resetTypingVars(),this.refreshState()}},{key:"lock",value:function(){this.locked=!0}},{key:"unlock",value:function(){this.locked=!1}},{key:"getNextHistoryState",value:function(e){if(this.snapShots.length<=0)return null;var t,r;if(this.currState)if(e){for(t=this.index-1;t>=0;t--)if(!(r=this.snapShots[t]).equals(this.currState))return r.index=t,r}else for(t=this.index+1;t<this.snapShots.length;t++)if(!(r=this.snapShots[t]).equals(this.currState))return r.index=t,r;return null}},{key:"restoreHistoryState",value:function(e){e&&(this.index=e.index,this.currState=this.snapShots[this.index],this._editorInterface.setContent(e.content),this._editorInterface.setSelection(e.selection),this.refreshState())}},{key:"refreshState",value:function(){this.hasUndo=!!this.getNextHistoryState(!0),this.hasRedo=!!this.getNextHistoryState(!1),this.resetTypingVars(),this.onChange()}},{key:"resetTypingVars",value:function(){this.composing=!1,this.typing=!1,this.previousKeyGroup=-1,this.lastRecorded=0}},{key:"undo",value:function(){if(this.hasUndo){this.save(!0);var e=this.getNextHistoryState(!0);e&&this.restoreHistoryState(e)}}},{key:"redo",value:function(){if(this.hasRedo&&(this.save(!0),this.hasRedo)){var e=this.getNextHistoryState(!1);e&&this.restoreHistoryState(e)}}},{key:"save",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.locked){var r=this.getCurrentHistoryState();if(this.currState&&r.equalsContent(this.currState)){if(t)return!1;if(r.equalsSelection(this.currState))return!1}return this.snapShots.splice(this.index+1,this.snapShots.length-this.index-1),this.snapShots.length==e.DEFAULTS.maxStack&&this.snapShots.shift(),this.index=this.snapShots.push(r)-1,r.index=this.index,this.currState=r,!0}}},{key:"getCurrentHistoryState",value:function(){var e=this._editorInterface.getContent(),t=this._editorInterface.getSelection();return new d(-1,e,t)}}]),e}();p.DEFAULTS={delay:1200,maxStack:100};var _=p,m=(r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.from.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.string.trim.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../packages/editor/src/interface.ts")),v=r("../packages/editor/src/blocks/mention-block/MentionBlock.ts"),g=function(){function e(t){Object(a.a)(this,e),this._rootDom=t.rootDom,this._inputDom=t.inputDom,this._platform=t.platform,this._editorInterface=t.editorInterface}return Object(o.a)(e,[{key:"getInputDom",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this._inputDom.cloneNode(!0),r=t.querySelectorAll("br.extra");return Array.from(r).forEach((function(e){e&&e.parentNode&&e.parentNode.removeChild(e)})),e||this._recursiveRemoveHelpingChar(t),t}},{key:"getSelectedText",value:function(){var e=this._editorInterface.getSelection(),t=this.getData(!0),r="";return e&&!e.isCollapsed()&&(r=t&&t.substring(e.start,e.end),r=(r=Object(u.e)(r)).replace(v.a,"")),r}},{key:"setData",value:function(e){this._inputDom.innerText=e||"";var t=document.createElement("br");t.className="extra",this._inputDom.appendChild(t)}},{key:"getData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.getInputDom(e);return this._polyfillGetData(t)}},{key:"getHTMLContent",value:function(){return this._inputDom.innerHTML}},{key:"setHTMLContent",value:function(e){this._inputDom.innerHTML=e}},{key:"getTextContent",value:function(){return this._inputDom.innerText}},{key:"setTextContent",value:function(e){this._inputDom.innerText=e}},{key:"doLineBreak",value:function(){var e,t;if(window.getSelection&&(e=window.getSelection())&&e.getRangeAt&&e.rangeCount){(t=e.getRangeAt(0)).deleteContents();var r=document.createElement("div");r.innerHTML="<br>";for(var n,a,o=document.createDocumentFragment();n=r.firstChild;)a=o.appendChild(n);t.insertNode(o),a&&((t=t.cloneRange()).setStartAfter(a),t.collapse(!0),e.removeAllRanges(),e.addRange(t),this._platform!==m.d.PC||l.a.ie?this._platform!==m.d.PC&&this.scrollToBottom():a.scrollIntoViewIfNeeded?a.scrollIntoViewIfNeeded():a.scrollIntoView&&(a.scrollIntoView(),document.body.scrollTop=0))}}},{key:"scrollToBottom",value:function(){this._rootDom.scrollTop=this._rootDom.scrollHeight}},{key:"_recursiveRemoveHelpingChar",value:function(e){if(e.nodeType===Node.TEXT_NODE)e.textContent=Object(u.e)(e.textContent||""),e.textContent=e.textContent.replace(v.a,"");else for(var t,r=0;r<e.childNodes.length;r++)t=e.childNodes[r],this._recursiveRemoveHelpingChar(t)}},{key:"_polyfillGetData",value:function(e){return this._recursiveParseNodeInnerTextString(e)}},{key:"_recursiveParseNodeInnerTextString",value:function(e){if(e.nodeType===Node.TEXT_NODE)return e.textContent||"";if(e.nodeName&&"BR"===e.nodeName.toUpperCase())return String.fromCharCode(10);if(e&&e.className===m.a)return(e.textContent||"").trim();for(var t="",r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];t+=this._recursiveParseNodeInnerTextString(n)}return t}}]),e}(),b=r("../packages/editor/src/core/Selection.ts"),y=function(){function e(t){Object(a.a)(this,e),this.rootDom=t.parent,this.platform=t.platform||m.d.PC,this.editable=!1!==t.editable,this.emitter=new i.a}return Object(o.a)(e,[{key:"setEditable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e!==this.editable&&(this.editable=e,this.input.setAttribute("contenteditable",this.editable.toString()))}},{key:"on",value:function(e,t,r){this.emitter.on(e,t,r)}},{key:"off",value:function(e,t,r){this.emitter.off(e,t,r)}},{key:"setActive",value:function(e){this.active=e}},{key:"setContent",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.SOURCE.API;this.textService.setHTMLContent(t),r!==e.SOURCE.SILENT&&(this.emitter.emit(e.EVENT.VALUE_CHANGE,{source:r}),this.emitter.emit(e.EVENT.SELECTION_CHANGE,{source:r}))}},{key:"getContent",value:function(){return this.textService.getHTMLContent()}},{key:"getText",value:function(){return this.textService.getData()}},{key:"setText",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.SOURCE.API,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.textService.setData(t||""),n&&this.collapseToEnd(),r!==e.SOURCE.SILENT&&(this.emitter.emit(e.EVENT.VALUE_CHANGE,{source:r}),this.emitter.emit(e.EVENT.SELECTION_CHANGE,{source:r}))}},{key:"getSelectedText",value:function(){return this.textService.getSelectedText()}},{key:"getRawText",value:function(){return this.textService.getData(!0)}},{key:"insertNewLine",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.SOURCE.API;this.selection.removeFillingCharNode();var r=this.input.lastChild;if(!r||"BR"!==r.nodeName){var n=document.createElement("br");n.className="extra",this.input.appendChild(n)}this.textService.doLineBreak(),this.history.save(!0),this.history.refreshState(),t!==e.SOURCE.SILENT&&(this.emitter.emit(e.EVENT.SELECTION_CHANGE,{source:t}),this.emitter.emit(e.EVENT.VALUE_CHANGE,{source:t}))}},{key:"getInputDom",value:function(){return this.textService.getInputDom()}},{key:"isComposing",value:function(){return this.history.isComposing()}},{key:"getSelection",value:function(){return this.selection.getRange()}},{key:"setSelection",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.SOURCE.API;this.selection.setRange(t),r!==e.SOURCE.SILENT&&this.emitter.emit(e.EVENT.SELECTION_CHANGE,{source:r})}},{key:"isCollapsed",value:function(){return this.selection.isCollapsed()}},{key:"collapseToEnd",value:function(){this.selection.collapseToEnd()}},{key:"hasFocus",value:function(){return this.selection.hasFocus()}},{key:"focus",value:function(){this.selection.focus()}},{key:"blur",value:function(){this.selection.blur()}},{key:"removeFillingCharNode",value:function(){this.selection.removeFillingCharNode()}},{key:"createFillingCharNode",value:function(){return this.selection.createFillingCharNode()}},{key:"save",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.history.save(e)}},{key:"undo",value:function(){this.history.undo()}},{key:"redo",value:function(){this.history.redo()}},{key:"refreshUndoRedoState",value:function(){this.history.refreshState()}},{key:"lock",value:function(){this.history.lock()}},{key:"unlock",value:function(){this.history.unlock()}},{key:"addBinding",value:function(e){this.keyboard.addBinding(e)}},{key:"removeBinding",value:function(e){this.keyboard.removeBinding(e)}},{key:"attachEventToInput",value:function(e,t){this.input.addEventListener(e,t)}},{key:"clear",value:function(){this.textService.setData(""),this.history.clear()}},{key:"initEditorCores",value:function(){this.clipboard=new c({inputDom:this.input,emitter:this.emitter,editorInterface:this}),this.selection=new b.b({inputDom:this.input,platform:m.d.PC,editorInterface:this}),this.textService=new g({rootDom:this.rootDom,inputDom:this.input,platform:m.d.PC,editorInterface:this}),this.keyboard=new s.c({root:this.input}),this.history=new _({inputDom:this.input,emitter:this.emitter,editorInterface:this})}},{key:"initEditorEvents",value:function(){var t=this;this.emitter.on(e.EVENT.SELECTION_CHANGE,(function(){var e=t.getSelection();(!t.currSelection&&e||t.currSelection&&e&&!t.currSelection.equals(e))&&(t.currSelection=e)}))}},{key:"EVENT",get:function(){return e.EVENT}},{key:"SOURCE",get:function(){return e.SOURCE}},{key:"isActive",get:function(){return this.active}}]),e}();y.EVENT={FOCUS:"FOCUS",BLUR:"BLUR",VALUE_CHANGE:"VALUE_CHANGE",SELECTION_CHANGE:"SELECTION_CHANGE",FORMAT_CHANGE:"FORMAT_CHANGE",UNDO_REDO_CHANGE:"UNDO_REDO_CHANGE",ON_PASTE:"ON_PASTE",ON_KEY_DOWN:"ON_KEY_DOWN"},y.SOURCE={USER:"USER",API:"API",SILENT:"SILENT"};var w=t.a=y},"../packages/editor/src/blocks/mention-block/MentionBlock.less":function(e,t,r){var n=r("../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!../packages/editor/src/blocks/mention-block/MentionBlock.less");"string"===typeof n&&(n=[[e.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r("../node_modules/style-loader/lib/addStyles.js")(n,a);n.locals&&(e.exports=n.locals)},"../packages/editor/src/blocks/mention-block/MentionBlock.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return p}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.from.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.string.search.js"),r("../node_modules/core-js/modules/es.string.trim.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),i=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),s=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),l=r("../packages/editor/src/helper/Env.ts"),c=r("../packages/editor/src/core/Selection.ts"),u=function(){function e(t){Object(n.a)(this,e),this._rootDom=t.rootDom,this._inputDom=t.inputDom,this._blockInterface=t.blockInterface,this._emitter=t.emitter}return Object(a.a)(e,[{key:"createElementFromHTML",value:function(e){var t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild}}]),e}(),d=r("../packages/editor/src/interface.ts"),h=r("../packages/editor/src/AlloyBaseTextEditor.ts");function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var p=String.fromCharCode(8203),_=function(e){Object(o.a)(i,e);var t=f(i);function i(e,r){var a;return Object(n.a)(this,i),(a=t.call(this,e))._enteringMention=!1,a._mentionStartIndex=0,a._isComposing=!1,a._platform=e.platform,a._hooks=r.hooks,a.polyfillForClosest(),a.initCssStyle(),a}return Object(a.a)(i,[{key:"clickOrTouchHandler",value:function(e){var t;this.enteringMention&&this.triggerEndMention();var r=null===(t=e.target)||void 0===t?void 0:t.closest(".alloy-mention-block");if(r){var n=null;try{n=JSON.parse(r.dataset.mentionDetail)}catch(h){console.error("JSON Parse MentionDetail error!")}if(n){var a,o,i,s,l=r.getBoundingClientRect(),c={x:l.x||l.left,y:(l.y||l.top)+l.height};null===(a=(o=this._hooks).closeRemindBoard)||void 0===a||a.call(o),null===(i=(s=this._hooks).showRemindBoard)||void 0===i||i.call(s,n.mentionId,c)}}else{var u,d;null===(u=(d=this._hooks).closeRemindBoard)||void 0===u||u.call(d)}}},{key:"ensureFakeTextSpanFine",value:function(){var e=!1,t=document.querySelectorAll(".".concat(d.a));return Array.from(t).forEach((function(t){var r=t.previousSibling,n=t.nextSibling;if(r){var a=r.innerText.trim();if(a&&a.length>1){r.innerText=a.replace(p,""),r.removeAttribute("fake-text");var o=document.createElement("span");o.setAttribute("fake-text","start"),o.innerText=p,t.parentNode&&t.parentNode.insertBefore(o,t),e=!0}}if(n){var i=n.innerText.trim();if(i&&i.length>1){n.innerText=i.replace(p,""),n.removeAttribute("fake-text");var s=document.createElement("span");s.setAttribute("fake-text","end"),s.innerText=p,t.parentNode&&t.parentNode.insertBefore(s,n),e=!0}}})),e}},{key:"findMentionBlockBeforePos",value:function(e){var t=0,r=null;return function e(n,a){if(n.nodeType===Node.TEXT_NODE||"BR"===n.tagName)n.nodeType===Node.TEXT_NODE?t+=(n.textContent||"").length:t+=1;else if(n&&n.className===d.a){var o=(n.textContent||"").trim().length;t+o+1===a&&(r=n),t+=o}else for(var i=0;i<n.childNodes.length;i++){e(n.childNodes[i],a)}}(this._inputDom,e),r}},{key:"findMentionBlockAfterPos",value:function(e){var t=0,r=null;return function e(n,a){if(n.nodeType===Node.TEXT_NODE||"BR"===n.tagName)n.nodeType===Node.TEXT_NODE?t+=n.length:t+=1;else if(n&&n.className===d.a){var o=(n.textContent||"").trim().length;a+1===t&&(r=n),t+=o}else for(var i=0;i<n.childNodes.length;i++){e(n.childNodes[i],a)}}(this._inputDom,e),r}},{key:"getMentionListPosition",value:function(){var e=this.getNativeRange();if(e){var t=e.getClientRects();if(t&&t.length){var r=t[0];return{x:r.x||r.left,y:(r.y||r.top)+r.height}}}var n=this._rootDom.getBoundingClientRect();return{x:n.x||n.left,y:(n.y||n.top)+n.height}}},{key:"getNativeRange",value:function(){var e=document.getSelection();return e&&e.rangeCount?e.getRangeAt(0):null}},{key:"prepareForInsertMention",value:function(){var e=null,t=this._blockInterface.getSelection();if(t){var r=t.start;this._mentionStartIndex<=r&&(this._blockInterface.setSelection(new c.a(Math.max(0,this._mentionStartIndex-1),r)),(e=this.getNativeRange())&&e.deleteContents())}}},{key:"insertMention",value:function(e){var t=this.getNativeRange();if(t){var r=this.create(e);if(r.forEach((function(e){t.insertNode(e),t.collapse(!1)})),l.a.safari){var n=document.createRange(),a=r[r.length-1];n.setStartAfter(a),n.setEndAfter(a);var o=document.getSelection();o&&(o.removeAllRanges(),o.addRange(n))}this._emitter.emit(h.a.EVENT.VALUE_CHANGE,{source:h.a.SOURCE.API})}}},{key:"triggerMentionListSearch",value:function(){var e=this;this._platform===d.d.MOBILE||this._isComposing||setTimeout((function(){var t,r,n=e._blockInterface.getRawText(),a=e._blockInterface.getSelection();if(a){var o=n.substring(e._mentionStartIndex,a.end);o.length>24&&e.triggerEndMention(),null===(t=(r=e._hooks).search)||void 0===t||t.call(r,o)}}))}},{key:"triggerEndMention",value:function(){var e,t;this.resetVars(),this._blockInterface.unlock(),this._blockInterface.removeFillingCharNode(),null===(e=(t=this._hooks).hideMentionList)||void 0===e||e.call(t)}},{key:"resetVars",value:function(){this._enteringMention=!1,this._mentionStartIndex=0,this._isComposing=!1}},{key:"create",value:function(e){return[this.createFakeText("start"),this.createMentionBlock(e),this.createFakeText("end")]}},{key:"createFakeText",value:function(e){var t=document.createElement("span");t.setAttribute("fake-text",e);var r=document.createTextNode(p);return t.appendChild(r),t}},{key:"createMentionBlock",value:function(e){var t=e.text||"",r=null,n="\n            <span class=".concat(d.a,'>\n                <div class="mention-block-content" contenteditable="false">\n                    <span>').concat(t,"</span>\n                </div>\n            </span>");return(r=this.createElementFromHTML(n)).setAttribute("data-mention-detail",JSON.stringify(e)),r}},{key:"polyfillForClosest",value:function(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null})}},{key:"initCssStyle",value:function(){r("../packages/editor/src/blocks/mention-block/MentionBlock.less")}},{key:"enteringMention",get:function(){return this._enteringMention}}]),i}(u);t.b=_},"../packages/editor/src/core/Selection.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.string.trim.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("../packages/editor/src/interface.ts"),i=r("../packages/editor/src/helper/utils.ts"),s=r("../packages/editor/src/AlloyBaseTextEditor.ts"),l=function(){function e(t,r){Object(n.a)(this,e),t=Math.max(0,t),r=Math.max(0,r),this._start=Math.min(t,r),this._end=Math.max(t,r)}return Object(a.a)(e,[{key:"equals",value:function(e){return"number"===typeof e._start&&e._start===this._start&&"number"===typeof e._end&&e._end===this._end}},{key:"isCollapsed",value:function(){return this._start===this._end}},{key:"start",get:function(){return this._start}},{key:"end",get:function(){return this._end}}]),e}(),c=function(){function e(t){var r=this;Object(n.a)(this,e),this._inputDom=t.inputDom,this._platform=t.platform,this._editorInterface=t.editorInterface,this._currentFillingCharNode=null,this._polyfillIfNeed(),this._inputDom.addEventListener("focus",(function(e){r._editorInterface.emitter.emit(s.a.EVENT.FOCUS,e)})),this._inputDom.addEventListener("blur",(function(e){r._editorInterface.emitter.emit(s.a.EVENT.BLUR,e)}))}return Object(a.a)(e,[{key:"initFillingCharNode",value:function(e){this._currentFillingCharNode=e}},{key:"createFillingCharNode",value:function(){return this.removeFillingCharNode(),this._currentFillingCharNode=document.createTextNode("\ufeff")}},{key:"removeFillingCharNode",value:function(){var e;if((!(null===(e=this._editorInterface.mentionBlock)||void 0===e?void 0:e.enteringMention)||this._platform!==o.d.PC)&&this._currentFillingCharNode){var t=this._currentFillingCharNode;this._currentFillingCharNode=null;var r=document.getSelection();if(!r)return;this._checkSelection(r);var n=(null===r||void 0===r?void 0:r.rangeCount)?r.getRangeAt(0):null,a=(t.nodeValue||"").indexOf("\ufeff"),s=null;t.length>"\ufeff".length&&n&&n.intersectsNode(t)&&(s=[{node:r.anchorNode,offset:r.anchorOffset},{node:r.focusNode,offset:r.focusOffset}],r&&r.anchorNode==t&&r.anchorOffset>a&&(s[0].offset-="\ufeff".length),r&&r.focusNode==t&&r.focusOffset>a&&(s[1].offset-="\ufeff".length));try{t.nodeValue=Object(i.e)(t.nodeValue||"",!0)}catch(l){console.error("AlloyRTE selection error: ",l)}s&&this.moveNativeSelectionToBookmark(s)}}},{key:"moveNativeSelectionToBookmark",value:function(e){var t=document.getSelection();if(t){var r=document.createRange();r.setStart(e[0].node,e[0].offset),t.extend||r.setEnd(e[1].node,e[1].offset),r.collapse(!0),t.removeAllRanges(),t.addRange(r),t.extend&&t.extend(e[1].node,e[1].offset)}}},{key:"isCollapsed",value:function(){var e=document.getSelection();return!(!e||e.rangeCount<=0)&&(this._checkSelection(e),e.getRangeAt(0).collapsed)}},{key:"hasFocus",value:function(){var e=document.activeElement===this._inputDom||u(this._inputDom,document.activeElement),t=document.getSelection(),r=!!(t&&t.rangeCount>0);return e&&r}},{key:"focus",value:function(){if(!this.hasFocus()){this._inputDom.focus();var e=document.getSelection();e&&!e.rangeCount&&e.selectAllChildren(this._inputDom)}}},{key:"blur",value:function(){this._inputDom.blur()}},{key:"collapseToEnd",value:function(e){"undefined"===typeof e&&(e=this._editorInterface.getRawText().length),this.setRange(new l(e,e))}},{key:"collapseToPoint",value:function(e){var t=this._editorInterface.getText().length;e<0&&(e=0),e>t&&(e=t),this.setRange(new l(e,e))}},{key:"setRange",value:function(e){if(e){var t=document.createRange();if(0===e.start&&0===e.end)return t.setStart(this._inputDom,0),t.setEnd(this._inputDom,0),void this.setNativeRange(t);var r={},n=0,a=!1;try{!function i(s){if(s&&e)if(s.nodeType===Node.TEXT_NODE||"BR"===s.tagName){var l="BR"===s.tagName?1:s.length,c=n+l;if(!a&&e.start>=n&&e.start<=c&&("BR"===s.tagName?t.setStartAfter(s):t.setStart(s,e.start-n),a=!0),a&&e.end>=n&&e.end<=c)throw"BR"===s.tagName?t.setEndAfter(s):t.setEnd(s,e.end-n),r;n=c}else if(s&&s.className===o.a){var u=(s.textContent||"").trim().length;if(!a&&n<e.start&&e.start<n+u&&(e.start<n+u/2?t.setStart(s,0):t.setStart(s,u),a=!0),a&&n<e.end&&e.end<n+u)throw e.end<n+u/2?t.setEnd(s,0):t.setEnd(s,u),r;n+=u}else for(var d=0;d<s.childNodes.length;d++){i(s.childNodes[d])}}(this._inputDom)}catch(i){if(i!==r)throw this.collapseToEnd(),i;this.setNativeRange(t)}}}},{key:"getRange",value:function(){var e=document.getSelection();if(!e||e.rangeCount<=0)return null;var t=0,r=0,n=0,a=!1,i={};if(e.rangeCount>0){this._checkSelection(e);var s=e.getRangeAt(0),c=this.normalizeNativeRange(s);try{!function e(s,l){if(s&&l)if(s.nodeType===Node.TEXT_NODE||"BR"===s.tagName){if(a||s!=l.start.node||(r=t+l.start.offset,a=!0),a&&s==l.end.node)throw n=t+l.end.offset,i;s.nodeType===Node.TEXT_NODE?t+=s.length:t+=1}else if(s&&s.className===o.a){var c=(s.textContent||"").trim().length;if(a||s!==l.start.node||(r=t+(l.start.offset<c/2?0:c),a=!0),a&&s===l.end.node)throw n=t+(l.end.offset<c/2?0:c),i;t+=c}else for(var u=0;u<s.childNodes.length;u++){e(s.childNodes[u],l)}}(this._inputDom,c)}catch(u){if(u!=i)throw u}}return new l(r,n)}},{key:"setNativeRange",value:function(e){if(e){var t=document.getSelection();t&&(t.removeAllRanges(),t.addRange(e))}}},{key:"normalizeNativeRange",value:function(e){if(!u(this._inputDom,e.startContainer)||!e.collapsed&&!u(this._inputDom,e.endContainer))return null;var t={start:{node:e.startContainer,offset:e.startOffset},end:{node:e.endContainer,offset:e.endOffset},native:e};return[t.start,t.end].forEach((function(e){var t=e.node,r=e.offset;if(t&&t.className===o.a);else for(;!(t instanceof Text)&&t.childNodes.length>0;)if(t.childNodes.length>r)t=t.childNodes[r],r=0;else{if(t.childNodes.length!==r)break;r=(t=t.lastChild)instanceof Text?t.data.length:t.childNodes.length>0?t.childNodes.length:t.childNodes.length+1}e.node=t,e.offset=r})),t}},{key:"_polyfillIfNeed",value:function(){window.Range.prototype.intersectsNode||(window.Range.prototype.intersectsNode=function(e){var t=document.createRange();t.selectNode(e);var r=!1;try{r=0>this.compareBoundaryPoints(window.Range.END_TO_START,t)&&0<this.compareBoundaryPoints(window.Range.START_TO_END,t)}catch(n){console.warn("IE polyfill intersectsNode error: ",n)}return r})}},{key:"_checkSelection",value:function(e){if(e&&e.rangeCount)try{e.getRangeAt(0)}catch(t){e.removeAllRanges(),this.setRange(this._editorInterface.currSelection)}}}]),e}();function u(e,t){try{t.parentNode}catch(r){return!1}return function(e,t){for(var r=t;null!=r;){if(r==e)return!0;r=r.parentNode}return!1}(e,t)}t.b=c},"../packages/editor/src/helper/Env.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.match.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=navigator.userAgent.toLowerCase(),i=o.match(/edge[ /](\d+.?\d*)/),s=o.indexOf("trident/")>-1,l=!(!i&&!s),c=function(){function e(){Object(n.a)(this,e)}return Object(a.a)(e,null,[{key:"ie",get:function(){return l}},{key:"edge",get:function(){return!!i}},{key:"webkit",get:function(){return!l&&o.indexOf(" applewebkit/")>-1}},{key:"mac",get:function(){return o.indexOf("macintosh")>-1}},{key:"mobile",get:function(){return o.indexOf("mobile")>-1}},{key:"iOS",get:function(){return/(ipad|iphone|ipod)/.test(o)}},{key:"isPcTencentDocApp",get:function(){return"undefined"!==typeof external&&"undefined"!==typeof external.nativeCall}},{key:"gecko",get:function(){return"Gecko"==navigator.product&&!e.webkit&&!e.ie}},{key:"firefox",get:function(){return e.gecko||o.indexOf("firefox")>-1}},{key:"chrome",get:function(){return e.webkit&&o.indexOf("chrome")>-1}},{key:"safari",get:function(){return e.webkit&&!e.chrome}}]),e}();t.a=c},"../packages/editor/src/helper/utils.ts":function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return a})),r.d(t,"e",(function(){return i})),r.d(t,"d",(function(){return s})),r.d(t,"f",(function(){return l})),r.d(t,"c",(function(){return c})),r.d(t,"g",(function(){return u}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.object.get-own-property-names.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.constructor.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.match.js"),r("../node_modules/core-js/modules/es.string.replace.js");var n=/Mac/i.test(navigator.platform)?"metaKey":"ctrlKey",a="\ufeff",o=new RegExp("".concat(a,"( )?"),"g");function i(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e=e||"",t?e.replace(o,(function(e,t){return t?"\xa0":""})):e.replace(a,"")}function s(e){var t=function(e){return[255&e,(65280&e)>>8,(16711680&e)>>16]}(e);return"rgb(".concat(t[0],",").concat(t[1],",").concat(t[2],")")}function l(e){if("string"!==typeof e)return e;var t,r,n,a=e.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);return a&&4===a.length?(t=parseInt(a[1],10),r=parseInt(a[2],10),n=parseInt(a[3],10),"#".concat(((1<<24)+(t<<16)+(r<<8)+n).toString(16).slice(1))):e}function c(e,t){var r=document.createElement("span");return"string"===typeof t?r.innerText=t:t.nodeType===Node.TEXT_NODE&&r.appendChild(t),e&&u(r,e),r}function u(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e.style[r]=t[r])}},"../packages/editor/src/interface.ts":function(e,t,r){"use strict";r.d(t,"c",(function(){return i})),r.d(t,"b",(function(){return s})),r.d(t,"a",(function(){return l})),r.d(t,"d",(function(){return n}));var n,a,o,i="alloy-simple-text-editor",s="alloy-rich-text-editor",l="alloy-mention-block";!function(e){e[e.PC=0]="PC",e[e.PAD=1]="PAD",e[e.MOBILE=2]="MOBILE"}(n||(n={})),function(e){e[e.EXIT=0]="EXIT",e[e.DETECTION=1]="DETECTION"}(a||(a={})),function(e){e[e.ORIGIN=0]="ORIGIN",e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.UP=3]="UP",e[e.DOWN=4]="DOWN"}(o||(o={}))},"./src/core/view/View.level1.pc.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.link.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("../node_modules/@babel/runtime/helpers/esm/get.js"),i=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),s=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),l=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),c=(r("../node_modules/core-js/modules/es.object.assign.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/@babel/runtime/helpers/esm/typeof.js")),u=(r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.fill.js"),r("../node_modules/core-js/modules/es.array.splice.js"),r("./src/core/view/config/default.ts")),d=r("./src/core/view/spreadsheet-view/transform-table/cell.ts"),h=r("./src/core/view/spreadsheet-view/model/CellPadding.ts"),f=function(){function e(t,r,a,o){Object(n.a)(this,e),this._background=t,this._horizontalAlign=r,this._verticalAlign=a,this._wrapStrategy=o}return Object(a.a)(e,[{key:"background",get:function(){return this._background}},{key:"horizontalAlign",get:function(){return this._horizontalAlign}},{key:"verticalAlign",get:function(){return this._verticalAlign}},{key:"wrapStrategy",get:function(){return this._wrapStrategy}}],[{key:"getKey",value:function(e,t,r,n){return"".concat(e.hex,",").concat(t.value,",").concat(r.value,",").concat(n.value)}},{key:"newInstance",value:function(t){var r=t.background,n=t.horizontalAlign,a=t.verticalAlign,o=t.wrapStrategy,i=e.getKey(r,n,a,o),s=e.pools[i];return s||(e.pools[i]=new e(r,n,a,o))}},{key:"newInstanceByOther",value:function(t,r){var n={background:r.background||t._background,horizontalAlign:r.horizontalAlign||t._horizontalAlign,verticalAlign:r.verticalAlign||t._verticalAlign,wrapStrategy:r.wrapStrategy||t._wrapStrategy};return e.newInstance(n)}}]),e}();f.pools={};var p=f,_=function(){function e(t,r,a){Object(n.a)(this,e),this.content="",this.style=p.newInstance({background:u.a,horizontalAlign:u.b,verticalAlign:u.d,wrapStrategy:u.e}),this.innerHTML=null,this._padding=u.c,null!==t&&(this.content=Object(d.f)(t),this.style=p.newInstance({background:Object(d.a)(t),horizontalAlign:Object(d.b)(t),verticalAlign:Object(d.g)(t),wrapStrategy:Object(d.h)(t)}),t.getMergeReference()&&(this.mergeData=Object(d.d)(t,r,a),this.mergeParent=Object(d.c)(t,r,a)))}return Object(a.a)(e,[{key:"isEmpty",value:function(){return!this.content.length}},{key:"isAutoWrap",value:function(){return"normal"===this.style.wrapStrategy.value}},{key:"paddingLeft",set:function(e){this._padding=h.b.newInstance(this._padding.top,this._padding.right,this._padding.bottom,e)},get:function(){return this._padding.left}},{key:"paddingRight",set:function(e){this._padding=h.b.newInstance(this._padding.top,e,this._padding.bottom,this._padding.left)},get:function(){return this._padding.right}},{key:"paddingTop",get:function(){return this._padding.top}},{key:"paddingBottom",get:function(){return this._padding.bottom},set:function(e){this._padding=h.b.newInstance(this._padding.top,this._padding.right,e,this._padding.left)}}],[{key:"defaultCellView",value:function(){return new e(null,-1,-1)}}]),e}(),m=_.defaultCellView(),v=_,g=r("./src/core/view/spreadsheet-view/table-view/utils.ts"),b=r("../packages/services/src/dispose.ts");function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var w=function(e){Object(i.a)(r,e);var t=y(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this))._cellViews=[],a.cellDataToCellView=function(e,t,r,n){for(var o=e;o<=t;o++)for(var i=r;i<=n;i++)a.setCellViewAtPosition(o,i)},a.addRow=function(e){for(var t=e.index,r=e.amount,n=a._spreadsheet.activeSheet.getColCount(),o=0;o<r;o++){var i=new Array(n);i.fill(m),a._cellViews.splice(t,0,i)}},a.addCol=function(e){for(var t=e.index,r=e.amount,n=a._spreadsheet.activeSheet.getRowCount(),o=0;o<n;o++){var i,s=new Array(r);s.fill(m),(i=a._cellViews[o]).splice.apply(i,[t,0].concat(s))}},a.deleteRow=function(e){for(var t=e.index,r=e.amount,n=a._spreadsheet.activeSheet.getColCount(),o=0;o<n;o++)for(var i=0;i<r;i++){var s=t+i,l=a._cellViews[s][o];if(l.mergeParent){var c=a._cellViews[s+l.mergeParent.y][o];Object(g.i)(c)}}a._cellViews.splice(t,r)},a.deleteCol=function(e){for(var t=e.index,r=e.amount,n=a._spreadsheet.activeSheet.getRowCount(),o=0;o<n;o++){for(var i=0;i<r;i++){var s=t+i,l=a._cellViews[o][s];if(l.mergeParent){var c=a._cellViews[o][s+l.mergeParent.x];Object(g.h)(c)}}a._cellViews[o].splice(t,r)}},a._spreadsheet=e.spreadsheet,a._dataCallView=e.dataCallView,a._register(a._dataCallView.onInsertRow(a.addRow)),a._register(a._dataCallView.onInsertCol(a.addCol)),a._register(a._dataCallView.onDeleteRow(a.deleteRow)),a._register(a._dataCallView.onDeleteCol(a.deleteCol)),a._register(a._dataCallView.onUpdateCells((function(e){a.cellDataToCellView(e.startRow,e.endRow,e.startCol,e.endCol)}))),a}return Object(a.a)(r,[{key:"refresh",value:function(){this._cellViews=[]}},{key:"setCellViewAtPosition",value:function(e,t){this._cellViews.length<=e&&(this._cellViews[e]=[]);var r,n=this._spreadsheet.activeSheet.getCellDataAtPosition(e,t);n?(r=new v(n,e,t),this._calcPadding(r,e,t)):r=m,this._cellViews[e][t]=r}},{key:"getCellViewAtPosition",value:function(e,t){return e>=this._cellViews.length||e<0||t>=this._cellViews[e].length||t<0?null:this._cellViews[e][t]||null}},{key:"getCellMetadata",value:function(e,t){var r;return(null===(r=this._spreadsheet.activeSheet.getCellDataAtPosition(e,t))||void 0===r?void 0:r.getMetadata())||null}},{key:"getCellImage",value:function(e,t){return this._spreadsheet.activeSheet.getCellImage(e,t)}},{key:"getIsDataValid",value:function(e,t){var r,n;return null===(r=null===(n=this._spreadsheet.activeSheet.getCellDataAtPosition(e,t))||void 0===n?void 0:n.getIsDataValid())||void 0===r||r}},{key:"_calcPadding",value:function(e,t,r){var n=Object(d.e)(this._spreadsheet.activeSheet,t,r),a=n.paddingLeft,o=n.paddingRight;e.paddingLeft=a,e.paddingRight=o}},{key:"cellViews",get:function(){return this._cellViews}}]),r}(b.a),R=(r("../node_modules/core-js/modules/es.number.constructor.js"),r("../node_modules/core-js/modules/es.number.max-safe-integer.js"),r("./src/core/view/spreadsheet-view/area-data/area/RowArea.ts"));function E(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var C=function(e){Object(i.a)(r,e);var t=E(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this))._maxFrozenViewSize=null,a._maxHeight=0,a._scale=e.scale,a._frozen=a._register(new R.a({scale:a._scale})),a._flow=a._register(new R.a({scale:a._scale})),a}return Object(a.a)(r,[{key:"updateMaxHeight",value:function(e){e/=this._scale.scale,this._maxHeight!==e&&(this._maxHeight=e,this._updateViewSize())}},{key:"updateOffsetSize",value:function(e){this._flow.offsetSize=e}},{key:"set",value:function(e,t,r){this._frozen.set(e,0,t-1,t>0?u.k:0),this._flow.set(e,t,r-1),this._updateViewSize(),this._frozen.checkOffset(),this._flow.checkOffset()}},{key:"setMaxFrozenViewSize",value:function(e){this._maxFrozenViewSize=e,this._updateViewSize()}},{key:"refresh",value:function(){this._frozen.refresh(),this._flow.refresh()}},{key:"_updateViewSize",value:function(){var e=this._maxHeight,t=0;this._frozen.totalSize>0&&(t=null===this._maxFrozenViewSize?this._frozen.totalSize:Math.min(this._frozen.totalSize,this._maxFrozenViewSize)),this._frozen.viewSize=t,e-=t,this._flow.viewSize=e}},{key:"frozen",get:function(){return this._frozen}},{key:"flow",get:function(){return this._flow}}]),r}(b.a),j=r("./src/core/view/spreadsheet-view/area-data/area/ColArea.ts");function O(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var S=function(e){Object(i.a)(r,e);var t=O(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this))._maxFrozenViewSize=null,a._maxWidth=0,a._scale=e.scale,a._frozen=a._register(new j.a({scale:a._scale})),a._flow=a._register(new j.a({scale:a._scale})),a}return Object(a.a)(r,[{key:"updateMaxWidth",value:function(e){e/=this._scale.scale,this._maxWidth!==e&&(this._maxWidth=e,this._updateViewSize())}},{key:"updateOffsetSize",value:function(e){this._flow.offsetSize=e}},{key:"set",value:function(e,t,r){this._frozen.set(e,0,t-1,t>0?u.k:0),this._flow.set(e,t,r-1),this._updateViewSize(),this._frozen.checkOffset(),this._flow.checkOffset()}},{key:"setMaxFrozenViewSize",value:function(e){this._maxFrozenViewSize=e,this._updateViewSize()}},{key:"refresh",value:function(){this._frozen.refresh(),this._flow.refresh()}},{key:"_updateViewSize",value:function(){var e=this._maxWidth,t=0;this._frozen.totalSize>0&&(t=null===this._maxFrozenViewSize?this._frozen.totalSize:Math.min(this._frozen.totalSize,this._maxFrozenViewSize)),this._frozen.viewSize=t,e-=t,this._flow.viewSize=e}},{key:"frozen",get:function(){return this._frozen}},{key:"flow",get:function(){return this._flow}}]),r}(b.a),D=r("./src/core/view/utils/base-func.ts"),x=r("../packages/lib/index.ts");function k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var T=function(e){Object(i.a)(r,e);var t=k(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this))._onUpdateOffset=new x.a,a.onUpdateOffset=a._onUpdateOffset.event,a._updateOffsetHandler=Object(D.d)((function(){a._onUpdateOffset.fire()})),a._updateFreeze=function(){a._refreshRow(),a._refreshCol(),a._col.frozen.offsetSize=a._col.frozen.totalSize,a._row.frozen.offsetSize=a._row.frozen.totalSize},a._refreshRow=function(){a._row.set(a._rowcolAccessor,a._rowcolAccessor.getFrozenRowCount(),a._rowcolAccessor.getRowCount())},a._refreshCol=function(){a._col.set(a._rowcolAccessor,a._rowcolAccessor.getFrozenColCount(),a._rowcolAccessor.getColCount())},a._refreshMaxSize=function(){a._row.updateMaxHeight(a._clientRect.height-a._headSize.displayColHeadHeight),a._col.updateMaxWidth(a._clientRect.width-a._headSize.displayRowHeadWidth)},a._clientRect=e.clientRect,a._rowcolAccessor=e.rowcolAccessor,a._headSize=e.headSize,a._dataCallView=e.dataCallView,a._resize=e.resize,a._scale=e.scale,a._row=a._register(new C({scale:a._scale})),a._col=a._register(new S({scale:a._scale})),a._refreshRow(),a._refreshCol(),"undefined"!==typeof window&&a._refreshMaxSize(),"undefined"!==typeof window&&(a._register(a._resize.onResize(a._refreshMaxSize)),a._register(a._scale.onScale((function(e){a._refreshRow(),a._refreshCol(),a._refreshMaxSize(),a._col.updateOffsetSize(a._col.flow.offsetSize),a._row.updateOffsetSize(a._row.flow.offsetSize)})))),a._register(a._row.frozen.onUpdateOffset(a._updateOffsetHandler)),a._register(a._row.flow.onUpdateOffset(a._updateOffsetHandler)),a._register(a._col.frozen.onUpdateOffset(a._updateOffsetHandler)),a._register(a._col.flow.onUpdateOffset(a._updateOffsetHandler)),a._register(a._dataCallView.onInsertRow(Object(D.d)(a._refreshRow))),a._register(a._dataCallView.onDeleteRow(Object(D.d)(a._refreshRow))),a._register(a._dataCallView.onSetRowHeight(Object(D.d)(a._refreshRow))),a._register(a._dataCallView.onSetRowVisible(Object(D.d)(a._refreshRow))),a._register(a._dataCallView.onInsertCol(Object(D.d)(a._refreshCol))),a._register(a._dataCallView.onDeleteCol(Object(D.d)(a._refreshCol))),a._register(a._dataCallView.onSetColWidth(Object(D.d)(a._refreshCol))),a._register(a._dataCallView.onSetColVisible(Object(D.d)(a._refreshCol))),a._register(a._dataCallView.onUpdateFreeze(a._updateFreeze)),a}return Object(a.a)(r,[{key:"refresh",value:function(){this._row.refresh(),this._col.refresh(),this._refreshRow(),this._refreshCol()}},{key:"getAreaTopByRow",value:function(e){return e<=this._row.frozen.to?this._row.frozen.getAreaTop(e):this._row.flow.getAreaTop(e-this._row.frozen.rowCount)}},{key:"getAreaLeftByCol",value:function(e){return e<=this._col.frozen.to?this._col.frozen.getAreaLeft(e):this._col.flow.getAreaLeft(e-this._col.frozen.colCount)}},{key:"getDisplayGlobalTopByRow",value:function(e){return this.getGlobalTopByRow(e)*this._scale.scale}},{key:"getGlobalTopByRow",value:function(e){return e<=this._row.frozen.to?this._row.frozen.getAreaTop(e):(this._col.frozen.to,0)+this._row.flow.getAreaTop(e-this._row.frozen.rowCount)+this._row.frozen.totalSize}},{key:"getDisplayGlobalBottomByRow",value:function(e){return this.getGlobalBottomByRow(e)*this._scale.scale}},{key:"getGlobalBottomByRow",value:function(e){var t=this.getGlobalTopByRow(e+1);return e===this._row.frozen.to&&(t-=u.k),t}},{key:"getDisplayGlobalLeftByCol",value:function(e){return this.getGlobalLeftByCol(e)*this._scale.scale}},{key:"getGlobalLeftByCol",value:function(e){return e<=this._col.frozen.to?this._col.frozen.getAreaLeft(e):(this._col.frozen.to,0)+this._col.flow.getAreaLeft(e-this._col.frozen.colCount)+this._col.frozen.totalSize}},{key:"getDisplayGlobalRightByCol",value:function(e){return this.getGlobalRightByCol(e)*this._scale.scale}},{key:"getGlobalRightByCol",value:function(e){var t=this.getGlobalLeftByCol(e+1);return e===this._col.frozen.to&&(t-=u.k),t}},{key:"getDisplayViewTopByRow",value:function(e){return this.getViewTopByRow(e)*this._scale.scale}},{key:"getViewTopByRow",value:function(e){var t=this.getAreaTopByRow(e);return e<=this._row.frozen.to?t-this._row.frozen.offsetSize:t-this._row.flow.offsetSize+this._row.frozen.viewSize}},{key:"getDisplayViewBottomByRow",value:function(e){return this.getViewBottomByRow(e)*this._scale.scale}},{key:"getViewBottomByRow",value:function(e){return e===this._row.frozen.to?this._row.frozen.viewSize:this.getViewTopByRow(e+1)}},{key:"getDisplayViewLeftByCol",value:function(e){return this.getViewLeftByCol(e)*this._scale.scale}},{key:"getViewLeftByCol",value:function(e){var t=this.getAreaLeftByCol(e);return e<=this._col.frozen.to?t-this._col.frozen.offsetSize:t-this._col.flow.offsetSize+this._col.frozen.viewSize}},{key:"getDisplayViewRightByCol",value:function(e){return this.getViewRightByCol(e)*this._scale.scale}},{key:"getViewRightByCol",value:function(e){return e===this._col.frozen.to?this._col.frozen.viewSize:this.getViewLeftByCol(e+1)}},{key:"getRowByDisplayViewTop",value:function(e){return e/=this._scale.scale,this.getRowByViewTop(e)}},{key:"getRowByViewTop",value:function(e){var t;if(e>=0&&e<this._row.frozen.viewSize){for(e+=this._row.frozen.offsetSize,t=this._row.frozen.renderFrom+1;t<=this._row.frozen.to;){if(e<this._row.frozen.getAreaTop(t))return t-1;t+=1}return t-1}if((e=e-this._row.frozen.viewSize+this._row.flow.offsetSize)<this._row.flow.originContentSize){for(t=this._row.flow.renderFrom+1;t<=this._row.flow.to;){if(e<this._row.flow.getAreaTop(t-this._row.frozen.rowCount))return t-1;t+=1}return t-1}return Number.MAX_SAFE_INTEGER}},{key:"getColByDisplayViewLeft",value:function(e){return e/=this._scale.scale,this.getColByViewLeft(e)}},{key:"getColByViewLeft",value:function(e){var t;if(e>=0&&e<this._col.frozen.viewSize){for(e+=this._col.frozen.offsetSize,t=this._col.frozen.renderFrom+1;t<=this._col.frozen.to;){if(e<this._col.frozen.getAreaLeft(t))return t-1;t+=1}return t-1}if((e=e-this._col.frozen.viewSize+this._col.flow.offsetSize)<this._col.flow.originContentSize){for(t=this._col.flow.renderFrom+1;t<=this._col.flow.to;){if(e<this._col.flow.getAreaLeft(t-this._col.frozen.colCount))return t-1;t+=1}return t-1}return Number.MAX_SAFE_INTEGER}},{key:"getFirstRowInView",value:function(){return this._row.frozen.viewSize>0?this._row.frozen.renderFrom:this._row.flow.renderFrom}},{key:"getLastRowInView",value:function(){return this._row.flow.viewSize>0?this._row.flow.renderTo:this._row.frozen.renderTo}},{key:"getFirstColInView",value:function(){return this._col.frozen.viewSize>0?this._col.frozen.renderFrom:this._col.flow.renderFrom}},{key:"getLastColInView",value:function(){return this._col.flow.viewSize>0?this._col.flow.renderTo:this._col.frozen.renderTo}},{key:"inFrozenRowArea",value:function(e){return this._row.frozen.from<=e&&e<=this._row.frozen.to}},{key:"inFlowRowArea",value:function(e){return this._row.flow.from<=e&&e<=this._row.flow.to}},{key:"inFrozenColArea",value:function(e){return this._col.frozen.from<=e&&e<=this._col.frozen.to}},{key:"inFlowColArea",value:function(e){return this._col.flow.from<=e&&e<=this._col.flow.to}},{key:"row",get:function(){return this._row}},{key:"col",get:function(){return this._col}}]),r}(b.a);function A(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var I=function(e){Object(i.a)(r,e);var t=A(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this))._refresh=function(){var e=a._container.getBoundingClientRect(),t=e.left,r=e.top,n=e.width,o=e.height;a._distanceX=t,a._distanceY=r,a._width=n,a._height=o},a._container=e.container,a._resize=e.resize,a._container.style.webkitTransformOrigin="left top",a._container.style.transformOrigin="left top",a._container.style.webkitTransform="scale(1)",a._container.style.transform="scale(1)",a._container.style.width="100%",a._container.style.height="100%",a._container.style.borderTop="1px solid #e2e4e8",a._refresh(),a._register(a._resize.onResize(a._refresh)),a}return Object(a.a)(r,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"distanceX",get:function(){return this._distanceX}},{key:"distanceY",get:function(){return this._distanceY}}]),r}(b.a),N=function(){function e(t){Object(n.a)(this,e),this._rowHeadWidth=u.q,this._colHeadHeight=u.f,this._scale=t.scale}return Object(a.a)(e,[{key:"displayRowHeadWidth",get:function(){return this._rowHeadWidth*this._scale.scale>>0}},{key:"displayColHeadHeight",get:function(){return this._colHeadHeight*this._scale.scale>>0}},{key:"rowHeadWidth",get:function(){return this._rowHeadWidth}},{key:"colHeadHeight",get:function(){return this._colHeadHeight}}]),e}(),L=r("./src/core/view/spreadsheet-view/resize/Resize.ts"),P=(r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/regenerator-runtime/runtime.js"),r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js")),M=function(){function e(t){Object(n.a)(this,e),this._a=1,this._b=0,this._c=0,this._d=1,this._e=0,this._f=0,t&&(this._a=t.a,this._b=t.b,this._c=t.c,this._d=t.d,this._e=t.e,this._f=t.f)}return Object(a.a)(e,[{key:"transform",value:function(e,t,r,n,a,o){var i=this._a,s=this._b,l=this._c,c=this._d,u=this._e,d=this._f;return this._a=i*e+l*t,this._b=s*e+c*t,this._c=i*r+l*n,this._d=s*r+c*n,this._e=i*a+l*o+u,this._f=s*a+c*o+d,this}},{key:"scale",value:function(e,t){return this.transform(e,0,0,t,0,0),this}},{key:"translate",value:function(e,t){return this.transform(1,0,0,1,e,t),this}},{key:"rotate",value:function(e){var t=Math.cos(e),r=Math.sin(e);return this.transform(t,r,-r,t,0,0),this}},{key:"applyToPoint",value:function(e,t){return{x:e*this._a+t*this._c+this._e,y:e*this._b+t*this._d+this._f}}},{key:"reset",value:function(){return this._a=this._d=1,this._b=this._c=this._e=this._f=0,this}},{key:"a",get:function(){return this._a}},{key:"b",get:function(){return this._b}},{key:"c",get:function(){return this._c}},{key:"d",get:function(){return this._d}},{key:"e",get:function(){return this._e}},{key:"f",get:function(){return this._f}}]),e}();function V(e,t,r,n,a){if(e!==t){var o=t-e>0?r:-r,i=1.5*r,s=e;!function e(){if(o>0&&Math.abs(s)>Math.abs(t)-i||o<0&&Math.abs(s)<Math.abs(t)-i)return n(t-s),void(null===a||void 0===a||a());s+=o,n(o),requestAnimationFrame(e)}()}}var z=function(){function e(){Object(n.a)(this,e),this._onScale=new x.a,this.onScale=this._onScale.event,this._matrix=new M,this._default=1,this._scale=1}return Object(a.a)(e,[{key:"scaleTo",value:function(){var e=Object(P.a)(regeneratorRuntime.mark((function e(t){var r,n,a,o,i,s,l,c,u,d,h=this,f=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=f.length>1&&void 0!==f[1]?f[1]:{},n=r.immediately,a=void 0===n||n,o=r.step,i=void 0===o?.08:o,s=r.frameCb,l=void 0===s?function(){}:s,c=r.endCb,u=void 0===c?function(){}:c,d=function(e){e(),u()},e.abrupt("return",new Promise((function(e){if(h._scale===t)return e();if(a)return l(),h._handleScale(t),void d(e);V(h._scale,t,i,(function(e){l(),h._handleScale(h._scale+e)}),d.bind(h,e))})).catch((function(){})));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_handleScale",value:function(e){this._matrix.scale(e/this._scale,e/this._scale),this._scale=e,this._onScale.fire(this._scale)}},{key:"default",get:function(){return this._default},set:function(e){this._default=e}},{key:"scale",get:function(){return this._scale}},{key:"matrix",get:function(){return this._matrix}}]),e}(),B=r("./src/core/view/spreadsheet-view/row-col-accessor/RowcolAccessor.ts"),F=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),H=r("./src/core/view/spreadsheet-view/accessor/BaseRowAccessor.ts");function U(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var W=function(e){Object(i.a)(r,e);var t=U(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this))._handleColChange=function(){for(var e=a._rowcolAccessor.getRowCount(),t=0;t<e;t++)a._calcFunc(t)},a._handleCellsChange=function(e){for(var t=e.startRow,r=e.endRow,n=t;n<=r;n++)a._calcFunc(n)},a._dataCallView=e.dataCallView,a._rowcolAccessor=e.rowcolAccessor,a._calcFunc=e.calc,a._register(a._dataCallView.onInsertCol(a._handleColChange)),a._register(a._dataCallView.onDeleteCol(a._handleColChange)),a._register(a._dataCallView.onSetColVisible(a._handleColChange)),a._register(a._dataCallView.onSetColWidth(a._handleColChange)),a._register(a._dataCallView.onUpdateCells(a._handleCellsChange)),a}return r}(b.a),G=r("./src/core/view/spreadsheet-view/transform-table/utils.ts"),Y=r("../packages/model/src/cell/format/index.ts");function X(e){return null===e||!Object(d.f)(e).length}function K(e){return null!==e&&!!e.getMergeReference()}var q=r("./src/core/view/spreadsheet-view/model/HorizontalAlign.ts");function Q(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var Z="cover_parent",J=function(e){Object(i.a)(r,e);var t=Q(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e))._calcRowCoverInfo=function(e){a._resetRow(e);for(var t=a._rowcolAccessor.getColCount()-1,r=0;r<t;r++){var n=a._spreadsheet.activeSheet.getCellDataAtPosition(e,r);n&&a._calcCellViewCover(n,e,r)}},a._paragraphAccessor=e.paragraphAccessor,a._spreadsheet=e.spreadsheet,a._rowcolAccessor=e.rowcolAccessor,a._recalculateListener=a._register(new W({dataCallView:a._dataCallView,rowcolAccessor:a._rowcolAccessor,calc:a._calcRowCoverInfo})),a._init(),a}return Object(a.a)(r,[{key:"refresh",value:function(){this._init()}},{key:"getCoverOffset",value:function(e,t){if(!this._rowData.cover_data[e])return null;var r=this._rowData.cover_data[e][t];return r?this._fromValue(r):null}},{key:"getHiddenOffset",value:function(e,t){if(!this._rowData[Z][e])return null;var r=this._rowData[Z][e][t];return r?this._fromValue(r):null}},{key:"isCoverCell",value:function(e,t){return!!this._rowData.cover_data[e]&&!!this._rowData.cover_data[e][t]}},{key:"isHiddenCell",value:function(e,t){return!!this._rowData[Z][e]&&!!this._rowData[Z][e][t]}},{key:"getHiddenCellParents",value:function(e,t){if(!this.isHiddenCell(e,t))return null;var r=this._rowData[Z][e][t],n=this._fromValue(r),a=[];return n.leftOffset&&a.push({rowIndex:e,colIndex:t-n.leftOffset}),n.rightOffset&&a.push({rowIndex:e,colIndex:t+n.rightOffset}),a.length?a:null}},{key:"_init",value:function(){var e;this._rowData=(e={},Object(F.a)(e,"cover_data",[]),Object(F.a)(e,Z,[]),e);for(var t=this._spreadsheet.activeSheet.getRowCount()-1,r=0;r<=t;r++)this._calcRowCoverInfo(r)}},{key:"_resetRow",value:function(e){this._rowData.cover_data[e]&&(this._rowData.cover_data[e]={}),this._rowData[Z][e]&&(this._rowData[Z][e]={})}},{key:"_toVale",value:function(e){return(e.leftOffset<<16)+e.rightOffset}},{key:"_fromValue",value:function(e){return{leftOffset:e>>16,rightOffset:65535&e}}},{key:"_setCoverInfo",value:function(e){var t,r=e.coverPos,n=e.offset;if(this._rowData.cover_data[r.rowIndex]||(this._rowData.cover_data[r.rowIndex]={}),this._rowData.cover_data[r.rowIndex][r.colIndex]=this._toVale(n),n.leftOffset)for(t=r.colIndex-n.leftOffset;t<r.colIndex;t++)if(this._rowData[Z][r.rowIndex]){var a=this._rowData[Z][r.rowIndex][t];this._rowData[Z][r.rowIndex][t]=this._toVale({leftOffset:(a||0)>>16,rightOffset:r.colIndex-t})}else this._rowData[Z][r.rowIndex]={},this._rowData[Z][r.rowIndex][t]=this._toVale({leftOffset:0,rightOffset:r.colIndex-t});if(n.rightOffset)for(t=r.colIndex+1;t<=r.colIndex+n.rightOffset;t++)if(this._rowData[Z][r.rowIndex]){var o=this._rowData[Z][r.rowIndex][t];this._rowData[Z][r.rowIndex][t]=this._toVale({leftOffset:t-r.colIndex,rightOffset:o||0})}else this._rowData[Z][r.rowIndex]={},this._rowData[Z][r.rowIndex][t]=this._toVale({leftOffset:t-r.colIndex,rightOffset:0})}},{key:"_calcCellViewCover",value:function(e,t,r){var n=this._paragraphAccessor.getParagraph(t,r);if(n&&!(e.getMergeReference()||function(e){var t=[e.getConditionalFormatResult(),e.getEffectiveFormat(),e.getUserEnteredFormat()];return Object(G.a)(t,"getWrapStrategy")===Y.WRAP_STRATEGY.WRAP}(e)||this._rowcolAccessor.isColHidden(r))){var a,o=Object(d.e)(this._spreadsheet.activeSheet,t,r),i=Object(d.b)(e).value;a=i===q.a.LEFT?o.paddingLeft:i===q.a.RIGHT?o.paddingRight:0;var s=n.width+a,l=function(e,t,r){var n=t.getMergeReference();if(!n)return e.getColSetWidth(r);for(var a=0,o=n.startColIndex;o<n.endColIndex;o++)e.isColHidden(o)||(a+=e.getColSetWidth(o));return a}(this._rowcolAccessor,e,r);if(!(s<l)){var c=this._calcOffset(i,s,l,t,r),u={coverPos:{rowIndex:t,colIndex:r},offset:{leftOffset:c.leftOffset,rightOffset:c.rightOffset}};this._setCoverInfo(u)}}}},{key:"_calcOffset",value:function(e,t,r,n,a){var o=0,i=0,s=(t-r)/2;switch(e){case q.a.LEFT:i=this._extendCoverToRight(t-r,a,n);break;case q.a.RIGHT:o=this._extendCoverToLeft(t-r,a,n);break;case q.a.CENTER:o=this._extendCoverToLeft(s,a,n),i=this._extendCoverToRight(s,a,n)}return{leftOffset:o,rightOffset:i}}},{key:"_extendCoverToRight",value:function(e,t,r){for(var n=e,a=this._rowcolAccessor.getColCount(),o=this._spreadsheet.activeSheet,i=1,s=t+i,l=o.getCellDataAtPosition(r,s);s<a&&n>0&&(X(l)||this._rowcolAccessor.isColHidden(s))&&!K(l);)n-=this._rowcolAccessor.isColHidden(s)?0:this._rowcolAccessor.getColSetWidth(s),s=t+(i+=1),l=o.getCellDataAtPosition(r,s);return i-=1}},{key:"_extendCoverToLeft",value:function(e,t,r){for(var n=e,a=this._spreadsheet.activeSheet,o=1,i=t-o,s=a.getCellDataAtPosition(r,i);i>=0&&n>0&&(X(s)||this._rowcolAccessor.isColHidden(i))&&!K(s);)n-=this._rowcolAccessor.isColHidden(i)?0:this._rowcolAccessor.getColSetWidth(i),i=t-(o+=1),s=a.getCellDataAtPosition(r,i);return o-=1}}]),r}(H.a),$=r("./src/core/view/spreadsheet-view/paragraph-accessor/ParagraphAccessor.ts"),ee=r("./src/core/view/spreadsheet-view/transform-table/border.ts"),te=r("./src/core/view/spreadsheet-view/model/Color.ts"),re=r("./src/core/view/level-2/dimension-edit/hide-show-head/utils.ts");function ne(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var ae=function(e){Object(i.a)(r,e);var t=ne(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this))._calcRows=function(e){var t=e.index,r=e.amount;a._calc(Math.max(0,t-1),t+r,0,a._spreadsheet.activeSheet.getColCount()-1)},a._calcCols=function(e){var t=e.index,r=e.amount;a._calc(0,a._spreadsheet.activeSheet.getRowCount()-1,Math.max(0,t-1),t+r)},a._calcRowsByRange=function(e){for(var t=e.ranges,r=0;r<t.length;r++){var n=t[r];a._calc(Math.max(0,n.startIndex-1),n.endIndex+1,0,a._spreadsheet.activeSheet.getColCount()-1)}},a._calcColsByRange=function(e){a._calc(0,a._spreadsheet.activeSheet.getRowCount()-1,0,a._spreadsheet.activeSheet.getColCount()-1)},a._calcCells=function(e){var t=e.startRow,r=e.endRow;a._calc(t-1,r+1,0,a._spreadsheet.activeSheet.getColCount()-1)},a._dataCallView=e.dataCallView,a._spreadsheet=e.spreadsheet,a._calc=e.calc,a._checkGridlines=e.checkGridlines,a._register(a._dataCallView.onUpdateHideGridLines(a._checkGridlines)),a._register(a._dataCallView.onInsertRow(a._calcRows)),a._register(a._dataCallView.onInsertCol(a._calcCols)),a._register(a._dataCallView.onDeleteRow(a._calcRows)),a._register(a._dataCallView.onDeleteCol(a._calcCols)),a._register(a._dataCallView.onSetRowVisible(a._calcRowsByRange)),a._register(a._dataCallView.onSetColVisible(a._calcColsByRange)),a._register(a._dataCallView.onSetColWidth(a._calcColsByRange)),a._register(a._dataCallView.onUpdateCells(a._calcCells)),a}return r}(b.a),oe=r("./src/core/view/spreadsheet-view/accessor/BaseCellAccessor.ts");function ie(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var se={width:u.p,style:u.o,color:te.a.newInstanceByHex("#e2e4e8")};var le=function(e){Object(i.a)(r,e);var t=ie(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e))._calcRange=function(e,t,r,n){for(var o=Math.max(0,e),i=Math.min(t,a._rowcolAccessor.getRowCount()-1),s=Math.max(0,r),l=Math.min(n,a._rowcolAccessor.getColCount()-1),c=o;c<=i;c++)if(!a._rowcolAccessor.isRowHidden(c))for(var u=s;u<=l;u++){var d=a._calc(c,u);d&&(a._rowData.border_show_data[c]||(a._rowData.border_show_data[c]=[]),a._rowData.border_show_data[c][u]=d)}},a._checkGridlines=function(){a._spreadsheet.activeSheet.getHideGridlines()?se.style=0:se.style=3},a._rowCoverAccessor=e.rowCoverAccessor,a._rowcolAccessor=e.rowcolAccessor,a._spreadsheet=e.spreadsheet,a._recalculateListener=a._register(new ae({dataCallView:a._dataCallView,spreadsheet:a._spreadsheet,calc:a._calcRange,checkGridlines:a._checkGridlines})),a._init(),a}return Object(a.a)(r,[{key:"getBorder",value:function(e,t){if(this._rowData.border_show_data[e])return this._rowData.border_show_data[e][t]}},{key:"refresh",value:function(){this._init()}},{key:"_init",value:function(){this._rowData=Object(F.a)({},"border_show_data",[]),this._checkGridlines();var e=this._spreadsheet.activeSheet.getRowCount()-1,t=this._spreadsheet.activeSheet.getColCount()-1;this._calcRange(0,e,0,t)}},{key:"_calc",value:function(e,t){var r=this._spreadsheet.activeSheet,n=r.getCellDataAtPosition(e,t),a=function(e,t,r,n){var a,o,i,s=null===t||void 0===t?void 0:t.getMergeReference();if(s&&r<s.endRowIndex&&Object(re.b)(e,r,1)<=s.endRowIndex)i=null;else{var l,c;if(a=Object(ee.c)(t),o=Object(ee.f)(Object(G.b)(e,n,r)),Object(ee.b)(a,o)>=0)i=(null===(c=a)||void 0===c?void 0:c.style)?a:se;else i=(null===(l=o)||void 0===l?void 0:l.style)?o:se}return i}(r,n,e,t);return{right:this._isRightBorderHiddenByCoverCell(e,t)||this._isRightBorderHiddenInHiddenCell(e,t)?null:function(e,t,r,n){var a,o,i,s=null===t||void 0===t?void 0:t.getMergeReference();if(s&&n<s.endColIndex&&Object(re.a)(e,n,1)<=s.endColIndex)i=null;else{var l,c;if(a=Object(ee.e)(t),o=Object(ee.d)(Object(G.c)(e,n,r)),Object(ee.b)(a,o)>=0)i=(null===(c=a)||void 0===c?void 0:c.style)?a:se;else i=(null===(l=o)||void 0===l?void 0:l.style)?o:se}return i}(r,n,e,t),bottom:a}}},{key:"_isRightBorderHiddenByCoverCell",value:function(e,t){var r=this._rowCoverAccessor.getCoverOffset(e,t);if(!r)return!1;if(r.rightOffset)for(var n=r.rightOffset,a=t;n;){if(a+=1,!this._rowcolAccessor.isColHidden(a))return!0;n-=1}return!1}},{key:"_isRightBorderHiddenInHiddenCell",value:function(e,t){var r=this._rowCoverAccessor.getHiddenOffset(e,t);if(!r)return!1;if(r.rightOffset)return!0;if(r.leftOffset){var n=this._rowCoverAccessor.getCoverOffset(e,t-r.leftOffset);if(!n)return console.error("\u9690\u85cf\u8986\u76d6\u683c\u5f02\u5e38"),!1;if(r.leftOffset<n.rightOffset)return!0}return!1}}]),r}(oe.a),ce=r("../packages/model/src/spreadsheet/index.ts"),ue=r("./src/core/view/data-call-view/DataCallView.interface.ts"),de=r("./src/core/view/lib/mutex-management/MutexManagment.ts"),he=r("./src/core/view/spreadsheet-view/transform-table/head.ts"),fe=(r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("./src/core/view/spreadsheet-view/render-manager/alloy-excel/interface.ts")),pe=(r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.map.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/core-js/modules/esnext.map.delete-all.js"),r("../node_modules/core-js/modules/esnext.map.every.js"),r("../node_modules/core-js/modules/esnext.map.filter.js"),r("../node_modules/core-js/modules/esnext.map.find.js"),r("../node_modules/core-js/modules/esnext.map.find-key.js"),r("../node_modules/core-js/modules/esnext.map.includes.js"),r("../node_modules/core-js/modules/esnext.map.key-of.js"),r("../node_modules/core-js/modules/esnext.map.map-keys.js"),r("../node_modules/core-js/modules/esnext.map.map-values.js"),r("../node_modules/core-js/modules/esnext.map.merge.js"),r("../node_modules/core-js/modules/esnext.map.reduce.js"),r("../node_modules/core-js/modules/esnext.map.some.js"),r("../node_modules/core-js/modules/esnext.map.update.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),new Map),_e=[],me=new Map,ve=new Map;function ge(e){var t="",r=ye(t=function(e,t){var r=e;if(t){var n="height:".concat(t,"px;\nline-height:").concat(t,"px\n"),a=pe.get(n);if(!a&&0!==a){var o=pe.size;pe.set(n,o),_e[o]=n,a=o}r+=a}return"".concat(r,",")}(t=function(e,t){var r=e;if(t){var n="overflow: visible;\n",a=pe.get(n);if(!a&&0!==a){var o=pe.size;pe.set(n,o),_e[o]=n,a=o}r+=a}return"".concat(r,",")}(t=function(e,t){var r=e;if(t){var n="display:none;\n",a=pe.get(n);if(!a&&0!==a){var o=pe.size;pe.set(n,o),_e[o]=n,a=o}r+=a}return"".concat(r,",")}(t=function(e,t){var r=e;if(t){var n="border-left:".concat(t,";\n"),a=pe.get(n);if(!a&&0!==a){var o=pe.size;pe.set(n,o),_e[o]=n,a=o}r+=a}return"".concat(r,",")}(t=function(e,t){var r=e;if(t){var n="border-bottom:".concat(t,";\n"),a=pe.get(n);if(!a&&0!==a){var o=pe.size;pe.set(n,o),_e[o]=n,a=o}r+=a}else{var i=pe.get("border-bottom-width:0px;");if(!i&&0!==i){var s=pe.size;pe.set("border-bottom-width:0px;",s),_e[s]="border-bottom-width:0px;",i=s}r+=i}return"".concat(r,",")}(t=function(e,t){var r=e;if(t){var n="border-right:".concat(t,";\n"),a=pe.get(n);if(!a&&0!==a){var o=pe.size;pe.set(n,o),_e[o]=n,a=o}r+=a}else{var i="border-right-width:0px;\n",s=pe.get(i);if(!s&&0!==s){var l=pe.size;pe.set(i,l),_e[l]=i,s=l}r+=s}return"".concat(r,",")}(t=function(e,t){var r=e;if(t){var n="border-top:".concat(t,";\n"),a=pe.get(n);if(!a&&0!==a){var o=pe.size;pe.set(n,o),_e[o]=n,a=o}r+=a}return"".concat(r,",")}(t=function(e,t){var r=e;if(t){var n="vertical-align:".concat(t,";\n"),a=pe.get(n);if(!a&&0!==a){var o=pe.size;pe.set(n,o),_e[o]=n,a=o}r+=a}return"".concat(r,",")}(t=function(e,t){var r=e;if(t){var n="text-align:".concat(t,";\n"),a=pe.get(n);if(!a&&0!==a){var o=pe.size;pe.set(n,o),_e[o]=n,a=o}r+=a}return"".concat(r,",")}(t=we(t=function(e,t){var r=e;if(t){var n="background-color:".concat(t,";\n"),a=pe.get(n);if(!a&&0!==a){var o=pe.size;pe.set(n,o),_e[o]=n,a=o}r+=a}return"".concat(r,",")}(t,e.background),e.color),e.horizontalAlign),e.verticalAlign),e.borderTop),e.borderRight),e.borderBottom),e.borderLeft),e.hidden),e.cover),e.height));return"s".concat(r)}function be(e){var t="",r=ye(t=function(e,t){var r=e;if(t){var n="text-decoration:".concat(t,";\n"),a=pe.get(n);if(!a&&0!==a){var o=pe.size;pe.set(n,o),_e[o]=n,a=o}r+=a}return"".concat(r)}(t=function(e,t){var r=e;if(t){var n="font-size:".concat(t,";\n"),a=pe.get(n);if(!a&&0!==a){var o=pe.size;pe.set(n,o),_e[o]=n,a=o}r+=a}return"".concat(r,",")}(t=function(e,t){var r=e;if(t){var n="font-family:".concat(t,";\n"),a=pe.get(n);if(!a&&0!==a){var o=pe.size;pe.set(n,o),_e[o]=n,a=o}r+=a}return"".concat(r,",")}(t=function(e,t){var r=e;if(t){var n="font-style:".concat(t,";\n"),a=pe.get(n);if(!a&&0!==a){var o=pe.size;pe.set(n,o),_e[o]=n,a=o}r+=a}return"".concat(r,",")}(t=function(e,t){var r=e;if(t){var n="font-weight:".concat(t,";\n"),a=pe.get(n);if(!a&&0!==a){var o=pe.size;pe.set(n,o),_e[o]=n,a=o}r+=a}return"".concat(r,",")}(t=we(t,e.color),e.fontWeight),e.fontStyle),e.fontFamily),e.fontSize),e.textDecoration));return"s".concat(r)}function ye(e){var t=ve.get(e),r="";if(!t&&0!==t){e.split(",").forEach((function(e){e&&(r+="".concat(_e[+e]))}));var n=ve.size;ve.set(e,n),me.set(n,r),t=n}return t}function we(e,t){var r=e;if(t){var n="color:".concat(t,";\n"),a=pe.get(n);if(!a&&0!==a){var o=pe.size;pe.set(n,o),_e[o]=n,a=o}r+=a}return"".concat(r,",")}var Re,Ee=function(){function e(t){Object(n.a)(this,e),this.borderTop=null,this.borderRight=null,this.borderBottom=null,this.borderLeft=null,this.isCover=!1,this.coverParents=null,this.metadata=null,this.image=null,this.isDataValid=!0,this._cell=null,this._cell=t}return Object(a.a)(e,[{key:"getInnerHTML",value:function(e,t,r){if(null===this._cell.innerHTML){var n=function(e,t){var r="";return t&&t.forEach((function(e){var t="",n=e.segments,a=[];n&&(n.forEach((function(e){var t=e.text,r={};e.textProp[fe.a.BOLD]&&(r.fontWeight="bold"),e.textProp[fe.a.ITALIC]&&(r.fontStyle="italic"),e.textProp[fe.a.FONT_FAMILY]&&(r.fontFamily=e.textProp[fe.a.FONT_FAMILY]),e.textProp[fe.a.COLOR]&&(r.color=e.textProp[fe.a.COLOR]),e.textProp[fe.a.FONT_SIZE]&&(r.fontSize="".concat(1.333*(e.textProp[fe.a.FONT_SIZE]||12),"px")),e.textProp[fe.a.UNDERLINE]&&(r.textDecoration="underline"),e.textProp[fe.a.STRIKETHROUGH]&&(r.textDecoration="underline");var n=be(r);a.push('<span class="'.concat(n,'">').concat(t,"</span>"))})),t=a.join("")),t&&(r="".concat(r,"<div>").concat(t,"</div>"))})),r||null}(this._cell,this.lines);this._cell.innerHTML=n}return this._cell.innerHTML}},{key:"_reset",value:function(){this._cell=null,this.borderTop=null,this.borderRight=null,this.borderBottom=null,this.borderLeft=null,this.isCover=!1,this.coverParents=null,this.metadata=null,this.image=null,this.isDataValid=!0}},{key:"cell",get:function(){return this._cell}},{key:"wrapStrategy",get:function(){return this._cell.style.wrapStrategy}},{key:"mergeData",get:function(){if(this._cell.mergeData)return this._cell.mergeData}},{key:"mergeParent",get:function(){if(this._cell.mergeParent)return this._cell.mergeParent}},{key:"background",get:function(){return this._cell.style.background}},{key:"horizontalAlign",get:function(){return this._cell.style.horizontalAlign}},{key:"verticalAlign",get:function(){return this._cell.style.verticalAlign}}],[{key:"newInstance",value:function(t){var r=e._instance;return void 0===r?r=new e(t):(r._reset(),r._cell=t),e._instance=r,r}}]),e}();!function(e){e[e.SELECT_ACTIVE=100]="SELECT_ACTIVE",e[e.SELECT_SELECTED=200]="SELECT_SELECTED"}(Re||(Re={}));var Ce=function(){function e(){Object(n.a)(this,e),this.index=0,this.status=0,this.size=-1,this.fitLineExpand=0}return Object(a.a)(e,[{key:"setSize",value:function(e){this.size=e}},{key:"expandFitLine",value:function(e){this.fitLineExpand=e}},{key:"selected",value:function(){this.status=Re.SELECT_SELECTED}},{key:"actived",value:function(){this.status!==Re.SELECT_SELECTED&&(this.status=Re.SELECT_ACTIVE)}},{key:"resize",value:function(e){this.index=e,this.status=0,this.size=-1,this.fitLineExpand=0}}]),e}(),je=r("./src/core/view/spreadsheet-view/transform-table/segment.ts"),Oe=r("./src/core/view/spreadsheet-view/utils.ts"),Se=r("./src/core/view/spreadsheet-view/render-manager/alloy-excel/utils.ts"),De=r("../packages/model/src/range/hexRangeUtils.ts"),xe=function(){function e(t){Object(n.a)(this,e),this._onCalcRowHeadStatus=new x.a,this.onCalcRowHeadStatus=this._onCalcRowHeadStatus.event,this._onCalcColHeadStatus=new x.a,this.onCalcColHeadStatus=this._onCalcColHeadStatus.event,this._dimensionMeta=new Ce,this._tableView=t.tableView,this._rowcolAccessor=t.rowcolAccessor,this._rowCoverAccessor=t.rowCoverAccessor,this._paragraphAccessor=t.paragraphAccessor,this._borderAccessor=t.borderAccessor}return Object(a.a)(e,[{key:"getCellDataAtPosition",value:function(e,t){var r=this._tableView.getCellViewAtPosition(e,t);null===r&&(r=m);var n=Ee.newInstance(r),a=this._paragraphAccessor.getParagraph(e,t);n.lines=Object(je.a)(r,a,this._rowcolAccessor,e,t);var o=this._borderAccessor.getBorder(e,t);return o&&(o.right&&(n.borderRight=o.right),o.bottom&&(n.borderBottom=o.bottom)),n.isCover=this._rowCoverAccessor.isCoverCell(e,t),n.coverParents=this._rowCoverAccessor.getHiddenCellParents(e,t),n.metadata=this._tableView.getCellMetadata(e,t),n.image=this._tableView.getCellImage(e,t),n.isDataValid=this._tableView.getIsDataValid(e,t),n}},{key:"getRowContent",value:function(e){return String(e+1)}},{key:"getColContent",value:function(e){return Object(De.colIndex2ColChar)(e)}},{key:"getRowMeta",value:function(e){return this._dimensionMeta.resize(e),this._onCalcRowHeadStatus.fire(this._dimensionMeta),Object(he.d)(e,this._rowcolAccessor,this._dimensionMeta)}},{key:"getColMeta",value:function(e){return this._dimensionMeta.resize(e),this._onCalcColHeadStatus.fire(this._dimensionMeta),Object(he.c)(e,this._rowcolAccessor,this._dimensionMeta)}},{key:"getRowHeight",value:function(e){return this.isRowHidden(e)?0:this._rowcolAccessor.getRowDisplayHeight(e)}},{key:"getColWidth",value:function(e){return this.isColHidden(e)?0:this._rowcolAccessor.getColSetWidth(e)}},{key:"isRowHidden",value:function(e){return this._rowcolAccessor.isRowHidden(e)}},{key:"isColHidden",value:function(e){return this._rowcolAccessor.isColHidden(e)}},{key:"getRowCount",value:function(){return this._tableView.cellViews.length}},{key:"getColCount",value:function(){return void 0===this._tableView.cellViews[0]?0:this._tableView.cellViews[0].length}},{key:"getCellBackgroundWidth",value:function(e,t){return Object(Oe.b)(this._rowcolAccessor,this._tableView.getCellViewAtPosition(e,t),t)}},{key:"getCellBackgroundHeight",value:function(e,t){return Object(Oe.a)(this._rowcolAccessor,this._tableView.getCellViewAtPosition(e,t),e)}},{key:"getClipInfo",value:function(e,t,r,n,a,o){var i=null,s=this.getCellDataAtPosition(e,t),l=this._paragraphAccessor.getParagraph(e,t),c=this._rowCoverAccessor.getCoverOffset(e,t);if(s.mergeData&&(l.width>a||l.height>o))i=[r,n,a,o];else if(l.height>o||l.width>a||c)if(c){for(var u=0,d=0,h=1;h<=c.leftOffset;h++)u+=this.getColWidth(t-h);for(var f=1;f<=c.rightOffset;f++)d+=this.getColWidth(t+f);i=[r-u,n,u+a+d,o]}else i=[r,n,a,o];return i}},{key:"getVerticalBorderStyle",value:function(e,t,r){var n=this._borderAccessor.getBorder(r,e);return(null===n||void 0===n?void 0:n.right)&&n.right.style||Se.a.NONE}},{key:"getHorizontalBorderStyle",value:function(e,t,r){var n=this._borderAccessor.getBorder(e,r);return(null===n||void 0===n?void 0:n.bottom)&&n.bottom.style||Se.a.NONE}},{key:"rowHeadWidth",get:function(){return u.q}},{key:"colHeadHeight",get:function(){return u.f}}]),e}(),ke=r("./src/core/view/spreadsheet-view/render-manager/alloy-excel/table/Table.canvas.ts"),Te=(r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js")),Ae=r("./src/core/view/spreadsheet-view/render-manager/alloy-excel/table/Table.ts"),Ie=function(){function e(){Object(n.a)(this,e)}return Object(a.a)(e,[{key:"render",value:function(){return'<div class="ae-formula-bar"><div class="ae-bar-label">A1</div><div class="ae-formula-input" style="white-space: pre-wrap;"></div></div>'}}]),e}(),Ne=(r("../node_modules/core-js/modules/es.array.map.js"),function(){function e(){Object(n.a)(this,e)}return Object(a.a)(e,[{key:"update",value:function(e){this._width!==e&&(this._width=e)}},{key:"render",value:function(){return'<col style="width:'.concat(this._width,'px"></col>')}},{key:"width",get:function(){return this._width}}]),e}()),Le=function(){function e(){Object(n.a)(this,e),this._cols=[]}return Object(a.a)(e,[{key:"update",value:function(e){var t,r;for(this._cols.length>e.length?(t=this._cols.length,this._removeCol(this._cols.length-e.length)):this._cols.length<e.length?(t=e.length,this._addCol(e.length-this._cols.length)):t=this._cols.length,this._cols.length=t,r=0;r<t;r++)this._cols[r].update(e[r])}},{key:"render",value:function(){return"<colgroup>".concat(this._cols.map((function(e){return e.render()})).join(""),"</colgroup>")}},{key:"_addCol",value:function(e){for(;e>0;)e-=1,this._cols.push(new Ne)}},{key:"_removeCol",value:function(e){for(;e>0;)e-=1,this._cols.shift()}}]),e}(),Pe=(r("../node_modules/core-js/modules/es.array.index-of.js"),function(){function e(){Object(n.a)(this,e),this._tdArray=[]}return Object(a.a)(e,[{key:"addTd",value:function(e){this._tdArray.push(e)}},{key:"removeTd",value:function(e){var t;(t="number"===typeof e?e:this._tdArray.indexOf(e))<0||this._tdArray.splice(t,1)}},{key:"update",value:function(e){var t=0;for(this._checkSize(e);t<e.length;t++)void 0===this._tdArray[t]?this.addTd(e[t]):this._tdArray[t].equal(e[t])||this._replaceTd(t,e[t])}},{key:"render",value:function(){return"<tr>".concat(this._tdArray.map((function(e){return e.render()})).join(""),"</tr>")}},{key:"_replaceTd",value:function(e,t){this._tdArray[e]=t}},{key:"_checkSize",value:function(e){var t,r;if(this._tdArray.length>e.length)for(t=this._tdArray.length-e.length;t>0;)t-=1,r=this._tdArray.pop(),this.removeTd(r)}},{key:"tdArray",get:function(){return this._tdArray}}]),e}()),Me=function(){function e(){Object(n.a)(this,e),this._tr=new Pe}return Object(a.a)(e,[{key:"render",value:function(){return"<thead>".concat(this._tr.render(),"</thead>")}},{key:"tr",get:function(){return this._tr}}]),e}(),Ve=function(){function e(){Object(n.a)(this,e),this._trs=[]}return Object(a.a)(e,[{key:"update",value:function(e){var t,r=e.length;for(this._checkSize(e),t=0;t<r;t++)void 0===this._trs[t]?this._addTr(e[t]):this._trs[t].update(e[t])}},{key:"render",value:function(){return"<tbody>".concat(this._trs.map((function(e){return e.render()})).join(""),"</tbody>")}},{key:"_addTr",value:function(e){var t,r=new Pe;for(t=0;t<e.length;t++)r.addTd(e[t]);this._trs.push(r)}},{key:"_removeTr",value:function(e){void 0!==this._trs[e]&&this._trs.splice(e,1)}},{key:"_checkSize",value:function(e){var t;if(this._trs.length>e.length)for(t=this._trs.length-e.length;t>0;)t-=1,this._removeTr(this._trs.length-1)}},{key:"trs",get:function(){return this._trs}}]),e}(),ze=function(){function e(){Object(n.a)(this,e),this._formulabar=new Ie,this._colgroup=new Le,this._thead=new Me,this._tbody=new Ve}return Object(a.a)(e,[{key:"formular",get:function(){return this._formulabar}},{key:"colgroup",get:function(){return this._colgroup}},{key:"thead",get:function(){return this._thead}},{key:"tbody",get:function(){return this._tbody}}]),e}();function Be(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var Fe=function(e){Object(i.a)(r,e);var t=Be(r);function r(){return Object(n.a)(this,r),t.call(this)}return Object(a.a)(r,[{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return'<table class="ae_table ae_table_col" style="left:'.concat(e,'px">')+"".concat(this._colgroup.render())+"".concat(this._thead.render())+"".concat(this._tbody.render())+"</table>"}}]),r}(ze),He=function(){function e(t){Object(n.a)(this,e),this._content=t.content,this._color=t.color,this._background=t.background,this._borderTop=t.borderTop,this._borderRight=t.borderRight,this._borderBottom=t.borderBottom,this._borderLeft=t.borderLeft,this._verticalAlign=t.verticalAlign,this._horizontalAlign=t.horizontalAlign,this._colspan=t.colspan,this._rowspan=t.rowspan,this._hidden=t.hidden,this._cover=t.cover,t.__static&&(t.content="",t.color=null,t.background=null,t.borderTop=null,t.borderRight=null,t.borderBottom=null,t.borderLeft=null,t.verticalAlign=null,t.horizontalAlign=null,t.colspan=1,t.rowspan=1,t.hidden=!1,t.cover=!1)}return Object(a.a)(e,[{key:"equal",value:function(e){return this._content==e._content&&this._background==e._background&&this._borderTop==e._borderTop&&this._borderRight==e._borderRight&&this._borderBottom==e._borderBottom&&this._borderLeft==e._borderLeft&&this._colspan==e._colspan&&this._rowspan==e._rowspan}},{key:"render",value:function(){var e=ge({background:this._background,color:this._color,horizontalAlign:this._horizontalAlign,verticalAlign:this._verticalAlign,borderTop:this._borderTop,borderRight:this._borderRight,borderBottom:this._borderBottom,borderLeft:this._borderLeft,hidden:this._hidden,cover:this._cover}),t=this._getAttributes();return"<td ".concat(t.map((function(e){return" ".concat(e.key,"=").concat(e.value," ")})).join(""),' class="').concat(e,'">').concat(this._content||"","</td>")}},{key:"_getAttributes",value:function(){var e=[];return this._colspan>1&&e.push({key:"colspan",value:String(this._colspan)}),this._rowspan>1&&e.push({key:"rowspan",value:String(this._rowspan)}),e}}]),e}();He.tdDefaultOpt={content:"",color:null,background:null,borderTop:null,borderRight:null,borderBottom:null,borderLeft:null,verticalAlign:null,horizontalAlign:null,colspan:1,rowspan:1,hidden:!1,cover:!1,__static:!0};var Ue=He;function We(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var Ge=function(e){Object(i.a)(r,e);var t=We(r);function r(e){var a,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.thDefaultOpt;return Object(n.a)(this,r),(a=t.call(this,e))._height=o.height,o.__static&&(o.height=null),a}return Object(a.a)(r,[{key:"equal",value:function(e){return this._height==e._height&&Object(o.a)(Object(l.a)(r.prototype),"equal",this).call(this,e)}},{key:"render",value:function(){var e=ge({background:this._background,color:this._color,horizontalAlign:this._horizontalAlign,verticalAlign:this._verticalAlign,borderTop:this._borderTop,borderRight:this._borderRight,borderBottom:this._borderBottom,borderLeft:this._borderLeft,hidden:this._hidden,cover:this._cover,height:this._height}),t=this._getAttributes();return"<th ".concat(t.map((function(e){return" ".concat(e.key,"=").concat(e.value," ")})).join(""),' class="').concat(e,'">').concat(this._content,"</th>")}},{key:"_getAttributes",value:function(){return Object(o.a)(Object(l.a)(r.prototype),"_getAttributes",this).call(this)}}]),r}(Ue);Ge.thDefaultOpt={height:null,__static:!0};var Ye=Ge,Xe=r("./src/core/view/spreadsheet-view/render-manager/alloy-excel/Default.ts");function Ke(e){return null===e?null:"".concat(e.width||1,"px solid ").concat(e.color?e.color.hex:Xe.a.LINE.color.hex)}var qe=function(){function e(t){Object(n.a)(this,e),this._table=t,this._colTable=new Fe}return Object(a.a)(e,[{key:"_prepareGolGroup",value:function(e,t){var r,n=[this._table.interface.rowHeadWidth];for(r=e;r<=t;r++)this._table.interface.isColHidden(r)||n.push(this._table.interface.getColWidth(r));this._colTable.colgroup.update(n)}},{key:"_prepareThead",value:function(e,t){var r,n;Ue.tdDefaultOpt.content="\xa0",Ue.tdDefaultOpt.borderTop=Ke(Xe.a.LINE),Ue.tdDefaultOpt.borderRight=Ke(Xe.a.LINE),Ue.tdDefaultOpt.borderBottom=Ke(Xe.a.LINE),Ue.tdDefaultOpt.borderLeft=Ke(Xe.a.LINE),Ye.thDefaultOpt.height=this._table.interface.colHeadHeight;var a=[new Ye(Ue.tdDefaultOpt,Ye.thDefaultOpt)];for(r=e;r<=t;r++)this._table.interface.isColHidden(r)||(n=this._table.interface.getColMeta(r),Ue.tdDefaultOpt.content=this._table.interface.getColContent(r),Ue.tdDefaultOpt.color=n.color.hex,Ue.tdDefaultOpt.background=n.background.hex,Ue.tdDefaultOpt.borderTop=Ke(Xe.a.LINE),n.borderRight&&(Ue.tdDefaultOpt.borderRight=Ke(n.borderRight)),Ue.tdDefaultOpt.borderBottom=Ke(Xe.a.LINE),n.borderLeft&&(Ue.tdDefaultOpt.borderLeft=Ke(n.borderLeft)),Ye.thDefaultOpt.height=this._table.interface.colHeadHeight,a.push(new Ye(Ue.tdDefaultOpt,Ye.thDefaultOpt)));this._colTable.thead.tr.update(a)}},{key:"_prepareTbody",value:function(){}},{key:"prepare",value:function(e,t,r){this._prepareGolGroup(e,t),this._prepareThead(e,t),this._prepareTbody()}},{key:"render",value:function(e,t){return this._colTable.render(e,t)}}]),e}();function Qe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var Ze=function(e){Object(i.a)(r,e);var t=Qe(r);function r(){return Object(n.a)(this,r),t.call(this)}return Object(a.a)(r,[{key:"render",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return'<table class="ae_table ae_table_row" style="top:'.concat(t,'px">')+"".concat(this._colgroup.render())+"".concat(this._thead.render())+"".concat(this._tbody.render())+"</table>"}}]),r}(ze),Je=function(){function e(t){Object(n.a)(this,e),this._table=t,this._rowTable=new Ze}return Object(a.a)(e,[{key:"_prepareGolGroup",value:function(){this._rowTable.colgroup.update([this._table.interface.rowHeadWidth])}},{key:"_prepareThead",value:function(){Ue.tdDefaultOpt.content="\xa0",Ue.tdDefaultOpt.borderTop=Ke(Xe.a.LINE),Ue.tdDefaultOpt.borderRight=Ke(Xe.a.LINE),Ue.tdDefaultOpt.borderBottom=Ke(Xe.a.LINE),Ue.tdDefaultOpt.borderLeft=Ke(Xe.a.LINE),Ye.thDefaultOpt.height=this._table.interface.colHeadHeight,this._rowTable.thead.tr.update([new Ye(Ue.tdDefaultOpt,Ye.thDefaultOpt)])}},{key:"_prepareTbody",value:function(e,t){var r,n,a=[];for(r=e;r<t;r++)this._table.interface.isRowHidden(r)||(n=this._table.interface.getRowMeta(r),Ue.tdDefaultOpt.content=this._table.interface.getRowContent(r),Ue.tdDefaultOpt.color=n.color.hex,Ue.tdDefaultOpt.background=n.background.hex,n.borderTop&&(Ue.tdDefaultOpt.borderTop=Ke(n.borderTop)),Ue.tdDefaultOpt.borderRight=Ke(Xe.a.LINE),n.borderBottom&&(Ue.tdDefaultOpt.borderBottom=Ke(n.borderBottom)),Ue.tdDefaultOpt.borderLeft=Ke(Xe.a.LINE),Ye.thDefaultOpt.height=n.height,a.push([new Ye(Ue.tdDefaultOpt,Ye.thDefaultOpt)]));this._rowTable.tbody.update(a)}},{key:"prepare",value:function(e,t,r){this._prepareGolGroup(),this._prepareThead(),this._prepareTbody(e,t)}},{key:"render",value:function(e,t){return this._rowTable.render(e,t)}}]),e}();function $e(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var et=function(e){Object(i.a)(r,e);var t=$e(r);function r(){return Object(n.a)(this,r),t.call(this)}return Object(a.a)(r,[{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return'<table class="ae_table ae_table_master" style="left:'.concat(e,"px;top:").concat(t,'px">')+"".concat(this._colgroup.render())+"".concat(this._thead.render())+"".concat(this._tbody.render())+"</table>"}}]),r}(ze),tt=function(){function e(t){Object(n.a)(this,e),this._table=t,this._masterTable=new et}return Object(a.a)(e,[{key:"_prepareColGroup",value:function(e,t){var r,n=[this._table.interface.rowHeadWidth];for(r=e;r<=t;r++)this._table.interface.isColHidden(r)||n.push(this._table.interface.getColWidth(r));this._masterTable.colgroup.update(n)}},{key:"_prepareThead",value:function(e,t){Ue.tdDefaultOpt.content="\xa0",Ue.tdDefaultOpt.borderTop=Ke(Xe.a.LINE),Ue.tdDefaultOpt.borderRight=Ke(Xe.a.LINE),Ue.tdDefaultOpt.borderBottom=Ke(Xe.a.LINE),Ue.tdDefaultOpt.borderLeft=Ke(Xe.a.LINE),Ye.thDefaultOpt.height=this._table.interface.colHeadHeight;var r,n=[new Ye(Ue.tdDefaultOpt,Ye.thDefaultOpt)];for(r=e;r<=t;r++)this._table.interface.isColHidden(r)||(Ye.thDefaultOpt.height=this._table.interface.colHeadHeight,n.push(new Ye(Ue.tdDefaultOpt)));this._masterTable.thead.tr.update(n)}},{key:"_prepareTbody",value:function(e,t,r,n){var a,o,i,s,l,c=[];for(a=e;a<=t;a++)if(!this._table.interface.isRowHidden(a)){for(o=r,s=this._table.interface.getRowMeta(a),Ue.tdDefaultOpt.borderBottom=Ke(Xe.a.LINE),Ue.tdDefaultOpt.borderRight=Ke(Xe.a.LINE),Ue.tdDefaultOpt.content=String(a+1),Ue.tdDefaultOpt.background="#f9fafb",Ye.thDefaultOpt.height=s.height,l=[new Ye(Ue.tdDefaultOpt,Ye.thDefaultOpt)],o=r;o<=n;o++)if(!this._table.interface.isColHidden(o)){if((i=this._table.interface.getCellDataAtPosition(a,o)).getInnerHTML&&(Ue.tdDefaultOpt.content=i.getInnerHTML(a,o,s.height)),Ue.tdDefaultOpt.background=i.background.hex,i.borderTop&&(Ue.tdDefaultOpt.borderTop=Ke(i.borderTop)),i.borderBottom&&(Ue.tdDefaultOpt.borderBottom=Ke(i.borderBottom)),i.borderRight&&(Ue.tdDefaultOpt.borderRight=Ke(i.borderRight)),i.borderLeft&&(Ue.tdDefaultOpt.borderLeft=Ke(i.borderLeft)),Ue.tdDefaultOpt.horizontalAlign=i.horizontalAlign.value,Ue.tdDefaultOpt.verticalAlign=i.verticalAlign.value,i.mergeData){var u=i.mergeData.colCount,d=i.mergeData.rowCount;Ue.tdDefaultOpt.colspan=u,Ue.tdDefaultOpt.rowspan=d;var h=this._table.interface.getCellDataAtPosition(a,o+u-1);h.borderRight&&(Ue.tdDefaultOpt.borderRight=Ke(h.borderRight));var f=this._table.interface.getCellDataAtPosition(a+d-1,o);f.borderBottom&&(Ue.tdDefaultOpt.borderBottom=Ke(f.borderBottom))}else Ue.tdDefaultOpt.hidden=!!i.mergeParent;l.push(new Ue(Ue.tdDefaultOpt))}c.push(l)}this._masterTable.tbody.update(c)}},{key:"prepare",value:function(e,t,r,n,a,o){this._prepareColGroup(r,n),this._prepareTbody(e,t,r,n),this._prepareThead(r,n)}},{key:"render",value:function(e,t){return this._masterTable.render(e,t)}}]),e}();function rt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var nt=function(e){Object(i.a)(r,e);var t=rt(r);function r(){return Object(n.a)(this,r),t.call(this)}return Object(a.a)(r,[{key:"render",value:function(){return'<table class="ae_table ae_table_corner">'+"".concat(this._colgroup.render())+"".concat(this._thead.render())+"".concat(this._tbody.render())+"</table>"}}]),r}(ze),at=function(){function e(t){Object(n.a)(this,e),this._table=t,this._cornerTable=new nt}return Object(a.a)(e,[{key:"prepare",value:function(){Ue.tdDefaultOpt.content="\xa0",Ue.tdDefaultOpt.background="#f9fafb",Ue.tdDefaultOpt.borderTop=Ke(Xe.a.LINE),Ue.tdDefaultOpt.borderRight=Ke(Xe.a.LINE),Ye.thDefaultOpt.height=this._table.interface.colHeadHeight;var e=[new Ye(Ue.tdDefaultOpt,Ye.thDefaultOpt)];this._cornerTable.thead.tr.update(e),this._cornerTable.colgroup.update([this._table.interface.rowHeadWidth])}},{key:"render",value:function(e,t){return this._cornerTable.render()}}]),e}(),ot=function(){function e(){Object(n.a)(this,e),this._formulabar=new Ie}return Object(a.a)(e,[{key:"render",value:function(){return this._formulabar.render()}}]),e}();function it(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}Ae.a;var st,lt=r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),ct=r("./src/core/view/spreadsheet-view/render-manager/renderUtil.ts"),ut=r("./src/core/view/spreadsheet-view/render-manager/ScrollRenderApi.ts");function dt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}!function(e){e[e.FROZEN=0]="FROZEN",e[e.FLOW=1]="FLOW"}(st||(st={}));var ht=function(e){Object(i.a)(r,e);var t=dt(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this))._onAfterRender=new x.a,a.onAfterRender=a._onAfterRender.event,a.renderTable=function(){a._alloyExcel.clear(),a._renderBody(),a._renderRowHead(),a._renderColHead(),a._renderCorner(),a._onAfterRender.fire()},a.renderNextTick=Object(D.f)(a.renderTable,0),a.renderRowCells=function(e){var t,r=a._areaData.row,n=a._areaData.col;if(r.frozen.renderFrom<=e&&e<=r.frozen.renderTo)t=st.FROZEN;else{if(!(r.flow.renderFrom<=e&&e<=r.flow.renderTo))return;t=st.FLOW}var o=a._areaData.getViewTopByRow(e);if(n.flow.to>=n.flow.from){var i=n.flow.renderFrom,s=Math.min(a._transformTable.getColCount()-1,n.flow.renderTo),l=a._areaData.getViewLeftByCol(i);a._clipBodyArea(t,st.FLOW,(function(){a._alloyExcel.renderCells(e,e,i,s,o,l)}))}if(n.frozen.to>=n.frozen.from){var c=n.frozen.renderFrom,u=Math.min(a._transformTable.getColCount()-1,n.frozen.renderTo),d=a._areaData.getViewLeftByCol(c);a._clipBodyArea(t,st.FROZEN,(function(){a._alloyExcel.renderCells(e,e,c,u,o,d)}))}a._renderRowHead(),a._renderColHead(),a._renderCorner(),a._onAfterRender.fire()},a._alloyExcel=e.alloyExcel,a._areaData=e.areaData,a._transformTable=e.transformTable,a._headSize=e.headSize,a._scrollRenderApi=new ut.a(e),a}return Object(a.a)(r,[{key:"scrollCanvasRender",value:function(){this._scrollRenderApi.scrollRender().isNeedRepaint&&(this._alloyExcel.clear(),this._renderBody()),this._renderRowHead(),this._renderColHead(),this._renderCorner(),this._onAfterRender.fire()}},{key:"renderRowHead",value:function(){this._alloyExcel.ctx.clearRect(0,0,this._headSize.rowHeadWidth,Number.MAX_SAFE_INTEGER),this._renderRowHead(),this._renderCorner(),this._onAfterRender.fire()}},{key:"renderColHead",value:function(){this._alloyExcel.ctx.clearRect(0,0,Number.MAX_SAFE_INTEGER,this._headSize.colHeadHeight),this._renderColHead(),this._renderCorner(),this._onAfterRender.fire()}},{key:"_renderBody",value:function(){var e=this._areaData.row,t=this._areaData.col;e.flow.to>=e.flow.from&&(this._renderBodyArea(st.FLOW,st.FLOW),t.frozen.to>=t.frozen.from&&this._renderBodyArea(st.FLOW,st.FROZEN)),e.frozen.to>=e.frozen.from&&(this._renderBodyArea(st.FROZEN,st.FLOW),t.frozen.to>=t.frozen.from&&this._renderBodyArea(st.FROZEN,st.FROZEN))}},{key:"_renderCorner",value:function(){this._alloyExcel.renderCorner()}},{key:"_renderRowHead",value:function(){var e=this._areaData.row;this._renderRowArea(st.FLOW),e.frozen.to>=e.frozen.from&&this._renderRowArea(st.FROZEN)}},{key:"_renderColHead",value:function(){var e=this._areaData.col;this._renderColArea(st.FLOW),e.frozen.to>=e.frozen.from&&this._renderColArea(st.FROZEN)}},{key:"_renderBodyArea",value:function(e,t){var r=this,n=this._areaData.row[e===st.FROZEN?"frozen":"flow"],a=this._areaData.col[t===st.FROZEN?"frozen":"flow"],o=n.renderFrom,i=Math.min(n.to,n.renderTo),s=this._areaData.getViewTopByRow(o),l=a.renderFrom,c=Math.min(a.to,a.renderTo),u=this._areaData.getViewLeftByCol(l);e===st.FROZEN||t===st.FROZEN?this._clipBodyArea(e,t,(function(){r._alloyExcel.renderCells(o,i,l,c,s,u)})):this._alloyExcel.renderCells(o,i,l,c,s,u)}},{key:"_clipBodyArea",value:function(e,t,r){var n,a=this._getFrozenAreaClipRect(e,t);this._alloyExcel.ctx.save(),this._alloyExcel.ctx.beginPath(),(n=this._alloyExcel.ctx).rect.apply(n,Object(lt.a)(a)),this._alloyExcel.ctx.clip(),this._alloyExcel.ctx.closePath(),r(),this._alloyExcel.ctx.restore()}},{key:"_getFrozenAreaClipRect",value:function(e,t){return Object(ct.e)(e,t,this._areaData,this._transformTable)}},{key:"_renderRowArea",value:function(e){var t=this._areaData.row[e===st.FROZEN?"frozen":"flow"],r=this._areaData.getViewTopByRow(t.renderFrom);this._alloyExcel.renderRowHead(t.renderFrom,t.renderTo+1,r)}},{key:"_renderColArea",value:function(e){var t=this._areaData.col[e===st.FROZEN?"frozen":"flow"],r=this._areaData.getViewLeftByCol(t.renderFrom);this._alloyExcel.renderColHead(t.renderFrom,t.renderTo+1,r)}}]),r}(b.a),ft=r("./src/base/event/event.ts");function pt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var _t=function(e){Object(i.a)(r,e);var t=pt(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this))._handleResize=Object(D.f)((function(){a.alloyExcel.resize(),a.renderApi.renderTable()})),a._handleScale=function(){a.alloyExcel.clear(),a.alloyExcel.applyMatrixToCanvas(a.scale.matrix),a.renderApi.renderNextTick()},a.container=e.container,a.resize=e.resize,a.scale=e.scale,a.transformTable=e.transformTable,a.areaData=e.areaData,a.headSize=e.headSize,a.spreadsheet=e.spreadsheet,a.alloyExcel=new ke.a(a.container,a.transformTable,a.scale.matrix),a.renderApi=new ht({alloyExcel:a.alloyExcel,areaData:a.areaData,transformTable:a.transformTable,headSize:a.headSize,scale:a.scale,spreadsheet:a.spreadsheet}),a._register(a.resize.onResize(a._handleResize)),a._register(a.scale.onScale(a._handleScale)),a._register(a.areaData.onUpdateOffset(Object(D.d)(a.renderApi.scrollCanvasRender.bind(a.renderApi)))),ft.c.spreadsheetEvent.listen("renderAfterMutationRun",a.renderApi.renderNextTick),a}return Object(a.a)(r,[{key:"dispose",value:function(){Object(o.a)(Object(l.a)(r.prototype),"dispose",this).call(this),ft.c.spreadsheetEvent.remove("renderAfterMutationRun",this.renderApi.renderNextTick)}}]),r}(b.a);function mt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var vt=function(e,t,r,n){var a,o=arguments.length,i=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(c.a)(Reflect))&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(i=(o<3?a(i):o>3?a(t,r,i):a(t,r))||i);return o>3&&i&&Object.defineProperty(t,r,i),i},gt=function(e,t){return function(r,n){t(r,n,e)}},bt=function(e){Object(i.a)(r,e);var t=mt(r);function r(e,a,o){var i;return Object(n.a)(this,r),(i=t.call(this)).spreadsheet=e,i.dataCallView=a,i.wrap=o,i.init(),i}return Object(a.a)(r,[{key:"init",value:function(){this.initContainer(),this.initScale(),this.initResize(),this.initHeadSize(),this.initClientRect(),this.initMutexManagement(),this.initParagraphAccessor(),this.initRowcolAccessor(),this.initRowCoverAccessor(),this.initBorderAccessor(),this.initTableView(),this.initAreaData(),this.initTransformTable(),this.initRenderManager()}},{key:"dispose",value:function(){Object(o.a)(Object(l.a)(r.prototype),"dispose",this).call(this),this.wrap.removeChild(this.container)}},{key:"initContainer",value:function(){this.container=document.createElement("div"),this.container.className="excel-container",Object.assign(this.container.style,{"background-color":"#f8f8f8","user-select":"none","-webkit-user-select":"none"}),this.container.setAttribute("tabIndex","3"),this.wrap.appendChild(this.container)}},{key:"initScale",value:function(){this.scale=new z}},{key:"initResize",value:function(){this.resize=this._register(new L.a)}},{key:"initHeadSize",value:function(){this.headSize=new N({scale:this.scale})}},{key:"initClientRect",value:function(){this.clientRect=this._register(new I({container:this.container,resize:this.resize}))}},{key:"initMutexManagement",value:function(){this.mutexManagement=new de.b}},{key:"initParagraphAccessor",value:function(){this.paragraphAccessor=this._register(new $.b({dataCallView:this.dataCallView,spreadsheet:this.spreadsheet}))}},{key:"initRowcolAccessor",value:function(){this.rowcolAccessor=this._register(new B.b({paragraphAccessor:this.paragraphAccessor,spreadsheet:this.spreadsheet,dataCallView:this.dataCallView}))}},{key:"initRowCoverAccessor",value:function(){this.rowCoverAccessor=this._register(new J({dataCallView:this.dataCallView,paragraphAccessor:this.paragraphAccessor,rowcolAccessor:this.rowcolAccessor,spreadsheet:this.spreadsheet}))}},{key:"initBorderAccessor",value:function(){this.borderAccessor=this._register(new le({spreadsheet:this.spreadsheet,dataCallView:this.dataCallView,rowCoverAccessor:this.rowCoverAccessor,rowcolAccessor:this.rowcolAccessor}))}},{key:"initTableView",value:function(){this.tableView=this._register(new w({spreadsheet:this.spreadsheet,dataCallView:this.dataCallView}))}},{key:"initAreaData",value:function(){this.areaData=this._register(new T({clientRect:this.clientRect,rowcolAccessor:this.rowcolAccessor,headSize:this.headSize,dataCallView:this.dataCallView,resize:this.resize,scale:this.scale}))}},{key:"initTransformTable",value:function(){this.transformTable=new xe({tableView:this.tableView,rowcolAccessor:this.rowcolAccessor,rowCoverAccessor:this.rowCoverAccessor,borderAccessor:this.borderAccessor,paragraphAccessor:this.paragraphAccessor})}},{key:"initRenderManager",value:function(){this.renderManager=this._register(new _t({container:this.container,areaData:this.areaData,resize:this.resize,scale:this.scale,headSize:this.headSize,transformTable:this.transformTable,spreadsheet:this.spreadsheet}))}}]),r}(b.a),yt=bt=vt([gt(0,ce.ISpreadsheet),gt(1,ue.a)],bt),wt=r("./src/core/view/data-call-view/DataCallView.ts"),Rt=function(){function e(t,r,a){Object(n.a)(this,e),this._level0Inited=!1,this._spreadsheetApp=t,this._spreadsheet=r,this._dataCallView=new wt.a({spreadsheet:r});var o=new yt(r,this._dataCallView,a);this._container=o.container,this._paragraphAccessor=o.paragraphAccessor,this._tableView=o.tableView,this._resize=o.resize,this._clientRect=o.clientRect,this._scale=o.scale,this._headSize=o.headSize,this._transformTable=o.transformTable,this._alloyExcel=o.renderManager.alloyExcel,this._rowcolAccessor=o.rowcolAccessor,this._rowCoverAccessor=o.rowCoverAccessor,this._borderAccessor=o.borderAccessor,this._areaData=o.areaData,this._renderApi=o.renderManager.renderApi,this._mutexManagement=o.mutexManagement,this._spreadsheetView=o}return Object(a.a)(e,[{key:"initLevel0",value:function(){this._level0Inited?console.info("view.level0\u5df2\u7ecf\u521d\u59cb\u5316"):(console.info("view.level0\u521d\u59cb\u5316"),this._level0Inited=!0)}},{key:"refresh",value:function(){this._dataCallView.refresh(),this._paragraphAccessor.refresh(),this._rowCoverAccessor.refresh(),this._rowcolAccessor.refresh(),this._borderAccessor.refresh(),this._tableView.refresh(),this._areaData.refresh(),this._borderAccessor.refresh()}},{key:"container",get:function(){return this._container}},{key:"dataCallView",get:function(){return this._dataCallView}},{key:"tableView",get:function(){return this._tableView}},{key:"resize",get:function(){return this._resize}},{key:"scale",get:function(){return this._scale}},{key:"headSize",get:function(){return this._headSize}},{key:"clientRect",get:function(){return this._clientRect}},{key:"spreadsheetApp",get:function(){return this._spreadsheetApp}},{key:"spreadsheet",get:function(){return this._spreadsheet}},{key:"alloyExcel",get:function(){return this._alloyExcel}},{key:"rowcolAccessor",get:function(){return this._rowcolAccessor}},{key:"rowCoverAccessor",get:function(){return this._rowCoverAccessor}},{key:"areaData",get:function(){return this._areaData}},{key:"renderApi",get:function(){return this._renderApi}},{key:"transformTable",get:function(){return this._transformTable}},{key:"mutextManagement",get:function(){return this._mutexManagement}},{key:"paragraphAccessor",get:function(){return this._paragraphAccessor}}]),e}(),Et=r("./src/core/view/level-1/auto-scroll/AutoScroll.ts"),Ct=function e(t,r){var a=this;Object(n.a)(this,e),this._handleAutoScroll=function(e){a._areaData.col.flow.offsetSize+=e.diffX,a._areaData.row.flow.offsetSize+=e.diffY},this._autoScroll=t,this._areaData=r.areaData,this._autoScroll.emitter.on(Et.b.EVENT.AUTO_SCROLL,this._handleAutoScroll)},jt=(r("./src/core/view/level-1/board/main/feature-board/FeatureBoard.less"),function(){function e(t){var r=this;Object(n.a)(this,e),this._board=document.createElement("div"),this._tx=0,this._ty=0,this.translateX=function(e){e!==r._tx&&(r._tx=e,r._board.style.transform="translate3d(".concat(r._tx,"px, ").concat(r._ty,"px, 0px)"))},this.translateY=function(e){e!==r._ty&&(r._ty=e,r._board.style.transform="translate3d(".concat(r._tx,"px, ").concat(r._ty,"px, 0px)"))},this._board.classList.add("feature-board"),t.appendChild(this._board)}return Object(a.a)(e,[{key:"refresh",value:function(){}},{key:"element",get:function(){return this._board}}]),e}()),Ot=(r("./src/core/view/level-1/board/main/feature-board/WrapBoard.less"),function(){function e(t){Object(n.a)(this,e),this._board=document.createElement("div"),this._board.classList.add("wrap-board"),this._featureBoard=new jt(this._board),t.appendChild(this._board)}return Object(a.a)(e,[{key:"element",get:function(){return this._featureBoard.element}},{key:"featureBoard",get:function(){return this._featureBoard}}]),e}());r("./src/core/view/level-1/board/main/feature-board/HiddenBoard.less");function St(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var Dt=function(e){Object(i.a)(r,e);var t=St(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e))._board.classList.add("hidden-board"),a}return r}(Ot),xt=(r("./src/core/view/level-1/board/main/BlockBoard.less"),function(){function e(t,r,a){var o=this;Object(n.a)(this,e),this._offsetX=0,this._offsetY=0,this.refresh=function(){var e=o._colArea.displayViewSize;Object.assign(o._board.style,{display:0===e?"none":"inline-block",width:"".concat(e,"px")})},this._rowArea=r,this._colArea=a,this._board=document.createElement("div"),this._board.classList.add("block-board"),this._hiddenBoard=new Dt(this._board),t.appendChild(this._board),this._colArea.onUpdateViewSize(this.refresh)}return Object(a.a)(e,[{key:"setOffset",value:function(e,t){this._offsetX=e,this._offsetY=t}},{key:"element",get:function(){return this._board}},{key:"hiddenBoard",get:function(){return this._hiddenBoard}},{key:"offsetX",get:function(){return this._offsetX}},{key:"offsetY",get:function(){return this._offsetY}},{key:"totalWidth",get:function(){return this._colArea.displayTotalSize}},{key:"totalHeight",get:function(){return this._rowArea.displayTotalSize}}]),e}()),kt=(r("./src/core/view/level-1/board/main/LineBoard.less"),function(){function e(t,r,a){var o=this;Object(n.a)(this,e),this.refresh=function(){var e=o._area.displayViewSize;Object.assign(o._board.style,{display:0===e?"none":"block",height:"".concat(e,"px")}),o._left.refresh(),o._right.refresh()},this._area=r,this._board=document.createElement("div"),this._board.classList.add("line-board"),this._left=new xt(this._board,r,a.frozen),this._right=new xt(this._board,r,a.flow),t.appendChild(this._board),this._area.onUpdateViewSize(this.refresh)}return Object(a.a)(e,[{key:"element",get:function(){return this._board}},{key:"left",get:function(){return this._left}},{key:"right",get:function(){return this._right}}]),e}()),Tt=(r("./src/core/view/level-1/board/main/MainBoard.less"),function(){function e(t){var r=this;Object(n.a)(this,e),this._updateAreaOffset=function(){var e=r._areaData.getDisplayGlobalLeftByCol(r._areaData.col.flow.from),t=r._areaData.getDisplayGlobalTopByRow(r._areaData.row.flow.from),n=-r._areaData.getDisplayViewLeftByCol(0),a=-r._areaData.getDisplayViewTopByRow(0);r._topLine.left.setOffset(n,a),r._topLine.right.setOffset(e,a),r._bottomLine.left.setOffset(n,t),r._bottomLine.right.setOffset(e,t)},this._refresh=function(){Object.assign(r._board.style,{top:"".concat(r._headSize.displayColHeadHeight,"px"),left:"".concat(r._headSize.displayRowHeadWidth,"px")}),r._topLine.refresh(),r._bottomLine.refresh(),r._updateAreaOffset();var e=-r._areaData.row.flow.displayOffsetSize;r._bottomLine.left.hiddenBoard.featureBoard.translateY(e),r._bottomLine.right.hiddenBoard.featureBoard.translateY(e);var t=-r._areaData.col.flow.displayOffsetSize;r._topLine.right.hiddenBoard.featureBoard.translateX(t),r._bottomLine.right.hiddenBoard.featureBoard.translateX(t)},this._handleScale=function(){r._refresh()},this._container=t.container,this._headSize=t.headSize,this._areaData=t.areaData,this._scale=t.scale,this._board=document.createElement("div"),this._board.classList.add("main-board"),this._topLine=new kt(this._board,this._areaData.row.frozen,this._areaData.col),this._bottomLine=new kt(this._board,this._areaData.row.flow,this._areaData.col),this._refresh(),this._container.appendChild(this._board),this._scale.onScale(this._handleScale),this._areaData.row.frozen.onUpdateViewSize(this._updateAreaOffset),this._areaData.col.frozen.onUpdateViewSize(this._updateAreaOffset),this._areaData.row.frozen.onUpdateOffset(this._updateAreaOffset),this._areaData.col.frozen.onUpdateOffset(this._updateAreaOffset),this._areaData.row.flow.onUpdateOffset((function(){var e=-r._areaData.row.flow.displayOffsetSize;r._bottomLine.left.hiddenBoard.featureBoard.translateY(e),r._bottomLine.right.hiddenBoard.featureBoard.translateY(e)})),this._areaData.col.flow.onUpdateOffset((function(){var e=-r._areaData.col.flow.displayOffsetSize;r._topLine.right.hiddenBoard.featureBoard.translateX(e),r._bottomLine.right.hiddenBoard.featureBoard.translateX(e)}))}return Object(a.a)(e,[{key:"refresh",value:function(){this._refresh()}},{key:"element",get:function(){return this._board}},{key:"top",get:function(){return this._topLine}},{key:"bottom",get:function(){return this._bottomLine}}]),e}()),At=(r("../node_modules/core-js/modules/es.number.min-safe-integer.js"),function(){function e(t){var r=this;Object(n.a)(this,e),this._cacheHoverData={x:0,y:0,col:0,row:0},this._handleMousedown=function(e){r._updateHoverData(e.clientX,e.clientY),r._operateData.mouseDown(r._cacheHoverData.x,r._cacheHoverData.y,r._cacheHoverData.col,r._cacheHoverData.row,e)},this._handleMousemove=function(e){r._updateHoverData(e.clientX,e.clientY),r._operateData.mouseMove(r._cacheHoverData.x,r._cacheHoverData.y,r._cacheHoverData.col,r._cacheHoverData.row,e)},this._handleMouseup=function(e){r._updateHoverData(e.clientX,e.clientY),r._operateData.mouseUp(r._cacheHoverData.x,r._cacheHoverData.y,r._cacheHoverData.col,r._cacheHoverData.row,e)},this._container=t.container,this._clientRect=t.clientRect,this._headSize=t.headSize,this._areaData=t.areaData,this._scale=t.scale,this._operateData=t.operateData,this._container.addEventListener("mousedown",this._handleMousedown,!0),document.addEventListener("mousemove",this._handleMousemove,!0),document.addEventListener("mouseup",this._handleMouseup,!0)}return Object(a.a)(e,[{key:"_updateHoverData",value:function(e,t){var r,n;e>this._clientRect.width?r=Number.MAX_SAFE_INTEGER:e<this._clientRect.distanceX?r=Number.MIN_SAFE_INTEGER:e<this._clientRect.distanceX+this._headSize.displayRowHeadWidth&&(r=-1),t>this._clientRect.distanceY+this._clientRect.height?n=Number.MAX_SAFE_INTEGER:t<this._clientRect.distanceY?n=Number.MIN_SAFE_INTEGER:t<this._clientRect.distanceY+this._headSize.displayColHeadHeight&&(n=-1);var a=this._scale.scale,o=t-this._clientRect.distanceY-this._headSize.displayColHeadHeight,i=e-this._clientRect.distanceX-this._headSize.displayRowHeadWidth;isNaN(Number(r))&&isNaN(Number(n))?(n=this._areaData.getRowByDisplayViewTop(o),r=this._areaData.getColByDisplayViewLeft(i)):isNaN(Number(n))?n=this._areaData.getRowByDisplayViewTop(o):isNaN(Number(r))&&(r=this._areaData.getColByDisplayViewLeft(i)),this._cacheHoverData.x=(e-this._clientRect.distanceX)/a,this._cacheHoverData.y=(t-this._clientRect.distanceY)/a,this._cacheHoverData.col=r,this._cacheHoverData.row=n}}]),e}()),It=function(){function e(t){var r=this;Object(n.a)(this,e),this._cacheHoverData={x:0,y:0,col:0,row:0},this._handleTouchstart=function(e){r._updateHoverData(e.touches[0].clientX,e.touches[0].clientY),r._operateData.touchStart(r._cacheHoverData.x,r._cacheHoverData.y,r._cacheHoverData.col,r._cacheHoverData.row,e),e.touches.length>1&&(r._updateHoverData(e.touches[1].clientX,e.touches[1].clientY),r._operateData.touchSecondFingerStart(r._cacheHoverData.x,r._cacheHoverData.y))},this._handleTouchmove=function(e){r._updateHoverData(e.touches[0].clientX,e.touches[0].clientY),r._operateData.touchMove(r._cacheHoverData.x,r._cacheHoverData.y,r._cacheHoverData.col,r._cacheHoverData.row,e),e.touches.length>1&&(r._updateHoverData(e.touches[1].clientX,e.touches[1].clientY),r._operateData.touchSecondFingerMove(r._cacheHoverData.x,r._cacheHoverData.y))},this._handleTouchend=function(e){r._updateHoverData(e.changedTouches[0].clientX,e.changedTouches[0].clientY),r._operateData.touchEnd(r._cacheHoverData.x,r._cacheHoverData.y,r._cacheHoverData.col,r._cacheHoverData.row,e)},this._container=t.container,this._clientRect=t.clientRect,this._headSize=t.headSize,this._areaData=t.areaData,this._scale=t.scale,this._operateData=t.operateData,this._container.addEventListener("touchstart",this._handleTouchstart,!0),document.addEventListener("touchmove",this._handleTouchmove,!0),document.addEventListener("touchend",this._handleTouchend,!0)}return Object(a.a)(e,[{key:"_updateHoverData",value:function(e,t){var r,n;e>this._clientRect.width?r=Number.MAX_SAFE_INTEGER:e<this._clientRect.distanceX?r=Number.MIN_SAFE_INTEGER:e<this._clientRect.distanceX+this._headSize.displayRowHeadWidth&&(r=-1),t>this._clientRect.distanceY+this._clientRect.height?n=Number.MAX_SAFE_INTEGER:t<this._clientRect.distanceY?n=Number.MIN_SAFE_INTEGER:t<this._clientRect.distanceY+this._headSize.displayColHeadHeight&&(n=-1);var a=this._scale.scale,o=t-this._clientRect.distanceY-this._headSize.displayColHeadHeight,i=e-this._clientRect.distanceX-this._headSize.displayRowHeadWidth;isNaN(Number(r))&&isNaN(Number(n))?(n=this._areaData.getRowByDisplayViewTop(o),r=this._areaData.getColByDisplayViewLeft(i)):isNaN(Number(n))?n=this._areaData.getRowByDisplayViewTop(o):isNaN(Number(r))&&(r=this._areaData.getColByDisplayViewLeft(i)),this._cacheHoverData.x=(e-this._clientRect.distanceX)/a,this._cacheHoverData.y=(t-this._clientRect.distanceY)/a,this._cacheHoverData.col=r,this._cacheHoverData.row=n}}]),e}(),Nt=r("./src/core/view/level-1/operate-context/mouse/MouseOperate.ts"),Lt=r("./src/core/view/level-1/operate-context/touch/TouchOperate.ts"),Pt=r("./src/core/view/level-1/wheel-operate/WheelOperate.ts"),Mt=r("./src/core/view/level-1/select-data/NormalSelectData.ts"),Vt=r("./src/core/view/level-1/select-data/BaseSelectData.ts"),zt=r("./src/core/view/level-1/select-data/utils.ts"),Bt=r("./src/core/view/level-1/select-data/selection/EmptySelection.ts");function Ft(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ht(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ft(Object(r),!0).forEach((function(t){Object(F.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ft(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ut(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var Wt=function(e){Object(i.a)(r,e);var t=Ut(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e))._currentSelectIndex=0,a}return Object(a.a)(r,[{key:"addSelection",value:function(e){var t;null===e?(t=Bt.a.newInstance(),this._selectQueue.push(t)):(e.activation||(e.activation={row:e.yRange?e.yRange[0]:0,col:e.xRange?e.xRange[0]:0}),t=Object(o.a)(Object(l.a)(r.prototype),"_addSelection",this).call(this,e,e.activation),this.currentSelectIndex=Math.min(this._currentSelectIndex+1,this._selectQueue.length-1)),this.emitter.emit(r.EVENT.ADD_SELECTION,t)}},{key:"updateSelection",value:function(e,t){var n=this._selectQueue[e];if(void 0===n)throw new Error("\u9519\u8bef\u66f4\u65b0\u9009\u533a");if(n&&!t.activation&&(t.activation={row:n.activation.row,col:n.activation.col}),!t.activation)throw new Error("\u5fc5\u987b\u4f20\u5165 activation");Object(o.a)(Object(l.a)(r.prototype),"_updateSelection",this).call(this,e,t,t.activation),this._currentSelectIndex=e,this.emitter.emit(r.EVENT.UPDATE_SELECTION,{index:e,selection:this._selectQueue[e]})}},{key:"removeSelection",value:function(e){Object(o.a)(Object(l.a)(r.prototype),"_removeSelection",this).call(this,e),this._currentSelectIndex=Math.min(this._currentSelectIndex,this._selectQueue.length-1),this.emitter.emit(r.EVENT.REMOVE_SELECTION,e)}},{key:"resetSelection",value:function(){}},{key:"clear",value:function(){Object(o.a)(Object(l.a)(r.prototype),"_resetSelection",this).call(this),this._currentSelectIndex=-1,this.emitter.emit(r.EVENT.RESET_SELECTION)}},{key:"currentSelectIndex",set:function(e){if(e>this._selectQueue.length)throw new Error("\u8bbe\u7f6e\u7684\u5f53\u524d\u9009\u533a\u5f02\u5e38");this._currentSelectIndex=e,this.emitter.emit(r.EVENT.UPDATE_CURRENT_INDEX,e)},get:function(){return this._currentSelectIndex}},{key:"activeRow",get:function(){if(!this._selectQueue[this._currentSelectIndex])return-1;var e=this._selectQueue[this._currentSelectIndex].activation;return e?Object(zt.b)(this._tableView,e.row,e.col).row:-1}},{key:"activeCol",get:function(){if(!this._selectQueue[this._currentSelectIndex])return-1;var e=this._selectQueue[this._currentSelectIndex].activation;return e?Object(zt.b)(this._tableView,e.row,e.col).col:-1}},{key:"activation",get:function(){return this._selectQueue[this._currentSelectIndex].activation}},{key:"EVENT",get:function(){return r.EVENT}},{key:"select",get:function(){return this._selectQueue[this._currentSelectIndex]||null}}]),r}(Vt.a);Wt.EVENT=Ht(Ht({},Vt.a.EVENT),{},{UPDATE_CURRENT_INDEX:"updateCurrentIndex"});var Gt,Yt=Wt,Xt=r("./src/core/view/level-1/shape-stage/stage/DomShapeStage.ts");!function(e){e[e.NORMAL=0]="NORMAL",e[e.FORMULA=1]="FORMULA"}(Gt||(Gt={}));var Kt=function e(t){Object(n.a)(this,e),this._selectData=t.selectData},qt=r("./src/core/view/level-1/select-data/selection/AllSelection.ts"),Qt=r("./src/core/view/level-1/select-data/selection/RowSelection.ts"),Zt=r("./src/core/view/level-1/select-data/selection/ColSelection.ts"),Jt=r("./src/core/view/level-1/select-data/selection/CellSelection.ts");function $t(e){return function(e){return e%1===0}(e)?e:Math.round(e)+.5}function er(e,t,r){var n,a,o,i,s,l,c,u,d;if(r instanceof qt.a)n=0,a=0,o=$t(t.col.frozen.displayContentSize+t.col.flow.displayContentSize),i=$t(t.row.frozen.displayContentSize+t.row.flow.displayContentSize),l=0,u=0,c=Number.MAX_SAFE_INTEGER,d=Number.MAX_SAFE_INTEGER;else if(r instanceof Qt.a)n=0,a=t.getDisplayGlobalTopByRow(r.yRange[0]),o=$t(t.col.frozen.displayContentSize+t.col.flow.displayContentSize),i=$t(t.getDisplayGlobalBottomByRow(r.yRange[1]))-a,l=r.yRange[0],u=0,c=r.yRange[1],d=Number.MAX_SAFE_INTEGER;else if(r instanceof Zt.a)n=t.getDisplayGlobalLeftByCol(r.xRange[0]),a=0,o=$t(t.getDisplayGlobalRightByCol(r.xRange[1]))-n,i=$t(t.row.frozen.displayContentSize+t.row.flow.displayContentSize),l=0,u=r.xRange[0],c=Number.MAX_SAFE_INTEGER,d=r.xRange[1];else if(r instanceof Jt.a)n=t.getDisplayGlobalLeftByCol(r.xRange[0]),a=t.getDisplayGlobalTopByRow(r.yRange[0]),o=$t(t.getDisplayGlobalRightByCol(r.xRange[1]))-n,i=$t(t.getDisplayGlobalBottomByRow(r.yRange[1]))-a,l=r.yRange[0],u=r.xRange[0],c=r.yRange[1],d=r.xRange[1];else{if(!(r instanceof Bt.a))throw new Error("\u4e0d\u53ef\u7528\u7684\u9009\u533a\u7c7b\u578b");n=-1,a=-1,o=-1,i=-1,l=-1,u=-1,c=-1,d=-1}if(r.activation&&r.activation.row>-1&&r.activation.col>-1){var h=Object(zt.b)(e,r.activation.row,r.activation.col),f=h.row,p=h.col;if(f>=0&&p>=0){s=[0,0,0,0];var _=e.getCellViewAtPosition(f,p);if(null===_)throw new Error("\u5c55\u793a\u9009\u533a\u5f02\u5e38");var m=f+(_.mergeData?_.mergeData.rowCount-1:0),v=p+(_.mergeData?_.mergeData.colCount-1:0),g=$t(t.getDisplayGlobalLeftByCol(p)),b=$t(t.getDisplayGlobalTopByRow(f)),y=$t(t.getDisplayGlobalRightByCol(v)),w=$t(t.getDisplayGlobalBottomByRow(m));s[0]=b-a,s[3]=g-n,s[1]=n+o-y,s[2]=a+i-w}}return{left:n,top:a,width:o,height:i,padding:s,startRow:l,endRow:c,startCol:u,endCol:d}}var tr=r("../packages/lib/EventEmitter.ts");function rr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var nr=function(e){Object(i.a)(r,e);var t=rr(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e))._showing=!0,a._handleUpdateSelections=Object(D.d)((function(){for(var e=0;e<a._selectData.selectQueue.length;e++){var t=a._selectData.selectQueue[e];a._updateSelection({index:e,selection:t})}})),a._addSelection=function(e){var t=er(a._tableView,a._areaData,e);a._topLeft.addSelection(t,e,t.startRow<=a._areaData.row.frozen.to&&t.startCol<=a._areaData.col.frozen.to),a._topRight.addSelection(t,e,t.startRow<=a._areaData.row.frozen.to&&t.endCol>=a._areaData.col.flow.from),a._bottomLeft.addSelection(t,e,t.endRow>=a._areaData.row.flow.from&&t.startCol<=a._areaData.col.frozen.to),a._bottomRight.addSelection(t,e,t.endRow>=a._areaData.row.flow.from&&t.endCol>=a._areaData.col.flow.from)},a._updateSelection=function(e){var t=e.index,r=e.selection,n=er(a._tableView,a._areaData,r);a._topLeft.updateSelection(t,n,r,n.startRow<=a._areaData.row.frozen.to&&n.startCol<=a._areaData.col.frozen.to),a._topRight.updateSelection(t,n,r,n.startRow<=a._areaData.row.frozen.to&&n.endCol>=a._areaData.col.flow.from),a._bottomLeft.updateSelection(t,n,r,n.endRow>=a._areaData.row.flow.from&&n.startCol<=a._areaData.col.frozen.to),a._bottomRight.updateSelection(t,n,r,n.endRow>=a._areaData.row.flow.from&&n.endCol>=a._areaData.col.flow.from)},a._removeSelection=function(e){a._showing||a._show(),a._topLeft.removeSelection(e),a._topRight.removeSelection(e),a._bottomLeft.removeSelection(e),a._bottomRight.removeSelection(e)},a._resetSelection=function(){a._showing||a._show(),a._topLeft.resetSelection(),a._topRight.resetSelection(),a._bottomLeft.resetSelection(),a._bottomRight.resetSelection()},a.emitter=new tr.a,a._mainBoard=e.mainBoard,a._areaData=e.areaData,a._scale=e.scale,a._tableView=e.tableView,a._topLeft=e.topLeft,a._topRight=e.topRight,a._bottomLeft=e.bottomLeft,a._bottomRight=e.bottomRight,a._selectData.emitter.on(a._selectData.EVENT.ADD_SELECTION,a._addSelection),a._selectData.emitter.on(a._selectData.EVENT.UPDATE_SELECTION,a._updateSelection),a._selectData.emitter.on(a._selectData.EVENT.REMOVE_SELECTION,a._removeSelection),a._selectData.emitter.on(a._selectData.EVENT.RESET_SELECTION,a._resetSelection),a._areaData.row.frozen.onUpdateViewSize(a._handleUpdateSelections),a._areaData.row.flow.onUpdateViewSize(a._handleUpdateSelections),a._areaData.col.frozen.onUpdateViewSize(a._handleUpdateSelections),a._areaData.col.flow.onUpdateViewSize(a._handleUpdateSelections),a._areaData.row.frozen.onUpdateTotalSize(a._handleUpdateSelections),a._areaData.row.flow.onUpdateTotalSize(a._handleUpdateSelections),a._areaData.col.frozen.onUpdateTotalSize(a._handleUpdateSelections),a._areaData.col.flow.onUpdateTotalSize(a._handleUpdateSelections),a}return Object(a.a)(r,[{key:"refresh",value:function(){}},{key:"show",value:function(){this._showing||this._show()}},{key:"hide",value:function(){this._showing&&this._hide()}},{key:"mutexHide",value:function(){this._showing&&this._hide()}},{key:"_show",value:function(){this._showing=!0,this._topLeft.show(),this._topRight.show(),this._bottomLeft.show(),this._bottomRight.show(),this.emitter.emit(r.EVENT.SHOW)}},{key:"_hide",value:function(){this._showing=!1,this._topLeft.hide(),this._topRight.hide(),this._bottomLeft.hide(),this._bottomRight.hide(),this.emitter.emit(r.EVENT.HIDE)}},{key:"EVENT",get:function(){return r.EVENT}},{key:"topLeft",get:function(){return this._topLeft}},{key:"topRight",get:function(){return this._topRight}},{key:"bottomLeft",get:function(){return this._bottomLeft}},{key:"bottomRight",get:function(){return this._bottomRight}},{key:"showing",get:function(){return this._showing}}]),r}(Kt);nr.EVENT={SHOW:"show",HIDE:"hide"};var ar=nr;var or,ir=function(){function e(t){Object(n.a)(this,e),this._areaData=t.areaData,this._headSize=t.headSize,this._rowcolAccessor=t.rowcolAccessor,this._slideOperateFeature=t.slideOperateFeature}return Object(a.a)(e,[{key:"scrollByPixel",value:function(e){var t=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,a=0,o=0,i=0,s=0,l={flow:!1,frozen:!1};if(void 0!==(null===e||void 0===e?void 0:e.diffX))switch(null===e||void 0===e?void 0:e.areaX){case"flow":a=e.diffX;break;case"frozen":i=e.diffX}if(void 0!==(null===e||void 0===e?void 0:e.diffY))switch(null===e||void 0===e?void 0:e.areaY){case"flow":o=e.diffY;break;case"frozen":s=e.diffY}this._scroll({diffX:a,diffY:o},r,(function(){l.flow=!0,!l.frozen&&t._slideOperateFeature||null===n||void 0===n||n()})),this._slideOperateFeature&&this.scrollOfFrozen({diffFrozenX:i,diffFrozenY:s},(function(){l.frozen=!0,l.flow&&(null===n||void 0===n||n())}))}},{key:"scrollToRenderFrom",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,n=0,a=0;if(void 0!==e.row&&e.row>=this._areaData.row.flow.from){if(e.row>this._areaData.row.flow.to)throw new Error("row\u8d8a\u754c\uff0c\u65e0\u6cd5\u5b9a\u4f4d");var o=this._areaData.getAreaTopByRow(e.row);a=o-this._areaData.row.flow.offsetSize}if(void 0!==e.col&&e.col>=this._areaData.col.flow.from){if(e.col>this._areaData.col.flow.to)throw new Error("col\u8d8a\u754c\uff0c\u65e0\u6cd5\u5b9a\u4f4d");var i=this._areaData.getAreaLeftByCol(e.col);n=i-this._areaData.col.flow.offsetSize}this._scroll({diffX:n,diffY:a},t,r)}},{key:"scrollToVisible",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,n=0,a=0,o=void 0===e.x?0:e.x,i=void 0===e.y?0:e.y;if(void 0!==e.row&&e.row>=this._areaData.row.flow.from){if(e.row>this._areaData.row.flow.to)throw new Error("row \u8d8a\u754c\uff0c\u65e0\u6cd5\u5b9a\u4f4d");if(e.row<=this._areaData.row.flow.renderFrom){var s=this._areaData.getAreaTopByRow(e.row);a=s-i-this._areaData.row.flow.offsetSize}else{var l=this._areaData.getAreaTopByRow(e.row);if(l>=this._areaData.getAreaTopByRow(this._areaData.row.flow.renderTo)){var c=this._areaData.getAreaTopByRow(e.row+1);a=c+i-this._areaData.row.flow.viewSize-this._areaData.row.flow.offsetSize,a+=this._areaData.row.flow.padding,a=Math.max(0,a)}}}if(void 0!==e.col&&e.col>=this._areaData.col.flow.from){if(e.col>this._areaData.col.flow.to)throw new Error("col\u8d8a\u754c\uff0c\u65e0\u6cd5\u5b9a\u4f4d");if(e.col<=this._areaData.col.flow.renderFrom){var u=this._areaData.getAreaLeftByCol(e.col);n=u-o-this._areaData.col.flow.offsetSize}else{var d=this._areaData.getAreaLeftByCol(e.col);if(d>=this._areaData.getAreaLeftByCol(this._areaData.col.flow.renderTo)){var h=this._areaData.getAreaLeftByCol(e.col+1);n=h+o-this._areaData.col.flow.viewSize-this._areaData.col.flow.offsetSize,n+=this._areaData.col.flow.padding,n=Math.max(0,n)}}}this._scroll({diffX:n,diffY:a},t,r)}},{key:"scrollToDistanceAnchor",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,n=e.row,a=e.col,o=e.left,i=void 0===o?0:o,s=e.top,l=void 0===s?0:s;if(this._areaData.row.frozen.isValid()||this._areaData.col.frozen.isValid())this.scrollToVisible({row:n,col:a},t,r);else{var c=0,u=0;if(void 0!==n&&n>=this._areaData.row.flow.from){if(n>this._areaData.row.flow.to)throw new Error("row \u8d8a\u754c\uff0c\u65e0\u6cd5\u5b9a\u4f4d");var d=this._areaData.getAreaTopByRow(n)-l;u=d-this._areaData.row.flow.offsetSize}if(void 0!==a&&a>=this._areaData.col.flow.from){if(a>this._areaData.col.flow.to)throw new Error("col \u8d8a\u754c\uff0c\u65e0\u6cd5\u5b9a\u4f4d");var h=this._areaData.getAreaLeftByCol(a)-i;c=h-this._areaData.col.flow.offsetSize}this._scroll({diffX:c,diffY:u},t,r)}}},{key:"scrollOfFrozen",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=e.diffFrozenX,a=e.diffFrozenY;null===(t=this._slideOperateFeature)||void 0===t||t.handleSlide({x:-n,y:-a},!0),r()}},{key:"_scroll",value:function(e,t,r){var n=this,a=e.diffX,o=e.diffY;if(0!==a||0!==o){if(t)return this._areaData.row.flow.offsetSize+=o,this._areaData.col.flow.offsetSize+=a,void(null===r||void 0===r||r());var i=function(e,t){var r=Math.abs(e||t);if(0===r)return 8;var n=8+r/(window.innerHeight/2)*8;return Math.min(16,Math.max(8,Math.round(n)))}(a,o),s=Math.abs(a)>Math.abs(o)?a:o,l=0,c=0;!function(e,t,r,n,a){if(e!==t){r=r||2;var o=e;!function i(){if(o+=(t-e)/r,Math.abs(o)>Math.abs(t)-5)return n(t),void(null===a||void 0===a||a());n(o),requestAnimationFrame(i)}()}}(0,s,i,(function(e){var t=e/s*a-l,r=e/s*o-c;n._areaData.row.flow.offsetSize+=r,n._areaData.col.flow.offsetSize+=t,l+=t,c+=r}),(function(){null===r||void 0===r||r()}))}else null===r||void 0===r||r()}}]),e}();!function(e){e[e.NORMAL=0]="NORMAL",e[e.FORMULA=1]="FORMULA"}(or||(or={}));var sr=function(){function e(t){Object(n.a)(this,e),this._formulaSelectData=t.formulaSelectData,this._normalSelectData=t.normalSelectData,this._rowcolAccessor=t.rowcolAccessor}return Object(a.a)(e,[{key:"selectAll",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:or.NORMAL,t=e===or.NORMAL?this._normalSelectData:this._formulaSelectData;this._clearSelectData(t);var r={col:0,row:0},n={activation:r};t.addSelection(n)}},{key:"selectCells",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:or.NORMAL,r=t===or.NORMAL?this._normalSelectData:this._formulaSelectData;this._clearSelectData(r);var n={col:e.xRange[0],row:e.yRange[0]},a={xRange:e.xRange,yRange:e.yRange,activation:n};r.addSelection(a)}},{key:"selectRows",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:or.NORMAL,r=t===or.NORMAL?this._normalSelectData:this._formulaSelectData;this._clearSelectData(r);var n={col:0,row:e[0]},a={yRange:e,activation:n};r.addSelection(a)}},{key:"selectCols",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:or.NORMAL,r=t===or.NORMAL?this._normalSelectData:this._formulaSelectData;this._clearSelectData(r);var n={col:e[0],row:0},a={xRange:e,activation:n};r.addSelection(a)}},{key:"getSelectedRows",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:or.NORMAL,t=e===or.NORMAL?this._normalSelectData:this._formulaSelectData;return Object(zt.p)(this._rowcolAccessor,t.selectQueue)}},{key:"getSelectedCols",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:or.NORMAL,t=e===or.NORMAL?this._normalSelectData:this._formulaSelectData;return Object(zt.n)(this._rowcolAccessor,t.selectQueue)}},{key:"_clearSelectData",value:function(e){e.resetSelection(),e==this._formulaSelectData&&e.clear()}},{key:"normalSelectData",get:function(){return this._normalSelectData}},{key:"formulaSelectData",get:function(){return this._formulaSelectData}}]),e}(),lr=(r("./src/core/view/level-1/freeze-line/FreezeLine.less"),function e(t){var r=this;Object(n.a)(this,e),this._areaData=t.areaData,this._headSize=t.headSize,this._renderApi=t.renderApi,this._alloyExcel=t.alloyExcel,this._renderApi.onAfterRender((function(){0!==r._areaData.col.frozen.displayViewSize&&(r._alloyExcel.ctx.beginPath(),r._alloyExcel.ctx.fillStyle="#d6d6d6",r._alloyExcel.ctx.rect(r._headSize.rowHeadWidth+r._areaData.col.frozen.viewSize-u.k,0,u.k,r._headSize.colHeadHeight+r._areaData.getViewBottomByRow(r._areaData.getLastRowInView())),r._alloyExcel.ctx.fill(),r._alloyExcel.ctx.closePath()),0!==r._areaData.row.frozen.displayViewSize&&(r._alloyExcel.ctx.beginPath(),r._alloyExcel.ctx.fillStyle="#d6d6d6",r._alloyExcel.ctx.rect(0,r._headSize.colHeadHeight+r._areaData.row.frozen.viewSize-u.k,r._headSize.rowHeadWidth+r._areaData.getViewRightByCol(r._areaData.getLastColInView()),u.k),r._alloyExcel.ctx.fill(),r._alloyExcel.ctx.closePath())}))}),cr=function(){function e(t){Object(n.a)(this,e),this._selectData=t.selectData,this._dataCallView=t.dataCallView,this._rowcolAccessor=t.rowcolAccessor,this._dataCallView.onMergeUnmerge(this._updateSelectDataByMerge.bind(this)),this._dataCallView.onInsertCol(this._updateSelectDataByInsertCol.bind(this)),this._dataCallView.onInsertRow(this._updateSelectDataByInsertRow.bind(this)),this._dataCallView.onDeleteCol(this._updateSelectDataByDeleteCol.bind(this)),this._dataCallView.onDeleteRow(this._updateSelectDataByDeleteRow.bind(this))}return Object(a.a)(e,[{key:"_updateSelectDataByMerge",value:function(e){for(var t=e.startRow,r=e.endRow,n=e.startCol,a=e.endCol,o=this._selectData.selectQueue,i=0;i<o.length;i++){var s=o[i];s instanceof Jt.a&&r>=s.yRange[0]&&t<=s.yRange[1]&&a>=s.xRange[0]&&n<=s.xRange[1]&&this._selectData.updateSelection(i,s)}}},{key:"_updateSelectDataByInsertCol",value:function(e){for(var t=e.index,r=e.amount,n=this._selectData.selectQueue,a=0;a<n.length;a++){var o=n[a],i=!1;(o instanceof Zt.a||o instanceof Jt.a)&&(t<=o.xRange[0]&&(i=!0,o.xRange[0]+=r),t<=o.xRange[1]&&(i=!0,o.xRange[1]+=r),i&&this._selectData.updateSelection(a,o))}}},{key:"_updateSelectDataByInsertRow",value:function(e){for(var t=e.index,r=e.amount,n=this._selectData.selectQueue,a=0;a<n.length;a++){var o=n[a],i=!1;(o instanceof Qt.a||o instanceof Jt.a)&&(t<=o.yRange[0]&&(i=!0,o.yRange[0]+=r),t<=o.yRange[1]&&(i=!0,o.yRange[1]+=r),i&&this._selectData.updateSelection(a,o))}}},{key:"_updateSelectDataByDeleteCol",value:function(e){for(var t=e.index,r=e.amount,n=this._selectData.selectQueue,a=0;a<n.length;a++){var o=n[a],i=!1;(o instanceof Zt.a||o instanceof Jt.a)&&(t<=o.xRange[0]&&(i=!0,o.xRange[0]=Math.min(this._rowcolAccessor.getColCount()-1,Math.max(t,o.xRange[0]-r))),t<=o.xRange[1]&&(i=!0,o.xRange[1]=Math.min(this._rowcolAccessor.getColCount()-1,Math.max(t,o.xRange[1]-r))),i&&this._selectData.updateSelection(a,o))}}},{key:"_updateSelectDataByDeleteRow",value:function(e){for(var t=e.index,r=e.amount,n=this._selectData.selectQueue,a=0;a<n.length;a++){var o=n[a],i=!1;(o instanceof Qt.a||o instanceof Jt.a)&&(t<=o.yRange[0]&&(i=!0,o.yRange[0]=Math.min(this._rowcolAccessor.getRowCount()-1,Math.max(t,o.yRange[0]-r))),t<=o.yRange[1]&&(i=!0,o.yRange[1]=Math.min(this._rowcolAccessor.getRowCount()-1,Math.max(t,o.yRange[1]-r))),i&&this._selectData.updateSelection(a,o))}}}]),e}();function ur(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var dr,hr=function(e){Object(i.a)(r,e);var t=ur(r);function r(e){return Object(n.a)(this,r),t.call(this,e)}return Object(a.a)(r,[{key:"_updateSelectDataByInsertCol",value:function(e){var t=e.index,n=e.amount,a=this._selectData.activation;a&&t<=a.col&&(a.col+=n),Object(o.a)(Object(l.a)(r.prototype),"_updateSelectDataByInsertCol",this).call(this,e)}},{key:"_updateSelectDataByInsertRow",value:function(e){var t=e.index,n=e.amount,a=this._selectData.activation;a&&t<=a.row&&(a.row+=n),Object(o.a)(Object(l.a)(r.prototype),"_updateSelectDataByInsertRow",this).call(this,e)}},{key:"_updateSelectDataByDeleteCol",value:function(e){var t=e.index,n=e.amount,a=this._selectData.activation;a&&t<=a.col&&(a.col=Math.min(this._rowcolAccessor.getColCount()-1,Math.max(t,a.col-n))),Object(o.a)(Object(l.a)(r.prototype),"_updateSelectDataByDeleteCol",this).call(this,e)}},{key:"_updateSelectDataByDeleteRow",value:function(e){var t=e.index,n=e.amount,a=this._selectData.activation;a&&t<=a.row&&(a.row=Math.min(this._rowcolAccessor.getRowCount()-1,Math.max(t,a.row-n))),Object(o.a)(Object(l.a)(r.prototype),"_updateSelectDataByDeleteRow",this).call(this,e)}}]),r}(cr);!function(e){e[e.MOVE=0]="MOVE",e[e.SCALE=1]="SCALE"}(dr||(dr={}));var fr,pr=function(){function e(){Object(n.a)(this,e),this.firstFinger={x:0,y:0},this.secondFinger={x:0,y:0},this.center={x:0,y:0}}return Object(a.a)(e,[{key:"startFirstFinger",value:function(e,t){this.mode=dr.MOVE,this.firstFinger.x=e,this.firstFinger.y=t}},{key:"startSecondFinger",value:function(e,t){this.mode=dr.SCALE;var r=this.firstFinger.x,n=this.firstFinger.y,a=e;this.secondFinger.x=e;var o=t;this.secondFinger.y=t,this.center.x=(r+a)/2,this.center.y=(n+o)/2,this.fingersDis=Math.sqrt((a-r)*(a-r)+(o-n)*(o-n))}},{key:"moveFirstFinger",value:function(e,t){this.firstFinger.x=e,this.firstFinger.y=t}},{key:"moveSecondFinger",value:function(e,t){var r=this.firstFinger.x,n=this.firstFinger.y,a=e;this.secondFinger.x=e;var o=t;this.secondFinger.y=t;var i=Math.sqrt((a-r)*(a-r)+(o-n)*(o-n));this.zoom=i/this.fingersDis}},{key:"end",value:function(){this.firstFinger.x=0,this.secondFinger.x=0,this.center.x=0,this.center.y=0,this.fingersDis=0}}]),e}(),_r=function(){function e(t){Object(n.a)(this,e),this.customInfo=new Map,this.startX=0,this.startY=0,this.startCol=0,this.startRow=0,this.currX=0,this.currY=0,this.currCol=0,this.currRow=0,this.diffX=0,this.diffY=0,this.startTime=0,this.endTime=0,this.fingerData=new pr,this.down=!1,this._stopPropagation=!1,this.isMovingRowOrCol=!1,this.preventAutoTapFocus=!1,this._scale=t.scale}return Object(a.a)(e,[{key:"mouseDown",value:function(e,t,r,n,a){this._start(e,t,r,n),this.e=a}},{key:"mouseMove",value:function(e,t,r,n,a){this._move(e,t,r,n),this.e=a}},{key:"mouseUp",value:function(e,t,r,n,a){this._end(e,t,r,n),this.e=a}},{key:"touchStart",value:function(e,t,r,n,a){this._start(e,t,r,n),this.fingerData.startFirstFinger(e,t),this.e=a}},{key:"touchSecondFingerStart",value:function(e,t){this.fingerData.startSecondFinger(e,t)}},{key:"touchMove",value:function(e,t,r,n,a){this._move(e,t,r,n),this.fingerData.moveFirstFinger(e,t),this.e=a}},{key:"touchSecondFingerMove",value:function(e,t){this.fingerData.moveSecondFinger(e,t)}},{key:"touchEnd",value:function(e,t,r,n,a){this._end(e,t,r,n),this.e=a}},{key:"isHoverCell",value:function(){return-1!==this.currCol&&this.currCol!==Number.MAX_SAFE_INTEGER&&this.currCol!==Number.MIN_SAFE_INTEGER&&(-1!==this.currRow&&this.currRow!==Number.MAX_SAFE_INTEGER&&this.currRow!==Number.MIN_SAFE_INTEGER)}},{key:"isHoverCol",value:function(){return-1===this.currRow&&-1!==this.currCol}},{key:"isHoverRow",value:function(){return-1===this.currCol&&-1!==this.currRow}},{key:"isOverTable",value:function(){return this.currCol===Number.MAX_SAFE_INTEGER||this.currCol===Number.MIN_SAFE_INTEGER||(this.currRow===Number.MAX_SAFE_INTEGER||this.currRow===Number.MIN_SAFE_INTEGER)}},{key:"_start",value:function(e,t,r,n){this.stopPropagation=!1,this.customInfo.clear(),this.currX=e,this.startX=e,this.currY=t,this.startY=t,this.currCol=r,this.startCol=r,this.currRow=n,this.startRow=n,this.down=!0,this.preventAutoTapFocus=!1,this.startTime=Date.now()}},{key:"_move",value:function(e,t,r,n){this.diffX=e-this.currX,this.diffY=t-this.currY,this.currX=e,this.currY=t,this.currCol=r,this.currRow=n}},{key:"_end",value:function(e,t,r,n){this.currX=e,this.currY=t,this.currCol=r,this.currRow=n,this.down=!1,this.isMovingRowOrCol=!1,this.endTime=Date.now()}},{key:"displayStartX",get:function(){return this.startX*this._scale.scale}},{key:"displayStartY",get:function(){return this.startY*this._scale.scale}},{key:"displayCurrX",get:function(){return this.currX*this._scale.scale}},{key:"displayCurrY",get:function(){return this.currY*this._scale.scale}},{key:"stopPropagation",get:function(){return this._stopPropagation},set:function(e){this._stopPropagation=e}}]),e}(),mr=r("./src/base/report/fps.ts"),vr=function e(t,r){var a=this;Object(n.a)(this,e),this._endFps=Object(D.a)((function(){mr.a.end("fps_scroll"),a._wheelOperate.emitter.off(a._wheelOperate.EVENT.SCROLL,a._endFps),a._wheelOperate.emitter.once(a._wheelOperate.EVENT.SCROLL,a._startFps)}),100),this._handleScroll=function(e){a._areaData.row.flow.offsetSize-=e.y,a._areaData.col.flow.offsetSize-=e.x},this._startFps=function(){mr.a.start("fps_scroll"),a._wheelOperate.emitter.on(a._wheelOperate.EVENT.SCROLL,a._endFps)},this._wheelOperate=t,this._areaData=r.areaData,this._wheelOperate.emitter.on(this._wheelOperate.EVENT.SCROLL,this._handleScroll),this._wheelOperate.emitter.once(this._wheelOperate.EVENT.SCROLL,this._startFps)},gr=r("./src/core/view/level-1/operate-context/BaseOperate.ts"),br=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),yr=r.n(br),wr=r("../node_modules/@tencent/tdocs_support_bridge/lib/index.js");function Rr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}!function(e){e.X="x",e.Y="y"}(fr||(fr={}));var Er=function(e){Object(i.a)(r,e);var t=Rr(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this))._ipadWheelData={startX:0,startY:0,currX:0,currY:0,diffX:0,diffY:0,startTime:0,endTime:0},a._cacheData={x:0,y:0},a._handleWheel=function(e){switch(e.state){case"begin":a._handleWheelStart(e);break;case"change":a._handleWheelMove(e);break;case"end":a._handleWheelEnd()}},a._handleWheelStart=function(e){cancelAnimationFrame(a._tick),a._ipadWheelData.startX=e["location.x"],a._ipadWheelData.startY=e["location.y"],a._ipadWheelData.currX=e["location.x"],a._ipadWheelData.currY=e["location.y"],a._ipadWheelData.startTime=Date.now()},a._handleWheelMove=function(e){a._ipadWheelData.diffX=e["location.x"]-a._ipadWheelData.currX,a._ipadWheelData.diffY=e["location.y"]-a._ipadWheelData.currY,a._ipadWheelData.currX=e["location.x"],a._ipadWheelData.currY=e["location.y"],a._cacheData.x=a._ipadWheelData.diffX,a._cacheData.y=a._ipadWheelData.diffY,a.emitter.emit(r.EVENT.SLIDE,a._cacheData)},a._handleWheelEnd=function(){if(a._ipadWheelData.endTime=Date.now(),a._ipadWheelData.endTime-a._ipadWheelData.startTime<300){var e=Math.abs(a._ipadWheelData.currX-a._ipadWheelData.startX)>Math.abs(a._ipadWheelData.currY-a._ipadWheelData.startY)?fr.X:fr.Y;a._inertiaScroll(e,"WHEEL")}},a._handleTouchstart=function(){cancelAnimationFrame(a._tick),a._touchOperate.emitter.on(a._touchOperate.EVENT.MOVE,a._handleTouchmove),a._touchOperate.emitter.on(a._touchOperate.EVENT.UP,a._handleTouchend),wr.a.sendEvent("sheet","sheet_r_start_slide")},a._handleTouchmove=function(){a._touchData.fingerData.mode===dr.MOVE&&(Math.abs(a._touchData.diffX)>Math.abs(a._touchData.diffY)?(a._cacheData.x=a._touchData.diffX,a._cacheData.y=0):(a._cacheData.x=0,a._cacheData.y=a._touchData.diffY),a.emitter.emit(r.EVENT.SLIDE,a._cacheData))},a._handleTouchend=function(){if(a._touchData.fingerData.mode===dr.MOVE&&a._touchData.endTime-a._touchData.startTime<300){var e=Math.abs(a._touchData.diffX)>Math.abs(a._touchData.diffY)?fr.X:fr.Y;a._inertiaScroll(e)}a._touchOperate.emitter.off(a._touchOperate.EVENT.MOVE,a._handleTouchmove),a._touchOperate.emitter.off(a._touchOperate.EVENT.UP,a._handleTouchend),wr.a.sendEvent("sheet","sheet_r_end_slide")},a._touchData=e.touchData,a._touchOperate=e.touchOperate,a._container=e.container,a.bind(),a}return Object(a.a)(r,[{key:"bind",value:function(){var e,t=this;(this._container.addEventListener("touchstart",this._handleTouchstart),this._container.addEventListener("mousedown",(function(){cancelAnimationFrame(t._tick)})),yr.a.isIPad&&yr.a.isTencentDocsApp)&&(null===(e=window.mqq)||void 0===e||e.addEventListener("ipadWheelEvent",this._handleWheel))}},{key:"unbind",value:function(){var e;(this._container.removeEventListener("touchstart",this._handleTouchstart),yr.a.isIPad&&yr.a.isTencentDocsApp)&&(null===(e=window.mqq)||void 0===e||e.removeEventListener("ipadWheelEvent",this._handleWheel))}},{key:"cancelAnimationFrame",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){cancelAnimationFrame(this._tick)}))},{key:"_inertiaScroll",value:function(e){var t,n=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"TOUCH",o="TOUCH"===a?this._touchData:this._ipadWheelData,i=6e-4,s=.8,l=1,c=o.endTime-o.startTime;if(t=e===fr.X?o.currX-o.startX:o.currY-o.startY,!(Math.abs(t)<5)){var u=t/c,d=s*u,h=0+d*d/(2*i)*(t<0?-1:1),f=Math.abs(Math.round(u/i)*l),p=0;this._to(h,f,(function(t){n._cacheData[e]=t-p,n.emitter.emit(r.EVENT.SLIDE,n._cacheData),p=t}))}}},{key:"_to",value:function(e,t,r){var n,a=this,o=Date.now();!function i(){var s,l=Date.now()-o;l>=t?r(n):(n=e*(s=l/t,Math.sqrt(1-Math.pow(s-1,2))),a._tick=requestAnimationFrame(i),l>0&&r(n))}()}},{key:"EVENT",get:function(){return r.EVENT}}]),r}(gr.a);Er.EVENT={SLIDE:"slide"};var Cr=Er,jr=function e(t,r){var a=this;Object(n.a)(this,e),this._endFps=Object(D.a)((function(){mr.a.end("fps_scroll"),a._slideOperate.emitter.off(a._slideOperate.EVENT.SLIDE,a._endFps),a._slideOperate.emitter.once(a._slideOperate.EVENT.SLIDE,a._startFps)}),100),this._handleSlide=function(e){a._areaData.row.flow.offsetSize-=e.y,a._areaData.col.flow.offsetSize-=e.x},this._startFps=function(){mr.a.start("fps_scroll"),a._slideOperate.emitter.on(a._slideOperate.EVENT.SLIDE,a._endFps)},this._slideOperate=t,this._areaData=r.areaData,this._slideOperate.emitter.on(this._slideOperate.EVENT.SLIDE,this._handleSlide),this._slideOperate.emitter.once(this._slideOperate.EVENT.SLIDE,this._startFps)},Or=(r("./src/core/view/level-1/selection-stage/selection-ui/pc/MultipleSelection.less"),function(){function e(t){Object(n.a)(this,e),this._element=document.createElement("div"),this._ac=document.createElement("div"),this._stopPropagation=function(e){2==e.button&&e.stopPropagation()},this._element.classList.add("multiple-selection"),this._ac.classList.add("multiple-selection-active"),this._element.addEventListener("mousedown",this._stopPropagation),this._element.appendChild(this._ac),this.setAttribute(t)}return Object(a.a)(e,[{key:"setAttribute",value:function(e){var t;if(e.padding){this._ac.style.display="block";var r=e.padding;t="".concat(r[0],"px ").concat(r[1],"px ").concat(r[2],"px ").concat(r[3],"px")}else this._ac.style.display="none",t="0px 0px 0px ".concat(e.width-1,"px");var n=e.display,a=void 0===n||n;Object.assign(this._element.style,{left:"".concat(e.left,"px"),top:"".concat(e.top,"px"),width:"".concat(Math.max(0,e.width-1),"px"),height:"".concat(Math.max(0,e.height-1),"px"),"border-width":t,display:"".concat(a?"block":"none")})}}],[{key:"newInstance",value:function(t,r){var n=e.pools.pop();return n?n.setAttribute(r):n=new e(r),t.appendChild(n._element),n}},{key:"destroy",value:function(t){t._element.remove(),e.pools.push(t)}}]),e}());Or.pools=[];var Sr=Or,Dr=function(){function e(t){Object(n.a)(this,e),this._multipleSelections=[],this._board=t}return Object(a.a)(e,[{key:"size",value:function(){return this._multipleSelections.length}},{key:"clear",value:function(){for(var e;e=this._multipleSelections.pop();)Sr.destroy(e)}},{key:"remove",value:function(e){var t=this._multipleSelections[e];void 0!==t?(this._multipleSelections.splice(e,1),Sr.destroy(t)):console.error("can't find multiple selection by index: ",e)}},{key:"add",value:function(e){this._multipleSelections.push(Sr.newInstance(this._board,e))}},{key:"update",value:function(e,t){var r=this._multipleSelections[e];void 0!==r?r.setAttribute(t):console.error("can't find multiple selection by index: ",e)}}]),e}(),xr=(r("./src/core/view/level-1/selection-stage/selection-ui/pc/SingleSelection.less"),function(){function e(){Object(n.a)(this,e),this._element=document.createElement("div"),this._element.classList.add("single-selection")}return Object(a.a)(e,[{key:"setAttribute",value:function(e){var t;if(e.padding){var r=e.padding;t="".concat(r[0],"px ").concat(r[1],"px ").concat(r[2],"px ").concat(r[3],"px")}else t="0px 0px 0px ".concat(e.width-3,"px");var n=e.display,a=void 0===n||n;Object.assign(this._element.style,{left:"".concat(e.left,"px"),top:"".concat(e.top,"px"),width:"".concat(Math.max(0,e.width-1),"px"),height:"".concat(Math.max(0,e.height-1),"px"),"border-width":t,display:"".concat(a?"block":"none")})}},{key:"show",value:function(){this._element.style.display="block"}},{key:"hide",value:function(){this._element.style.display="none"}}],[{key:"newInstance",value:function(t){var r=e.pools.pop();return r||(r=new e),t.appendChild(r._element),r}},{key:"destroy",value:function(t){t._element.remove(),e.pools.push(t)}}]),e}());xr.pools=[];var kr,Tr=xr,Ar=r("./src/core/view/level-1/selection-stage/smart-corner/SmartCorner.ts"),Ir=function(){function e(t){Object(n.a)(this,e),this._board=t,this._normalSelection=Tr.newInstance(this._board),this._smartCorner=new Ar.a(this._board)}return Object(a.a)(e,[{key:"hide",value:function(){this._smartCorner.hide(),this._normalSelection.hide()}},{key:"show",value:function(){this._smartCorner.show(),this._normalSelection.show()}},{key:"update",value:function(e){this._left=e.left,this._top=e.top,this._width=e.width,this._height=e.height,this._smartCorner.setAttribute(e),this._normalSelection.setAttribute(e)}},{key:"left",get:function(){return this._left}},{key:"top",get:function(){return this._top}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"smartCorner",get:function(){return this._smartCorner}}]),e}(),Nr=function e(t){Object(n.a)(this,e),this._board=document.createElement("div"),this._blockBoard=t.blockBoard,this._blockBoard.hiddenBoard.element.appendChild(this._board)};function Lr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}!function(e){e[e.EMPTY=0]="EMPTY",e[e.USING_SINGLE=1]="USING_SINGLE",e[e.USING_MULTIPLE=2]="USING_MULTIPLE"}(kr||(kr={}));var Pr=function(e){Object(i.a)(r,e);var t=Lr(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e))._normalSelectionStatus=kr.EMPTY,a._changePermission=function(){a._sheetStatus.canEdit?a._singleSelectionApi.smartCorner.setValid(!0):a._singleSelectionApi.smartCorner.setValid(!1)},a._sheetStatus=e.sheetStatus,a._board.classList.add("selection-stage-board"),a._singleSelectionApi=new Ir(a._board),a._multipleSelectionApi=new Dr(a._board),a._sheetStatus.change(a._changePermission),a._changePermission(),a}return Object(a.a)(r,[{key:"addSelection",value:function(e,t,r){var n={left:e.left-this._blockBoard.offsetX,top:e.top-this._blockBoard.offsetY,width:e.width,height:e.height,padding:e.padding,display:r};this._normalSelectionStatus===kr.EMPTY?(this._singleSelectionApi.update(n),this._singleSelectionApi.show(),this._normalSelectionStatus=kr.USING_SINGLE):this._normalSelectionStatus===kr.USING_SINGLE?(this._singleSelectionApi.hide(),this._multipleSelectionApi.add({left:this._singleSelectionApi.left,top:this._singleSelectionApi.top,width:this._singleSelectionApi.width,height:this._singleSelectionApi.height}),this._multipleSelectionApi.add(n),this._normalSelectionStatus=kr.USING_MULTIPLE):this._multipleSelectionApi.add(n)}},{key:"updateSelection",value:function(e,t,r,n){var a={left:t.left-this._blockBoard.offsetX,top:t.top-this._blockBoard.offsetY,width:t.width,height:t.height,padding:t.padding,display:n};this._normalSelectionStatus===kr.USING_MULTIPLE?this._multipleSelectionApi.update(e,a):this._normalSelectionStatus===kr.USING_SINGLE&&this._singleSelectionApi.update(a)}},{key:"removeSelection",value:function(e){this._normalSelectionStatus===kr.USING_MULTIPLE?this._multipleSelectionApi.remove(e):this._normalSelectionStatus===kr.USING_SINGLE&&this._singleSelectionApi.hide()}},{key:"resetSelection",value:function(){this._multipleSelectionApi.clear(),this._singleSelectionApi.hide(),this._normalSelectionStatus=kr.EMPTY}},{key:"show",value:function(){this._board.style.display="block"}},{key:"hide",value:function(){this._board.style.display="none"}},{key:"singleSelectionApi",get:function(){return this._singleSelectionApi}}]),r}(Nr),Mr=(r("./src/core/view/level-1/selection-stage/selection-ui/pc/FormulaSelection.less"),["#f7981d","#7e3794","#11a9cc","#a61d4c","#4285f4","#f4b400","#65b045","#795548","#999999","#f1ca3a","#3f5ca9","#c3d03f"]),Vr=function(){function e(t){Object(n.a)(this,e),this._element=document.createElement("div"),this._element.classList.add("formula-selection"),this.setAttribute(t)}return Object(a.a)(e,[{key:"setAttribute",value:function(e){var t=Mr[e.index%Mr.length],r=e.display,n=void 0===r||r;(e.width<0||e.height<0)&&(n=!1),Object.assign(this._element.style,{left:"".concat(e.left,"px"),top:"".concat(e.top,"px"),width:"".concat(e.width,"px"),height:"".concat(e.height,"px"),"border-color":t,display:"".concat(n?"block":"none")})}}],[{key:"newInstance",value:function(t,r){var n=e.pools.pop();return n?n.setAttribute(r):n=new e(r),t.appendChild(n._element),n}},{key:"destroy",value:function(t){t._element.remove(),e.pools.push(t)}}]),e}();Vr.pools=[];var zr=Vr,Br=function(){function e(t){Object(n.a)(this,e),this._formulaSelections=[],this._board=t}return Object(a.a)(e,[{key:"clear",value:function(){for(var e;e=this._formulaSelections.pop();)zr.destroy(e)}},{key:"remove",value:function(e){var t=this._formulaSelections[e];void 0!==t?(this._formulaSelections.splice(e,1),zr.destroy(t)):console.error("can't find formula selection by index: ",e)}},{key:"add",value:function(e){e.index=this._formulaSelections.length,this._formulaSelections.push(zr.newInstance(this._board,e))}},{key:"update",value:function(e,t){t.index=e;var r=this._formulaSelections[e];void 0!==r?r.setAttribute(t):console.error("can't find multiple selection by index: ",e)}}]),e}();function Fr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var Hr=function(e){Object(i.a)(r,e);var t=Fr(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e))._board.classList.add("selection-stage-board"),a._formulaSelectionApi=new Br(a._board),a}return Object(a.a)(r,[{key:"addSelection",value:function(e,t,r){var n={left:e.left-this._blockBoard.offsetX,top:e.top-this._blockBoard.offsetY,width:e.width,height:e.height,padding:e.padding,display:r};this._formulaSelectionApi.add(n)}},{key:"updateSelection",value:function(e,t,r,n){var a={left:t.left-this._blockBoard.offsetX,top:t.top-this._blockBoard.offsetY,width:t.width,height:t.height,padding:t.padding,display:n};this._formulaSelectionApi.update(e,a)}},{key:"removeSelection",value:function(e){this._formulaSelectionApi.remove(e)}},{key:"resetSelection",value:function(){this._formulaSelectionApi.clear()}},{key:"show",value:function(){this._board.style.display="block"}},{key:"hide",value:function(){this._board.style.display="none"}},{key:"formulaSelectionApi",get:function(){return this._formulaSelectionApi}}]),r}(Nr),Ur=(r("./src/core/view/level-1/shape-stage/image/BaseImage.less"),r("./src/core/utils/ImageLoader.ts")),Wr=function(){function e(t,r,a){var o;Object(n.a)(this,e),this._wrap=document.createElement("div"),this._imageBox=document.createElement("div"),this._handleLoadSuccess=function(){},this._handleLoadFail=function(){},this.emitter=new tr.a,this._container=t,this._propLeft=r.left,this._propTop=r.top,this._propWidth=r.width,this._propHeight=r.height,this._propZIndex=r.zIndex,this._propClipInfo=r.clipInfo,this._propUrl=r.url,this._propDisplay=null===(o=r.display)||void 0===o||o,this._wrap.classList.add("shape-wrap"),this._imageBox.classList.add("shape-image-box"),this._setUrl(this._propUrl),this._container.appendChild(this._wrap),a&&(this._handleFocus=a)}return Object(a.a)(e,[{key:"setDatasetId",value:function(e){this._imageBox.dataset.id=e}},{key:"setProps",value:function(e){void 0!==e.left&&(this._propLeft=e.left),void 0!==e.top&&(this._propTop=e.top),void 0!==e.width&&(this._propWidth=e.width),void 0!==e.height&&(this._propHeight=e.height),void 0!==e.zIndex&&(this._propZIndex=e.zIndex),void 0!==e.clipInfo&&(this._propClipInfo=e.clipInfo),void 0!==e.display&&(this._propDisplay=e.display),this._update()}},{key:"destroy",value:function(){this._wrap.remove()}},{key:"_handleFocus",value:function(e){}},{key:"_setUrl",value:function(){var e=Object(P.a)(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ur.a.loadImage(t,!0);case 2:r=e.sent,this._image=r,this._imageBox.appendChild(r),this._wrap.appendChild(this._imageBox),this._update();case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_update",value:function(){this._image&&(Object.assign(this._wrap.style,{width:"".concat(this._propWidth,"px"),height:"".concat(this._propHeight,"px"),left:"".concat(this._propLeft,"px"),top:"".concat(this._propTop,"px"),"z-index":e.DEFAULT_Z_INDEX+this._propZIndex,display:this._propDisplay?"block":"none"}),Object.assign(this._image.style,{top:"".concat(-this._propClipInfo.clipTop,"px"),left:"".concat(-this._propClipInfo.clipLeft,"px"),width:"".concat(this._propClipInfo.clipLeft+this._propWidth+this._propClipInfo.clipRight,"px"),height:"".concat(this._propClipInfo.clipTop+this._propHeight+this._propClipInfo.clipBottom,"px")}))}},{key:"wrap",get:function(){return this._wrap}}]),e}();function Gr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}Wr.imagesToLoad=0,Wr.failImageToReport=0,Wr.successImageToReport=0;var Yr=function(e){Object(i.a)(r,e);var t=Gr(r);function r(e,a,o){var i;return Object(n.a)(this,r),(i=t.call(this,e,a,o)).bindEvent(),i}return Object(a.a)(r,[{key:"bindEvent",value:function(){this._wrap.addEventListener("mousedown",this._handleFocus),this._wrap.addEventListener("contextmenu",D.c)}},{key:"unbindEvent",value:function(){this._wrap.removeEventListener("mousedown",this._handleFocus),this._wrap.removeEventListener("contextmenu",D.c)}}]),r}(Wr),Xr=(r("./src/core/view/level-1/operate-context/operate-board/OperateBoard.less"),function(){function e(t){Object(n.a)(this,e),this._board=document.createElement("div"),this._container=t.container,this._board.classList.add("operate-board"),this._board.setAttribute("tabIndex","3"),this._container.appendChild(this._board)}return Object(a.a)(e,[{key:"board",get:function(){return this._board}}]),e}());function Kr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var qr=function(e){Object(i.a)(r,e);var t=Kr(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this))._oldScale=0,a._scaleTo=Object(D.f)((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0};if(e!==a._scale.scale){var r=a._scale.scale,n=a._areaData.col.flow.offsetSize+t.x/r*a._oldScale,o=a._areaData.row.flow.offsetSize+t.y/r*a._oldScale;a._scale.scaleTo(e);var i=a._areaData.col.flow.offsetSize+t.x/e*a._oldScale,s=a._areaData.row.flow.offsetSize+t.y/e*a._oldScale,l=n-i,c=o-s;a._scrollApi.scrollByPixel({diffX:l,diffY:c,areaX:"flow",areaY:"flow"})}}),30),a._handleTouchstart=function(){a._touchData.fingerData.mode===dr.SCALE&&(a._oldScale=a._scale.scale,a.emitter.emit(r.EVENT.START_SCALE),a._touchOperate.emitter.on(Lt.a.EVENT.MOVE,a._handleTouchmove),a._touchOperate.emitter.on(Lt.a.EVENT.UP,a._handleTouchend))},a._handleTouchmove=function(){if(a._touchData.fingerData.mode===dr.SCALE){var e=a._touchData.fingerData.zoom*a._scale.scale;e=Math.min(2,Math.max(.5,e)),a._scaleTo(e,a._touchData.fingerData.center)}},a._handleTouchend=function(){a.emitter.emit(r.EVENT.END_SCALE),a._touchOperate.emitter.off(Lt.a.EVENT.MOVE,a._handleTouchmove),a._touchOperate.emitter.off(Lt.a.EVENT.UP,a._handleTouchend)},a._handleWheel=function(e){if(0!==e.deltaY&&(yr.a.isMac&&e.metaKey||!yr.a.isMac&&e.ctrlKey)){var t=-e.deltaY/Math.abs(e.deltaY);ft.c.sheetsBar.trigger("changeScale",10*t),e.stopPropagation(),e.preventDefault()}},a.emitter=new tr.a,a._scale=e.scale,a._areaData=e.areaData,a._touchOperate=e.touchOperate,a._touchData=e.touchData,a._scrollApi=e.scrollApi,a.bind(),a}return Object(a.a)(r,[{key:"bind",value:function(){this._touchOperate.emitter.on(Lt.a.EVENT.DOWN,this._handleTouchstart),window.addEventListener("wheel",this._handleWheel,{capture:!0,passive:!1})}},{key:"unbind",value:function(){this._touchOperate.emitter.on(Lt.a.EVENT.DOWN,this._handleTouchstart),window.removeEventListener("wheel",this._handleWheel,!0)}},{key:"EVENT",get:function(){return r.EVENT}}]),r}(gr.a);qr.EVENT={START_SCALE:"startScale",END_SCALE:"endScale"};var Qr=qr,Zr=r("./src/core/ui/dialog/index.ts"),Jr=r("../packages/model/src/range/DimensionRange.ts"),$r=r("../packages/model/src/dimension/DimensionType.ts");function en(e,t,r,n){for(var a={},o=0;o<n.length;o++)for(var i=n[o],s=i[0];s<=i[1];s++)if(void 0===a[s]){for(var l=0,c=0;c<t.getRowCount();c++){var u=r.getParagraph(c,s);if(u){var d=e.getCellViewAtPosition(c,s);if(!(null===d||void 0===d?void 0:d.mergeData)&&!(null===d||void 0===d?void 0:d.mergeParent)){var h=d?d.paddingLeft+d.paddingRight:0;l=Math.max(l,u.width+h)}}}0!==l&&(a[s]=l)}return a}var tn=r("../packages/report/src/index.ts"),rn=function(){function e(t){Object(n.a)(this,e),this._tableView=t.tableView,this._paragraphAccessor=t.paragraphAccessor,this._rowcolAccessor=t.rowcolAccessor,this._normalSelectData=t.normalSelectData,this._spreadsheet=t.spreadsheet}return Object(a.a)(e,[{key:"insertRow",value:function(e){this._spreadsheet.parent.requestApi.insertRows(e)}},{key:"insertCol",value:function(e){this._spreadsheet.parent.requestApi.insertColumns(e)}},{key:"removeRow",value:function(e){this._spreadsheet.parent.requestApi.deleteRows()}},{key:"removeCol",value:function(e){this._spreadsheet.parent.requestApi.deleteColumns()}},{key:"setRowHeight",value:function(e,t){for(var r=[],n=0;n<e.length;n++){var a=e[n];r.push(new Jr.a(this._spreadsheet.activeSheetId,a[0],a[1],$r.a.ROWS))}this._spreadsheet.parent.requestApi.resizeRows(r,t)}},{key:"setColWidth",value:function(e,t){for(var r=[],n=0;n<e.length;n++){var a=e[n];r.push(new Jr.a(this._spreadsheet.activeSheetId,a[0],a[1],$r.a.COLUMNS))}this._spreadsheet.parent.requestApi.resizeColumns(r,t)}},{key:"setColWidths",value:function(e,t){for(var r=[],n=0;n<e.length;n++){var a=e[n];r.push(new Jr.a(this._spreadsheet.activeSheetId,a[0],a[1],$r.a.COLUMNS))}this._spreadsheet.parent.requestApi.resizeColumns(r,t)}},{key:"showDialogForRowsSetting",value:function(){var e,t=this,r=this._normalSelectData.selectQueue,n="\u884c\u9ad8 ( \u9ed8\u8ba4\u503c: ".concat(u.r,"\u50cf\u7d20 )");if(this._normalSelectData.isSingle()){var a=r[0],o=[0,0];if(a.selectAll||a.selectCol)o[0]=0,o[1]=this._rowcolAccessor.getRowCount()-1;else{if(!a.selectRow&&!a.selectCell)throw new Error("\u4e0d\u53ef\u7528\u7684\u9009\u533a\u7c7b\u578b");o[0]=a.yRange[0],o[1]=a.yRange[1]}e=this._getDefaultRowSize(o),isNaN(e)&&(e="")}else e="";Object(Zr.inputDialog)({title:"\u8bbe\u7f6e\u884c\u9ad8",info:n,defaultValue:e,min:10,errorInfo:"\u6709\u6548\u8303\u56f4\uff1a".concat(10,"-1000"),callback:function(e){var r=Object(zt.p)(t._rowcolAccessor,t._normalSelectData.selectQueue);t.setRowHeight(r,e),r.forEach((function(e){var t=e[0]===e[1]?"menu_1row_size":"menu_nrow_size";tn.b.tdwReport({module:"excel_dimension",opername:"doc_excel_editor",action:t})}))}})}},{key:"showDialogForColsSetting",value:function(){var e,t=this,r=this._normalSelectData.selectQueue,n="\u5217\u5bbd ( \u9ed8\u8ba4\u503c: ".concat(u.g,"\u50cf\u7d20 )");if(this._normalSelectData.isSingle()){var a=r[0],o=[0,0];if(a.selectAll||a.selectRow)o[0]=0,o[1]=this._rowcolAccessor.getColCount()-1;else{if(!a.selectCol&&!a.selectCell)throw new Error("\u4e0d\u53ef\u7528\u7684\u9009\u533a\u7c7b\u578b");o[0]=a.xRange[0],o[1]=a.xRange[1]}e=this._getDefaultColSize(o),isNaN(e)&&(e="")}else e="";Object(Zr.inputDialog)({title:"\u8bbe\u7f6e\u5217\u5bbd",info:n,defaultValue:e,min:10,errorInfo:"\u6709\u6548\u8303\u56f4\uff1a".concat(10,"-1000"),callback:function(e){var r=Object(zt.n)(t._rowcolAccessor,t._normalSelectData.selectQueue);t.setColWidth(r,e),r.forEach((function(e){var t=e[0]===e[1]?"menu_1col_size":"menu_ncol_size";tn.b.tdwReport({module:"excel_dimension",opername:"doc_excel_editor",action:t})}))}})}},{key:"setRowHeightAutoFit",value:function(e){this.setRowHeight(e,void 0)}},{key:"setColWidthAutoFit",value:function(e){var t=en(this._tableView,this._rowcolAccessor,this._paragraphAccessor,e),r=[],n=[];for(var a in t)r.push([Number(a),Number(a)]),n.push(t[a]+1);this.setColWidths(r,n)}},{key:"setRowAndColAutoFit",value:function(e,t){for(var r=[],n=0;n<e.length;n++){var a=e[n];r.push({dimensionRange:new Jr.a(this._spreadsheet.activeSheetId,a[0],a[1],$r.a.ROWS),size:void 0})}var o=en(this._tableView,this._rowcolAccessor,this._paragraphAccessor,t),i=[];for(var s in o)i.push({dimensionRange:new Jr.a(this._spreadsheet.activeSheetId,Number(s),Number(s),$r.a.COLUMNS),size:o[s]});this._spreadsheet.parent.requestApi.resizeRowsColumns([].concat(r,i))}},{key:"setColWidthToDefault",value:function(e){this.setColWidth(e,u.g)}},{key:"moveRows",value:function(){var e=Object(P.a)(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Jr.a(this._spreadsheet.activeSheetId,t[0],t[1],$r.a.ROWS),e.abrupt("return",this._spreadsheet.parent.requestApi.moveRows(n,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"moveCols",value:function(){var e=Object(P.a)(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Jr.a(this._spreadsheet.activeSheetId,t[0],t[1],$r.a.COLUMNS),e.abrupt("return",this._spreadsheet.parent.requestApi.moveColumns(n,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"hideRows",value:function(e){var t=this._optionsToDiemsnionRanges(e,$r.a.ROWS);this._spreadsheet.parent.requestApi.hideRows(t)}},{key:"hideCols",value:function(e){var t=this._optionsToDiemsnionRanges(e,$r.a.COLUMNS);this._spreadsheet.parent.requestApi.hideColumns(t)}},{key:"showRows",value:function(e){var t=this._optionsToDiemsnionRanges(e,$r.a.ROWS);this._spreadsheet.parent.requestApi.showRows(t)}},{key:"showCols",value:function(e){var t=this._optionsToDiemsnionRanges(e,$r.a.COLUMNS);this._spreadsheet.parent.requestApi.showColumns(t)}},{key:"_getDefaultRowSize",value:function(e){for(var t=this._rowcolAccessor.getRowDisplayHeight(e[0]),r=e[0]+1;r<=e[1];r++)if(t!==this._rowcolAccessor.getRowDisplayHeight(r))return NaN;return t}},{key:"_getDefaultColSize",value:function(e){for(var t=this._rowcolAccessor.getColSetWidth(e[0]),r=e[0]+1;r<=e[1];r++)if(t!==this._rowcolAccessor.getColSetWidth(r))return NaN;return t}},{key:"_optionsToDiemsnionRanges",value:function(e,t){for(var r=[],n=0;n<e.length;n++){var a=e[n];r.push(new Jr.a(this._spreadsheet.activeSheetId,a.index,a.index+a.amount-1,t))}return r}}]),e}(),nn=r("../packages/model/src/embedded/EmbeddedObjectType.ts"),an=function(){function e(t){Object(n.a)(this,e),this._tableView=t.tableView,this._spreadsheet=t.spreadsheet}return Object(a.a)(e,[{key:"insertImage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._spreadsheet.parent.requestApi.addImage(e,t)}},{key:"updateShape",value:function(e,t){var r;this._spreadsheet.parent.requestApi.updateImage(Object.assign(t,{id:e,sheetId:this._spreadsheet.activeSheetId,type:(null===(r=this._spreadsheet.activeSheet.imageManager.getImage(e))||void 0===r?void 0:r.type)||nn.a.IMAGE}))}},{key:"deleteShape",value:function(e){this._spreadsheet.parent.requestApi.deleteImage({id:e,sheetId:this._spreadsheet.activeSheetId})}}]),e}(),on=function(){function e(){Object(n.a)(this,e)}return Object(a.a)(e,[{key:"setHyperlinkIconVisibility",value:function(e){var t=e.row,r=e.col,n=e.visibility;window.SpreadsheetApp.requestApi.setHyperlinkIconVisibility({row:t,col:r,visibility:n})}},{key:"setHyperlinkRuns",value:function(e){var t=e.row,r=e.col,n=e.linkValue,a=e.range;window.SpreadsheetApp.requestApi.setHyperlinkRuns({row:t,col:r,linkValue:n,range:a})}},{key:"cancelLink",value:function(e,t){window.SpreadsheetApp.requestApi.clearLink(e,t)}},{key:"insertLink",value:function(e,t,r,n){window.SpreadsheetApp.requestApi.setLink(n,r,e,t)}},{key:"insertHyperLink",value:function(e,t,r,n,a,o){window.SpreadsheetApp.requestApi.setHyperLink(n,r,a,e,t,o)}}]),e}(),sn=function(){function e(t){var r=this;Object(n.a)(this,e),this._setSelection=Object(D.f)((function(){null!==r._cache&&(r._normalSelectData.updateSelection(r._normalSelectData.currentSelectIndex,r._cache),r._cache=null)}),0),this._cache=null,this._normalSelectData=t.normalSelectData}return Object(a.a)(e,[{key:"setSelection",value:function(e){this._cache=e,this._setSelection()}}]),e}(),ln=r("../packages/model/src/range/GridRange.ts"),cn=r("../packages/model/src/cell/format/WrapStrategy.ts"),un=r("./src/base/config/report.ts"),dn=r("./src/core/behavior/utils.ts"),hn=null,fn=function(){function e(t){Object(n.a)(this,e),this.spreadsheet=t.spreadsheet}return Object(a.a)(e,[{key:"clearFormat",value:function(e){this.spreadsheet.parent.requestApi.clearFormat()}},{key:"clearContent",value:function(e){this.spreadsheet.parent.requestApi.clearContent()}},{key:"setCellProperties",value:function(e){var t,r=this,n=e.colIndex,a=e.rowIndex,o=e.text,i=e.isTextChanged;if(this.checkDimensionsValid(a,n)){var s=null===(t=window.SpreadsheetApp.view.plugins)||void 0===t?void 0:t.validationErrorPanel;if(!s||!1!==s.verify(a,n,o,i))if(this.spreadsheet.parent.requestApi)this.spreadsheet.parent.requestApi.userEnter(e).catch((function(e){(null===e||void 0===e?void 0:e.stack)&&tn.b.run(un.CONFIG.VIEW_ERROR_INPUT,[e.stack]),console.error("\u65e0\u6548\u8f93\u5165",e)}));else{if(hn)return;hn=e,tn.b.monitor(35175485);var l=this.spreadsheet.parent;l.emitter.once(l.EVENT.SPREAD_SHEET_EDITABLE,(function(){r.setCellProperties(hn),hn=null,tn.b.monitor(35175486)}))}}}},{key:"setCellTextAutoWrap",value:function(e,t,r){if(this.checkDimensionsValid(e,t)){var n=this.spreadsheet.activeSheet,a=n.getCellDataAtPosition(e,t);(null===a||void 0===a?void 0:a.getUserEnteredFormat())&&a.getUserEnteredFormat().getWrapStrategy()===cn.a.OVERFLOW_CELL&&this.spreadsheet.parent.requestApi.autoWrap(cn.a.WRAP,new ln.b(r||n.getSheetId(),e,e,t,t))}}},{key:"checkDimensionsValid",value:function(e,t){return Object(dn.a)(e)&&Object(dn.a)(t)}}]),e}(),pn=function(){function e(t){Object(n.a)(this,e),this._spreadsheetApp=t.spreadsheetApp}return Object(a.a)(e,[{key:"calc",value:function(){var e=Object(P.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._spreadsheetApp.feature.getSmartSelection();case 2:(0,e.sent)(this._spreadsheetApp,t);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),_n=r("../packages/model/src/new-embedded/EmbeddedObjectType.ts"),mn=r("./src/core/view/level-2/chart/charts/ChartsUtils.ts"),vn=function(){function e(t){Object(n.a)(this,e),this._app=t.spreadsheetApp,this._spreadsheet=t.spreadsheet}return Object(a.a)(e,[{key:"removeChart",value:function(e){this._app.requestApi.deleteEmbeddedObject({embeddedObjectType:_n.a.CHART,sheetId:this._spreadsheet.activeSheetId,objectId:e})}},{key:"locationChange",value:function(e,t){var r=t.x,n=t.y,a=t.width,o=t.height,i=t.rowIndex,s=t.colIndex,l=Object(mn.c)(this._app,e,{height:o,width:a,rowIndex:i,colIndex:s,x:r,y:n});if(!l)return null;this._app.requestApi.updateEmbeddedObject({objects:[l]})}}]),e}(),gn=function(){function e(t){Object(n.a)(this,e),this._dimension=new rn(t),this._shape=new an(t),this._link=new on,this._cell=new fn(t),this._selection=new sn(t),this._smartSelection=new pn(t),this._chart=new vn(t)}return Object(a.a)(e,[{key:"dimension",get:function(){return this._dimension}},{key:"shape",get:function(){return this._shape}},{key:"link",get:function(){return this._link}},{key:"cell",get:function(){return this._cell}},{key:"selection",get:function(){return this._selection}},{key:"smartSelection",get:function(){return this._smartSelection}},{key:"chart",get:function(){return this._chart}}]),e}(),bn=r("./src/core/view/level-1/input-manager/InputVariables.ts"),yn=(r("./src/core/view/level-1/input-manager/formula-input-stage/components/bar-label/BarLabel.less"),function(){function e(t){Object(n.a)(this,e),this.label=this.renderDom("bar-label"),t.parent.appendChild(this.label)}return Object(a.a)(e,[{key:"setCellCoordinate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if("number"===typeof e&&"number"===typeof t){var r=Object(De.colIndex2ColChar)(t)+(e+1);this.updateContent(r)}else console.error("Error(setCellCoordinate): \u53c2\u6570\u51fa\u9519\uff01")}},{key:"updateContent",value:function(e){this.label.innerText=e}},{key:"renderDom",value:function(e){var t=document.createElement("div");return t.classList.add(e),t}}]),e}()),wn=r("../packages/editor/src/interface.ts"),Rn=r("../packages/editor/src/AlloyBaseTextEditor.ts");function En(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var Cn=function(e){Object(i.a)(r,e);var t=En(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e)).initEditorComponents(a.rootDom,e.className),a.initEditorCores(),a.initEditorEvents(),a}return Object(a.a)(r,[{key:"initEditorComponents",value:function(e,t){this.input=document.createElement("div"),this.input.classList.add(t),this.input.setAttribute("contenteditable",this.editable.toString()),this.input.style.whiteSpace="pre-wrap",this.input.setAttribute("tabindex","1"),this.input.setAttribute("id",wn.c),e.appendChild(this.input)}}]),r}(Rn.a),jn=(r("./src/core/view/level-1/input-manager/formula-input-stage/components/formula-input/FormulaInput.less"),function(){function e(t){var r=this;Object(n.a)(this,e),this.syncFormulaInputValue2TableInput=function(e){if(e.source!==r.alloySTE.SOURCE.SILENT){var t=r.alloySTE.getText();r.emitter.emit(No.EVENT.SYNC_OUT_FORMULA_INPUT,{cmd:jo.SYNC_CONTENT,data:{value:t}})}},this.handleSheetStatusChange=function(){r.alloySTE.setEditable(r.sheetStatus.canEdit)},this.parent=t.parent,this.emitter=t.emitter,this.sheetStatus=t.sheetStatus,this.alloySTE=new Cn({parent:this.parent,className:"formula-input",editable:this.sheetStatus.canEdit}),this.registerEvents()}return Object(a.a)(e,[{key:"setContent",value:function(e){this.alloySTE.clear(),this.alloySTE.setText(e,this.alloySTE.SOURCE.SILENT)}},{key:"registerEvents",value:function(){var e=this;this.alloySTE.input.addEventListener("mousedown",(function(){e.emitter.emit(No.EVENT.SYNC_OUT_FORMULA_INPUT,{cmd:jo.ENTER_FORMULA_INPUT})})),this.alloySTE.on(this.alloySTE.EVENT.VALUE_CHANGE,this.syncFormulaInputValue2TableInput),this.alloySTE.keyboard.addBindings(this.keyBindings),this.sheetStatus.change(this.handleSheetStatusChange)}},{key:"syncFormulaFormatCmd2TableInput",value:function(e){if(e){var t=this.alloySTE.getSelection();this.emitter.emit(No.EVENT.SYNC_OUT_FORMULA_INPUT,{cmd:jo.EXEC_FORMAT,data:{value:e,range:t}})}}},{key:"keyBindings",get:function(){var e=this;return[{key:"b",shortKey:!0,handler:function(){return e.syncFormulaFormatCmd2TableInput("bold"),!1}},{key:"i",shortKey:!0,handler:function(){return e.syncFormulaFormatCmd2TableInput("italic"),!1}},{key:"u",shortKey:!0,handler:function(){return e.syncFormulaFormatCmd2TableInput("underline"),!1}},{key:"d",shortKey:!0,handler:function(){return e.syncFormulaFormatCmd2TableInput("strikeThrough"),!1}},{key:"5",ctrlKey:!0,handler:function(){return e.syncFormulaFormatCmd2TableInput("strikeThrough"),!1}}]}}]),e}()),On=(r("./src/core/view/level-1/input-manager/formula-input-stage/components/bar-dragger/BarDragger.less"),function(){function e(t){var r=this;Object(n.a)(this,e),this.startDragHandler=function(e){r.isDragging=!0},this.draggingHandler=function(e){r.isDragging&&r.draggerHandler({clientX:e.clientX,clientY:e.clientY})},this.endDragHandler=function(e){r.isDragging=!1},this.dragger=this.renderDom("bar-dragger"),t.parent.appendChild(this.dragger),this.isDragging=!1,this.draggerHandler=t.draggerHandler,this.registerEvents()}return Object(a.a)(e,[{key:"registerEvents",value:function(){this.dragger.addEventListener("mousedown",this.startDragHandler),document.addEventListener("mousemove",this.draggingHandler),document.addEventListener("mouseup",this.endDragHandler),document.addEventListener("click",this.endDragHandler)}},{key:"renderDom",value:function(e){var t=document.createElement("div");return t.classList.add(e),t}}]),e}()),Sn=(r("./src/core/view/level-1/input-manager/formula-input-stage/FormulaBar.less"),function(){function e(t){Object(n.a)(this,e),this.alloyExcel=t.alloyExcel,this.resize=t.resize,this.sheetStatus=t.sheetStatus,this.emitter=t.emitter,this.mountDom=t.mountDom,this.barContainer=this.renderDom("formula-bar"),this.attachToParent(this.barContainer),this.initComponents(),this.registerMessageChanel()}return Object(a.a)(e,[{key:"updateContent",value:function(e){var t=e.rowIndex,r=e.colIndex,n=e.value;this.barLabel.setCellCoordinate(t,r),this.formulaInput.setContent(n||"")}},{key:"initComponents",value:function(){this.barLabel=new yn({parent:this.barContainer}),this.formulaInput=new jn({parent:this.barContainer,emitter:this.emitter,sheetStatus:this.sheetStatus}),this.barDragger=new On({parent:this.barContainer,draggerHandler:this.handleDragger.bind(this)})}},{key:"registerMessageChanel",value:function(){var e=this;this.emitter.on(No.EVENT.SYNC_IN_FORMULA_INPUT,(function(t){e.updateContent(t)}))}},{key:"handleDragger",value:function(e){var t=this.barContainer.getBoundingClientRect().top,r=e.clientY-t;this.updateFormulaBarHeight(r),this.updateCanvasContainerHeight()}},{key:"updateCanvasContainerHeight",value:function(){var e=this.alloyExcel.container.parentElement,t=e.getBoundingClientRect().top,r=window.innerHeight-t-36;e.style.height="".concat(r,"px"),this.resize.resize()}},{key:"attachToParent",value:function(e){if(!document.querySelector("#mainContainer .formula-bar")){var t=document.querySelector("#mainContainer"),r=document.querySelector("#mainContainer .ae-formula-bar");r&&(null===t||void 0===t||t.removeChild(r)),null===t||void 0===t||t.insertBefore(e,document.getElementById("mainEditor"))}}},{key:"updateFormulaBarHeight",value:function(e){e=Math.max(e,25),e=Math.min(e,75),this.barContainer.style.height="".concat(e,"px"),this.barContainer.style.lineHeight="".concat(e,"px")}},{key:"renderDom",value:function(e){var t=document.createElement("div");return e&&t.classList.add(e),t}},{key:"alloySTE",get:function(){return this.formulaInput.alloySTE}}]),e}()),Dn=(r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.array.from.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.string.bold.js"),r("../packages/editor/src/helper/utils.ts")),xn=r("../packages/editor/src/helper/Env.ts"),kn=["bold","fontName","fontSize","foreColor","italic","strikeThrough","underline"],Tn=function(){function e(t){Object(n.a)(this,e),this.inputDom=t.inputDom,this.emitter=t.emitter,this.editorInterface=t.editorInterface}return Object(a.a)(e,[{key:"format",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";"fontName"===e&&"Microsoft YaHei"===t&&(t+=",\u5fae\u8f6f\u96c5\u9ed1");var r=this.checkSelectedAll(e);if(-1!==kn.indexOf(e))return"fontSize"===e?this.fontSize(t):xn.a.ie&&this.editorInterface.isCollapsed()?this.polyfillFormatForIEWhenCollapsed(e,t):(xn.a.ie&&"foreColor"===e&&(t=Object(Dn.f)(t)),document.execCommand("styleWithCSS",!1,"true"),document.execCommand(e,!1,t),this.polyfillFormatForIE(r,e,t)),this.editorInterface.save(!0),this.editorInterface.focus(),this.editorInterface.refreshUndoRedoState(),this.emitter.emit(Nn.EVENT.FORMAT_CHANGE,{source:Nn.SOURCE.API}),!0}},{key:"queryFormats",value:function(){var e=this,t={};return kn.forEach((function(r){var n=e.queryCommand(r);null!==n&&(t[r]=n)})),t}},{key:"checkSelectedAll",value:function(e){xn.a.ie&&!this.editorInterface.hasFocus()&&this.editorInterface.currSelection&&(this.editorInterface.focus(),this.editorInterface.setSelection(this.editorInterface.currSelection,Nn.SOURCE.SILENT));var t=!1;if(xn.a.firefox||xn.a.ie){var r=this.editorInterface.getSelection(),n=this.editorInterface.getText().length;r&&n<=r.end-r.start&&(t=!0,this.editorInterface.setSelection(r,Nn.SOURCE.SILENT),"fontSize"===e&&this.removeChildrenStyle(this.inputDom,"font-size"))}return t}},{key:"polyfillFormatForIE",value:function(e,t,r){var n=this;if(e&&xn.a.ie){var a,o=document.getSelection(),i=null;o&&o.rangeCount>0&&(i=o.getRangeAt(0));var s=null===(a=i)||void 0===a?void 0:a.commonAncestorContainer;if(s&&"bold"===t&&this.removeChildrenStyle(s,"font-weight"),s&&"italic"===t&&this.removeChildrenStyle(s,"font-style"),"foreColor"===t){var l=this.inputDom.querySelectorAll('font[color="'.concat(r.replace(/ /g,""),'"]'));Array.from(l).forEach((function(e){n.removeChildrenStyle(e,"color","color")}))}s&&"fontName"===t&&this.removeChildrenStyle(s,"font-family","face")}}},{key:"fontSize",value:function(e){this.editorInterface.isCollapsed()?this.setFontSizeForCaret(e):this.setFontSizeForRange(e)}},{key:"setFontSizeForCaret",value:function(e){var t=this.queryFormats(),r=(t.strikeThrough?"line-through ":"")+(t.underline?"underline":""),n=Object(Dn.c)({"font-size":e+"pt","font-weight":t.bold?"bold":"normal","font-style":t.italic?"italic":"normal",color:t.foreColor,"font-family":t.fontName,"text-decoration":""===r?"none":r},this.editorInterface.createFillingCharNode()),a=document.getSelection();if(a&&a.rangeCount>0){var o=a.getRangeAt(0);o.insertNode(n),o.setStartAfter(n),o.setStart(n,1),o.setEnd(n,1),o.collapse(!0),a.removeAllRanges(),a.addRange(o),this.emitter.emit(Nn.EVENT.SELECTION_CHANGE,{source:Nn.SOURCE.SILENT})}}},{key:"setFontSizeForRange",value:function(e){var t=this;document.execCommand("styleWithCSS",!1,"false"),document.execCommand("fontSize",!1,"1"),[].slice.call(this.inputDom.querySelectorAll('FONT[size="1"]')).forEach((function(r){r.removeAttribute("size"),r.style.fontSize=e+"pt",(xn.a.ie||xn.a.firefox)&&t.removeChildrenStyle(r,"font-size")}))}},{key:"removeChildrenStyle",value:function(e,t,r){if(e){["span","font"].forEach((function(n){var a=e.querySelectorAll(n);Array.from(a).forEach((function(e){t&&""!==e.style[t]&&(e.style[t]=""),r&&e.hasAttribute(r)&&e.removeAttribute(r)}))}))}}},{key:"parseFormatStyleObj",value:function(e,t){var r={},n=this.queryCommand(e);switch(e){case"bold":r={"font-weight":n?"normal":"bold"};break;case"italic":r={"font-style":n?"normal":"italic"};break;case"fontName":r={"font-family":t};break;case"foreColor":r={color:t};break;case"underline":r=n?{}:{"text-decoration":"underline"};break;case"strikeThrough":r=n?{}:{"text-decoration":"line-through"}}return r}},{key:"polyfillFormatForIEWhenCollapsed",value:function(e,t){var r=Object(Dn.c)(this.parseFormatStyleObj(e,t),this.editorInterface.createFillingCharNode()),n=document.getSelection();if(n&&n.rangeCount>0){var a=n.getRangeAt(0);a.insertNode(r),a.setStartAfter(r),a.setStart(r,1),a.setEnd(r,1),a.collapse(!0),n.removeAllRanges(),n.addRange(a),this.emitter.emit(Nn.EVENT.SELECTION_CHANGE)}}},{key:"queryCommand",value:function(e){if("fontSize"===e)return this.prepareFontSize();var t;if(xn.a.firefox){if(!this.editorInterface.hasFocus()){if(this.editorInterface.focus(),!this.editorInterface.currSelection)return null;this.editorInterface.setSelection(this.editorInterface.currSelection,Nn.SOURCE.SILENT)}var r=document.queryCommandState(e);if("foreColor"===e||"fontName"===e){var n=this.editorInterface.defaultCellStyle.color,a=this.editorInterface.defaultCellStyle["font-family"];t=(t=document.queryCommandValue(e))||("foreColor"===e?n:a)}else t=r}else"string"===typeof(t=document.queryCommandValue(e))?"true"===t.toLocaleLowerCase()?t=!0:"false"===t.toLocaleLowerCase()&&(t=!1):"number"===typeof t&&(t=Object(Dn.d)(t));return t}},{key:"prepareFontSize",value:function(){var e=this.editorInterface.getSelection();e&&!e.isCollapsed()&&xn.a.ie&&this.editorInterface.setSelection(e,Nn.SOURCE.SILENT);var t=document.getSelection(),r=(null===t||void 0===t?void 0:t.rangeCount)?t.getRangeAt(0):null;if(!r)return null;var n=r.endContainer||r.startContainer;if(e&&!e.isCollapsed()){var a=this.editorInterface.getSelectedText(),o=Object(Dn.e)(r.startContainer.textContent||r.startContainer.innerText),i=Object(Dn.e)(r.endContainer.textContent||r.endContainer.innerText);a===o?n=r.startContainer:a===i&&(n=r.endContainer)}return n&&n.nodeType===Node.TEXT_NODE&&(n=n.parentNode),this.queryFontSize(n)}},{key:"queryFontSize",value:function(e){var t;if(e&&e.nodeType===Node.TEXT_NODE&&(e=e.parentNode),!e||!(e instanceof Element))return 10;var r=null;window.getComputedStyle?r=window.getComputedStyle(e,null):e.currentStyle&&(r=e.currentStyle);var n=null===(t=r)||void 0===t?void 0:t["font-size"];return this.parseFontsize(n)}},{key:"extractNumberFromString",value:function(e){var t=/[+-]?\d+(?:\.\d+)?/g.exec(e);return(null===t||void 0===t?void 0:t.length)&&Number(t[0])||10}},{key:"parseFontsize",value:function(e){var t=10;return/pt$/i.test(e)?t=this.extractNumberFromString(e):/px$/i.test(e)&&(t=Math.round(3*this.extractNumberFromString(e)/4)),t}}]),e}(),An=r("../packages/editor/src/blocks/mention-block/MentionBlock.ts");function In(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var Nn=function(e){Object(i.a)(r,e);var t=In(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e)).defaultCellStyle=e.defaultCellStyle,a.defaultTextStyle=e.defaultTextStyle,a.initEditorComponents(a.rootDom,e.className),a.initEditorCores(),a.initMentionBlock(e.mentionHooks),a.initEditorEvents(),a}return Object(a.a)(r,[{key:"show",value:function(e,t){var r=this;"string"===typeof(null===t||void 0===t?void 0:t.inputMode)&&(this.input.inputMode=t.inputMode),this.setEditorInputStyles(e.cellStyles),this.setEditorContent(e.editValue,e.textStyleRuns,e.mentionDetails||[]),setTimeout((function(){r.save(!0),r.currSelection=r.getSelection(),r.emitter.emit(Rn.a.EVENT.FORMAT_CHANGE,{source:Rn.a.SOURCE.SILENT})})),this.mentionBlock.resetVars()}},{key:"setEditorContainerStyles",value:function(e){Object(Dn.g)(this.rootDom,e)}},{key:"setEditorInputStyles",value:function(e){Object(Dn.g)(this.input,e)}},{key:"setEditorContent",value:function(e,t){for(var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this.input.firstChild;)this.input.removeChild(this.input.firstChild);var a=this.createFillingCharNode();if(e&&e.length){var o=this.createEditorContent(e,t,n);o.forEach((function(e){var t=document.createDocumentFragment();t.appendChild(e.cloneNode(!0)),r.input.appendChild(t.cloneNode(!0))}))}else{var i=Object(Dn.c)(t[0].format,xn.a.iOS||xn.a.safari?"":a);this.input.appendChild(i)}var s=this.input.lastChild;if(!s||"BR"!==s.tagName){var l=document.createElement("br");l.className="extra",this.input.appendChild(l)}}},{key:"createMention",value:function(e){return this.mentionBlock.create(e)}},{key:"setContent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Rn.a.SOURCE.API;this.textService.setHTMLContent(e);var n=this.findFillingCharNode(this.input);n&&this.selection.initFillingCharNode(n),this.emitter.emit(r.EVENT.VALUE_CHANGE,{source:t})}},{key:"format",value:function(e,t){return this.formats.format(e,t),!0}},{key:"getFormat",value:function(){return this.formats.queryFormats()}},{key:"initEditorComponents",value:function(e,t){this.rootDom=document.createElement("div"),this.rootDom.classList.add(t),this.rootDom.setAttribute("spellcheck","false"),this.rootDom.style.overflowY="auto",this.rootDom.style.overflowX="hidden",this.input=document.createElement("div"),this.input.setAttribute("id",wn.b),this.input.setAttribute("contenteditable",this.editable.toString()),this.input.style.boxSizing="border-box",this.input.style.padding="0px 4px",this.input.style.display="table-cell",this.input.style.whiteSpace="pre-wrap",this.input.setAttribute("tabindex","1"),this.input.style.wordBreak="break-word",this.input.style.wordWrap="break-word",this.rootDom.appendChild(this.input),e.appendChild(this.rootDom)}},{key:"initEditorCores",value:function(){Object(o.a)(Object(l.a)(r.prototype),"initEditorCores",this).call(this),this.formats=new Tn({inputDom:this.input,emitter:this.emitter,editorInterface:this})}},{key:"initMentionBlock",value:function(e){this.mentionBlock=new An.b({rootDom:this.rootDom,inputDom:this.input,blockInterface:this,emitter:this.emitter,platform:this.platform},{hooks:e||{}})}},{key:"createEditorContent",value:function(e,t,r){for(var n="",a=null,o=null,i=0,s=0,l=[],c=0;c<t.length;c++){a=t[c],o=c+1<t.length?t[c+1]:null,i=a.startIndex,s=o?o.startIndex:e.length;for(var u=this.splitTextStyleRunByMentionDetails([i,s],r),d=0;d<u.length;d++){var h=u[d];n=e.substring(h.pos[0],h.pos[1]),h.mention?l.push.apply(l,Object(lt.a)(this.createMention(h.mention))):l.push(Object(Dn.c)(a.format,n))}}return l}},{key:"splitTextStyleRunByMentionDetails",value:function(e,t){var r=(t||[]).filter((function(t){return e[0]<=t.pos[0]&&t.pos[1]<=e[1]}));if(!r.length)return[{pos:e}];for(var n,a=[],o=e[0],i=0;i<r.length;i++)o<(n=r[i]).pos[0]&&a.push({pos:[o,n.pos[0]]}),a.push({pos:n.pos,mention:n}),o=n.pos[1];return o<e[1]&&a.push({pos:[o,e[1]]}),a}},{key:"findFillingCharNode",value:function(e){if(!e)return null;if(e&&e.nodeType===Node.TEXT_NODE){if((e.nodeValue||"").indexOf(Dn.a)>=0)return e}else for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];return this.findFillingCharNode(r)}return null}}]),r}(Rn.a),Ln=r("./src/core/view/spreadsheet-view/model/WrapStrategy.ts"),Pn=r("../node_modules/lodash/clone.js"),Mn=r.n(Pn),Vn=r("./src/base/helper/font-polyfill.ts");function zn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Bn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?zn(Object(r),!0).forEach((function(t){Object(F.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Fn(e,t){var r;if(!e||!t)return{editValue:"",cellStyles:Gn,textStyleRuns:Yn,mentionDetails:null};var n=(null===(r=e.cellFormat)||void 0===r?void 0:r.getTextFormat())||null,a=function(e){if(!e)return Mn()(Gn);var t=Mn()(Wn),r=Mn()(Hn);"string"===typeof e.backgroundColor&&(t["background-color"]=e.backgroundColor);e.textAlgin&&(t["text-align"]=e.textAlgin);e.vertialAlgin&&(t["vertical-align"]=e.vertialAlgin);e.wrapStrategy===Ln.a.NORMAL&&(t["word-wrap"]="break-word",t["word-break"]="break-all");e.textFormat&&(delete(r=Un(e.textFormat))["text-decoration"],delete r["text-decoration-skip-ink"]);return Bn(Bn({},t),r)}({textAlgin:t.style.horizontalAlign.value,vertialAlgin:t.style.verticalAlign.value,backgroundColor:t.style.background.hex,wrapStrategy:t.style.wrapStrategy.value,textFormat:n}),o=function(e){if(e&&e.length>0)return e.map((function(e){return{startIndex:e.startIndex,format:Un(e.format)}}));return[{startIndex:0,format:Mn()(Hn)}]}(e.textFormatRuns),i=function(e){if(!e)return null;return Object.keys(e).map((function(t){return e[t].toObject()}))}(e.mentionDetails);return{editValue:e.editValue||"",cellStyles:a,textStyleRuns:o,mentionDetails:i}}var Hn={"font-family":"Arial","font-size":"10pt",color:"rgba(0, 0, 0, 1)","font-weight":"normal","font-style":"normal","text-decoration":"none","text-decoration-skip-ink":"none"};function Un(e){if(!e)return Hn;var t=Mn()(Hn);if(e.bold&&(t["font-weight"]="bold"),e.italic&&(t["font-style"]="italic"),"number"===typeof e.fontSize&&(t["font-size"]="".concat(e.fontSize,"pt")),e.fontFamily){var r=e.fontFamily;t["font-family"]=Object(Vn.a)(r)}return e.color&&(t.color=e.color.toStringRGBA()),(e.strikethrough||e.underline)&&(t["text-decoration"]="",e.strikethrough&&(t["text-decoration"]+="line-through"),e.underline&&(t["text-decoration"]+=" underline",2===e.underline&&console.warn("warning: \u6682\u65f6\u4e0d\u652f\u6301\u53cc\u4e0b\u5212\u7ebf\uff01\u5904\u7406\u6210\u5355\u4e0b\u5212\u7ebf\u4e86\u3002"))),t}var Wn={"background-color":"rgba(255, 255, 255, 1)","text-align":"left","vertical-align":"middle"},Gn=Bn(Bn({},Wn),Hn);var Yn=[{startIndex:0,format:Hn}];r("./src/core/view/level-1/input-manager/table-input-stage/components/table-input/BaseTableInput.less");function Xn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var Kn=function(e){Object(i.a)(r,e);var t=Xn(r);function r(e){var a;return Object(n.a)(this,r),a=t.call(this,e),e.sheetStatus.canEdit&&a.alloyRTE.focus(),a}return Object(a.a)(r,[{key:"initAlloyRTE",value:function(){this.alloyRTE=new Nn({parent:this.parent,className:"table-input",platform:wn.d.PC,editable:this.sheetStatus.canEdit,defaultCellStyle:Mn()(Gn),defaultTextStyle:Mn()(Hn)})}}]),r}(function(){function e(t){var r=this;Object(n.a)(this,e),this.handleSheetStatusChange=function(){r.alloyRTE.setEditable(r.sheetStatus.canEdit)},this.sheetStatus=t.sheetStatus,this.emitter=t.emitter,this.parent=t.parent,this.initAlloyRTE(),this.initEvent()}return Object(a.a)(e,[{key:"initEvent",value:function(){this.sheetStatus.change(this.handleSheetStatusChange)}}]),e}());r("./src/core/view/level-1/input-manager/table-input-stage/InputStage.less"),r("../node_modules/core-js/modules/es.array.reduce.js"),r("../node_modules/core-js/modules/es.object.get-own-property-names.js"),r("../node_modules/core-js/modules/es.string.trim.js");function qn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Qn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?qn(Object(r),!0).forEach((function(t){Object(F.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Zn(e){var t=function(e){var t=e;if(!t||!t.children||e.id!==wn.b)return null;document.queryCommandSupported("styleWithCss")||function(e){if(!e)return;var t={strong:{prop:"font-weight",value:"bold"},em:{prop:"font-style",value:"italic"},u:{prop:"text-decoration-line",value:"underline"},strike:{prop:"text-decoration-line",value:"line-through"}};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r))for(var n=t[r],a=[].slice.call(e.querySelectorAll(r)),o=0;o<a.length;o++){a[o].setAttribute("style","".concat(n.prop,": ").concat(n.value,";"))}for(var i=[].slice.call(e.querySelectorAll("font[face]")),s=0;s<i.length;s++){var l=i[s];l.style["font-family"]=l.getAttribute("face")}for(var c=[].slice.call(e.querySelectorAll("font[color]")),u=0;u<c.length;u++){var d=c[u];d.style.color=d.getAttribute("color")}}(t);0;return t}(e);if(!t)return null;var r=Array.from(t.childNodes).map((function(e){return function e(t,r,n){(null===t||void 0===t?void 0:t.style)&&Object.assign(r,function(e){var t={};if(null===e||void 0===e?void 0:e.style){var r=e.style,n=r.getPropertyValue("color")||r.color;n&&(t.color=n);var a=r.getPropertyValue("font-family")||r["font-family"];a&&(a.indexOf(",")>-1&&(a=a.split(",")[0]),t.fontFamily=a.replace(/"|'/g,""));var o=r.getPropertyValue("font-size")||r["font-size"];o&&(t.fontSize=o);var i=r.getPropertyValue("font-weight")||r["font-weight"];i&&(t.bold="bold"===i);var s=r.getPropertyValue("font-style")||r["font-style"];s&&(t.italic="italic"===s);var l=r.getPropertyValue("text-decoration-line")||r.getPropertyValue("text-decoration")||r["text-decoration-line"]||r["text-decoration"];l&&l.indexOf("line-through")>=0&&(t.strikethrough=!0),(l&&l.indexOf("underline")>=0||e.tagName&&"U"===e.tagName.toUpperCase())&&(t.underline=!0)}return t}(t));if("BR"===t.nodeName)n.push({text:String.fromCharCode(10),style:Qn({},r)});else if(t.nodeType===Node.TEXT_NODE)n.push({text:t.textContent||"",style:Qn({},r)});else if(t&&t.className===wn.a){var a;n.push({text:(null===(a=t.textContent)||void 0===a?void 0:a.trim())||"",style:{bold:!1,color:"rgb(1,136,251)",fontFamily:"Arial",fontSize:"10pt",italic:!1}})}else for(var o=0;o<t.childNodes.length;o++){var i=t.childNodes[o];e(i,Qn({},r),n)}return n}(e,{},[])})).reduce((function(e,t){return e.concat(t)}),[]).filter((function(e){return!(!e.text||""===e.text)}));return r=function(e){if(!e||e.length<=1)return e;var t,r,n=0;for(;n<e.length-1;)t=e[n],r=e[n+1],$n(t.style,r.style)?(t.text+=r.text,e.splice(n+1,1)):n+=1;return e}(r)}function Jn(e){if(!e||!e.children)return null;if(!e.querySelector(".".concat(wn.a)))return null;var t=0,r=[];return function e(n){if(n.nodeType===Node.TEXT_NODE||"BR"===n.tagName)n.nodeType===Node.TEXT_NODE?t+=(n.textContent||"").length:t+=1;else if(n&&n.className===wn.a){var a,o=null;if(null===(a=n.dataset)||void 0===a?void 0:a.mentionDetail)try{o=JSON.parse(n.dataset.mentionDetail)}catch(c){console.error("JSON Parse MentionDetail error!")}if(o){var i=o.text.trim(),s=[t,t+i.length];o.pos=s,r.push(o),t+=i.length}else t+=(n.textContent||"").trim().length}else for(var l=0;l<n.childNodes.length;l++)e(n.childNodes[l])}(e),r}function $n(e,t){if(e&&t){var r=Object.getOwnPropertyNames(e),n=Object.getOwnPropertyNames(t);if(r.length!==n.length)return!1;for(var a=0;a<r.length;a++){var o=r[a];if(e[o]!==t[o])return!1}return!0}return!1}var ea=r("../packages/model/src/cell/cellDataUtils.ts"),ta=r("../node_modules/@tencent/tdocs-format-render/lib/index.js"),ra=r("./src/core/feature/formula/UIUtils.ts");function na(e){return"".concat(e,"px")}function aa(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function oa(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?aa(Object(r),!0).forEach((function(t){Object(F.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):aa(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ia,sa=function(){function e(t){Object(n.a)(this,e),this.spreadsheet=t.spreadsheet,this.mountDom=t.mountDom,this.areaData=t.areaData,this.rowcolAccessor=t.rowcolAccessor,this.scale=t.scale,this.clientRect=t.clientRect,this.headSize=t.headSize,this.emitter=t.emitter,this.sheetStatus=t.sheetStatus,this.tableView=t.tableView,this.paragraphAccessor=t.paragraphAccessor,this.saveContent=t.saveContent}return Object(a.a)(e,[{key:"show",value:function(e){this.initInputRawData=e.initInputRawData,this.cellView=e.cellView,this.row=e.initInputRawData.row,this.col=e.initInputRawData.col}},{key:"hide",value:function(){this.setStageStyle({left:-9999,top:0,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0})}},{key:"dismiss",value:function(){this.hide(),this.alloyRTE.clear()}},{key:"extractInputData",value:function(){var e=this.alloyRTE.getText();if(e=this.processTextValue(e),this.testFormula(e).isFormula)return{text:e,textFormatInfos:null,mentionDetails:null};var t=this.alloyRTE.getInputDom();return{text:e,textFormatInfos:Zn(t),mentionDetails:Jn(t)}}},{key:"showTooltip",value:function(e){this.tooltipCard.showWithType(e)}},{key:"setupStage",value:function(){var e=document.createElement("div");e.classList.add("table-input-board"),this.stageElement=document.createElement("div"),this.stageElement.classList.add("table-input-stage"),e.appendChild(this.stageElement),this.mountDom.appendChild(e)}},{key:"setStyle",value:function(e){var t=Object.prototype.hasOwnProperty;for(var r in e)t.call(e,r)&&(this.stageElement.style[r]=e[r])}},{key:"setStageStyle",value:function(e){var t={transform:"scale(".concat(this.scale.scale,")"),left:na(e.left),top:na(e.top),"min-width":na(e.minWidth),"max-width":na(e.maxWidth),"min-height":na(e.minHeight),"max-height":na(e.maxHeight)};this.setStyle(oa(oa({},{opacity:"1","pointer-events":"auto"}),t)),this.alloyRTE.setEditorContainerStyles({"min-height":na(e.minHeight-2*u.m),"max-height":na(e.maxHeight-2*u.m)}),this.alloyRTE.setEditorInputStyles({"min-width":na(e.minWidth-2*u.m),"max-width":na(e.maxWidth-2*u.m),height:na(e.minHeight-2*u.m),"min-height":na(e.minHeight-2*u.m),"max-height":na(e.maxHeight-2*u.m)})}},{key:"getStageInitPosition",value:function(e,t,r){var n,a=this.expandInputStage(e,t,r),o=a.inputStageWidth,i=a.leftCol,s=a.rightCol,l=Object(Oe.a)(this.rowcolAccessor,e,t),c=this.rowcolAccessor.getFrozenColCount();c>i&&c<=s&&(o+=u.k);var d=this.rowcolAccessor.getFrozenRowCount()-1;d>t&&d<=((null===e||void 0===e||null===(n=e.mergeData)||void 0===n?void 0:n.rowCount)||1)+t-1&&(l+=u.k);var h=this.areaData.getViewLeftByCol(i),f=this.areaData.inFrozenColArea(i)?0:this.areaData.col.frozen.viewSize,p=f-h,_=this.areaData.getViewTopByRow(t),m=this.areaData.inFrozenRowArea(t)?0:this.areaData.row.frozen.viewSize,v=m-_;return h=Math.max(h,f),_=Math.max(_,m),h-=u.m,_-=u.m,{inputStageWidth:o+=2*u.m,inputStageHeight:l+=2*u.m,leftOffsetFromEdge:p,topOffsetFromEdge:v,left:h,top:_}}},{key:"expandInputStage",value:function(e,t,r){for(var n,a,o=(null===(n=this.paragraphAccessor.getParagraph(t,r))||void 0===n?void 0:n.width)||0,i=Object(Oe.b)(this.rowcolAccessor,e,r),s=this.areaData.inFrozenColArea(r)?0:this.rowcolAccessor.getFrozenColCount(),l=i,c=r,u=r+((null===e||void 0===e||null===(a=e.mergeData)||void 0===a?void 0:a.colCount)||1)-1,d=!1;o>l;)if(c<=s&&(d=!0),d||(null===e||void 0===e?void 0:e.style.horizontalAlign.value)!==q.a.RIGHT&&(null===e||void 0===e?void 0:e.style.horizontalAlign.value)!==q.a.CENTER||(c-=1,l+=this.rowcolAccessor.getColSetWidth(u)),d||(null===e||void 0===e?void 0:e.style.horizontalAlign.value)===q.a.LEFT||(null===e||void 0===e?void 0:e.style.horizontalAlign.value)===q.a.CENTER){if(u>=this.rowcolAccessor.getColCount()-1)break;u+=1,l+=this.rowcolAccessor.getColSetWidth(u)}return{inputStageWidth:l=Math.max(l,o),leftCol:c,rightCol:u}}},{key:"testFormula",value:function(e){e=this.filterUnexpectedChars(e);var t=!1,r=this.spreadsheet.activeSheet.getCellDataAtPosition(this.row,this.col);if(r){var n=Object(ea.getExportFormat)(r);n&&Object(ta.isTextCell)(n.getNumberFormat())&&(t=!0)}return{isFormula:!t&&/^=$|^=[^=]/.test(e),isStock:/^=STOCK\(/i.test(e)}}},{key:"filterUnexpectedChars",value:function(e){return e&&"string"===typeof e&&(e=(e=(e=e.replace(/\r\n$/,"\n")).replace(/\n$/,"")).replace(String.fromCharCode(65279),"")),e}},{key:"processTextValue",value:function(e){return this.testFormula(e).isFormula&&(e=Object(ra.a)(e),e=this.filterUnexpectedChars(e)),e}},{key:"alloyRTE",get:function(){return this.tableInput.alloyRTE}}]),e}();r("./src/core/view/level-1/input-manager/table-input-stage/components/tooltip-card/TooltipCard.less");!function(e){e[e.INPUT_HIDE=0]="INPUT_HIDE",e[e.INPUT_DELETE=1]="INPUT_DELETE"}(ia||(ia={}));var la=function(){function e(t){Object(n.a)(this,e),this.element=e.getElement(),t.appendChild(this.element)}return Object(a.a)(e,[{key:"showWithType",value:function(e){switch(e){case ia.INPUT_HIDE:this.showWidthContent("\u5355\u5143\u683c\u88ab\u9690\u85cf");break;case ia.INPUT_DELETE:this.showWidthContent("\u5355\u5143\u683c\u5df2\u5220\u9664")}}},{key:"hide",value:function(){this.element.innerText="",this.element.style.display="none"}},{key:"showWidthContent",value:function(e){this.element.innerText=e,this.element.style.display="block"}}],[{key:"getElement",value:function(){var e=document.createElement("div");return e.classList.add("tooltip-card"),e}}]),e}(),ca=r("../packages/model/src/factory/index.ts");function ua(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function da(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ua(Object(r),!0).forEach((function(t){Object(F.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ua(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ha(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var fa=function(e){Object(i.a)(r,e);var t=ha(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e)).setupStage(),a}return Object(a.a)(r,[{key:"show",value:function(e){Object(o.a)(Object(l.a)(r.prototype),"show",this).call(this,e),this.tooltipCard.hide(),this.update();var t=this.transform2InputInitData(this.initInputRawData,this.cellView);this.alloyRTE.show(t)}},{key:"mutexHide",value:function(){null!==this.initInputRawData?this.saveContent():this.dismiss()}},{key:"update",value:function(e){e&&"number"===typeof e.row&&(this.row=e.row),e&&"number"===typeof e.col&&(this.col=e.col);var t=this.getStageRect(this.cellView,this.row,this.col);this.setStageStyle(t)}},{key:"setupStage",value:function(){Object(o.a)(Object(l.a)(r.prototype),"setupStage",this).call(this),this.tooltipCard=new la(this.stageElement),this.tableInput=new Kn({sheetStatus:this.sheetStatus,emitter:this.emitter,parent:this.stageElement}),this.dismiss()}},{key:"transform2InputInitData",value:function(e,t){var r;return yr.a.isIE&&(null===e||void 0===e||null===(r=e.cellFormat)||void 0===r?void 0:r.textFormat)&&(e.cellFormat=ca.CellFormatFactory.createInstance(da(da({},e.cellFormat.getOptions()),{},{textFormat:da(da({},e.cellFormat.textFormat.getOptions()),{},{bold:!1,italic:!1})}))),Fn(e,t)}},{key:"getStageRect",value:function(e,t,r){var n;(null===(n=e)||void 0===n?void 0:n.mergeParent)&&(t+=e.mergeParent.y,r+=e.mergeParent.x,e=this.tableView.getCellViewAtPosition(t,r));var a=this.getStageInitPosition(e,t,r),o=a.inputStageWidth,i=a.inputStageHeight,s=a.leftOffsetFromEdge,l=a.topOffsetFromEdge,c=a.left,u=a.top,d=this.scale.scale,h=this.clientRect.width/d,f=this.clientRect.height/d,p=this.headSize,_=p.rowHeadWidth,m=p.colHeadHeight,v=14/d,g=h-_-c-v,b=Math.min(o,g),y=f-m-u-v,w=Math.min(i,y);return s>b||l>w?{left:-9999,top:0,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0}:{minWidth:b,maxWidth:g,minHeight:w,maxHeight:y,left:(c+_)*d,top:(u+m)*d}}}]),r}(sa),pa=r("../packages/model/src/cell/format/colorUtils.ts"),_a=r("../packages/model/src/cell/format/UnderlineType.ts"),ma=r("../packages/model/src/mention/MentionDetail.ts"),va=(r("../node_modules/core-js/modules/es.array.find.js"),{shiftKey:!1,altKey:!1,ctrlKey:!1,metaKey:!1}),ga={shiftKey:16,ctrlKey:17,altKey:18,metaKey:91};function ba(e){if(0!==e.keyCode)return e.keyCode;switch(e.key){case"UIKeyInputRightArrow":return 39;case"UIKeyInputLeftArrow":return 37;case"UIKeyInputUpArrow":return 38;case"UIKeyInputDownArrow":return 40;case"UIKeyInputEscape":return 27}return function(e){var t=Object.keys(va).map((function(e){return{key:e,val:va[e]}})).find((function(t){var r=t.key,n=t.val;return e[r]&&!n||!e[r]&&n}));return function(e){Object.keys(va).forEach((function(t){va[t]=!!e[t]}))}(e),t?ga[t.key]:e.keyCode}(e)||e.keyCode}var ya=r("./src/core/view/spreadsheet-view/model/line-engine/LineEngine.ts"),wa=r("../packages/model/src/cell/ExtendedValueType.ts");function Ra(e,t,r,n){var a=e.activeSheet.getCellDataAtPosition(t,r),o=e.activeSheetId;if(!a)return{sheetId:o,row:t,col:r,editValue:"",cellFormat:null,textFormatRuns:null,mentionDetails:null};var i=e.activeSheet.getCellImage(t,r);return{sheetId:o,row:t,col:r,editValue:n||i?"":a.getEditValue()||"",cellFormat:a.getUserEnteredFormat()||null,textFormatRuns:Object(ya.b)(a),mentionDetails:a.getMentionDetails()||null}}function Ea(e){var t=/[+-]?\d+(?:\.\d+)?/g.exec(e);return t&&Number(t[0])||10}function Ca(e,t){if(!e||!Object.keys(e).length)return null;var r,n,a,o,i,s=e.color?Object(pa.colorValues)(e.color):null;return r=s?ca.ColorFactory.createInstance({red:s[0],green:s[1],blue:s[2],alpha:s[3]}):(null===t||void 0===t?void 0:t.color)?t.color:ca.ColorFactory.createInstance({red:0,green:0,blue:0,alpha:1}),n=e.fontFamily?e.fontFamily:(null===t||void 0===t?void 0:t.fontFamily)?t.fontFamily:"Arial",a=e.fontSize?function(e){var t=10;return/pt$/i.test(e)?t=Ea(e):/px$/i.test(e)&&(t=Math.round(3*Ea(e)/4)),t}(e.fontSize):(null===t||void 0===t?void 0:t.fontSize)?t.fontSize:10,o=void 0!==e.bold?e.bold:!!(null===t||void 0===t?void 0:t.bold)&&t.bold,i=void 0!==e.italic?e.italic:!!(null===t||void 0===t?void 0:t.italic)&&t.italic,ca.TextFormatFactory.createInstance({color:r,fontFamily:n,fontSize:a,bold:o,italic:i,strikethrough:void 0!==e.strikethrough&&e.strikethrough,underline:"boolean"===typeof e.underline&&e.underline?_a.a.SINGLE_LINE:null})}function ja(e,t){if(!e||!e.length)return null;t||(t=ca.TextFormatFactory.createInstance({bold:!1,italic:!1,color:ca.ColorFactory.createInstance({red:0,green:0,blue:0,alpha:1}),fontFamily:"Arial",fontSize:10,strikethrough:!1,underline:null}));var r=[];r=e.map((function(e){var r=Ca(e.style,t);return r||(r=t),{text:e.text,textFormat:r}}));var n=[],a=0;return e&&(n=(r=function(e){if(!e||e.length<=1)return e;for(var t,r,n=0;n<e.length-1;){var a;t=e[n],r=e[n+1],t.textFormat===r.textFormat||(null===(a=t.textFormat)||void 0===a?void 0:a.equal(r.textFormat))?(t.text+=r.text,e.splice(n+1,1)):n+=1}return e}(r)).map((function(e){var t=ca.TextFormatRunFactory.createInstance({startIndex:a,format:e.textFormat});return a+=e.text.length,t}))),n}var Oa=ca.TextFormatFactory.createInstance();function Sa(e){return!e||!e.length||1===e.length&&(!e[0].format||Oa.equal(e[0].format))}function Da(e){var t=e.keyCode;return yr.a.isIPad&&(t=ba(e)),function(e){return-1!==[Xa,Ya,Ga,Wa,Va,Ta,ka,xa,Ka,qa,Qa,Za,Ja,$a,eo,to,ro,no,ao,oo,io,so,lo,co,uo,ho,Ua,za,Ba,Aa,Ia,Fa,Ha,Ma,La,Na,Pa,fo,po].indexOf(e)}(t)}var xa=8,ka=46,Ta=35,Aa=13,Ia=27,Na=91,La=17,Pa=93,Ma=18,Va=36,za=34,Ba=33,Fa=16,Ha=20,Ua=9,Wa=39,Ga=37,Ya=38,Xa=40,Ka=112,qa=113,Qa=114,Za=115,Ja=116,$a=117,eo=118,to=119,ro=120,no=121,ao=122,oo=123,io=174,so=175,lo=176,co=177,uo=178,ho=179,fo=144,po=145;var _o=r("./src/core/utils/index.ts"),mo=r("../packages/model/src/cell/metadata/CustomDataType.ts"),vo=function(){function e(t){var r=this;Object(n.a)(this,e),this.isInputtingState=function(){return r.variables.status!==bn.a.DEFAULT},this.handleUpdateOffset=function(){r.updateInputStagePosition(),r.hideInputStageIfNeed()},this.handleScale=function(){r.updateInputStagePosition(),r.hideInputStageIfNeed()},this.spreadsheet=t.spreadsheet,this.sheetStatus=t.sheetStatus,this.alloyExcel=t.alloyExcel,this.tableView=t.tableView,this.areaData=t.areaData,this.dataCallView=t.dataCallView,this.rowcolAccessor=t.rowcolAccessor,this.modifyCellBroker=t.modifyCellBroker,this.scale=t.scale,this.resize=t.resize,this.clientRect=t.clientRect,this.headSize=t.headSize,this.normalSelectData=t.normalSelectData,this.formulaSelectData=t.formulaSelectData,this.scrollApi=t.scrollApi,this.tableInputMountDom=t.tableInputMountDom,this.mutexManagement=t.mutexManagement,this.normalSelectionStage=t.normalSelectionStage,this.paragraphAccessor=t.paragraphAccessor,this.slideOperate=t.slideOperate,this.emitter=new tr.a,this.variables=new bn.c(bn.a.DEFAULT,bn.b.TEXT),this.spreadsheet.parent.emitter.on(this.spreadsheet.parent.EVENT.RESTART_END,this.restart.bind(this))}return Object(a.a)(e,[{key:"isInputtingStable",value:function(){return this.variables.status===bn.a.STABLE_INPUT}},{key:"isInputtingQuick",value:function(){return this.variables.status===bn.a.QUICK_INPUT}},{key:"isInputtingToolbar",value:function(){return this.variables.status===bn.a.TOOLBAR_INPUT}},{key:"switchInputType",value:function(e){this.variables.switchType(e)}},{key:"switchInputStatus",value:function(e){this.sheetStatus.canEdit&&this.variables.switchStatus(e)}},{key:"undo",value:function(){this.alloyRTE.undo()}},{key:"redo",value:function(){this.alloyRTE.redo()}},{key:"isComposing",value:function(){return this.alloyRTE.isComposing()}},{key:"hasFocus",value:function(){return this.alloyRTE.hasFocus()}},{key:"focus",value:function(){this.alloyRTE.focus(),this.emitter.emit(e.EVENT.FOCUS)}},{key:"blur",value:function(){this.alloyRTE.blur()}},{key:"format",value:function(e,t){this.alloyRTE.format(e,t)}},{key:"getFormat",value:function(){return this.alloyRTE.getFormat()}},{key:"getText",value:function(){return this.alloyRTE.getText()}},{key:"setText",value:function(e,t){this.alloyRTE.setText(e,t)}},{key:"insertNewLine",value:function(){this.alloyRTE.insertNewLine()}},{key:"getSelection",value:function(){return this.alloyRTE.getSelection()}},{key:"setSelection",value:function(e){this.alloyRTE.setSelection(e)}},{key:"hide",value:function(){this.alloyRTE.blur(),this.normalSelectionStage.show()}},{key:"handleEnterInput",value:function(){this.mutexManagement.mutexShow(de.a.INPUT),this.variables.status===bn.a.DEFAULT&&(this.variables.switchStatus(bn.a.STABLE_INPUT),this.alloyRTE.setActive(!0)),this.isInputtingQuick()||this.alloyRTE.collapseToEnd(),this.emitter.emit(e.EVENT.ENTER_INPUT),this.areaDataUpdateOffsetDispose=this.areaData.onUpdateOffset(this.handleUpdateOffset),this.scaleEventDispose=this.scale.onScale(this.handleScale)}},{key:"handleExitInput",value:function(t){this.variables.status!==bn.a.DEFAULT&&(this.variables.switchStatus(bn.a.DEFAULT),(null===t||void 0===t?void 0:t.discard)||this.commitTableInputData(),this.tableInputStage.dismiss(),this.initInputRawData=null,this.emitter.emit(e.EVENT.EXIT_INPUT),this.areaDataUpdateOffsetDispose.dispose(),this.scaleEventDispose.dispose())}},{key:"handleMetaKeyEnter",value:function(){var e=this.spreadsheet.parent;if(e.sheetStatus.canEdit&&this.isInputtingState()){var t=e.view.getSelection().rangeSelections,r=void 0===t?[]:t;if(_o.a.selection.singleRange(e)&&1===r.length)this.insertNewLine();else{var n=this.getText(),a=[];this.initInputRawData=null,this.handleExitInput(),r.forEach((function(e){for(var t=e.startRowIndex,r=e.endRowIndex,o=e.startColIndex,i=e.endColIndex,s=t;s<=r;s+=1)for(var l=o;l<=i;l+=1)a.push({userEnterValue:n,colIndex:l,rowIndex:s})})),e.requestApi.userRangeEnter(a)}}}},{key:"initInputChangeEvent",value:function(e){var t=this;e.on(e.EVENT.VALUE_CHANGE,(function(){t.emitter.emit(t.EVENT.VALUE_CHANGE)})),e.on(e.EVENT.SELECTION_CHANGE,(function(){t.emitter.emit(t.EVENT.SELECTION_CHANGE)}))}},{key:"cancelInertialScroll",value:function(){var e;null===(e=this.slideOperate)||void 0===e||e.cancelAnimationFrame()}},{key:"updateInputStagePosition",value:function(){var e;this.isInputtingState()&&this.spreadsheet.activeSheetId===(null===(e=this.initInputRawData)||void 0===e?void 0:e.sheetId)&&this.tableInputStage.update()}},{key:"hideInputStageIfNeed",value:function(){var e=this.tableInputStage.stageElement.getBoundingClientRect().top,t=this.clientRect;e>t.height+t.distanceY-(yr.a.isMobile?this.areaData.row.flow.displayPadding:0)&&this.tableInputStage.hide()}},{key:"commitTableInputData",value:function(){var e,t,r;if(this.initInputRawData){var n=this.initInputRawData,a=n.sheetId,o=n.row,i=n.col,s=n.editValue,l=n.textFormatRuns;if(Object(dn.a)(o)&&Object(dn.a)(i)){var c=this.tableInputStage.extractInputData(),u=(null===(e=this.initInputRawData.cellFormat)||void 0===e?void 0:e.getTextFormat())||null,d=c.textFormatInfos?ja(c.textFormatInfos,u):null,h=c.mentionDetails?function(e){if(!e||!e.length)return null;var t={};return e.forEach((function(e){t[e.mentionId]=new ma.a(e)})),t}(c.mentionDetails):null,f=String.fromCharCode(10),p=c.text!==s,_=!function(e,t,r){var n,a=e.activeSheet.getCellDataAtPosition(t,r),o=null===a||void 0===a||null===(n=a.getEffectiveValue())||void 0===n?void 0:n.type;return o===wa.a.NUMBER||o===wa.a.BOOL}(this.spreadsheet,o,i)&&!function(e,t){if(Sa(e)&&Sa(t))return!0;if(e&&t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++){var n=e[r],a=t[r];if(!n.equal(a))return!1}return!0}return!1}(d,l),m=null===(t=this.spreadsheet.sheetManager.getSheetBySheetId(a))||void 0===t?void 0:t.getCellDataAtPosition(o,i),v=(null===m||void 0===m||null===(r=m.getMetadata())||void 0===r?void 0:r.customDataType)===mo.o.PROGRESS,g=c.text;v&&/^[\d\\.]+$/.test(g)&&(g="".concat(g,"%")),p||_||/^=(rand|now)/i.exec(c.text)?this.modifyCellBroker.setCellProperties({sheetId:a,rowIndex:o,colIndex:i,text:g,isTextChanged:p,textFormatRuns:d,isTextFormatRunsChanged:_,mentionDetailsMap:h}):c.text&&c.text.indexOf(f)>=0?this.modifyCellBroker.setCellTextAutoWrap(o,i,a):this.modifyCellBroker.setCellProperties({sheetId:a,rowIndex:o,colIndex:i,text:g,isTextChanged:p,textFormatRuns:d,isTextFormatRunsChanged:_,mentionDetailsMap:h})}}}},{key:"restart",value:function(){this.blur()}},{key:"EVENT",get:function(){return e.EVENT}},{key:"alloyRTE",get:function(){return this.tableInputStage.alloyRTE}},{key:"activeEditor",get:function(){return this.tableInputStage.alloyRTE}},{key:"cellData",get:function(){return this.initInputRawData}},{key:"canEdit",get:function(){return this.sheetStatus.canEdit}},{key:"isNormalSelectDataValid",get:function(){return this.normalSelectData.isValid()}},{key:"isFormula",get:function(){return this.variables.type===bn.b.FORMULA}}]),e}();vo.EVENT={ENTER_INPUT:"ENTER_INPUT",EXIT_INPUT:"EXIT_INPUT",VALUE_CHANGE:"VALUE_CHANGE",SELECTION_CHANGE:"SELECTION_CHANGE",FOCUS:"FOCUS"};var go=vo,bo=r("../packages/lib/Keyboard.ts"),yo=function(){function e(t){var r=this;Object(n.a)(this,e),this.exitInputDiscardChange=function(e){e.preventDefault(),r.inputManager.handleExitInput({discard:!0})},this.exitInputStatusPreventDefault=function(e){e.preventDefault(),r.inputManager.handleExitInput()},this.exitInputStatus=function(e){r.inputManager.handleExitInput()},this.insertNewline=function(e){e.preventDefault(),r.inputManager.insertNewLine()},this.stopPropagation=function(e){e.stopPropagation()},this.arrowKeyHandler=function(e){var t=r.inputManager;!t.isInputtingQuick()||e.keyCode===bo.c.KEYS.LEFT&&e.code!==e.key?e.stopPropagation():t.handleExitInput()},this.boldFormatHandler=function(e){e.stopPropagation(),e.preventDefault(),r.inputManager.format("bold")},this.italicFormatHandler=function(e){e.stopPropagation(),e.preventDefault(),r.inputManager.format("italic")},this.underlineFormatHandler=function(e){e.stopPropagation(),e.preventDefault(),r.inputManager.format("underline")},this.strikeThroughFormatHandler=function(e){e.stopPropagation(),e.preventDefault(),r.inputManager.format("strikeThrough")},this.handleUndo=function(e){e.stopPropagation(),e.preventDefault(),r.inputManager.undo()},this.handleRedo=function(e){e.stopPropagation(),e.preventDefault(),r.inputManager.redo()},this.handleMetaKeyEnter=function(e){e.preventDefault(),r.inputManager.handleMetaKeyEnter()},this.handleHomeAndEnd=function(e){var t=r.inputManager;t.isInputtingQuick()&&r.inputManager.handleExitInput(),t.isInputtingStable()&&e.stopPropagation()},this.inputManager=t.inputManager}return Object(a.a)(e,[{key:"initEvent",value:function(){this.inputManager.emitter.on(this.inputManager.EVENT.ENTER_INPUT,this.handleEnterInputEvent),this.inputManager.emitter.on(this.inputManager.EVENT.EXIT_INPUT,this.handleExitInputEvent)}},{key:"baseKeyboardBindings",get:function(){return[{key:bo.b,ignore:!0,handler:this.stopPropagation},{key:bo.c.KEYS.CONTROL,ignore:!0,handler:this.stopPropagation},{key:bo.c.KEYS.BACKSPACE,ignore:!0,handler:this.stopPropagation},{key:bo.c.KEYS.DELETE,ignore:!0,handler:this.stopPropagation},{key:"a",shortKey:!0,handler:this.stopPropagation},{key:bo.c.KEYS.UP,ignore:!0,handler:this.arrowKeyHandler},{key:bo.c.KEYS.DOWN,ignore:!0,handler:this.arrowKeyHandler},{key:bo.c.KEYS.LEFT,ignore:!0,handler:this.arrowKeyHandler},{key:bo.c.KEYS.RIGHT,ignore:!0,handler:this.arrowKeyHandler},{key:bo.c.KEYS.ENTER,ctrlKey:!0,handler:this.handleMetaKeyEnter},{key:bo.c.KEYS.ENTER,metaKey:!0,handler:this.handleMetaKeyEnter},{key:bo.c.KEYS.ENTER,altKey:!0,handler:this.insertNewline},{key:bo.c.KEYS.ENTER,handler:this.exitInputStatusPreventDefault},{key:bo.c.KEYS.ENTER,shiftKey:!0,handler:this.exitInputStatusPreventDefault},{key:bo.c.KEYS.TAB,handler:this.exitInputStatusPreventDefault},{key:bo.c.KEYS.TAB,shiftKey:!0,handler:this.exitInputStatusPreventDefault},{key:"z",shortKey:!0,handler:this.handleUndo},{key:"z",shortKey:!0,shiftKey:!0,handler:this.handleRedo},{key:"y",shortKey:!0,handler:this.handleRedo},{key:bo.c.KEYS.HOME,handler:this.handleHomeAndEnd},{key:bo.c.KEYS.END,handler:this.handleHomeAndEnd},{key:bo.c.KEYS.SPACE,shiftKey:!0,ctrlKey:!yr.a.isMac,handler:this.stopPropagation},{key:bo.c.KEYS.SPACE,altKey:!0,ctrlKey:!yr.a.isMac,handler:this.stopPropagation},{key:bo.c.KEYS.SPACE_SAFARI,altKey:!0,handler:this.stopPropagation}]}}]),e}();function wo(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var Ro=function(e){Object(i.a)(r,e);var t=wo(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e)).handleEnterInputEvent=function(){a.inputManager.alloyRTE.keyboard.addBindings(a.alloyRTEKeyboardBindings),a.keyboard.addBindings(a.documentKeyboardBindings)},a.handleExitInputEvent=function(){a.inputManager.alloyRTE.keyboard.removeBindings(a.alloyRTEKeyboardBindings),a.keyboard.removeBindings(a.documentKeyboardBindings)},a.normalSelectData=e.normalSelectData,a.keyboard=new bo.c({root:window.document}),a.initEvent(),a}return Object(a.a)(r,[{key:"alloyRTEKeyboardBindings",get:function(){return[].concat(Object(lt.a)(this.baseKeyboardBindings),[{key:"b",shortKey:!0,handler:this.boldFormatHandler},{key:"i",shortKey:!0,handler:this.italicFormatHandler},{key:"u",shortKey:!0,handler:this.underlineFormatHandler},{key:"d",shortKey:!0,handler:this.strikeThroughFormatHandler},{key:"5",ctrlKey:!0,handler:this.strikeThroughFormatHandler}])}},{key:"documentKeyboardBindings",get:function(){return[{key:bo.c.KEYS.ESCAPE,ignore:!0,handler:this.exitInputDiscardChange}]}}]),r}(yo);function Eo(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var Co,jo,Oo=function(e){Object(i.a)(r,e);var t=Eo(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e)).handleEnterInputEvent=function(){a.inputManager.alloySTE.keyboard.addBindings(a.baseKeyboardBindings)},a.handleExitInputEvent=function(){a.inputManager.alloySTE.keyboard.removeBindings(a.baseKeyboardBindings)},a.initEvent(),a}return r}(yo),So=function(){function e(t){var r=this;Object(n.a)(this,e),this.initMouseEvent=function(){var e;r.mouseOperate.emitter.on(r.mouseOperate.EVENT.DOWN,r.handleMouseDown),null===(e=r.touchOperate)||void 0===e||e.emitter.on(r.touchOperate.EVENT.TAP,r.handleMouseDown)},this.onKeyDown=function(e,t){(0,r.inputManager.isInputtingState)()||r.checkCanEnterQuick(e)&&(yr.a.isIPad?setTimeout((function(){r.inputManager.alloyRTE.focus(),r.handleQuickInput(e.key)})):r.handleQuickInput(r.getFirstChar(e,t)))},this.getFirstChar=function(e,t){var r=yr.a.isSafari,n=yr.a.isMac,a=yr.a.isFirefox,o=null;return(r&&"compositionstart"!==t||n&&a&&"boolean"===typeof e.isComposing&&!e.isComposing&&"Process"!==e.key)&&("string"===typeof e.key||"number"===typeof e.key?(o=String(e.key),e.preventDefault()):o=null),o},this.handleQuickInput=function(e){var t=r.inputManager;t.switchInputStatus(bn.a.QUICK_INPUT),t.handleEnterInput(),(e||yr.a.isIPad)&&t.alloyRTE.setText(e,void 0,!0),(yr.a.isIE||yr.a.isOldEdge)&&t.alloyRTE.collapseToEnd()},this.initQuickInputEvent=function(){var e=yr.a.isWindows,t=yr.a.isIPad,n=yr.a.isFirefox,a=yr.a.isSafari,o=yr.a.isIE,i=yr.a.isChromiumEdge,s=yr.a.isElectronTencentDocsClientVersionAboveOrEqual,l=r.inputManager.alloyRTE,c=yr.a.isIPad?r.operateBoard.board:l.input;(n||a||o)&&!t&&c.addEventListener("compositionstart",(function(e){r.onKeyDown(e,"compositionstart")})),e&&(i||s("2.1.0"))&&r.initQuickInputForEdge(c),c.addEventListener("keydown",(function(e){r.onKeyDown(e,"keydown")}))},this.handleMouseDown=function(){var e=r.inputManager,t=e.tableInputMountDom;if(!((0,e.isInputtingState)()||r.inputManager.hasFocus()&&yr.a.isIPad)){var n=yr.a.isIPad?r.operateBoard.board:r.inputManager.alloyRTE;window.setTimeout((function(){r.inputManager.isInputtingState()||(document.activeElement===t||t.contains(document.activeElement))&&n.focus()}),0)}},Object.assign(this,t),this.initQuickInputEvent(),this.initMouseEvent()}return Object(a.a)(e,[{key:"initQuickInputForEdge",value:function(e){var t,r,n=this;e.addEventListener("keyup",(function(e){var a=Date.now();t&&a-r<1e3&&t.key===bo.b||n.onKeyDown(e,"keyup"),t=e,r=a}))}},{key:"checkCanEnterQuick",value:function(e){var t=!(Da(e)||e.metaKey||e.ctrlKey||e.altKey||this.checkSpecial(e)),r=this.normalSelectData,n=r.activeRow,a=r.activeCol,o=!Object(mo.w)(this.spreadsheet.activeSheet,n,a);return t&&o}},{key:"checkSpecial",value:function(e){return e.shiftKey&&(16===e.keyCode||229===e.keyCode&&"Process"!==e.key||32===e.keyCode)||"CapsLock"===e.key||"Unidentified"===e.code||!yr.a.isIE&&!yr.a.isOldEdge&&"Unidentified"===e.key||"Pause"===e.key&&"Pause"===e.code}}]),e}(),Do=function e(t){var r=this;Object(n.a)(this,e),this.initMouseEvent=function(){r.mouseOperate.emitter.on(r.mouseOperate.EVENT.DBLCLICK,r.handleDoubleClick),r.mouseOperate.emitter.on(r.mouseOperate.EVENT.DOWN,r.handleMouseDown)},this.handleMouseDown=function(e){var t=r.inputManager,n=t.isFormula;t.cellData;(0,t.isInputtingState)()&&(e.e.preventDefault(),n||r.inputManager.handleExitInput())},this.handleDoubleClick=function(e){r.inputManager.canEdit&&e.isHoverCell()&&(Object(mo.x)(r.spreadsheet.activeSheet,e.currRow,e.currCol)||r.inputManager.handleEnterInput())},Object.assign(this,t),this.initMouseEvent()},xo=r("../packages/mutation/src/index.ts");function ko(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function To(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ko(Object(r),!0).forEach((function(t){Object(F.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ko(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ao(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}!function(e){e.VALUE="value",e.FORMAT="format"}(Co||(Co={})),function(e){e.ENTER_FORMULA_INPUT="enter_formula_input",e.EXEC_FORMAT="exec_format",e.SYNC_CONTENT="sync_content"}(jo||(jo={}));var Io=function(e){Object(i.a)(r,e);var t=Ao(r);function r(e){var a,i,s,c;return Object(n.a)(this,r),(c=t.call(this,e)).position=null,c.focus=function(){c.isInputtingToolbar()?c.alloySTE.focus():Object(o.a)((a=Object(Te.a)(c),Object(l.a)(r.prototype)),"focus",a).call(a)},c.handleEnterInput=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.normalSelectData.activeRow,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c.normalSelectData.activeCol;if(c.sheetStatus.canEdit){var n=c.tableView.getCellViewAtPosition(e,t);if(n){n.mergeParent&&(e+=n.mergeParent.y,t+=n.mergeParent.x,n=c.tableView.getCellViewAtPosition(e,t)),c.focus();var a=50;c.scrollCellFullDisplay(e,t,a,a),c.initInputRawData=Ra(c.spreadsheet,e,t,c.isInputtingQuick()),c.position=c.getPosition(c.initInputRawData.row,c.initInputRawData.col),c.tableInputStage.show({initInputRawData:c.initInputRawData,cellView:n}),Object(o.a)((i=Object(Te.a)(c),Object(l.a)(r.prototype)),"handleEnterInput",i).call(i)}}},c.handleExitInput=function(e){(null===e||void 0===e?void 0:e.discard)&&c.updateFormulaInputStageContent(),c.alloyRTE.setActive(!1),c.alloySTE.setActive(!1),Object(o.a)((s=Object(Te.a)(c),Object(l.a)(r.prototype)),"handleExitInput",s).call(s,e),window.setTimeout((function(){c.focus()}),0)},c.handleModifySelection=function(){c.variables.type!==bn.b.FORMULA&&(c.updateFormulaInputStageContent(),c.updateFormulaInputStageEditable())},c.handleValueChange=function(e){if(e.source!==c.alloyRTE.SOURCE.SILENT&&c.isInputtingState()){var t=c.alloyRTE.getText();c.alloySTE.setText(t,c.alloyRTE.SOURCE.SILENT)}},c.handleSyncOutFormulaInput=function(e){var t;switch(e.cmd){case jo.ENTER_FORMULA_INPUT:if(!c.sheetStatus.canEdit)return;if(Object(mo.w)(c.spreadsheet.activeSheet,c.normalSelectData.activeRow,c.normalSelectData.activeCol))return;c.isInputtingState()||(c.handleEnterInput(),c.alloySTE.focus()),c.alloySTE.setActive(!0),c.variables.switchStatus(bn.a.TOOLBAR_INPUT);break;case jo.EXEC_FORMAT:if(!e.data)return;c.focus(),c.alloyRTE.setSelection(e.data.range||null),c.alloyRTE.format(e.data.value);break;case jo.SYNC_CONTENT:c.alloyRTE.setText(null===(t=e.data)||void 0===t?void 0:t.value,c.alloyRTE.SOURCE.SILENT);break;default:throw new Error("Error: cmd not found!")}},c.handleAfterMutationRun=function(e){if(!c.isInputtingState()){var t=c.normalSelectData,r=t.activeRow,n=t.activeCol;if(e.mutation.id===xo.g.SET_CELL_PROPERTIES_MUTATION||e.mutation.id===xo.g.SET_RANGE_MUTATION){var a=new ln.b(e.sheetId,r,r,n,n);e.mutation.gridRange.contain(a)&&c.updateFormulaInputStageContent()}}},c.handleSwitchSheet=function(e){var t;if(c.isInputtingState())if(c.variables.type===bn.b.FORMULA){if(c.tableInputStage.hide(),e!==(null===(t=c.initInputRawData)||void 0===t?void 0:t.sheetId)&&!c.isInputtingToolbar()){var r=c.alloyRTE.getSelection();return c.variables.switchStatus(bn.a.TOOLBAR_INPUT),c.alloySTE.focus(),void c.alloySTE.setSelection(r)}ft.c.sheetsBar.one("switchSheetEnd",(function(){var t;if(e===(null===(t=c.initInputRawData)||void 0===t?void 0:t.sheetId)){var r=c.alloySTE.getSelection(),n=c.alloySTE.getText();c.tableInputStage.update(),c.variables.switchStatus(bn.a.STABLE_INPUT),c.alloyRTE.focus(),c.alloyRTE.setText(n),c.alloyRTE.setSelection(r)}}))}else c.handleExitInput()},c.handleInsertRowCol=function(e){if(c.variables.status!==bn.a.DEFAULT){var t=e.index,r=e.amount,n=e.type,a=c.initInputRawData.row,o=c.initInputRawData.col,i=a,s=o;n===$r.a.ROWS&&t<=a?i+=r:n===$r.a.COLUMNS&&t<=o&&(s+=r),c.initInputRawData.row=i,c.initInputRawData.col=s,c.scrollTableIfNeedMakeInputPositionStable(),c.tableInputStage.update({row:i,col:s})}},c.handleDeleteRowCol=function(e){if(c.variables.status!==bn.a.DEFAULT){var t=e.index,r=e.amount,n=e.type,a=c.initInputRawData.row,o=c.initInputRawData.col,i=t,s=t+r-1,l=a,u=o;n===$r.a.ROWS&&(i<=a&&a<=s?l=-1:i<=a&&s<a&&(l-=r)),n===$r.a.COLUMNS&&(i<=o&&o<=s?u=-1:i<=o&&s<o&&(u-=r)),c.initInputRawData.row=l,c.initInputRawData.col=u,c.scrollTableIfNeedMakeInputPositionStable(),-1===l||-1===u?c.tableInputStage.showTooltip(ia.INPUT_DELETE):c.tableInputStage.update({row:l,col:u})}},c.handleSetRowHeightColWidth=function(){c.variables.status!==bn.a.DEFAULT&&(c.scrollTableIfNeedMakeInputPositionStable(),c.tableInputStage.update())},c.handleSetRowVisibleColVisible=function(e){c.variables.status!==bn.a.DEFAULT&&(c.scrollTableIfNeedMakeInputPositionStable(),c.tableInputStage.update(),(c.spreadsheet.activeSheet.data.isRowHidden(c.initInputRawData.row)||c.spreadsheet.activeSheet.data.isColHidden(c.initInputRawData.col))&&c.traverseRangesCheckHit(e.ranges,c.initInputRawData.row,c.initInputRawData.col)&&c.tableInputStage.showTooltip(ia.INPUT_HIDE))},c.mouseOperate=e.mouseOperate,c.formulaInputMountDom=e.formulaInputMountDom,c.mutationBehavior=e.mutationBehavior,c.initInputStages(),c.initEvent(),new Ro({inputManager:Object(Te.a)(c),normalSelectData:e.normalSelectData}),new Oo({inputManager:Object(Te.a)(c)}),new So({inputManager:Object(Te.a)(c),mouseOperate:c.mouseOperate,spreadsheet:c.spreadsheet,normalSelectData:c.normalSelectData}),new Do({inputManager:Object(Te.a)(c),mouseOperate:c.mouseOperate,spreadsheet:c.spreadsheet}),c}return Object(a.a)(r,[{key:"undo",value:function(){this.isInputtingToolbar()?this.alloySTE.undo():Object(o.a)(Object(l.a)(r.prototype),"undo",this).call(this)}},{key:"redo",value:function(){this.isInputtingToolbar()?this.alloySTE.redo():Object(o.a)(Object(l.a)(r.prototype),"redo",this).call(this)}},{key:"isComposing",value:function(){return this.isInputtingToolbar()?this.alloySTE.isComposing():Object(o.a)(Object(l.a)(r.prototype),"isComposing",this).call(this)}},{key:"hasFocus",value:function(){return this.isInputtingToolbar()?this.alloySTE.hasFocus():Object(o.a)(Object(l.a)(r.prototype),"hasFocus",this).call(this)}},{key:"blur",value:function(){this.isInputtingToolbar()?this.alloySTE.blur():Object(o.a)(Object(l.a)(r.prototype),"blur",this).call(this)}},{key:"format",value:function(e,t){if(this.isInputtingState()){if(this.isInputtingToolbar()){var n=this.alloySTE.getSelection();this.focus(),this.alloyRTE.setSelection(n)}Object(o.a)(Object(l.a)(r.prototype),"format",this).call(this,e,t)}}},{key:"getText",value:function(){return this.isInputtingToolbar()?this.alloySTE.getText():Object(o.a)(Object(l.a)(r.prototype),"getText",this).call(this)}},{key:"setText",value:function(e,t){this.isInputtingToolbar()?this.alloySTE.setText(e,t):Object(o.a)(Object(l.a)(r.prototype),"setText",this).call(this,e,t)}},{key:"insertNewLine",value:function(){this.isInputtingToolbar()?this.alloySTE.insertNewLine():Object(o.a)(Object(l.a)(r.prototype),"insertNewLine",this).call(this)}},{key:"getSelection",value:function(){return this.isInputtingToolbar()?this.alloySTE.getSelection():Object(o.a)(Object(l.a)(r.prototype),"getSelection",this).call(this)}},{key:"setSelection",value:function(e){this.isInputtingToolbar()?this.alloySTE.setSelection(e):Object(o.a)(Object(l.a)(r.prototype),"setSelection",this).call(this,e)}},{key:"initInputStages",value:function(){this.formulaInputStage=new Sn({alloyExcel:this.alloyExcel,resize:this.resize,sheetStatus:this.sheetStatus,emitter:this.emitter,mountDom:this.formulaInputMountDom}),this.updateFormulaInputStageContent(),this.tableInputStage=new fa({spreadsheet:this.spreadsheet,sheetStatus:this.sheetStatus,mountDom:this.tableInputMountDom,emitter:this.emitter,areaData:this.areaData,rowcolAccessor:this.rowcolAccessor,scale:this.scale,clientRect:this.clientRect,headSize:this.headSize,tableView:this.tableView,paragraphAccessor:this.paragraphAccessor,saveContent:Object(o.a)(Object(l.a)(r.prototype),"handleExitInput",this).bind(this)}),this.initInputChangeEvent(this.alloySTE),this.initInputChangeEvent(this.alloyRTE),this.mutexManagement.addMutexComponent(de.a.INPUT,this.tableInputStage)}},{key:"initEvent",value:function(){this.normalSelectData.emitter.on(this.normalSelectData.EVENT.MODIFY_SELECTION,this.handleModifySelection),this.emitter.on(r.EVENT.SYNC_OUT_FORMULA_INPUT,this.handleSyncOutFormulaInput),this.mutationBehavior.emitter.on(this.mutationBehavior.EVENT.AFTER_MUTATION_RUN,this.handleAfterMutationRun),this.alloyRTE.on(this.alloyRTE.EVENT.VALUE_CHANGE,this.handleValueChange),ft.c.sheetsBar.listen("switchSheetStart",this.handleSwitchSheet),this.dataCallView.onInsertRow(this.handleInsertRowCol),this.dataCallView.onInsertCol(this.handleInsertRowCol),this.dataCallView.onDeleteRow(this.handleDeleteRowCol),this.dataCallView.onDeleteCol(this.handleDeleteRowCol),this.dataCallView.onSetRowHeight(this.handleSetRowHeightColWidth),this.dataCallView.onSetColWidth(this.handleSetRowHeightColWidth),this.dataCallView.onSetRowVisible(this.handleSetRowVisibleColVisible),this.dataCallView.onSetColVisible(this.handleSetRowVisibleColVisible)}},{key:"scrollTableIfNeedMakeInputPositionStable",value:function(){if(this.position&&this.initInputRawData){var e=this.initInputRawData.row,t=this.initInputRawData.col,r=this.getPosition(e,t),n=r.left-this.position.left,a=r.top-this.position.top;this.position=r,this.scrollApi.scrollByPixel({areaX:"flow",areaY:"flow",diffX:n>>0,diffY:a>>0},!0)}}},{key:"traverseRangesCheckHit",value:function(e,t,r){for(var n=0;n<e.length;n++){var a=e[n],o=a.dimension,i=a.startIndex,s=a.endIndex;if(o===$r.a.ROWS&&i<=t&&t<=s)return!0;if(o===$r.a.COLUMNS&&i<=r&&r<=s)return!0}return!1}},{key:"getPosition",value:function(e,t){return{left:this.areaData.getDisplayGlobalLeftByCol(t),top:this.areaData.getDisplayGlobalTopByRow(e)}}},{key:"scrollCellFullDisplay",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=this.areaData.getDisplayViewLeftByCol(t),o=this.areaData.getDisplayViewTopByRow(e),i=this.getCellViewportSize(e,t),s=i.width,l=i.height,c=this.getAreaVisibleRectByCell(e,t),u=c.visibleLeft,d=c.visibleTop,h=c.visibleWidth,f=c.visibleHeight,p=this.tableView.getCellViewAtPosition(e,t),_=e,m=t;if((null===p||void 0===p?void 0:p.mergeData)&&(_+=p.mergeData.rowCount-1,m+=p.mergeData.colCount-1),s>=h)this.scrollApi.scrollToRenderFrom({col:t});else{var v=h-s,g=v>=2*n?n:v/2;(a<u||a+s+g>u+h)&&this.scrollApi.scrollToVisible({col:m,x:g})}if(l>=f)this.scrollApi.scrollToRenderFrom({row:e});else{var b=f-l,y=b>=2*r?r:b/2;(o<d||o+l+y>d+f)&&this.scrollApi.scrollToVisible({row:_,y:y})}}},{key:"getAreaVisibleRectByCell",value:function(e,t){var r=this.areaData.inFlowColArea(t)?this.areaData.col.flow.viewSize:this.areaData.col.frozen.viewSize,n=this.areaData.inFlowRowArea(e)?this.areaData.row.flow.viewSize:this.areaData.row.frozen.viewSize;return{visibleLeft:this.areaData.inFlowColArea(t)?this.areaData.getDisplayGlobalLeftByCol(this.areaData.col.flow.from):0,visibleTop:this.areaData.inFlowRowArea(e)?this.areaData.getDisplayGlobalTopByRow(this.areaData.row.flow.from):0,visibleWidth:r,visibleHeight:n}}},{key:"getCellViewportSize",value:function(e,t){var r=this.tableView.getCellViewAtPosition(e,t);return{width:Object(Oe.b)(this.rowcolAccessor,r,t),height:Object(Oe.a)(this.rowcolAccessor,r,e)}}},{key:"updateFormulaInputStageContent",value:function(){var e=this.normalSelectData,t=e.activeRow,n=e.activeCol,a=Ra(this.spreadsheet,t,n);this.emitter.emit(r.EVENT.SYNC_IN_FORMULA_INPUT,{rowIndex:t,colIndex:n,value:a.editValue})}},{key:"updateFormulaInputStageEditable",value:function(){var e=this.normalSelectData,t=e.activeRow,r=e.activeCol,n=!Object(mo.w)(this.spreadsheet.activeSheet,t,r);this.alloySTE.setEditable(n)}},{key:"EVENT",get:function(){return r.EVENT}},{key:"alloySTE",get:function(){return this.formulaInputStage.alloySTE}},{key:"activeEditor",get:function(){return this.isInputtingToolbar()?this.alloySTE:this.alloyRTE}}]),r}(go);Io.EVENT=To(To({},go.EVENT),{},{SYNC_IN_FORMULA_INPUT:"sync_in_formula_input",SYNC_OUT_FORMULA_INPUT:"sync_out_formula_input"});var No=Io,Lo=r("../node_modules/lodash/set.js"),Po=r.n(Lo),Mo=r("../node_modules/lodash/unset.js"),Vo=r.n(Mo);function zo(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var Bo,Fo=function(e){Object(i.a)(r,e);var t=zo(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e))._rowData=Object(F.a)({},"error_tip_data",[]),a}return Object(a.a)(r,[{key:"refresh",value:function(){this._rowData=Object(F.a)({},"error_tip_data",[])}},{key:"getErrorTipFlags",value:function(e,t){var r;return(null===(r=this.data[e])||void 0===r?void 0:r[t])||0}},{key:"setErrorTipFlags",value:function(e,t,r){r?Po()(this.data,[e,t],r):this.deleteErrorTipFlags(e,t)}},{key:"deleteErrorTipFlags",value:function(e,t){Vo()(this.data,[e,t]),this.data[e]&&0===Object.keys(this.data[e]).length&&delete this.data[e]}},{key:"data",get:function(){return this._rowData.error_tip_data}}]),r}(oe.a),Ho=r("./src/core/view/level-1/drag-operate/index.tsx"),Uo=function e(t){Object(n.a)(this,e),this.clearCache=function(){Ur.a.clearCache()},Object.assign(this,t),t.event.sheetsBar.listen("switchSheetEnd",this.clearCache)},Wo=function(){function e(t){var r=this;Object(n.a)(this,e),this._originRow=null,this._originCol=null,this._focusRow=null,this._focusCol=null,this._handleDown=function(e){if(r._checkDownValid())if(e.e.shiftKey)r._handleDownWithShift(e);else{var t,n=e.currRow,a=e.currCol;e.e.which&&1===e.e.which&&(r._mouseOperate.emitter.on(Nt.a.EVENT.MOVE,r._handleMove),r._mouseOperate.emitter.on(Nt.a.EVENT.UP,r._handleUp)),r._originRow=n,r._originCol=a,-1===n&&-1===a?(r._cacheActivation={row:0,col:0},t={activation:r._cacheActivation}):-1===a?(r._cacheActivation={row:n,col:0},t={yRange:[n,n],activation:r._cacheActivation}):-1===n?(r._cacheActivation={row:0,col:a},t={xRange:[a,a],activation:r._cacheActivation}):(a===Number.MAX_SAFE_INTEGER&&(a=r._areaData.getLastColInView()),n===Number.MAX_SAFE_INTEGER&&(n=r._areaData.getLastRowInView()),r._cacheActivation={row:n,col:a},t={yRange:[n,n],xRange:[a,a],activation:r._cacheActivation}),r._startSelect(r._selectData,t,e.e[bo.a]),r._readySelect(r._selectData)}},this._handleMove=function(){if(null===r._selectData)throw new Error("must bind selectData in SelectCells module");if(!r._operateData.stopPropagation){var e=r._operateData.currRow,t=r._operateData.currCol;if(-1!==r._originRow||-1!==r._originCol){var n=void 0,a=void 0;-1!==r._originCol&&(n=r._handleMoveCalcXRange(t)),-1!==r._originRow&&(a=r._handleMoveCalcYRange(e));var o={xRange:n,yRange:a,activation:r._cacheActivation};r._updateSelect(r._selectData,o)}}},this._handleUp=function(){r._originRow=null,r._originCol=null,r._focusRow=null,r._focusCol=null,r._endSelect(r._selectData),r._mouseOperate.emitter.off(Nt.a.EVENT.MOVE,r._handleMove),r._mouseOperate.emitter.off(Nt.a.EVENT.UP,r._handleUp)},this._mouseOperate=t.mouseOperate,this._operateData=t.operateData,this._selectData=t.selectData,this._areaData=t.areaData,this._rowcolAccessor=t.rowcolAccessor,this._readySelect=t.readySelect,this._startSelect=t.startSelect,this._updateSelect=t.updateSelect,this._endSelect=t.endSelect,this._mouseOperate.emitter.on(Nt.a.EVENT.DOWN,this._handleDown)}return Object(a.a)(e,[{key:"changeSelectData",value:function(e){this._selectData=e}},{key:"_checkDownValid",value:function(){if(null===this._selectData)throw new Error("must bind selectData in SelectCells module");return!this._operateData.stopPropagation&&(!this._operateData.isOverTable()&&(2!==this._operateData.e.button||!Object(zt.i)(this._operateData.currRow,this._operateData.currCol,this._selectData)))}},{key:"_handleDownWithShift",value:function(e){var t,r,n=this._selectData.activeRow,a=this._selectData.activeCol,o=e.currRow,i=e.currCol;-1===n&&(n=o),-1===a&&(a=i),-1!==i&&(t=i>a?[a,i]:[i,a]),-1!==o&&(r=o>n?[n,o]:[o,n]);var s={xRange:t,yRange:r};0===this._selectData.selectQueue.length?this._startSelect(this._selectData,s,!1):this._updateSelect(this._selectData,s)}},{key:"_handleMoveCalcXRange",value:function(e){var t=[0,0];return e===Number.MAX_SAFE_INTEGER?e=this._areaData.getLastColInView():e!==Number.MIN_SAFE_INTEGER&&-1!==e||(e=this._areaData.getFirstColInView()),this._focusCol,this._originCol>e?(t[0]=e,t[1]=Math.min(this._rowcolAccessor.getColCount()-1,this._originCol)):(t[0]=this._originCol,t[1]=Math.min(this._rowcolAccessor.getColCount()-1,e)),this._focusCol=e,t}},{key:"_handleMoveCalcYRange",value:function(e){var t=[0,0];return e===Number.MAX_SAFE_INTEGER?e=this._areaData.getLastRowInView():e!==Number.MIN_SAFE_INTEGER&&-1!==e||(e=this._areaData.getFirstRowInView()),this._focusRow,this._originRow>=e?(t[0]=e,t[1]=Math.min(this._rowcolAccessor.getRowCount()-1,this._originRow)):(t[0]=this._originRow,t[1]=Math.min(this._rowcolAccessor.getRowCount()-1,e)),this._focusRow=e,t}}]),e}(),Go=r("./src/core/view/utils/lambda.ts");function Yo(e){var t=e.activeRow,r=e.activeCol;if(t<0||r<0)throw new Error("\u79fb\u52a8\u6fc0\u6d3b\u533a\u57df\u5f02\u5e38")}function Xo(e,t,r,n,a){var o=e.getCellViewAtPosition(r,n);if(!o)return null;var i=null,s=a>0?zt.g:zt.h,l=a>0?function(e){for(var t=e.getRowCount()-1;t>=0;){if(!e.isRowHidden(t))return t;t-=1}return null}(t):function(e){for(var t=0,r=e.getRowCount();t<r;){if(!e.isRowHidden(t))return t;t+=1}return null}(t);if(null===l)return null;if(o.isEmpty())i=s({tableView:e,accessor:t},r+a,n,l,ti);else{var c=s(t,r+a,n,l,Go.e);if(null===c)return null;var u=e.getCellViewAtPosition(c,n);if(!u)return null;if(u.isEmpty())i=s({tableView:e,accessor:t},c+a,n,l,ti);else if(null!==(i=s({tableView:e,accessor:t},r,n,l,ri)))i=(a>0?zt.h:zt.g)({tableView:e,accessor:t},i-a,n,r,ti)}return null==i&&(i=l),i}function Ko(e,t,r,n,a){var o=e.getCellViewAtPosition(r,n);if(!o)return null;var i=null,s=a>0?zt.f:zt.e,l=a>0?function(e){for(var t=e.getColCount()-1;t>=0;){if(!e.isColHidden(t))return t;t-=1}return null}(t):function(e){for(var t=0,r=e.getColCount();t<r;){if(!e.isColHidden(t))return t;t+=1}return null}(t);if(null===l)return null;if(o.isEmpty())i=s({tableView:e,accessor:t},r,n+a,l,$o);else{var c=s(t,r,n+a,l,Go.e);if(null===c)return null;var u=e.getCellViewAtPosition(r,c);if(!u)return null;if(u.isEmpty())i=s({tableView:e,accessor:t},r,c+a,l,$o);else if(null!==(i=s({tableView:e,accessor:t},r,n,l,ei)))i=(a>0?zt.e:zt.f)({tableView:e,accessor:t},r,i-a,n,$o)}return null==i&&(i=l),i}function qo(e,t,r){var n=e.tableView,a=e.accessor,o=n.getCellViewAtPosition(r,t);if(null===o)throw new Error("getCellViewAtPosition error!");return(!o.mergeParent||0===o.mergeParent.x)&&Object(Go.e)(a,t,r)}function Qo(e,t,r){var n=e.tableView,a=e.accessor,o=n.getCellViewAtPosition(r,t);if(null===o)throw new Error("getCellViewAtPosition error!");if(o.mergeParent&&n.getCellViewAtPosition(r+o.mergeParent.y,t+o.mergeParent.x).mergeData.colCount!==1-o.mergeParent.x)return!1;return!(o.mergeData&&o.mergeData.colCount>1)&&Object(Go.e)(a,t,r)}function Zo(e,t,r){var n=e.tableView,a=e.accessor,o=n.getCellViewAtPosition(r,t);if(null===o)throw new Error("getCellViewAtPosition error!");return(!o.mergeParent||0===o.mergeParent.y)&&Object(Go.e)(a,t,r)}function Jo(e,t,r){var n=e.tableView,a=e.accessor,o=n.getCellViewAtPosition(r,t);if(null===o)throw new Error("getCellViewAtPosition error!");if(o.mergeParent&&n.getCellViewAtPosition(r+o.mergeParent.y,t+o.mergeParent.x).mergeData.rowCount!==1-o.mergeParent.y)return!1;return!(o.mergeData&&o.mergeData.rowCount>1)&&Object(Go.e)(a,t,r)}function $o(e,t,r){var n=e.tableView,a=e.accessor;return Object(Go.g)(n,t,r)&&Object(Go.e)(a,t,r)&&Object(Go.c)(n,t,r)}function ei(e,t,r){var n=e.tableView,a=e.accessor;return Object(Go.g)(n,t,r)&&Object(Go.e)(a,t,r)&&Object(Go.b)(n,t,r)}function ti(e,t,r){var n=e.tableView,a=e.accessor;return Object(Go.g)(n,t,r)&&Object(Go.e)(a,t,r)&&Object(Go.c)(n,t,r)}function ri(e,t,r){var n=e.tableView,a=e.accessor;return Object(Go.g)(n,t,r)&&Object(Go.e)(a,t,r)&&Object(Go.b)(n,t,r)}function ni(e,t,r,n,a){Yo(r);var o=r.activation;if(!o)throw new Error("\u79fb\u52a8\u9009\u533a\u5f02\u5e38");var i=o.col,s=o.row,l={row:s,col:i};if(n===Bo.X)if(a>0){var c=Object(zt.f)({tableView:e,accessor:t},s,i+1,t.getColCount()-1,qo);null!==c&&(l.col=c)}else{var u=Object(zt.e)({tableView:e,accessor:t},s,i-1,0,Qo);null!==u&&(l.col=u)}else if(a>0){var d=Object(zt.g)({tableView:e,accessor:t},s+1,i,t.getRowCount()-1,Zo);null!==d&&(l.row=d)}else{var h=Object(zt.h)({tableView:e,accessor:t},s-1,i,0,Jo);null!==h&&(l.row=h)}return{xRange:[l.col,l.col],yRange:[l.row,l.row],activation:l}}function ai(e,t,r,n,a){return Yo(r),n===Bo.X?function(e,t,r,n){var a,o,i,s,l=r.selectQueue[r.currentSelectIndex],c=r.activeRow,u=r.activeCol;if(l instanceof qt.a||l instanceof Qt.a)return null;if(!(l instanceof Zt.a||l instanceof Jt.a))throw new Error("\u4e0d\u53ef\u7528\u7684\u9009\u533a\u7c7b\u578b");a=l.xRange[0],o=l.xRange[1],l instanceof Zt.a?(i=0,s=t.getRowCount()-1):(i=l.yRange[0],s=l.yRange[1]);if(l instanceof Zt.a){var d=function(e,t,r,n,a){var o;if(t>0){var i=function(e,t,r,n){var a,o,i=[t,r];if(n>t){if(a=t,null===(o=Object(zt.f)(e,0,a+1,r,Go.e)))return null;i[0]=o}else{if(a=r,null===(o=Object(zt.f)(e,0,a+1,e.getColCount()-1,Go.e)))return null;i[1]=o}return i}(e,r,n,a);if(!i)return;o=i}else{var s=function(e,t,r,n){var a,o,i=[t,r];if(n<r){if(a=r,null===(o=Object(zt.e)(e,0,a-1,t,Go.e)))return null;i[1]=o}else{if(a=t,null===(o=Object(zt.e)(e,0,a-1,0,Go.e)))return null;i[0]=o}return i}(e,r,n,a);if(!s)return;o=s}return o}(t,n,a,o,u);return d?{xRange:d,activation:{row:c,col:u}}:null}var h=function(e,t,r,n,a,o,i,s){var l;l=r>0?function(e,t,r,n,a,o,i){var s,l,c=[o,i],u=[n,a];for(;;){var d=void 0;if(r>o){if(l=o,null===(d=Object(zt.f)(t,0,l+1,i,Go.e)))break;c[0]=d,s=zt.a.DISCARD}else{if(l=i,null===(d=Object(zt.f)(t,0,l+1,t.getColCount()-1,Go.e)))break;c[1]=d,s=zt.a.EXTEND}if(oi(e,r,u,c,o,i,s))break;o=r,i=c[1]}return{xRange:c,yRange:u}}(e,t,s,n,a,o,i):function(e,t,r,n,a,o,i){var s,l,c=[o,i],u=[n,a];for(;;){var d=void 0;if(r<i){if(l=i,null===(d=Object(zt.e)(t,0,l-1,o,Go.e)))break;c[1]=d,s=zt.a.DISCARD}else{if(l=o,null===(d=Object(zt.e)(t,0,l-1,0,Go.e)))break;c[0]=d,s=zt.a.EXTEND}if(oi(e,r,u,c,o,i,s))break;o=c[0],i=r}return{xRange:c,yRange:u}}(e,t,s,n,a,o,i);var c=l.xRange,u=l.yRange;return{xRange:c,yRange:u}}(e,t,n,i,s,a,o,u),f=h.xRange,p=h.yRange;return{xRange:f,yRange:p,activation:{row:c,col:u}}}(e,t,r,a):function(e,t,r,n){var a,o,i,s,l=r.selectQueue[r.currentSelectIndex],c=r.activeRow,u=r.activeCol;if(l instanceof qt.a||l instanceof Zt.a)return null;if(!(l instanceof Qt.a||l instanceof Jt.a))throw new Error("\u4e0d\u53ef\u7528\u7684\u9009\u533a\u7c7b\u578b");i=l.yRange[0],s=l.yRange[1],l instanceof Qt.a?(a=0,o=t.getColCount()-1):(a=l.xRange[0],o=l.xRange[1]);if(l instanceof Qt.a){var d=function(e,t,r,n,a){var o;if(t>0){var i=function(e,t,r,n){var a,o,i=[t,r];if(n>t){if(a=t,null===(o=Object(zt.g)(e,a+1,0,r,Go.e)))return null;i[0]=o}else{if(a=r,null===(o=Object(zt.g)(e,a+1,0,e.getRowCount()-1,Go.e)))return null;i[1]=o}return i}(e,r,n,a);if(!i)return;o=i}else{var s=function(e,t,r,n){var a,o,i=[t,r];if(n<r){if(a=r,null===(o=Object(zt.h)(e,a-1,0,t,Go.e)))return null;i[1]=o}else{if(a=t,null===(o=Object(zt.h)(e,a-1,0,0,Go.e)))return null;i[0]=o}return i}(e,r,n,a);if(!s)return;o=s}return o}(t,n,i,s,c);return d?{yRange:d,activation:{row:c,col:u}}:null}var h=function(e,t,r,n,a,o,i,s){var l;l=r>0?function(e,t,r,n,a,o,i){var s,l,c=[o,i],u=[n,a];for(;;){var d=void 0;if(r>n){if(l=n,null===(d=Object(zt.g)(t,l+1,0,a,Go.e)))break;u[0]=d,s=zt.a.DISCARD}else{if(l=a,null===(d=Object(zt.g)(t,l+1,0,t.getRowCount()-1,Go.e)))break;u[1]=d,s=zt.a.EXTEND}if(ii(e,r,u,c,n,a,s))break}return{xRange:c,yRange:u}}(e,t,s,n,a,o,i):function(e,t,r,n,a,o,i){var s,l,c=[o,i],u=[n,a];for(;;){var d=void 0;if(r<a){if(l=a,null===(d=Object(zt.h)(t,l-1,0,n,Go.e)))break;u[1]=d,s=zt.a.DISCARD}else{if(l=n,null===(d=Object(zt.h)(t,l-1,0,0,Go.e)))break;u[0]=d,s=zt.a.EXTEND}if(ii(e,r,u,c,n,a,s))break}return{xRange:c,yRange:u}}(e,t,s,n,a,o,i);var c=l.xRange,u=l.yRange;return{xRange:c,yRange:u}}(e,t,n,i,s,a,o,c),f=h.xRange,p=h.yRange;return{xRange:f,yRange:p,activation:{row:c,col:u}}}(e,t,r,a)}function oi(e,t,r,n,a,o,i){if(Object(zt.d)(e,r,n,i))if(t<n[0])n[0]=t;else if(t>n[1])n[1]=t;else if(n[0]!==a||n[1]!==o)return!0;return!1}function ii(e,t,r,n,a,o,i){if(Object(zt.d)(e,r,n,i))if(t<r[0])r[0]=t;else if(t>r[1])r[1]=t;else if(r[0]!==a||r[1]!==o)return!0;return!1}function si(e,t,r,n,a){Yo(r);var o,i,s,l=r.selectQueue[r.currentSelectIndex],c=r.activeRow,u=r.activeCol;if(l instanceof qt.a)o=li(e,t,n,a,0,t.getRowCount()-1,0,t.getColCount()-1,c,u);else if(l instanceof Qt.a)o=li(e,t,n,a,l.yRange[0],l.yRange[1],0,t.getColCount()-1,c,u),s=[l.yRange[0],l.yRange[1]];else if(l instanceof Zt.a)o=li(e,t,n,a,0,t.getRowCount()-1,l.xRange[0],l.xRange[1],c,u),i=[l.xRange[0],l.xRange[1]];else{if(!(l instanceof Jt.a))throw new Error("\u4e0d\u53ef\u7528\u7684\u9009\u533a\u7c7b\u578b");o=li(e,t,n,a,l.yRange[0],l.yRange[1],l.xRange[0],l.xRange[1],c,u),s=[l.yRange[0],l.yRange[1]],i=[l.xRange[0],l.xRange[1]]}return{activation:o,xRange:i,yRange:s}}function li(e,t,r,n,a,o,i,s,l,c){return r===Bo.X?function(e,t,r,n,a,o,i,s,l){var c=function(e,r,n){return Object(Go.g)(e,r,n)&&Object(Go.e)(t,r,n)},u=s,d=l;if(r>0)for(d+=1;;){var h=Object(zt.f)(e,u,d,i,c);if(null!==h){d=h;break}d=o,(u+=1)>a&&(u=n)}else for(d-=1;;){var f=Object(zt.e)(e,u,d,o,c);if(null!==f){d=f;break}d=i,(u-=1)<n&&(u=a)}return{row:u,col:d}}(e,t,n,a,o,i,s,l,c):function(e,t,r,n,a,o,i,s,l){var c=function(e,r,n){return Object(Go.g)(e,r,n)&&Object(Go.e)(t,r,n)},u=s,d=l;if(r>0)for(u+=1;;){var h=Object(zt.g)(e,u,d,a,c);if(null!==h){u=h;break}u=n,(d+=1)>i&&(d=o)}else for(u-=1;;){var f=Object(zt.h)(e,u,d,n,c);if(null!==f){u=f;break}u=a,(d-=1)<o&&(d=i)}return{row:u,col:d}}(e,t,n,a,o,i,s,l,c)}function ci(e,t,r,n,a){return Yo(r),n===Bo.X?function(e,t,r,n){var a,o,i,s,l,c=r.selectQueue[r.currentSelectIndex],u=r.activeRow,d=r.activeCol;if(c instanceof qt.a||c instanceof Qt.a)return null;if(!(c instanceof Zt.a||c instanceof Jt.a))throw new Error("\u4e0d\u53ef\u7528\u7684\u9009\u533a\u7c7b\u578b");a=c.xRange[0],o=c.xRange[1],c instanceof Zt.a?(i=0,s=t.getRowCount()-1):(i=c.yRange[0],s=c.yRange[1]);l=o>d?o:a;var h=Ko(e,t,r.activeRow,l,n);if(null===h)return null;var f=[Math.min(d,h),Math.max(d,h)];if(c instanceof Zt.a)return{xRange:f,activation:{row:u,col:d}};return{xRange:f,yRange:[i,s],activation:{row:u,col:d}}}(e,t,r,a):function(e,t,r,n){var a,o,i,s,l,c=r.selectQueue[r.currentSelectIndex],u=r.activeRow,d=r.activeCol;if(c instanceof qt.a||c instanceof Zt.a)return null;if(!(c instanceof Qt.a||c instanceof Jt.a))throw new Error("\u4e0d\u53ef\u7528\u7684\u9009\u533a\u7c7b\u578b");i=c.yRange[0],s=c.yRange[1],c instanceof Qt.a?(a=0,o=t.getColCount()-1):(a=c.xRange[0],o=c.xRange[1]);l=s>u?s:i;var h=Xo(e,t,l,r.activeCol,n);if(null===h)return null;var f=[Math.min(u,h),Math.max(u,h)];if(c instanceof Qt.a)return{yRange:f,activation:{row:u,col:d}};return{xRange:[a,o],yRange:f,activation:{row:u,col:d}}}(e,t,r,a)}function ui(e,t,r,n,a){return Yo(r),n===Bo.X?function(e,t,r,n){var a=Ko(e,t,r.activeRow,r.activeCol,n);if(null===a)return null;var o=r.activeRow;return{yRange:[o,o],xRange:[a,a],activation:{col:a,row:o}}}(e,t,r,a):function(e,t,r,n){var a=Xo(e,t,r.activeRow,r.activeCol,n);if(null===a)return null;var o=r.activeCol;return{xRange:[o,o],yRange:[a,a],activation:{row:a,col:o}}}(e,t,r,a)}!function(e){e[e.X=0]="X",e[e.Y=1]="Y"}(Bo||(Bo={}));var di=r("./src/core/behavior/request/workbook/filterUtils/searchCloseDataArea.ts"),hi=function(){function e(t){var r=this;Object(n.a)(this,e),this._right=function(){if(r._selectData.select){var e=ni(r._tableView,r._rowcolAccessor,r._selectData,Bo.X,1);if(r._startSelect(r._selectData,e),r._selectData.activeRow<0||r._selectData.activeCol<0)throw new Error("\u79fb\u52a8\u9009\u533a\u5f02\u5e38");return r._scrollApi.scrollToVisible({row:r._selectData.activeRow,col:r._selectData.activeCol}),!1}},this._left=function(){if(r._selectData.select){var e=ni(r._tableView,r._rowcolAccessor,r._selectData,Bo.X,-1);if(r._startSelect(r._selectData,e),r._selectData.activeRow<0||r._selectData.activeCol<0)throw new Error("\u79fb\u52a8\u9009\u533a\u5f02\u5e38");return r._scrollApi.scrollToVisible({row:r._selectData.activeRow,col:r._selectData.activeCol}),!1}},this._down=function(){if(r._selectData.select){var e=ni(r._tableView,r._rowcolAccessor,r._selectData,Bo.Y,1);if(r._startSelect(r._selectData,e),r._selectData.activeRow<0||r._selectData.activeCol<0)throw new Error("\u79fb\u52a8\u9009\u533a\u5f02\u5e38");return r._scrollApi.scrollToVisible({row:r._selectData.activeRow,col:r._selectData.activeCol}),!1}},this._up=function(){if(r._selectData.select){var e=ni(r._tableView,r._rowcolAccessor,r._selectData,Bo.Y,-1);if(r._startSelect(r._selectData,e),r._selectData.activeRow<0||r._selectData.activeCol<0)throw new Error("\u79fb\u52a8\u9009\u533a\u5f02\u5e38");return r._scrollApi.scrollToVisible({row:r._selectData.activeRow,col:r._selectData.activeCol}),!1}},this._shiftRight=function(){if(r._selectData.select){var e=ai(r._tableView,r._rowcolAccessor,r._selectData,Bo.X,1);if(e){if(r._updateSelect(r._selectData,e),!r._selectData.select.xRange)throw new Error("\u79fb\u52a8\u9009\u533a\u5f02\u5e38");r._scrollApi.scrollToVisible({col:r._selectData.select.xRange[1]})}}},this._shiftLeft=function(){if(r._selectData.select){var e=ai(r._tableView,r._rowcolAccessor,r._selectData,Bo.X,-1);if(e){if(r._updateSelect(r._selectData,e),!r._selectData.select.xRange)throw new Error("\u79fb\u52a8\u9009\u533a\u5f02\u5e38");r._scrollApi.scrollToVisible({col:r._selectData.select.xRange[0]})}}},this._shiftDown=function(){if(r._selectData.select){var e=ai(r._tableView,r._rowcolAccessor,r._selectData,Bo.Y,1);if(e){if(r._updateSelect(r._selectData,e),!r._selectData.select.yRange)throw new Error("\u79fb\u52a8\u9009\u533a\u5f02\u5e38");r._scrollApi.scrollToVisible({row:r._selectData.select.yRange[1]})}}},this._shiftUp=function(){if(r._selectData.select){var e=ai(r._tableView,r._rowcolAccessor,r._selectData,Bo.Y,-1);if(e){if(r._updateSelect(r._selectData,e),!r._selectData.select.yRange)throw new Error("\u79fb\u52a8\u9009\u533a\u5f02\u5e38");r._scrollApi.scrollToVisible({row:r._selectData.select.yRange[0]})}}},this._enter=function(){if(r._selectData.select){if(Object(zt.l)(r._tableView,r._selectData)){var e=ni(r._tableView,r._rowcolAccessor,r._selectData,Bo.Y,1);r._startSelect(r._selectData,e)}else{var t=r._rowcolAccessor.isRowHidden(r._selectData.activeRow),n=r._rowcolAccessor.isColHidden(r._selectData.activeCol);if(t||n)return;var a=si(r._tableView,r._rowcolAccessor,r._selectData,Bo.Y,1);r._updateSelect(r._selectData,a)}if(r._selectData.activeRow<0||r._selectData.activeCol<0)throw new Error("\u79fb\u52a8\u9009\u533a\u5f02\u5e38");r._scrollApi.scrollToVisible({row:r._selectData.activeRow,col:r._selectData.activeCol})}},this._shiftEnter=function(){if(r._selectData.select&&r._selectData.select){if(Object(zt.l)(r._tableView,r._selectData)){var e=ni(r._tableView,r._rowcolAccessor,r._selectData,Bo.Y,-1);r._startSelect(r._selectData,e)}else{var t=si(r._tableView,r._rowcolAccessor,r._selectData,Bo.Y,-1);r._updateSelect(r._selectData,t)}if(r._selectData.activeRow<0||r._selectData.activeCol<0)throw new Error("\u79fb\u52a8\u9009\u533a\u5f02\u5e38");r._scrollApi.scrollToVisible({row:r._selectData.activeRow,col:r._selectData.activeCol})}},this._tab=function(){if(r._selectData.select&&r._selectData.select){if(Object(zt.l)(r._tableView,r._selectData)){var e=ni(r._tableView,r._rowcolAccessor,r._selectData,Bo.X,1);r._startSelect(r._selectData,e)}else{var t=si(r._tableView,r._rowcolAccessor,r._selectData,Bo.X,1);r._updateSelect(r._selectData,t)}if(r._selectData.activeRow<0||r._selectData.activeCol<0)throw new Error("\u79fb\u52a8\u9009\u533a\u5f02\u5e38");return r._scrollApi.scrollToVisible({row:r._selectData.activeRow,col:r._selectData.activeCol}),!1}},this._shiftTab=function(){if(r._selectData.select&&r._selectData.select){if(Object(zt.l)(r._tableView,r._selectData)){var e=ni(r._tableView,r._rowcolAccessor,r._selectData,Bo.X,-1);r._startSelect(r._selectData,e)}else{var t=si(r._tableView,r._rowcolAccessor,r._selectData,Bo.X,-1);r._updateSelect(r._selectData,t)}if(r._selectData.activeRow<0||r._selectData.activeCol<0)throw new Error("\u79fb\u52a8\u9009\u533a\u5f02\u5e38");return r._scrollApi.scrollToVisible({row:r._selectData.activeRow,col:r._selectData.activeCol}),!1}},this._shortRight=function(){if(r._selectData.select){var e=ui(r._tableView,r._rowcolAccessor,r._selectData,Bo.X,1);if(e){if(r._startSelect(r._selectData,e),r._selectData.activeRow<0||r._selectData.activeCol<0)throw new Error("\u79fb\u52a8\u9009\u533a\u5f02\u5e38");r._scrollApi.scrollToVisible({row:r._selectData.activeRow,col:r._selectData.activeCol})}}},this._shortLeft=function(){if(r._selectData.select){var e=ui(r._tableView,r._rowcolAccessor,r._selectData,Bo.X,-1);if(e){if(r._startSelect(r._selectData,e),r._selectData.activeRow<0||r._selectData.activeCol<0)throw new Error("\u79fb\u52a8\u9009\u533a\u5f02\u5e38");r._scrollApi.scrollToVisible({row:r._selectData.activeRow,col:r._selectData.activeCol})}}},this._shortDown=function(){if(r._selectData.select){var e=ui(r._tableView,r._rowcolAccessor,r._selectData,Bo.Y,1);if(e){if(r._startSelect(r._selectData,e),r._selectData.activeRow<0||r._selectData.activeCol<0)throw new Error("\u79fb\u52a8\u9009\u533a\u5f02\u5e38");r._scrollApi.scrollToVisible({row:r._selectData.activeRow,col:r._selectData.activeCol})}}},this._shortUp=function(){if(r._selectData.select){var e=ui(r._tableView,r._rowcolAccessor,r._selectData,Bo.Y,-1);if(e){if(r._startSelect(r._selectData,e),r._selectData.activeRow<0||r._selectData.activeCol<0)throw new Error("\u79fb\u52a8\u9009\u533a\u5f02\u5e38");r._scrollApi.scrollToVisible({row:r._selectData.activeRow,col:r._selectData.activeCol})}}},this._shortShiftRight=function(){if(r._selectData.select){var e=ci(r._tableView,r._rowcolAccessor,r._selectData,Bo.X,1);if(e){if(r._updateSelect(r._selectData,e),!r._selectData.select.xRange)throw new Error("\u79fb\u52a8\u9009\u533a\u5f02\u5e38");r._scrollApi.scrollToVisible({col:r._selectData.select.xRange[1]})}}},this._shortShiftLeft=function(){if(r._selectData.select){var e=ci(r._tableView,r._rowcolAccessor,r._selectData,Bo.X,-1);if(e){if(r._updateSelect(r._selectData,e),!r._selectData.select.xRange)throw new Error("\u79fb\u52a8\u9009\u533a\u5f02\u5e38");r._scrollApi.scrollToVisible({col:r._selectData.select.xRange[0]})}}},this._shortShiftDown=function(){if(r._selectData.select){var e=ci(r._tableView,r._rowcolAccessor,r._selectData,Bo.Y,1);if(e){if(r._updateSelect(r._selectData,e),!r._selectData.select.yRange)throw new Error("\u79fb\u52a8\u9009\u533a\u5f02\u5e38");r._scrollApi.scrollToVisible({row:r._selectData.select.yRange[1]})}}},this._shortShiftUp=function(){if(r._selectData.select){var e=ci(r._tableView,r._rowcolAccessor,r._selectData,Bo.Y,-1);if(e){if(r._updateSelect(r._selectData,e),!r._selectData.select.yRange)throw new Error("\u79fb\u52a8\u9009\u533a\u5f02\u5e38");r._scrollApi.scrollToVisible({row:r._selectData.select.yRange[0]})}}},this._shortA=function(){var e,t,n,a,o,i,s,l,c;if(r._selectData.select){if(null===(e=r._selectData.select)||void 0===e?void 0:e.selectAll)return!1;var u,d=r._selectData,h=d.activation,f=d.selectQueue,p=void 0===f?[]:f,_=null===(t=p[0])||void 0===t||null===(n=t.yRange)||void 0===n?void 0:n[0],m=null===(a=p[0])||void 0===a||null===(o=a.yRange)||void 0===o?void 0:o[1],v=null===(i=p[0])||void 0===i||null===(s=i.xRange)||void 0===s?void 0:s[0],g=null===(l=p[0])||void 0===l||null===(c=l.xRange)||void 0===c?void 0:c[1],b=new ln.b("",_>=0?_:void 0,m>=0?m:void 0,v>=0?v:void 0,g>=0?g:void 0);if(p.length>1)u={activation:{row:r._selectData.activeRow,col:r._selectData.activeCol}};else{var y,w,R,E,C,j,O,S,D,x,k,T,A=Object(di.b)(r._spreadsheet.activeSheet,b,!0),I=r._selectData.select;u={xRange:[A.startColIndex,A.endColIndex],yRange:[A.startRowIndex,A.endRowIndex],activation:h},(I.selectRow||I.selectCol||(null===I||void 0===I||null===(y=I.xRange)||void 0===y?void 0:y[0])===(null===(w=u)||void 0===w||null===(R=w.xRange)||void 0===R?void 0:R[0])&&(null===I||void 0===I||null===(E=I.xRange)||void 0===E?void 0:E[1])===(null===(C=u)||void 0===C||null===(j=C.xRange)||void 0===j?void 0:j[1])&&(null===I||void 0===I||null===(O=I.yRange)||void 0===O?void 0:O[0])===(null===(S=u)||void 0===S||null===(D=S.yRange)||void 0===D?void 0:D[0])&&(null===I||void 0===I||null===(x=I.yRange)||void 0===x?void 0:x[1])===(null===(k=u)||void 0===k||null===(T=k.yRange)||void 0===T?void 0:T[1]))&&(u={activation:{row:r._selectData.activeRow,col:r._selectData.activeCol}})}return r._updateSelect(r._selectData,u),!1}},this._shortHome=function(){if(r._selectData.select){var e=Object(zt.g)(r._rowcolAccessor,0,0,r._rowcolAccessor.getRowCount()-1,Go.e),t=Object(zt.f)(r._rowcolAccessor,0,0,r._rowcolAccessor.getColCount()-1,Go.e);if(null!==e&&null!==t){var n={xRange:[t,t],yRange:[e,e],activation:{row:e,col:t}};return r._updateSelect(r._selectData,n),r._scrollApi.scrollToVisible({row:e,col:t}),tn.b.tdwReport({module:"excel_shortcuts",opername:"doc_excel_editor",action:yr.a.isMac||yr.a.isIPad?"select_shortcuts_Control+Fn+Left":"select_shortcuts_Ctrl+Home"}),!1}}},this._shortEnd=function(){if(r._selectData.select){var e=Object(zt.h)(r._rowcolAccessor,r._rowcolAccessor.getRowCount()-1,r._rowcolAccessor.getColCount()-1,0,Go.e),t=Object(zt.e)(r._rowcolAccessor,r._rowcolAccessor.getRowCount()-1,r._rowcolAccessor.getColCount()-1,0,Go.e);if(null!==e&&null!==t){var n={xRange:[t,t],yRange:[e,e],activation:{row:e,col:t}};return r._updateSelect(r._selectData,n),r._scrollApi.scrollToVisible({row:e,col:t}),tn.b.tdwReport({module:"excel_shortcuts",opername:"doc_excel_editor",action:yr.a.isMac||yr.a.isIPad?"select_shortcuts_Control+;":"select_shortcuts_Ctrl+;"}),!1}}},this._end=function(){if(r._selectData.select){var e=r._selectData.activeRow,t=r._rowcolAccessor.getColCount()-1,n=Object(zt.e)(r._rowcolAccessor,e,t,0,Go.e);if(null!==e&&null!==n){var a={xRange:[n,n],yRange:[e,e],activation:{row:e,col:n}};return r._startSelect(r._selectData,a),r._scrollApi.scrollToVisible({row:e,col:n}),!1}}},this._home=function(){if(r._selectData.select){var e=r._selectData.activeRow,t=Object(zt.f)(r._rowcolAccessor,e,0,r._rowcolAccessor.getColCount()-1,Go.e);if(null!==e&&null!==t){var n={xRange:[t,t],yRange:[e,e],activation:{row:e,col:t}};return r._startSelect(r._selectData,n),r._scrollApi.scrollToVisible({row:e,col:t}),!1}}},this._selectRow=function(){var e;if(r._selectData.select&&!(null===(e=r._selectData.select)||void 0===e?void 0:e.selectAll)){var t=r._selectData,n=t.activation,a=t.selectQueue,o=void 0===a?[]:a,i=o[o.length-1].yRange,s={yRange:i?[i[0],i[1]]:void 0,activation:n};return r._updateSelect(r._selectData,s),!1}},this._selectCol=function(){var e;if(r._selectData.select&&!(null===(e=r._selectData.select)||void 0===e?void 0:e.selectAll)){var t=r._selectData,n=t.activation,a=t.selectQueue,o=void 0===a?[]:a,i=o[o.length-1].xRange,s={xRange:i?[i[0],i[1]]:void 0,activation:n};return r._updateSelect(r._selectData,s),!1}},this._tableView=t.tableView,this._rowcolAccessor=t.rowcolAccessor,this._selectData=t.selectData,this._scrollApi=t.scrollApi,this._keyboardMount=t.keyboardMount,this._startSelect=t.startSelect,this._updateSelect=t.updateSelect,this._spreadsheet=t.spreadsheet,this._bindings=[{key:bo.c.KEYS.RIGHT,handler:this._right},{key:bo.c.KEYS.LEFT,handler:this._left},{key:bo.c.KEYS.DOWN,handler:this._down},{key:bo.c.KEYS.UP,handler:this._up},{key:bo.c.KEYS.RIGHT,shiftKey:!0,handler:this._shiftRight},{key:bo.c.KEYS.LEFT,shiftKey:!0,handler:this._shiftLeft},{key:bo.c.KEYS.UP,shiftKey:!0,handler:this._shiftUp},{key:bo.c.KEYS.DOWN,shiftKey:!0,handler:this._shiftDown},{key:bo.c.KEYS.RIGHT,shortKey:!0,handler:this._shortRight},{key:bo.c.KEYS.LEFT,shortKey:!0,handler:this._shortLeft},{key:bo.c.KEYS.DOWN,shortKey:!0,handler:this._shortDown},{key:bo.c.KEYS.UP,shortKey:!0,handler:this._shortUp},{key:bo.c.KEYS.ENTER,handler:this._enter},{key:bo.c.KEYS.ENTER,shiftKey:!0,handler:this._shiftEnter},{key:bo.c.KEYS.TAB,handler:this._tab},{key:bo.c.KEYS.TAB,shiftKey:!0,handler:this._shiftTab},{key:bo.c.KEYS.RIGHT,shortKey:!0,shiftKey:!0,handler:this._shortShiftRight},{key:bo.c.KEYS.LEFT,shortKey:!0,shiftKey:!0,handler:this._shortShiftLeft},{key:bo.c.KEYS.DOWN,shortKey:!0,shiftKey:!0,handler:this._shortShiftDown},{key:bo.c.KEYS.UP,shortKey:!0,shiftKey:!0,handler:this._shortShiftUp},{key:"a",shortKey:!0,handler:this._shortA},{key:bo.c.KEYS.HOME,shortKey:!0,handler:this._shortHome},{key:bo.c.KEYS.END,shortKey:!0,handler:this._shortEnd},{key:bo.c.KEYS.HOME,handler:this._home},{key:bo.c.KEYS.END,handler:this._end},{key:bo.c.KEYS.SPACE,shiftKey:!0,ctrlKey:!yr.a.isMac,handler:this._selectRow},{key:bo.c.KEYS.SPACE,altKey:!0,ctrlKey:!yr.a.isMac,handler:this._selectCol},{key:bo.c.KEYS.SPACE_SAFARI,altKey:!0,handler:this._selectCol}],this._keymaster=new bo.c({root:this._keyboardMount,bindings:this._bindings})}return Object(a.a)(e,[{key:"triggerKeyDownEvent",value:function(e){this._bindings.forEach((function(t){e.key===t.key&&e.shortKey===t.shortKey&&e.shiftKey===t.shiftKey&&e.altKey===t.altKey&&t.handler()}))}},{key:"changeSelectData",value:function(e){this._selectData=e}}]),e}(),fi=function e(t){Object(n.a)(this,e),this._selectData=t.selectData,this._spreadsheet=t.spreadsheet};fi.EVENT={READY_SELECT:"readySelect",START_SELECT:"startSelect",UPDATE_SELECT:"updateSelect",END_SELECT:"endSelect"};var pi=fi,_i=function(){function e(t){var r=this;Object(n.a)(this,e),this._handleTap=function(e){if(r._checkDownValid()){var t,n=r._operateData.currRow,a=r._operateData.currCol;t=-1===n&&-1===a?{activation:{row:0,col:0}}:-1===a?{yRange:[n,n],activation:{row:n,col:0}}:-1===n?{xRange:[a,a],activation:{row:0,col:a}}:{yRange:[n,n],xRange:[a,a],activation:{row:n,col:a}},e.e.preventDefault(),r._startSelect(r._selectData,t)}},this._touchOperate=t.touchOperate,this._operateData=t.operateData,this._selectData=t.selectData,this._startSelect=t.startSelect,this._touchOperate.emitter.on(Lt.a.EVENT.TAP,this._handleTap)}return Object(a.a)(e,[{key:"changeSelectData",value:function(e){this._selectData=e}},{key:"_checkDownValid",value:function(){if(null===this._selectData)throw new Error("must bind selectData in SelectCells module");return!this._operateData.stopPropagation&&!this._operateData.isOverTable()}}]),e}();function mi(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function vi(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var gi=function(e){Object(i.a)(r,e);var t=vi(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e))._readySelect=function(e){a.emitter.emit(r.EVENT.READY_SELECT,e)},a._startSelect=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];a.emitter.emit(r.EVENT.START_SELECT,e,t,n)},a._updateSelect=function(e,t){a.emitter.emit(r.EVENT.UPDATE_SELECT,e,t)},a._endSelect=function(e){a.emitter.emit(r.EVENT.END_SELECT,e)},a.emitter=new tr.a,a._tableView=e.tableView,a._rowcolAccessor=e.rowcolAccessor,a._areaData=e.areaData,a._touchOperate=e.touchOperate,a._mouseOperate=e.mouseOperate,a._operateData=e.operateData,a._scrollApi=e.scrollApi,a._keyboardMount=e.keyboardMount,a._tapSelect=new _i({touchOperate:a._touchOperate,operateData:a._operateData,selectData:a._selectData,startSelect:a._startSelect}),a._mouseSelect=new Wo({mouseOperate:a._mouseOperate,operateData:a._operateData,selectData:a._selectData,areaData:a._areaData,rowcolAccessor:a._rowcolAccessor,readySelect:a._readySelect,startSelect:a._startSelect,updateSelect:a._updateSelect,endSelect:a._endSelect}),a._keyboardSelect=new hi({tableView:a._tableView,rowcolAccessor:a._rowcolAccessor,selectData:a._selectData,startSelect:a._startSelect,updateSelect:a._updateSelect,scrollApi:a._scrollApi,keyboardMount:window.document.querySelector("#mainContainer"),spreadsheet:a._spreadsheet}),a}return Object(a.a)(r,[{key:"bindSelectData",value:function(e){this._selectData=e,this._tapSelect.changeSelectData(this._selectData),this._mouseSelect.changeSelectData(this._selectData),this._keyboardSelect.changeSelectData(this._selectData)}},{key:"EVENT",get:function(){return r.EVENT}},{key:"selectData",get:function(){return this._selectData}}]),r}(pi);gi.EVENT=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?mi(Object(r),!0).forEach((function(t){Object(F.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mi(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},pi.EVENT);var bi=gi,yi=function e(t,r){var a=this;Object(n.a)(this,e),this._handleStartSelect=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r?a._multipleMode=!0:(a._multipleMode&&e.resetSelection(),a._multipleMode=!1);var n=e.currentSelectIndex;a._multipleMode||n===e.selectQueue.length||0===e.selectQueue.length?e.addSelection(t):e.updateSelection(n,t),e===a._normalSelectData?a._normalSelectionStage.show():e===a._formulaSelectData&&(a._operateData.preventAutoTapFocus=!0,a._formulaSelectionStage.show())},this._handleUpdateSelect=function(e,t){var r=e.currentSelectIndex;e.updateSelection(r,t)},this._selectCells=t,this._normalSelectData=r.normalSelectData,this._formulaSelectData=r.formulaSelectData,this._normalSelectionStage=r.normalSelectionStage,this._formulaSelectionStage=r.formulaSelectionStage,this._autoScroll=r.autoScroll,this._clientRect=r.clientRect,this._areaData=r.areaData,this._mutexManagement=r.mutexManagement,this._operateData=r.operateData,this._selectCells.emitter.on(this._selectCells.EVENT.START_SELECT,this._handleStartSelect),this._selectCells.emitter.on(this._selectCells.EVENT.UPDATE_SELECT,this._handleUpdateSelect),this._selectCells.emitter.on(this._selectCells.EVENT.READY_SELECT,(function(e){var t=e.select;null!==t&&(t.selectCol?a._autoScroll.ready(Et.a.X,a._clientRect.width-10):t.selectRow?a._autoScroll.ready(Et.a.Y,void 0,a._clientRect.height-a._areaData.row.flow.displayPadding):t.selectCell&&a._autoScroll.ready(Et.a.ALL,a._clientRect.width-10,a._clientRect.height-a._areaData.row.flow.displayPadding))}))},wi=function(){function e(t){Object(n.a)(this,e),this._selectCells=new bi(t),this._feature=new yi(this._selectCells,t)}return Object(a.a)(e,[{key:"selectOperate",get:function(){return this._selectCells}}]),e}();function Ri(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var Ei=function(e){Object(i.a)(r,e);var t=Ri(r);function r(e,a,o){var i;return Object(n.a)(this,r),(i=t.call(this,e,a,o))._level1Inited=!1,i}return Object(a.a)(r,[{key:"initLevel1",value:function(e){var t=(null===e||void 0===e?void 0:e.preview)||!1;Object(o.a)(Object(l.a)(r.prototype),"_level0Inited",this)||Object(o.a)(Object(l.a)(r.prototype),"initLevel0",this).call(this),this._level1Inited?console.info("view.level1\u5df2\u7ecf\u521d\u59cb\u5316"):(console.info("view.level1\u521d\u59cb\u5316"),this._initErrorTipAccessor(),this._initMainBoard(),this._initOperateContext(),this._initDragOperate(),this._initAutoScroll(),this._initSelectData(),this._initShapeStage(),this._initNormalSelectionStage(),this._initFormulaSelectionStage(),this._initScrollApi(),this._initSelectApi(),this._initWheelOperate(),this._initSlideOperate(),this._initScaleOperate(),this._initFreezeLine(),this._initBroker(),this._initCellImageManager(),this._initSelectCells(),!t&&this._initInputManager(),this._level1Inited=!0)}},{key:"refresh",value:function(){Object(o.a)(Object(l.a)(r.prototype),"refresh",this).call(this),this._errorTipAccessor.refresh(),this._mainBoard.refresh(),this._shapeStage.refresh()}},{key:"_initErrorTipAccessor",value:function(){this._errorTipAccessor=new Fo({dataCallView:this._dataCallView})}},{key:"_initSelectCells",value:function(){this._selectCellsCenter=new wi({spreadsheet:this._spreadsheet,tableView:this._tableView,rowcolAccessor:this._rowcolAccessor,areaData:this._areaData,touchOperate:this._touchOperate,mouseOperate:this._mouseOperate,selectData:this._normalSelectData,operateData:this._operateData,container:this._container,scrollApi:this._scrollApi,keyboardMount:this._container,normalSelectData:this._normalSelectData,formulaSelectData:this._formulaSelectData,normalSelectionStage:this._normalSelectionStage,formulaSelectionStage:this._formulaSelectionStage,autoScroll:this._autoScroll,clientRect:this._clientRect,mutexManagement:this._mutexManagement})}},{key:"_initOperateContext",value:function(){this._operateData=new _r({scale:this._scale}),this._mousePrepare=new At({operateData:this._operateData,container:this._container,clientRect:this._clientRect,headSize:this._headSize,areaData:this._areaData,scale:this._scale}),this._operateBoard=new Xr({container:this._container}),this._mouseOperate=new Nt.a({board:this._operateBoard.board,operateData:this._operateData}),this._touchPrepare=new It({operateData:this._operateData,container:this._container,clientRect:this._clientRect,headSize:this._headSize,areaData:this._areaData,scale:this._scale}),this._touchOperate=new Lt.a({board:this._operateBoard.board,operateData:this._operateData})}},{key:"_initWheelOperate",value:function(){this._wheelOperate=new Pt.a({containers:[this._mainBoard.element,this._operateBoard.board]}),new vr(this._wheelOperate,{areaData:this._areaData})}},{key:"_initSlideOperate",value:function(){this._slideOperate=new Cr({touchData:this._operateData,touchOperate:this._touchOperate,container:this._container}),new jr(this._slideOperate,{areaData:this._areaData})}},{key:"_initDragOperate",value:function(){this._dragOperate=new Ho.a}},{key:"_initScaleOperate",value:function(){this._scaleOperate=new Qr({scale:this._scale,areaData:this._areaData,touchData:this._operateData,touchOperate:this._touchOperate,scrollApi:this._scrollApi})}},{key:"_initAutoScroll",value:function(){this._autoScroll=new Et.b({headSize:this._headSize,areaData:this._areaData,operateData:this._operateData,clientRect:this._clientRect}),new Ct(this._autoScroll,{areaData:this._areaData})}},{key:"_initMainBoard",value:function(){this._mainBoard=new Tt({container:this._container,headSize:this._headSize,areaData:this._areaData,scale:this._scale})}},{key:"_initSelectData",value:function(){this._normalSelectData=new Mt.a({tableView:this._tableView,rowcolAccessor:this._rowcolAccessor,transformTable:this._transformTable,areaData:this._areaData,scale:this._scale}),this._formulaSelectData=new Yt({tableView:this._tableView,rowcolAccessor:this._rowcolAccessor}),new cr({selectData:this._formulaSelectData,dataCallView:this._dataCallView,rowcolAccessor:this._rowcolAccessor}),new hr({selectData:this._normalSelectData,dataCallView:this._dataCallView,rowcolAccessor:this._rowcolAccessor}),this._normalSelectData.emitter.on(this._normalSelectData.EVENT.ADD_SELECTION,this._renderApi.renderNextTick),this._normalSelectData.emitter.on(this._normalSelectData.EVENT.UPDATE_SELECTION,this._renderApi.renderNextTick),this._normalSelectData.emitter.on(this._normalSelectData.EVENT.RESET_SELECTION,this._renderApi.renderNextTick)}},{key:"_initShapeStage",value:function(){this._shapeStage=new Xt.a({spreadsheet:this._spreadsheet,dataCallView:this._dataCallView,areaData:this._areaData,mainBoard:this._mainBoard,scale:this._scale,rowcolAccessor:this._rowcolAccessor,imageConstructor:Yr})}},{key:"_initNormalSelectionStage",value:function(){var e=this,t=new Pr({blockBoard:this._mainBoard.top.left,sheetStatus:this._spreadsheetApp.sheetStatus}),r=new Pr({blockBoard:this._mainBoard.top.right,sheetStatus:this._spreadsheetApp.sheetStatus}),n=new Pr({blockBoard:this._mainBoard.bottom.left,sheetStatus:this._spreadsheetApp.sheetStatus}),a=new Pr({blockBoard:this._mainBoard.bottom.right,sheetStatus:this._spreadsheetApp.sheetStatus});this._normalSelectionStage=new ar({selectData:this._normalSelectData,mainBoard:this._mainBoard,areaData:this._areaData,scale:this._scale,tableView:this._tableView,topLeft:t,topRight:r,bottomLeft:n,bottomRight:a}),this._normalSelectionStage.emitter.on(this._normalSelectionStage.EVENT.SHOW,(function(){e._mutexManagement.mutexShow(de.a.SELECTION)})),this._mutexManagement.addMutexComponent(de.a.SELECTION,this._normalSelectionStage)}},{key:"_initFormulaSelectionStage",value:function(){var e=this,t=new Hr({blockBoard:this._mainBoard.top.left}),r=new Hr({blockBoard:this._mainBoard.top.right}),n=new Hr({blockBoard:this._mainBoard.bottom.left}),a=new Hr({blockBoard:this._mainBoard.bottom.right});this._formulaSelectionStage=new ar({selectData:this._formulaSelectData,mainBoard:this._mainBoard,areaData:this._areaData,scale:this._scale,tableView:this._tableView,topLeft:t,topRight:r,bottomLeft:n,bottomRight:a}),this._formulaSelectionStage.emitter.on(this._formulaSelectionStage.EVENT.SHOW,(function(){e._mutexManagement.mutexShow(de.a.FORMULA_SELECTION)})),this._mutexManagement.addMutexComponent(de.a.FORMULA_SELECTION,this._formulaSelectionStage)}},{key:"_initScrollApi",value:function(){this._scrollApi=new ir({areaData:this._areaData,headSize:this._headSize,rowcolAccessor:this._rowcolAccessor})}},{key:"_initSelectApi",value:function(){this._selectApi=new sr({normalSelectData:this._normalSelectData,formulaSelectData:this._formulaSelectData,rowcolAccessor:this._rowcolAccessor})}},{key:"_initFreezeLine",value:function(){this._freezeLine=new lr({areaData:this._areaData,headSize:this._headSize,alloyExcel:this._alloyExcel,renderApi:this._renderApi})}},{key:"_initBroker",value:function(){this._modifyBrokerCenter=new gn({tableView:this._tableView,paragraphAccessor:this._paragraphAccessor,rowcolAccessor:this._rowcolAccessor,normalSelectData:this._normalSelectData,spreadsheet:this._spreadsheet,spreadsheetApp:this._spreadsheetApp})}},{key:"_initInputManager",value:function(){this._inputManager=new No({mutationBehavior:this._spreadsheetApp.mutationBehavior,spreadsheet:this._spreadsheet,sheetStatus:this._spreadsheetApp.sheetStatus,alloyExcel:this._alloyExcel,tableView:this._tableView,dataCallView:this._dataCallView,mouseOperate:this._mouseOperate,normalSelectData:this._normalSelectData,formulaSelectData:this._formulaSelectData,formulaInputMountDom:this._container,tableInputMountDom:this._container,areaData:this._areaData,rowcolAccessor:this._rowcolAccessor,resize:this._resize,scale:this._scale,clientRect:this._clientRect,headSize:this._headSize,scrollApi:this._scrollApi,paragraphAccessor:this._paragraphAccessor,modifyCellBroker:this._modifyBrokerCenter.cell,mutexManagement:this._mutexManagement,normalSelectionStage:this._normalSelectionStage})}},{key:"_initCellImageManager",value:function(){this._cellImageManager=new Uo({event:this._spreadsheetApp.event,mutationBehavior:this._spreadsheetApp.mutationBehavior,spreadsheet:this._spreadsheet,renderApi:this._renderApi})}},{key:"errorTipAccessor",get:function(){return this._errorTipAccessor}},{key:"cellImageManager",get:function(){return this._cellImageManager}},{key:"mainBoard",get:function(){return this._mainBoard}},{key:"operateData",get:function(){return this._operateData}},{key:"selectCells",get:function(){return this._selectCellsCenter.selectOperate}},{key:"normalSelectData",get:function(){return this._normalSelectData}},{key:"formulaSelectData",get:function(){return this._formulaSelectData}},{key:"shapeStage",get:function(){return this._shapeStage}},{key:"normalSelectionStage",get:function(){return this._normalSelectionStage}},{key:"formulaSelectionStage",get:function(){return this._formulaSelectionStage}},{key:"mouseOperate",get:function(){return this._mouseOperate}},{key:"scrollApi",get:function(){return this._scrollApi}},{key:"selectApi",get:function(){return this._selectApi}},{key:"wheelOperate",get:function(){return this._wheelOperate}},{key:"modifyDimensionBroker",get:function(){return this._modifyBrokerCenter.dimension}},{key:"modifyShapeBroker",get:function(){return this._modifyBrokerCenter.shape}},{key:"modifyLinkBroker",get:function(){return this._modifyBrokerCenter.link}},{key:"modifyCellBroker",get:function(){return this._modifyBrokerCenter.cell}},{key:"modifyChartBroker",get:function(){return this._modifyBrokerCenter.chart}},{key:"modifySelectionBroker",get:function(){return this._modifyBrokerCenter.selection}},{key:"inputManager",get:function(){return this._inputManager}},{key:"touchOperate",get:function(){return this._touchOperate}}]),r}(Rt);t.a=Ei},"./src/core/view/View.level2.pc.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/es.string.link.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/regenerator-runtime/runtime.js");var n=r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=r("../node_modules/@babel/runtime/helpers/esm/get.js"),s=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),l=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),c=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),u=r("./src/core/view/View.level1.pc.ts"),d=r("../packages/services/src/dispose.ts"),h=r("./src/core/view/level-2/LazyIndex.pc.ts");function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(l.a)(this,r)}}var p=function(e){Object(s.a)(r,e);var t=f(r);function r(e,n,o){var i;return Object(a.a)(this,r),(i=t.call(this,e,n,o))._level2Inited=!1,i}return Object(o.a)(r,[{key:"initLevel2",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(i.a)(Object(c.a)(r.prototype),"_level1Inited",this)){e.next=3;break}return e.next=3,Object(i.a)(Object(c.a)(r.prototype),"initLevel1",this).call(this);case 3:if(!this._level2Inited){e.next=6;break}return console.info("view.level2 \u5df2\u7ecf\u521d\u59cb\u5316"),e.abrupt("return");case 6:return console.info("view.level2 \u521d\u59cb\u5316"),t=[h.a.CHART_CENTER,h.a.SCROLL_BAR,h.a.COLLAB_CURSOR,h.a.AREA_OVERLAY,h.a.FILTER_CENTER,h.a.SEARCH_REPLACE],e.next=10,Promise.all(t.map((function(e){return Object(h.b)(e)})));case 10:return e.next=12,this._initScrollBar();case 12:return e.next=14,this._initContextMenu();case 14:return e.next=16,this._initShapeEdit();case 16:return e.next=18,this._initRenderPluginExtension();case 18:return e.next=20,this._initCellCornerPlugin();case 20:return e.next=22,this._initCardCenter();case 22:return e.next=24,this._initAreaOverlay();case 24:return e.next=26,this._initFreezePreview();case 26:return e.next=28,this._initSmartDrag();case 28:return e.next=30,this._initFormulaUICenter();case 30:return e.next=32,this._initDimensionEdit();case 32:return e.next=34,this._initCopyFrame();case 34:return e.next=36,this._initCornerTriangle();case 36:return e.next=38,this._initMentionCenter();case 38:return e.next=40,this._initPreviewImageIcon();case 40:return e.next=42,this._initChartCenter();case 42:return e.next=44,this._initTableKeyboard();case 44:return e.next=46,this._initShapeUpload();case 46:return e.next=48,this._initSearchReplaceCenter();case 48:return e.next=50,this._initCollabFilterToast();case 50:return e.next=52,this._initFilterHeader();case 52:return e.next=54,this._initValidationList();case 54:return e.next=56,this._initCollabCursor();case 56:return e.next=58,this._initTestApi();case 58:return e.next=60,this._initRangeAuthRenderPlugin();case 60:return e.next=62,this._initInputSmartSplit();case 62:return e.next=64,this._initConditionFormatCenter();case 64:return e.next=66,this._initErrorTip();case 66:return e.next=68,this._initCellEditorManager();case 68:return e.next=70,this._initCellImageViewer();case 70:this._level2Inited=!0;case 71:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"refresh",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t,n,a,o,s,l,u,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object(i.a)(Object(c.a)(r.prototype),"refresh",this).call(this),null===(t=this._scrollBar)||void 0===t||t.refresh(),null===(n=this._cardCenter)||void 0===n||n.refresh(),null===(a=this._chartCenter)||void 0===a||a.refresh(),null===(o=this._dimensionEdit)||void 0===o||o.refresh(),null===(s=this._smartDrag)||void 0===s||s.refresh(),null===(l=this._inputManager)||void 0===l||l.focus(),null===(u=this._dataValidationCenter)||void 0===u||u.refresh(),null===(d=this._errorTip)||void 0===d||d.refresh();case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initScrollBar",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.SCROLL_BAR);case 2:t=e.sent.default,this._scrollBar=new t({mainBoard:this._mainBoard,areaData:this._areaData,scale:this._scale});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initContextMenu",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.CONTEXT_MENU_CENTER);case 2:t=e.sent.default,this._contextMenuCenter=new t({spreadsheetApp:this._spreadsheetApp,sheetStatus:this._spreadsheetApp.sheetStatus,container:this._container,mouseOperate:this._mouseOperate,scale:this._scale,areaData:this._areaData,operateData:this._operateData,mutexManagement:this._mutexManagement});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initShapeEdit",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.SHAPE_EDIT_CENTER);case 2:t=e.sent.default,this._shapeEditCenter=new t({mainBoard:this._mainBoard,shapeStage:this._shapeStage,areaData:this._areaData,scale:this._scale,modifyShapeBroker:this._modifyBrokerCenter.shape,operateData:this._operateData,sheetStatus:this._spreadsheetApp.sheetStatus,normalSelectStage:this._normalSelectionStage,selectCells:this._selectCellsCenter.selectOperate,menu:this._contextMenuCenter.contextMenu,menuConfig:this._contextMenuCenter.config,mutexManagement:this._mutexManagement,spreadsheet:this._spreadsheet,autoScroll:this._autoScroll,dataCallView:this._dataCallView});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initSmartDrag",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.SMART_DRAG);case 2:t=e.sent.default,this._smartDrag=new t({spreadsheetApp:this._spreadsheetApp,mainBoard:this._mainBoard,areaData:this._areaData,selectData:this._normalSelectData,selectionStage:this._normalSelectionStage,autoScroll:this._autoScroll,operateData:this._operateData,modifySmartSelectionBroker:this._modifyBrokerCenter.smartSelection,headSize:this._headSize,inputManager:this._inputManager,clientRect:this._clientRect,tableView:this._tableView,rowcolAccessor:this._rowcolAccessor,scale:this._scale});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initCollabCursor",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.COLLAB_CURSOR);case 2:t=e.sent.default,this._collabCursor=new t({spreadsheetApp:this._spreadsheetApp,renderApi:this._renderApi,normalSelectData:this._normalSelectData,shapeEdit:this._shapeEditCenter.shapeEdit,shapeStage:this._shapeStage,alloyExcel:this._alloyExcel,rowcolAccessor:this._rowcolAccessor,tableView:this._tableView,dataCallView:this._dataCallView,baseInputManager:this._inputManager,selectCells:this._selectCellsCenter.selectOperate});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initRenderPluginExtension",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.RENDER_PLUGIN_EXTENSION);case 2:t=e.sent.default,this._renderPluginExtension=new t({alloyExcel:this._alloyExcel});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initCardCenter",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t,r,n,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.CARD_CENTER);case 2:return t=e.sent.default,this._cardCenter=new t({tableView:this._tableView,mainBoard:this._mainBoard,areaData:this._areaData,clientRect:this._clientRect,dataCallView:this._dataCallView,headSize:this._headSize,mutexManagement:this._mutexManagement}),e.next=6,Object(h.b)(h.a.LINK_CENTER);case 6:return r=e.sent.default,this._linkCenter=new r({tableView:this._tableView,areaData:this._areaData,touchOperate:this._touchOperate,mouseOperate:this._mouseOperate,spreadsheet:this._spreadsheet,headSize:this._headSize,clientRect:this._clientRect,rowcolAccessor:this._rowcolAccessor,modifyLinkBroker:this._modifyBrokerCenter.link,cardCenter:this._cardCenter,operateData:this._operateData,scale:this._scale,sheetStatus:this._spreadsheetApp.sheetStatus,modifyCellBroker:this._modifyBrokerCenter.cell,scrollApi:this.scrollApi,selectApi:this.selectApi}),e.next=10,Object(h.b)(h.a.COMMENT_CENTER);case 10:n=e.sent.default,this._commentCenter=new n({spreadsheet:this._spreadsheet,cardCenter:this._cardCenter,selectCells:this._selectCellsCenter.selectOperate,cellCornerPlugin:this._cellCornerPlugin,sheetStatus:this._spreadsheetApp.sheetStatus,selectApi:this._selectApi,scrollApi:this._scrollApi,clientRect:this._clientRect,areaData:this._areaData,getQQGroupName:function(){var e,t;return null===(e=a._spreadsheetApp.view)||void 0===e||null===(t=e.discuss)||void 0===t?void 0:t.getQQGroupName()}});case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initAreaOverlay",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.AREA_OVERLAY);case 2:t=e.sent.default,this._areaOverlay=new t({areaData:this._areaData,mainBoard:this._mainBoard});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initShapeUpload",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.SHAPE_UPLOAD);case 2:t=e.sent.default,this._shapeUpload=new t({modifyShapeBroker:this._modifyBrokerCenter.shape});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initDimensionEdit",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.PC_DIMENSION_EDIT);case 2:t=e.sent.default,this._dimensionEdit=new t({spreadsheetApp:this._spreadsheetApp,spreadsheet:this._spreadsheet,rowcolAccessor:this._rowcolAccessor,alloyExcel:this._alloyExcel,areaData:this._areaData,renderApi:this._renderApi,mouseOperate:this._mouseOperate,touchOperate:this._touchOperate,headSize:this._headSize,operateData:this._operateData,scale:this._scale,clientRect:this._clientRect,autoScroll:this._autoScroll,scrollApi:this._scrollApi,mainBoard:this._mainBoard,container:this._container,sheetStatus:this._spreadsheetApp.sheetStatus,resize:this._resize,normalSelectData:this._normalSelectData,modifyDimensionBroker:this._modifyBrokerCenter.dimension,modifySelectionBroker:this._modifyBrokerCenter.selection});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initFreezePreview",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.FREEZE_PREVIEW);case 2:t=e.sent.default,this._freezePreview=new t({areaData:this._areaData,mainBoard:this._mainBoard,rowcolAccessor:this._rowcolAccessor,renderApi:this._renderApi});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initTestApi",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.TEST_API);case 2:t=e.sent.default,this._testApi=new t({areaData:this._areaData});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initFilterHeader",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.FILTER_CENTER);case 2:t=e.sent.default,this._filterCenter=new t({spreadsheetApp:this._spreadsheetApp,spreadsheet:this._spreadsheet,alloyExcel:this._alloyExcel,rowcolAccessor:this._rowcolAccessor,areaData:this._areaData,headSize:this._headSize,renderApi:this._renderApi,tableView:this._tableView,transformTable:this._transformTable,dataCallView:this._dataCallView,operateData:this._operateData,mouseOperate:this._mouseOperate,touchOperate:this._touchOperate});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initCellCornerPlugin",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.CELL_CORNER_PLUGIN);case 2:t=e.sent.default,this._cellCornerPlugin=new t({renderPluginExtension:this._renderPluginExtension,rowcolAccessor:this._rowcolAccessor,tableView:this._tableView,alloyExcel:this._alloyExcel});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initValidationList",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.PC_DATA_VALIDATION_CENTER);case 2:t=e.sent.default,this._dataValidationCenter=new t({spreadsheetApp:this._spreadsheetApp,spreadsheet:this._spreadsheet,alloyExcel:this._alloyExcel,normalSelectData:this._normalSelectData,tableView:this._tableView,rowcolAccessor:this._rowcolAccessor,areaData:this._areaData,headSize:this._headSize,renderApi:this._renderApi,mouseOperate:this._mouseOperate,touchOperate:this._touchOperate,operateData:this._operateData,clientRect:this._clientRect,mainBoard:this._mainBoard,inputManager:this._inputManager,mutexManagement:this._mutexManagement,sheetStatus:this._spreadsheetApp.sheetStatus,spreadsheetView:this._spreadsheetView});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initCollabFilterToast",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.COLLAB_FILTER_TOAST);case 2:t=e.sent.default,this._collabFilterToast=this._register(new t({mutationBehavior:this._spreadsheetApp.mutationBehavior,messageCenter:this._spreadsheetApp.messageCenter,getActiveSheetId:this._spreadsheet.getActiveSheetId.bind(this._spreadsheet),isFilterSync:function(){return r._spreadsheet.isFilterSync},spreadsheetApp:this._spreadsheetApp}));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initFormulaUICenter",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.PC_FORMULA_UI_CENTER);case 2:t=e.sent.default,this._formulaUICenter=new t({spreadsheetApp:this._spreadsheetApp,spreadsheet:this._spreadsheet,inputManager:this._inputManager,tableView:this._tableView,normalSelectData:this._normalSelectData,formulaSelectData:this._formulaSelectData,selectCells:this._selectCellsCenter.selectOperate,mainBoard:this._mainBoard,cardCenter:this._cardCenter,alloyExcel:this._alloyExcel,rowcolAccessor:this._rowcolAccessor,operateData:this._operateData,areaData:this._areaData,headSize:this._headSize,clientRect:this._clientRect,operateBoard:this._operateBoard.board,modifyCellBroker:this._modifyBrokerCenter.cell,cellCornerPlugin:this._cellCornerPlugin});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initCopyFrame",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.COPY_FRAME);case 2:t=e.sent.default,this._copyFrame=new t({alloyExcel:this._alloyExcel,areaData:this._areaData,headSize:this._headSize,renderApi:this._renderApi,spreadsheet:this._spreadsheet});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initCornerTriangle",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.CORNER_TRIANGLE_RENDER_PLUGIN);case 2:new(0,e.sent.default)({alloyExcel:this._alloyExcel,normalSelectData:this._normalSelectData,transformTable:this._transformTable,coverBackgroundCollect:this._renderPluginExtension.coverBackgroundCollect});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initMentionCenter",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.MENTION_CENTER);case 2:new(0,e.sent.default)({inputManager:this._inputManager,spreadsheet:this._spreadsheet,rowcolAccessor:this._rowcolAccessor,alloyExcel:this._alloyExcel,mouseOperate:this._mouseOperate,areaData:this._areaData,headSize:this._headSize,renderApi:this._renderApi,tableView:this._tableView,transformTable:this._transformTable,rowCoverAccessor:this._rowCoverAccessor,operateData:this._operateData,clientRect:this._clientRect,scale:this._scale,sheetStatus:this._spreadsheetApp.sheetStatus,paragraphAccessor:this._paragraphAccessor});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initPreviewImageIcon",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.PREVIEW_IMAGE_ICON);case 2:new(0,e.sent.default)({alloyExcel:this._alloyExcel,spreadsheet:this._spreadsheet,rowcolAccessor:this._rowcolAccessor,scale:this._scale,tableView:this._tableView});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initChartCenter",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.CHART_CENTER);case 2:t=e.sent.default,this._chartCenter=new t({mainBoard:this._mainBoard,dataCallView:this._dataCallView,spreadsheet:this._spreadsheet,areaData:this._areaData,scale:this._scale,operateData:this._operateData,mutexManagement:this._mutexManagement,modifyChartBroker:this._modifyBrokerCenter.chart,menu:this._contextMenuCenter.contextMenu,menuConfig:this._contextMenuCenter.config,normalSelectionStage:this._normalSelectionStage,spreadsheetApp:this._spreadsheetApp});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initTableKeyboard",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.TABLE_KEYBOARD);case 2:t=e.sent.default,this._tableKeyboard=new t({spreadsheetApp:this._spreadsheetApp,board:this._container,config:{base:!0,edit:!0,copyPaste:!0,loadingImg:!0}});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initSearchReplaceCenter",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.SEARCH_REPLACE);case 2:t=e.sent.default,this._searchReplaceCenter=new t({spreadsheetApp:this._spreadsheetApp,spreadsheet:this._spreadsheet,rowcolAccessor:this._rowcolAccessor,alloyExcel:this._alloyExcel,tableView:this._tableView,renderApi:this._renderApi,scrollApi:this._scrollApi,selectApi:this._selectApi,renderPluginExtension:this._renderPluginExtension});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initRangeAuthRenderPlugin",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.RANGE_AUTH_RENDER_PLUGIN);case 2:t=e.sent.default,this._rangeAuthRenderPlugin=new t({alloyExcel:this._alloyExcel,spreadsheetApp:this._spreadsheetApp,spreadsheet:this._spreadsheet,rowcolAccessor:this._rowcolAccessor,tableView:this._tableView,rangeAuthBackgroundCollector:this._renderPluginExtension.rangeAuthBackgroundCollector,renderApi:this._renderApi,areaData:this._areaData,headSize:this._headSize});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initInputSmartSplit",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.INPUT_SMART_SPLIT);case 2:new(0,e.sent.default)({spreadsheetApp:this._spreadsheetApp});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initConditionFormatCenter",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.CONDITION_FORMAT_CENTER);case 2:t=e.sent.default,this._conditionFormatCenter=new t({spreadsheetApp:this._spreadsheetApp,spreadsheet:this._spreadsheet,tableView:this._tableView,normalSelectData:this._normalSelectData,mainBoard:this._mainBoard,areaData:this._areaData,requestApi:this._spreadsheetApp.requestApi,mutationBehavior:this._spreadsheetApp.mutationBehavior,sheetStatus:this._spreadsheetApp.sheetStatus});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initErrorTip",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.ERROR_TIP);case 2:t=e.sent.default,this._errorTip=new t(this._spreadsheetApp.instantiationService,this._spreadsheetApp,this._errorTipAccessor,this._cellCornerPlugin,this._renderApi,this._dataCallView,this._normalSelectData,this._areaData);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initCellEditorManager",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.CELL_EDITOR_MANAGER);case 2:t=e.sent.default,this._cellEditorManager=new t({mainBoard:this._mainBoard,mouseOperate:this._mouseOperate,areaData:this._areaData,rowColAccessor:this._rowcolAccessor,scale:this._scale,spreadsheetApp:this._spreadsheetApp,normalSelectData:this._normalSelectData,scrollApi:this._scrollApi,spreadsheet:this._spreadsheet,operateBoard:this._operateBoard,headSize:this._headSize,alloyExcel:this._alloyExcel,touchOperate:this._touchOperate,mutexManagement:this._mutexManagement,inputManager:this._inputManager});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initCellImageViewer",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(h.a.CELL_IMAGE_VIEWER);case 2:t=e.sent.default,this._cellImageViewer=new t({mouseOperate:this._mouseOperate,normalSelectData:this._normalSelectData,spreadsheet:this._spreadsheet,operateBoard:this._operateBoard,shapeZoom:this.shapeEdit.shapeZoom,operateData:this._operateData,touchOperate:this._touchOperate});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"shapeEdit",get:function(){return this._shapeEditCenter.shapeEdit}},{key:"selectCells",get:function(){return this._selectCellsCenter.selectOperate}},{key:"collabCursor",get:function(){return this._collabCursor}},{key:"renderPluginExtension",get:function(){return this._renderPluginExtension}},{key:"cardCenter",get:function(){return this._cardCenter}},{key:"linkCenter",get:function(){return this._linkCenter}},{key:"formulaUICenter",get:function(){return this._formulaUICenter}},{key:"commentCenter",get:function(){return this._commentCenter}},{key:"areaOverlay",get:function(){return this._areaOverlay}},{key:"chartCenter",get:function(){return this._chartCenter}},{key:"searchReplaceCenter",get:function(){return this._searchReplaceCenter}},{key:"freezePreview",get:function(){return this._freezePreview}},{key:"copyFrame",get:function(){return this._copyFrame}},{key:"testApi",get:function(){return this._testApi}},{key:"smartDrag",get:function(){return this._smartDrag}},{key:"contextMenu",get:function(){if(this._contextMenuCenter)return this._contextMenuCenter.contextMenu}},{key:"shapeUpload",get:function(){return this._shapeUpload}},{key:"rangeAuthRender",get:function(){return this._rangeAuthRenderPlugin}},{key:"collabFilterToast",get:function(){return this._collabFilterToast}},{key:"dataValidationCenter",get:function(){return this._dataValidationCenter}},{key:"conditionFormatCenter",get:function(){return this._conditionFormatCenter}},{key:"errorTip",get:function(){return this._errorTip}},{key:"cellEditorManager",get:function(){return this._cellEditorManager}},{key:"cellImageViewer",get:function(){return this._cellImageViewer}}]),r}(Object(d.c)(u.a));t.a=p},"./src/core/view/config/default.ts":function(e,t,r){"use strict";(function(e){r.d(t,"g",(function(){return d})),r.d(t,"r",(function(){return h})),r.d(t,"q",(function(){return f})),r.d(t,"f",(function(){return p})),r.d(t,"p",(function(){return _})),r.d(t,"n",(function(){return m})),r.d(t,"o",(function(){return v})),r.d(t,"h",(function(){return g})),r.d(t,"i",(function(){return b})),r.d(t,"j",(function(){return y})),r.d(t,"a",(function(){return w})),r.d(t,"l",(function(){return R})),r.d(t,"d",(function(){return E})),r.d(t,"b",(function(){return C})),r.d(t,"e",(function(){return j})),r.d(t,"c",(function(){return O})),r.d(t,"k",(function(){return S})),r.d(t,"m",(function(){return D})),r.d(t,"t",(function(){return x})),r.d(t,"y",(function(){return k})),r.d(t,"x",(function(){return T})),r.d(t,"w",(function(){return A})),r.d(t,"v",(function(){return I})),r.d(t,"u",(function(){return N})),r.d(t,"s",(function(){return L}));var n=r("./src/core/view/spreadsheet-view/model/VerticalAlign.ts"),a=r("./src/core/view/spreadsheet-view/model/HorizontalAlign.ts"),o=r("./src/core/view/spreadsheet-view/model/WrapStrategy.ts"),i=r("./src/core/view/spreadsheet-view/model/Color.ts"),s=r("./src/core/view/spreadsheet-view/model/CellPadding.ts"),l=r("./src/core/view/spreadsheet-view/render-manager/alloy-excel/utils.ts"),c=r("./src/external/view/mobile/header/native-header/utils.ts"),u=/(mobile)/i.test(e.navigator&&e.navigator.userAgent.toLowerCase()),d=107,h=24,f=50,p=24,_=l.b.THIN,m=i.a.newInstanceByHex("#dcdcdc"),v=l.a.THIN,g=i.a.newInstanceByHex("#000000"),b={value:"Arial"},y=10,w=i.a.newInstanceByHex("#ffffff"),R={width:_,style:v,color:i.a.newInstanceByHex("#e2e4e8")},E=n.b.newInstance(n.a.MIDDLE),C=a.b.newInstance(a.a.LEFT),j=o.b.newInstance(o.a.NOWRAP),O=(i.a.newInstanceByHex("#d6d6d6"),s.b.newInstance(s.a.EMPTY,s.a.TEXT,s.a.EMPTY,s.a.TEXT)),S=4,D=2,x={Height:22,Radius:11,OuterPadding:1,InnerLeftRightPadding:8,TriangleWidth:8,TriangleHeight:5,LabelAndTrianglePadding:4},k=[0,0,x.TriangleWidth,0,x.TriangleWidth/2,x.TriangleHeight],T={TextColor:"#0188fb",BorderWidth:1,StrokeColor:"#e0e0e0",NormalFillColor:"#ffffff",HoverFillColor:u?"#ffffff":"#f4f4f4",HighlightFillColor:"#fff4c4",ShadowInfo:{shadowColor:"#B9B9B9",shadowOffsetX:0,shadowOffsetY:2,shadowBlur:10},TriangleColor:"#0188fb"},A={borderWidth:T.BorderWidth,fillColor:T.NormalFillColor,strokeColor:T.StrokeColor,shadowInfo:T.ShadowInfo},I={borderWidth:T.BorderWidth,fillColor:T.HoverFillColor,strokeColor:T.StrokeColor,shadowInfo:T.ShadowInfo},N={borderWidth:T.BorderWidth,fillColor:T.HighlightFillColor,strokeColor:T.StrokeColor,shadowInfo:T.ShadowInfo},L=Object(c.a)()?0:44}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/view/data-call-view/DataCallView.interface.ts":function(e,t,r){"use strict";var n=r("../packages/services/src/instantiation.ts"),a=Object(n.c)("IDataCallView");t.a=a},"./src/core/view/data-call-view/DataCallView.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),i=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),s=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),l=r("./src/base/event/event.ts"),c=r("../packages/mutation/src/MutationId.ts"),u=r("../packages/model/src/dimension/DimensionType.ts"),d=r("../packages/mutation/src/dimension/SetDimensionPropertiesMutation.ts"),h=r("../packages/model/src/sheet/SheetPropertiesSlot.ts"),f=r("../packages/lib/index.ts");function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var _=function(t){Object(o.a)(i,t);var r=p(i);function i(e){var t;return Object(n.a)(this,i),(t=r.call(this))._cacheFilterHeader=null,t._onInsertRow=new f.a,t.onInsertRow=t._onInsertRow.event,t._onInsertCol=new f.a,t.onInsertCol=t._onInsertCol.event,t._onDeleteRow=new f.a,t.onDeleteRow=t._onDeleteRow.event,t._onDeleteCol=new f.a,t.onDeleteCol=t._onDeleteCol.event,t._onSetRowHeight=new f.a,t.onSetRowHeight=t._onSetRowHeight.event,t._onSetColWidth=new f.a,t.onSetColWidth=t._onSetColWidth.event,t._onSetRowVisible=new f.a,t.onSetRowVisible=t._onSetRowVisible.event,t._onSetColVisible=new f.a,t.onSetColVisible=t._onSetColVisible.event,t._onUpdateCells=new f.a,t.onUpdateCells=t._onUpdateCells.event,t._onMergeUnmerge=new f.a,t.onMergeUnmerge=t._onMergeUnmerge.event,t._onAddEmbeddedObject=new f.a,t.onAddEmbeddedObject=t._onAddEmbeddedObject.event,t._onUpdateEmbeddedObject=new f.a,t.onUpdateEmbeddedObject=t._onUpdateEmbeddedObject.event,t._onDeleteEmbeddedObject=new f.a,t.onDeleteEmbeddedObject=t._onDeleteEmbeddedObject.event,t._onUpdateHideGridLines=new f.a,t.onUpdateHideGridLines=t._onUpdateHideGridLines.event,t._onUpdateFreeze=new f.a,t.onUpdateFreeze=t._onUpdateFreeze.event,t._onAddChart=new f.a,t.onAddChart=t._onAddChart.event,t._onDeleteChart=new f.a,t.onDeleteChart=t._onDeleteChart.event,t._onUpdateChart=new f.a,t.onUpdateChart=t._onUpdateChart.event,t._handleAfterMutationRun=function(e){if(t._spreadsheet.activeSheetId===e.sheetId||"WORKBOOK"===e.sheetId){var r=e.mutation;e.sheetId,e.isCollab,e.isLocal;switch(r.id){case c.b.INSERT_DIMENSION_MUTATION:t._insertDimension(r);break;case c.b.DELETE_DIMENSION_MUTATION:t._deleteDimension(r);break;case c.b.SET_DIMENSION_PROPERTIES_MUTATION:t._setDimensionProperties(r);break;case c.b.SET_RANGE_MUTATION:t._setRange(r);break;case c.b.SET_CELL_PROPERTIES_MUTATION:t._setCellProperties(r);break;case c.b.REORDER_RANGE_MUTATION:t._reorderRange(r);break;case c.b.COPY_PASTE_MUTATION:t._copyPaste(r);break;case c.b.MERGE_CELLS_MUTATION:case c.b.UNMERGE_CELLS_MUTATION:t._mergeOrUnmerge(r);break;case c.b.ADD_EMBEDDED_OBJECT_MUTATION:t._addEmbedded(r);break;case c.b.UPDATE_EMBEDDED_OBJECT_MUTATION:t._updateEmbedded(r);break;case c.b.DELETE_EMBEDDED_OBJECT_MUTATION:t._deleteEmbedded(r);break;case c.b.SET_SHEET_PROPERTIES_MUTATION:t._setSheetProperties(r);break;case c.b.DEFINE_FILTER_MUTATION:t._defineFilter(r);break;case c.b.UPDATE_FILTER_MUTATION:t._updateFilter(r);break;case c.b.DELETE_FILTER_MUTATION:t._deleteFilter(r);break;case c.b.NEW_ADD_EMBEDDED_OBJECT_MUTATION:t._newAddEmbeddedObject(r);break;case c.b.NEW_UPDATE_EMBEDDED_OBJECT_MUTATION:t._newUpdateEmbeddedObject(r);break;case c.b.NEW_DELETE_EMBEDDED_OBJECT_MUTATION:t._newDeleteEmbeddedObject(r)}}},t._spreadsheet=e.spreadsheet,t._setCacheFilterHeader(),t.start(),t}return Object(a.a)(i,[{key:"stop",value:function(){var t;null===(t=e.log)||void 0===t||t.debug("flow DataCallView stop()"),l.c.spreadsheetEvent.remove("renderAfterMutationRun",this._handleAfterMutationRun)}},{key:"start",value:function(){l.c.spreadsheetEvent.listen("renderAfterMutationRun",this._handleAfterMutationRun)}},{key:"refresh",value:function(){this._setCacheFilterHeader(),this.stop(),this.start()}},{key:"reRenderChart",value:function(e){var t=this;this._spreadsheet.embeddedObjectManager.each((function(r){var n=r.properties.chart;n&&(n.workbookRangeId.indexOf(e.workbookRangeId)>-1&&r.location.sheetId===t._spreadsheet.activeSheetId&&t._onUpdateChart.fire({object:r}))}))}},{key:"setRowHeight",value:function(e,t){this._onSetRowHeight.fire({ranges:[{startIndex:e,endIndex:e,dimension:u.a.ROWS}],size:t})}},{key:"_setCacheFilterHeader",value:function(){var e=this._spreadsheet.activeSheet.getBasicFilter();if(null!==e){var t=e.range;this._cacheFilterHeader={startRow:t.startRowIndex,endRow:t.endRowIndex,startCol:t.startColIndex,endCol:t.endColIndex}}else this._cacheFilterHeader=null}},{key:"_insertDimension",value:function(e){e.type===u.a.ROWS?this._onInsertRow.fire(e):this._onInsertCol.fire(e)}},{key:"_deleteDimension",value:function(e){e.type===u.a.ROWS?this._onDeleteRow.fire(e):this._onDeleteCol.fire(e)}},{key:"_setDimensionProperties",value:function(e){for(var t=0;t<e.operation.length;t++){var r=e.operation[t];if(r.slot===d.a.SLOT_SIZE){var n={ranges:e.ranges,size:r.size};e.type===u.a.ROWS?this._onSetRowHeight.fire(n):this._onSetColWidth.fire(n)}else if(r.slot===d.a.SLOT_HIDDEN){var a={ranges:e.ranges,hidden:!!r.hidden};e.type===u.a.ROWS?this._onSetRowVisible.fire(a):this._onSetColVisible.fire(a)}}}},{key:"_setRange",value:function(e){var t={startRow:e.gridRange.startRowIndex,endRow:e.gridRange.endRowIndex,startCol:e.gridRange.startColIndex,endCol:e.gridRange.endColIndex};this._onUpdateCells.fire(t)}},{key:"_setCellProperties",value:function(e){var t={startRow:e.gridRange.startRowIndex,endRow:e.gridRange.endRowIndex,startCol:e.gridRange.startColIndex,endCol:e.gridRange.endColIndex};this._onUpdateCells.fire(t)}},{key:"_reorderRange",value:function(e){var t={startRow:e.range.startRowIndex,endRow:e.range.endRowIndex,startCol:e.range.startColIndex,endCol:e.range.endColIndex};this._onUpdateCells.fire(t)}},{key:"_copyPaste",value:function(e){var t=this;e.pasteMappings.forEach((function(e){var r={startRow:e.destination.startRowIndex,endRow:e.destination.endRowIndex,startCol:e.destination.startColIndex,endCol:e.destination.endColIndex};t._onUpdateCells.fire(r)}))}},{key:"_mergeOrUnmerge",value:function(e){var t={startRow:e.startRowIndex,endRow:e.endRowIndex,startCol:e.startColIndex,endCol:e.endColIndex};this._onUpdateCells.fire(t),this._onMergeUnmerge.fire(t)}},{key:"_addEmbedded",value:function(e){this._onAddEmbeddedObject.fire(e.data.id)}},{key:"_updateEmbedded",value:function(e){this._onUpdateEmbeddedObject.fire(e.data.id)}},{key:"_deleteEmbedded",value:function(e){this._onDeleteEmbeddedObject.fire(e.key)}},{key:"_setSheetProperties",value:function(e){if(e.sheetDelta)for(var t=e.sheetDelta.deltas,r=0;r<t.length;r++)switch(t[r].slotName){case h.a.SLOT_FROZEN_COL_COUNT:case h.a.SLOT_FROZEN_ROW_COUNT:this._onUpdateFreeze.fire();break;case h.a.SLOT_HIDE_GRID_LINE:this._onUpdateHideGridLines.fire()}}},{key:"_defineFilter",value:function(e){var t=e.gridRange.startRowIndex,r=e.gridRange.startColIndex,n=e.gridRange.endColIndex;this._cacheFilterHeader={startRow:t,endRow:t,startCol:r,endCol:n},this._onUpdateCells.fire(this._cacheFilterHeader)}},{key:"_updateFilter",value:function(e){var t,r=null===(t=this._spreadsheet.activeSheet.getBasicFilter())||void 0===t?void 0:t.range;r&&this._onSetRowVisible.fire({ranges:[{startIndex:r.startRowIndex,endIndex:r.endRowIndex,dimension:u.a.ROWS}]})}},{key:"_deleteFilter",value:function(e){null!==this._cacheFilterHeader&&(this._onUpdateCells.fire(this._cacheFilterHeader),this._onSetRowVisible.fire({ranges:[{startIndex:this._cacheFilterHeader.startRow,endIndex:this._cacheFilterHeader.endRow,dimension:u.a.ROWS}]}),this._cacheFilterHeader=null)}},{key:"_newAddEmbeddedObject",value:function(e){e.object.location.sheetId===this._spreadsheet.getActiveSheetId()&&this._onAddChart.fire(e)}},{key:"_newUpdateEmbeddedObject",value:function(e){e.object.location.sheetId===this._spreadsheet.getActiveSheetId()&&this._onUpdateChart.fire(e)}},{key:"_newDeleteEmbeddedObject",value:function(e){this._onDeleteChart.fire(e)}}]),i}(r("../packages/services/src/dispose.ts").a);t.a=_}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/view/layout/common/ocr-util.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),r("./src/core/feature/copyPaste/api/copyPasteAPI.m.ts");var n=r("../packages/common-utils/src/url.ts");var a="1"===Object(n.getQuery)("m_preview")},"./src/core/view/layout/pcView.ts":function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return w}));r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/regenerator-runtime/runtime.js");var n=r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=r("../node_modules/@babel/runtime/helpers/esm/get.js"),s=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),l=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),c=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),u=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),d=r("./src/core/app/SpreadsheetApp.interface.ts"),h=r("./src/core/view/layout/view.ts"),f=r("./src/core/view/View.level2.pc.ts"),p=r("./src/base/event/eventName.ts"),_=r("./src/core/view/spreadsheet-view/table-view/utils.ts"),m=r("../packages/services/src/instantiation.ts"),v=r("./src/base/report/fps.ts");function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(l.a)(this,r)}}var b=function(e,t,r,n){var a,o=arguments.length,i=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(u.a)(Reflect))&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(i=(o<3?a(i):o>3?a(t,r,i):a(t,r))||i);return o>3&&i&&Object.defineProperty(t,r,i),i},y=function(e,t){return function(r,n){t(r,n,e)}},w=Object(m.c)("IPCView"),R=function(t){Object(s.a)(u,t);var l=g(u);function u(e){var t;return Object(a.a)(this,u),(t=l.call(this,e)).app=e,t.parent=e,t}return Object(o.a)(u,[{key:"initCanvas",value:function(){var t=Object(n.a)(regeneratorRuntime.mark((function t(){var r,a=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.canvas){t.next=2;break}throw new Error("\u89c6\u56fe\u5df2\u7ecf\u521d\u59cb\u5316");case 2:r=document.querySelector("#canvasContainer"),this.canvas=this._register(new f.a(this.parent,this.parent.spreadsheet,r)),this.canvas.initLevel1(),Object(_.a)(this.canvas.tableView,0,this.parent.spreadsheet.activeSheet.getRowCount()-1,0,this.parent.spreadsheet.activeSheet.getColCount()-1),this.canvas.renderApi.renderTable(),this.parent.event.init.trigger(p.a.AFTER_FIRST_RENDER),v.a.start("fps_init"),this.parent.emitter.once(this.parent.EVENT.SPREAD_SHEET_PLUGINS_END,Object(n.a)(regeneratorRuntime.mark((function t(){var r,n,o,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.canvas.initLevel2();case 2:a.canvas.renderApi.renderNextTick(),a._afterCanvasLoaded(),a.parent.event.init.trigger(p.a.AFTER_ALL_RENDER),a.parent.emitter.on(a.parent.EVENT.SPREAD_SHEET_PLUGINS_END,(function(){a.hideAllLoading(),a.parent.event.init.trigger(p.a.AFTER_ALL_RENDER)})),window.SpreadsheetAppInitComplete?a.canvas.shapeStage.refresh():a.app.emitter.once(a.app.EVENT.SPREAD_SHEET_ALL_CHUNK_READY,(function(){a.canvas.shapeStage.refresh()})),null===(r=e)||void 0===r||null===(n=r.document)||void 0===n||null===(o=n.body)||void 0===o||null===(i=o.classList)||void 0===i||i.add("all-ready"),v.a.end("fps_init");case 9:case"end":return t.stop()}}),t)}))));case 10:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"onRefreshExcelView",value:function(e){Object(i.a)(Object(c.a)(u.prototype),"setSheetScroll",this).call(this,e),Object(i.a)(Object(c.a)(u.prototype),"setSelection",this).call(this,e)}},{key:"_afterCanvasLoaded",value:function(){Object(i.a)(Object(c.a)(u.prototype),"_afterCanvasLoaded",this).call(this)}},{key:"initPlugins",value:function(){var e=this;return r.e("bundle_panel_pc").then(r.bind(null,"./src/external/view/main/panel/index.ts")).then((function(t){var r=t.CustomFormatPanel,n=t.DataValidationPanel,a=t.SortRangePanel,o=t.RangeSelectionPanel,i=t.ValidationErrorPanel,s=t.FilterPanel,l=t.FormulaEditorPanel,c=t.SidePanelMain,u=t.ChartPanel,d=t.RangeAuthPanel,h=t.AuthPanel,f=t.ReadRecordPanel,p=t.ErrorTipPanel,_=new c(e.parent);e.plugins={customFormatPanel:new r(e.parent),dataValidationPanel:new n(e.parent),rangeSelectionPanel:new o(e.parent),sortRangePanel:new a(e.parent),validationErrorPanel:new i(e.parent),filterPanel:new s(e.parent),formulaEditorPanel:new l(e.parent),chartPanel:new u(e.parent),rangeAuthPanel:new d(e.parent),authPanel:new h({sidePanelMain:_}),readRecordPanel:new f({sidePanelMain:_}),errorTipPanel:new p(e.parent),sidePanelMain:_}}))}}]),u}(h.a);R=b([y(0,d.a)],R),t.b=R}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/view/layout/view.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),s=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),l=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),c=r("../packages/report/src/index.ts"),u=r("./src/core/view/level-1/select-data/utils.ts"),d=r("./src/base/event/event.ts"),h=r("../packages/model/src/grid/Selection.ts"),f=r("../packages/model/src/grid/Cell.ts"),p=r("../packages/model/src/range/GridRange.ts"),_=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),m=r.n(_),v=r("./src/core/view/level-2/dimension-edit/hide-show-head/utils.ts"),g=r("./src/core/view/layout/common/ocr-util.ts"),b=r("./src/flow/flowlog.ts"),y=r("../packages/services/src/dispose.ts"),w=r("./src/core/view/level-1/select-data/selection/AllSelection.ts");function R(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var E=function(t){Object(i.a)(s,t);var r=R(s);function s(e){var t;return Object(a.a)(this,s),(t=r.call(this)).parent=e,t._selectionCache={},t._viewSheetHeightsCache={},t.initViewEvent(),t}return Object(o.a)(s,[{key:"resetAndRefreshExcelView",value:function(e){this._selectionCache={}}},{key:"hideAllLoading",value:function(){b.a.info("LifeCycle call hideAllLoading()",!!e.snackLoading,!!e.firstLoading),e.snackLoading&&e.snackLoading.hide(),e.firstLoading&&e.firstLoading.hide()}},{key:"reportLocation",value:function(){var e;if(this.canvas){var t=this.canvas.normalSelectData.activeCol,r=this.canvas.normalSelectData.activeRow;if(!(t<0||r<0)){var n={coords:[r,t,r,t],isEditing:!!(null===(e=this.canvas.inputManager)||void 0===e?void 0:e.isInputtingState())};d.c.network.trigger("userCaretChange",n)}}}},{key:"initViewEvent",value:function(){var e,t=this;null===(e=this.parent.emitter)||void 0===e||e.on(this.parent.EVENT.NEW_DOC_SPREAD_SHEET_PART_INTERACTIVE,(function(e){t.refreshExcelView(e)}))}},{key:"getSelection",value:function(e){var t,r=this.parent.spreadsheet.activeSheetId,n=this.parent.spreadsheet.activeSheet.getColCount()-1,a=this.parent.spreadsheet.activeSheet.getRowCount()-1;if(e){var o=new f.a(r,0,0),i=new p.b(r,0,a,0,n);return new h.a(o,[i],[],!1,[w.a.newInstance()])}if(!(null===(t=this.canvas)||void 0===t?void 0:t.normalSelectData))throw new Error("\u8c03\u7528getSelection\u592a\u65e9\uff0c\u6a21\u5757\u672a\u52a0\u8f7d");var s=this.canvas.normalSelectData,l=s.selectQueue,c=s.activeRow,d=s.activeCol,_=new f.a(r,c,d),m=Object(u.o)(r,this.canvas.rowcolAccessor,l);return new h.a(_,m,[],!1,l)}},{key:"saveSeletionCache",value:function(e,t){var r=t||this.getSheetLocation();this._selectionCache[e]=r}},{key:"deleteSeletionCache",value:function(e){delete this._selectionCache[e]}},{key:"getSelectionCache",value:function(e){return this._selectionCache[e]}},{key:"setSelection",value:function(e){var t=this.getSelectionCache(e);if(void 0!==t){var r,a,o,i=(null===(r=t.xRange)||void 0===r?void 0:r[0])||0,s=(null===(a=t.yRange)||void 0===a?void 0:a[0])||0,l=this.parent.spreadsheet.sheetManager.getSheetBySheetId(e);if(l){var c=this._setSelectionInSheet(t,l);i=c.x,s=c.y}if(!m.a.isMobilePhone&&!m.a.isAndroidPad)this.canvas.selectApi.selectCells({xRange:t.xRange&&Object(n.a)(t.xRange),yRange:t.yRange&&Object(n.a)(t.yRange)}),null===(o=this.inputBox)||void 0===o||o.setCellCoordDisplay(i,s)}else m.a.isMobilePhone||m.a.isAndroidPad||this.setFirstCellFocus()}},{key:"getSheetLocation",value:function(){var e,t=this.canvas,r={xRange:[],yRange:[],row:{frozen:0,flow:0},col:{frozen:0,flow:0}};if(null===t||void 0===t||null===(e=t.normalSelectData)||void 0===e?void 0:e.selectQueue[0]){var n=Object(u.p)(t.rowcolAccessor,[t.normalSelectData.selectQueue[0]]),a=Object(u.n)(t.rowcolAccessor,[t.normalSelectData.selectQueue[0]]);r={xRange:[C(a[0][0]),C(a[0][1])],yRange:[C(n[0][0]),C(n[0][1])]}}return r.row={frozen:t.areaData.row.frozen.offsetSize,flow:t.areaData.row.flow.offsetSize},r.col={frozen:t.areaData.col.frozen.offsetSize,flow:t.areaData.col.flow.offsetSize},r}},{key:"getCurrentPosition",value:function(){return this.canvas?{rowIndex:this.canvas.areaData.row.flow.renderFrom,colIndex:this.canvas.areaData.col.flow.renderFrom}:{rowIndex:0,colIndex:0}}},{key:"setFirstCellFocus",value:function(){var e=Object(v.a)(this.parent.spreadsheet.activeSheet,-1,1),t=Object(v.b)(this.parent.spreadsheet.activeSheet,-1,1);this.canvas.selectApi.selectCells({xRange:[e,e],yRange:[t,t]})}},{key:"setTopScroll",value:function(){this.canvas.scrollApi.scrollByPixel({areaX:"flow",diffX:0,areaY:"flow",diffY:0})}},{key:"setSheetScroll",value:function(e){var t=this.getSelectionCache(e);if(void 0!==t){var r=t.col.flow,n=t.row.flow;this.canvas.scrollApi.scrollByPixel({areaX:"flow",diffX:r,areaY:"flow",diffY:n})}else m.a.isMobilePhone||m.a.isAndroidPad||this.setTopScroll()}},{key:"render",value:function(e){if(!this.canvas)throw new Error("\u89c6\u56fe\u5c1a\u672a\u521d\u59cb\u5316");this.refreshExcelView(e)}},{key:"updateSheetsbar",value:function(){var e;null===(e=this.sheetsBar)||void 0===e||e.refreshUI()}},{key:"startLazy",value:function(){return Promise.all([this.initPlugins()])}},{key:"refreshExcelView",value:function(t){var r;c.b.jank.log({moduleValue:"SHEETS_BAR_JANK",actionValue:"SWITCH_SHEET"}),null===(r=e.log)||void 0===r||r.info("sheets_bar::switch_sheet_full_refresh_canvas"),this.refreshExcelViewData(t),this.onRefreshExcelView(t),this.canvas.renderApi.renderNextTick()}},{key:"refreshExcelViewSync",value:function(t){var r;null===(r=e.log)||void 0===r||r.info("flow refreshExcelViewSync"),this.refreshExcelViewData(t),this.onRefreshExcelView(t),this.canvas.renderApi.renderTable()}},{key:"onRefreshExcelView",value:function(e){}},{key:"_afterCanvasLoaded",value:function(){window.performanceData&&(window.performanceData.initAfterCanvasLoaded=+new Date),this.hideAllLoading()}},{key:"initPlugins",value:function(){return Promise.resolve()}},{key:"hideLoadingAndWebviewBarIfPreview",value:function(){if(g.a){var e,t,r=document.createElement("style");if(r.setAttribute("type","text/css"),r.innerText=".snack-loading-container { display: none !important }",document.head.appendChild(r),m.a.isTencentDocsApp)null===(e=window.mqq)||void 0===e||null===(t=e.ui)||void 0===t||t.setWebViewBehavior({titleBarHide:!0})}}},{key:"refreshExcelViewData",value:function(e){var t=this.getActiveSheet();if(e!==t.getSheetId())throw new Error("\u66f4\u65b0 sheet \u5f02\u5e38");this.canvas.refresh(),this.canvas.tableView.cellDataToCellView(0,t.getRowCount()-1,0,t.getColCount()-1)}},{key:"getActiveSheet",value:function(){return this.parent.spreadsheet.activeSheet}},{key:"_setSelectionInSheet",value:function(e,t){var r,n,a=(null===(r=e.xRange)||void 0===r?void 0:r[0])||0,o=(null===(n=e.yRange)||void 0===n?void 0:n[0])||0;return(a>=t.getColCount()||t.data.isColHidden(a))&&(a=Object(v.a)(t,0,1)),(o>=t.getRowCount()||t.data.isRowHidden(o))&&(o=Object(v.b)(t,0,1)),e.xRange=[a,a],e.yRange=[o,o],{x:a,y:o}}}]),s}(y.a);function C(e){return e<0?0:e}t.a=E}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/view/level-1/auto-scroll/AutoScroll.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));r("../node_modules/core-js/modules/es.number.constructor.js"),r("../node_modules/core-js/modules/es.number.max-safe-integer.js");var n,a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=r("../packages/lib/EventEmitter.ts"),s=r("./src/core/view/config/default.ts");!function(e){e[e.NONE=0]="NONE",e[e.TOP=1]="TOP",e[e.RIGHT=2]="RIGHT",e[e.BOTTOM=4]="BOTTOM",e[e.LEFT=8]="LEFT",e[e.Y=5]="Y",e[e.X=10]="X",e[e.ALL=15]="ALL"}(n||(n={}));var l=function(){function e(t){var r=this;Object(a.a)(this,e),this._currDirection=n.NONE,this._running=!1,this._diff={x:0,y:0},this._virtualTouch={clientX:0,clientY:0,identifier:Date.now(),target:document},this._handleMousemove=function(t){r._calc()?(r._cacheClientX=t.clientX,r._cacheClientY=t.clientY,r.emitter.emit(e.EVENT.AUTO_SCROLL,{diffX:r._diff.x,diffY:r._diff.y}),r._startDispatchEvent(r._dispatchMousemove)):r._timer&&clearInterval(r._timer)},this._handleTouchmove=function(t){r._calc()?(r._cacheClientX=t.touches[0].clientX,r._cacheClientY=t.touches[0].clientY,r.emitter.emit(e.EVENT.AUTO_SCROLL,{diffX:r._diff.x,diffY:r._diff.y}),r._startDispatchEvent(r._dispatchTouchmove)):r._timer&&clearInterval(r._timer)},this._handleUp=function(){document.removeEventListener("mousemove",r._handleMousemove),document.removeEventListener("mouseup",r._handleUp),document.removeEventListener("touchmove",r._handleTouchmove),document.removeEventListener("touchend",r._handleUp),clearTimeout(r._timer),r._currDirection=n.NONE,r._startFocusColArea=null,r._startFocusRowArea=null,r._currFocusColArea=null,r._currFocusRowArea=null,r._diff.x=0,r._diff.y=0,r._maxWidth=0,r._maxHeight=0,r._running=!1},this._startDispatchEvent=function(e){clearTimeout(r._timer),r._timer=setTimeout(e,60)},this._dispatchMousemove=function(){try{var e=new MouseEvent("mousemove",{clientX:r._cacheClientX,clientY:r._cacheClientY});document.dispatchEvent(e)}catch(t){return}r._startDispatchEvent(r._dispatchMousemove)},this._dispatchTouchmove=function(){r._virtualTouch.clientX=r._cacheClientX,r._virtualTouch.clientY=r._cacheClientY;var e=new TouchEvent("touchmove",{touches:[new Touch(r._virtualTouch)]});document.dispatchEvent(e),r._startDispatchEvent(r._dispatchTouchmove)},this._handleOut=function(e){var t=e.relatedTarget||e.toElement;t&&"HTML"!=t.nodeName||r._handleUp()},this.emitter=new i.a,this._headSize=t.headSize,this._areaData=t.areaData,this._operateData=t.operateData,this._clientRect=t.clientRect}return Object(o.a)(e,[{key:"ready",value:function(e,t,r){this._currDirection=e;var n=this._getCurrFocusRowArea(),a=this._getCurrFocusColArea();this._currFocusRowArea=n,this._startFocusRowArea=n,this._currFocusColArea=a,this._startFocusColArea=a,document.addEventListener("mousemove",this._handleMousemove,!0),document.addEventListener("mouseup",this._handleUp,!0),document.addEventListener("touchmove",this._handleTouchmove,!0),document.addEventListener("touchend",this._handleUp,!0),this._maxWidth=t||window.innerWidth,this._maxHeight=r||window.innerHeight,this._running=!0}},{key:"_getCurrFocusRowArea",value:function(){return this._operateData.currRow>=0&&this._operateData.currRow<Number.MAX_SAFE_INTEGER?this._operateData.currRow<=this._areaData.row.frozen.to?this._areaData.row.frozen:this._areaData.row.flow:null}},{key:"_getCurrFocusColArea",value:function(){return this._operateData.currCol>=0&&this._operateData.currCol<Number.MAX_SAFE_INTEGER?this._operateData.currCol<=this._areaData.col.frozen.to?this._areaData.col.frozen:this._areaData.col.flow:null}},{key:"_calc",value:function(){var e=this._calcX(),t=this._calcY();return!!(Number(e)|Number(t))}},{key:"_calcX",value:function(){var e=!1;return this._currDirection&n.RIGHT&&(this._operateData.currCol===Number.MAX_SAFE_INTEGER||this._maxWidth>0&&this._operateData.displayCurrX>this._maxWidth)?e=this._calcRight():this._currDirection&n.LEFT&&(e=this._calcLeft()),e}},{key:"_calcY",value:function(){var e=!1;return this._currDirection&n.BOTTOM&&(this._operateData.currRow===Number.MAX_SAFE_INTEGER||this._maxHeight>0&&this._operateData.displayCurrY>this._maxHeight)?e=this._calcBottom():this._currDirection&n.TOP&&(e=this._calcTop()),e}},{key:"_calcRight",value:function(){return this._diff.x=s.g>>1,!0}},{key:"_calcLeft",value:function(){if(this._startFocusColArea===this._areaData.col.flow){if(this._operateData.currCol<this._areaData.col.flow.from)return this._diff.x=-(s.g>>1),!0}else if(this._startFocusColArea===this._areaData.col.frozen){var e=this._getCurrFocusColArea();if(null!==this._currFocusColArea&&null!==e&&this._currFocusColArea!==e)return this._diff.x=-this._areaData.col.flow.offsetSize,this._currFocusColArea=e,!0}return!1}},{key:"_calcBottom",value:function(){return this._diff.y=s.r,!0}},{key:"_calcTop",value:function(){if(this._startFocusRowArea===this._areaData.row.flow){if(this._operateData.currRow<this._areaData.row.flow.from)return this._diff.y=-s.r,!0}else if(this._startFocusRowArea===this._areaData.row.frozen){var e=this._getCurrFocusRowArea();if(null!==this._currFocusRowArea&&null!==e&&this._currFocusRowArea!==e)return this._diff.y=-this._areaData.row.flow.offsetSize,this._currFocusRowArea=e,!0}return!1}},{key:"running",get:function(){return this._running}}]),e}();l.EVENT={AUTO_SCROLL:"autoScroll"},t.b=l},"./src/core/view/level-1/board/main/BlockBoard.less":function(e,t,r){var n=r("../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/board/main/BlockBoard.less");"string"===typeof n&&(n=[[e.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r("../node_modules/style-loader/lib/addStyles.js")(n,a);n.locals&&(e.exports=n.locals)},"./src/core/view/level-1/board/main/LineBoard.less":function(e,t,r){var n=r("../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/board/main/LineBoard.less");"string"===typeof n&&(n=[[e.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r("../node_modules/style-loader/lib/addStyles.js")(n,a);n.locals&&(e.exports=n.locals)},"./src/core/view/level-1/board/main/MainBoard.less":function(e,t,r){var n=r("../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/board/main/MainBoard.less");"string"===typeof n&&(n=[[e.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r("../node_modules/style-loader/lib/addStyles.js")(n,a);n.locals&&(e.exports=n.locals)},"./src/core/view/level-1/board/main/feature-board/FeatureBoard.less":function(e,t,r){var n=r("../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/board/main/feature-board/FeatureBoard.less");"string"===typeof n&&(n=[[e.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r("../node_modules/style-loader/lib/addStyles.js")(n,a);n.locals&&(e.exports=n.locals)},"./src/core/view/level-1/board/main/feature-board/HiddenBoard.less":function(e,t,r){var n=r("../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/board/main/feature-board/HiddenBoard.less");"string"===typeof n&&(n=[[e.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r("../node_modules/style-loader/lib/addStyles.js")(n,a);n.locals&&(e.exports=n.locals)},"./src/core/view/level-1/board/main/feature-board/WrapBoard.less":function(e,t,r){var n=r("../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/board/main/feature-board/WrapBoard.less");"string"===typeof n&&(n=[[e.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r("../node_modules/style-loader/lib/addStyles.js")(n,a);n.locals&&(e.exports=n.locals)},"./src/core/view/level-1/drag-operate/index.tsx":function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("./src/base/index.ts"),i=function(){function e(){Object(n.a)(this,e),this.bind()}return Object(a.a)(e,[{key:"bind",value:function(){document.addEventListener("dragenter",this.handleDragEnter.bind(this)),document.addEventListener("dragleave",this.handleDragLeave.bind(this)),document.addEventListener("dragover",this.handleDragOver.bind(this)),document.addEventListener("drop",this.handleDragDrop.bind(this))}},{key:"handleDragEnter",value:function(t){t.preventDefault(),o.a.event.dragCenterEvent.trigger(e.EVENT.DRAG_ENTER,t)}},{key:"handleDragLeave",value:function(t){o.a.event.dragCenterEvent.trigger(e.EVENT.DRAG_LEAVE,t),t.preventDefault()}},{key:"handleDragOver",value:function(t){t.preventDefault(),o.a.event.dragCenterEvent.trigger(e.EVENT.DRAG_OVER,t)}},{key:"handleDragDrop",value:function(t){t.preventDefault(),o.a.event.dragCenterEvent.trigger(e.EVENT.DROP,t)}},{key:"unbind",value:function(){document.removeEventListener("dragenter",this.handleDragEnter.bind(this)),document.removeEventListener("dragleave",this.handleDragLeave.bind(this)),document.removeEventListener("dragover",this.handleDragOver.bind(this)),document.removeEventListener("drop",this.handleDragDrop.bind(this))}}]),e}();i.EVENT={DRAG_ENTER:"dragenter",DRAG_LEAVE:"dragleave",DRAG_OVER:"dragover",DROP:"drop"}},"./src/core/view/level-1/freeze-line/FreezeLine.less":function(e,t,r){var n=r("../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/freeze-line/FreezeLine.less");"string"===typeof n&&(n=[[e.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r("../node_modules/style-loader/lib/addStyles.js")(n,a);n.locals&&(e.exports=n.locals)},"./src/core/view/level-1/input-manager/InputVariables.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return a}));var n,a,o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),i=r("../node_modules/@babel/runtime/helpers/esm/createClass.js");!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.QUICK_INPUT=1]="QUICK_INPUT",e[e.STABLE_INPUT=2]="STABLE_INPUT",e[e.TOOLBAR_INPUT=3]="TOOLBAR_INPUT"}(n||(n={})),function(e){e[e.TEXT=0]="TEXT",e[e.FORMULA=1]="FORMULA"}(a||(a={}));var s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.DEFAULT,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.TEXT;Object(o.a)(this,e),this.status=n.DEFAULT,this.status=t,this.type=r}return Object(i.a)(e,[{key:"switchStatus",value:function(e){this.status=e}},{key:"switchType",value:function(e){this.type=e}}]),e}();t.c=s},"./src/core/view/level-1/input-manager/formula-input-stage/FormulaBar.less":function(e,t,r){var n=r("../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/input-manager/formula-input-stage/FormulaBar.less");"string"===typeof n&&(n=[[e.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r("../node_modules/style-loader/lib/addStyles.js")(n,a);n.locals&&(e.exports=n.locals)},"./src/core/view/level-1/input-manager/formula-input-stage/components/bar-dragger/BarDragger.less":function(e,t,r){var n=r("../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/input-manager/formula-input-stage/components/bar-dragger/BarDragger.less");"string"===typeof n&&(n=[[e.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r("../node_modules/style-loader/lib/addStyles.js")(n,a);n.locals&&(e.exports=n.locals)},"./src/core/view/level-1/input-manager/formula-input-stage/components/bar-label/BarLabel.less":function(e,t,r){var n=r("../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/input-manager/formula-input-stage/components/bar-label/BarLabel.less");"string"===typeof n&&(n=[[e.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r("../node_modules/style-loader/lib/addStyles.js")(n,a);n.locals&&(e.exports=n.locals)},"./src/core/view/level-1/input-manager/formula-input-stage/components/formula-input/FormulaInput.less":function(e,t,r){var n=r("../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/input-manager/formula-input-stage/components/formula-input/FormulaInput.less");"string"===typeof n&&(n=[[e.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r("../node_modules/style-loader/lib/addStyles.js")(n,a);n.locals&&(e.exports=n.locals)},"./src/core/view/level-1/input-manager/table-input-stage/InputStage.less":function(e,t,r){var n=r("../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/input-manager/table-input-stage/InputStage.less");"string"===typeof n&&(n=[[e.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r("../node_modules/style-loader/lib/addStyles.js")(n,a);n.locals&&(e.exports=n.locals)},"./src/core/view/level-1/input-manager/table-input-stage/components/table-input/BaseTableInput.less":function(e,t,r){var n=r("../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/input-manager/table-input-stage/components/table-input/BaseTableInput.less");"string"===typeof n&&(n=[[e.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r("../node_modules/style-loader/lib/addStyles.js")(n,a);n.locals&&(e.exports=n.locals)},"./src/core/view/level-1/input-manager/table-input-stage/components/tooltip-card/TooltipCard.less":function(e,t,r){var n=r("../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/input-manager/table-input-stage/components/tooltip-card/TooltipCard.less");"string"===typeof n&&(n=[[e.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r("../node_modules/style-loader/lib/addStyles.js")(n,a);n.locals&&(e.exports=n.locals)},"./src/core/view/level-1/operate-context/BaseOperate.ts":function(e,t,r){"use strict";var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../packages/lib/EventEmitter.ts");t.a=function e(){Object(n.a)(this,e),this.emitter=new a.a}},"./src/core/view/level-1/operate-context/mouse/MouseOperate.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),i=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),s=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js");function l(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var c=function(e){Object(o.a)(r,e);var t=l(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this))._handleMousedown=function(e){a.emitter.emit(r.EVENT.DOWN,a._operateData)},a._handleMousemove=function(e){a.emitter.emit(r.EVENT.MOVE,a._operateData)},a._handleMouseup=function(e){a.emitter.emit(r.EVENT.UP,a._operateData)},a._handleContextmenu=function(e){e.preventDefault(),a.emitter.emit(r.EVENT.CONTEXT_MENU,a._operateData)},a._handleDblclick=function(e){e.preventDefault(),a.emitter.emit(r.EVENT.DBLCLICK,a._operateData)},a.handleClick=function(e){a.emitter.emit(r.EVENT.CLICK,a._operateData)},a._board=e.board,a._operateData=e.operateData,a.bind(),a}return Object(a.a)(r,[{key:"bind",value:function(){this._board.addEventListener("mousedown",this._handleMousedown),document.addEventListener("mousemove",this._handleMousemove),document.addEventListener("mouseup",this._handleMouseup),this._board.addEventListener("contextmenu",this._handleContextmenu),this._board.addEventListener("dblclick",this._handleDblclick),this._board.addEventListener("click",this.handleClick)}},{key:"unbind",value:function(){this._board.removeEventListener("mousedown",this._handleMousedown),document.removeEventListener("mousemove",this._handleMousemove),document.removeEventListener("mouseup",this._handleMouseup),this._board.removeEventListener("contextmenu",this._handleContextmenu),this._board.removeEventListener("dblclick",this._handleDblclick),this._board.removeEventListener("click",this.handleClick)}},{key:"EVENT",get:function(){return r.EVENT}},{key:"board",get:function(){return this._board}}]),r}(r("./src/core/view/level-1/operate-context/BaseOperate.ts").a);c.EVENT={DOWN:"down",MOVE:"move",UP:"up",CONTEXT_MENU:"contextMenu",DBLCLICK:"dblclick",CLICK:"click"},t.a=c},"./src/core/view/level-1/operate-context/operate-board/OperateBoard.less":function(e,t,r){var n=r("../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/operate-context/operate-board/OperateBoard.less");"string"===typeof n&&(n=[[e.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r("../node_modules/style-loader/lib/addStyles.js")(n,a);n.locals&&(e.exports=n.locals)},"./src/core/view/level-1/operate-context/touch/TouchOperate.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),i=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),s=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),l=r("./src/core/view/level-1/operate-context/BaseOperate.ts"),c=r("./src/core/view/lib/tap-support.ts"),u=r("./src/core/view/utils/base-func.ts"),d=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),h=r.n(d);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var p=function(e){Object(o.a)(r,e);var t=f(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this))._handleTouchstart=function(e){e.preventDefault(),a.emitter.emit(r.EVENT.DOWN,a._operateData)},a._handleTouchmove=function(e){a.emitter.emit(r.EVENT.MOVE,a._operateData)},a._handleTouchend=function(e){a.emitter.emit(r.EVENT.UP,a._operateData)},a._handleTap=function(){a.emitter.emit(r.EVENT.TAP,a._operateData),!h.a.isIPad||a._operateData.preventAutoTapFocus||a._board.contains(document.activeElement)||a._board.focus()},a._handleLongTap=function(){a.emitter.emit(r.EVENT.LONG_TAP,a._operateData)},a._board=e.board,a._operateData=e.operateData,a._board.addEventListener("contextmenu",u.c),Object(c.a)(a._board),a.bind(),a}return Object(a.a)(r,[{key:"bindForTap",value:function(){this._board.addEventListener("tap",this._handleTap),this._board.addEventListener("longTap",this._handleLongTap)}},{key:"unbindForTap",value:function(){this._board.removeEventListener("tap",this._handleTap),this._board.removeEventListener("longTap",this._handleLongTap)}},{key:"bind",value:function(){this._board.addEventListener("touchstart",this._handleTouchstart),this.bindForTap(),document.addEventListener("touchmove",this._handleTouchmove,!1),document.addEventListener("touchend",this._handleTouchend,!1)}},{key:"unbind",value:function(){this._board.removeEventListener("touchstart",this._handleTouchstart),this.unbindForTap(),document.removeEventListener("touchmove",this._handleTouchmove,!1),document.removeEventListener("touchend",this._handleTouchend,!1)}},{key:"EVENT",get:function(){return r.EVENT}},{key:"board",get:function(){return this._board}}]),r}(l.a);p.EVENT={DOWN:"down",TAP:"tap",MOVE:"move",UP:"up",LONG_TAP:"longTap"},t.a=p},"./src/core/view/level-1/select-data/BaseSelectData.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.splice.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("../packages/lib/EventEmitter.ts"),i=r("./src/core/view/level-1/select-data/selection/AllSelection.ts"),s=r("./src/core/view/level-1/select-data/selection/RowSelection.ts"),l=r("./src/core/view/level-1/select-data/selection/ColSelection.ts"),c=r("./src/core/view/level-1/select-data/selection/CellSelection.ts"),u=r("./src/core/view/level-1/select-data/utils.ts"),d=r("./src/core/view/level-1/select-data/activation/Activation.ts"),h=r("./src/core/view/level-1/select-data/selection/EmptySelection.ts"),f=function(){function e(t){Object(n.a)(this,e),this._selectQueue=[],this.emitter=new o.a,this._tableView=t.tableView,this._rowcolAccessor=t.rowcolAccessor}return Object(a.a)(e,[{key:"isValid",value:function(){return!!this._selectQueue.length}},{key:"_clearSelection",value:function(e){if(e.activation&&(e.activation.row=-1,e.activation.col=-1),e instanceof i.a)i.a.destroy(e);else if(e instanceof s.a)s.a.destroy(e);else if(e instanceof l.a)l.a.destroy(e);else if(e instanceof c.a)c.a.destroy(e);else{if(!(e instanceof h.a))throw new Error("unknown selection type");h.a.destroy(e)}}},{key:"_addSelection",value:function(e,t){var r=this._newSelection(e,t);return this._selectQueue.push(r),r}},{key:"_updateSelection",value:function(e,t,r){var n=this._selectQueue[e];if(void 0===n)throw new Error("index error when change selectData");var a=this._newSelection(t,r);this._selectQueue[e]=a,this._clearSelection(n)}},{key:"_removeSelection",value:function(e){var t=this._selectQueue.splice(e,1)[0];if(void 0===t)throw new Error("index error when remove selectData");this._clearSelection(t)}},{key:"_resetSelection",value:function(){for(var e;e=this._selectQueue.shift();)this._clearSelection(e)}},{key:"_newSelection",value:function(e,t){var r;if(e.xRange&&e.yRange?(Object(u.d)(this._tableView,e.yRange,e.xRange,u.a.EXTEND),r=c.a.newInstance(e.yRange[0],e.yRange[1],e.xRange[0],e.xRange[1])):r=e.xRange?l.a.newInstance(e.xRange[0],e.xRange[1]):e.yRange?s.a.newInstance(e.yRange[0],e.yRange[1]):i.a.newInstance(),Object(u.c)(r,this._tableView,this._rowcolAccessor,t),null===this._tableView.getCellViewAtPosition(t.row,t.col))throw new Error("getCellViewAtPosition error!");return r.activation=new d.a(t.row,t.col),r}},{key:"select",get:function(){return this._selectQueue[this._selectQueue.length-1]||null}},{key:"selectQueue",get:function(){return this._selectQueue}},{key:"currentSelectIndex",get:function(){return this._selectQueue.length-1}},{key:"EVENT",get:function(){return e.EVENT}}]),e}();f.EVENT={ADD_SELECTION:"addSelection",UPDATE_SELECTION:"updateSelection",RESET_SELECTION:"resetSelection",REMOVE_SELECTION:"removeSelection"},t.a=f},"./src/core/view/level-1/select-data/NormalSelectData.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js");var n=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=r("../node_modules/@babel/runtime/helpers/esm/get.js"),s=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),l=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),c=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),u=r("./src/core/view/level-1/select-data/BaseSelectData.ts"),d=r("./src/core/view/level-1/select-data/activation/Activation.ts"),h=r("./src/core/view/level-1/select-data/utils.ts"),f=r("./src/core/view/utils/base-func.ts"),p=r("./src/core/view/level-1/select-data/selection/AllSelection.ts"),_=r("./src/core/view/level-1/select-data/selection/RowSelection.ts"),m=r("./src/core/view/level-1/select-data/selection/CellSelection.ts"),v=r("./src/core/view/level-1/select-data/selection/ColSelection.ts"),g=r("../node_modules/@tencent/docs-user-agent/dist/index.js");function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function w(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(l.a)(this,r)}}var R=r.n(g).a.isMobile?0:1.5,E=function(e){Object(s.a)(r,e);var t=w(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e))._modifySelection=Object(f.d)((function(){n.emitter.emit(r.EVENT.MODIFY_SELECTION)})),n._getColSelectStatus=function(e){for(var t,r,a=e.index,o=n._selectQueue,i=(o.length>1?.5:R)/n._scale.scale,s=0;s<o.length;s++){if((t=o[s])instanceof p.a)return e.selected(),void e.expandFitLine(i);if(t instanceof _.a)e.actived(),e.expandFitLine(i);else if(t instanceof m.a)Object(f.b)(a,t.xRange)&&(e.actived(),r=n._areaData.getFirstRowInView(),t.yRange[0]<=r&&t.yRange[1]>=r&&e.expandFitLine(i));else if(t instanceof v.a&&Object(f.b)(a,t.xRange))return e.selected(),void e.expandFitLine(i)}},n._getRowSelectStatus=function(e){for(var t,r,a=e.index,o=n._selectQueue,i=(o.length>1?.5:R)/n._scale.scale,s=0;s<o.length;s++){if((t=o[s])instanceof p.a)return e.selected(),void e.expandFitLine(i);if(t instanceof v.a)e.actived(),e.expandFitLine(i);else if(t instanceof m.a)Object(f.b)(a,t.yRange)&&(e.actived(),r=n._areaData.getFirstColInView(),t.xRange[0]<=r&&t.xRange[1]>=r&&e.expandFitLine(i));else if(t instanceof _.a&&Object(f.b)(a,t.yRange))return e.selected(),void e.expandFitLine(i)}},n._transformTable=e.transformTable,n._areaData=e.areaData,n._scale=e.scale,n._transformTable.onCalcColHeadStatus(n._getColSelectStatus),n._transformTable.onCalcRowHeadStatus(n._getRowSelectStatus),n}return Object(o.a)(r,[{key:"isSingle",value:function(){return 1===this._selectQueue.length}},{key:"addSelection",value:function(e){var t=this.select;t&&(t.activation=new d.a(-1,-1),this.emitter.emit(r.EVENT.UPDATE_SELECTION,{index:this.currentSelectIndex,selection:t})),e.activation||(e.activation={row:e.yRange?e.yRange[0]:0,col:e.xRange?e.xRange[0]:0});var n=Object(i.a)(Object(c.a)(r.prototype),"_addSelection",this).call(this,e,e.activation);this.emitter.emit(r.EVENT.ADD_SELECTION,n),this._modifySelection()}},{key:"updateSelection",value:function(e,t){var n=this._selectQueue[e];if(!n)throw new Error("\u9519\u8bef\u66f4\u65b0\u9009\u533a");if(!t.activation){if(t.activation={row:n.activation.row,col:n.activation.col},t.xRange&&(t.activation.col<t.xRange[0]||t.activation.col>t.xRange[1]))throw new Error("\u672a\u4f20\u5165\u6fc0\u6d3b\u533a\u57df\uff0c\u5e76\u4e14\u65e0\u6cd5\u590d\u7528\u4e4b\u524d\u7684\u6fc0\u6d3b\u533a\u57df");if(t.yRange&&(t.activation.row<t.yRange[0]||t.activation.row>t.yRange[1]))throw new Error("\u672a\u4f20\u5165\u6fc0\u6d3b\u533a\u57df\uff0c\u5e76\u4e14\u65e0\u6cd5\u590d\u7528\u4e4b\u524d\u7684\u6fc0\u6d3b\u533a\u57df")}Object(i.a)(Object(c.a)(r.prototype),"_updateSelection",this).call(this,e,t,t.activation),this.emitter.emit(r.EVENT.UPDATE_SELECTION,{index:e,selection:this._selectQueue[e]}),this._modifySelection()}},{key:"removeSelection",value:function(e){throw"normalSelectData shouldn't call removeSelection"}},{key:"resetSelection",value:function(){Object(i.a)(Object(c.a)(r.prototype),"_resetSelection",this).call(this),this.emitter.emit(r.EVENT.RESET_SELECTION),this._modifySelection()}},{key:"activeRow",get:function(){var e=this.activation;return e?Object(h.b)(this._tableView,e.row,e.col).row:-1}},{key:"activeCol",get:function(){var e=this.activation;return e?Object(h.b)(this._tableView,e.row,e.col).col:-1}},{key:"activation",get:function(){return null===this.select?null:this.select.activation}},{key:"EVENT",get:function(){return r.EVENT}}]),r}(u.a);E.EVENT=y(y({},u.a.EVENT),{},{MODIFY_SELECTION:"modifySelection"}),t.a=E},"./src/core/view/level-1/select-data/activation/Activation.ts":function(e,t,r){"use strict";var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js");t.a=function e(t,r){Object(n.a)(this,e),this.row=-1,this.col=-1,this.row=t,this.col=r}},"./src/core/view/level-1/select-data/selection/AllSelection.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),i=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),s=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js");function l(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var c=function(e){Object(o.a)(r,e);var t=l(r);function r(){var e;return Object(n.a)(this,r),(e=t.call(this))._selectAll=!0,e._using=!1,e._using=!0,e}return Object(a.a)(r,[{key:"selectAll",get:function(){return this._selectAll}}],[{key:"newInstance",value:function(){var e=r.pools.pop();return e?(e._using=!0,e):new r}},{key:"destroy",value:function(e){e._using=!1,r.pools.push(e)}}]),r}(r("./src/core/view/level-1/select-data/selection/BaseSelection.ts").a);c.pools=[],t.a=c},"./src/core/view/level-1/select-data/selection/BaseSelection.ts":function(e,t,r){"use strict";var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=function(){function e(){Object(n.a)(this,e),this._selectRow=!1,this._selectCol=!1,this._selectCell=!1,this._selectAll=!1}return Object(a.a)(e,[{key:"selectRow",get:function(){return this._selectRow}},{key:"selectCol",get:function(){return this._selectCol}},{key:"selectCell",get:function(){return this._selectCell}},{key:"selectAll",get:function(){return this._selectAll}}]),e}();t.a=o},"./src/core/view/level-1/select-data/selection/CellSelection.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.array-buffer.slice.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.typed-array.uint32-array.js"),r("../node_modules/core-js/modules/es.typed-array.copy-within.js"),r("../node_modules/core-js/modules/es.typed-array.every.js"),r("../node_modules/core-js/modules/es.typed-array.fill.js"),r("../node_modules/core-js/modules/es.typed-array.filter.js"),r("../node_modules/core-js/modules/es.typed-array.find.js"),r("../node_modules/core-js/modules/es.typed-array.find-index.js"),r("../node_modules/core-js/modules/es.typed-array.for-each.js"),r("../node_modules/core-js/modules/es.typed-array.includes.js"),r("../node_modules/core-js/modules/es.typed-array.index-of.js"),r("../node_modules/core-js/modules/es.typed-array.iterator.js"),r("../node_modules/core-js/modules/es.typed-array.join.js"),r("../node_modules/core-js/modules/es.typed-array.last-index-of.js"),r("../node_modules/core-js/modules/es.typed-array.map.js"),r("../node_modules/core-js/modules/es.typed-array.reduce.js"),r("../node_modules/core-js/modules/es.typed-array.reduce-right.js"),r("../node_modules/core-js/modules/es.typed-array.reverse.js"),r("../node_modules/core-js/modules/es.typed-array.set.js"),r("../node_modules/core-js/modules/es.typed-array.slice.js"),r("../node_modules/core-js/modules/es.typed-array.some.js"),r("../node_modules/core-js/modules/es.typed-array.sort.js"),r("../node_modules/core-js/modules/es.typed-array.subarray.js"),r("../node_modules/core-js/modules/es.typed-array.to-locale-string.js"),r("../node_modules/core-js/modules/es.typed-array.to-string.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),i=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),s=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js");function l(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var c=function(e){Object(o.a)(r,e);var t=l(r);function r(e,a,o,i){var s;return Object(n.a)(this,r),(s=t.call(this)).xRange=new Uint32Array(2),s.yRange=new Uint32Array(2),s._selectCell=!0,s._using=!1,s._true=!0,s._using=!0,s.yRange[0]=e,s.yRange[1]=a,s.xRange[0]=o,s.xRange[1]=i,s}return Object(a.a)(r,[{key:"selectCell",get:function(){return this._selectCell}}],[{key:"newInstance",value:function(e,t,n,a){var o=r.pools.pop();return o?(o._using=!0,o.yRange[0]=e,o.yRange[1]=t,o.xRange[0]=n,o.xRange[1]=a,o):new r(e,t,n,a)}},{key:"destroy",value:function(e){e._using=!1,e.xRange[0]=0,e.xRange[1]=0,e.yRange[0]=0,e.yRange[1]=0,r.pools.push(e)}}]),r}(r("./src/core/view/level-1/select-data/selection/BaseSelection.ts").a);c.pools=[],t.a=c},"./src/core/view/level-1/select-data/selection/ColSelection.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.array-buffer.slice.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.typed-array.uint32-array.js"),r("../node_modules/core-js/modules/es.typed-array.copy-within.js"),r("../node_modules/core-js/modules/es.typed-array.every.js"),r("../node_modules/core-js/modules/es.typed-array.fill.js"),r("../node_modules/core-js/modules/es.typed-array.filter.js"),r("../node_modules/core-js/modules/es.typed-array.find.js"),r("../node_modules/core-js/modules/es.typed-array.find-index.js"),r("../node_modules/core-js/modules/es.typed-array.for-each.js"),r("../node_modules/core-js/modules/es.typed-array.includes.js"),r("../node_modules/core-js/modules/es.typed-array.index-of.js"),r("../node_modules/core-js/modules/es.typed-array.iterator.js"),r("../node_modules/core-js/modules/es.typed-array.join.js"),r("../node_modules/core-js/modules/es.typed-array.last-index-of.js"),r("../node_modules/core-js/modules/es.typed-array.map.js"),r("../node_modules/core-js/modules/es.typed-array.reduce.js"),r("../node_modules/core-js/modules/es.typed-array.reduce-right.js"),r("../node_modules/core-js/modules/es.typed-array.reverse.js"),r("../node_modules/core-js/modules/es.typed-array.set.js"),r("../node_modules/core-js/modules/es.typed-array.slice.js"),r("../node_modules/core-js/modules/es.typed-array.some.js"),r("../node_modules/core-js/modules/es.typed-array.sort.js"),r("../node_modules/core-js/modules/es.typed-array.subarray.js"),r("../node_modules/core-js/modules/es.typed-array.to-locale-string.js"),r("../node_modules/core-js/modules/es.typed-array.to-string.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),i=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),s=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js");function l(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var c=function(e){Object(o.a)(r,e);var t=l(r);function r(e,a){var o;return Object(n.a)(this,r),(o=t.call(this)).xRange=new Uint32Array(2),o._selectCol=!0,o._using=!1,o._using=!0,o.xRange[0]=e,o.xRange[1]=a,o}return Object(a.a)(r,[{key:"selectCol",get:function(){return this._selectCol}}],[{key:"newInstance",value:function(e,t){var n=r.pools.pop();return n?(n._using=!0,n.xRange[0]=e,n.xRange[1]=t,n):new r(e,t)}},{key:"destroy",value:function(e){e._using=!1,e.xRange[0]=0,e.xRange[1]=0,r.pools.push(e)}}]),r}(r("./src/core/view/level-1/select-data/selection/BaseSelection.ts").a);c.pools=[],t.a=c},"./src/core/view/level-1/select-data/selection/EmptySelection.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),i=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),s=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js");function l(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var c=function(e){Object(o.a)(r,e);var t=l(r);function r(){var e;return Object(n.a)(this,r),(e=t.call(this))._using=!1,e._using=!0,e}return Object(a.a)(r,null,[{key:"newInstance",value:function(){var e=r.pools.pop();return e?(e._using=!0,e):new r}},{key:"destroy",value:function(e){e._using=!1,r.pools.push(e)}}]),r}(r("./src/core/view/level-1/select-data/selection/BaseSelection.ts").a);c.pools=[],t.a=c},"./src/core/view/level-1/select-data/selection/RowSelection.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.array-buffer.slice.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.typed-array.uint32-array.js"),r("../node_modules/core-js/modules/es.typed-array.copy-within.js"),r("../node_modules/core-js/modules/es.typed-array.every.js"),r("../node_modules/core-js/modules/es.typed-array.fill.js"),r("../node_modules/core-js/modules/es.typed-array.filter.js"),r("../node_modules/core-js/modules/es.typed-array.find.js"),r("../node_modules/core-js/modules/es.typed-array.find-index.js"),r("../node_modules/core-js/modules/es.typed-array.for-each.js"),r("../node_modules/core-js/modules/es.typed-array.includes.js"),r("../node_modules/core-js/modules/es.typed-array.index-of.js"),r("../node_modules/core-js/modules/es.typed-array.iterator.js"),r("../node_modules/core-js/modules/es.typed-array.join.js"),r("../node_modules/core-js/modules/es.typed-array.last-index-of.js"),r("../node_modules/core-js/modules/es.typed-array.map.js"),r("../node_modules/core-js/modules/es.typed-array.reduce.js"),r("../node_modules/core-js/modules/es.typed-array.reduce-right.js"),r("../node_modules/core-js/modules/es.typed-array.reverse.js"),r("../node_modules/core-js/modules/es.typed-array.set.js"),r("../node_modules/core-js/modules/es.typed-array.slice.js"),r("../node_modules/core-js/modules/es.typed-array.some.js"),r("../node_modules/core-js/modules/es.typed-array.sort.js"),r("../node_modules/core-js/modules/es.typed-array.subarray.js"),r("../node_modules/core-js/modules/es.typed-array.to-locale-string.js"),r("../node_modules/core-js/modules/es.typed-array.to-string.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),i=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),s=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js");function l(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var c=function(e){Object(o.a)(r,e);var t=l(r);function r(e,a){var o;return Object(n.a)(this,r),(o=t.call(this)).yRange=new Uint32Array(2),o._selectRow=!0,o._using=!1,o._using=!0,o.yRange[0]=e,o.yRange[1]=a,o}return Object(a.a)(r,[{key:"selectRow",get:function(){return this._selectRow}}],[{key:"newInstance",value:function(e,t){var n=r.pools.pop();return n?(n._using=!0,n.yRange[0]=e,n.yRange[1]=t,n):new r(e,t)}},{key:"destroy",value:function(e){e._using=!1,e.yRange[0]=0,e.yRange[1]=0,r.pools.push(e)}}]),r}(r("./src/core/view/level-1/select-data/selection/BaseSelection.ts").a);c.pools=[],t.a=c},"./src/core/view/level-1/select-data/utils.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"d",(function(){return h})),r.d(t,"c",(function(){return f})),r.d(t,"b",(function(){return p})),r.d(t,"f",(function(){return _})),r.d(t,"e",(function(){return m})),r.d(t,"g",(function(){return v})),r.d(t,"h",(function(){return g})),r.d(t,"p",(function(){return b})),r.d(t,"n",(function(){return y})),r.d(t,"m",(function(){return w})),r.d(t,"o",(function(){return R})),r.d(t,"i",(function(){return E})),r.d(t,"j",(function(){return C})),r.d(t,"k",(function(){return j})),r.d(t,"l",(function(){return O})),r.d(t,"q",(function(){return S}));r("../node_modules/core-js/modules/es.array.concat.js");var n,a=r("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),o=r("./src/core/view/utils/lambda.ts"),i=r("./src/core/view/level-1/select-data/selection/AllSelection.ts"),s=r("./src/core/view/level-1/select-data/selection/ColSelection.ts"),l=r("./src/core/view/level-1/select-data/selection/CellSelection.ts"),c=r("./src/core/view/level-1/select-data/selection/RowSelection.ts"),u=r("../packages/model/src/range/index.ts"),d=r("../packages/model/src/range/GridRange.ts");function h(e,t,r){var a,o,i,s,l,c,u,d,h,f,p,_,m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.EXTEND;for(i=r[0],l=r[1],s=t[0],c=t[1],a=s;a<=c;a++){for(h=!1,u=a===s||a===c?1:Math.max(l-i,1),o=i;o<=l;o+=u){if(null===(d=e.getCellViewAtPosition(a,o)))throw"getCellViewAtPosition error!, y: ".concat(a,", x: ").concat(o);if(d.mergeParent||d.mergeData){if(d.mergeParent?(f=o+d.mergeParent.x,p=a+d.mergeParent.y,_=e.getCellViewAtPosition(p,f)):(f=o,p=a,_=d),null===_)throw"getCellViewAtPosition error!, y: ".concat(p,", x: ").concat(f);if(m===n.DISCARD){if(_.mergeData.colCount+f-1>l){if((l=f-1)<i)return!1;h=!0;break}if(_.mergeData.rowCount+p-1>c){if((c=p-1)<s)return!1;h=!0;break}if(f<i){if((i=_.mergeData.colCount+f)>l)return!1;h=!0;break}if(p<s){if((s=_.mergeData.rowCount+p)>c)return!1;h=!0;break}}else if(_.mergeData.rowCount+p>c+1&&(c=_.mergeData.rowCount+p-1),p<s&&(a=s=p,h=!0),_.mergeData.colCount+f>l+1&&(l=_.mergeData.colCount+f-1,h=!0),f<i&&(i=f,h=!0),h)break}}h&&(a=s-1)}return r[0]=i,r[1]=l,t[0]=s,t[1]=c,!0}function f(e,t,r,n){if(e instanceof c.a)!function(e,t,r){var n=_(e,r.row,r.col,t.getColCount()-1,(function(e,r,n){return Object(o.h)(e,r,n)&&Object(o.e)(t,r,n)}));null===n&&(n=0);r.col=n}(t,r,n);else if(e instanceof s.a)!function(e,t,r){var n=v(e,r.row,r.col,t.getRowCount()-1,(function(e,r,n){return Object(o.a)(e,r,n)&&Object(o.e)(t,r,n)}));null===n&&(n=0);r.row=n}(t,r,n);else{if(!(e instanceof i.a||e instanceof l.a))throw new Error("\u5f02\u5e38\u7684\u9009\u533a\u7c7b\u578b");!function(e,t){var r=_(e,t.row,t.col,e.getColCount()-1,o.d),n=v(e,t.row,t.col,e.getRowCount()-1,o.f);null===r&&(r=0);null===n&&(n=0);t.row=n,t.col=r}(r,n)}}function p(e,t,r){var n=e.getCellViewAtPosition(t,r);return null===n?(console.warn("\u6709\u6a21\u5757\u5f02\u5e38\u8c03\u7528 activeCol/activeRow"),{row:-1,col:-1}):n.mergeParent?{col:r+n.mergeParent.x,row:t+n.mergeParent.y}:{row:t,col:r}}function _(e,t,r,n,a){for(;r<=n;){if(a(e,r,t))return r;r+=1}return null}function m(e,t,r,n,a){for(;r>=n;){if(a(e,r,t))return r;r-=1}return null}function v(e,t,r,n,a){for(;t<=n;){if(a(e,r,t))return t;t+=1}return null}function g(e,t,r,n,a){for(;t>=n;){if(a(e,r,t))return t;t-=1}return null}function b(e,t){for(var r=[],n=0;n<t.length;n++){var a=t[n];a.selectAll||a.selectCol?r.push([0,e.getRowCount()-1]):(a.selectRow||a.selectCell)&&r.push([a.yRange[0],a.yRange[1]])}return r}function y(e,t){for(var r=[],n=0;n<t.length;n++){var a=t[n];a.selectAll||a.selectRow?r.push([0,e.getColCount()-1]):(a.selectCol||a.selectCell)&&r.push([a.xRange[0],a.xRange[1]])}return r}function w(e,t){for(var r=[],n=0;n<t.length;n++){var a=t[n];a.selectAll?r.push({xRange:[0,e.getColCount()-1],yRange:[0,e.getRowCount()-1]}):a.selectCol?r.push({xRange:[a.xRange[0],a.xRange[1]],yRange:[0,e.getRowCount()-1]}):a.selectRow?r.push({xRange:[0,e.getColCount()-1],yRange:[a.yRange[0],a.yRange[1]]}):a.selectCell&&r.push({xRange:[a.xRange[0],a.xRange[1]],yRange:[a.yRange[0],a.yRange[1]]})}return r}function R(e,t,r){for(var n=[],a=t.getRowCount()-1,o=t.getColCount()-1,i=0;i<r.length;i++){var s=r[i],l=void 0;if(s.selectAll)l=new u.GridRange(e,0,a,0,o);else if(s.selectRow)l=new u.GridRange(e,s.yRange[0],s.yRange[1],0,o);else if(s.selectCol)l=new u.GridRange(e,0,a,s.xRange[0],s.xRange[1]);else{if(!s.selectCell)throw new Error("\u4e0d\u53ef\u7528\u7684\u9009\u533a\u7c7b\u578b");l=new u.GridRange(e,s.yRange[0],s.yRange[1],s.xRange[0],s.xRange[1])}n.push(l)}return n}function E(e,t,r){for(var n=r.selectQueue,a=0;a<n.length;a++){var o=n[a];if(o.selectAll)return!0;if(o instanceof c.a){if(e>=o.yRange[0]&&e<=o.yRange[1])return!0}else if(o instanceof s.a){if(t>=o.xRange[0]&&t<=o.xRange[1])return!0}else{if(!(o instanceof l.a))throw new Error("\u4e0d\u53ef\u7528\u7684\u9009\u533a\u7c7b\u578b");if(e>=o.yRange[0]&&e<=o.yRange[1]&&t>=o.xRange[0]&&t<=o.xRange[1])return!0}}return!1}function C(e,t){for(var r=t.selectQueue,n=0;n<r.length;n++){var a=r[n];if(a.selectAll)return!0;if(a instanceof s.a&&e>=a.xRange[0]&&e<=a.xRange[1])return!0}return!1}function j(e,t){for(var r=t.selectQueue,n=0;n<r.length;n++){var a=r[n];if(a.selectAll)return!0;if(a instanceof c.a&&e>=a.yRange[0]&&e<=a.yRange[1])return!0}return!1}function O(e,t){if(1!==t.selectQueue.length)return!1;var r=t.select;if(r instanceof l.a){var n=Object(a.a)(r.xRange,2),o=n[0],i=n[1],s=Object(a.a)(r.yRange,2),c=s[0],u=s[1];if(o===i&&c===u)return!0;var d=e.getCellViewAtPosition(c,o);if(null===d||void 0===d?void 0:d.mergeData){var h=d.mergeData;if(h.colCount===i-o+1&&h.rowCount===u-c+1)return!0}}return!1}function S(e,t,r){for(var n=[],a=r.selectQueue,o=0;o<a.length;o++){var i=a[o];i.selectAll?n.push(new u.GridRange(e)):i instanceof s.a?n.push(new u.GridRange(e,d.a,d.a,i.xRange[0],i.xRange[1])):i instanceof c.a?n.push(new u.GridRange(e,i.yRange[0],i.yRange[1],d.a,d.a)):i instanceof l.a&&n.push(new u.GridRange(e,i.yRange[0],i.yRange[1],i.xRange[0],i.xRange[1]))}return n}!function(e){e[e.DISCARD=0]="DISCARD",e[e.EXTEND=1]="EXTEND"}(n||(n={}))},"./src/core/view/level-1/selection-stage/selection-ui/pc/FormulaSelection.less":function(e,t,r){var n=r("../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/selection-stage/selection-ui/pc/FormulaSelection.less");"string"===typeof n&&(n=[[e.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r("../node_modules/style-loader/lib/addStyles.js")(n,a);n.locals&&(e.exports=n.locals)},"./src/core/view/level-1/selection-stage/selection-ui/pc/MultipleSelection.less":function(e,t,r){var n=r("../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/selection-stage/selection-ui/pc/MultipleSelection.less");"string"===typeof n&&(n=[[e.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r("../node_modules/style-loader/lib/addStyles.js")(n,a);n.locals&&(e.exports=n.locals)},"./src/core/view/level-1/selection-stage/selection-ui/pc/SingleSelection.less":function(e,t,r){var n=r("../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/selection-stage/selection-ui/pc/SingleSelection.less");"string"===typeof n&&(n=[[e.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r("../node_modules/style-loader/lib/addStyles.js")(n,a);n.locals&&(e.exports=n.locals)},"./src/core/view/level-1/selection-stage/smart-corner/SmartCorner.less":function(e,t,r){var n=r("../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/selection-stage/smart-corner/SmartCorner.less");"string"===typeof n&&(n=[[e.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r("../node_modules/style-loader/lib/addStyles.js")(n,a);n.locals&&(e.exports=n.locals)},"./src/core/view/level-1/selection-stage/smart-corner/SmartCorner.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.object.assign.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("../packages/lib/EventEmitter.ts"),i=(r("./src/core/view/level-1/selection-stage/smart-corner/SmartCorner.less"),function(){function e(t){var r=this;Object(n.a)(this,e),this._corner=document.createElement("div"),this._valid=!1,this._handleMousedown=function(t){r.emitter.emit(e.EVENT.DOWN,t)},this._handleDoubleClick=function(t){r.emitter.emit(e.EVENT.DOUBLE_CLICK,t)},this.emitter=new o.a,this._corner.classList.add("smart-corner"),t.appendChild(this._corner),this._corner.addEventListener("mousedown",this._handleMousedown),this._corner.addEventListener("dblclick",this._handleDoubleClick)}return Object(a.a)(e,[{key:"setAttribute",value:function(e){Object.assign(this._corner.style,{left:"".concat(e.left+e.width,"px"),top:"".concat(e.top+e.height,"px")})}},{key:"show",value:function(){this._valid&&(this._corner.style.display="block")}},{key:"hide",value:function(){this._corner.style.display="none"}},{key:"setValid",value:function(e){this._valid=e,e?this.show():this.hide()}}]),e}());i.EVENT={DOWN:"down",DOUBLE_CLICK:"dblclick"},t.a=i},"./src/core/view/level-1/shape-stage/image/BaseImage.less":function(e,t,r){var n=r("../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/shape-stage/image/BaseImage.less");"string"===typeof n&&(n=[[e.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r("../node_modules/style-loader/lib/addStyles.js")(n,a);n.locals&&(e.exports=n.locals)},"./src/core/view/level-1/shape-stage/stage/DomShapeStage.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js");var n=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=r("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),s=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),l=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),c=r("../node_modules/@babel/runtime/helpers/esm/get.js"),u=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),d=r("../packages/lib/EventEmitter.ts");var h=function(){function e(){Object(a.a)(this,e),this._shapeMap={},this.emitter=new d.a}return Object(o.a)(e,[{key:"getShapeData",value:function(e){return this._shapeMap[e]?this._shapeMap[e]:null}},{key:"addShapeData",value:function(e){return this._shapeMap[e.shape.id]?(console.error("shape\u5df2\u7ecf\u5728shapeStage\u4e2d"),!1):(this._shapeMap[e.shape.id]={shape:e.shape,position:e.position,display:e.display},!0)}},{key:"updateShapeData",value:function(e,t){return this._shapeMap[e]?(void 0!==t.shape&&(this._shapeMap[e].shape=t.shape),void 0!==t.position&&(this._shapeMap[e].position=t.position),void 0!==t.display&&(this._shapeMap[e].display=t.display),!0):this.addShapeData(t)}},{key:"removeShapeData",value:function(e){return!!this._shapeMap[e]&&(delete this._shapeMap[e],!0)}}]),e}();h.EVENT={FOCUS:"focus"};var f=h;r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("./src/core/view/level-1/shape-stage/stage/board/DomShapeBoard.less");function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var _=function(){function e(t){var r=this;Object(a.a)(this,e),this._shapeMap={},this._board=document.createElement("div"),this._handleFocus=function(e){var t;e.stopPropagation(),e.preventDefault();var n=e.target;if(n){var a=n.dataset.id;a&&(null===(t=r._focusCallback)||void 0===t||t.call(r,a))}},this._blockBoard=t.blockBoard,this._imageConstructor=t.imageConstructor,this._focusCallback=t.focusCallback,this._board.classList.add("shape-stage-board"),this._blockBoard.hiddenBoard.element.appendChild(this._board)}return Object(o.a)(e,[{key:"getShape",value:function(e){return this._shapeMap[e]}},{key:"addShape",value:function(e,t){if(this._isInBoard(t)){var r={left:t.left-this._blockBoard.offsetX,top:t.top-this._blockBoard.offsetY,width:t.width,height:t.height,zIndex:t.zIndex,clipInfo:t.clipInfo,url:t.url,display:t.display},n=new this._imageConstructor(this._board,r,this._handleFocus);n.setDatasetId(e),this._shapeMap[e]=n}}},{key:"updateShape",value:function(e,t){if(this._shapeMap[e]||this.addShape(e,t),this._isInBoard(t)){var r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},t);void 0!==t.left&&(r.left=t.left-this._blockBoard.offsetX),void 0!==t.top&&(r.top=t.top-this._blockBoard.offsetY),this._shapeMap[e]&&this._shapeMap[e].setProps(r)}else this.removeShape(e)}},{key:"removeShape",value:function(e){this._shapeMap[e]&&(this._shapeMap[e].destroy(),delete this._shapeMap[e])}},{key:"showShape",value:function(e){this._shapeMap[e]&&this._shapeMap[e].setProps({display:!0})}},{key:"hideShape",value:function(e){this._shapeMap[e]&&this._shapeMap[e].setProps({display:!1})}},{key:"show",value:function(){this._board.style.display="block"}},{key:"hide",value:function(){this._board.style.display="none"}},{key:"_isInBoard",value:function(e){if(this._blockBoard.offsetX<=0&&this._blockBoard.totalWidth<=0)return!1;if(this._blockBoard.offsetY<=0&&this._blockBoard.totalHeight<=0)return!1;var t=e.left-this._blockBoard.offsetX,r=e.top-this._blockBoard.offsetY;return!(t>this._blockBoard.totalWidth||r>this._blockBoard.totalHeight||t+e.width<0||r+e.height<0)}}]),e}(),m=r("./src/core/view/utils/base-func.ts"),v=r("./src/core/view/level-1/shape-stage/stage/RecalculateListener.ts"),g=r("../packages/model/src/embedded/index.ts");function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(l.a)(this,r)}}var w=function(e){Object(s.a)(r,e);var t=y(r);function r(e){var n,o,s,l;return Object(a.a)(this,r),(l=t.call(this))._handleAreaChange=Object(m.d)((function(){l._updateAll()})),l.addShape=function(e){var t=l._getImageViewData(e);if(!t||t.shape.type===g.EMBEDDED_OBJECT_TYPE.CELL_IMAGE)return!1;if(!Object(c.a)((n=Object(i.a)(l),Object(u.a)(r.prototype)),"addShapeData",n).call(n,t))return!1;var a=R(l._spreadsheet.activeSheet,t,l._scale.scale);return l._topLeft.addShape(t.shape.id,a),l._topRight.addShape(t.shape.id,a),l._bottomLeft.addShape(t.shape.id,a),l._bottomRight.addShape(t.shape.id,a),!0},l.updateShape=function(e){var t=l._getImageViewData(e);if(!t)return!1;if(t.shape.type===g.EMBEDDED_OBJECT_TYPE.CELL_IMAGE)return l.removeShape(e),!0;if(!Object(c.a)((o=Object(i.a)(l),Object(u.a)(r.prototype)),"updateShapeData",o).call(o,e,t))return!1;var n=R(l._spreadsheet.activeSheet,t,l._scale.scale);return l._topLeft.updateShape(e,n),l._topRight.updateShape(e,n),l._bottomLeft.updateShape(e,n),l._bottomRight.updateShape(e,n),!0},l.hideShape=function(e){l._topLeft.hideShape(e),l._topRight.hideShape(e),l._bottomLeft.hideShape(e),l._bottomRight.hideShape(e)},l.showShape=function(e){l._topLeft.showShape(e),l._topRight.showShape(e),l._bottomLeft.showShape(e),l._bottomRight.showShape(e)},l.removeShape=function(e){return!!Object(c.a)((s=Object(i.a)(l),Object(u.a)(r.prototype)),"removeShapeData",s).call(s,e)&&(l._topLeft.removeShape(e),l._topRight.removeShape(e),l._bottomLeft.removeShape(e),l._bottomRight.removeShape(e),!0)},l._handleFocus=function(e){l.emitter.emit(f.EVENT.FOCUS,e)},l._mainBoard=e.mainBoard,l._spreadsheet=e.spreadsheet,l._areaData=e.areaData,l._scale=e.scale,l._rowcolAccessor=e.rowcolAccessor,l._dataCallView=e.dataCallView,l._topLeft=new _({blockBoard:l._mainBoard.top.left,imageConstructor:e.imageConstructor,focusCallback:l._handleFocus}),l._topRight=new _({blockBoard:l._mainBoard.top.right,imageConstructor:e.imageConstructor,focusCallback:l._handleFocus}),l._bottomLeft=new _({blockBoard:l._mainBoard.bottom.left,imageConstructor:e.imageConstructor,focusCallback:l._handleFocus}),l._bottomRight=new _({blockBoard:l._mainBoard.bottom.right,imageConstructor:e.imageConstructor,focusCallback:l._handleFocus}),l._areaData.row.frozen.onUpdateViewSize(l._handleAreaChange),l._areaData.row.flow.onUpdateViewSize(l._handleAreaChange),l._areaData.col.frozen.onUpdateViewSize(l._handleAreaChange),l._areaData.col.flow.onUpdateViewSize(l._handleAreaChange),l._areaData.row.frozen.onUpdateTotalSize(l._handleAreaChange),l._areaData.row.flow.onUpdateTotalSize(l._handleAreaChange),l._areaData.col.frozen.onUpdateTotalSize(l._handleAreaChange),l._areaData.col.flow.onUpdateTotalSize(l._handleAreaChange),l._recalculateListener=new v.a({dataCallView:l._dataCallView,spreadsheet:l._spreadsheet,addEmbeddedObject:l.addShape,updateEmbeddedObject:l.updateShape,removeEmbeddedObject:l.removeShape,hideEmbeddedObject:l.hideShape,showEmbeddedObject:l.showShape}),l}return Object(o.a)(r,[{key:"refresh",value:function(){var e=this;for(var t in this._shapeMap)this.removeShape(t);this._spreadsheet.activeSheet.imageManager.each((function(t,r){e.addShape(r)}))}},{key:"show",value:function(){this._topLeft.show(),this._topRight.show(),this._bottomLeft.show(),this._bottomRight.show()}},{key:"hide",value:function(){this._topLeft.hide(),this._topRight.hide(),this._bottomLeft.hide(),this._bottomRight.hide()}},{key:"_updateAll",value:function(){var e=this;this._spreadsheet.activeSheet.imageManager.each((function(t,r){t.type!==g.EMBEDDED_OBJECT_TYPE.CELL_IMAGE&&e.updateShape(r)}))}},{key:"_getImageViewData",value:function(e){var t=this._spreadsheet.activeSheet.imageManager.getImage(e);return t?{shape:t,position:function(e,t,r){var n=r.overlayPosition.anchorCell,a=n.colIndex,o=n.rowIndex,i=t.isColHidden(a)?0:r.overlayPosition.offsetXpixels,s=t.isRowHidden(o)?0:r.overlayPosition.offsetYpixels;return{left:e.getGlobalLeftByCol(a)+i,top:e.getGlobalTopByRow(o)+s}}(this._areaData,this._rowcolAccessor,t.position)}:null}},{key:"topLeft",get:function(){return this._topLeft}},{key:"topRight",get:function(){return this._topRight}},{key:"bottomLeft",get:function(){return this._bottomLeft}},{key:"bottomRight",get:function(){return this._bottomRight}}]),r}(f);function R(e,t,r){var n={};if(void 0!==t.position&&(n.left=t.position.left*r,n.top=t.position.top*r),void 0!==t.shape){n.width=t.shape.position.overlayPosition.widthPixels*r>>0,n.height=t.shape.position.overlayPosition.heightPixels*r>>0,n.zIndex=t.shape.position.overlayPosition.zIndex,n.clipInfo={clipTop:t.shape.clipInfo.clipTop*r,clipRight:t.shape.clipInfo.clipRight*r,clipBottom:t.shape.clipInfo.clipBottom*r,clipLeft:t.shape.clipInfo.clipLeft*r},n.url=t.shape.url;var a=t.shape.position.overlayPosition.anchorCell,o=a.rowIndex,i=a.colIndex;(e.data.isRowHidden(o)||e.data.isColHidden(i))&&(n.display=!1)}return n}w.EVENT=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},f.EVENT);t.a=w},"./src/core/view/level-1/shape-stage/stage/RecalculateListener.ts":function(e,t,r){"use strict";var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("./src/core/view/utils/base-func.ts");t.a=function e(t){var r=this;Object(n.a)(this,e),this._updateAll=Object(a.d)((function(){r._spreadsheet.activeSheet.imageManager.each((function(e,t){r._updateEmbeddedObject(t)}))})),this._rowVisibleChange=function(e){var t=e.ranges;r._spreadsheet.activeSheet.imageManager.each((function(e,n){for(var a=e.position.overlayPosition.anchorCell.rowIndex,o=0;o<t.length;o++){var i=t[o];if(a>=i.startIndex&&a<=i.endIndex)return void(r._spreadsheet.activeSheet.data.isRowHidden(a)?r._hideEmbeddedObject(n):r._showEmbeddedObject(n))}}))},this._colVisibleChange=function(e){var t=e.ranges;r._spreadsheet.activeSheet.imageManager.each((function(e,n){for(var a=e.position.overlayPosition.anchorCell.colIndex,o=0;o<t.length;o++){var i=t[o];if(a>=i.startIndex&&a<=i.endIndex)return void(r._spreadsheet.activeSheet.data.isColHidden(a)?r._hideEmbeddedObject(n):r._showEmbeddedObject(n))}}))},this._dataCallView=t.dataCallView,this._spreadsheet=t.spreadsheet,this._addEmbeddedObject=t.addEmbeddedObject,this._updateEmbeddedObject=t.updateEmbeddedObject,this._deleteEmbeddedObject=t.removeEmbeddedObject,this._hideEmbeddedObject=t.hideEmbeddedObject,this._showEmbeddedObject=t.showEmbeddedObject,this._dataCallView.onAddEmbeddedObject(this._addEmbeddedObject),this._dataCallView.onUpdateEmbeddedObject(this._updateEmbeddedObject),this._dataCallView.onDeleteEmbeddedObject(this._deleteEmbeddedObject),this._dataCallView.onInsertCol(this._updateAll),this._dataCallView.onInsertRow(this._updateAll),this._dataCallView.onDeleteCol(this._updateAll),this._dataCallView.onDeleteRow(this._updateAll),this._dataCallView.onSetColVisible(this._colVisibleChange),this._dataCallView.onSetRowVisible(this._rowVisibleChange),this._dataCallView.onSetColWidth(this._updateAll),this._dataCallView.onSetRowHeight(this._updateAll)}},"./src/core/view/level-1/shape-stage/stage/board/DomShapeBoard.less":function(e,t,r){var n=r("../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/view/level-1/shape-stage/stage/board/DomShapeBoard.less");"string"===typeof n&&(n=[[e.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r("../node_modules/style-loader/lib/addStyles.js")(n,a);n.locals&&(e.exports=n.locals)},"./src/core/view/level-1/wheel-operate/WheelOperate.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),i=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),s=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),l=r("./src/core/view/level-1/operate-context/BaseOperate.ts"),c=(r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.match.js"),navigator.userAgent.indexOf("Firefox")>-1),u=(-1!==navigator.userAgent.indexOf("Mac")&&-1!==navigator.userAgent.indexOf("Safari")&&navigator.userAgent.indexOf("Chrome"),navigator.userAgent.match(/Mac\sOS\sX/i)),d=(-1!==navigator.userAgent.indexOf("msie")||-1!==navigator.userAgent.indexOf("rv:11")||!!window.ActiveXObject||window,r("./src/core/view/config/default.ts"));function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var f=function(e){Object(o.a)(r,e);var t=h(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this))._smoothScrollY=!1,a._smoothScrollX=!1,a._eventName="",a._stopResponse=!1,a._handleMouseScrollEventForFirefox=function(e){if(!a._stopResponse){var t=0,r=0;if("wheel"===e.type)t=e.deltaX,r=e.deltaY,1===e.deltaMode?u?(0!==r&&(r=r>0?Math.max(10,Math.min(10*r,80)):Math.min(-10,Math.max(10*r,-80))),0!==t&&(t=t>0?Math.max(10,Math.min(10*t,80)):Math.min(-10,Math.max(10*t,-80)))):(0!==r&&(r=r>0?Math.max(20,Math.min(20*r,100)):Math.min(-20,Math.max(20*r,-100))),0!==t&&(t=t>0?Math.max(20,Math.min(20*t,100)):Math.min(-20,Math.max(20*t,-100)))):(r*=.3,t*=.3),a._scrollByPixel(-t,-r,e.shiftKey);else{var n=e.axis,o=e.detail>0?Math.max(10,Math.min(10*e.detail,80)):Math.min(-10,Math.max(10*e.detail,-80));1===n?a._scrollByPixel(-o,0):a._scrollByPixel(0,-o)}e.preventDefault()}},a._handleMouseScrollEventForNormal=function(e){if(!a._stopResponse){var t=0,r=0;void 0!==e.wheelDeltaY?t=e.wheelDeltaY:void 0!==e.deltaY?t=-e.deltaY:e.wheelDelta?t=e.wheelDelta:e.detail&&(t=-e.detail),void 0!==e.wheelDeltaX?r=e.wheelDeltaX:void 0!==e.deltaX&&(r=-e.deltaX);var n=2*d.r;a._smoothScrollY||0===t||t%120!==0?(a._smoothScrollY=!0,t*=.3):t=Math.ceil(t/120)*n,a._smoothScrollX||0===r||r%120!==0?(a._smoothScrollX=!0,r*=.3):r=Math.ceil(r/120)*n,a._scrollByPixel(r,t,e.shiftKey),e.preventDefault()}},a._handleMousedown=function(){a._stopResponse=!0,document.addEventListener("mouseup",a._handleMouseup,!0)},a._handleMouseup=function(){a._stopResponse=!1,document.removeEventListener("mouseup",a._handleMouseup,!0)},a._containers=e.containers,a.bind(),a}return Object(a.a)(r,[{key:"bind",value:function(){var e=this;this._containers.forEach((function(t){if(c){var r="onwheel"in document.createElement("div")?"wheel":"DOMMouseScroll";e._eventName=r,t.addEventListener(r,e._handleMouseScrollEventForFirefox)}else{var n;n="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",e._eventName=n,t.addEventListener(n,e._handleMouseScrollEventForNormal)}t.addEventListener("mousedown",e._handleMousedown,!0)}))}},{key:"unbind",value:function(){var e=this;this._containers.forEach((function(t){""!==e._eventName&&(c?t.removeEventListener(e._eventName,e._handleMouseScrollEventForFirefox):t.removeEventListener(e._eventName,e._handleMouseScrollEventForNormal),t.removeEventListener("mousedown",e._handleMousedown,!0))}))}},{key:"_scrollByPixel",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a={x:e,y:t};n&&0!==a.y&&(a.x=a.y,a.y=0),this.emitter.emit(r.EVENT.SCROLL,a)}},{key:"EVENT",get:function(){return r.EVENT}}]),r}(l.a);f.EVENT={SCROLL:"scroll"};t.a=f},"./src/core/view/level-2/LazyIndex.pc.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return a}));var n;r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js");function a(e){switch(e){case n.CHART_CENTER:return r.e("bundle_view_lazy_module0").then(r.bind(null,"./src/core/view/level-2/chart/chart-center/ChartCenter.pc.ts"));case n.SCROLL_BAR:return r.e("bundle_view_lazy_module1").then(r.bind(null,"./src/core/view/level-2/scroll-bar/ScrollBar.pc.ts"));case n.FREEZE_PREVIEW:return r.e("bundle_view_lazy_module1").then(r.bind(null,"./src/core/view/level-2/freeze-preview/FreezePreview.ts"));case n.TEST_API:return r.e("bundle_view_lazy_module1").then(r.bind(null,"./src/core/view/level-2/test-api/TestApi.ts"));case n.SHAPE_EDIT_CENTER:return r.e("bundle_view_lazy_module1").then(r.bind(null,"./src/core/view/level-2/shape-edit-center/ShapeEditCenter.pc.ts"));case n.SMART_DRAG:return r.e("bundle_view_lazy_module1").then(r.bind(null,"./src/core/view/level-2/smart-drag/SmartDragBoard.pc.ts"));case n.CORNER_TRIANGLE_RENDER_PLUGIN:return r.e("bundle_view_lazy_module1").then(r.bind(null,"./src/core/view/level-2/corner-triangle/CornerTriangleRenderPlugin.ts"));case n.MENTION_CENTER:return r.e("bundle_view_lazy_module1").then(r.bind(null,"./src/core/view/level-2/mention/MentionCenter.pc.ts"));case n.CELL_EDITOR_MANAGER:return r.e("bundle_view_lazy_module1").then(r.bind(null,"./src/core/view/level-2/cell-editors/CellEditorManager.tsx"));case n.CELL_IMAGE_VIEWER:return r.e("bundle_view_lazy_module1").then(r.bind(null,"./src/core/view/level-2/cell-image-viewer/index.ts"));case n.PREVIEW_IMAGE_ICON:return r.e("bundle_view_lazy_module1").then(r.bind(null,"./src/core/view/level-2/preview-image-icon/PreviewImageIcon.ts"));case n.TABLE_KEYBOARD:return r.e("bundle_view_lazy_module1").then(r.bind(null,"./src/core/view/level-2/table-keyboard/TableKeyboard.ts"));case n.CELL_CORNER_PLUGIN:return r.e("bundle_view_lazy_module1").then(r.bind(null,"./src/core/view/level-2/cell-corner/index.ts"));case n.COLLAB_CURSOR:return r.e("bundle_view_lazy_module2").then(r.bind(null,"./src/core/view/level-2/collab-cursor/CollabCursor.ts"));case n.RENDER_PLUGIN_EXTENSION:return r.e("bundle_view_lazy_module2").then(r.bind(null,"./src/core/view/level-2/render-plugin/RenderPluginExtension.ts"));case n.CARD_CENTER:return r.e("bundle_view_lazy_module2").then(r.bind(null,"./src/core/view/level-2/card-center/CardCenter.ts"));case n.LINK_CENTER:return r.e("bundle_view_lazy_module2").then(r.bind(null,"./src/core/view/level-2/link-center/LinkCenter.pc.ts"));case n.COMMENT_CENTER:return r.e("bundle_view_lazy_module2").then(r.bind(null,"./src/core/view/level-2/comment-center/CommentCenter.pc.ts"));case n.CONTEXT_MENU_CENTER:return r.e("bundle_view_lazy_module3").then(r.bind(null,"./src/core/view/level-2/context-menu-center/ContextMenuCenter.pc.ts"));case n.AREA_OVERLAY:return r.e("bundle_view_lazy_module3").then(r.bind(null,"./src/core/view/level-2/area-overlay/AreaOverlay.ts"));case n.SHAPE_UPLOAD:return r.e("bundle_view_lazy_module3").then(r.bind(null,"./src/core/view/level-2/shape-upload/ShapeUpload.ts"));case n.PC_DIMENSION_EDIT:return r.e("bundle_view_lazy_module3").then(r.bind(null,"./src/core/view/level-2/dimension-edit/DimensionEdit.pc.ts"));case n.FILTER_CENTER:return r.e("bundle_view_lazy_module4").then(r.bind(null,"./src/core/view/level-2/filter-center/FilterCenter.ts"));case n.PC_DATA_VALIDATION_CENTER:return r.e("bundle_view_lazy_module4").then(r.bind(null,"./src/core/view/level-2/data-validation-center/DataValidationCenter.pc.ts"));case n.COLLAB_FILTER_TOAST:return r.e("bundle_view_lazy_module4").then(r.bind(null,"./src/core/view/level-2/collab-filter-toast/CollabFilterToast.ts"));case n.PC_FORMULA_UI_CENTER:return r.e("bundle_view_lazy_module4").then(r.bind(null,"./src/core/view/level-2/formula-ui-center/FormulaUICenter.pc.ts"));case n.COPY_FRAME:return r.e("bundle_view_lazy_module4").then(r.bind(null,"./src/core/view/level-2/copy-frame/CopyFrameRenderPlugin.ts"));case n.SEARCH_REPLACE:return r.e("bundle_view_lazy_module5").then(r.bind(null,"./src/core/view/level-2/search-replace/SearchReplaceCenter.pc.ts"));case n.RANGE_AUTH_RENDER_PLUGIN:return r.e("bundle_view_lazy_module5").then(r.bind(null,"./src/core/view/level-2/range-auth/range-auth-render-plugin.ts"));case n.INPUT_SMART_SPLIT:return r.e("bundle_view_lazy_module5").then(r.bind(null,"./src/core/view/level-2/temp/InputSmartSplit.pc.ts"));case n.CONDITION_FORMAT_CENTER:return r.e("bundle_view_lazy_module5").then(r.bind(null,"./src/core/view/level-2/condition-format-center/ConditionFormatCenter.pc.ts"));case n.ERROR_TIP:return r.e("bundle_view_lazy_module5").then(r.bind(null,"./src/core/view/level-2/error-tip/index.ts"))}}!function(e){e.SCROLL_BAR="SCROLL_BAR",e.CONTEXT_MENU_CENTER="CONTEXT_MENU_CENTER",e.SHAPE_EDIT_CENTER="SHAPE_EDIT_CENTER",e.SMART_DRAG="SMART_DRAG",e.COLLAB_CURSOR="COLLAB_CURSOR",e.RENDER_PLUGIN_EXTENSION="RENDER_PLUGIN_EXTENSION",e.CARD_CENTER="CARD_CENTER",e.LINK_CENTER="LINK_CENTER",e.COMMENT_CENTER="COMMENT_CENTER",e.AREA_OVERLAY="AREA_OVERLAY",e.SHAPE_UPLOAD="SHAPE_UPLOAD",e.PC_DIMENSION_EDIT="PC_DIMENSION_EDIT",e.FREEZE_PREVIEW="FREEZE_PREVIEW",e.TEST_API="TEST_API",e.FILTER_CENTER="FILTER_CENTER",e.PC_DATA_VALIDATION_CENTER="PC_DATA_VALIDATION_CENTER",e.COLLAB_FILTER_TOAST="COLLAB_FILTER_TOAST",e.PC_FORMULA_UI_CENTER="PC_FORMULA_UI_CENTER",e.COPY_FRAME="COPY_FRAME",e.CORNER_TRIANGLE_RENDER_PLUGIN="CORNER_TRIANGLE_RENDER_PLUGIN",e.MENTION_CENTER="MENTION_CENTER",e.PREVIEW_IMAGE_ICON="PREVIEW_IMAGE_ICON",e.CHART_CENTER="CHART_CENTER",e.TABLE_KEYBOARD="TABLE_KEYBOARD",e.SEARCH_REPLACE="SEARCH_REPLACE",e.RANGE_AUTH_RENDER_PLUGIN="RANGE_AUTH_RENDER_PLUGIN",e.INPUT_SMART_SPLIT="INPUT_SMART_SPLIT",e.CONDITION_FORMAT_CENTER="CONDITION_FORMAT_CENTER",e.ERROR_TIP="ERROR_TIP",e.CELL_CORNER_PLUGIN="CELL_CORNER_PLUGIN",e.CELL_EDITOR_MANAGER="CELL_EDITOR_MANAGER",e.CELL_IMAGE_VIEWER="CELL_IMAGE_VIEWER"}(n||(n={}))},"./src/core/view/level-2/chart/charts/ChartsUtils.ts":function(e,t,r){"use strict";r.d(t,"b",(function(){return f})),r.d(t,"a",(function(){return p})),r.d(t,"c",(function(){return _}));var n=r("../packages/model/src/range/hexRangeUtils.ts"),a=r("../packages/model/src/new-embedded/EmbeddedObjectLocation.ts"),o=r("../packages/model/src/new-embedded/EmbeddedObject.ts"),i=r("../packages/model/src/new-embedded/chart/ChartProperties.ts"),s=r("../packages/model/src/new-embedded/EmbeddedObjectProperties.ts"),l=r("../packages/model/src/new-embedded/EmbeddedObjectType.ts"),c=r("../packages/model/src/new-embedded/chart/ChartTitle.ts"),u=r("../packages/model/src/new-embedded/chart/DataTransformation.ts"),d=r("../packages/model/src/new-embedded/chart/ChartType.ts"),h=r("../packages/model/src/new-embedded/chart/RegionCode.ts");function f(e,t,r){var f=r.range,p=r.type,_=r.title,m=r.subTitle,v=e.spreadsheet.activeSheetId,g=function(e,t){var r=t.endRowIndex+2,n=t.startColIndex;return e.spreadsheet.activeSheet.getRowCount()<r+18&&(r=t.startRowIndex-18-1),r<0&&(r=0),{rowIndex:r,colIndex:n}}(e,Object(n.hex2Range)(f,v)),b=new a.a({isOwnSheet:!1,sheetId:v,position:{colIndex:g.colIndex,rowIndex:g.rowIndex}}),y=-1!==r.asHeaderRow?r.asHeaderRow:-1,w=new u.a({colInfo:{columnIndex:r.asLabelCol}}),R=new i.a;return R.setType(p),R.setTitle(new c.a(_)),R.setSubTitle(new c.a(m)),p===d.a.GEO_CHART&&R.chartModel.geoChartOptions&&(R.chartModel.geoChartOptions.region=h.a.China),R.headers=y,R.dataTransformation=w,new o.a({properties:new s.a({type:l.a.CHART,chart:R}),objectId:t,location:b})}function p(e,t,r){r.range;var n=r.type,a=r.title,o=r.subTitle,i=r.asHeaderRow,s=r.asLabelCol,l=e.spreadsheet.embeddedObjectManager.getEmbeddedObject(t);if(!l)return null;l=l.clone();var d=-1!==i?i:-1,h=new u.a({colInfo:{columnIndex:s}}),f=l.properties,p=f.chart;return p&&(p.setType(n),p.setTitle(new c.a(a)),p.setSubTitle(new c.a(o)),p.headers=d,p.dataTransformation=h,l.properties=f),l}function _(e,t,r){var n=e.spreadsheet.embeddedObjectManager.getEmbeddedObject(t),o=e.spreadsheet.activeSheetId;if(!n)return null;var i=(n=n.clone()).location,s=i.isOwnSheet,l=i.zIndex,c=i.position,u=new a.a({isOwnSheet:s,sheetId:o,width:r.width,height:r.height,x:r.x,y:r.y,position:{colIndex:void 0!==r.colIndex?r.colIndex:c.colIndex,rowIndex:void 0!==r.rowIndex?r.rowIndex:c.rowIndex},zIndex:l});return n.location=u,n}},"./src/core/view/level-2/chart/charts/calc-plugin/ChartsApi.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.match.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("./src/base/index.ts"),i=r("./src/core/utils/index.ts"),s=r("./src/core/feature/formula/utils/parseUtil.ts"),l=r("./src/core/worker/worker-thread/index.ts"),c=r("../packages/model/src/workbookRange/WorkbookRangeType.ts"),u=r("../packages/model/src/range/hexRangeUtils.ts"),d=function(e){return"charts".concat(e)},h=function(e){var t=e.match(/charts\d+/gi);return t?t[0].replace("charts",""):null},f=function(){function t(e){var r=this;Object(n.a)(this,t),this.getChartWorkbookRangeById=function(e){return r.externalMethods.getChartWorkbookRangeById(e)},this.customTypeFormulaModelChange=function(e){var t=e.customType,n=e.datas;if(/charts/gi.test(t)){var a=h(t);n.forEach((function(e){var t=e.row,n=e.col,o=e.sheetId,s=e.formulaModel.toString(t,n,{getSheetTitleBySheetId:r.externalMethods.getSheetTitleBySheetId}),l=i.a.formula.util.moveEqualChar(s),c="#REF!"===l;r.onUpdateChartsWorkbookRange(a,l,o,c)}))}},this.customTypeResultChange=function(e){var t=e.customType;if(/charts/gi.test(t)){var n=h(t);r.onUpdateCharts(n)}},this.onUpdateChartsWorkbookRange=function(e,t,r,n){return l.a.workerThreadWorker.charts.triggerWorkbookRangeChange({workbookRangeId:e,rangeStr:t,sheetId:r,isRef:n})},this.onUpdateCharts=function(e){return l.a.workerThreadWorker.charts.triggerDataChange({workbookRangeId:e})},this.externalMethods=e,this.subscribe()}return Object(a.a)(t,[{key:"addToFmap",value:function(t,r){var n=r.sheetId,a="=".concat(Object(u.range2AbsoluteHex)(r,e.SpreadsheetApp.spreadsheet.activeSheet)),o=Object(s.c)(a,0,0,n);this.externalMethods.addCustomFormulaNodeAndGenerateDependency({formulaModel:o,row:-1,col:0,sheetId:r.sheetId,customType:d(t)})}},{key:"deleteFromMap",value:function(e){this.externalMethods.removeCustomFormulaNodeByType(d(e))}},{key:"subscribe",value:function(){o.a.event.formula.listen("customTypeFormulaModelChange",this.customTypeFormulaModelChange),o.a.event.formula.listen("customTypeResultChange",this.customTypeResultChange)}}]),t}(),p=function(){function e(t){Object(n.a)(this,e),this.externalMethods=t,this.formulaHandler=new f(t)}return Object(a.a)(e,[{key:"add",value:function(e,t){if(e!==c.a.CHART)return null;var r=this.formulaHandler.getChartWorkbookRangeById(t).range;this.formulaHandler.addToFmap(t,r)}},{key:"update",value:function(e,t){if(e!==c.a.CHART)return null;var r=this.formulaHandler.getChartWorkbookRangeById(t).range;this.formulaHandler.deleteFromMap(t),this.formulaHandler.addToFmap(t,r)}},{key:"delete",value:function(e,t){if(e!==c.a.CHART)return null;this.formulaHandler.deleteFromMap(t)}}]),e}();t.a=p}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/view/level-2/condition-format-center/data/ConditionFormatUtils.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("./src/core/feature/formula/utils.ts"),r("../packages/model/src/utils/numberFormat/FormatParseEngine.ts");var n=function(e,t,r){for(var n=t,a=t.sheetId,o=e.sheetManager.getSheetBySheetId(t.sheetId),i=n.isCol?0:n.startRowIndex,s=n.isCol?o.getRowCount()-1:n.endRowIndex,l=n.isRow?0:n.startColIndex,c=n.isRow?o.getColCount()-1:n.endColIndex,u=i;u<=s;u++)for(var d=l;d<=c;d++)r(u,d,a)}},"./src/core/view/level-2/condition-format-center/data/calc-plugin/ConditionFormatApi.ts":function(e,t,r){"use strict";var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("./src/core/view/level-2/condition-format-center/data/calc-plugin/ConditionFormulaHandler.ts"),i=r("./src/core/feature/formula/custom-formula/index.ts"),s=(r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../packages/model/src/index.ts")),l=s.Rule.CONDITION_TYPE,c={acceptRef:!0,min:4};function u(e,t,r){for(var n=[],a=arguments.length,o=new Array(a>3?a-3:0),i=3;i<a;i++)o[i-3]=arguments[i];o.forEach((function(e){n.push(e.toArray())}));var s=n.map((function(n){return n.map((function(n){return"number"===typeof n&&d(e,n,t,r)}))}));return s}function d(e,t,r,n){switch(e){case l.DATE_DURING:case l.DATE_BETWEEN:return t>=r&&t<=n;case l.DATE_NOT_BETWEEN:return t<r||t>n;case l.DATE_BEFORE:return t<r;case l.DATE_AFTER:return t>r;case l.DATE_ON_OR_BEFORE:return t<=r;case l.DATE_ON_OR_AFTER:return t>=r;case l.DATE_EQ:return 0===n?t===r:t>=r&&t<=n}return!1}var h=r("./src/core/feature/formula/utils.ts"),f={acceptRef:!0,min:2};function p(e){for(var t=[],r=arguments.length,n=new Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];n.forEach((function(e){t.push(e.toArray())}));var o=t.map((function(t){return t.map((function(t){var r=_(t);return e?r:!r}))}));return o}function _(e){return Object(h.v)(e)||"number"===typeof e&&(isNaN(e)||!isFinite(e))}var m=r("../packages/model/src/utils/numberFormat/FormatParseEngine.ts"),v=s.Rule.CONDITION_TYPE,g={acceptRef:!0,min:4};function b(e,t,r){for(var n=[],a=arguments.length,o=new Array(a>3?a-3:0),i=3;i<a;i++)o[i-3]=arguments[i];o.forEach((function(e){n.push(e.toArray())}));var s=w(t),l=w(r),c=n.map((function(t){return t.map((function(t){return y(e,t,s,l)}))}));return c}function y(e,t,r,n){if(null===t)return e===v.NUMBER_NOT_EQ||e===v.NUMBER_NOT_BETWEEN;var a=w(t);switch(e){case v.NUMBER_GREATER:return a>r;case v.NUMBER_GREATER_THAN_EQ:return a>=r;case v.NUMBER_LESS:return a<r;case v.NUMBER_LESS_THAN_EQ:return a<=r;case v.NUMBER_EQ:return a===r;case v.NUMBER_NOT_EQ:return a!==r;case v.NUMBER_BETWEEN:return a>=r&&a<=n;case v.NUMBER_NOT_BETWEEN:return a<r||a>n}return!1}function w(e){var t;if("number"===typeof e)return e;var r=(null===(t=Object(m.parseValue)(e,null))||void 0===t?void 0:t.numericValue)||e;return"string"!==typeof r||isNaN(parseFloat(r))?r:parseFloat(r)}r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.last-index-of.js");var R=r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),E={acceptRef:!0,min:1};function C(){for(var e=[],t=[],r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];n.forEach((function(r){t=[].concat(Object(R.a)(t),Object(R.a)(r.toArray())),e.push(r.toArray())}));var o=t.filter((function(e){return t.indexOf(e)===t.lastIndexOf(e)})),i=e.map((function(e){return e.map((function(e){return null!==e&&-1===o.indexOf(e)}))}));return i}r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.ends-with.js"),r("../node_modules/core-js/modules/es.string.starts-with.js"),r("../node_modules/core-js/modules/es.string.trim.js");var j=r("./src/core/feature/formula/ast_node/utils.ts"),O=s.Rule.CONDITION_TYPE,S={acceptRef:!0,min:3};function D(e,t){for(var r=[],n=arguments.length,a=new Array(n>2?n-2:0),o=2;o<n;o++)a[o-2]=arguments[o];a.forEach((function(e){r.push(e.toArray())})),Object(j.a)(t)&&(t=t.toArray()[0]);var i=t.toString().toUpperCase(),s=r.map((function(t){return t.map((function(t){return null===t&&(t=""),x(e,t.toString().toUpperCase(),i)}))}));return s}function x(e,t,r){switch(e){case O.TEXT_CONTAINS:return-1!==t.indexOf(r);case O.TEXT_NOT_CONTAINS:return-1===t.indexOf(r);case O.TEXT_EQ:return t===r;case O.TEXT_STARTS_WITH:return t.startsWith(r);case O.TEXT_ENDS_WITH:return t.endsWith(r);case O.BLANK:return 0===t.trim().length;case O.NOT_BLANK:return 0!==t.trim().length}return!1}var k=function(){function e(t){Object(n.a)(this,e),this.formulaHandler=new o.a(t),i.a.register("COND_DATE",u,c),i.a.register("COND_ERROR",p,f),i.a.register("COND_NUMBER",b,g),i.a.register("COND_REPEAT",C,E),i.a.register("COND_TEXT",D,S)}return Object(a.a)(e,[{key:"add",value:function(e,t){return this.formulaHandler.cacheRule(t.ruleRanges),this.formulaHandler.addCondRangeToFmap(e,t)}},{key:"update",value:function(e,t,r){return this.formulaHandler.deleteCondFromFMap(e),this.formulaHandler.updateDirtyRange(r),this.formulaHandler.cacheRule(t.ruleRanges),this.formulaHandler.addCondRangeToFmap(e,t)}},{key:"delete",value:function(e,t){this.formulaHandler.deleteCondFromFMap(e),this.formulaHandler.updateDirtyRange(t),this.formulaHandler.cacheRule(t)}},{key:"clearDirtyRange",value:function(e){this.formulaHandler.updateDirtyRange(e)}},{key:"updateDirtyRange",value:function(e){this.formulaHandler.updateDirtyRange(e)}}]),e}();t.a=k},"./src/core/view/level-2/condition-format-center/data/calc-plugin/ConditionFormulaHandler.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.symbol.description.js"),r("../node_modules/core-js/modules/es.symbol.iterator.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.find.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.from.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.array.reduce.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.function.name.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("./src/base/index.ts"),i=r("../packages/model/src/index.ts"),s=r("./src/core/worker/worker-thread/index.ts"),l=r("./src/core/view/level-2/condition-format-center/data/ConditionFormatUtils.ts"),c=r("../packages/model/src/range/GridRange.ts"),u=r("../packages/model/src/cell/CellDataDelta.ts"),d=r("../packages/model/src/cell/CellDataSlot.ts"),h=r("./src/core/view/level-2/condition-format-center/data/calc-plugin/utils.ts"),f=r("../packages/report/src/index.ts"),p=r("../packages/mutation/src/cell/SetRangeMutation.ts");function _(e,t){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"===typeof e)return m(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return m(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw o}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var v=function(){function t(r){var a=this;Object(n.a)(this,t),this.customTypeFormulaModelChange=function(e){},this.customTypeResultChange=function(e){var t=e.customType,r=e.datas,n=e.options,o=Object(h.f)(t);if(null===o)return null;if(Object(h.d)(t)){if(!a.getConditionFormatById(o,r[0].sheetId))return null;r.forEach((function(e){var t=e.row,r=e.col,o=e.sheetId,i=e.value;Array.isArray(i)&&i.length>0?i.forEach((function(e){a.updateRowCol(e.row,e.col,o,n)})):a.updateRowCol(t,r,o,n)})),a.batchSend()}},this.addCondRangeToFmap=function(t,r){var n=r.ruleRanges[0];if(void 0!==n){var o=a.getConditionFormatByIndex(t,n.sheetId).id,i=Object(h.c)(r,n.sheetId,n.startRowIndex,n.startColIndex,{getSheetTitleBySheetId:a.externalMethods.getSheetTitleBySheetId},e.SpreadsheetApp.spreadsheet);if(null!==r&&o&&null!==i){var s=a.externalMethods.addCustomFormulaNodeAndGenerateDependency({formulaModel:i,row:n.startRowIndex,col:n.startColIndex,sheetId:n.sheetId,customType:Object(h.a)(o)}),l=r.ruleRanges.reduce((function(e,t){var r=t.startColIndex,n=t.endColIndex,a=t.startRowIndex;return e+(t.endRowIndex-a)*(n-r)}),0);return f.b.tdwReport({opername:"tech_doc",module:"formula",action:"condition_formula_count",ver5:l}),[s]}}},this.deleteCondFromFMap=function(e){var t=a.getRuleIdFromCache(e);if(!t)return null;a.externalMethods.removeCustomFormulaNodeByType(Object(h.a)(t))},this.setFormat=function(e,t,r,n,o){o||(o={mutationQueueIdRelatedSheetId:n}),a.cacheList.push({sheetId:n,row:t,col:r,conditionalFormatResult:Object(h.b)(e.rule),options:o})},this.clearFormat=function(e,t,r,n){n||(n={mutationQueueIdRelatedSheetId:r}),a.cacheList.push({sheetId:r,row:e,col:t,conditionalFormatResult:null,options:n})},this.batchSend=function(){for(;a.cacheList.length>=1e3||0!=a.cacheList.length;){var e=Math.min(1e3,a.cacheList.length);a.onBatchUpdateCellDataConditionalFormatResult(a.cacheList.slice(0,e)),a.cacheList=a.cacheList.slice(e,a.cacheList.length)}},this.updateRowCol=function(e,t,r,n){var o=a.getConditionalFormatRuleAll(r),s=Object(h.g)(o,new i.Range.GridRange(r,e,e,t,t));a.getEffectiveRuleAndSetFormat(s,e,t,r,n)},this.clearDirtyRange=function(t){if(!t||0===t.length)return null;t.forEach((function(t){Object(l.a)(e.SpreadsheetApp.spreadsheet,t,(function(e,t,r){a.clearFormat(e,t,r)}))}))},this.updateDirtyRange=function(t,r){if(!t||0===t.length)return null;var n=t[0].sheetId,o=a.getConditionalFormatRuleAll(n);t.forEach((function(t){Object(l.a)(e.SpreadsheetApp.spreadsheet,t,(function(e,t,n){var s=Object(h.g)(o,new i.Range.GridRange(n,e,e,t,t));a.getEffectiveRuleAndSetFormat(s,e,t,n,r)}))})),a.batchSend()},this.cacheRule=function(e){var t=a.getSheetId(e);if(null===t)return null;var r=a.getConditionalFormatRuleAll(t);r&&(a.cache=r.map((function(e){return Object(h.e)(e.id)})))},this.getConditionFormatByIndex=function(e,t){return a.getConditionalFormatRuleAll(t).filter((function(t){return t.index===e&&t}))[0]},this.getConditionFormatById=function(e,t){return a.getConditionalFormatRuleAll(t).filter((function(t){return Object(h.e)(t.id)===e&&t}))[0]},this.getSheetId=function(e){return e&&0!==e.length?e[0].sheetId:null},this.getRuleIdFromCache=function(e){var t=a.cache[e];return t||""},this.externalMethods=r,this.cache=[],this.cacheList=[],this.subscribe()}return Object(a.a)(t,[{key:"subscribe",value:function(){o.a.event.formula.listen("customTypeResultChange",this.customTypeResultChange)}},{key:"getConditionalFormatRuleAll",value:function(e){var t=this.externalMethods.getSheetBySheetId(e);return t?t.conditionalFormatRuleManager.rules:[]}},{key:"getEffectiveRuleAndSetFormat",value:function(e,t,r,n,a){if(0!==e.length){var o,i="",s=_(e);try{for(s.s();!(o=s.n()).done;){var l=o.value,c=Object(h.e)(l.id),u=Object(h.a)(c);if(this.externalMethods.getItemByCustomTypeAndRowCol({customType:u,row:t,col:r,sheetId:n}).value){i=l.id;break}}}catch(f){s.e(f)}finally{s.f()}var d=e.find((function(e){return e.id===i}));d?this.setFormat(d,t,r,n,a):this.clearFormat(t,r,n,a)}else this.clearFormat(t,r,n,a)}},{key:"onBatchUpdateCellDataConditionalFormatResult",value:function(e){var t=e[0].sheetId,r=this.externalMethods.countRows(t),n=this.externalMethods.countCols(t),a=r-1,o=0,i=n-1,l=0,h=e.map((function(e){return e.row>=r||e.col>=n||e.col<0||e.col<0?null:(a=Math.min(e.row,a),o=Math.max(e.row,o),i=Math.min(e.col,i),l=Math.max(e.col,l),{rowIndex:e.row,colIndex:e.col,cellDataDelta:e.conditionalFormatResult?new u.a({setSlots:1<<d.b.SLOT_CONDITIONAL_FORMAT_DELTA,clearSlots:0,delta:{conditionalFormatResult:e.conditionalFormatResult}}):new u.a({setSlots:0,clearSlots:1<<d.b.SLOT_CONDITIONAL_FORMAT_DELTA})})})).filter((function(e){return e})),f=new p.a({gridRange:new c.b(t,a,o,i,l),cellDataDeltaAtPositions:h});"string"===typeof e[0].options.mutationQueueIdRelatedSheetId&&s.a.workerThreadWorker.mutationData.syncNonPersistentMutationsToMainThread({mutations:[f],isFromFormula:!0})}}]),t}();t.a=v}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/view/level-2/condition-format-center/data/calc-plugin/utils.ts":function(e,t,r){"use strict";r.d(t,"d",(function(){return f})),r.d(t,"f",(function(){return p})),r.d(t,"a",(function(){return _})),r.d(t,"e",(function(){return m})),r.d(t,"c",(function(){return v})),r.d(t,"b",(function(){return b})),r.d(t,"g",(function(){return w}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.array.some.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.match.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../packages/model/src/index.ts"),a=r("./src/core/feature/formula/utils/parseUtil.ts"),o=r("./src/core/utils/formula.ts"),i=r("../packages/model/src/range/hexRangeUtils.ts"),s=n.Rule,l=s.CONDITION_TYPE,c=s.ARG_TOKEN_TYPE,u=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;if(!e||!e[r])return null;var a=e[r];if(a.type===c.FORMULA_TOKEN&&null!=a.formula){var o=t.userValueRelativeRow,i=t.userValueRelativeCol;return a.formula.toString(o,i,n)}return a.userEnteredValue};function d(e,t){if(0===e.length)throw new Error("\u6761\u4ef6\u683c\u5f0f gridRange \u5f02\u5e38");var r=[];return e.forEach((function(e){r.push(Object(i.range2AbsoluteHex)(e,t))})),r.join(",")}var h=function(e,t,r,n){if(null===e)return null;var i=e.type,s=void 0===i?null:i,c=e.values,h=void 0===c?null:c;return null===s?null:function(e){return null===e?null:e>=l.NUMBER_GREATER&&e<=l.NUMBER_NOT_BETWEEN}(s)?function(e,t,r,n,a){var o=u(t,r,0,n)||"",i=u(t,r,1,n)||"";return"=COND_NUMBER(".concat(e,', "').concat(o,'", "').concat(i,'", ').concat(d(r.gridRanges,a),")")}(s,h,t,r,n):function(e){return null===e?null:e>=l.TEXT_CONTAINS&&e<=l.TEXT_IS_URL||e===l.NOT_BLANK||e===l.BLANK}(s)?function(e,t,r,n,i){var s=u(t,r,0,n);if(s)if(Object(o.isFormulaString)(s)){var l=Object(a.c)(s,0,0,r.sheetId);if(l.hasRelativeReference()){for(var c=l.getParts(),h=c.length-1;h>0;h--){var f=c[h];"string"!==typeof f&&(f.isStartColRelative=!1,f.isEndColRelative=!1,f.isStartRowRelative=!1,f.isEndRowRelative=!1)}s=l.toString(0,0,n)}s=Object(o.moveEqualChar)(s)}else s='"'.concat(s,'"');else s='""';return"=COND_TEXT(".concat(e,", ").concat(s,", ").concat(d(r.gridRanges,i),")")}(s,h,t,r,n):function(e){return null===e?null:e>=l.DATE_DURING&&e<=l.DATE_IS_VALID}(s)?function(e,t,r,n,a){var i=u(t,r,0,n),s=u(t,r,1,n);if(e===l.DATE_EQ){var c=i.split("|");if(c.length>1)return"=COND_DATE(".concat(e,", ").concat(Object(o.moveEqualChar)(c[0]),", ").concat(Object(o.moveEqualChar)(c[1]),", ").concat(d(r.gridRanges,a),")")}return i=Object(o.isFormulaString)(i)?"".concat(Object(o.moveEqualChar)(i)):'EDATE("'.concat(i,'",0)'),s=s?'EDATE("'.concat(s,'",0)'):"","=COND_DATE(".concat(e,", ").concat(i,", ").concat(s,", ").concat(d(r.gridRanges,a),")")}(s,h,t,r,n):function(e){return null===e?null:e===l.REPEAT}(s)?function(e,t,r,n,a){return"=COND_REPEAT(".concat(d(r.gridRanges,a),")")}(0,0,t,0,n):function(e){return null===e?null:e===l.ERROR||e===l.NOT_ERROR}(s)?function(e,t,r,n,a){var o=null;switch(e){case l.ERROR:o="COND_ERROR(".concat(!0,", ",d(r.gridRanges,a),")");break;case l.NOT_ERROR:o="COND_ERROR(".concat(!1,", ",d(r.gridRanges,a),")")}return"=".concat(o)}(s,0,t,0,n):function(e,t,r){switch(e){case l.ONE_OF_LIST:case l.ONE_OF_RANGE:case l.CUSTOM_FORMULA:case l.BOOLEAN:default:return""}}(s)},f=function(e){return/cond\w{20}$/gi.test(e)},p=function(e){var t=e.match(/cond\w{20}/gi);return t?t[0].replace("cond",""):null},_=function(e){return e=m(e),"cond".concat(e)},m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(e+="").replace(/-/gi,"")},v=function(e,t,r,n,o,i){var s=g(e);if(null===s)return null;var l=h(s,{sheetId:t,userValueRelativeRow:r,userValueRelativeCol:n,gridRanges:e.ruleRanges},o,i.activeSheet);if(null===l)return null;var c=Object(a.c)(l,0,0,t);return c||null},g=function(e){if(null===e)return null;var t=e.booleanConditionalFormat;if(null===t)return null;var r=t.condition;return void 0===r?null:r},b=function(e){var t=y(e);return t?t.format:null},y=function(e){if(e){var t=e.booleanConditionalFormat;return null===t?null:t}return null},w=function(e,t){return e.filter((function(e){return e.rule.ruleRanges.some((function(e){return e.isCross(t)}))}))}},"./src/core/view/level-2/dimension-edit/hide-show-head/HideShowHead.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return R}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js");var n,a=r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),i=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),l=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),c=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),u=r("./src/core/view/level-2/render-plugin/BaseRenderPlugin.ts"),d=r("./src/core/view/spreadsheet-view/render-manager/alloy-excel/table/Table.canvas.ts"),h=r("./src/core/view/spreadsheet-view/model/Color.ts"),f=r("./src/core/view/spreadsheet-view/render-manager/alloy-excel/canvas/renderer/BaseRenderer.ts"),p=r("./src/core/view/spreadsheet-view/render-manager/alloy-excel/utils.ts"),_=r("./src/core/view/level-2/dimension-edit/hide-show-head/utils.ts"),m=r("./src/core/view/level-1/operate-context/mouse/MouseOperate.ts"),v=function(){function e(t){var r=this;Object(o.a)(this,e),this._cacheData={hover:!1,dir:0,row:-1,col:-1},this._handleMove=function(){if(!r._operateData.isOverTable()){var e=r._operateData,t=e.currRow,n=e.currCol;-1!==t&&-1!==n||-1===t&&-1===n?r._cacheData.hover&&r._clearCache():-1===n?-1===t||r._handleHoverInRow(t):r._handleHoverInCol(n)}},this._handleDown=function(){if(r._cacheData.hover&&r._sheetStatus.canEdit){if(r._operateData.stopPropagation=!0,-1!==r._cacheData.col){var e=r._cacheData.col;r._cacheData.dir>0?r._colIconDown(e,1):r._colIconDown(e,-1)}if(-1!==r._cacheData.row){var t=r._cacheData.row;r._cacheData.dir>0?r._rowIconDown(t,1):r._rowIconDown(t,-1)}}},this._mouseOperate=t.mouseOperate,this._operateData=t.operateData,this._spreadsheet=t.spreadsheet,this._areaData=t.areaData,this._rowcolAccessor=t.rowcolAccessor,this._scale=t.scale,this._headSize=t.headSize,this._sheetStatus=t.sheetStatus,this._renderRowHead=t.renderRowHead,this._renderColHead=t.renderColHead,this._colIconDown=t.colIconDown,this._rowIconDown=t.rowIconDown,this._mouseOperate.emitter.on(m.a.EVENT.MOVE,this._handleMove),this._mouseOperate.emitter.on(m.a.EVENT.DOWN,this._handleDown,{priority:!0})}return Object(i.a)(e,[{key:"_clearCache",value:function(){-1!==this._cacheData.row&&-1===this._cacheData.col&&this._renderRowHead(),-1===this._cacheData.row&&-1!==this._cacheData.col&&this._renderColHead(),this._cacheData.hover=!1,this._cacheData.dir=0,this._cacheData.row=-1,this._cacheData.col=-1}},{key:"_checkHover",value:function(e,t,r,n){return this._operateData.currX>=e&&this._operateData.currX<=e+r&&this._operateData.currY>=t&&this._operateData.currY<=t+n}},{key:"_handleHoverInCol",value:function(e){if(this._cacheData.col!==e)this._clearCache(),this._cacheData.col=e;else{var t=this._areaData.getViewLeftByCol(e)+this._headSize.rowHeadWidth,r=this._rowcolAccessor.getColSetWidth(e);if(this._spreadsheet.activeSheet.data.isColHiddenByUser(e+1))if(this._checkHover.apply(this,Object(a.a)(Object(_.c)(n.LEFT,t,r)))){if(this._cacheData.hover&&1===this._cacheData.dir)return;this._cacheData.hover=!0,this._cacheData.dir=1}else this._spreadsheet.activeSheet.data.isColHiddenByUser(e-1)||this._clearCache();if(this._spreadsheet.activeSheet.data.isColHiddenByUser(e-1))if(this._checkHover.apply(this,Object(a.a)(Object(_.c)(n.RIGHT,t,r)))){if(this._cacheData.hover&&-1===this._cacheData.dir)return;this._cacheData.hover=!0,this._cacheData.dir=-1}else this._spreadsheet.activeSheet.data.isColHiddenByUser(e+1)||this._clearCache()}this._renderColHead()}},{key:"_handleHoverInRow",value:function(e){if(this._cacheData.row!==e)return this._clearCache(),void(this._cacheData.row=e);var t=this._areaData.getViewTopByRow(e)+this._headSize.colHeadHeight,r=this._rowcolAccessor.getRowDisplayHeight(e),o=this._spreadsheet.activeSheet;if(Object(_.e)(o,e))if(this._checkHover.apply(this,Object(a.a)(Object(_.d)(n.TOP,t,r)))){if(this._cacheData.hover&&1===this._cacheData.dir)return;this._cacheData.hover=!0,this._cacheData.dir=1}else Object(_.f)(o,e)||this._clearCache();if(Object(_.f)(o,e))if(this._checkHover.apply(this,Object(a.a)(Object(_.d)(n.BOTTOM,t,r)))){if(this._cacheData.hover&&-1===this._cacheData.dir)return;this._cacheData.hover=!0,this._cacheData.dir=-1}else Object(_.e)(o,e)||this._clearCache();this._renderRowHead()}}]),e}(),g=r("./src/core/view/level-1/operate-context/touch/TouchOperate.ts"),b=function(){function e(t){var r=this;Object(o.a)(this,e),this._handleDown=function(){if(!r._operateData.isOverTable()){var e=r._spreadsheet.activeSheet,t=r._operateData,o=t.currRow,i=t.currCol;if(-1!==i&&-1===o){var s=r._areaData.getViewLeftByCol(i)+r._headSize.rowHeadWidth,l=r._rowcolAccessor.getColSetWidth(i);e.data.isColHiddenByUser(i+1)&&r._checkHover.apply(r,Object(a.a)(Object(_.c)(n.LEFT,s,l)))&&r._colIconDown(i,1),e.data.isColHiddenByUser(i-1)&&r._checkHover.apply(r,Object(a.a)(Object(_.c)(n.RIGHT,s,l)))&&r._colIconDown(i,-1)}if(-1!==o&&-1===i){var c=r._areaData.getViewTopByRow(o)+r._headSize.colHeadHeight,u=r._rowcolAccessor.getRowDisplayHeight(o);Object(_.e)(e,o)&&r._checkHover.apply(r,Object(a.a)(Object(_.d)(n.TOP,c,u)))&&r._rowIconDown(o,1),Object(_.f)(e,o)&&r._checkHover.apply(r,Object(a.a)(Object(_.d)(n.BOTTOM,c,u)))&&r._rowIconDown(o,-1)}}},this._touchOperate=t.touchOperate,this._operateData=t.operateData,this._spreadsheet=t.spreadsheet,this._areaData=t.areaData,this._rowcolAccessor=t.rowcolAccessor,this._scale=t.scale,this._headSize=t.headSize,this._colIconDown=t.colIconDown,this._rowIconDown=t.rowIconDown,this._touchOperate.emitter.on(g.a.EVENT.DOWN,this._handleDown)}return Object(i.a)(e,[{key:"_checkHover",value:function(e,t,r,n){return this._operateData.currX>=e&&this._operateData.currX<=e+r&&this._operateData.currY>=t&&this._operateData.currY<=t+n}}]),e}();function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(l.a)(this,r)}}!function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"}(n||(n={}));var w=[2,4,8,4,5],R=[0,2,12,14],E=function(e){Object(s.a)(r,e);var t=y(r);function r(e){var a;Object(o.a)(this,r),(a=t.call(this,e))._color=h.a.newInstanceByHex("#000000"),a.renderAfterRow=function(e){var t,r=e.row,o=e.y,i=a._spreadsheet.activeSheet;for(t=1;i.data.isRowHidden(r+t)&&r+t<i.getRowCount();){if(i.data.isRowHiddenByUser(r+t)){var s=a._rowcolAccessor.getRowDisplayHeight(r);a._renderTriangleGraphics(n.TOP,0,o,a._headSize.rowHeadWidth,s);break}t+=1}for(t=1;i.data.isRowHidden(r-t)&&r-t>=0;){if(i.data.isRowHiddenByUser(r-t)){var l=a._rowcolAccessor.getRowDisplayHeight(r);a._renderTriangleGraphics(n.BOTTOM,0,o,a._headSize.rowHeadWidth,l);break}t+=1}},a.renderAfterCol=function(e){var t=e.col,r=e.x;if(a._spreadsheet.activeSheet.data.isColHiddenByUser(t+1)){var o=a._rowcolAccessor.getColSetWidth(t);a._renderTriangleGraphics(n.LEFT,r,0,o,a._headSize.colHeadHeight)}if(a._spreadsheet.activeSheet.data.isColHiddenByUser(t-1)){var i=a._rowcolAccessor.getColSetWidth(t);a._renderTriangleGraphics(n.RIGHT,r,0,i,a._headSize.colHeadHeight)}},a._showCol=function(e,t){var r,n;if(t>0){var o=Math.min(a._spreadsheet.activeSheet.getColCount()-1,Object(_.a)(a._spreadsheet.activeSheet,e,1));-1===o?(r=e+1,n=a._spreadsheet.activeSheet.getColCount()-1):(r=e+1,n=o-1)}else{var i=Object(_.a)(a._spreadsheet.activeSheet,e,-1);-1===i?(r=0,n=e-1):(r=i+1,n=e-1)}a._modifySelectionBroker.setSelection({xRange:[r,n],activation:{row:0,col:r}}),a._modifyDimensionBroker.showCols([{index:r,amount:n-r+1}])},a._showRow=function(e,t){var r,n;if(t>0){var o=Math.min(a._spreadsheet.activeSheet.getRowCount()-1,Object(_.b)(a._spreadsheet.activeSheet,e,1));-1===o?(r=e+1,n=a._spreadsheet.activeSheet.getRowCount()-1):(r=e+1,n=o-1)}else{var i=Object(_.b)(a._spreadsheet.activeSheet,e,-1);-1===i?(r=0,n=e-1):(r=i+1,n=e-1)}a._modifySelectionBroker.setSelection({yRange:[r,n],activation:{row:r,col:0}}),a._modifyDimensionBroker.showRows([{index:r,amount:n-r+1}])},a._spreadsheet=e.spreadsheet,a._rowcolAccessor=e.rowcolAccessor,a._hoverBackgroundCollect=a._alloyExcel.collectEngine.get("cover-background"),a._triangleCollect=a._alloyExcel.collectEngine.generateCollector(f.c.GraphicsRender,f.a.RowColTriangle),a._alloyExcel.collectEngine.add("hide-show-triangle",a._triangleCollect),a._areaData=e.areaData,a._renderApi=e.renderApi,a._headSize=e.headSize,a._modifyDimensionBroker=e.modifyDimensionBroker,a._modifySelectionBroker=e.modifySelectionBroker,a._operateData=e.operateData,a._scale=e.scale,a._sheetStatus=e.sheetStatus,a._alloyExcel.emitter.on(d.a.EVENT.AFTER_ROW_HEAD_RENDER,a.renderAfterRow),a._alloyExcel.emitter.on(d.a.EVENT.AFTER_COL_HEAD_RENDER,a.renderAfterCol);var i=e.mouseOperate;i&&new v({mouseOperate:i,operateData:a._operateData,spreadsheet:a._spreadsheet,areaData:a._areaData,rowcolAccessor:a._rowcolAccessor,scale:a._scale,headSize:a._headSize,sheetStatus:a._sheetStatus,renderRowHead:a._renderApi.renderRowHead.bind(a._renderApi),renderColHead:a._renderApi.renderColHead.bind(a._renderApi),colIconDown:a._showCol,rowIconDown:a._showRow});var s=e.touchOperate;return s&&new b({touchOperate:s,operateData:a._operateData,spreadsheet:a._spreadsheet,areaData:a._areaData,rowcolAccessor:a._rowcolAccessor,scale:a._scale,headSize:a._headSize,colIconDown:a._showCol,rowIconDown:a._showRow}),a}return Object(i.a)(r,[{key:"_checkHover",value:function(e,t,r,n){return this._operateData.currX>=e&&this._operateData.currX<=e+r&&this._operateData.currY>=t&&this._operateData.currY<=t+n}},{key:"_renderHover",value:function(e,t,r,a,o){if(this._checkHover(t,r,a,o)){var i=[t,r,t+a,r,t+a,r+o,t,r+o],s=[t,r+o,t,r,t+a,r,t+a,r+o,t,r+o];switch(this._hoverBackgroundCollect.collect({color:"#ffffff",graphicsInfo:{path:i}}),this._alloyExcel.collectEngine.lineCollector.collect({line:s,lineProp:{color:h.a.newInstanceByHex("#d4d4d4"),style:p.a.THIN,width:null}}),e){case n.TOP:i=[t,r+o,t+a,r+o,t+a,r+2*o,t,r+2*o],s=[t,r+2*o,t,r+o,t+a,r+o,t+a,r+2*o,t,r+2*o];break;case n.RIGHT:i=[t-a,r,t,r,t,r+o,t-a,r+o],s=[t-a,r+o,t-a,r,t,r,t,r+o,t-a,r+o];break;case n.BOTTOM:i=[t,r-o,t+a,r-o,t+a,r,t,r],s=[t,r,t,r-o,t+a,r-o,t+a,r,t,r];break;case n.LEFT:i=[t+a,r,t+2*a,r,t+2*a,r+o,t+a,r+o],s=[t+a,r+o,t+a,r,t+2*a,r,t+2*a,r+o,t+a,r+o]}return this._hoverBackgroundCollect.collect({color:"#ffffff",graphicsInfo:{path:i}}),this._alloyExcel.collectEngine.lineCollector.collect({line:s,lineProp:{color:h.a.newInstanceByHex("#d4d4d4"),style:p.a.THIN,width:null}}),!0}return!1}},{key:"_renderTriangleGraphics",value:function(e,t,r,o,i){var s=[];switch(e){case n.TOP:s.push(w[0]+w[2]/2,r+i-w[3]-w[4],w[0]+w[2],r+i-w[4],w[0],r+i-w[4]),this._renderHover.apply(this,[e].concat(Object(a.a)(Object(_.d)(e,r,i))));break;case n.RIGHT:s.push(t+w[3]+w[4],w[1]+w[2]/2,t+w[4],w[1]+w[2],t+w[4],w[1]),this._renderHover.apply(this,[e].concat(Object(a.a)(Object(_.c)(e,t,o))));break;case n.BOTTOM:s.push(w[0]+w[2]/2,r+w[3]+w[4],w[0],r+w[4],w[0]+w[2],r+w[4]),this._renderHover.apply(this,[e].concat(Object(a.a)(Object(_.d)(e,r,i))));break;case n.LEFT:s.push(t+o-w[3]-w[4],w[1]+w[2]/2,t+o-w[4],w[1],t+o-w[4],w[1]+w[2]),this._renderHover.apply(this,[e].concat(Object(a.a)(Object(_.c)(e,t,o))))}this._triangleCollect.collect({color:this._color.hex,graphicsInfo:{path:s}})}}]),r}(u.a);t.c=E},"./src/core/view/level-2/dimension-edit/hide-show-head/utils.ts":function(e,t,r){"use strict";r.d(t,"b",(function(){return a})),r.d(t,"a",(function(){return o})),r.d(t,"c",(function(){return i})),r.d(t,"d",(function(){return s})),r.d(t,"f",(function(){return l})),r.d(t,"e",(function(){return c}));var n=r("./src/core/view/level-2/dimension-edit/hide-show-head/HideShowHead.ts");function a(e,t,r){if(-1===r){for(t-=1;t>=0;t-=1)if(!e.data.isRowHidden(t))return t}else{var n=e.getRowCount();for(t+=1;t<n;t+=1)if(!e.data.isRowHidden(t))return t}return-1}function o(e,t,r){if(-1===r){for(t-=1;t>=0;--t)if(!e.data.isColHidden(t))return t}else{var n=e.getColCount();for(t+=1;t<n;++t)if(!e.data.isColHidden(t))return t}return-1}function i(e,t,r){return e===n.a.RIGHT?[t,n.b[1],n.b[3],n.b[2]]:[t+r-n.b[3],n.b[1],n.b[3],n.b[2]]}function s(e,t,r){return e===n.a.TOP?[n.b[0],t+r-n.b[3],n.b[2],n.b[3]]:[n.b[0],t,n.b[2],n.b[3]]}function l(e,t){for(var r=1;e.data.isRowHidden(t-r)&&t-r>=0;){if(e.data.isRowHiddenByUser(t-r))return!0;r+=1}return!1}function c(e,t){for(var r=1;e.data.isRowHidden(t+r)&&t+r<e.getRowCount();){if(e.data.isRowHiddenByUser(t+r))return!0;r+=1}return!1}},"./src/core/view/level-2/render-plugin/BaseRenderPlugin.ts":function(e,t,r){"use strict";var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../packages/lib/EventEmitter.ts");t.a=function e(t){Object(n.a)(this,e),this.emitter=new a.a,this._alloyExcel=t.alloyExcel}},"./src/core/view/level-2/shape-upload/ShapeUpload.ts":function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"VIP_IMG_SIZE_LIMIT",(function(){return E})),r.d(t,"ShapeType",(function(){return n})),r.d(t,"ImageUploadErrorType",(function(){return a}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.object.assign.js");var n,a,o=r("../node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),i=(r("../node_modules/regenerator-runtime/runtime.js"),r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js")),s=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),l=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),c=r("./src/core/ui/toast/toast.tsx"),u=r("./src/core/ui/toast/index.ts"),d=r("../node_modules/axios/index.js"),h=r.n(d),f=r("./src/core/view/level-2/shape-upload/utils.ts"),p=r("./src/base/util/timer.ts"),_=r("../packages/report/src/index.ts"),m=r("./src/base/event/event.ts"),v=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),g=r.n(v),b=r("../node_modules/@tencent/docs-scenario-components-mobile-camera/dist/index.js"),y=r("../node_modules/qs/lib/index.js"),w=r.n(y),R=r("./src/core/ui/loading/index.ts"),E=10485760;!function(e){e[e.CELL=0]="CELL",e[e.FLOAT=1]="FLOAT"}(n||(n={})),function(e){e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.FILESIZE_EXCEEDED_ERROR=2]="FILESIZE_EXCEEDED_ERROR",e[e.UNKNOWN_ERROR=3]="UNKNOWN_ERROR"}(a||(a={}));var C=function(){function t(e){Object(s.a)(this,t),this._modifyShapeBroker=e.modifyShapeBroker}return Object(l.a)(t,[{key:"showErrorNotice",value:function(e){switch(e){case"Network Error":return Object(c.showToast)("\u7f51\u7edc\u5f02\u5e38\uff0c\u79bb\u7ebf\u7f16\u8f91\u4e2d\uff0c\u5f53\u524d\u65e0\u6cd5\u4e0a\u4f20\u56fe\u7247\u3002",void 0,{showCloseBtn:!0}),a.NETWORK_ERROR;case"Not vip":return a.FILESIZE_EXCEEDED_ERROR;default:return Object(c.showToast)("\u6587\u4ef6\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20\u56fe\u7247\u3002",void 0,{toolToastCloseTime:5e3}),a.UNKNOWN_ERROR}}},{key:"insertShape",value:function(){var t=Object(i.a)(regeneratorRuntime.mark((function t(r,a,o){var i,s,l,c,u,d,h,f,p,_,m=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=m.length>3&&void 0!==m[3]?m[3]:{},s=m.length>4?m[4]:void 0,l=i.capture,c=void 0!==l&&l,u=i.callback,t.next=5,this._uploadImage(c,u);case 5:if(null!==(d=t.sent)){t.next=8;break}return t.abrupt("return");case 8:h=Object.assign(d,{x:o,y:a,sheetId:r}),s===n.CELL?(f=e.SpreadsheetApp,p=f.spreadsheet.getActiveSheetId(),(null===(_=R.b.getInstance(a,o,p))||void 0===_?void 0:_.isValid)&&this._modifyShapeBroker.insertImage(h,!0),R.b.removeInstance(a,o,p)):this._modifyShapeBroker.insertImage(h);case 10:case"end":return t.stop()}}),t,this)})));return function(e,r,n){return t.apply(this,arguments)}}()},{key:"handleImage",value:function(){var t=Object(i.a)(regeneratorRuntime.mark((function t(r,n){var a,i,s,l,d,v,g,b,y,w,R,E,C,j,O,S,D,x,k;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=Object(f.c)(),!(r.size>20971520)){t.next=4;break}throw Object(c.showToast)("\u8bf7\u9009\u62e920M\u4ee5\u5185\u7684\u56fe\u7247\u63d2\u5165",void 0,{toolToastCloseTime:5e3}),Error("File too large");case 4:return i=r.size,s=Date.now(),l=window,d=l.spreadConfig,t.prev=7,t.next=11,Object(u.showVipToast)({errorCode:70002,fileSize:i,source:n?"picture_Paste":"picture_insect_menu"});case 11:if(!t.sent){t.next=14;break}throw Error("Not vip");case 14:return t.next=16,Object(f.a)(r);case 16:return v=t.sent,g=v.file,b=Object(o.a)(v,["file"]),y=b.width,w=void 0===y?400:y,R=b.height,E=void 0===R?400:R,C="/ep/api/attach_local?globalPadId=".concat(d.getConfig("globalPadId")),j="".concat(location.hostname,"_").concat(d.getConfig("padId"),"_").concat(d.getConfig("userId"),"_").concat(+new Date),(O=new FormData).append("file",g),S=g.size,t.next=27,h.a.post(C,O,{responseType:"json"});case 27:if(D=t.sent,x=D.data.url){t.next=32;break}throw _.b.monitor(34609503),Error("Uploaded image has no URL!");case 32:k=w/E,w>E?w>400&&(E=(w=400)/k):E>400&&(w=(E=400)*k);try{p.a.wait(500).run((function(){m.c.toolBar.trigger("upload-image-successed",{url:x,key:j,id:a,replaceHolder:!0})})),_.b.tdwReport({opername:"doc_excel",module:"pic",action:"updown_succe",ver2:void 0,ver3:void 0,ver4:w,ver5:E,ver6:i,ver7:S,ver8:Date.now()-s})}catch(T){}return t.abrupt("return",{url:x,id:a,width:w,height:E});case 38:throw t.prev=38,t.t0=t.catch(7),e.log.error(t.t0.message),this.showErrorNotice(t.t0.message),_.b.tdwReport({opername:"doc_excel",module:"pic",action:"updown_fail",ver2:void 0,ver3:void 0,ver4:void 0,ver5:void 0,ver6:i,ver7:void 0,ver8:Date.now()-s}),t.t0;case 44:case"end":return t.stop()}}),t,this,[[7,38]])})));return function(e,r){return t.apply(this,arguments)}}()},{key:"noneVipToast",value:function(t){var r,n;return t>E&&!((null===(r=e.clientVars.vipInfo)||void 0===r?void 0:r.isVip)||(null===(n=e.clientVars.vipInfo)||void 0===n?void 0:n.is_vip))}},{key:"handleImageLink",value:function(){var e=Object(i.a)(regeneratorRuntime.mark((function e(t){var r,n,a,o,i,s,l,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"/v1/image/trans_outer",r=window,n=r.spreadConfig,e.prev=2,e.next=5,h.a.post("/v1/image/trans_outer",w.a.stringify({url:t,globalPadId:n.getConfig("globalPadId")}));case 5:if(a=e.sent,o=a.data,i=o.url,s=o.width,l=o.height,c=o.file_size,i){e.next=9;break}throw{fileSize:-1};case 9:if(!(c>2*E||this.noneVipToast(c))){e.next=11;break}throw{fileSize:c};case 11:return e.abrupt("return",{url:i,id:Object(f.c)(),width:s,height:l});case 14:throw e.prev=14,e.t0=e.catch(2),{fileSize:e.t0.fileSize||-1};case 17:case"end":return e.stop()}}),e,this,[[2,14]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_uploadImage",value:function(){var t=Object(i.a)(regeneratorRuntime.mark((function t(r,n){var a,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a=r&&g.a.isMobile?b.pickImageFromCamera:b.pickImageFromFile,t.next=4,a();case 4:if(!((o=t.sent).size>20971520)){t.next=8;break}return Object(c.showToast)("\u56fe\u7247\u8d85\u51fa20M\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20\u5408\u9002\u7684\u56fe\u7247\u3002",void 0,{toolToastCloseTime:5e3}),t.abrupt("return",null);case 8:return null===n||void 0===n||n("start"),t.next=11,this.handleImage(o);case 11:return t.abrupt("return",t.sent);case 14:throw t.prev=14,t.t0=t.catch(0),e.log.error(null===t.t0||void 0===t.t0?void 0:t.t0.message),Error("uploadImage unknown error");case 18:return t.prev=18,null===n||void 0===n||n("end"),t.finish(18);case 21:case"end":return t.stop()}}),t,this,[[0,14,18,21]])})));return function(e,r){return t.apply(this,arguments)}}()}]),t}();t.default=C}.call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/view/level-2/shape-upload/utils.ts":function(e,t,r){"use strict";r.d(t,"c",(function(){return a})),r.d(t,"b",(function(){return o})),r.d(t,"a",(function(){return i}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.array-buffer.constructor.js"),r("../node_modules/core-js/modules/es.array-buffer.slice.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/core-js/modules/es.typed-array.uint8-array.js"),r("../node_modules/core-js/modules/es.typed-array.copy-within.js"),r("../node_modules/core-js/modules/es.typed-array.every.js"),r("../node_modules/core-js/modules/es.typed-array.fill.js"),r("../node_modules/core-js/modules/es.typed-array.filter.js"),r("../node_modules/core-js/modules/es.typed-array.find.js"),r("../node_modules/core-js/modules/es.typed-array.find-index.js"),r("../node_modules/core-js/modules/es.typed-array.for-each.js"),r("../node_modules/core-js/modules/es.typed-array.includes.js"),r("../node_modules/core-js/modules/es.typed-array.index-of.js"),r("../node_modules/core-js/modules/es.typed-array.iterator.js"),r("../node_modules/core-js/modules/es.typed-array.join.js"),r("../node_modules/core-js/modules/es.typed-array.last-index-of.js"),r("../node_modules/core-js/modules/es.typed-array.map.js"),r("../node_modules/core-js/modules/es.typed-array.reduce.js"),r("../node_modules/core-js/modules/es.typed-array.reduce-right.js"),r("../node_modules/core-js/modules/es.typed-array.reverse.js"),r("../node_modules/core-js/modules/es.typed-array.set.js"),r("../node_modules/core-js/modules/es.typed-array.slice.js"),r("../node_modules/core-js/modules/es.typed-array.some.js"),r("../node_modules/core-js/modules/es.typed-array.sort.js"),r("../node_modules/core-js/modules/es.typed-array.subarray.js"),r("../node_modules/core-js/modules/es.typed-array.to-locale-string.js"),r("../node_modules/core-js/modules/es.typed-array.to-string.js"),r("../node_modules/regenerator-runtime/runtime.js");var n=r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js");function a(){return"attachment-".concat(Date.now(),"-").concat(function(e){var t,r="";for(e=void 0!==e?e:4,t=0;t<e;t++)r+=Math.floor(65536*(1+Math.random())).toString(16).substring(1);return r}())}var o=function(e){var t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var r=e.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(t.length),a=new Uint8Array(n),o=0;o<t.length;o++)a[o]=t.charCodeAt(o);return new Blob([n],{type:r})},i=function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(t){var r,n,a,i,s,l,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Image,e.prev=1,e.next=4,new Promise((function(e,r){var n=new FileReader;n.onload=function(){return e(n.result)},n.onerror=function(){return r(n.error)},n.readAsDataURL(t)}));case 4:return n=e.sent,e.next=7,new Promise((function(e,t){r.style.imageOrientation="from-image",r.onload=e,r.onerror=t,r.src=n}));case 7:e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(1),console.warn("autoRotateAndShrink image load error",e.t0),e.abrupt("return",{file:t});case 13:if(a=r.naturalWidth,i=r.naturalHeight,a&&i){e.next=17;break}return e.abrupt("return",{file:t});case 17:if("image/gif"!==t.type){e.next=19;break}return e.abrupt("return",{file:t,width:a,height:i});case 19:return c=(s=i>3*a)?i:4096,a>(l=s?1024:4096)&&(i=Math.max(1,Math.round(i/a*l)),a=l),i>c&&(a=Math.max(1,Math.round(a/i*c)),i=c),(u=document.createElement("canvas")).width=a,u.height=i,u.getContext("2d").drawImage(r,0,0,a,i),t=o(u.toDataURL(t.type,.8)),e.abrupt("return",{file:t,width:a,height:i});case 31:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}()},"./src/core/view/lib/mutex-management/MutexManagment.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));r("../node_modules/core-js/modules/es.array.find-index.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.splice.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n,a,o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),i=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),l=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),c=r.n(l);!function(e){e.SELECTION="selection",e.FORMULA_SELECTION="formulaSelection",e.SHAPE="shape",e.CHART="chart",e.CARD_CENTER="cardCenter",e.CONTEXT_MENU="contextMenu",e.INPUT="input",e.VALIDATION_LIST="validationList",e.ERROR_TIP_PANEL="errorTipPanel",e.SELECT_LIST="selectList",e.CUSTOM_CELL_EDITOR="customCellEditor",e.VALIDATION_LIST_HEADER="validationListHeader"}(a||(a={}));var u=a,d=(n={},Object(s.a)(n,u.CHART,[u.SELECTION,u.SHAPE,u.CUSTOM_CELL_EDITOR]),Object(s.a)(n,u.SELECTION,[u.SHAPE,u.CHART]),Object(s.a)(n,u.FORMULA_SELECTION,[u.SHAPE,u.CHART]),Object(s.a)(n,u.INPUT,c.a.isPC?[u.CARD_CENTER]:[u.SELECTION,u.CARD_CENTER]),Object(s.a)(n,u.SELECT_LIST,[u.CARD_CENTER,u.CONTEXT_MENU,u.VALIDATION_LIST]),Object(s.a)(n,u.CONTEXT_MENU,c.a.isPC?[u.CARD_CENTER,u.SELECT_LIST]:[u.CARD_CENTER]),Object(s.a)(n,u.VALIDATION_LIST,[u.CARD_CENTER]),Object(s.a)(n,u.SHAPE,c.a.isPC?[u.SELECTION,u.CHART,u.INPUT,u.CUSTOM_CELL_EDITOR]:[u.SELECTION,u.CHART,u.CUSTOM_CELL_EDITOR]),Object(s.a)(n,u.ERROR_TIP_PANEL,[u.CARD_CENTER,u.CONTEXT_MENU,u.VALIDATION_LIST]),Object(s.a)(n,u.CUSTOM_CELL_EDITOR,[u.VALIDATION_LIST_HEADER]),n),h=function(){function e(){Object(o.a)(this,e),this._mutexRelations=d,this._mutexComponents={}}return Object(i.a)(e,[{key:"addMutexComponent",value:function(e,t){void 0===this._mutexComponents[e]&&(this._mutexComponents[e]=[]),this._mutexComponents[e].push(t)}},{key:"removeMutexComponent",value:function(e,t){var r=this._mutexComponents[e];if(r){var n=r.findIndex((function(e){return e===t}));n<0||r.splice(n,1)}}},{key:"mutexShow",value:function(e){var t,r=this;null===(t=this._mutexRelations[e])||void 0===t||t.forEach((function(e){var t;null===(t=r._mutexComponents[e])||void 0===t||t.forEach((function(e){e.mutexHide()}))}))}}]),e}();t.b=h},"./src/core/view/lib/tap-support.ts":function(e,t,r){"use strict";function n(e){e.addEventListener("touchstart",(function(t){var r=t.touches[0];this.touchX=r.clientX,this.touchY=r.clientY,this.touchT=Date.now(),this.longTapTick=window.setTimeout((function(){if(e.onLongTap)e.onLongTap();else{var t=document.createEvent("HTMLEvents");t.initEvent("longTap",!1,!0),e.dispatchEvent(t)}}),500)})),e.addEventListener("touchmove",(function(e){e.preventDefault();var t=e.touches[0],r=t.clientX,n=t.clientY;(Math.abs(n-this.touchY)>5||Math.abs(r-this.touchX)>5)&&window.clearTimeout(this.longTapTick)})),e.addEventListener("touchend",(function(t){var r=t.changedTouches[0],n=r.clientX,a=r.clientY;if(window.clearTimeout(this.longTapTick),!(void 0===this.touchT||Math.abs(a-this.touchY)>30||Math.abs(n-this.touchX)>30)&&!(t.touches.length>0)&&Date.now()<=this.touchT+250)if(e.ontap)e.ontap();else{var o=document.createEvent("HTMLEvents");o.initEvent("tap",!1,!0),o.x=n,o.y=a,o.originEvent=t,e.dispatchEvent(o)}}))}r.d(t,"a",(function(){return n}))},"./src/core/view/spreadsheet-view/accessor/BaseCellAccessor.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.splice.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js");var n=r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),i=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),s=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js");function l(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var c=function(e){Object(o.a)(r,e);var t=l(r);function r(e){var o;return Object(a.a)(this,r),(o=t.call(this,e))._handleInsertCol=function(e){for(var t=Object.keys(o._rowData),r=0;r<t.length;r++)for(var a=t[r],i=o._rowData[a],s=0;s<i.length;s++){var l;i[s]&&(e.index>=i[s].length?i[s].length=e.index+e.amount:(l=i[s]).splice.apply(l,[e.index,0].concat(Object(n.a)(new Array(e.amount)))))}},o._handleDeleteCol=function(e){for(var t=Object.keys(o._rowData),r=0;r<t.length;r++)for(var n=t[r],a=o._rowData[n],i=0;i<a.length;i++)a[i]&&(e.index>=a[i].length?a[i].length=e.index+e.amount:a[i].splice(e.index,e.amount))},o._dataCallView=e.dataCallView,o._register(o._dataCallView.onInsertCol(o._handleInsertCol)),o._register(o._dataCallView.onDeleteCol(o._handleDeleteCol)),o}return r}(r("./src/core/view/spreadsheet-view/accessor/BaseRowAccessor.ts").a);t.a=c},"./src/core/view/spreadsheet-view/accessor/BaseRowAccessor.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.splice.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js");var n=r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),i=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),s=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js");function l(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var c=function(e){Object(o.a)(r,e);var t=l(r);function r(e){var o;return Object(a.a)(this,r),(o=t.call(this))._rowData={},o._handleInsertRow=function(e){for(var t,r=Object.keys(o._rowData),a=0;a<r.length;a++){var i;if(t=r[a],e.index>=o._rowData[t].length)return void(o._rowData[t].length=e.index+e.amount);(i=o._rowData[t]).splice.apply(i,[e.index,0].concat(Object(n.a)(new Array(e.amount))))}},o._handleDeleteRow=function(e){for(var t,r=Object.keys(o._rowData),n=0;n<r.length;n++){if(t=r[n],e.index>=o._rowData[t].length)return;o._rowData[t].splice(e.index,e.amount)}},o._dataCallView=e.dataCallView,o._register(o._dataCallView.onInsertRow(o._handleInsertRow)),o._register(o._dataCallView.onDeleteRow(o._handleDeleteRow)),o}return r}(r("../packages/services/src/dispose.ts").a);t.a=c},"./src/core/view/spreadsheet-view/area-data/area/BaseArea.ts":function(e,t,r){"use strict";r.d(t,"b",(function(){return u}));r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),i=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),s=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),l=r("../packages/lib/index.ts");function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}function u(e){for(var t=e.length-1;t>0;t--)if(e[t-1]<e[t])return t-1;return t}var d=function(e){Object(o.a)(r,e);var t=c(r);function r(){var e;return Object(n.a)(this,r),(e=t.call(this))._displayOffsetSize=0,e._displayViewSize=0,e._displaySafeDistance=0,e._displayContentSize=0,e._displayPadding=0,e._onUpdateOffset=new l.a,e.onUpdateOffset=e._onUpdateOffset.event,e._onUpdateViewSize=new l.a,e.onUpdateViewSize=e._onUpdateViewSize.event,e._onUpdateTotalSize=new l.a,e.onUpdateTotalSize=e._onUpdateTotalSize.event,e._onUpdatePadding=new l.a,e.onUpdatePadding=e._onUpdatePadding.event,e}return Object(a.a)(r,[{key:"isValid",value:function(){return this._displayTotalSize>0}},{key:"refresh",value:function(){this._displayOffsetSize=0,this._displayContentSize=0,this._displayViewSize=0}},{key:"_displayTotalSize",get:function(){return this._displayContentSize+this._displaySafeDistance}},{key:"_maxDisplayOffsetSize",get:function(){return Math.max(0,this._displayTotalSize+this._displayPadding-this._displayViewSize)}},{key:"displayTotalSize",get:function(){return this._displayTotalSize}},{key:"displayContentSize",get:function(){return this._displayContentSize},set:function(e){this._displayContentSize!==e&&(this._displayContentSize=e,this._onUpdateTotalSize.fire(this._displayTotalSize))}},{key:"displaySafeDistance",get:function(){return this._displaySafeDistance},set:function(e){this._displaySafeDistance!==e&&(this._displaySafeDistance=e,this._onUpdateTotalSize.fire(this._displayTotalSize))}},{key:"displayOffsetSize",get:function(){return this._displayOffsetSize},set:function(e){var t=this._maxDisplayOffsetSize;if(this._displayOffsetSize!==e){e<0&&(e=0),e>t&&(e=t);var r=e-this._displayOffsetSize;this._displayOffsetSize=e,this._onUpdateOffset.fire(r)}}},{key:"displayViewSize",get:function(){return this._displayViewSize},set:function(e){this._displayViewSize!==e&&(this._displayViewSize=e,this._onUpdateViewSize.fire(this._displayViewSize))}},{key:"displayPadding",get:function(){return this._displayPadding},set:function(e){this._displayPadding!==e&&(this._displayPadding=e,this._onUpdatePadding.fire(e))}}]),r}(r("../packages/services/src/dispose.ts").a);t.a=d},"./src/core/view/spreadsheet-view/area-data/area/ColArea.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("../node_modules/@babel/runtime/helpers/esm/get.js"),i=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),s=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),l=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),c=r("./src/core/view/spreadsheet-view/area-data/area/BaseArea.ts");function u(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var d=function(t){Object(i.a)(s,t);var r=u(s);function s(t){var a;return Object(n.a)(this,s),(a=r.call(this))._renderFrom=0,a._renderTo=0,a._from=0,a._to=0,a._areaLeft=[],a._originalOffsetSize=0,a._originalViewSize=0,a._originalSafeDistance=0,a._originalContentSize=0,a._originalPadding=0,a._colOffsetDiff=0,a.adjustOffset=function(t){var r=e.devicePixelRatio,n=a._scale.scale*r,o=t-a._originalOffsetSize,i=Math.abs(o),s=Math.ceil(i*n)/n;return o>0?a._originalOffsetSize+s:a._originalOffsetSize-s},a._calcFromTo=function(){var e,t=a._to-a._from;for(a._renderFrom=a._from,e=1;e<t+1;e++)if(a._originalOffsetSize<a._areaLeft[e]){a._renderFrom=a._from+e-1;break}for(var r=a._originalViewSize-a._originalPadding;e<=a._to;e++)if(a._originalOffsetSize+r<=a._areaLeft[e])return void(a._renderTo=a._from+e-1);a._renderTo=a._to},a._scale=t.scale,a._register(a._scale.onScale((function(){a._originalSafeDistance=a._displaySafeDistance/a._scale.scale}))),a}return Object(a.a)(s,[{key:"set",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=0;this._areaLeft.length=0;for(var o=t;o<=r;o++)this._areaLeft.push(a),e.isColHidden(o)||(a+=e.getColSetWidth(o));this._areaLeft.push(a),a>0&&(a+=n),this._from=t,this._to=r,this._calcFromTo(),this._originalContentSize=a,this.displayContentSize=a*this._scale.scale}},{key:"checkOffset",value:function(){this._originalOffsetSize>this._maxOffsetSize&&(this.offsetSize=this._maxOffsetSize),this.setDisplayPadding(this._displayPadding)}},{key:"setDisplayPadding",value:function(e){this._originalPadding=e/this._scale.scale,this.displayPadding=e,this._calcFromTo()}},{key:"setDisplaySafeDistance",value:function(e){this._originalSafeDistance=e/this._scale.scale,this.displaySafeDistance=e}},{key:"getAreaLeft",value:function(e){return this._areaLeft[e]}},{key:"getLastColInView",value:function(){return this._renderFrom+Object(c.b)(this._areaLeft)}},{key:"refresh",value:function(){this._originalOffsetSize=0,this._originalContentSize=0,this._originalViewSize=0,this._renderFrom=0,this._renderTo=0,Object(o.a)(Object(l.a)(s.prototype),"refresh",this).call(this)}},{key:"_originalTotalSize",get:function(){return this._originalContentSize+this._originalSafeDistance}},{key:"_maxOffsetSize",get:function(){return Math.max(0,this._originalTotalSize+this._originalPadding-this._originalViewSize)}},{key:"from",get:function(){return this._from}},{key:"to",get:function(){return this._to}},{key:"colCount",get:function(){return this._to-this._from+1}},{key:"renderFrom",get:function(){return this._renderFrom}},{key:"renderTo",get:function(){return this._renderTo}},{key:"viewSize",get:function(){return this._originalViewSize},set:function(e){e<0&&(e=0),this._originalViewSize!==e&&(this._originalViewSize=e,this._calcFromTo()),this.displayViewSize=e*this._scale.scale}},{key:"totalSize",get:function(){return this._originalTotalSize}},{key:"originContentSize",get:function(){return this._originalContentSize}},{key:"offsetSize",get:function(){return this._originalOffsetSize},set:function(e){e=this.adjustOffset(e);var t=this._maxOffsetSize;e<0&&(e=0),e>t&&(e=t),this._originalOffsetSize!==e?(this._colOffsetDiff=e-this._originalOffsetSize,this._originalOffsetSize=e,this._calcFromTo()):this._colOffsetDiff=0,this.displayOffsetSize=e*this._scale.scale}},{key:"padding",get:function(){return this._originalPadding}},{key:"areaLeft",get:function(){return this._areaLeft}},{key:"colOffsetDiff",get:function(){return this._colOffsetDiff},set:function(e){this._colOffsetDiff=e}},{key:"originalSafeDistance",get:function(){return this._originalSafeDistance}}]),s}(c.a);t.a=d}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/view/spreadsheet-view/area-data/area/RowArea.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("../node_modules/@babel/runtime/helpers/esm/get.js"),i=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),s=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),l=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),c=r("./src/core/view/spreadsheet-view/area-data/area/BaseArea.ts");function u(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var d=function(t){Object(i.a)(s,t);var r=u(s);function s(t){var a;return Object(n.a)(this,s),(a=r.call(this))._renderFrom=0,a._renderTo=0,a._from=0,a._to=0,a._areaTop=[],a._originalOffsetSize=0,a._originalViewSize=0,a._originalSafeDistance=0,a._originalContentSize=0,a._originalPadding=0,a._rowOffsetDiff=0,a.adjustOffset=function(t){var r=e.devicePixelRatio,n=a._scale.scale*r,o=t-a._originalOffsetSize,i=Math.abs(o),s=Math.ceil(i*n)/n;return o>0?a._originalOffsetSize+s:a._originalOffsetSize-s},a._calcFromTo=function(){var e,t=a._to-a._from;for(a._renderFrom=a._from,e=1;e<t+1;e++)if(a._originalOffsetSize<a._areaTop[e]){a._renderFrom=a._from+e-1;break}for(var r=a._originalViewSize-a._originalPadding;e<=t;e++)if(a._originalOffsetSize+r<=a._areaTop[e])return void(a._renderTo=a._from+e-1);a._renderTo=a._to},a._scale=t.scale,a._register(a._scale.onScale((function(){a._originalSafeDistance=a._displaySafeDistance/a._scale.scale}))),a}return Object(a.a)(s,[{key:"set",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=0;this._areaTop.length=0;for(var o=t;o<=r;o++)this._areaTop.push(a),e.isRowHidden(o)||(a+=e.getRowDisplayHeight(o));this._areaTop.push(a),a>0&&(a+=n),this._from=t,this._to=r,this._calcFromTo(),this._originalContentSize=a,this.displayContentSize=a*this._scale.scale}},{key:"checkOffset",value:function(){this._originalOffsetSize>this._maxOffsetSize&&(this.offsetSize=this._maxOffsetSize),this.setDisplayPadding(this._displayPadding)}},{key:"setDisplayPadding",value:function(e){this._originalPadding=e/this._scale.scale,this.displayPadding=e,this._calcFromTo()}},{key:"setDisplaySafeDistance",value:function(e){this._originalSafeDistance=e/this._scale.scale,this.displaySafeDistance=e}},{key:"getAreaTop",value:function(e){return this._areaTop[e]}},{key:"getLastRowInView",value:function(){return this._renderFrom+Object(c.b)(this._areaTop)}},{key:"refresh",value:function(){this._originalOffsetSize=0,this._originalContentSize=0,this._originalViewSize=0,this._renderFrom=0,this._renderTo=0,Object(o.a)(Object(l.a)(s.prototype),"refresh",this).call(this)}},{key:"_originalTotalSize",get:function(){return this._originalContentSize+this._originalSafeDistance}},{key:"_maxOffsetSize",get:function(){return Math.max(0,this._originalTotalSize+this._originalPadding-this._originalViewSize)}},{key:"from",get:function(){return this._from}},{key:"to",get:function(){return this._to}},{key:"rowCount",get:function(){return this._to-this._from+1}},{key:"renderFrom",get:function(){return this._renderFrom}},{key:"renderTo",get:function(){return this._renderTo}},{key:"viewSize",get:function(){return this._originalViewSize},set:function(e){e<0&&(e=0),this._originalViewSize!==e&&(this._originalViewSize=e,this._calcFromTo()),this.displayViewSize=e*this._scale.scale}},{key:"totalSize",get:function(){return this._originalTotalSize}},{key:"originContentSize",get:function(){return this._originalContentSize}},{key:"offsetSize",get:function(){return this._originalOffsetSize},set:function(e){e=this.adjustOffset(e);var t=this._maxOffsetSize;e<0&&(e=0),e>t&&(e=t),this._originalOffsetSize!==e?(this._rowOffsetDiff=e-this._originalOffsetSize,this._originalOffsetSize=e,this._calcFromTo()):this._rowOffsetDiff=0,this.displayOffsetSize=e*this._scale.scale}},{key:"padding",get:function(){return this._originalPadding}},{key:"areaTop",get:function(){return this._areaTop}},{key:"rowOffsetDiff",get:function(){return this._rowOffsetDiff},set:function(e){this._rowOffsetDiff=e}},{key:"originalSafeDistance",get:function(){return this._originalSafeDistance}}]),s}(c.a);t.a=d}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/view/spreadsheet-view/model/CellPadding.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));r("../node_modules/core-js/modules/es.array.concat.js");var n,a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js");!function(e){e[e.EMPTY=0]="EMPTY",e[e.TEXT=4]="TEXT",e[e.ICON=26]="ICON"}(n||(n={}));var i=function(){function e(t,r,n,o,i){Object(a.a)(this,e),this.top=t,this.right=r,this.bottom=n,this.left=o,e.pools[i]=this}return Object(o.a)(e,null,[{key:"newInstance",value:function(t,r,n,a){var o="".concat(t,":").concat(r,":").concat(n,":").concat(a),i=e.pools[o];return i||new e(t,r,n,a,o)}}]),e}();i.pools={},t.b=i},"./src/core/view/spreadsheet-view/model/Color.ts":function(e,t,r){"use strict";var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("../packages/model/src/cell/format/colorUtils.ts"),i=function(){function e(t,r,a,o,i){Object(n.a)(this,e),this.red=t,this.green=r,this.blue=a,this.alpha=o,this.hex=i,e.pools[i]=this}return Object(a.a)(e,null,[{key:"newInstanceByRGB",value:function(t,r,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=s(t,r,n,a);return e.pools[o]?e.pools[o]:new e(t,r,n,a,o)}},{key:"newInstanceByHex",value:function(t){t=t.toLowerCase();var r=e.pools[t];if(r)return r;var n=function(e){return Object(o.hex2rgba)(e)}(t);return new e(n.red,n.green,n.blue,n.alpha,t)}}]),e}();function s(e,t,r,n){return Object(o.rgba2hex)(e,t,r,n)}i.pools={},t.a=i},"./src/core/view/spreadsheet-view/model/HorizontalAlign.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n,a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=function(){function e(t){Object(a.a)(this,e),this._value=t}return Object(o.a)(e,[{key:"value",get:function(){return this._value}}],[{key:"newInstance",value:function(t){var r=e.pools[t];return r||(e.pools[t]=new e(t))}}]),e}();i.pools={},function(e){e.LEFT="left",e.CENTER="center",e.RIGHT="right"}(n||(n={})),t.b=i},"./src/core/view/spreadsheet-view/model/TextProp.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.string.trim.js"),r("../node_modules/core-js/modules/es.string.bold.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("./src/core/view/config/default.ts"),i=r("./src/core/view/spreadsheet-view/render-manager/alloy-excel/interface.ts"),s=r("./src/base/helper/font-polyfill.ts"),l=":",c=function(){function e(t){Object(n.a)(this,e),void 0!==t[i.a.COLOR]&&(this[i.a.COLOR]=t[i.a.COLOR]),void 0!==t[i.a.FONT_SIZE]&&(this[i.a.FONT_SIZE]=t[i.a.FONT_SIZE]),void 0!==t[i.a.FONT_FAMILY]&&(this[i.a.FONT_FAMILY]=t[i.a.FONT_FAMILY]),void 0!==t[i.a.BOLD]&&(this[i.a.BOLD]=t[i.a.BOLD]),void 0!==t[i.a.ITALIC]&&(this[i.a.ITALIC]=t[i.a.ITALIC]),void 0!==t[i.a.UNDERLINE]&&(this[i.a.UNDERLINE]=t[i.a.UNDERLINE]),void 0!==t[i.a.STRIKETHROUGH]&&(this[i.a.STRIKETHROUGH]=t[i.a.STRIKETHROUGH])}return Object(a.a)(e,[{key:"_getLineWidth",value:function(e){return e?Math.round(e/15):0}},{key:"hash",get:function(){return"".concat(this.font).concat(l).concat(this.color).concat(l).concat(this._getLineWidth(this.fontSize))}},{key:"font",get:function(){var e="";return this[i.a.ITALIC]&&(e="italic"),this[i.a.BOLD]&&(e="".concat(e," bold")),(e="".concat(e," ").concat(this.fontSize,"pt ").concat(this.fontFamily)).trim()}},{key:"color",get:function(){return this[i.a.COLOR]||e.toRGBA(o.h)}},{key:"fontSize",get:function(){return this[i.a.FONT_SIZE]||o.j}},{key:"fontFamily",get:function(){return this[i.a.FONT_FAMILY]||o.i.value}},{key:"underline",get:function(){return Boolean(this[i.a.UNDERLINE])}},{key:"strikethrough",get:function(){return Boolean(this[i.a.STRIKETHROUGH])}}],[{key:"toRGBA",value:function(e){return"rgba(".concat(e.red,",").concat(e.green,",").concat(e.blue,",").concat(e.alpha,")")}},{key:"toKey",value:function(t){return"{".concat(null!=t.color?e.toRGBA(t.color):"",",").concat(null!=t.fontFamily?t.fontFamily:"",",").concat(null!=t.fontSize?t.fontSize:"",",").concat(t.bold?"1":"",",").concat(t.italic?"1":"",",").concat(t.strikethrough?"1":"",",").concat(t.underline?"1":"","}")}},{key:"newInstance",value:function(t){var r=e.toKey(t),n=e.pools[r];if(!n){var a=Object.create(null);return t.color&&(a[i.a.COLOR]=e.toRGBA(t.color)),t.fontSize&&(a[i.a.FONT_SIZE]=t.fontSize),t.fontFamily&&(a[i.a.FONT_FAMILY]=e.polyfillFontFamilyIfNeed(t.fontFamily)),t.bold&&(a[i.a.BOLD]=1),t.italic&&(a[i.a.ITALIC]=1),t.underline&&(a[i.a.UNDERLINE]=1),t.strikethrough&&(a[i.a.STRIKETHROUGH]=1),e.pools[r]=new e(a)}return n}},{key:"polyfillFontFamilyIfNeed",value:function(e){var t;return(null===(t=e)||void 0===t?void 0:t.replace)&&(e=e.replace(/[\uff08|()].*?[\uff09|)]/g,"")),(e=Object(s.a)(e)).trim()}}]),e}();i.a.COLOR,i.a.FONT_SIZE,i.a.FONT_FAMILY,i.a.BOLD,i.a.ITALIC,i.a.UNDERLINE,i.a.STRIKETHROUGH,c.pools={},t.b=c},"./src/core/view/spreadsheet-view/model/VerticalAlign.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n,a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=function(){function e(t){Object(a.a)(this,e),this._value=t}return Object(o.a)(e,[{key:"value",get:function(){return this._value}}],[{key:"newInstance",value:function(t){var r=e.pools[t];return r||(e.pools[t]=new e(t))}}]),e}();i.pools={},function(e){e.TOP="top",e.MIDDLE="middle",e.BOTTOM="bottom"}(n||(n={})),t.b=i},"./src/core/view/spreadsheet-view/model/WrapStrategy.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n,a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=function(){function e(t){Object(a.a)(this,e),this._value=t}return Object(o.a)(e,[{key:"value",get:function(){return this._value}}],[{key:"newInstance",value:function(t){var r=e.pools[t];return r||(e.pools[t]=new e(t))}}]),e}();i.pools={},function(e){e.NOWRAP="nowrap",e.NORMAL="normal"}(n||(n={})),t.b=i},"./src/core/view/spreadsheet-view/model/line-engine/LineEngine.ts":function(e,t,r){"use strict";r.d(t,"b",(function(){return _}));r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.array.splice.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=r("./src/core/view/spreadsheet-view/model/line-engine/utils.ts"),s=r("./src/core/view/spreadsheet-view/model/line/SimpleParagraph.ts"),l=function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(a.a)(this,e),this.segments=[],(t=this.segments).push.apply(t,Object(n.a)(r));for(var o=0,i=0,s=0;s<r.length;s++)o+=r[s].size.width,i=Math.max(i,r[s].size.height);this.width=o,this.height=i},c=r("./src/core/view/spreadsheet-view/model/line/RichParagraph.ts"),u=r("./src/core/view/spreadsheet-view/transform-table/utils.ts"),d=r("./src/core/view/spreadsheet-view/transform-table/cell.ts"),h=r("../packages/model/src/factory/index.ts"),f=r("./src/base/util/object.ts"),p=function(){function e(){Object(a.a)(this,e)}return Object(o.a)(e,[{key:"nonAutoWrapLine",value:function(e){var t=_(e),r=Object(i.a)(Object(d.f)(e));if(!r)return null;var n=Object(i.d)({cellText:r,textFormatRuns:t,cellData:e});if(1===n.length)return new s.a(n[0]);var a=new l(n);return new c.a([a])}},{key:"autoWrapLine",value:function(e,t){var r=_(e),n=Object(d.f)(e);if(!n||t<=0)return null;for(var a=Object(i.d)({cellText:n,textFormatRuns:r,cellData:e}),o=this._splitLinesByLineFeed(a),u=0;u<o.length;u++){var h=o[u],f=this._splitLinesByWidth(h,t);o[u]=f.completedSegments,f.exceedSegments.length>0&&o.splice(u+1,0,f.exceedSegments)}if(1===o.length&&1===o[0].length)return new s.a(o[0][0]);for(var p=[],m=0;m<o.length;m++){var v=o[m];p.push(new l(v))}return new c.a(p)}},{key:"_splitLinesByLineFeed",value:function(e){var t=[[]];return e.forEach((function(e){var r=e.beforeSplitSegment();(null===r||void 0===r?void 0:r.length)?r.forEach((function(e,r){r>0&&t.push([]),t[t.length-1].push(e)})):t[t.length-1].push(e)})),t}},{key:"_splitLinesByWidth",value:function(e,t){for(var r=[],a=[],o=0,i=0;i<e.length;i++){var s=e[i];if((o+=s.size.width)>t){this._splitLineByWidth(s,o,t,r,a),i+1<e.length&&a.push.apply(a,Object(n.a)(e.slice(i+1,e.length)));break}r.push(s)}return{completedSegments:r,exceedSegments:a}}},{key:"_splitLineByWidth",value:function(e,t,r,n,a){var o=r-(t-e.size.width),i=e.canSplit()?o:r,s=e.splitSegment(i,!n.length);s.frontSegment&&!s.frontSegment.isEmpty()&&n.push(s.frontSegment),s.backSegment&&!s.backSegment.isEmpty()&&a.push(s.backSegment)}}]),e}();function _(e){var t,r=[e.getConditionalFormatResult(),e.getEffectiveFormat(),e.getUserEnteredFormat()],n=e.getTextFormatRuns(),a=function(){return h.TextFormatFactory.createInstance({color:Object(u.a)(r,"getColor"),fontFamily:Object(u.a)(r,"getFontFamily"),fontSize:Object(u.a)(r,"getFontSize"),bold:Object(u.a)(r,"getBold"),italic:Object(u.a)(r,"getItalic"),strikethrough:Object(u.a)(r,"getStrikethrough"),underline:Object(u.a)(r,"getUnderline")})};return(null===(t=n)||void 0===t?void 0:t.length)?n.map((function(e){if(e.format)return e;var t=Object(f.extend)({},e);return t.format=a(),h.TextFormatRunFactory.createInstance(t)})):n=[h.TextFormatRunFactory.createInstance({startIndex:0,format:a()})]}t.a=new p},"./src/core/view/spreadsheet-view/model/line-engine/cutBinary.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r("./src/core/view/spreadsheet-view/model/measurer/Measurer.ts");function a(e,t,r,o,i){var s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],l=e.substr(0,o),c=n.a.measureWidth(l,t,!0);if(0===c||c<=i&&o>=e.length||c>i&&1===l.length&&s)return l;var u=c/l.length*5;if(c<=i&&i-c<u){for(var d=o+1;d<e.length;d++){var h=e.substr(0,d),f=n.a.measureWidth(h,t);if(f>i)break;l=h,c=f}return l}return c>i?a(e,t,r,Math.floor((r+o)/2),i,s):a(e,t,o,Math.floor((o+e.length)/2),i,s)}},"./src/core/view/spreadsheet-view/model/line-engine/utils.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return w})),r.d(t,"b",(function(){return R})),r.d(t,"c",(function(){return C})),r.d(t,"d",(function(){return O}));r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.find.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.object.values.js"),r("../node_modules/core-js/modules/es.regexp.constructor.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=r("./src/core/view/config/default.ts"),o=r("../packages/model/src/factory/index.ts"),i=r("./src/core/view/spreadsheet-view/model/line/segment/MentionSegment.ts"),s=r("./src/core/view/spreadsheet-view/model/TextProp.ts"),l=r("./src/core/view/spreadsheet-view/model/measurer/Measurer.ts"),c=r("./src/core/view/spreadsheet-view/model/line/segment/TextSegmentFactory.ts"),u=r("./src/core/view/spreadsheet-view/model/line/segment/TagSegmentFactory.ts"),d=r("../packages/model/src/cell/metadata/CustomDataType.ts"),h=r("./src/core/view/spreadsheet-view/model/line-engine/cutBinary.ts");function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}String.fromCharCode(10);var _,m=new RegExp(/\s+/),v=new RegExp(/[\u4E00-\u9FA5]+/),g=new RegExp(/[a-zA-Z0-9`~!@#$%^&*()+=[\]{}\\|;:'",./<>?_]+/),b=new RegExp("(".concat(v.source,")|(").concat(g.source,")"));!function(e){e[e.ZH=1]="ZH",e[e.COMBINATION=2]="COMBINATION",e[e.SPACE=3]="SPACE",e[e.OTHER=4]="OTHER"}(_||(_={}));var y={text:""};function w(e){return function(e){return e&&/\n/.test(e)}(e)?e.replace(/\n/g," "):e}function R(e){return e.split(b).filter((function(e){return!!e})).map((function(e){return{text:e,type:E(e)}}))}function E(e){return g.test(e)?_.COMBINATION:m.test(e)?_.SPACE:v.test(e)?_.ZH:_.OTHER}function C(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(t.type===_.SPACE)return[t,y];if(t.type===_.COMBINATION&&!n)return[y,t];var a=Object(h.a)(t.text,e,0,t.text.length,r,n),o=t.text.slice(a.length,t.text.length);return[{text:a,type:t.type},{text:o,type:t.type}]}function j(e,t){if(!t.length)return[{pos:e}];var r=[],n=t.filter((function(t){return e[0]<=t.pos[0]&&t.pos[1]<=e[1]}));if(n.length>0){for(var a,o=e[0],i=0;i<n.length;i++)o<(a=n[i]).pos[0]&&r.push({pos:[o,a.pos[0]]}),r.push({pos:[a.pos[0],a.pos[1]],mention:a}),o=a.pos[1];return o<e[1]&&r.push({pos:[o,e[1]]}),r}return[{pos:e}]}function O(e){var t=function(e){e.cellText,e.textFormatRuns;var t=e.cellData,r=t.getMetadata();if(!r)return null;switch(r.customDataType){case d.o.SELECT:if(!r.config.withColor)return null;var n=t.getRefIds();if(n&&n.length>0){var a=r.config.options;return n.map((function(e){return a.find((function(t){return t.id===e}))})).filter((function(e){return e})).map((function(e){var r,n=e.textColor,a=e.text,o=e.bgColor,i=p(p({},null===(r=t.getUserEnteredFormat())||void 0===r?void 0:r.textFormat),{},{color:n}),c=s.b.newInstance(i);return u.a.newInstance(a,c,{width:l.a.measureWidth(a,c,!0),height:l.a.measureHeight(c)},o)}))}}return null}(e);return t||function(e){var t=e.cellText,r=e.textFormatRuns,n=e.cellData.getMentionDetails(),u=n&&Object.values(n)||[];u.length&&(u=u.sort((function(e,t){return e.pos[0]-t.pos[0]})));for(var d=[],h=r.length,f=0;f<h;f++)for(var _=r[f],m=f+1<h?r[f+1]:null,v=_.format,g=_.startIndex,b=m?m.startIndex:t.length,y=j([g,b],u),w=0;w<y.length;w++){var R=y[w],E=t.substring(R.pos[0],R.pos[1]);if(R.mention){var C=void 0;if(null===v.color||v.color.toHex()!==a.x.TextColor){var O=o.TextFormatFactory.createInstance(p(p({},v),{},{color:"#0188fb"}));C=s.b.newInstance(O)}else C=s.b.newInstance(v);var S=l.a.measureWidth(E,C,!0),D=l.a.measureHeight(C);d.push(new i.a(E,C,{width:S,height:D},R.mention))}else{var x=s.b.newInstance(v),k=l.a.measureWidth(E,x,!0),T=l.a.measureHeight(x);d.push(c.a.newInstance(E,x,{width:k,height:T}))}}return d}(e)}},"./src/core/view/spreadsheet-view/model/line/RichParagraph.ts":function(e,t,r){"use strict";var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js");t.a=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(n.a)(this,e),this.lines=[];for(var r=0,a=0,o=0;o<t.length;o++)r=Math.max(t[o].width,r),a+=t[o].height;this.lines=t,this.width=r,this.height=a}},"./src/core/view/spreadsheet-view/model/line/SimpleParagraph.ts":function(e,t,r){"use strict";var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js");t.a=function e(t){Object(n.a)(this,e),this.segment=t,this.width=this.segment.size.width,this.height=this.segment.size.height}},"./src/core/view/spreadsheet-view/model/line/segment/MentionSegment.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js");var n,a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),s=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),l=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),c=r("./src/core/view/config/default.ts"),u=r("./src/core/view/spreadsheet-view/model/line/segment/Segment.ts");function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}!function(e){e[e.NORMAL=0]="NORMAL",e[e.HOVER=1]="HOVER",e[e.HIGHTLIGHT=2]="HIGHTLIGHT"}(n||(n={}));var h=function(e){Object(i.a)(r,e);var t=d(r);function r(e,n,o,i){var s;return Object(a.a)(this,r),(s=t.call(this,e,n,o)).focusing=!1,s.highlight=!1,s.mention=i,s.size.width=2*c.t.OuterPadding+2*c.t.InnerLeftRightPadding+o.width+c.t.LabelAndTrianglePadding+c.t.TriangleWidth,s.size.height=2*c.t.OuterPadding+c.t.Height,s}return Object(o.a)(r,[{key:"focus",value:function(){this.focusing=!0}},{key:"unfocus",value:function(){this.focusing=!1}},{key:"canSplit",value:function(){return!1}},{key:"splitSegment",value:function(e,t){var r=null,n=null;t?this.size.width>e?(r=this.segmentHardSplit(e).frontSegment,n=null):(r=this,n=null):(r=null,n=this);return{frontSegment:r,backSegment:n}}},{key:"customRender",value:function(e,t,r,n){var a,o={pos:[e+c.t.OuterPadding+c.t.InnerLeftRightPadding,t-c.t.OuterPadding],text:this.text};r&&(o.clipInfo=r),n.textCollector.collect({textInfo:o,textPropHash:this.textProp.hash});var i=Math.round(t-.75*this.size.height)+c.t.OuterPadding,s={radius:c.t.Radius,rect:[c.t.OuterPadding+e,i,this.size.width-2*c.t.OuterPadding,this.size.height-2*c.t.OuterPadding]};r&&(s.clipInfo=r),n.roundRectCollector.collect({roundRectProp:this.getRoundRectRenderProp(),roundRectInfo:s});var l=i-c.t.OuterPadding+(this.size.height-c.t.TriangleHeight)/2,u=[e+this.size.width-c.t.OuterPadding-c.t.InnerLeftRightPadding-c.t.TriangleWidth,l],d={path:this.getTriangleCoordinate(u)};r&&(d.clipInfo=r),null===(a=n.get("mention-triangle"))||void 0===a||a.collect({color:c.x.TriangleColor,graphicsInfo:d})}},{key:"getRoundRectRenderProp",value:function(){return this.focusing?c.v:this.highlight?c.u:c.w}},{key:"segmentHardSplit",value:function(e){var t=this.castToWidth(e);return{frontSegment:new r(t.text,t.textProp,t.size,this.mention),backSegment:null}}},{key:"getTriangleCoordinate",value:function(e){return c.y.map((function(t,r){return t+e[r%2]}))}}]),r}(u.a);t.a=h},"./src/core/view/spreadsheet-view/model/line/segment/Segment.ts":function(e,t,r){"use strict";var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("./src/core/view/spreadsheet-view/model/line-engine/cutBinary.ts"),i=r("./src/core/view/spreadsheet-view/model/measurer/Measurer.ts"),s=function(){function e(t,r,a){Object(n.a)(this,e),this.text=t,this.textProp=r,this.size=a}return Object(a.a)(e,[{key:"isEmpty",value:function(){return!this.text}},{key:"castToWidth",value:function(e){var t=Object(o.a)(this.text,this.textProp,0,this.text.length,e),r=i.a.measureWidth(t,this.textProp),n=i.a.measureHeight(this.textProp);return{text:t,textProp:this.textProp,size:{width:r,height:n}}}},{key:"beforeSplitSegment",value:function(){return null}}]),e}();t.a=s},"./src/core/view/spreadsheet-view/model/line/segment/TagSegment.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),i=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),s=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),l=r("./src/core/view/spreadsheet-view/model/line/segment/Segment.ts"),c=r("./src/core/view/spreadsheet-view/model/line/segment/TagSegmentFactory.ts");function u(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var d=function(e){Object(o.a)(r,e);var t=u(r);function r(e,a,o,i){var s;return Object(n.a)(this,r),(s=t.call(this,e,a,o)).bgColor=i,s.setSize(o),s}return Object(a.a)(r,[{key:"clone",value:function(){return c.a.newInstance(this.text,this.textProp,this.size,this.bgColor)}},{key:"setSize",value:function(e){this.size.width=2*r.MARGIN+2*r.PADDING_X+e.width,this.size.height=2*r.MARGIN+2*r.PADDING_Y+e.height}},{key:"canSplit",value:function(){return!1}},{key:"splitSegment",value:function(e,t){var r=null,n=null;t?this.size.width>e?(r=this.segmentHardSplit(e).frontSegment,n=null):(r=this,n=null):(r=null,n=this);return{frontSegment:r,backSegment:n}}},{key:"segmentHardSplit",value:function(e){var t=e-2*(r.MARGIN+r.PADDING_X),n=this.castToWidth(t),a=n.text,o=n.textProp,i=n.size;return{frontSegment:c.a.newInstance(a,o,i,this.bgColor),backSegment:null}}}]),r}(l.a);d.MARGIN=1,d.PADDING_X=8,d.PADDING_Y=1,d.RADIUS=2},"./src/core/view/spreadsheet-view/model/line/segment/TagSegmentFactory.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));r("../node_modules/core-js/modules/es.array.concat.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("./src/core/view/spreadsheet-view/model/line/segment/TagSegment.ts"),i=function(){function e(){Object(n.a)(this,e)}return Object(a.a)(e,null,[{key:"generateKey",value:function(e,t,r,n){return"".concat(e,",").concat(n&&n.hex)}},{key:"newInstance",value:function(t,r,n,a){var i=e.generateKey(t,r,n,a),s=e.pools[i];return s||(e.pools[i]=new o.a(t,r,n,a))}},{key:"releasePools",value:function(){e.pools={}}}]),e}();i.pools={}},"./src/core/view/spreadsheet-view/model/line/segment/TextSegmentFactory.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.object.values.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n,a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=(r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js")),s=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),l=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),c=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),u=r("./src/core/view/spreadsheet-view/model/line/segment/Segment.ts"),d=r("./src/core/view/spreadsheet-view/model/measurer/Measurer.ts"),h=r("./src/core/view/spreadsheet-view/model/line-engine/utils.ts");function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(l.a)(this,r)}}!function(e){e[e.ZH=1]="ZH",e[e.COMBINATION=2]="COMBINATION",e[e.SPACE=3]="SPACE",e[e.OTHER=4]="OTHER"}(n||(n={}));var p=String.fromCharCode(10),_=function(e){Object(s.a)(r,e);var t=f(r);function r(){return Object(a.a)(this,r),t.apply(this,arguments)}return Object(o.a)(r,[{key:"containLineFeed",value:function(){return!(!this.text||!/\n/.test(this.text))}},{key:"splitByLineFeed",value:function(){if(this.lineFeedSegmentsCache)return this.lineFeedSegmentsCache;var e=this.textProp;return this.lineFeedSegmentsCache=this.text.split(p).map((function(t){var r=d.a.measureWidth(t,e),n=d.a.measureHeight(e);return g.newInstance(t,e,{width:r,height:n})})),this.lineFeedSegmentsCache}},{key:"beforeSplitSegment",value:function(){return this.containLineFeed()?this.splitByLineFeed():[this]}},{key:"canSplit",value:function(){return!0}},{key:"splitSegment",value:function(e,t){var r="".concat(e).concat(String(t));this.splitSegmentCache||(this.splitSegmentCache={});var a=this.splitSegmentCache[r];if(a)return a;for(var o,s,l=Object(h.b)(this.text),c=[],u=[],f=0,p=0;p<l.length;p++){if(o=l[p],!(f+(s=d.a.measureWidth(o.text,this.textProp))<=e||f+s>e&&o.type===n.SPACE)){var _=e-f;if(_>0){var m=Object(h.c)(this.textProp,o,_,t&&!c.length);c.push(m[0]),u.push(m[1]),p+1<l.length&&u.push.apply(u,Object(i.a)(l.slice(p+1,l.length)))}else p<l.length&&u.push.apply(u,Object(i.a)(l.slice(p,l.length)));break}c.push(o),f+=s}var v=c.map((function(e){return e.text})).join(""),b=d.a.measureWidth(v,this.textProp),y=g.newInstance(v,this.textProp,{width:b,height:this.size.height}),w=u.map((function(e){return e.text})).join(""),R=this.size.width-b,E=g.newInstance(w,this.textProp,{width:R,height:this.size.height});return this.splitSegmentCache[r]={frontSegment:y,backSegment:E}}}]),r}(u.a),m=r("./src/core/view/spreadsheet-view/render-manager/alloy-excel/interface.ts"),v=function(){function e(){Object(a.a)(this,e)}return Object(o.a)(e,null,[{key:"generateKey",value:function(e,t,r){return"".concat(e,",").concat(t.hash,",").concat(t[m.a.BOLD],",").concat(t[m.a.ITALIC],",").concat(t[m.a.UNDERLINE],",").concat(t[m.a.STRIKETHROUGH])}},{key:"newInstance",value:function(t,r,n){var a=e.generateKey(t,r,n),o=e.pools[a];return o||(e.pools[a]=new _(t,r,n))}},{key:"releasePools",value:function(){var t=Object.values(e.pools);this.clearSegmentCache(t),e.pools={}}},{key:"clearSegmentCache",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,a=r*n,o=a+n,i=e.slice(a,o);requestAnimationFrame((function(){i.forEach((function(e){delete e.splitSegmentCache,delete e.lineFeedSegmentsCache})),e[o+1]&&t.clearSegmentCache(e,r+1)}))}}]),e}();v.pools={};var g=t.a=v},"./src/core/view/spreadsheet-view/model/measurer/Measurer.ts":function(e,t,r){"use strict";var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=new(function(){function e(){Object(n.a)(this,e),this.measureCtx=this._prepareMeasureCtx(),this.cacheWidth={},this.cacheHeight={},this.measureCtx||console.error("ERROR: Measurer - cannot get measureCtx!")}return Object(a.a)(e,[{key:"measureWidth",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this._getTextWidthByTextProp(e,t,r);return this._toFixed2(n)}},{key:"measureHeight",value:function(e){return this._toFixed2(1.4*this._pt2px(Math.max(2.25,e.fontSize)))}},{key:"_getTextWidthByTextProp",value:function(e,t,r){return this._getCharWidthByTextProp(e,t,r)}},{key:"_getCharWidthByTextProp",value:function(e,t,r){var n=0,a=t.font;return void 0===this.cacheWidth[a]&&(this.cacheWidth[a]={}),void 0===this.cacheWidth[a][e]?(n=this._calcTextWidthByTextProp(e,t),r&&(this.cacheWidth[a][e]=n)):n=this.cacheWidth[a][e],n}},{key:"_calcTextWidthByTextProp",value:function(e,t){var r=0;return this.measureCtx&&(this.measureCtx.font!==t.font&&(this.measureCtx.font=t.font),r=this.measureCtx.measureText(e).width),r=this._toFixed2(r)}},{key:"_toFixed2",value:function(e){return"number"!==typeof e?(console.error("x is not a number"),0):Math.round(100*e)/100}},{key:"_pt2px",value:function(e){return 4*e/3}},{key:"_prepareMeasureCtx",value:function(){if("undefined"!==typeof window){var e=document.createElement("canvas");return e.width=1,e.height=500,e.dir="ltr",e.getContext("2d")}return null}}]),e}());t.a=o},"./src/core/view/spreadsheet-view/paragraph-accessor/ParagraphAccessor.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return E}));r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js");var n=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),s=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),l=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),c=r("./src/core/view/spreadsheet-view/accessor/BaseCellAccessor.ts"),u=r("./src/core/view/spreadsheet-view/model/line-engine/LineEngine.ts");function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var h=function(e){Object(i.a)(r,e);var t=d(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this))._handleCellsChange=function(e){for(var t=e.startRow,r=e.endRow,a=e.startCol,o=e.endCol,i=t;i<=r;i++)for(var s=a;s<=o;s++)n._calcFunc(i,s)},n._handleColChange=function(e){for(var t=0;t<n._spreadsheet.activeSheet.getRowCount();t++)for(var r=e.ranges,a=0;a<r.length;a++)for(var o=r[a],i=o.startIndex;i<=o.endIndex;i++)n._calcFunc(t,i)},n._dataCallView=e.dataCallView,n._spreadsheet=e.spreadsheet,n._calcFunc=e.calc,n._register(n._dataCallView.onUpdateCells(n._handleCellsChange)),n._register(n._dataCallView.onSetColWidth(n._handleColChange)),n._register(n._dataCallView.onSetColVisible(n._handleColChange)),n}return r}(r("../packages/services/src/dispose.ts").a),f=r("./src/core/view/utils/base-func.ts"),p=r("./src/core/view/spreadsheet-view/model/line/segment/TextSegmentFactory.ts"),_=r("./src/core/view/spreadsheet-view/transform-table/utils.ts"),m=r("../packages/model/src/cell/format/index.ts"),v=r("./src/core/view/config/default.ts"),g=r("../packages/model/src/cell/metadata/CustomDataType.ts");var b=r("./src/core/view/spreadsheet-view/transform-table/cell.ts"),y=r("./src/core/view/spreadsheet-view/model/line/segment/TagSegmentFactory.ts");function w(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var R=function(e){Object(i.a)(r,e);var t=w(r);function r(e){var o;return Object(a.a)(this,r),(o=t.call(this,e))._cancelSegmentFlyweight=Object(f.d)((function(){p.a.releasePools(),y.a.releasePools()})),o._init=function(){o._rowData=Object(n.a)({},"PARAGRAPH_DATA",[]);for(var e=o._spreadsheet.activeSheet.getRowCount()-1,t=o._spreadsheet.activeSheet.getColCount()-1,r=0;r<=e;r++)for(var a=0;a<=t;a++)o._calc(r,a)},o._calc=function(e,t){var r=E(o._spreadsheet.activeSheet,e,t),n=r.paragraph,a=r.row,i=r.col;null!==n?(o._rowData.PARAGRAPH_DATA[a]||(o._rowData.PARAGRAPH_DATA[a]=[]),o._rowData.PARAGRAPH_DATA[a][i]=n,o._cancelSegmentFlyweight()):o._rowData.PARAGRAPH_DATA[a]&&delete o._rowData.PARAGRAPH_DATA[a][i]},o._spreadsheet=e.spreadsheet,o._recalculateListener=o._register(new h({dataCallView:o._dataCallView,spreadsheet:o._spreadsheet,calc:o._calc})),o._init(),o}return Object(o.a)(r,[{key:"getParagraph",value:function(e,t){if(this._rowData.PARAGRAPH_DATA[e])return this._rowData.PARAGRAPH_DATA[e][t]}},{key:"refresh",value:function(){this._init()}}]),r}(c.a);function E(e,t,r){var n,a=t,o=r,i=e.getCellDataAtPosition(a,o),s=null===(n=i)||void 0===n?void 0:n.getMergeReference();if(s&&(a=s.startRowIndex,o=s.startColIndex,i=e.getCellDataAtPosition(a,o)),!i)return{row:a,col:o,paragraph:null};var l=Object(b.e)(e,a,o),c=l.paddingLeft,d=l.paddingRight,h=function(e,t,r){if(!t)return v.g;var n=0,a=t.getMergeReference();if(!a)return e.data.isColHidden(r)?0:e.data.getColWidth(r);for(var o=a.startColIndex;o<=a.endColIndex;o++)e.data.isColHidden(o)||(n+=e.data.getColWidth(o));return n}(e,i,o)-c-d;return{row:a,col:o,paragraph:function(e){var t;if((null===(t=e.getMetadata())||void 0===t?void 0:t.customDataType)===g.o.SELECT)return!0;var r=[e.getConditionalFormatResult(),e.getEffectiveFormat(),e.getUserEnteredFormat()];return Object(_.a)(r,"getWrapStrategy")===m.WRAP_STRATEGY.WRAP}(i)?u.a.autoWrapLine(i,h):u.a.nonAutoWrapLine(i)}}t.b=R},"./src/core/view/spreadsheet-view/render-manager/ScrollRenderApi.ts":function(e,t,r){"use strict";(function(e){var n=r("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=r("./src/core/view/spreadsheet-view/render-manager/renderUtil.ts"),s=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),l=r.n(s),c=r("./src/base/util/browser.ts"),u=r("../packages/common-utils/src/url.ts"),d=r("./src/base/util/mobile.ts"),h=l.a.isFirefox,f=function(){function t(r){var o=this;Object(a.a)(this,t),this.scrollRender=function(){if(o.isNeedRepaint())return{isNeedRepaint:!0};var e=o.alloyExcel.ctx;e.save(),e.setTransform(1,0,0,1,0,0);var t=o.scrollRowsRender(),r=t.repaintY,n=t.repaintHeight,a=o.scrollColsRender(),i=a.repaintX,s=a.repaintWidth;return e.restore(),o.renderScrollMultipleRows(r,n),o.renderScrollMultipleCols(i,s),o.clearRectBottomArea(),o.clearRectRightArea(),o.areaData.row.flow.rowOffsetDiff=0,o.areaData.col.flow.colOffsetDiff=0,{isNeedRepaint:!1}},this.scrollRowsRender=function(){var e={repaintY:0,repaintHeight:0},t=o.areaData.row.flow.rowOffsetDiff;if(0===(t*=o.scrollRenderRatio))return e;var r=o.transformTable.colHeadHeight*o.scrollRenderRatio,n=o.alloyExcel.canvas.width-0,a=t<0&&o.areaData.row.flow.padding>0,i=o.areaData.row.flow.viewSize*o.scrollRenderRatio-Math.abs(t)-(a?0:o.areaData.row.flow.padding*o.scrollRenderRatio),s=n,l=i,c=r,u=r;return t<0?(u=(c+=o.areaData.row.frozen.viewSize*o.scrollRenderRatio+2*o.scrollRenderRatio)-t,e.repaintY=c-2*o.scrollRenderRatio,e.repaintHeight=u-e.repaintY+2*o.scrollRenderRatio):t>0&&(c=(u+=o.areaData.row.frozen.viewSize*o.scrollRenderRatio)+t,e.repaintY=u+l-2*o.scrollRenderRatio,e.repaintHeight=o.alloyExcel.canvas.height-e.repaintY),o.drawCanvasImage(0,c,n,i,0,u,s,l),e.repaintY=e.repaintY/o.scrollRenderRatio,e.repaintHeight=e.repaintHeight/o.scrollRenderRatio,e},this.scrollColsRender=function(){var e={repaintX:0,repaintWidth:0},t=o.areaData.col.flow.colOffsetDiff;if(0===(t*=o.scrollRenderRatio))return e;var r=o.transformTable.rowHeadWidth*o.scrollRenderRatio,n=o.areaData.col.flow.viewSize*o.scrollRenderRatio-Math.abs(t),a=o.alloyExcel.canvas.height-0,i=n,s=a,l=r,c=r;return t<0?(c=(l+=o.areaData.col.frozen.viewSize*o.scrollRenderRatio+2*o.scrollRenderRatio)-t,e.repaintX=l-2*o.scrollRenderRatio,e.repaintWidth=c-e.repaintX+2*o.scrollRenderRatio):t>0&&(l+=o.areaData.col.frozen.viewSize*o.scrollRenderRatio+t,c+=o.areaData.col.frozen.viewSize*o.scrollRenderRatio,e.repaintX=c+i-2*o.scrollRenderRatio,e.repaintWidth=Math.abs(t)+2*o.scrollRenderRatio),o.drawCanvasImage(l,0,n,a,c,0,i,s),e.repaintX=e.repaintX/o.scrollRenderRatio,e.repaintWidth=e.repaintWidth/o.scrollRenderRatio,e},this.drawCanvasImage=function(e,t,r,n,a,s,l,c){e=Object(i.f)(e),t=Object(i.f)(t),r=Object(i.f)(r),n=Object(i.f)(n),a=Object(i.f)(a),s=Object(i.f)(s),l=Object(i.f)(l),c=Object(i.f)(c);var u=o.alloyExcel.ctx,d=e+r<=u.canvas.width,h=t+n<=u.canvas.height;d||(l=r=u.canvas.width-e),h||(c=n=u.canvas.height-t),u.drawImage(o.alloyExcel.canvas,e,t,r,n,a,s,l,c)},this.renderScrollMultipleRows=function(e,t){if(!(e<0||t<0)&&(0!==e||0!==t)){var r=Object(i.g)(e,t,o.areaData,o.transformTable),a=r.fromRow,s=r.toRow,l=o.areaData,c=l.row,u=l.col;if(!(c.frozen.renderTo>=a&&c.frozen.renderFrom<=s)){var d=o.areaData.getViewTopByRow(a),h=t;if(u.flow.to>=u.flow.from){var f=u.flow.renderFrom,p=Math.min(o.transformTable.getColCount()-1,u.flow.renderTo),_=o.areaData.getViewLeftByCol(f),m=Object(i.e)(i.a.FLOW,i.a.FLOW,o.areaData,o.transformTable),v=Object(n.a)(m,3),g=[v[0],e,v[2],h];Object(i.c)(o.alloyExcel.ctx,g,(function(){o.alloyExcel.renderCells(a,s,f,p,d,_,g)}))}if(u.frozen.to>=u.frozen.from){var b=u.frozen.renderFrom,y=Math.min(o.transformTable.getColCount()-1,u.frozen.renderTo),w=o.areaData.getViewLeftByCol(b),R=Object(i.e)(i.a.FLOW,i.a.FROZEN,o.areaData,o.transformTable),E=Object(n.a)(R,3),C=[E[0],e,E[2],h];Object(i.c)(o.alloyExcel.ctx,C,(function(){o.alloyExcel.renderCells(a,s,b,y,d,w,C)}))}}}},this.renderScrollMultipleCols=function(e,t){if(!(e<0||t<0)&&(0!==e||0!==t)){var r=Object(i.d)(e,t,o.areaData,o.transformTable),a=r.fromCol,s=r.toCol,l=o.areaData,c=l.row,u=l.col;if(!(u.frozen.renderTo>=a&&u.frozen.renderFrom<=s)){var d=o.areaData.getViewLeftByCol(a),h=t;if(c.flow.to>=c.flow.from){var f=c.flow.renderFrom,p=Math.min(o.transformTable.getRowCount()-1,c.flow.renderTo),_=o.areaData.getViewTopByRow(f),m=Object(i.e)(i.a.FLOW,i.a.FLOW,o.areaData,o.transformTable),v=Object(n.a)(m,4),g=[e,v[1],h,v[3]];Object(i.c)(o.alloyExcel.ctx,g,(function(){o.alloyExcel.renderCells(f,p,a,s,_,d,g)}))}if(c.frozen.to>=c.frozen.from){var b=c.frozen.renderFrom,y=Math.min(o.transformTable.getRowCount()-1,c.frozen.renderTo),w=o.areaData.getViewTopByRow(b),R=Object(i.e)(i.a.FROZEN,i.a.FLOW,o.areaData,o.transformTable),E=Object(n.a)(R,4),C=[e,E[1],h,E[3]];Object(i.c)(o.alloyExcel.ctx,C,(function(){o.alloyExcel.renderCells(b,y,a,s,w,d,C)}))}}}},this.isNeedRepaint=function(){return!!o.disableScrollRender||(!(!h&&!d.b)||(!(!l.a.isPC||!o.isPcNeedRepaint())||(!(!l.a.isMobilePhone||!o.isMobileNeedRepaint())||o.commonCheck())))},this.isPcNeedRepaint=function(){return!1},this.isMobileNeedRepaint=function(){if(0!==o.areaData.col.flow.colOffsetDiff)return!0;var e=o.areaData.row.flow.padding;if(o.mobileRowPadding!==e)return o.mobileRowPadding=e,!0;var t=o.scale.scale;return.85!==t&&.65!==t||!Object(c.d)()},this.commonCheck=function(){return!o.spreadsheet.activeSheet.isLoaded||(o.isFirstTimeRender?(o.isFirstTimeRender=!1,!0):!!o.isScaleOrPixelRatioChange()||o.isScrollTooMuch())},this.isScaleOrPixelRatioChange=function(){var t=o.scale.scale;return o.currentScale!==t?(o.currentScale=t,!0):o.devicePixelRatio!==e.devicePixelRatio&&(o.devicePixelRatio=e.devicePixelRatio,!0)},this.isScrollTooMuch=function(){var e=o.areaData.row.flow.padding,t=o.areaData.row.flow,r=t.rowOffsetDiff,n=t.viewSize;if(Math.abs(r)+2+e>=n)return!0;var a=o.areaData.col.flow,i=a.colOffsetDiff,s=a.viewSize;return Math.abs(i)+2>=s},this.alloyExcel=r.alloyExcel,this.areaData=r.areaData,this.transformTable=r.transformTable,this.scale=r.scale,this.mobileRowPadding=this.areaData.row.flow.padding,this.currentScale=this.scale.scale,this.spreadsheet=r.spreadsheet,this.isFirstTimeRender=!0,this.disableScrollRender=""!==Object(u.getQuery)("disableScrollRender"),this.devicePixelRatio=e.devicePixelRatio}return Object(o.a)(t,[{key:"clearRectBottomArea",value:function(){l.a.isPC?this.clearPcRectBottomArea():(l.a.isAndroidPad||l.a.isIPad)&&this.clearPadRectBottomArea()}},{key:"clearPcRectBottomArea",value:function(){if(this.areaData.row.flow.rowOffsetDiff>0){var e=this.areaData.row.flow.offsetSize-this.areaData.row.flow._maxOffsetSize+this.areaData.row.flow.originalSafeDistance;if(e>0){var t=this.areaData.row.flow.viewSize+this.areaData.row.frozen.viewSize+this.transformTable.colHeadHeight-e,r=this.areaData.col.flow.viewSize+this.areaData.col.frozen.viewSize+this.transformTable.rowHeadWidth,n=e;this.alloyExcel.ctx.clearRect(0,t,r,n)}}}},{key:"clearPadRectBottomArea",value:function(){var e=this.areaData.row.flow,t=e.padding,r=e.renderTo,n=e.areaTop,a=e.offsetSize;if(t>0){var o=this.areaData.row.flow.viewSize+this.areaData.row.frozen.viewSize+this.transformTable.colHeadHeight,i=this.areaData.col.flow.viewSize+this.areaData.col.frozen.viewSize+this.transformTable.rowHeadWidth,s=n[r+1]+this.areaData.row.frozen.viewSize+this.transformTable.colHeadHeight-a,l=s,c=i,u=o-s;this.alloyExcel.ctx.clearRect(0,l,c,u)}}},{key:"clearRectRightArea",value:function(){if(this.areaData.col.flow.colOffsetDiff>0){var e=this.areaData.col.flow.offsetSize-this.areaData.col.flow._maxOffsetSize+this.areaData.col.flow.originalSafeDistance;if(e>0){var t=this.areaData.row.flow.viewSize+this.areaData.row.frozen.viewSize+this.transformTable.colHeadHeight,r=this.areaData.col.flow.viewSize+this.areaData.col.frozen.viewSize+this.transformTable.rowHeadWidth-e,n=e,a=t;this.alloyExcel.ctx.clearRect(r,0,n,a)}}}},{key:"scrollRenderRatio",get:function(){return this.scale.scale*this.devicePixelRatio}}]),t}();t.a=f}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/view/spreadsheet-view/render-manager/alloy-excel/Default.ts":function(e,t,r){"use strict";var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("./src/core/view/spreadsheet-view/render-manager/alloy-excel/utils.ts"),i=function(){function e(){Object(n.a)(this,e)}return Object(a.a)(e,null,[{key:"reset",value:function(t){void 0!==t.lineWidth&&(e.LINE_WIDTH=t.lineWidth,e.LINE.width=e.LINE_WIDTH),void 0!==t.lineColor&&(e.LINE_COLOR=t.lineColor,e.LINE.color=e.LINE_COLOR),void 0!==t.lineStyle&&(e.LINE_STYLE=t.lineStyle,e.LINE.style=e.LINE_STYLE),void 0!==t.color&&(e.COLOR=t.color,e.FONT_STYLE.color=e.COLOR),void 0!==t.fontFamily&&(e.FONT_FAMILY=t.fontFamily,e.FONT_STYLE.fontFamily=e.FONT_FAMILY),void 0!==t.fontSize&&(e.FONT_SIZE=t.fontSize,e.FONT_STYLE.fontSize=e.FONT_SIZE),void 0!==t.backgroundColor&&(e.BACKGROUND_COLOR=t.backgroundColor)}}]),e}();i.LINE_WIDTH=1,i.LINE_COLOR={red:220,green:220,blue:220,alpha:1,hex:"#e2e4e8"},i.LINE_STYLE=o.a.THIN,i.LINE={width:i.LINE_WIDTH,style:i.LINE_STYLE,color:i.LINE_COLOR},i.COLOR={red:0,green:0,blue:0,alpha:1,hex:"#000000"},i.FONT_FAMILY="Arial",i.FONT_SIZE=10,i.DIMENSION_FONT_SIZE=9,i.FONT_STYLE={color:i.COLOR,fontFamily:i.FONT_FAMILY,fontSize:i.FONT_SIZE,bold:!1,italic:!1,strikethrough:!1,underline:!1},i.BACKGROUND_COLOR={red:0,green:0,blue:0,alpha:1,hex:"#ffffff"},t.a=i},"./src/core/view/spreadsheet-view/render-manager/alloy-excel/canvas/renderer/BaseRenderer.ts":function(e,t,r){"use strict";r.d(t,"d",(function(){return s})),r.d(t,"c",(function(){return a})),r.d(t,"b",(function(){return l})),r.d(t,"a",(function(){return c}));var n,a,o=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),i=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),s=function e(t){Object(i.a)(this,e),this._ctx=t};!function(e){e[e.GraphicsRender=0]="GraphicsRender",e[e.RoundRectRenderer=1]="RoundRectRenderer",e[e.LineRenderer=2]="LineRenderer",e[e.TextRenderer=3]="TextRenderer",e[e.BitmapRenderer=4]="BitmapRenderer"}(a||(a={}));var l=(n={},Object(o.a)(n,a.GraphicsRender,0),Object(o.a)(n,a.RoundRectRenderer,10),Object(o.a)(n,a.TextRenderer,20),Object(o.a)(n,a.LineRenderer,30),Object(o.a)(n,a.BitmapRenderer,40),n),c={RangeAuthLine:l[a.GraphicsRender]+2,RangeAuthBackground:l[a.GraphicsRender]+2,CoverBackground:l[a.GraphicsRender]+2,RowColTriangle:l[a.GraphicsRender]+3,MentionTriangle:l[a.RoundRectRenderer]+1,CollabBorder:l[a.LineRenderer]+1}},"./src/core/view/spreadsheet-view/render-manager/alloy-excel/canvas/renderer/BitmapRenderer.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),i=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),s=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js");function l(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var c=function(t){Object(o.a)(i,t);var r=l(i);function i(){return Object(n.a)(this,i),r.apply(this,arguments)}return Object(a.a)(i,[{key:"render",value:function(e){var t=this;e.renderInfos.forEach((function(e){return t.renderBitmap(e)}))}},{key:"renderBitmap",value:function(t){var r=t.clipInfo,n=t.sx,a=t.sy,o=t.sWidth,i=t.sHeight,s=t.dWidth,l=t.dHeight,c=t.img,u=t.dx,d=t.dy;if(c){r&&(this._ctx.save(),this._ctx.beginPath(),this._ctx.rect(r[0],r[1],r[2],r[3]),this._ctx.clip());try{void 0!==n&&void 0!==a&&void 0!==o&&void 0!==i&&void 0!==s&&void 0!==l?this._ctx.drawImage(c,n,a,o,i,u,d,s,l):void 0!==s&&void 0!==l?this._ctx.drawImage(c,u,d,s,l):this._ctx.drawImage(c,u,d)}catch(f){var h;null===(h=e.log)||void 0===h||h.info(f)}r&&this._ctx.restore()}}}]),i}(r("./src/core/view/spreadsheet-view/render-manager/alloy-excel/canvas/renderer/BaseRenderer.ts").d);t.a=c}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/view/spreadsheet-view/render-manager/alloy-excel/interface.ts":function(e,t,r){"use strict";var n;r.d(t,"a",(function(){return n})),function(e){e[e.COLOR=0]="COLOR",e[e.FONT_SIZE=1]="FONT_SIZE",e[e.FONT_FAMILY=2]="FONT_FAMILY",e[e.BOLD=3]="BOLD",e[e.ITALIC=4]="ITALIC",e[e.UNDERLINE=5]="UNDERLINE",e[e.STRIKETHROUGH=6]="STRIKETHROUGH"}(n||(n={}))},"./src/core/view/spreadsheet-view/render-manager/alloy-excel/table/Table.canvas.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),i=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),s=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),l=r("./src/core/view/spreadsheet-view/render-manager/alloy-excel/table/Table.ts"),c=(r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js")),u=r("./src/core/view/spreadsheet-view/render-manager/alloy-excel/interface.ts"),d=r("./src/core/view/spreadsheet-view/render-manager/alloy-excel/utils.ts");function h(e,t,r,n,a,o){var i,s,l=r?t:e,c=r?e:t;return r?(i=n.getVerticalBorderStyle(a-1,a,o-1),s=n.getVerticalBorderStyle(a-1,a,o)):(i=n.getVerticalBorderStyle(a-1,a,o),s=n.getVerticalBorderStyle(a-1,a,o+1)),i===d.a.DOUBLE&&s===d.a.DOUBLE?(l.x+=1,c.x+=1):i===d.a.DOUBLE||s===d.a.DOUBLE?function(e,t,r,n,a){t!==d.a.DOUBLE&&r===d.a.DOUBLE?e?(n.x+=1,a.x-=1):(n.x-=1,a.x+=1):t===d.a.DOUBLE&&r!==d.a.DOUBLE&&(e?(n.x-=1,a.x+=1):(n.x+=1,a.x-=1))}(r,i,s,l,c):i===d.a.NONE&&s===d.a.NONE||(l.x+=1,c.x+=1),{innerLineStartPoint:l,outerLineStartPoint:c}}function f(e,t,r,n,a,o){var i,s,l=r?t:e,c=r?e:t;return r?(i=n.getVerticalBorderStyle(a,a+1,o-1),s=n.getVerticalBorderStyle(a,a+1,o)):(i=n.getVerticalBorderStyle(a,a+1,o),s=n.getVerticalBorderStyle(a,a+1,o+1)),i===d.a.DOUBLE&&s===d.a.DOUBLE?(l.x-=1,c.x-=1):i!==d.a.DOUBLE&&s!==d.a.DOUBLE||function(e,t,r,n,a){t!==d.a.DOUBLE&&r===d.a.DOUBLE?e?(n.x-=1,a.x+=1):(n.x+=1,a.x-=1):t===d.a.DOUBLE&&r!==d.a.DOUBLE&&(e?(n.x+=1,a.x-=1):(n.x-=1,a.x+=1))}(r,i,s,l,c),{innerLineEndPoint:l,outerLineEndPoint:c}}function p(e,t,r,n,a,o,i,s,l){var c={x:(n-=.5)+(s+=1),y:a-1},u={x:n+s,y:a+1},d=h({x:n,y:a-1},{x:n,y:a+1},t,r,o,i),p=d.innerLineStartPoint,_=d.outerLineStartPoint,m=f(c,u,t,r,o,i),v=m.innerLineEndPoint,g=m.outerLineEndPoint;e.lineCollector.collect({lineProp:l,line:[p.x,p.y,v.x,v.y]}),e.lineCollector.collect({lineProp:l,line:[_.x,_.y,g.x,g.y]})}function _(e,t,r,n,a,o,i,s,l){s+=1;var c=function(e,t,r,n,a,o){var i,s,l,c={x:e,y:t};r?(i=n.getHorizontalBorderStyle(o-1,o,a-1),s=n.getVerticalBorderStyle(a-1,a,o-1),l=n.getVerticalBorderStyle(a-1,a,o)):(i=n.getHorizontalBorderStyle(o,o+1,a-1),s=n.getVerticalBorderStyle(a-1,a,o),l=n.getVerticalBorderStyle(a-1,a,o+1));var u=0;return i===d.a.DOUBLE&&(u+=1),s===d.a.DOUBLE&&(u+=1),l===d.a.DOUBLE&&(u+=1),s!==d.a.DOUBLE&&l!==d.a.DOUBLE||1!==u?u>1&&(c.x+=1):c.x-=1,c}(n-=.5,a,t,r,o,i),u=function(e,t,r,n,a,o){var i,s,l,c={x:e,y:t};r?(i=n.getHorizontalBorderStyle(o-1,o,a+1),s=n.getVerticalBorderStyle(a,a+1,o-1),l=n.getVerticalBorderStyle(a,a+1,o)):(i=n.getHorizontalBorderStyle(o,o+1,a+1),s=n.getVerticalBorderStyle(a,a+1,o),l=n.getVerticalBorderStyle(a,a+1,o+1));var u=0;return i===d.a.DOUBLE&&(u+=1),s===d.a.DOUBLE&&(u+=1),l===d.a.DOUBLE&&(u+=1),s!==d.a.DOUBLE&&l!==d.a.DOUBLE||1!==u?u>1&&(c.x-=1):c.x+=1,c}(n+s,a,t,r,o,i);e.lineCollector.collect({lineProp:l,line:[c.x,c.y,u.x,u.y]})}function m(e,t,r,n,a,o){var i,s,l=r?t:e,c=r?e:t;return r?(i=n.getHorizontalBorderStyle(o-1,o,a-1),s=n.getHorizontalBorderStyle(o-1,o,a)):(i=n.getHorizontalBorderStyle(o-1,o,a),s=n.getHorizontalBorderStyle(o-1,o,a+1)),i===d.a.DOUBLE&&s===d.a.DOUBLE?(l.y+=1,c.y+=1):i!==d.a.DOUBLE&&s!==d.a.DOUBLE||function(e,t,r,n,a){t!==d.a.DOUBLE&&r===d.a.DOUBLE?e?(n.y+=1,a.y-=1):(n.y-=1,a.y+=1):t===d.a.DOUBLE&&r!==d.a.DOUBLE&&(e?(n.y-=1,a.y+=1):(n.y+=1,a.y-=1))}(r,i,s,l,c),{innerLineStartPoint:l,outerLineStartPoint:c}}function v(e,t,r,n,a,o){var i,s,l=r?t:e,c=r?e:t;return r?(i=n.getHorizontalBorderStyle(o,o+1,a-1),s=n.getHorizontalBorderStyle(o,o+1,a)):(i=n.getHorizontalBorderStyle(o,o+1,a),s=n.getHorizontalBorderStyle(o,o+1,a+1)),i===d.a.DOUBLE&&s===d.a.DOUBLE?(l.y-=1,c.y-=1):i===d.a.DOUBLE&&s===d.a.DOUBLE?function(e,t,r,n,a){t!==d.a.DOUBLE&&r===d.a.DOUBLE?e?(n.y-=1,a.y+=1):(n.y+=1,a.y-=1):t===d.a.DOUBLE&&r!==d.a.DOUBLE&&(e?(n.y+=1,a.y-=1):(n.y-=1,a.y+=1))}(r,i,s,l,c):i===d.a.NONE&&s===d.a.NONE||(l.y-=1,c.y-=1),{innerLineEndPoint:l,outerLineEndPoint:c}}function g(e,t,r,n,a,o,i,s,l){var c={x:n-1,y:(a-=.5)+(s+=1)},u={x:n+1,y:a+s},d=m({x:n-1,y:a},{x:n+1,y:a},t,r,o,i),h=d.innerLineStartPoint,f=d.outerLineStartPoint,p=v(c,u,t,r,o,i),_=p.innerLineEndPoint,g=p.outerLineEndPoint;e.lineCollector.collect({lineProp:l,line:[h.x,h.y,_.x,_.y]}),e.lineCollector.collect({lineProp:l,line:[f.x,f.y,g.x,g.y]})}function b(e,t,r,n,a,o,i,s,l){s+=1;var c=function(e,t,r,n,a,o){var i,s,l,c={x:e,y:t};r?(i=n.getVerticalBorderStyle(a-1,a,o-1),s=n.getHorizontalBorderStyle(o-1,o,a-1),l=n.getHorizontalBorderStyle(o-1,o,a)):(i=n.getVerticalBorderStyle(a,a+1,o-1),s=n.getHorizontalBorderStyle(o-1,o,a),l=n.getHorizontalBorderStyle(o-1,o,a+1));var u=0;return i===d.a.DOUBLE&&(u+=1),s===d.a.DOUBLE&&(u+=1),l===d.a.DOUBLE&&(u+=1),s!==d.a.DOUBLE&&l!==d.a.DOUBLE||1!==u?u>1&&(c.y+=1):c.y-=1,c}(n,a-=.5,t,r,o,i),u=function(e,t,r,n,a,o){var i,s,l,c={x:e,y:t};r?(i=n.getVerticalBorderStyle(a-1,a,o+1),s=n.getHorizontalBorderStyle(o,o+1,a-1),l=n.getHorizontalBorderStyle(o,o+1,a)):(i=n.getVerticalBorderStyle(a,a+1,o+1),s=n.getHorizontalBorderStyle(o,o+1,a),l=n.getHorizontalBorderStyle(o,o+1,a+1));var u=0;return i===d.a.DOUBLE&&(u+=1),s===d.a.DOUBLE&&(u+=1),l===d.a.DOUBLE&&(u+=1),s!==d.a.DOUBLE&&l!==d.a.DOUBLE||1!==u?u>1&&(c.y-=1):c.y+=1,c}(n,a+s,t,r,o,i);e.lineCollector.collect({lineProp:l,line:[c.x,c.y,u.x,u.y]})}var y=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),w=r("../packages/model/src/cell/metadata/CustomDataType.ts"),R=r("./src/core/view/spreadsheet-view/render-manager/alloy-excel/table/body/cell-renders/impl/ImageCellRender.ts"),E=(r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("./src/core/view/spreadsheet-view/render-manager/alloy-excel/table/body/cell-renders/BaseCellRender.ts")),C=r("./src/core/view/spreadsheet-view/model/line/segment/TagSegment.ts");function j(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var O=function(e){Object(o.a)(r,e);var t=j(r);function r(){return Object(n.a)(this,r),t.apply(this,arguments)}return Object(a.a)(r,[{key:"renderText",value:function(e,t){var r=t.transformCell,n=t.x,a=t.y,o=t.cellWidth,i=t.cellHeight,s=r.lines,l=void 0===s?[]:s,c=r.cell,d=[n,a,o-c.paddingRight,i];l.forEach((function(t){var r=t.offsetX,s=t.offsetY,l=0;t.segments.forEach((function(t){var c,h,f=t.size,p=t.text,_=t.bgColor,m=t.textProp,v=f.width,g=f.height,b=l+n+r,y=a+s,w=C.a.MARGIN,R=C.a.PADDING_X,E=(C.a.PADDING_Y,C.a.RADIUS),j=y-.75*g+w,O={fillColor:(null===_||void 0===_?void 0:_.hex)||""};if("#ffffff"===(null===_||void 0===_?void 0:_.hex)&&(O.borderWidth=1,O.strokeColor="rgba(0,0,0,0.08)"),m[u.a.STRIKETHROUGH]){var S=Math.round(g/4);c=[b+1+R,y-S,b+v-1-R,y-S]}if(m[u.a.UNDERLINE]){h=[b+1+R,y+2,b+v-1-R,y+2]}e.roundRectCollector.collect({roundRectInfo:{rect:[b+w,j,v-2*w,g-2*w],radius:E,clipInfo:d||[n,a,o,i]},roundRectProp:O}),e.textCollector.collect({textInfo:{pos:[b+w+R,j+.75*(g-2*w)],text:p,clipInfo:d||void 0,strikethroughInfo:c,underlineInfo:h},textPropHash:m.hash}),l+=v}))}))}},{key:"renderTextCheck",value:function(e){return e.metadataConfig.withColor}}]),r}(E.a),S=r("./src/core/view/spreadsheet-view/render-manager/alloy-excel/table/body/cell-renders/impl/icons/checkbox-selected.svg"),D=r.n(S),x=r("./src/core/view/spreadsheet-view/render-manager/alloy-excel/table/body/cell-renders/impl/icons/checkbox-unselected.svg"),k=r.n(x),T=r("./src/core/view/spreadsheet-view/render-manager/alloy-excel/table/body/cell-renders/util.ts");function A(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var I=new Image;I.src=D.a;var N=new Image;N.src=k.a;var L=function(e){Object(o.a)(r,e);var t=A(r);function r(){return Object(n.a)(this,r),t.apply(this,arguments)}return Object(a.a)(r,[{key:"renderText",value:function(e,t){var r=t.x,n=t.y,a=t.cellWidth,o=t.cellHeight,i=t.transformCell,s=i.horizontalAlign,l=i.verticalAlign,c=i.cell,u=a-1,d=o-1,h=e.bitmapCollector,f=w.b,p=f,_=Object(T.b)({cellWidth:u,cellHeight:d,dWidth:f,dHeight:p,horizontalAlign:s,verticalAlign:l,marginX:w.a,marginY:w.a}),m=_.dx,v=_.dy;h.collect({dx:r+m,dy:n+v,dWidth:f,dHeight:p,img:(null===c||void 0===c?void 0:c.content)===w.n?I:N,clipInfo:[r,n,u,d]})}},{key:"renderTextCheck",value:function(e){var t,r=null===(t=e.transformCell.cell)||void 0===t?void 0:t.content;return r===w.d||r===w.n}}]),r}(E.a),P=(r("../node_modules/core-js/modules/es.regexp.constructor.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/@tencent/docs-design-resources/mobile/svg/star-unfill-48.svg")),M=r.n(P),V=r("../node_modules/@tencent/docs-design-resources/mobile/svg/star-fill-48.svg"),z=r.n(V);function B(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var F=new Image;F.src=z.a;var H=new Image;H.src=M.a;var U=new RegExp("^[".concat(w.i).concat(w.g,"]+$")),W=function(e){Object(o.a)(r,e);var t=B(r);function r(){return Object(n.a)(this,r),t.apply(this,arguments)}return Object(a.a)(r,[{key:"renderText",value:function(e,t){var r=t.x,n=t.y,a=t.cellWidth,o=t.cellHeight,i=t.transformCell,s=i.horizontalAlign,l=i.verticalAlign,c=i.cell,u=null===c||void 0===c?void 0:c.content;if(u){var d=a-1,h=o-1,f=e.bitmapCollector,p=w.l+2*w.k,_=p*u.length,m=p,v=Object(T.b)({cellWidth:d,cellHeight:h,dWidth:_,dHeight:m,horizontalAlign:s,verticalAlign:l,marginX:w.j,marginY:w.j}),g=v.dx,b=v.dy,y=[r,n,d,h];Array.prototype.forEach.call(u,(function(e,t){f.collect({dx:r+g+w.k*(2*t+1)+w.l*t,dy:n+b+w.k,dWidth:w.l,dHeight:w.l,img:e===w.i?F:H,clipInfo:y})}))}}},{key:"renderTextCheck",value:function(e){var t;return U.test((null===(t=e.transformCell.cell)||void 0===t?void 0:t.content)||"")}}]),r}(E.a),G=r("./src/core/view/config/default.ts");function Y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var X=function(e){Object(o.a)(r,e);var t=Y(r);function r(){return Object(n.a)(this,r),t.apply(this,arguments)}return Object(a.a)(r,[{key:"renderBackground",value:function(e,t){var r,n,a=t.x,o=t.y,i=t.cellWidth,s=t.cellHeight,l=t.transformCell,c=l.cell,u=l.background,d=l.verticalAlign,h=l.horizontalAlign;if(c&&c.content){var f=Object(T.a)(c.content||""),p=i-1,_=s-1,m=[a,o,p-c.paddingRight,_],v=null!==(r=c.paddingLeft)&&void 0!==r?r:G.c.left,g=p-v-(null!==(n=c.paddingRight)&&void 0!==n?n:G.c.right),b=w.f,y=Math.max(g*f/100,2*b),R=a+v,E=Object(T.b)({cellWidth:p,cellHeight:_,dWidth:y,dHeight:w.e,horizontalAlign:h,verticalAlign:d,marginX:v,marginY:2}).dy;e.roundRectCollector.collect({roundRectInfo:{rect:[R,o+E,y,w.e],radius:b,clipInfo:m},roundRectProp:{fillColor:"#00c29c"}}),e.graphicsCollector.collect({color:u.hex,graphicsInfo:{path:[a,o,a+p,o,a+p,o+_,a,o+_]}})}}},{key:"renderBackgroundCheck",value:function(e){return this.checkRenderValid(e)}},{key:"checkRenderValid",value:function(e){var t,r=e.transformCell,n=(null===(t=r.cell)||void 0===t?void 0:t.content)||"";return!(!Object(T.a)(n)||!r.isDataValid)}}]),r}(E.a),K=function(){function e(t){var r;Object(n.a)(this,e),this.cellRenders=(r={},Object(y.a)(r,w.o.CHECKBOX,new L({transformTable:t})),Object(y.a)(r,w.o.SELECT,new O({transformTable:t})),Object(y.a)(r,w.o.IMAGE,new R.b({transformTable:t})),Object(y.a)(r,w.o.STAR,new W({transformTable:t})),Object(y.a)(r,w.o.PROGRESS,new X({transformTable:t})),r)}return Object(a.a)(e,[{key:"getRender",value:function(e){return this.cellRenders[e]}}]),e}(),q=function(){function e(t){Object(n.a)(this,e),this._afterCellRenderData={row:0,col:0,y:0,x:0},this._renderedMergeCells=[],this._renderedCoverCells=[],this._table=t,this.cellRenderManager=new K(t.interface)}return Object(a.a)(e,[{key:"collect",value:function(e,t,r,n,a,o){this._table.ctx.textBaseline="alphabetic",this._table.ctx.textAlign="left",this._renderedMergeCells=[],this._renderedCoverCells=[];var i,s,l=this._table.interface.rowHeadWidth+o,c=this._table.interface.colHeadHeight+a,u=l,d=c;for(i=e;i<=t;i++)if(u=l,!this._table.interface.isRowHidden(i)){for(s=r;s<=n;s++)this._table.interface.isColHidden(s)||(this._collectCell(u,d,i,s),u+=this._table.interface.getColWidth(s));d+=this._table.interface.getRowHeight(i)}return[l,c,u-l,d-c]}},{key:"clearRect",value:function(e){var t;(t=this._table.ctx).clearRect.apply(t,Object(c.a)(e))}},{key:"_collectCell",value:function(e,t,r,n){var a=this._table.interface.getCellDataAtPosition(r,n),o=this._table.interface.getColWidth(n),i=this._table.interface.getRowHeight(r),s=this._table.interface.getCellBackgroundWidth(r,n),l=this._table.interface.getCellBackgroundHeight(r,n);if(a.mergeData){if(this._hasRenderedMergeCell(r,n))return;this._addRenderedMergeCell(r,n)}else{if(a.mergeParent)return void this._renderMergeCellViceCell(e,t,r,n,a.mergeParent);if(a.coverParents)return this._renderBackground(a,e,t,s,l),this._renderBorder(r,n,a,e,t,o,i),this._renderHiddenCell(e,t,r,n,a.coverParents),this._afterCellRenderData.row=r,this._afterCellRenderData.col=n,this._afterCellRenderData.y=t,this._afterCellRenderData.x=e,void this._table.emitter.emit(Ne.EVENT.AFTER_CELL_RENDER,this._afterCellRenderData);if(a.isCover){if(this._hasRenderedCoverCell(r,n))return;this._addRenderedCoverCell(r,n)}}var c=a.metadata,u=c&&this.cellRenderManager.getRender(c.customDataType),d={row:r,col:n,transformCell:a,x:e,y:t,cellWidth:s,cellHeight:l,metadataConfig:null===c||void 0===c?void 0:c.config};(null===u||void 0===u?void 0:u.renderTextCheck(d))?u.renderText(this._table.collectEngine,d):this._renderText(r,n,a,e,t,s,l),(null===u||void 0===u?void 0:u.renderBackgroundCheck(d))?u.renderBackground(this._table.collectEngine,d):this._renderBackground(a,e,t,s,l),a.mergeData?this._renderMergeCellBorder(e,t,r,n,a.mergeData):this._renderBorder(r,n,a,e,t,o,i),this._afterCellRenderData.row=r,this._afterCellRenderData.col=n,this._afterCellRenderData.y=t,this._afterCellRenderData.x=e,this._table.emitter.emit(Ne.EVENT.AFTER_CELL_RENDER,this._afterCellRenderData)}},{key:"_hasRenderedMergeCell",value:function(e,t){return this._renderedMergeCells.indexOf("".concat(e,":").concat(t))>=0}},{key:"_addRenderedMergeCell",value:function(e,t){this._renderedMergeCells.push("".concat(e,":").concat(t))}},{key:"_hasRenderedCoverCell",value:function(e,t){return this._renderedCoverCells.indexOf("".concat(e,":").concat(t))>=0}},{key:"_addRenderedCoverCell",value:function(e,t){this._renderedCoverCells.push("".concat(e,":").concat(t))}},{key:"_renderMergeCellViceCell",value:function(e,t,r,n,a){var o=r+a.y,i=n+a.x;if(!this._hasRenderedMergeCell(o,i)){for(var s=e,l=t,c=r-1;c>=o;c--)this._table.interface.isRowHidden(c)||(l-=this._table.interface.getRowHeight(c));for(var u=n-1;u>=i;u--)this._table.interface.isColHidden(u)||(s-=this._table.interface.getColWidth(u));this._collectCell(s,l,o,i),this._addRenderedMergeCell(o,i)}}},{key:"_renderHiddenCell",value:function(e,t,r,n,a){for(var o=0;o<a.length;o++){var i=a[o];if(this._hasRenderedCoverCell(i.rowIndex,i.colIndex))break;if(this._table.interface.isColHidden(i.colIndex))return;var s=e;if(n<i.colIndex)for(var l=n;l<i.colIndex;l++)s+=this._table.interface.getColWidth(l);else for(var c=n-1;c>=i.colIndex;c--)s-=this._table.interface.getColWidth(c);this._collectCell(s,t,i.rowIndex,i.colIndex),this._addRenderedCoverCell(i.rowIndex,i.colIndex)}}},{key:"_renderMergeCellBorder",value:function(e,t,r,n,a){var o,i,s,l,c,u=e,d=t;for(s=r;s<r+a.rowCount;s++)if(!this._table.interface.isRowHidden(s)){for(c=this._table.interface.getRowHeight(s),u=e,i=n;i<n+a.colCount;i++)this._table.interface.isColHidden(i)||(l=this._table.interface.getColWidth(i),r<s&&s<r+a.rowCount-1&&i!==n&&i!==n+a.colCount-1||(o=this._table.interface.getCellDataAtPosition(s,i),this._renderBorder(r,i,o,u,d,l,c)),u+=l);d+=c}}},{key:"_renderBorder",value:function(e,t,r,n,a,o,i){var s,l,c,u;(null===(s=r.borderTop)||void 0===s?void 0:s.style)&&function(e,t,r,n,a,o,i,s){s.style===d.a.DOUBLE?p(e,!0,t,r,n,a,o,i,s):_(e,!0,t,r,n,a,o,i,s)}(this._table.collectEngine,this._table.interface,n,a,t,e,o,r.borderTop),(null===(l=r.borderRight)||void 0===l?void 0:l.style)&&function(e,t,r,n,a,o,i,s){s.style===d.a.DOUBLE?g(e,!1,t,r,n,a,o,i,s):b(e,!1,t,r,n,a,o,i,s)}(this._table.collectEngine,this._table.interface,n+o,a,t,e,i,r.borderRight),(null===(c=r.borderBottom)||void 0===c?void 0:c.style)&&function(e,t,r,n,a,o,i,s){s.style===d.a.DOUBLE?p(e,!1,t,r,n,a,o,i,s):_(e,!1,t,r,n,a,o,i,s)}(this._table.collectEngine,this._table.interface,n,a+i,t,e,o,r.borderBottom),(null===(u=r.borderLeft)||void 0===u?void 0:u.style)&&function(e,t,r,n,a,o,i,s){s.style===d.a.DOUBLE?g(e,!0,t,r,n,a,o,i,s):b(e,!0,t,r,n,a,o,i,s)}(this._table.collectEngine,this._table.interface,n,a,t,e,i,r.borderLeft)}},{key:"_renderBackground",value:function(e,t,r,n,a){this._table.collectEngine.graphicsCollector.collect({color:e.background.hex,graphicsInfo:{path:[t,r,t+n,r,t+n,r+a,t,r+a]}})}},{key:"_renderText",value:function(e,t,r,n,a,o,i){if(r.lines&&r.lines.length)for(var s=this._table.interface.getClipInfo(e,t,n,a,o,i),l=0;l<r.lines.length;l++){var c=r.lines[l],d=n+c.offsetX,h=a+c.offsetY;if(!(h-3*c.height/4>>0<a+i))break;for(var f=0;f<c.segments.length;f++){var p=c.segments[f],_=p.size.width;if(p.customRender)p.customRender(d,h,s,this._table.collectEngine);else{var m={pos:[d,h],text:p.text};s&&(m.clipInfo=s);var v=p.size.height;if(p.textProp[u.a.STRIKETHROUGH]){var g=Math.round(v/4);m.strikethroughInfo=[d,h-g,d+_,h-g]}if(p.textProp[u.a.UNDERLINE]){m.underlineInfo=[d,h+2,d+_,h+2]}this._table.collectEngine.textCollector.collect({textInfo:m,textPropHash:p.textProp.hash})}d+=_}}}}]),e}(),Q=r("./src/core/view/spreadsheet-view/render-manager/alloy-excel/Default.ts"),Z=r("./src/core/view/spreadsheet-view/model/TextProp.ts"),J=r("./src/core/view/spreadsheet-view/model/Color.ts"),$=function(){function e(t){Object(n.a)(this,e),this._temp=[0,0,0,0],this._endX=0,this._afterColHeadRenderData={col:0,x:0},this._table=t}return Object(a.a)(e,[{key:"collect",value:function(e,t,r){var n=this._table.interface.rowHeadWidth+r;this._collectColHead(e,t,n),this._table.ctx.clearRect(Math.max(0,n),0,this._endX-Math.max(0,n),this._table.interface.colHeadHeight)}},{key:"_setTemp",value:function(e,t,r,n){this._temp[0]=e,this._temp[1]=t,this._temp[2]=r,this._temp[3]=n}},{key:"_collectColHead",value:function(e,t,r){var n,a,o=this._table.interface.colHeadHeight;for(this._setTemp(0,0,this._table.width,0),this._table.collectEngine.lineCollector.collect({lineProp:Q.a.LINE,line:this._temp}),n=e;n<t;n++)if(!this._table.interface.isColHidden(n)){if(this._afterColHeadRenderData.col=n,this._afterColHeadRenderData.x=r,(a=this._table.interface.getColMeta(n)).borderLeft&&(this._setTemp(r,0,r,o),this._table.collectEngine.lineCollector.collect({lineProp:a.borderLeft,line:this._temp})),a.borderBottom){var i=a.fitLineExpand||0;this._setTemp(r-i,o-a.borderBottom.width+1.5,r+a.width+i,o-a.borderBottom.width+1.5),this._table.collectEngine.lineCollector.collect({lineProp:a.borderBottom,line:this._temp})}this._setTemp(r,0,a.width,o),this._table.collectEngine.graphicsCollector.collect({color:a.background.hex,graphicsInfo:{path:[r,0,r+a.width,0,r+a.width,o,r,o]}}),this._table.collectEngine.textCollector.collect({textPropHash:Z.b.newInstance({fontFamily:"PingFang SC,Microsoft YaHei,\u5fae\u8f6f\u96c5\u9ed1",fontSize:Q.a.DIMENSION_FONT_SIZE,color:J.a.newInstanceByHex(a.color.hex)}).hash,textInfo:{text:this._table.interface.getColContent(n),pos:[r+a.width/2,o/2]}}),r+=a.width,a.borderRight&&(this._setTemp(r,0,r,o),this._table.collectEngine.lineCollector.collect({lineProp:a.borderRight,line:this._temp})),this._table.emitter.emit(Ne.EVENT.AFTER_COL_HEAD_RENDER,this._afterColHeadRenderData)}this._endX=r,this._setTemp(0,o,this._endX,o),this._table.collectEngine.lineCollector.collect({lineProp:Q.a.LINE,line:this._temp})}}]),e}(),ee=function(){function e(t){Object(n.a)(this,e),this._temp=[0,0,0,0],this._endY=0,this._afterRowHeadRenderData={row:0,y:0},this._table=t}return Object(a.a)(e,[{key:"collect",value:function(e,t,r){var n=this._table.interface.colHeadHeight+r;this._collectRowHead(e,t,n),this._table.ctx.clearRect(0,Math.max(0,n),this._table.interface.rowHeadWidth,this._endY-Math.max(0,n))}},{key:"_setTemp",value:function(e,t,r,n){this._temp[0]=e,this._temp[1]=t,this._temp[2]=r,this._temp[3]=n}},{key:"_collectRowHead",value:function(e,t,r){var n,a,o=this._table.interface.rowHeadWidth;for(this._setTemp(0,0,0,this._table.height),this._table.collectEngine.lineCollector.collect({lineProp:Q.a.LINE,line:this._temp}),n=e;n<t;n++)if(!this._table.interface.isRowHidden(n)){if(this._afterRowHeadRenderData.row=n,this._afterRowHeadRenderData.y=r,(a=this._table.interface.getRowMeta(n)).borderTop&&(this._setTemp(0,r,o,r),this._table.collectEngine.lineCollector.collect({lineProp:a.borderTop,line:this._temp})),a.borderRight){var i=a.fitLineExpand||0;this._setTemp(o-a.borderRight.width+1.5,r-i,o-a.borderRight.width+1.5,r+a.height+i),this._table.collectEngine.lineCollector.collect({lineProp:a.borderRight,line:this._temp})}this._table.collectEngine.graphicsCollector.collect({color:a.background.hex,graphicsInfo:{path:[0,r,o,r,o,r+a.height,0,r+a.height]}}),this._table.collectEngine.textCollector.collect({textPropHash:Z.b.newInstance({fontFamily:"PingFang SC,Microsoft YaHei,\u5fae\u8f6f\u96c5\u9ed1",fontSize:Q.a.DIMENSION_FONT_SIZE,color:J.a.newInstanceByHex(a.color.hex)}).hash,textInfo:{text:this._table.interface.getRowContent(n),pos:[o/2,r+a.height/2]}}),r+=a.height,a.borderBottom&&(this._setTemp(0,r,o,r),this._table.collectEngine.lineCollector.collect({lineProp:a.borderBottom,line:this._temp})),this._table.emitter.emit(Ne.EVENT.AFTER_ROW_HEAD_RENDER,this._afterRowHeadRenderData)}this._endY=r,this._setTemp(o,0,o,this._endY),this._table.collectEngine.lineCollector.collect({lineProp:Q.a.LINE,line:this._temp})}}]),e}(),te=function(){function e(t){Object(n.a)(this,e),this._temp=[0,0,0,0],this._table=t}return Object(a.a)(e,[{key:"_setTemp",value:function(e,t,r,n){this._temp[0]=e,this._temp[1]=t,this._temp[2]=r,this._temp[3]=n}},{key:"_collectLine",value:function(){var e=this._table.interface.colHeadHeight,t=this._table.interface.rowHeadWidth;this._setTemp(t,0,t,e),this._table.collectEngine.lineCollector.collect({lineProp:Q.a.LINE,line:this._temp}),this._setTemp(t,e,0,e),this._table.collectEngine.lineCollector.collect({lineProp:Q.a.LINE,line:this._temp})}},{key:"_collectBackground",value:function(){var e=this._table.interface.colHeadHeight,t=this._table.interface.rowHeadWidth;this._table.collectEngine.graphicsCollector.collect({color:Q.a.BACKGROUND_COLOR.hex,graphicsInfo:{path:[0,0,t,0,t,e,0,e]}})}},{key:"collect",value:function(){this._collectBackground(),this._collectLine(),this._table.ctx.clearRect(0,0,this._table.interface.rowHeadWidth,this._table.interface.colHeadHeight),this._table.emitter.emit(Ne.EVENT.AFTER_CORNER_RENDER)}}]),e}(),re=(r("../node_modules/core-js/modules/es.object.keys.js"),r("./src/core/view/spreadsheet-view/render-manager/alloy-excel/canvas/renderer/BaseRenderer.ts")),ne=(r("../node_modules/core-js/modules/es.number.constructor.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/core-js/modules/es.string.replace.js"),function(){function e(){Object(n.a)(this,e)}return Object(a.a)(e,null,[{key:"compare",value:function(t,r){void 0===e._colorLevel[t]&&(e._colorLevel[t]=e._getLevel(t)),void 0===e._colorLevel[r]&&(e._colorLevel[r]=e._getLevel(r));var n=e._colorLevel[t],a=e._colorLevel[r];return n>a?-1:n===a?0:1}},{key:"_getLevel",value:function(e){var t=function(e){e.indexOf("#")>-1&&(e=e.replace("#",""));var t=1;3===e.length?e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]:4===e.length?(t=parseInt(e[3]+e[3],16)/255,e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]):8===e.length&&(t=parseInt(e[6]+e[7],16)/255,e=e.substring(0,6));var r=parseInt(e,16);return{red:r>>16,green:r>>8&255,blue:255&r,alpha:t}}(e);return 299*t.red+587*t.green+114*t.blue}}]),e}());ne._colorLevel={};var ae=ne,oe=r("./src/core/view/spreadsheet-view/transform-table/border.ts"),ie=function(){function e(t,r,a){Object(n.a)(this,e),this._width=t,this._style=r,this._color=a}return Object(a.a)(e,[{key:"_compareStylePriority",value:function(e){return oe.a[this._style]-oe.a[e._style]}},{key:"_compareColorPriority",value:function(e){return ae.compare(this._color,e.getColor())}},{key:"getDashSegments",value:function(){var e;switch(this._style){case d.a.HAIR:e=[1,1];break;case d.a.DOTTED:e=[2,2];break;case d.a.DASH_DOT_DOT:case d.a.MEDIUM_DASH_DOT_DOT:e=[3,3,3,3,9,3];break;case d.a.DASH_DOT:case d.a.MEDIUM_DASH_DOT:case d.a.SLANTED_DASH_DOT:e=[3,3,9,3];break;case d.a.DASHED:e=[3,3];break;case d.a.MEDIUM_DASHED:e=[9,3];break;case d.a.NONE:case d.a.THIN:case d.a.MEDIUM:case d.a.THICK:case d.a.DOUBLE:default:e=[]}return e}},{key:"getStyle",value:function(){return this._style}},{key:"getWidth",value:function(){var e=d.b.NONE;switch(this._style){case d.a.THIN:case d.a.DASH_DOT:case d.a.DASH_DOT_DOT:case d.a.DASHED:case d.a.DOTTED:case d.a.HAIR:case d.a.DOUBLE:e=d.b.THIN;break;case d.a.MEDIUM:case d.a.MEDIUM_DASHED:case d.a.MEDIUM_DASH_DOT:case d.a.MEDIUM_DASH_DOT_DOT:case d.a.SLANTED_DASH_DOT:e=d.b.MEDIUM;break;case d.a.THICK:e=d.b.THICK;break;case d.a.NONE:default:e=d.b.NONE}return e}},{key:"getColor",value:function(){return this._color}},{key:"compare",value:function(e){var t=this._compareStylePriority(e);return 0===t?this._compareColorPriority(e):t}}],[{key:"newInstance",value:function(t){var r,n,a,o,i=t.split("-");return a=Number(i[0]),n=Number(i[1]),o=i[2],(r=this._pool.shift())?(r._width=n,r._style=a,r._color=o):r=new e(n,a,o),r}},{key:"destroyInstance",value:function(e){this._pool.push(e)}}]),e}();ie._pool=[];var se=ie;function le(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var ce=function(e){Object(o.a)(r,e);var t=le(r);function r(e){return Object(n.a)(this,r),t.call(this,e)}return Object(a.a)(r,[{key:"_prepareRenderContext",value:function(e){this._ctx.strokeStyle=e.getColor(),this._ctx.lineWidth=e.getWidth(),this._ctx.setLineDash(e.getDashSegments())}},{key:"_renderLine",value:function(e){this._ctx.beginPath();for(var t=0;t<e.length;++t){var r=e[t];this._ctx.moveTo(r[0],r[1]);for(var n=2;n<r.length;n+=2)this._ctx.lineTo(r[n],r[n+1])}this._ctx.stroke()}},{key:"_sortFunc",value:function(e,t){var r=se.newInstance(e),n=se.newInstance(t),a=r.compare(n);return se.destroyInstance(r),se.destroyInstance(n),a}},{key:"render",value:function(e){var t=e.renderInfos,r=Object.keys(t);if(r&&r.length){var n,a;this._ctx.translate(-.5,-.5),r.sort(this._sortFunc);for(var o=0;o<r.length;o++)n=r[o],a=se.newInstance(n),this._prepareRenderContext(a),this._renderLine(t[n]),se.destroyInstance(a);this._ctx.translate(.5,.5)}}}]),r}(re.d);function ue(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var de=function(e){Object(o.a)(r,e);var t=ue(r);function r(e){return Object(n.a)(this,r),t.call(this,e)}return Object(a.a)(r,[{key:"render",value:function(e){for(var t,r,n,a=e.renderInfos,o=Object.keys(a),i=0;i<o.length;i++){t=o[i],this._prepareRenderContext(t),r=a[t];for(var s=0;s<r.length;s++)(n=r[s]).clipInfo&&(this._ctx.save(),this._ctx.beginPath(),this._ctx.rect(n.clipInfo[0],n.clipInfo[1],n.clipInfo[2],n.clipInfo[3]),this._ctx.clip()),this._renderText(n),this._renderUnderlineAndStrikethrough(n),n.clipInfo&&this._ctx.restore()}}},{key:"_prepareRenderContext",value:function(e){var t=e.split(Z.a),r=t[0],n=t[1],a=Number(t[2])||0;r&&(this._ctx.font=r),n&&(this._ctx.fillStyle=n,this._ctx.strokeStyle=n),a&&(this._ctx.lineWidth=Math.max(1,a))}},{key:"_renderText",value:function(e){this._ctx.beginPath(),this._ctx.fillText(e.text,e.pos[0],e.pos[1]),this._ctx.closePath()}},{key:"_renderUnderlineAndStrikethrough",value:function(e){e.underlineInfo&&this._renderLine(e.underlineInfo),e.strikethroughInfo&&this._renderLine(e.strikethroughInfo)}},{key:"_renderLine",value:function(e){this._ctx.beginPath(),this._ctx.moveTo(e[0],e[1]),this._ctx.lineTo(e[2],e[3]),this._ctx.stroke()}}]),r}(re.d);r("../node_modules/core-js/modules/es.array.fill.js");function he(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var fe=function(e){Object(o.a)(r,e);var t=he(r);function r(e){return Object(n.a)(this,r),t.call(this,e)}return Object(a.a)(r,[{key:"_renderGraphics",value:function(e){var t;e.clipInfo&&(this._ctx.save(),this._ctx.beginPath(),(t=this._ctx).rect.apply(t,Object(c.a)(e.clipInfo)),this._ctx.clip());var r=e.path;this._ctx.beginPath(),this._ctx.moveTo(r[0],r[1]);for(var n=2;n<r.length;n+=2)this._ctx.lineTo(r[n],r[n+1]);this._ctx.closePath(),this._ctx.fill(),e.clipInfo&&this._ctx.restore()}},{key:"render",value:function(e){var t=this,r=e.renderInfos;r.canvasPatternInfo.forEach((function(e){t._ctx.fillStyle=e.canvasPattern,t._renderGraphics({path:e.path,clipInfo:e.clipInfo})}));var n=Object.keys(r.colorInfo);if(n&&n.length)for(var a,o,i=0;i<n.length;i++)if(o=n[i],(a=r.colorInfo[o])&&a.length){this._ctx.fillStyle=o;for(var s=0;s<a.length;s++)this._renderGraphics(a[s])}}}]),r}(re.d),pe=r("./src/core/view/spreadsheet-view/render-manager/alloy-excel/canvas/renderer/BitmapRenderer.ts");function _e(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var me=function(e){Object(o.a)(r,e);var t=_e(r);function r(e){return Object(n.a)(this,r),t.call(this,e)}return Object(a.a)(r,[{key:"render",value:function(e){for(var t=e.renderInfos,r=0;r<t.length;r++){var n=t[r].roundRectProp,a=t[r].roundRectInfo;this._prepareRenderContext(n),this._drawSingleRoundRect(n,a)}}},{key:"_prepareRenderContext",value:function(e){this._ctx.lineWidth=e.borderWidth||1,e.fillColor&&(this._ctx.fillStyle=e.fillColor),e.strokeColor&&(this._ctx.strokeStyle=e.strokeColor)}},{key:"_drawSingleRoundRect",value:function(e,t){var r,n=t.rect,a=t.radius,o=t.clipInfo;o&&(this._ctx.save(),this._ctx.beginPath(),(r=this._ctx).rect.apply(r,Object(c.a)(o)),this._ctx.clip());var i=[n[0]+a,n[1]],s=[n[0]+n[2],n[1]],l=[n[0]+n[2],n[1]+n[3]],u=[n[0],n[1]+n[3]],d=[n[0],n[1]];this._ctx.beginPath(),this._ctx.moveTo(i[0],i[1]),this._ctx.arcTo(s[0],s[1],l[0],l[1],a),this._ctx.arcTo(l[0],l[1],u[0],u[1],a),this._ctx.arcTo(u[0],u[1],d[0],d[1],a),this._ctx.arcTo(d[0],d[1],i[0],i[1],a),e.strokeColor&&this._ctx.stroke(),e.shadowInfo&&(e.shadowInfo.shadowColor&&(this._ctx.shadowColor=e.shadowInfo.shadowColor),e.shadowInfo.shadowOffsetX&&(this._ctx.shadowOffsetX=e.shadowInfo.shadowOffsetX),e.shadowInfo.shadowOffsetY&&(this._ctx.shadowOffsetY=e.shadowInfo.shadowOffsetY),e.shadowInfo.shadowBlur&&(this._ctx.shadowBlur=e.shadowInfo.shadowBlur),this._ctx.stroke(),this._ctx.shadowColor="",this._ctx.shadowOffsetX=0,this._ctx.shadowOffsetY=0,this._ctx.shadowBlur=0),e.fillColor&&this._ctx.fill(),o&&this._ctx.restore()}}]),r}(re.d),ve=function(){function e(t){Object(n.a)(this,e),this.level=t}return Object(a.a)(e,[{key:"compare",value:function(e){return this.level>e.level?1:-1}}]),e}();function ge(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var be=function(e){Object(o.a)(r,e);var t=ge(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e))._renderInfos=[],a}return Object(a.a)(r,[{key:"collect",value:function(e){this._renderInfos.push(e)}},{key:"clear",value:function(){this._renderInfos=[]}},{key:"renderInfos",get:function(){return this._renderInfos}}]),r}(ve);function ye(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var we=function(e){Object(o.a)(r,e);var t=ye(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e))._renderInfos={colorInfo:{},canvasPatternInfo:[]},a}return Object(a.a)(r,[{key:"collect",value:function(e){void 0===e.canvasPattern?(this._renderInfos.colorInfo.hasOwnProperty(e.color)||(this._renderInfos.colorInfo[e.color]=[]),this._renderInfos.colorInfo[e.color].push(e.graphicsInfo)):this._renderInfos.canvasPatternInfo.push({path:e.graphicsInfo.path,clipInfo:e.graphicsInfo.clipInfo,canvasPattern:e.canvasPattern})}},{key:"clear",value:function(){this._renderInfos={colorInfo:{},canvasPatternInfo:[]}}},{key:"renderInfos",get:function(){return this._renderInfos}}]),r}(ve);function Re(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var Ee=function(e){Object(o.a)(r,e);var t=Re(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e))._renderInfos={},a}return Object(a.a)(r,[{key:"_toHash",value:function(e){return"".concat(e.style,"-").concat(e.width,"-").concat(e.color?e.color.hex:G.n.hex)}},{key:"collect",value:function(e){if(e.lineProp.style!==d.a.NONE){var t=this._toHash(e.lineProp);this._renderInfos[t]||(this._renderInfos[t]=[]),this._renderInfos[t].push(Object(c.a)(e.line))}}},{key:"clear",value:function(){this._renderInfos={}}},{key:"renderInfos",get:function(){return this._renderInfos}}]),r}(ve);function Ce(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var je=function(e){Object(o.a)(r,e);var t=Ce(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e))._renderInfos={},a}return Object(a.a)(r,[{key:"collect",value:function(e){var t=e.textPropHash;this._renderInfos.hasOwnProperty(t)||(this._renderInfos[t]=[]),this._renderInfos[t].push(e.textInfo)}},{key:"clear",value:function(){this._renderInfos={}}},{key:"renderInfos",get:function(){return this._renderInfos}}]),r}(ve);function Oe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var Se=function(e){Object(o.a)(r,e);var t=Oe(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e))._renderInfos=[],a}return Object(a.a)(r,[{key:"collect",value:function(e){this._renderInfos.push({roundRectProp:e.roundRectProp,roundRectInfo:e.roundRectInfo})}},{key:"clear",value:function(){this._renderInfos.length=0}},{key:"renderInfos",get:function(){return this._renderInfos}}]),r}(ve),De=function(){function e(t){Object(n.a)(this,e),this._ctx=t,this._lineRenderer=new ce(this._ctx),this._textRenderer=new de(this._ctx),this._graphicsRender=new fe(this._ctx),this._bitmapRenderer=new pe.a(this._ctx),this._roundRectRenderer=new me(this._ctx)}return Object(a.a)(e,[{key:"render",value:function(e){var t=this;e.collectors.forEach((function(e){switch(e.constructor){case be:t._bitmapRenderer.render(e);break;case we:t._graphicsRender.render(e);break;case Ee:t._lineRenderer.render(e);break;case je:t._textRenderer.render(e);break;case Se:t._roundRectRenderer.render(e);default:return}}))}}]),e}(),xe=(r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.map.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/esnext.map.delete-all.js"),r("../node_modules/core-js/modules/esnext.map.every.js"),r("../node_modules/core-js/modules/esnext.map.filter.js"),r("../node_modules/core-js/modules/esnext.map.find.js"),r("../node_modules/core-js/modules/esnext.map.find-key.js"),r("../node_modules/core-js/modules/esnext.map.includes.js"),r("../node_modules/core-js/modules/esnext.map.key-of.js"),r("../node_modules/core-js/modules/esnext.map.map-keys.js"),r("../node_modules/core-js/modules/esnext.map.map-values.js"),r("../node_modules/core-js/modules/esnext.map.merge.js"),r("../node_modules/core-js/modules/esnext.map.reduce.js"),r("../node_modules/core-js/modules/esnext.map.some.js"),r("../node_modules/core-js/modules/esnext.map.update.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),function(){function e(){Object(n.a)(this,e),this._collectorVector=[],this._collectorMap=new Map,this._textCollector=new je(re.b[re.c.TextRenderer]),this._lineCollector=new Ee(re.b[re.c.LineRenderer]),this._graphicsCollector=new we(re.b[re.c.GraphicsRender]),this._bitmapCollector=new be(re.b[re.c.BitmapRenderer]),this._roundRectCollector=new Se(re.b[re.c.RoundRectRenderer]),this._collectorVector=[this._textCollector,this._lineCollector,this._graphicsCollector,this._bitmapCollector,this._roundRectCollector],this._sort(),this._collectorMap.set("DefaultText",this._textCollector),this._collectorMap.set("DefaultLine",this._lineCollector),this._collectorMap.set("DefaultGraphics",this._graphicsCollector),this._collectorMap.set("DefaultBitmap",this._bitmapCollector),this._collectorMap.set("DefaultRoundRect",this._roundRectCollector)}return Object(a.a)(e,[{key:"add",value:function(e,t){if(this._collectorMap.has(e))throw new Error("\u6536\u96c6\u5668\u91cd\u540d\uff0c\u8bf7\u68c0\u67e5");this._collectorMap.set(e,t),this._collectorVector.push(t),this._sort()}},{key:"get",value:function(e){return this._collectorMap.get(e)}},{key:"clear",value:function(){this._collectorVector.forEach((function(e){e.clear()}))}},{key:"generateCollector",value:function(e,t){switch(e){case re.c.LineRenderer:return new Ee(t);case re.c.TextRenderer:return new je(t);case re.c.BitmapRenderer:return new be(t);case re.c.GraphicsRender:return new we(t);case re.c.RoundRectRenderer:return new Se(t);default:throw new Error("Error-RenderCollector: generateCollector")}}},{key:"_sort",value:function(){this._collectorVector.sort((function(e,t){return e.compare(t)}))}},{key:"textCollector",get:function(){return this._textCollector}},{key:"lineCollector",get:function(){return this._lineCollector}},{key:"graphicsCollector",get:function(){return this._graphicsCollector}},{key:"bitmapCollector",get:function(){return this._bitmapCollector}},{key:"roundRectCollector",get:function(){return this._roundRectCollector}},{key:"collectors",get:function(){return this._collectorVector}}]),e}()),ke=r("./src/core/view/spreadsheet-view/render-manager/renderUtil.ts");function Te(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var Ae=function(e){Object(o.a)(r,e);var t=Te(r);function r(e,a,o){var i;return Object(n.a)(this,r),(i=t.call(this,a))._afterAreaRenderEventData={fromRow:0,toRow:0,fromCol:0,toCol:0,offsetX:0,offsetY:0},i._matrix=o,i._initStage(e),i._initRenderEngine(),i._initCollectEngine(),i._initContent(),i}return Object(a.a)(r,[{key:"resize",value:function(){var e=this._container.offsetWidth,t=this._container.offsetHeight;this._width=e,this._height=t,Ie(this._canvas,e,t);var r=this._matrix;this._ctx.setTransform(r.a*window.devicePixelRatio,r.b*window.devicePixelRatio,r.c*window.devicePixelRatio,r.d*window.devicePixelRatio,r.e*window.devicePixelRatio,r.f*window.devicePixelRatio)}},{key:"clear",value:function(){this._ctx.clearRect(0,0,this.canvas.width/Math.min(1,this._matrix.a),this.canvas.height/Math.min(1,this._matrix.d))}},{key:"applyMatrixToCanvas",value:function(e){this._matrix=e,this._ctx.setTransform(e.a*window.devicePixelRatio,e.b*window.devicePixelRatio,e.c*window.devicePixelRatio,e.d*window.devicePixelRatio,e.e*window.devicePixelRatio,e.f*window.devicePixelRatio)}},{key:"renderRowHead",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._ctx.save(),this._ctx.textBaseline="middle",this._ctx.textAlign="center",this._rowHead.collect(e,t,r),this.renderEngine.render(this._collectEngine),this._ctx.restore(),this._collectEngine.clear()}},{key:"renderColHead",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._ctx.save(),this._ctx.textBaseline="middle",this._ctx.textAlign="center",this._colHead.collect(e,t,r),this._renderEngine.render(this._collectEngine),this._ctx.restore(),this._collectEngine.clear()}},{key:"renderCorner",value:function(){this._corner.collect(),this.renderEngine.render(this._collectEngine),this._collectEngine.clear()}},{key:"renderCells",value:function(e,t,n,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6?arguments[6]:void 0,l=this._body.collect(e,t,n,a,o,i);s?(s=Object(ke.b)(s),this._body.clearRect(s)):this._body.clearRect(l),this._afterAreaRenderEventData.fromRow=e,this._afterAreaRenderEventData.toRow=t,this._afterAreaRenderEventData.fromCol=n,this._afterAreaRenderEventData.toCol=a,this._afterAreaRenderEventData.offsetY=o,this._afterAreaRenderEventData.offsetX=i,this.emitter.emit(r.EVENT.AFTER_AREA_RENDER,this._afterAreaRenderEventData),this.renderEngine.render(this._collectEngine),this._collectEngine.clear()}},{key:"_initStage",value:function(e){var t=document.createElement("canvas"),r=t.getContext("2d"),n=e.offsetWidth,a=e.offsetHeight;this._width=n,this._height=a,Ie(t,n,a),e.appendChild(t),this._container=e,this._canvas=t,this._ctx=r,this._setupCanvasMatrix()}},{key:"_initContent",value:function(){this._corner=new te(this),this._body=new q(this),this._colHead=new $(this),this._rowHead=new ee(this)}},{key:"_setupCanvasMatrix",value:function(){this._matrix.reset(),this.applyMatrixToCanvas(this._matrix)}},{key:"_initRenderEngine",value:function(){this._renderEngine=new De(this.ctx)}},{key:"_initCollectEngine",value:function(){this._collectEngine=new xe}},{key:"canvas",get:function(){return this._canvas}},{key:"ctx",get:function(){return this._ctx}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"container",get:function(){return this._container}},{key:"renderEngine",get:function(){return this._renderEngine}},{key:"collectEngine",get:function(){return this._collectEngine}}]),r}(l.a);function Ie(e,t,r){var n=window.devicePixelRatio||1,a=Math.round(t*n),o=Math.round(r*n);e.setAttribute("width",String(a)),e.setAttribute("height",String(o)),e.style.width="".concat(a/n,"px"),e.style.height="".concat(o/n,"px")}Ae.EVENT={AFTER_CELL_RENDER:"afterCellRender",AFTER_AREA_RENDER:"afterAreaRender",AFTER_ROW_HEAD_RENDER:"afterRowHeadRender",AFTER_COL_HEAD_RENDER:"afterColHeadRender",AFTER_CORNER_RENDER:"afterCornerRender"};var Ne=t.a=Ae},"./src/core/view/spreadsheet-view/render-manager/alloy-excel/table/Table.ts":function(e,t,r){"use strict";var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("../packages/lib/EventEmitter.ts"),i=function(){function e(t){Object(n.a)(this,e),this.emitter=new o.a,this._interface=t}return Object(a.a)(e,[{key:"interface",get:function(){return this._interface}}]),e}();t.a=i},"./src/core/view/spreadsheet-view/render-manager/alloy-excel/table/body/cell-renders/BaseCellRender.ts":function(e,t,r){"use strict";var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=function(){function e(t){Object(n.a)(this,e),this.transformTable=t.transformTable}return Object(a.a)(e,[{key:"renderTextCheck",value:function(e){return!1}},{key:"renderBackgroundCheck",value:function(e){return!1}},{key:"renderBackground",value:function(e,t){}},{key:"renderText",value:function(e,t){}}]),e}();t.a=o},"./src/core/view/spreadsheet-view/render-manager/alloy-excel/table/body/cell-renders/impl/ImageCellRender.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return b}));r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),i=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),s=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),l=r("./src/core/utils/ImageLoader.ts"),c=r("../packages/model/src/embedded/index.ts"),u=r("./src/core/view/spreadsheet-view/row-col-accessor/RowcolAccessor.ts"),d=r("./src/core/view/spreadsheet-view/transform-table/cell.ts"),h=r("./src/core/view/spreadsheet-view/render-manager/alloy-excel/table/body/cell-renders/BaseCellRender.ts"),f=r("../node_modules/lodash/set.js"),p=r.n(f),_=r("./src/core/view/spreadsheet-view/render-manager/alloy-excel/table/body/cell-renders/util.ts");function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var v=function(e){Object(o.a)(r,e);var t=m(r);function r(){return Object(n.a)(this,r),t.apply(this,arguments)}return Object(a.a)(r,[{key:"renderText",value:function(e,t){var r=t.x,n=t.y,a=t.cellWidth,o=t.cellHeight,i=t.transformCell,s=i.image,c=i.horizontalAlign,u=i.verticalAlign,d=t.row,h=t.col,f=e.bitmapCollector,_=s.url,m=l.a.getCachedImage(_);if(m){var v=g({image:s,cellWidth:a-1,cellHeight:o-1,horizontalAlign:c,verticalAlign:u,imageElement:m}),b={dx:r+v.dx,dy:n+v.dy,dWidth:v.dWidth,dHeight:v.dHeight,img:m,sx:v.sx,sy:v.sy,sWidth:v.sWidth,sHeight:v.sHeight};f.collect(b),window.__DWT__recordCellImage&&p()(window,["cellImageConfigs",d,h],b)}}},{key:"renderTextCheck",value:function(e){var t=e.transformCell.image;return!(!t||!t.url)&&(!l.a.getCachedImage(t.url)&&l.a.loadImage(t.url).then((function(){try{SpreadsheetApp.view.canvas.renderApi.renderNextTick()}catch(e){console.error(e)}})),!0)}}]),r}(h.a);function g(e){var t=e.image,r=e.cellWidth,n=e.cellHeight,a=e.horizontalAlign,o=e.verticalAlign,i=e.imageElement,s=t.position.overlayPosition,l=s.widthPixels,c=s.heightPixels,u=t.clipInfo,d=u.clipBottom,h=u.clipLeft,f=u.clipRight,p=u.clipTop,m=l+h+f,v=c+p+d,g=0,b=0,y=0,w=0;if(i){var R=i.naturalWidth,E=i.naturalHeight;g=R*l/m,b=E*c/v,y=R*h/m,w=E*p/v}var C=l/c,j=0,O=0;C>r/n?O=(j=r)/C:j=(O=n)*C;var S=j/l,D=Object(_.b)({cellWidth:r,cellHeight:n,dWidth:j,dHeight:O,horizontalAlign:a,verticalAlign:o});return{dx:D.dx,dy:D.dy,dWidth:j,dHeight:O,scale:S,sx:y,sy:w,sWidth:g,sHeight:b}}function b(e,t,r){var n=e.getCellImage(t,r),a=e.getCellDataAtPosition(t,r);if(!n||!a)return null;var o=g({image:n,cellWidth:e.data.getColWidth(r),cellHeight:Object(u.a)(e,t),horizontalAlign:Object(d.b)(a),verticalAlign:Object(d.g)(a)}),i=o.dx,s=o.dy,l=o.scale,h=n.position.overlayPosition,f=h.zIndex,p=h.heightPixels,_=h.widthPixels,m=n.clipInfo,v=m.clipBottom,b=m.clipLeft,y=m.clipRight,w=m.clipTop;return{overlayPosition:new c.OverlayPosition({anchorCell:{rowIndex:t,colIndex:r},offsetXpixels:i,offsetYpixels:s,zIndex:f,heightPixels:p*l,widthPixels:_*l}),clipInfo:new c.EmbeddedImageClip({clipLeft:b*l,clipRight:y*l,clipTop:w*l,clipBottom:v*l})}}t.b=v},"./src/core/view/spreadsheet-view/render-manager/alloy-excel/table/body/cell-renders/impl/icons/checkbox-selected.svg":function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgZmlsbC1ydWxlPSJldmVub2RkIj48cmVjdCBmaWxsPSIjMWU2ZmZmIiB4PSIuNSIgeT0iLjUiIHdpZHRoPSIxNSIgaGVpZ2h0PSIxNSIgcng9IjIiIHN0cm9rZT0iIzFlNmZmZiIvPjxwYXRoIGQ9Ik0zLjY0IDUuNkw4LjkgMCAxMCAxLjE2OCAzLjU3IDggMCA0LjIwNGwxLjE3LTEuMjQyeiIgZmlsbD0iI2ZmZiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMyw0KSIvPjwvc3ZnPg=="},"./src/core/view/spreadsheet-view/render-manager/alloy-excel/table/body/cell-renders/impl/icons/checkbox-unselected.svg":function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiI+PHJlY3QgeD0iLjUiIHk9Ii41IiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiIHJ4PSIyIiBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIGZpbGwtcnVsZT0iZXZlbm9kZCIgc3Ryb2tlLW9wYWNpdHk9Ii4xNiIvPjwvc3ZnPg=="},"./src/core/view/spreadsheet-view/render-manager/alloy-excel/table/body/cell-renders/util.ts":function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return a}));r("../node_modules/core-js/modules/es.number.constructor.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.match.js");function n(e){var t=e.cellWidth,r=e.cellHeight,n=e.horizontalAlign,a=e.verticalAlign,o=e.dWidth,i=e.dHeight,s=e.marginX,l=void 0===s?0:s,c=e.marginY,u=void 0===c?0:c,d=0,h=0;switch(n.value){case"left":d=l;break;case"center":d=(t-o)/2;break;case"right":d=t-o-l}switch(a.value){case"top":h=u;break;case"middle":h=(r-i)/2;break;case"bottom":h=r-i-u}return{dx:d,dy:h}}function a(e){var t=e.match(/^([\d\\.]+)%$/);if(!t)return null;var r=Number(t[1]);return isNaN(r)||r<0||r>100?null:r}},"./src/core/view/spreadsheet-view/render-manager/alloy-excel/utils.ts":function(e,t,r){"use strict";var n,a;r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return a})),function(e){e[e.NONE=0]="NONE",e[e.THIN=3]="THIN",e[e.MEDIUM=2]="MEDIUM",e[e.DASHED=1]="DASHED",e[e.DOTTED=4]="DOTTED",e[e.THICK=5]="THICK",e[e.DOUBLE=6]="DOUBLE",e[e.HAIR=7]="HAIR",e[e.MEDIUM_DASHED=8]="MEDIUM_DASHED",e[e.DASH_DOT=9]="DASH_DOT",e[e.MEDIUM_DASH_DOT=10]="MEDIUM_DASH_DOT",e[e.DASH_DOT_DOT=11]="DASH_DOT_DOT",e[e.MEDIUM_DASH_DOT_DOT=12]="MEDIUM_DASH_DOT_DOT",e[e.SLANTED_DASH_DOT=13]="SLANTED_DASH_DOT"}(n||(n={})),function(e){e[e.NONE=0]="NONE",e[e.THIN=1]="THIN",e[e.MEDIUM=2]="MEDIUM",e[e.THICK=3]="THICK"}(a||(a={}))},"./src/core/view/spreadsheet-view/render-manager/renderUtil.ts":function(e,t,r){"use strict";r.d(t,"c",(function(){return o})),r.d(t,"g",(function(){return i})),r.d(t,"d",(function(){return s})),r.d(t,"e",(function(){return l})),r.d(t,"f",(function(){return c})),r.d(t,"b",(function(){return u})),r.d(t,"a",(function(){return n}));r("../node_modules/core-js/modules/es.number.constructor.js"),r("../node_modules/core-js/modules/es.number.is-integer.js");var n,a=r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js");function o(e,t,r){e.save(),e.beginPath(),e.rect.apply(e,Object(a.a)(t)),e.clip(),e.closePath(),r(),e.restore()}function i(e,t,r,n){for(var a=r.row.frozen,o=a.viewSize,i=a.to,s=r.row.flow,l=s.offsetSize,c=s.from,u={fromRow:i,toRow:i},d=e+l-o-n.colHeadHeight,h=d+t,f=r.row.flow.areaTop,p=f.length,_=0;_<p;_+=1){var m=f[_];if(m<=d&&(u.fromRow+=1),m>=h)break;u.toRow+=1}return u.fromRow=-1===u.fromRow?0:u.fromRow,u.toRow=-1===u.toRow?0:u.toRow,u.fromRow=u.fromRow<c?c:u.fromRow,u.toRow=u.toRow<c?c:u.toRow,u}function s(e,t,r,n){for(var a=r.col.frozen,o=a.viewSize,i=a.to,s=r.col.flow,l=s.offsetSize,c=s.from,u={fromCol:i,toCol:i},d=e+l-o-n.rowHeadWidth,h=d+t,f=r.col.flow.areaLeft,p=f.length,_=0;_<p;_+=1){var m=f[_];if(m<=d&&(u.fromCol+=1),m>=h)break;u.toCol+=1}return u.fromCol=-1===u.fromCol?0:u.fromCol,u.toCol=-1===u.toCol?0:u.toCol,u.fromCol=u.fromCol<c?c:u.fromCol,u.toCol=u.toCol<c?c:u.toCol,u}function l(e,t,r,a){var o=r.row.frozen.viewSize,i=r.row.flow.viewSize,s=r.col.frozen.viewSize,l=r.col.flow.viewSize;return[a.rowHeadWidth+(t===n.FROZEN?0:s),a.colHeadHeight+(e===n.FROZEN?0:o),t===n.FROZEN?s:l,e===n.FROZEN?o:i]}function c(e){if(function(e){return e%1===0}(e))return e;var t=Math.floor(e),r=e-t,n=Math.floor(100*r);return n<=20?t:n>=70?t+1:t+.5}function u(e){var t=Math.floor(e[0]+e[2]),r=Math.floor(e[1]+e[3]);return e[0]=Number.isInteger(e[0])?e[0]+.5:Math.ceil(e[0]),e[2]=t-e[0],e[1]=Number.isInteger(e[1])?e[1]+.5:Math.ceil(e[1])+.5,e[3]=r-e[1]-.5,e}!function(e){e[e.FROZEN=0]="FROZEN",e[e.FLOW=1]="FLOW"}(n||(n={}))},"./src/core/view/spreadsheet-view/resize/Resize.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("../node_modules/@babel/runtime/helpers/esm/get.js"),i=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),s=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),l=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),c=r("./src/core/view/utils/base-func.ts"),u=r("../packages/lib/index.ts");function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var h=function(t){Object(i.a)(s,t);var r=d(s);function s(){var t;if(Object(n.a)(this,s),(t=r.call(this))._onResize=new u.a,t.onResize=t._onResize.event,t._readyResize=!1,t._onVisiableResize=function(){"visible"===document.visibilityState&&t._onResize.fire(),document.removeEventListener("visibilitychange",t._onVisiableResize)},t.onPixelRatioChange=function(){t._devicePixelRatio!==e.devicePixelRatio&&(t._devicePixelRatio=e.devicePixelRatio,t.resize())},t._handleResize=function(){if("hidden"===document.visibilityState){if(t._readyResize)return;t._readyResize=!0,document.addEventListener("visibilitychange",t._onVisiableResize)}else t._onResize.fire()},t._devicePixelRatio=e.devicePixelRatio,t._throttleHandleResize=Object(c.f)(t._handleResize,30),"undefined"!==typeof window){window.addEventListener("resize",t._throttleHandleResize);var a="(resolution: ".concat(window.devicePixelRatio,"dppx)");window.matchMedia(a).addListener(t.onPixelRatioChange)}return t}return Object(a.a)(s,[{key:"dispose",value:function(){if(Object(o.a)(Object(l.a)(s.prototype),"dispose",this).call(this),document.removeEventListener("visibilitychange",this._onVisiableResize),"undefined"!==typeof window){window.removeEventListener("resize",this._throttleHandleResize);var e="(resolution: ".concat(window.devicePixelRatio,"dppx)");window.matchMedia(e).removeListener(this.onPixelRatioChange)}}},{key:"resize",value:function(){this._throttleHandleResize()}}]),s}(r("../packages/services/src/dispose.ts").a);t.a=h}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/view/spreadsheet-view/row-col-accessor/RowcolAccessor.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return b}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js");var n=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=r("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),s=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),l=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),c=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),u=r("./src/core/view/spreadsheet-view/accessor/BaseRowAccessor.ts"),d=r("./src/core/view/config/default.ts");function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(l.a)(this,r)}}var f=function(e){Object(s.a)(r,e);var t=h(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this))._handleRowChange=function(e){for(var t=e.ranges,r=0;r<t.length;r++)for(var a=t[r],o=a.startIndex;o<=a.endIndex;o++)n._updateRowDisplayHeightIfNeed(o)},n._handleColChange=function(e){for(var t=0;t<n._spreadsheet.activeSheet.getRowCount();t++)n._updateRowDisplayHeightIfNeed(t)},n._handleCellsChange=function(e){for(var t=e.startRow,r=e.endRow,a=t;a<=r;a++)n._updateRowDisplayHeightIfNeed(a)},n._dataCallView=e.dataCallView,n._spreadsheet=e.spreadsheet,n._getSetHeight=e.getSetHeight,n._calcRowDisplayHeight=e.calc,n._register(n._dataCallView.onSetRowHeight(n._handleRowChange)),n._register(n._dataCallView.onSetColWidth(n._handleColChange)),n._register(n._dataCallView.onSetColVisible(n._handleColChange)),n._register(n._dataCallView.onUpdateCells(n._handleCellsChange)),n}return Object(o.a)(r,[{key:"_updateRowDisplayHeightIfNeed",value:function(e){"undefined"===typeof this._getSetHeight(e)&&this._calcRowDisplayHeight(e)}}]),r}(r("../packages/services/src/dispose.ts").a),p=r("./src/core/view/spreadsheet-view/paragraph-accessor/ParagraphAccessor.ts");function _(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(l.a)(this,r)}}var m=function(e){Object(s.a)(r,e);var t=_(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e))._calcRowDisplayHeight=function(e){var t=v(n._spreadsheet.activeSheet,e,n._paragraphAccessor);n._setRowDisplayHeight(e,t)},n._paragraphAccessor=e.paragraphAccessor,n._spreadsheet=e.spreadsheet,n._recalculateListener=n._register(new f({dataCallView:n._dataCallView,spreadsheet:n._spreadsheet,getSetHeight:n.getRowSetHeight.bind(Object(i.a)(n)),calc:n._calcRowDisplayHeight})),n._init(),n}return Object(o.a)(r,[{key:"refresh",value:function(){this._init()}},{key:"getRowSetHeight",value:function(e){return g(this._spreadsheet.activeSheet,e)}},{key:"getColSetWidth",value:function(e){return this._spreadsheet.activeSheet.data.getColWidth(e)>>0}},{key:"getRowDisplayHeight",value:function(e){var t=this.getRowSetHeight(e);return void 0!==t?t:(this._rowData.row_display_height[e]||d.r)>>0}},{key:"getRowCount",value:function(){return this._spreadsheet.activeSheet.getRowCount()}},{key:"getColCount",value:function(){return this._spreadsheet.activeSheet.getColCount()}},{key:"getFrozenRowCount",value:function(){return this._spreadsheet.activeSheet.getFrozenRowCount()}},{key:"getFrozenColCount",value:function(){return this._spreadsheet.activeSheet.getFrozenColCount()}},{key:"isRowHidden",value:function(e){var t=this._spreadsheet.activeSheet.getRowProperties(e);return!(!t||!t.hiddenByFilter&&!t.hiddenByUser)}},{key:"isColHidden",value:function(e){var t=this._spreadsheet.activeSheet.getColProperties(e);return!(!t||!t.hiddenByFilter&&!t.hiddenByUser)}},{key:"_init",value:function(){this._rowData=Object(n.a)({},"row_display_height",[]);for(var e=this._spreadsheet.activeSheet.getRowCount()-1,t=0;t<=e;t++)this._calcRowDisplayHeight(t)}},{key:"_setRowDisplayHeight",value:function(e,t){this._rowData.row_display_height[e]!==t&&(this._rowData.row_display_height[e]=t,this._dataCallView.setRowHeight(e,t))}}]),r}(u.a);function v(e,t,r){for(var n=[],a=0;a<e.getColCount();a++){var o=e.getCellDataAtPosition(t,a);if(null===o||void 0===o?void 0:o.getMergeReference()){var i;if(o.getMergeReference().startColIndex!==a)continue;var s=null===(i=o.getMergeReference())||void 0===i?void 0:i.getRowCount();if(s&&s>1)continue}var l=null;(l=r?r.getParagraph(t,a):Object(p.a)(e,t,a).paragraph)&&n.push(l.height)}return Math.max.apply(Math,n.concat([d.r]))}function g(e,t){var r=e.getRowProperties(t);if(r&&null!==r.pixelSize&&0!==r.pixelSize)return r.pixelSize}function b(e,t,r){var n=g(e,t);return void 0!==n?n:(v(e,t,r)||d.r)>>0}t.b=m},"./src/core/view/spreadsheet-view/table-view/utils.ts":function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return u})),r.d(t,"c",(function(){return d})),r.d(t,"d",(function(){return h})),r.d(t,"e",(function(){return f})),r.d(t,"g",(function(){return p})),r.d(t,"f",(function(){return _})),r.d(t,"b",(function(){return m})),r.d(t,"h",(function(){return v})),r.d(t,"i",(function(){return g}));var n=r("./src/core/data/configService/spreadConfig.ts"),a=r("./src/core/feature/dataValidation/api/DataValidationUIUtils.ts"),o=r("../packages/model/src/range/index.ts"),i=r("./src/core/feature/dataValidation/type.ts"),s=r("../packages/model/src/cell/metadata/CustomDataType.ts"),l=r("../packages/model/src/cell/index.ts"),c=r("../packages/model/src/cell/LinkIconType.ts");function u(t,r,n,a,o,i){var s;null===(s=e.log)||void 0===s||s.info("flow fragmentCellDataToCellView");for(;r<n;)t.cellDataToCellView(r,Math.min(r+50-1,n),a,o),r+=50,null===i||void 0===i||i()}function d(e,t,r){if(null===e)return!1;var n=e.getBasicFilter();if(null===n||void 0===n)return!1;var a=e.getCellDataAtPosition(t,r),i=n.range,s=null===a||void 0===a?void 0:a.getMergeReference();if(s){var l=new o.GridRange(i.sheetId,i.startRowIndex,i.startRowIndex,i.startColIndex,i.endColIndex);return t=s.startRowIndex,r=s.startColIndex,s.isCross(l)}return t===i.startRowIndex&&r>=i.startColIndex&&r<=i.endColIndex}function h(e,t,r){var n;if(null===e)return!1;if(d(e,t,r))return!1;var o=e.getCellDataAtPosition(t,r);if(!o)return!1;if((null===(n=o.getMetadata())||void 0===n?void 0:n.customDataType)===s.o.SELECT)return!0;var l=o.getMergeReference();l&&(t=l.startRowIndex,r=l.startColIndex);var c=Object(a.b)(e,t,r);return!(!c||c.validType!==i.c.LIST)}function f(e,t){var r=!1;window.clientVars.isLogin&&window.clientVars.ownerNick&&(r=!0);var n=t.sheetStatus.workbookStatus.canEdit,a=function(e,t){if(null===e)return!1;var r=e.getBasicFilter();if(null===r||void 0===r)return!1;var n=r.range;return t.sheetStatus.getRangeCanEdit(n)}(e,t);return r&&n&&!a}function p(e){var t=!1,r=e.sheetStatus.workbookStatus.canEdit;return n.a.getConfig("isLogin")&&(t=!0),t&&r}function _(e,t,r){var n=e.getCellDataAtPosition(t,r);return!!n&&(!(!n.getHyperlink()&&!n.getHyperlinkRuns())&&((null===n||void 0===n?void 0:n.getHyperlinkType())!==l.HYPERLINK_TYPE.NORMAL&&n.getLinkIconStatus()===c.a.WITH_IMAGE))}function m(e,t,r){var n=e.getCellViewAtPosition(t,r);return(null===n||void 0===n?void 0:n.mergeParent)?{row:t+n.mergeParent.y,col:r+n.mergeParent.x}:{row:t,col:r}}function v(e){e.mergeData&&(e.mergeData.colCount-=1,1===e.mergeData.colCount&&1===e.mergeData.rowCount&&delete e.mergeData)}function g(e){e.mergeData&&(e.mergeData.rowCount-=1,1===e.mergeData.colCount&&1===e.mergeData.rowCount&&delete e.mergeData)}}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/view/spreadsheet-view/transform-table/CacheDimensionHeadStyle.ts":function(e,t,r){"use strict";var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("./src/core/view/spreadsheet-view/render-manager/alloy-excel/utils.ts"),i=r("./src/core/view/spreadsheet-view/transform-table/head.ts"),s=r("./src/core/view/config/default.ts"),l=function(){function e(){Object(n.a)(this,e),this.hidden=!1,this.width=s.g,this.height=s.r,this.borderTop=null,this.borderRight=null,this.borderBottom=null,this.borderLeft=null,this.background=i.a[0],this.color=i.b[0],this.fitLineExpand=0}return Object(a.a)(e,[{key:"reset",value:function(){this.hidden=!1,this.width=o.b.THIN,this.borderTop=null,this.borderRight=null,this.borderBottom=null,this.borderLeft=null,this.fitLineExpand=0}}]),e}();t.a=l},"./src/core/view/spreadsheet-view/transform-table/border.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"f",(function(){return l})),r.d(t,"e",(function(){return c})),r.d(t,"c",(function(){return u})),r.d(t,"d",(function(){return d})),r.d(t,"b",(function(){return h}));var n,a=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=r("../packages/model/src/cell/format/BorderStyle.ts"),i=r("../packages/model/src/cell/format/colorUtils.ts"),s=(n={},Object(a.a)(n,o.a.NONE,0),Object(a.a)(n,o.a.HAIR,1),Object(a.a)(n,o.a.DASH_DOT,2),Object(a.a)(n,o.a.DASH_DOT_DOT,3),Object(a.a)(n,o.a.DOTTED,4),Object(a.a)(n,o.a.DASHED,5),Object(a.a)(n,o.a.THIN,6),Object(a.a)(n,o.a.MEDIUM_DASH_DOT_DOT,7),Object(a.a)(n,o.a.SLANTED_DASH_DOT,8),Object(a.a)(n,o.a.MEDIUM_DASH_DOT,9),Object(a.a)(n,o.a.MEDIUM_DASHED,10),Object(a.a)(n,o.a.MEDIUM,11),Object(a.a)(n,o.a.THICK,12),Object(a.a)(n,o.a.DOUBLE,13),n);function l(e){if(!e)return null;var t=e.getUserEnteredFormat();return t?t.getBorderTop():null}function c(e){if(!e)return null;var t=e.getUserEnteredFormat();return t?t.getBorderRight():null}function u(e){if(!e)return null;var t=e.getUserEnteredFormat();return t?t.getBorderBottom():null}function d(e){if(!e)return null;var t=e.getUserEnteredFormat();return t?t.getBorderLeft():null}function h(e,t){if(!t||null===t.style)return 1;if(!e||null===e.style)return-1;var r=function(e,t){if(!t.style)return 1;if(!e.style)return-1;return s[e.style]-s[t.style]}(e,t);return 0===r?function(e,t){if(!t)return 1;if(!e)return-1;return Object(i.compareColorByBrightness)(e.color,t.color)}(e,t):r}},"./src/core/view/spreadsheet-view/transform-table/cell.ts":function(e,t,r){"use strict";r.d(t,"f",(function(){return _})),r.d(t,"d",(function(){return m})),r.d(t,"c",(function(){return v})),r.d(t,"a",(function(){return g})),r.d(t,"b",(function(){return b})),r.d(t,"g",(function(){return y})),r.d(t,"h",(function(){return w})),r.d(t,"e",(function(){return R}));var n=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),a=r("./src/core/view/spreadsheet-view/transform-table/utils.ts"),o=r("./src/core/view/spreadsheet-view/model/Color.ts"),i=r("./src/core/view/config/default.ts"),s=r("../packages/model/src/index.ts"),l=r("./src/core/view/spreadsheet-view/model/HorizontalAlign.ts"),c=r("./src/core/view/spreadsheet-view/model/VerticalAlign.ts"),u=r("./src/core/view/spreadsheet-view/model/WrapStrategy.ts"),d=r("../node_modules/@tencent/tdocs-format-render/lib/index.js"),h=r("./src/core/view/spreadsheet-view/table-view/utils.ts"),f=r("./src/core/view/spreadsheet-view/model/CellPadding.ts"),p=r("../packages/model/src/cell/LinkIconType.ts");function _(e){var t,r=e.getEffectiveValue(),a=e.getFormattedValue();if(r&&r.type===s.Cell.EXTENDED_VALUE_TYPE.ERROR&&"object"===Object(n.a)(r.value))return(null===(t=r.value)||void 0===t?void 0:t.displayText)||"";var o=null;return a&&(a.type===s.Cell.FORMATTED_VALUE_TYPE.NORMAL||a.type===s.Cell.FORMATTED_VALUE_TYPE.ERROR)&&(o=a.value),o||""}function m(e,t,r){if(function(e,t,r){var n=e.getMergeReference();if(n){var a=n;return t===a.startRowIndex&&r===a.startColIndex}return!1}(e,t,r)){var n=e.getMergeReference();return{rowCount:n.getRowCount(),colCount:n.getColCount()}}return null}function v(e,t,r){var n=e.getMergeReference();if(n){var a=n,o=a.startColIndex-r,i=a.startRowIndex-t;if(o||i)return{x:o,y:i}}return null}function g(e){var t=[e.getConditionalFormatResult(),e.getEffectiveFormat(),e.getUserEnteredFormat()],r=Object(a.a)(t,"getBackgroundColor");return r?o.a.newInstanceByRGB(r.red,r.green,r.blue,r.alpha):i.a}function b(e){var t,r=[e.getConditionalFormatResult(),e.getEffectiveFormat(),e.getUserEnteredFormat()],n=Object(a.a)(r,"getHorizontalAlign");if((null===e||void 0===e?void 0:e.getLinkIconStatus())===p.a.WITH_IMAGE)return t=i.b;if(null!==n)t=n===s.Cell.Format.HORIZONTAL_ALIGN.LEFT?l.b.newInstance(l.a.LEFT):n===s.Cell.Format.HORIZONTAL_ALIGN.CENTER?l.b.newInstance(l.a.CENTER):l.b.newInstance(l.a.RIGHT);else if(!n&&e.getEffectiveValue()){var o=s.Cell.cellDataUtils.getExportFormat(e);t=o&&Object(d.isTextCell)(o.getNumberFormat())?l.b.newInstance(l.a.LEFT):e.getEffectiveValue().type===s.Cell.EXTENDED_VALUE_TYPE.BOOL||e.getEffectiveValue().type===s.Cell.EXTENDED_VALUE_TYPE.ERROR?l.b.newInstance(l.a.CENTER):e.getEffectiveValue().type===s.Cell.EXTENDED_VALUE_TYPE.NUMBER?l.b.newInstance(l.a.RIGHT):l.b.newInstance(l.a.LEFT)}else t=i.b;return t}function y(e){var t=[e.getConditionalFormatResult(),e.getEffectiveFormat(),e.getUserEnteredFormat()],r=Object(a.a)(t,"getVerticalAlign");return null!==r?r===s.Cell.Format.VERTICAL_ALIGN.TOP?c.b.newInstance(c.a.TOP):r===s.Cell.Format.VERTICAL_ALIGN.MIDDLE?c.b.newInstance(c.a.MIDDLE):c.b.newInstance(c.a.BOTTOM):i.d}function w(e){var t=[e.getConditionalFormatResult(),e.getEffectiveFormat(),e.getUserEnteredFormat()],r=Object(a.a)(t,"getWrapStrategy");return null!==r?r===s.Cell.Format.WRAP_STRATEGY.OVERFLOW_CELL?u.b.newInstance(u.a.NOWRAP):r===s.Cell.Format.WRAP_STRATEGY.WRAP?u.b.newInstance(u.a.NORMAL):i.e:i.e}function R(e,t,r){var n;return n=Object(h.c)(e,t,r)?f.a.ICON:(Object(h.d)(e,t,r),f.a.TEXT),{paddingLeft:Object(h.f)(e,t,r)?f.a.ICON:f.a.TEXT,paddingRight:n}}},"./src/core/view/spreadsheet-view/transform-table/head.ts":function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return u})),r.d(t,"d",(function(){return _})),r.d(t,"c",(function(){return m}));var n,a=r("./src/core/view/config/default.ts"),o=r("./src/core/view/spreadsheet-view/model/Color.ts"),i=r("./src/core/view/spreadsheet-view/render-manager/alloy-excel/utils.ts"),s=r("./src/core/view/spreadsheet-view/transform-table/CacheDimensionHeadStyle.ts"),l=/(mobile)/i.test(null===(n=e.navigator)||void 0===n?void 0:n.userAgent.toLowerCase()),c={0:o.a.newInstanceByHex("#f9fafb"),100:o.a.newInstanceByHex("#eaebec"),200:o.a.newInstanceByHex("#5f6266")},u={0:o.a.newInstanceByRGB(0,0,0,.88),100:o.a.newInstanceByRGB(0,0,0,.88),200:o.a.newInstanceByRGB(255,255,255,.88)},d={width:i.b.THIN,style:i.a.THIN,color:o.a.newInstanceByHex("#4b8cff")},h={0:null,100:l?null:d,200:l?null:d},f=new s.a,p=new s.a;function _(e,t,r){var n=r.status,o=r.size;return f.reset(),f.hidden=t.isRowHidden(e),f.height=o>=0?o:t.getRowDisplayHeight(e),f.background=c[n],f.color=u[n],f.borderBottom=a.l,f.borderRight=h[n],f.fitLineExpand=r.fitLineExpand,f}function m(e,t,r){var n=r.status,o=r.size;return p.reset(),p.hidden=t.isColHidden(e),p.width=o>=0?o:t.getColSetWidth(e),p.background=c[n],p.color=u[n],p.borderRight=a.l,p.borderBottom=h[n],p.fitLineExpand=r.fitLineExpand,p}}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/view/spreadsheet-view/transform-table/segment.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("./src/core/view/spreadsheet-view/model/VerticalAlign.ts"),a=r("./src/core/view/spreadsheet-view/utils.ts"),o=r("./src/core/view/spreadsheet-view/model/line/RichParagraph.ts"),i=r("./src/core/view/spreadsheet-view/model/line/SimpleParagraph.ts"),s=r("./src/core/view/spreadsheet-view/model/HorizontalAlign.ts");function l(e,t,r,s,l){var u=[];return t instanceof i.a?u.push({segments:[t.segment],offsetX:0,offsetY:0,width:t.width,height:t.height}):t instanceof o.a&&t.lines.forEach((function(e){u.push({segments:e.segments,offsetX:0,offsetY:0,width:e.width,height:e.height})})),u.length>0&&(function(e,t,r,a){var o=t.style.verticalAlign.value;(t.mergeData&&a>r||t.isAutoWrap()&&a>r)&&(o=n.a.TOP);var i=0;switch(o){case n.a.TOP:i=t.paddingTop;break;case n.a.MIDDLE:i=(r-a)/2;break;case n.a.BOTTOM:i=r-a-t.paddingBottom;break;default:console.error("verticalAlign: ",this._cell.style.verticalAlign)}for(var s=i,l=0;l<e.length;l++){var c=e[l].height,u=s+3*c/4;e[l].offsetY=Math.round(100*u)/100,s+=c>>0}}(u,e,Object(a.a)(r,e,s),t.height),function(e,t,r){for(var n=t.style.horizontalAlign.value,a=0;a<e.length;a++){var o=e[a];o.offsetX=c(t,n,o,r)}}(u,e,Object(a.b)(r,e,l))),u}function c(e,t,r,n){var a=0;switch(t){case s.a.LEFT:a=e.paddingLeft;break;case s.a.CENTER:a=(n-r.width)/2;break;case s.a.RIGHT:a=n-r.width-e.paddingRight}return a}},"./src/core/view/spreadsheet-view/transform-table/utils.ts":function(e,t,r){"use strict";function n(e,t){var r,n,a,o;for(r=0,n=e.length;r<n;r++)if((a=e[r])&&null!=(o=a[t]()))return o;return null}function a(e,t,r){for(var n,a=e.getColCount(),o=e.data.colMetadata;(t+=1)<a;)if(!(n=o[t])||!n.hiddenByFilter&&!n.hiddenByUser)return e.getCellDataAtPosition(r,t);return null}function o(e,t,r){for(var n,a=e.getRowCount(),o=e.data.rowMetadata;(r+=1)<a;)if(!(n=o[r])||!n.hiddenByFilter&&!n.hiddenByUser)return e.getCellDataAtPosition(r,t);return null}r.d(t,"a",(function(){return n})),r.d(t,"c",(function(){return a})),r.d(t,"b",(function(){return o}))},"./src/core/view/spreadsheet-view/utils.ts":function(e,t,r){"use strict";r.d(t,"b",(function(){return a})),r.d(t,"a",(function(){return o}));var n=r("./src/core/view/config/default.ts");function a(e,t,r){if(!t)return n.g;var a=0;if(!t.mergeData)return e.getColSetWidth(r);for(var o=0;o<t.mergeData.colCount;o++)e.isColHidden(r+o)||(a+=e.getColSetWidth(r+o));return a}function o(e,t,r){if(!t)return n.r;var a=0;if(!t.mergeData)return e.getRowDisplayHeight(r);for(var o=0;o<t.mergeData.rowCount;o++)e.isRowHidden(r+o)||(a+=e.getRowDisplayHeight(r+o));return a}},"./src/core/view/utils/base-func.ts":function(e,t,r){"use strict";r.d(t,"g",(function(){return n})),r.d(t,"c",(function(){return a})),r.d(t,"b",(function(){return o})),r.d(t,"e",(function(){return i})),r.d(t,"a",(function(){return s})),r.d(t,"d",(function(){return l})),r.d(t,"f",(function(){return c}));r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js");function n(e){var t;null===(t=e.stopPropagation)||void 0===t||t.call(e)}function a(e){var t;null===(t=e.preventDefault)||void 0===t||t.call(e)}function o(e,t){return e>=t[0]&&e<=t[1]}function i(e,t,r,n){return[e,t,e+r,t,e+r,t+n,e,t+n,e,t]}function s(e,t){var r=null;return function(){for(var n=this,a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];r&&(clearTimeout(r),r=null),r=setTimeout((function(){e.apply(n,o)}),t)}}function l(e){var t=this,r=null;return function(){for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];r||(r=Promise.resolve().then((function(){e.apply(t,a),r=null})))}}function c(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=null;return function(){for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];n||(n=setTimeout((function(){e.apply(t,o),n=null}),r))}}},"./src/core/view/utils/lambda.ts":function(e,t,r){"use strict";function n(e,t,r){var n=e.getCellViewAtPosition(r,t);if(null===n)throw new Error("getCellViewAtPosition error!");return!n.mergeParent}function a(e,t,r){var n=e.getCellViewAtPosition(r,t);if(null===n)throw new Error("getCellViewAtPosition error!");if(n.mergeParent){var a=e.getCellViewAtPosition(r+n.mergeParent.y,t+n.mergeParent.x);if(a&&a.mergeData.colCount>1)return!1}return!(n.mergeData&&n.mergeData.colCount>1)}function o(e,t,r){var n=e.getCellViewAtPosition(r,t);if(null===n)throw new Error("getCellViewAtPosition error!");if(n.mergeParent){var a=e.getCellViewAtPosition(r+n.mergeParent.y,t+n.mergeParent.x);if(a&&a.mergeData.rowCount>1)return!1}return!(n.mergeData&&n.mergeData.rowCount>1)}function i(e,t,r){return!e.isColHidden(t)&&!e.isRowHidden(r)}function s(e,t,r){return!e.isRowHidden(r)}function l(e,t,r){return!e.isColHidden(t)}function c(e,t,r){var n=e.getCellViewAtPosition(r,t);return null!==n&&!!n.content}function u(e,t,r){var n=e.getCellViewAtPosition(r,t);return null!==n&&!n.content}r.d(t,"g",(function(){return n})),r.d(t,"a",(function(){return a})),r.d(t,"h",(function(){return o})),r.d(t,"e",(function(){return i})),r.d(t,"f",(function(){return s})),r.d(t,"d",(function(){return l})),r.d(t,"c",(function(){return c})),r.d(t,"b",(function(){return u}))}}]);
//# sourceMappingURL=pc-chunk_part3-fa8eef006f.js.map