!function(e){function t(t){for(var n,s,i=t[0],u=t[1],l=t[2],d=0,f=[];d<i.length;d++)s=i[d],Object.prototype.hasOwnProperty.call(o,s)&&o[s]&&f.push(o[s][0]),o[s]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(e[n]=u[n]);for(c&&c(t);f.length;)f.shift()();return a.push.apply(a,l||[]),r()}function r(){for(var e,t=0;t<a.length;t++){for(var r=a[t],n=!0,i=1;i<r.length;i++){var u=r[i];0!==o[u]&&(n=!1)}n&&(a.splice(t--,1),e=s(s.s=r[0]))}return e}var n={},o={"spread-sheet-pc":0},a=[];function s(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.e=function(e){var t=[],r=o[e];if(0!==r)if(r)t.push(r[2]);else{var n=new Promise((function(t,n){r=o[e]=[t,n]}));t.push(r[2]=n);var a,i=document.createElement("script");i.charset="utf-8",i.timeout=120,s.nc&&i.setAttribute("nonce",s.nc),i.src=function(e){return s.p+"static/js/pc-"+({"bundle_calculation-environment":"bundle_calculation-environment",bundle_editableService:"bundle_editableService",bundle_feature:"bundle_feature",bundle_messageService:"bundle_messageService",bundle_module_behavior_api:"bundle_module_behavior_api",bundle_panel_pc:"bundle_panel_pc",bundle_pcPluginService:"bundle_pcPluginService",bundle_plugin_titlesync:"bundle_plugin_titlesync",bundle_reset_location:"bundle_reset_location",bundle_ui_dialog:"bundle_ui_dialog",bundle_ui_padmodal:"bundle_ui_padmodal",bundle_ui_tooltip:"bundle_ui_tooltip",bundle_view_lazy_module0:"bundle_view_lazy_module0",bundle_view_lazy_module1:"bundle_view_lazy_module1",bundle_view_lazy_module2:"bundle_view_lazy_module2",bundle_view_lazy_module3:"bundle_view_lazy_module3",bundle_view_lazy_module4:"bundle_view_lazy_module4",bundle_view_lazy_module5:"bundle_view_lazy_module5",bundle_view_workbench:"bundle_view_workbench","bundle_module_core-sheet":"bundle_module_core-sheet",bundle_module_export:"bundle_module_export",bundle_module_preview:"bundle_module_preview",bundle_plugin_discuss:"bundle_plugin_discuss",bundle_plugin_errorcode:"bundle_plugin_errorcode",bundle_plugin_errormodal:"bundle_plugin_errormodal",bundle_plugin_fullmember:"bundle_plugin_fullmember",bundle_plugin_mention:"bundle_plugin_mention",bundle_plugin_rangeauth:"bundle_plugin_rangeauth",bundle_plugin_record:"bundle_plugin_record",bundle_plugin_report:"bundle_plugin_report",bundle_plugin_share:"bundle_plugin_share",bundle_plugin_uimanager:"bundle_plugin_uimanager",bundle_plugin_userguide:"bundle_plugin_userguide",bundle_plugin_watermark:"bundle_plugin_watermark",bundle_spreadsheet_tool_lazy:"bundle_spreadsheet_tool_lazy",bundle_view_header:"bundle_view_header",bundle_view_sheetbar:"bundle_view_sheetbar",bundle_view_toolbar:"bundle_view_toolbar",bundle_feature_copy_paste_base:"bundle_feature_copy_paste_base",bundle_feature_data_validation:"bundle_feature_data_validation",bundle_feature_jank_toast:"bundle_feature_jank_toast",bundle_feature_quick_fill:"bundle_feature_quick_fill",bundle_feature_relate_form:"bundle_feature_relate_form",bundle_feature_smart_selection:"bundle_feature_smart_selection",bundle_feature_smart_split:"bundle_feature_smart_split",bundle_offline_map:"bundle_offline_map",bundle_app:"bundle_app",bundle_worker_services:"bundle_worker_services",bundle_coresheet_lazy:"bundle_coresheet_lazy",bundle_exif:"bundle_exif",bundle_lazy_css:"bundle_lazy_css",bundle_sheetsbar_preview:"bundle_sheetsbar_preview",bundle_relate_form_question_dialog:"bundle_relate_form_question_dialog","bundle_lottie.min":"bundle_lottie.min"}[e]||e)+"-"+{"bundle_calculation-environment":"dde3be7499",bundle_editableService:"300f004bf9",bundle_feature:"8f49099cd1",bundle_messageService:"c3602725f9",bundle_module_behavior_api:"0be57374b9",bundle_panel_pc:"ee0b83c443",bundle_pcPluginService:"9947ee21dc",bundle_plugin_titlesync:"1de06c7dc0",bundle_reset_location:"ee0c151b32",bundle_ui_dialog:"65bd72e557",bundle_ui_padmodal:"068bf6a370",bundle_ui_tooltip:"8b2489f1a0",bundle_view_lazy_module0:"51eb76cb88",bundle_view_lazy_module1:"2b625453c3",bundle_view_lazy_module2:"e4a72f4ca4",bundle_view_lazy_module3:"191f9a2fa2",bundle_view_lazy_module4:"ff1127f96f",bundle_view_lazy_module5:"f90ed8679f",bundle_view_workbench:"981a13ed48","bundle_module_core-sheet":"770f6de84f",bundle_module_export:"fd91b37868",bundle_module_preview:"81e7173e53",bundle_plugin_discuss:"41003c3c9c",bundle_plugin_errorcode:"ad5a5b0a4c",bundle_plugin_errormodal:"8a52338104",bundle_plugin_fullmember:"56b2696237",bundle_plugin_mention:"634f3971c3",bundle_plugin_rangeauth:"2caec63458",bundle_plugin_record:"be80728d03",bundle_plugin_report:"f2a96d0daf",bundle_plugin_share:"393e3f1783",bundle_plugin_uimanager:"9e6061e485",bundle_plugin_userguide:"6c510894c0",bundle_plugin_watermark:"360ffb2bdc",bundle_spreadsheet_tool_lazy:"68181552f4",bundle_view_header:"47eff0b5a0",bundle_view_sheetbar:"05221e63c8",bundle_view_toolbar:"7d9e15e417",bundle_feature_copy_paste_base:"381db4033d",bundle_feature_data_validation:"1bbe52be61",bundle_feature_jank_toast:"4fbbac633e",bundle_feature_quick_fill:"d2056a49da",bundle_feature_relate_form:"60c398563a",bundle_feature_smart_selection:"52cd14bd34",bundle_feature_smart_split:"deb0970ff2",bundle_offline_map:"dc6ecad658",bundle_app:"c95bbc8578",bundle_worker_services:"9fbec6aae6",bundle_coresheet_lazy:"7ad975b4ec",bundle_exif:"839c20b7af",bundle_lazy_css:"378e3d4739",bundle_sheetsbar_preview:"984961402c",bundle_relate_form_question_dialog:"8aa820de1e","bundle_lottie.min":"5431e5e310"}[e]+".js"}(e),0!==i.src.indexOf(window.location.origin+"/")&&(i.crossOrigin="anonymous");var u=new Error;a=function(t){i.onerror=i.onload=null,clearTimeout(l);var r=o[e];if(0!==r){if(r){var n=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;u.message="Loading chunk "+e+" failed.\n("+n+": "+a+")",u.name="ChunkLoadError",u.type=n,u.request=a,r[1](u)}o[e]=void 0}};var l=setTimeout((function(){a({type:"timeout",target:i})}),12e4);i.onerror=i.onload=a,document.head.appendChild(i)}return Promise.all(t)},s.m=e,s.c=n,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="//docs.idqqimg.com/tim/docs/sheets/",s.oe=function(e){throw console.error(e),e};var i=window.webpackJsonp=window.webpackJsonp||[],u=i.push.bind(i);i.push=t,i=i.slice();for(var l=0;l<i.length;l++)t(i[l]);var c=u;a.push(["./src/entry/browser/pc.ts","vendors_part_1","vendors_part_2","vendors_part_3","chunk_part1","chunk_part2","chunk_part3","chunk_part4"]),r()}({"../core-sheet/js/config/sheet.js":function(e,t,r){"use strict";r.r(t),r.d(t,"getCurrSubId",(function(){return i})),r.d(t,"getPadId",(function(){return u})),r.d(t,"getTitle",(function(){return l})),r.d(t,"isFullyConnected",(function(){return c})),r.d(t,"getMyUserInfo",(function(){return d})),r.d(t,"setMyUserInfo",(function(){return f})),r.d(t,"getOffTop",(function(){return h})),r.d(t,"setHasAllLoad",(function(){return m})),r.d(t,"getHasAllLoad",(function(){return p})),r.d(t,"setSheetDocInfo",(function(){return v})),r.d(t,"getSheetDocInfo",(function(){return g})),r.d(t,"getHeaderHeight",(function(){return y})),r.d(t,"getEditorTop",(function(){return _})),r.d(t,"getEditorBottom",(function(){return b}));var n=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),o=r.n(n),a=r("../packages/common-utils/src/url.ts"),s={title:"",myUserInfo:null,hasAllLoad:!1,coreSheetDocInfo:null};function i(){return SpreadsheetApp?SpreadsheetApp.spreadsheet.getActiveSheetId():Object(a.getQuery)("tab")}function u(){return window.spreadConfig.getConfig("padId")}function l(){return window.SpreadsheetApp&&window.SpreadsheetApp.spreadsheet.getTitle()}function c(){return SpreadsheetApp&&SpreadsheetApp.socket&&SpreadsheetApp.socket.client&&"OPENED"===SpreadsheetApp.socket.client.getRoomState()}function d(){return s.myUserInfo}function f(){var e=window.clientVars||{};s.myUserInfo={userId:e.userId,name:e.userName,ip:e.clientIp,colorId:e.userColor||0,status:"connected",userLink:e.userLink,userPic:e.userPic,uin:e.uin,openTime:Date.now()}}function h(){return"182px"}function m(e){s.hasAllLoad=e}function p(e){return s.hasAllLoad}function v(e){s.coreSheetDocInfo=e}function g(){return s.coreSheetDocInfo}function y(){return $("header").outerHeight()||44}function _(){var e=document.getElementById("mainContainer"),t=o.a.isIPad?y():0;return e?e.getBoundingClientRect().top+t:t}function b(){return o.a.isMobilePhone||o.a.isAndroidPad||o.a.isIPad?$("#mobile-sheetbox").outerHeight()||0:$(".tsSheetbox").outerHeight()||0}},"../core-sheet/js/lazy/script-loader/script-loader.js":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/es.array.splice.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");function n(){}!function(){if("function"===typeof window.CustomEvent)return!1;function e(e,t){var r=t||{bubbles:!1,cancelable:!1,detail:void 0},n=document.createEvent("CustomEvent");return n.initCustomEvent(e,r.bubbles,r.cancelable,r.detail),n}e.prototype=window.Event.prototype,window.CustomEvent=e}();var o={metadata:null,firstLoaded:{},asset:{React:{url:"//docs.idqqimg.com/tim/docs/sheets/static/js/lib/react.production.min.js",state:-1}},assetLoaded:!1,events:{},cache:{},evtArr:[],init:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!this.assetLoaded)if(a||(this.asset=this.asset||{},this.asset.QReport={url:"//docs.idqqimg.com/pub/js/alloyreport.js?_bid=2231",state:-1},this.loadReport()),a<=2){var s="".concat(e,"?_t=").concat(Date.now());this.ajax({url:s,success:function(e){t.metadata=e.data.metadata,delete e.data.metadata,delete e.data.ScriptLoader,Object.keys(e.data).forEach((function(r){if(t.asset[r]={url:e.data[r].js||null,state:-1},e.data[r].dependency){var n=e.data[r].dependency;t.asset[r].dep=n,Object.keys(n).forEach((function(e){t.asset[e]={url:n[e],state:-1}}))}})),t.assetLoaded=!0,t.dispatch("SL-INIT"),null===r||void 0===r||r(),t.evtArr.forEach((function(e){t.dispatch(e.eventName,e.detail)})),t.monitor(3078347)},fail:function(n){a+=1,t.init(e,r,o,a),t.monitor(3078348)}})}else null===o||void 0===o||o({code:1,msg:"load error"})},loadReport:function(){window.QReport||this.loadScriptProcess({asset:this.asset,cache:this.cache,mod:"QReport",parentModule:"QReport"},n,n,0)},monitor:function(e){var t;null===(t=window.QReport)||void 0===t||t.monitor(e)},load:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=this.asset,i=this.cache;if(this.assetLoaded||"React"===e)try{"undefined"!==typeof s[e]?"undefined"===typeof i[e]&&a<=2?(s[e].dep&&Object.keys(s[e].dep).forEach((function(n){window[n]?(i[n]=window[n],s[n].state=0):"undefined"===typeof i[n]&&-1===s[n].state&&t.loadScriptProcess({asset:s,cache:i,mod:n,parentModule:e},r,o,a)})),-1===s[e].state?this.loadScriptProcess({asset:s,cache:i,mod:e,parentModule:e},r,o,a):this.listenModuleLoad(e,(function(){r(t.cache[e],t.cache)}))):i[e]&&this.firstLoaded[e]&&this.checkAllLoaded(s,e)&&(r(i[e],i),this.firstLoaded[e]=!0):(console.error("".concat(e," is not found.")),null===o||void 0===o||o({code:1,msg:"".concat(e," is not found.")}))}catch(u){this.monitor(3078382),null===o||void 0===o||o({code:2,msg:u})}else this.listen("SL-INIT",(function(){t.load(e,r,o,a)}))},loadScriptProcess:function(e,t,r,n){var o=this,a=e.asset,s=e.cache,i=e.mod,u=e.parentModule,l=null;l=this.createScript(a[i].url),a[i].state=1,l.addEventListener("load",(function(){window[i]&&(s[i]=window[i],a[i].state=0,!o.firstLoaded[u]&&o.checkAllLoaded(a,u)&&t(s[u],s),o.dispatch("SL_MODULE_LOAD_".concat(i)),o.monitor(3078345))})),l.addEventListener("error",(function(){a[i].state=n>=2?2:-1,n+=1,o.load(i,t,r,n),l&&o.removeScript(l),null===r||void 0===r||r({code:3,msg:"load error"}),o.monitor(3078346)}))},checkAllLoaded:function(e,t){var r=e[t];if(0!==e[t].state)return!1;if("undefined"!==typeof r.dep)for(var n=Object.keys(r.dep),o=0,a=n.length;o<a;o++)if(!window[n[o]])return!1;return this.firstLoaded[t]=!0,!0},createScript:function(e){var t=document.createElement("script");return t.src=e,t.async=!1,t.type="text/javascript",document.body.appendChild(t),t},removeScript:function(e){(null===e||void 0===e?void 0:e.parentNode)&&e.parentNode.removeChild(e)},ajax:function(e){var t=this,r=function(e){var t={};return t.url=e.url,t.paramObj=e.param||{},t.success=e.success||n,t.fail=e.fail||n,t.method=e.ajaxType||"GET",t.method=t.method.toUpperCase(),t}(e),o=function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push("".concat(r,"=").concat(encodeURIComponent(e[r])));return t.join("&")}(r.paramObj),a=function(e,t){return e+=e.indexOf("?")>=0?"&":"?".concat(t)}(r.url,o),s=function(){for(var e=null,t=[function(){return new XMLHttpRequest},function(){return new(0,window.XDomainRequest)},function(){return new window.ActiveXObject("Msxml2.XMLHTTP")},function(){return new window.ActiveXObject("Msxml3.xmlhttp")},function(){return new window.ActiveXObject("Microsoft.XMLHTTP")}],r=0,n=t.length;r<n;r++){try{e=t[r]()}catch(o){continue}break}return e}();if(!s)throw new Error("XMLHttp is not defined");s.open("GET",a,!0),s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status){var e=JSON.parse(s.responseText);r.success({data:e,code:0}),t.monitor(3078349)}else r.fail({code:s.status}),s.status>=400&&s.status<500?t.monitor(3078350):s.status>=500&&s.status<600&&t.monitor(3078351)},s.onerror=function(){r.fail({code:-1})},s.send()},dispatch:function(e,t){if(this.assetLoaded){var r=new window.CustomEvent(e,{detail:t});window.dispatchEvent(r)}else this.evtArr.push({eventName:e,detail:t})},listen:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n;this.events[e]||(this.events[e]=[]),this.events[e].push(t),window.addEventListener(e,t)},remove:function(e,t){if(this.events[e]){var r=this.events[e].indexOf(t);-1!==r&&(this.events[e].splice(r,1),window.removeEventListener(e,t))}},removeAllEvent:function(){var e=this;Object.keys(this.events).forEach((function(t){e.events[t].forEach((function(r){e.remove(t,r)}))}))},listenModuleLoad:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n;this.listen("SL_MODULE_LOAD_".concat(e),t)}};window.ScriptLoader||(window.ScriptLoader=o),window.SLR=window.ScriptLoader},"../core-sheet/js/report/whitescreen.js":function(e,t,r){"use strict";(function(e){r.d(t,"c",(function(){return b})),r.d(t,"a",(function(){return A})),r.d(t,"b",(function(){return E}));r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.function.name.js"),r("../node_modules/core-js/modules/es.number.constructor.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../packages/report/src/index.ts"),s=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),i=r.n(s),u=r("./src/core/app/sheetSize.ts"),l=r("../node_modules/@tencent/tencent-doc-report/lib/index.browser.js"),c=function(){},d=window,f=d.log||{};["invokeWk","report","info","error"].forEach((function(e){f[e]||(f[e]=c)}));var h=d.WebLog,m=h?new h("checker"):f,p=a.b&&a.b.tdwReport||c,v=a.b&&a.b.monitor||c,g=function(){function t(e,r){Object(n.a)(this,t),this.isChecked=!1,this.name=e,this.options=r,this.hasFinished=!1,this.startTs=0,this.endTs=0,this.nextTickTs=0,this.isCheckedWithError=!1}return Object(o.a)(t,[{key:"_check",value:function(){var t,r=this.name,n=this.options,o=void 0===n?{}:n,a=o.common,s=void 0===a?{}:a,i=o.timeout,u=o.nextTick,l=o.runNextTick,c=s.reportKeyPrefix,d=void 0===c?"":c,h=this.isChecked,p=u.monitorIds,g=void 0===p?{}:p,y=u.reportKey,_="".concat(r,"_nextTick"),b=y||d+_,A=Number(new Date);if(this.nextTickTs=A,null===(t=e.__ws)||void 0===t||t.trigger("checkerData",{n:r,t:"nextTick",ts:A,flag:h}),!h&&g.error&&v(g.error),this.hasFinished=!0,m.info(_,{flag:h}),!h){var E,j=f.report(b);null===(E=e.__ws)||void 0===E||E.trigger("checkerError",{name:r,reportId:j})}!h&&i&&f.invokeWk("CLEAR_CHECKER_TIMEOUT",{name:r}),null===l||void 0===l||l(h)}},{key:"start",value:function(){var t,r=this,n=this.name,o=this.options,a=void 0===o?{}:o,s=a.common,i=void 0===s?{}:s,u=a.timeout,l=a.withCatchError,c=i.reportKeyPrefix,d=void 0===c?"":c,h="".concat(n,"_start");m.info(h);var p=Number(new Date);if(this.startTs=p,null===(t=e.__ws)||void 0===t||t.trigger("checkerData",{n:n,t:"start",ts:p}),u){var v=u.time,g=u.getTime,y=u.monitorId,_=u.reportKey,b=u.reportRate;f.invokeWk("SET_CHECKER_TIMEOUT",{name:n,time:v||(g?g():0),monitorId:y,reportKey:_,reportRate:b,reportKeyPrefix:d})}l||setTimeout((function(){r._check()}),0)}},{key:"end",value:function(){var t;if(!this.isCheckedWithError){this.isChecked=!0;var r=this.name,n=this.options,o=n.timeout,a=n.withCatchError,s="".concat(r,"_end"),i=Number(new Date);this.endTickTs=i,null===(t=e.__ws)||void 0===t||t.trigger("checkerData",{n:r,t:"end",ts:i}),m.info(s),o&&f.invokeWk("CLEAR_CHECKER_TIMEOUT",{name:r}),a&&this._check()}}},{key:"endWithError",value:function(t){var r,n;if(!this.isChecked){this.isCheckedWithError=!0;var o=this.name,a=this.options.withCatchError,s=Number(new Date),i="";try{i=t.toString()}catch(u){}null===(r=e.__ws)||void 0===r||r.trigger("checkerData",{n:o,t:"endWithError",ts:s,msg:i}),f.error("[init error]",i,null===t||void 0===t?void 0:t.stack),f.report("EXCEL_CHECKER_INIT_CATCH"),null===(n=e.AlloyReport)||void 0===n||n.monitor(34378724),a&&this._check()}}}]),t}();function y(){try{var e;if(null===(e=d.clientVars)||void 0===e?void 0:e.isBlankPage)return;var t=function(){var e=(i.a.isMobilePhone||i.a.isAndroidPad,document.querySelector("#canvasContainer canvas"));return e?{width:e.width,height:e.height,dataURL:e.toDataURL(),isReal:!0}:{width:0,height:0,dataURL:"",isReal:!1}}(),r=t.width,n=t.height,o=t.dataURL,a=t.isReal;return{isCanvasBlank:o===function(e,t){if(!e||!t)return"";var r=document.createElement("canvas");return r.width=e,r.height=t,r.toDataURL()}(r,n),isReal:a}}catch(s){console.warn("checkExcelCanvasError",s),f.error("checkExcelCanvasError",{msg:s.message}),v(33906053),p({opername:"excel_error",module:"error",action:"checkExcelCanvas",ver5:d.location.href,ver6:i.a.isMobilePhone||i.a.isAndroidPad,ver7:s.message})}}var _=(window&&(window.performance||window.webkitPerformance||window.msPerformance)||{}).timing,b=new g("whitescreen",{timeout:{time:0,getTime:function(){var e=(_||{}).navigationStart,t=void 0===e?0:e;return t>0?3e4-(Date.now()-t):3e4},monitorId:33945552,reportRate:.2},nextTick:{monitorIds:{right:33945550,error:33945551}},common:{reportKeyPrefix:"EXCEL_CHECKER_"},withCatchError:!0}),A=new g("canvas",{nextTick:{monitorIds:{error:34948360}},common:{reportKeyPrefix:"EXCEL_CHECKER_"},runNextTick:function(t){var r;t&&(null===(r=e.__ws)||void 0===r||r.trigger("firstScreenFinish"),setTimeout((function(){var e=y();if(e){var t=e||{},r=t.isCanvasBlank,n=t.isReal;if(f.info("whiteScreenChecker",e),r){var o=n?"whitescreen_canvas_error":"whitescreen_dom_error",a=n?"EXCEL_CHECKER_whitescreen_canvas_error":"EXCEL_CHECKER_whitescreen_dom_error";v(n?33945554:33945553),p({opername:"excel_error",module:"error",action:o,ver5:d.location.href,ver6:r,ver7:n}),f.report(a),setTimeout((function(){var e=function(e){try{var t=(i.a.isMobilePhone||i.a.isAndroidPad,document.querySelector("#canvasContainer canvas"));if(!t)return"";var r=e.width,n=e.height,o=t.getContext("2d"),a=document.createElement("canvas"),s=a.getContext("2d");return a.width=r,a.height=n,s.putImageData(o.getImageData(20,20,r,n),0,0),a.toDataURL("image/jpeg",1)}catch(u){return"getCanvasData ERROR"}}({width:150,height:150});f.report(a,{data:{type:"canvasData",canvasData:e}})}),1500)}}}),3e3))}}),E=new g("coresheet",{nextTick:{monitorIds:{right:33945534,error:33945535}},common:{reportKeyPrefix:"EXCEL_CHECKER_"}});window.addEventListener("beforeunload",(function(){if(!window.__reloadAndRetry&&!b.isChecked){var t,r="whitescreen_beforeunload".concat(window.quickLookRenderEnd?"_quickLook":""),n=_||{},o=n.fetchStart,s=void 0===o?0:o,i=n.responseStart,c=void 0===i?0:i,d=null===(t=e.performanceData)||void 0===t?void 0:t.jsStartRun,f=Date.now();p({opername:"excel_error",module:"error",action:r,ver5:s||f,ver6:c||0,ver7:d||0,ver8:f||0});var h=(f||0)-(s||f),m=Object(u.a)(e.SpreadsheetApp.spreadsheet.getActiveSheetId());a.b.tam.reportT({name:r,duration:h,ext1:JSON.stringify(m),ext2:JSON.stringify({container:e.isContainer?1:0,offline_package:e.__isOfflinePkg?1:0}),ext3:"".concat(Object(l.getSource1)())})}}))}).call(this,r("../node_modules/webpack/buildin/global.js"))},"../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/feature/copyPaste/lib/PasteSpecial/PasteSpecialMenu/PasteSpecialMenu.less":function(e,t,r){(e.exports=r("../node_modules/css-loader/dist/runtime/api.js")(!1)).push([e.i,'.postpaste-parent .postpaste-container{margin:0;min-width:0;width:36px;height:28px;border-radius:2px;border:1px solid #e0e2e4;background-color:#f5f5f5}.postpaste-parent .postpaste-container:hover{border-color:#e0e2e4;background-color:#e5e5e5}.postpaste-parent .postpaste-container:active{border-color:#e0e2e4;background-color:#e0e2e4}.postpaste-parent .postpaste-container:disabled{border-color:#e0e2e4}.postpaste-parent .postpaste-container .tx-toolbar-button-inner-box,.postpaste-parent .postpaste-container .tx-toolbar-menu-button-inner-box{height:25px;min-width:25px;padding:0;text-align:center}.postpaste-parent .postpaste-container .docs-icon-paste{left:0;top:0}.postpaste-parent .postpaste-container .tx-inline-block{position:relative;display:-moz-inline-box;display:inline-block}.postpaste-parent .postpaste-container .docs-icon{direction:ltr;text-align:left;height:21px;overflow:hidden;vertical-align:middle;width:19px;margin-left:6px;margin-top:6px}.postpaste-parent .postpaste-container .docs-icon .docs-icon-img-container{height:4167px;position:absolute;width:42px}.tx-toolbar-menu-button-dropdown{border-left:3.5px solid transparent;border-right:3.5px solid transparent;border-top:4px solid #9ea1a4;float:right;margin:12px 4px 0 0;padding:0;opacity:.8;vertical-align:middle;width:0;height:0}.specail-paste-error-wrapper{position:relative}.specail-paste-error-img{transform:translateY(7px)}.specail-paste-error-text{transform:translateY(-50%);margin-right:8px;margin-left:-20px;position:absolute;top:50%}.tx-docs-icon-img:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAkCAMAAACt+qpmAAAAM1BMVEUAAAA1OkF/g4Y1OkF/g4Z/g4Y1OkF/g4Z/g4Y1OkF/g4Z/g4Z/g4Z/g4Y1OkFOU1lGS1GlJZlaAAAADXRSTlMA5vBJEJ7n4nhKORgDp25XTwAAAHFJREFUOMvl0rsKgDAQRNHEGN8b/f+vdVmYgGEdC7HyFgvhFGNhQCkWLabgpWbqYim4z1i37FiY1YOtOlhnsa0vOwhvjvff9wmuLcqlg6HsDYZap5oZysJw3AhKZigTQ3Gxt1xEP0L8zy7OA0H0Ap0ons+WEWpjEPWBAAAAAElFTkSuQmCC);background-size:14px 18px;position:absolute;width:14px;height:18px}@media only screen and (-moz-min-device-pixel-ratio:1.5),only screen and (-o-min-device-pixel-ratio:1.5),only screen and (-Webkit-min-device-pixel-ratio:1.5),only screen and (min-device-pixel-ratio:1.5){.tx-docs-icon-img:before{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAkCAMAAACt+qpmAAAAM1BMVEUAAAA1OkF/g4Y1OkF/g4Z/g4Y1OkF/g4Z/g4Y1OkF/g4Z/g4Z/g4Z/g4Y1OkFOU1lGS1GlJZlaAAAADXRSTlMA5vBJEJ7n4nhKORgDp25XTwAAAHFJREFUOMvl0rsKgDAQRNHEGN8b/f+vdVmYgGEdC7HyFgvhFGNhQCkWLabgpWbqYim4z1i37FiY1YOtOlhnsa0vOwhvjvff9wmuLcqlg6HsDYZap5oZysJw3AhKZigTQ3Gxt1xEP0L8zy7OA0H0Ap0ons+WEWpjEPWBAAAAAElFTkSuQmCC)}}',""])},"../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/feature/copyPaste/lib/PasteSpecial/PasteSpecialPanel/PasteSpecialPanel.less":function(e,t,r){(e.exports=r("../node_modules/css-loader/dist/runtime/api.js")(!1)).push([e.i,"[data-id=paste-special-panel]{margin-top:8px}.tx-menu{z-index:1003;width:140px;height:160px;background-color:#fff}.tx-menu .tx-menuitem{position:relative;cursor:pointer;list-style:none;margin:0;white-space:nowrap;font-family:PingFangSC-Regular,Microsoft YaHei,SimHei,SimSun,sans-serif;font-size:14px;height:14px;line-height:14px;font-weight:400;font-stretch:normal;color:#333;padding:9px 26px 9px 15px}.tx-menu .tx-menuitem:hover{background-color:#f5f5f5}.tx-menu .tx-menuitem:active{background-color:#e6e6e6}.tx-menu .tx-menuitem.tx-menuitem-disabled{color:#bbb;cursor:default}.tx-menu .tx-menuitem.tx-menuitem-disabled:active,.tx-menu .tx-menuitem.tx-menuitem-disabled:hover{background-color:#fff}",""])},"../packages/common-utils/src/cookie.ts":function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"getCookie",(function(){return n})),r.d(t,"setCookie",(function(){return o})),r.d(t,"delCookie",(function(){return a}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.regexp.constructor.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.match.js");function n(t){var r=new RegExp("(?:^|;+|\\s+)".concat(t,"=([^;]*)")),n="";return e.document&&(n=e.document.cookie.match(r)),n?decodeURIComponent(n[1]):""}function o(t,r,n,o,a){var s=new Date;s.setTime(s.getTime()+(n?36e5*n:2592e6)),e.document&&(document.cookie="".concat(t,"=").concat(r,";expires=").concat(s.toGMTString(),";path=").concat(a||"/",";").concat(o?"domain=".concat(o,";"):""))}function a(t,r,n){var o=new Date(0);e.document&&(document.cookie="".concat(t,"=;expires=").concat(o.toUTCString(),";path=").concat(n||"/",";").concat(r?"domain=".concat(r,";"):""))}}.call(this,r("../node_modules/webpack/buildin/global.js"))},"../packages/common-utils/src/url.ts":function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"getAllUrlParams",(function(){return n})),r.d(t,"getQuery",(function(){return o})),r.d(t,"getQueryObject",(function(){return a})),r.d(t,"removeURLParameters",(function(){return s})),r.d(t,"updateURLParameters",(function(){return i}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/es.array.last-index-of.js"),r("../node_modules/core-js/modules/es.array.splice.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.regexp.constructor.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.match.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.string.search.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");function n(e){var t=e.split("?");t.length>=2&&("".concat(t[0],"?"),e=t[1]);for(var r=e.split(/[&;]/g),n={},o=0,a=r.length;o<a;o++){var s=r[o].split("=");s.length>1&&(n[s[0]]=s[1])}return n}function o(t,r){var n,o=null,a=(r?"?".concat(r.split("?")[1]||""):null===(n=e.location)||void 0===n?void 0:n.search)||"";return a&&(o=a.match(new RegExp("(\\?|&)".concat(t,"=([^&]*)(&|$)")))),o?decodeURIComponent(o[2]):""}function a(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t={},r=(e.split("?")[1]||"").split("&"),n=0,o=r.length;n<o;n++)if(r[n]){var a=r[n].split("=");t[a[0]]=decodeURIComponent(a[1])}return t}function s(e,t){var r=e.split("?");if(t=Array.isArray(t)?t:[t],r.length>=2){for(var n=r[1].split(/[&;]/g),o=0,a=t.length;o<a;o++)for(var s="".concat(encodeURIComponent(t[o]),"="),i=n.length-1;i>=0;i--)-1!==n[i].lastIndexOf(s,0)&&n.splice(i,1);return r[0]+(n.length>0?"?".concat(n.join("&")):"")}return e}function i(e,t){return Object.keys(t).forEach((function(r){var n=new RegExp("([?&#])".concat(r,"=?.*?(&|#|$)"),"i"),o=t[r],a=-1!==e.indexOf("?")?"&":"?";e=e.match(n)?e.replace(n,"$1".concat(r,"=").concat(encodeURIComponent(o),"$2")):"".concat(e+a+r,"=").concat(encodeURIComponent(o))})),e}}.call(this,r("../node_modules/webpack/buildin/global.js"))},"../packages/lib/EventEmitter.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/regenerator-runtime/runtime.js");var n=r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),o=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),s=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),u=r("./src/flow/utils.ts");function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){Object(o.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var d=function(e,t,r,n){var o,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(i.a)(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(s=(a<3?o(s):a>3?o(t,r,s):o(t,r))||s);return a>3&&s&&Object.defineProperty(t,r,s),s},f=function(){function e(t,r){Object(a.a)(this,e),this.handler=t,this.context=r.context,this.once=r.once,this.priority=r.priority}return Object(s.a)(e,[{key:"isEqual",value:function(e){return this.handler===e.handler&&this.context===e.context&&this.once===e.once&&this.priority===e.priority}}]),e}(),h=function(){function t(){Object(a.a)(this,t),this.events={}}return Object(s.a)(t,[{key:"on",value:function(e,t,r){var n=new f(t,c({context:this},r));return this.events[e]?(this.events[e].filter((function(e){return e.isEqual(n)})).length||(n.priority?this.events[e].unshift(n):this.events[e].push(n)),this):(this.events[e]=[n],this)}},{key:"addListener",value:function(e,t,r){return this.on(e,t,r)}},{key:"once",value:function(e,t,r){return this.on(e,t,c(c({},r),{},{once:!0}))}},{key:"off",value:function(t,r,n){var o;if(null===(o=e.log)||void 0===o||o.debug("EventEmitter off ".concat(t)),!t)return this.events={},this;if(!r)return delete this.events[t],this;if(!this.events[t])return this;var a=new f(r,c({context:this},n));return this.events[t]=this.events[t].filter((function(e){return!e.isEqual(a)})),this}},{key:"removeListener",value:function(e,t,r){return this.off(e,t,r)}},{key:"emit",value:function(e){var t=this.events[e];if(!t)return!1;for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];for(var a=0;a<t.length;a++)t[a].once&&this.off(e,t[a].handler,{once:t[a].once,priority:t[a].priority,context:t[a].context}),t[a].handler.apply(t[a].context,n);return!0}},{key:"emitSync",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(t){var r,n,o,a,s,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.events[t]){e.next=3;break}return e.abrupt("return",!1);case 3:for(n=i.length,o=new Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=i[a];s=0;case 5:if(!(s<r.length)){e.next=12;break}return r[s].once&&this.off(t,r[s].handler,{once:r[s].once,priority:r[s].priority,context:r[s].context}),e.next=9,r[s].handler.apply(r[s].context,o);case 9:s++,e.next=5;break;case 12:return e.abrupt("return",!0);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){this.events={}}}]),t}();h=d([Object(u.a)("M_Event_Emitter")],h),t.a=h}).call(this,r("../node_modules/webpack/buildin/global.js"))},"../packages/lib/Keyboard.ts":function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return l}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.some.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.match.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=(r("../packages/lib/global.ts"),/Mac|iPad/i.test(e.navigator.platform)),s=a?"metaKey":"ctrlKey",i=a?"Meta":"Control",u={DIGIT0:48,DIGIT9:57},l=function(){function e(t){Object(n.a)(this,e),this.options=t,this.bindings={},this.onKeyDown=this.onKeyDown.bind(this),this.listen();var r=t.bindings;r&&(Array.isArray(r)?this.addBindings(r):this.addBinding(r))}return Object(o.a)(e,[{key:"addBinding",value:function(t){var r=e.normalize(t),n=r.key;this.bindings[n]=this.bindings[n]||[],r.priority?this.bindings[n].unshift(r):this.bindings[n].push(r)}},{key:"addBindings",value:function(e){var t=this;Array.isArray(e)&&e.forEach((function(e){t.addBinding(e)}))}},{key:"removeBinding",value:function(t){var r=e.normalize(t),n=r.key,o=this.bindings[n];o&&o.length&&(this.bindings[n]=o.filter((function(e){return!(r.key===e.key&&r.handler===e.handler&&r.metaKey===e.metaKey&&r.ctrlKey===e.ctrlKey&&r.shiftKey===e.shiftKey&&r.priority===e.priority)})))}},{key:"removeBindings",value:function(e){var t=this;Array.isArray(e)&&e.forEach((function(e){t.removeBinding(e)}))}},{key:"destroy",value:function(){delete this.bindings,this.options.root.removeEventListener("keydown",this.onKeyDown)}},{key:"listen",value:function(){this.options.root.addEventListener("keydown",this.onKeyDown)}},{key:"onKeyDown",value:function(t){var r=this,n=e.getKeyCodeByEvent(t),o=(this.bindings[t.key]||[]).concat(this.bindings[n]||[]).filter((function(r){return e.match(t,r)}));0!==o.length&&(o.some((function(e){return!1===e.handler.call(r,t,e)}))&&(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()))}}],[{key:"match",value:function(t,r){if(!r.ignore&&["altKey","ctrlKey","metaKey","shiftKey"].some((function(e){return!!r[e]!==t[e]})))return!1;var n=e.getKeyCodeByEvent(t);return r.key===n||r.key===t.key}},{key:"normalize",value:function(t){var r=t;if("string"===typeof r.key){var n=r.key.toUpperCase();e.isCommonChar(n)&&(r.key=n.charCodeAt(0))}return r.shortKey&&(r[s]=r.shortKey,delete r.shortKey),r}},{key:"isCommonChar",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return 1===e.length&&(e<="9"&&e>="0"||e<="Z"&&e>="A"||e<="z"&&e>="a"||"\xa0"===e)}},{key:"getKeyCodeByEvent",value:function(t){var r=t.which||t.keyCode,n=t.code.toUpperCase();return 229===r&&e.isCommonChar(t.key)?r=t.key.toUpperCase().charCodeAt(0):229===r&&n in u&&(r=u[n]),r}}]),e}();l.KEYS={BACKSPACE:8,TAB:9,RETURN:13,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,CAPS_LOCK:20,ESCAPE:27,SPACE:32,SPACE_SAFARI:160,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,META:91,META_LEFT:91,META_RIGHT:93,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SEMICOLON:186,SEMICOLON_FIREFOX:59,EQUAL:187,EQUAL_FIREFOX:61,COMMA:188,MINUS:189,MINUS_FIREFOX:173,PERIOD:190,SLASH:191,LEFT_BRACKETS:219,BACKSLASH:220,RIGHT_BRACKETS:221,QUOTE:222}}).call(this,r("../node_modules/webpack/buildin/global.js"))},"../packages/lib/dom.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../packages/services/src/dispose.ts"),s=function(){function e(t,r,o,s){Object(n.a)(this,e),Object(a.h)(this),this._node=t,this._type=r,this._handler=o,this._options=s||!1,this._node.addEventListener(this._type,this._handler,this._options),this.disposableId="".concat(r," DOMListener")}return Object(o.a)(e,[{key:"dispose",value:function(){Object(a.f)(this),this._handler&&(this._node.removeEventListener(this._type,this._handler,this._options),this._node=null,this._handler=null)}}]),e}();function i(e,t,r,n){return new s(e,t,r,n)}},"../packages/lib/global.ts":function(e,t,r){(function(e){var t=r("../node_modules/@babel/runtime/helpers/typeof.js");"object"!==("undefined"===typeof e?"undefined":t(e))&&(Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.global=__magic__,delete Object.prototype.__magic__)}).call(this,r("../node_modules/webpack/buildin/global.js"))},"../packages/lib/index.ts":function(e,t,r){"use strict";r.d(t,"c",(function(){return n.a})),r.d(t,"b",(function(){return o.a})),r.d(t,"a",(function(){return m}));r("../packages/lib/global.ts");var n=r("../packages/lib/Keyboard.ts"),o=r("../packages/lib/EventEmitter.ts"),a=(r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.symbol.description.js"),r("../node_modules/core-js/modules/es.symbol.iterator.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.from.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.function.name.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js")),s=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),i=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),u=(r("../node_modules/regenerator-runtime/runtime.js"),function e(t){Object(s.a)(this,e),this.element=t,this.next=e.Undefined,this.prev=e.Undefined});u.Undefined=new u(void 0);var l=function(){function e(){Object(s.a)(this,e),this._first=u.Undefined,this._last=u.Undefined,this._size=0}return Object(i.a)(e,[{key:"isEmpty",value:function(){return this._first===u.Undefined}},{key:"clear",value:function(){this._first=u.Undefined,this._last=u.Undefined,this._size=0}},{key:"unshift",value:function(e){return this._insert(e,!1)}},{key:"push",value:function(e){return this._insert(e,!0)}},{key:"shift",value:function(){if(this._first!==u.Undefined){var e=this._first.element;return this._remove(this._first),e}}},{key:"pop",value:function(){if(this._last!==u.Undefined){var e=this._last.element;return this._remove(this._last),e}}},{key:Symbol.iterator,value:regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this._first;case 1:if(t===u.Undefined){e.next=7;break}return e.next=4,t.element;case 4:t=t.next,e.next=1;break;case 7:case"end":return e.stop()}}),e,this)}))},{key:"toArray",value:function(){for(var e=[],t=this._first;t!==u.Undefined;t=t.next)e.push(t.element);return e}},{key:"_insert",value:function(e,t){var r=this,n=new u(e);if(this._first===u.Undefined)this._first=n,this._last=n;else if(t){var o=this._last;this._last=n,n.prev=o,o.next=n}else{var a=this._first;this._first=n,n.next=a,a.prev=n}this._size+=1;var s=!1;return function(){s||(s=!0,r._remove(n))}}},{key:"_remove",value:function(e){if(e.prev!==u.Undefined&&e.next!==u.Undefined){var t=e.prev;t.next=e.next,e.next.prev=t}else e.prev===u.Undefined&&e.next===u.Undefined?(this._first=u.Undefined,this._last=u.Undefined):e.next===u.Undefined?(this._last=this._last.prev,this._last.next=u.Undefined):e.prev===u.Undefined&&(this._first=this._first.next,this._first.prev=u.Undefined);this._size-=1}},{key:"size",get:function(){return this._size}}]),e}(),c=r("../packages/services/src/dispose.ts");function d(e,t){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"===typeof e)return f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){i=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(i)throw a}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var h,m=function(){function e(t){Object(s.a)(this,e),this._disposed=!1,this._options=t}return Object(i.a)(e,[{key:"fire",value:function(e){if(this._listeners){this._deliveryQueue||(this._deliveryQueue=new l);var t,r=d(this._listeners);try{for(r.s();!(t=r.n()).done;){var n=t.value;this._deliveryQueue.push([n,e])}}catch(c){r.e(c)}finally{r.f()}for(;this._deliveryQueue.size>0;){var o=this._deliveryQueue.shift(),s=Object(a.a)(o,2),i=s[0],u=s[1];try{"function"===typeof i?i.call(void 0,u):i[0].call(i[1],u)}catch(f){console.error(f)}}}}},{key:"dispose",value:function(){this._listeners&&this._listeners.clear(),this._deliveryQueue&&this._deliveryQueue.clear(),this._disposed=!0}},{key:"event",get:function(){var e=this;return this._event||(this._event=function(t,r,n){var o,a,s;e._listeners||(e._listeners=new l);var i=e._listeners.isEmpty();i&&(null===(o=e._options)||void 0===o?void 0:o.onFirstListenerAdd)&&e._options.onFirstListenerAdd(e);var u=e._listeners.push(r?[t,r]:t);i&&(null===(a=e._options)||void 0===a?void 0:a.onFirstListenerDidAdd)&&e._options.onFirstListenerDidAdd(e),(null===(s=e._options)||void 0===s?void 0:s.onListenerDidAdd)&&e._options.onListenerDidAdd(e,t,r);var d={dispose:function(){var t;e._disposed||(u(),(null===(t=e._options)||void 0===t?void 0:t.onLastListenerRemove)&&(e._listeners&&!e._listeners.isEmpty()||e._options.onLastListenerRemove(e)));Object(c.f)(d)},disposableId:"event"};return Array.isArray(n)&&n.push(d),Object(c.h)(d),d}),this._event}}]),e}();!function(e){function t(e){return function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,o=!1,a=e((function(e){if(!o)return a?a.dispose():o=!0,t.call(r,e)}),null,n);return o&&a.dispose(),a}}e.once=t,e.signal=function(e){return e},e.buffer=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=r.slice(),o=e((function(e){n?n.push(e):s.fire(e)})),a=function(){n&&n.forEach((function(e){return s.fire(e)})),n=null},s=new m({onFirstListenerAdd:function(){o||(o=e((function(e){return s.fire(e)})))},onFirstListenerDidAdd:function(){n&&(t?setTimeout(a):a())},onLastListenerRemove:function(){o&&o.dispose(),o=null}});return s.event},e.fromPromise=function(e){var t=new m,r=!1;return e.then(void 0,(function(){return null})).then((function(){r?t.fire(void 0):setTimeout((function(){return t.fire(void 0)}),0)})),r=!0,t.event},e.toPromise=function(e){return new Promise((function(r){return t(e)(r)}))}}(h||(h={}));r("../packages/lib/dom.ts")},"../packages/lib/jsesc/index.js":function(e,t,r){"use strict";(function(t){r("../node_modules/core-js/modules/es.array.from.js"),r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/es.string.repeat.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/web.url.to-json.js");var n={},o=n.hasOwnProperty,a=function(e,t){for(var r in e)o.call(e,r)&&t(r,e[r])},s=function(e){return"\\u"+("0000"+e).slice(-4)},i=function(e,t){var r=e.toString(16);return t?r:r.toUpperCase()},u=n.toString,l=Array.isArray,c={"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t"},d=/[\\\b\f\n\r\t]/,f=/[0-9]/,h=/[\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000]/,m=/([\uD800-\uDBFF][\uDC00-\uDFFF])|([\uD800-\uDFFF])|(['"`])|[^]/g,p=/([\uD800-\uDBFF][\uDC00-\uDFFF])|([\uD800-\uDFFF])|(['"`])|[^ !#-&\(-\[\]-_a-~]/g,v=function e(r,n){var o,v,g=function(){S=R,++n.indentLevel,R=n.indent.repeat(n.indentLevel)},y={escapeEverything:!1,minimal:!1,isScriptContext:!1,quotes:"single",wrap:!1,es6:!1,json:!1,compact:!0,lowercaseHex:!1,numbers:"decimal",indent:"\t",indentLevel:0,__inline1__:!1,__inline2__:!1},_=n&&n.json;_&&(y.quotes="double",y.wrap=!0),o=y,"single"!=(n=(v=n)?(a(v,(function(e,t){o[e]=t})),o):o).quotes&&"double"!=n.quotes&&"backtick"!=n.quotes&&(n.quotes="single");var b,A="double"==n.quotes?'"':"backtick"==n.quotes?"`":"'",E=n.compact,j=n.lowercaseHex,R=n.indent.repeat(n.indentLevel),S="",C=n.__inline1__,T=n.__inline2__,w=E?"":"\n",O=!0,I="binary"==n.numbers,N="octal"==n.numbers,k="decimal"==n.numbers,M="hexadecimal"==n.numbers;if(_&&r&&"function"==typeof r.toJSON&&(r=r.toJSON()),!function(e){return"string"==typeof e||"[object String]"==u.call(e)}(r)){if(function(e){return"[object Map]"==u.call(e)}(r))return 0==r.size?"new Map()":(E||(n.__inline1__=!0,n.__inline2__=!1),"new Map("+e(Array.from(r),n)+")");if(function(e){return"[object Set]"==u.call(e)}(r))return 0==r.size?"new Set()":"new Set("+e(Array.from(r),n)+")";if(function(e){return"function"===typeof t&&t.isBuffer(e)}(r))return 0==r.length?"Buffer.from([])":"Buffer.from("+e(Array.from(r),n)+")";if(l(r))return b=[],n.wrap=!0,C&&(n.__inline1__=!1,n.__inline2__=!0),T||g(),function(e,t){for(var r=e.length,n=-1;++n<r;)t(e[n])}(r,(function(t){O=!1,T&&(n.__inline2__=!1),b.push((E||T?"":R)+e(t,n))})),O?"[]":T?"["+b.join(", ")+"]":"["+w+b.join(","+w)+w+(E?"":S)+"]";if(!function(e){return"number"==typeof e||"[object Number]"==u.call(e)}(r))return function(e){return"[object Object]"==u.call(e)}(r)?(b=[],n.wrap=!0,g(),a(r,(function(t,r){O=!1,b.push((E?"":R)+e(t,n)+":"+(E?"":" ")+e(r,n))})),O?"{}":"{"+w+b.join(","+w)+w+(E?"":S)+"}"):_?JSON.stringify(r)||"null":String(r);if(_)return JSON.stringify(r);if(k)return String(r);if(M){var D=r.toString(16);return j||(D=D.toUpperCase()),"0x"+D}if(I)return"0b"+r.toString(2);if(N)return"0o"+r.toString(8)}var x=n.escapeEverything?m:p;return b=r.replace(x,(function(e,t,r,o,a,u){if(t){if(n.minimal)return t;var l=t.charCodeAt(0),m=t.charCodeAt(1);return n.es6?"\\u{"+i(1024*(l-55296)+m-56320+65536,j)+"}":s(i(l,j))+s(i(m,j))}if(r)return s(i(r.charCodeAt(0),j));if("\0"==e&&!_&&!f.test(u.charAt(a+1)))return"\\0";if(o)return o==A||n.escapeEverything?"\\"+o:o;if(d.test(e))return c[e];if(n.minimal&&!h.test(e))return e;var p=i(e.charCodeAt(0),j);return _||p.length>2?s(p):"\\x"+("00"+p).slice(-2)})),"`"==A&&(b=b.replace(/\$\{/g,"\\${")),n.isScriptContext&&(b=b.replace(/<\/(script|style)/gi,"<\\/$1").replace(/<!--/g,_?"\\u003C!--":"\\x3C!--")),n.wrap&&(b=A+b+A),b};v.version="3.0.2",e.exports=v}).call(this,r("../node_modules/buffer/index.js").Buffer)},"../packages/report/src/index.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=function(){function e(t){Object(n.a)(this,e),this.cache=[],this.functionName=t,e.stack.push(this)}return Object(o.a)(e,[{key:"getProxyFunction",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function(){for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];if(e.module)return e.execute.apply(e,n);t||e.cache.push((function(){return e.execute.apply(e,n)}))}}},{key:"execute",value:function(){for(var e=this.functionName.split("."),t=this.getExecuteFunction(this.module,e),r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return t.func.apply(t.self,n)}},{key:"getExecuteFunction",value:function(e,t){var r=t.shift();return r?0===t.length?{self:e,func:e[r]}:this.getExecuteFunction(e[r],t):e}},{key:"initLoad",value:function(e){this.module=e,this.cache.length&&(this.cache.forEach((function(e){e()})),this.cache.length=0)}}],[{key:"eachLoad",value:function(t){e.stack.forEach((function(e){e.initLoad(t)}))}}]),e}();a.stack=[];var s={run:new a("run").getProxyFunction(),speed:{runReport:new a("speed.runReport").getProxyFunction(),hasDonePagePerformanceReport:new a("speed.hasDonePagePerformanceReport").getProxyFunction()},jank:{log:new a("jank.log").getProxyFunction(!0),startMonitor:new a("jank.startMonitor").getProxyFunction(),stopReport:new a("jank.stopReport").getProxyFunction(!0),restartReport:new a("jank.restartReport").getProxyFunction(!0)},tdwReport:new a("tdwReport").getProxyFunction(),tdwSingleReport:new a("tdwSingleReport").getProxyFunction(),flowlog:new a("flowlog").getProxyFunction(),monitor:new a("monitor").getProxyFunction(),huatuo:new a("huatuo").getProxyFunction(),retcode:new a("retcode").getProxyFunction(),tam:{reportT:new a("tam.reportT").getProxyFunction(),reportEvent:new a("tam.reportEvent").getProxyFunction()}};t.b=s},"../packages/services/src/descriptors.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Object(n.a)(this,e),this.ctor=t,this.staticArguments=r,this.supportsDelayedInstantiation=o}},"../packages/services/src/dispose.ts":function(e,t,r){"use strict";r.d(t,"f",(function(){return m})),r.d(t,"h",(function(){return p})),r.d(t,"e",(function(){return v})),r.d(t,"g",(function(){return g})),r.d(t,"b",(function(){return y})),r.d(t,"d",(function(){return b})),r.d(t,"a",(function(){return A})),r.d(t,"c",(function(){return E}));r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.symbol.description.js"),r("../node_modules/core-js/modules/es.symbol.iterator.js"),r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.from.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.function.name.js"),r("../node_modules/core-js/modules/es.object.freeze.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.set.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/esnext.set.add-all.js"),r("../node_modules/core-js/modules/esnext.set.delete-all.js"),r("../node_modules/core-js/modules/esnext.set.difference.js"),r("../node_modules/core-js/modules/esnext.set.every.js"),r("../node_modules/core-js/modules/esnext.set.filter.js"),r("../node_modules/core-js/modules/esnext.set.find.js"),r("../node_modules/core-js/modules/esnext.set.intersection.js"),r("../node_modules/core-js/modules/esnext.set.is-disjoint-from.js"),r("../node_modules/core-js/modules/esnext.set.is-subset-of.js"),r("../node_modules/core-js/modules/esnext.set.is-superset-of.js"),r("../node_modules/core-js/modules/esnext.set.join.js"),r("../node_modules/core-js/modules/esnext.set.map.js"),r("../node_modules/core-js/modules/esnext.set.reduce.js"),r("../node_modules/core-js/modules/esnext.set.some.js"),r("../node_modules/core-js/modules/esnext.set.symmetric-difference.js"),r("../node_modules/core-js/modules/esnext.set.union.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),o=r("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),a=r("../node_modules/@babel/runtime/helpers/esm/get.js"),s=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),i=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),u=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),l=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),c=r("../node_modules/@babel/runtime/helpers/esm/createClass.js");function d(e,t){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"===typeof e)return f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){i=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(i)throw a}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(u.a)(e);if(t){var o=Object(u.a)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}function m(e){}function p(e){return e}function v(e){return"function"===typeof e.dispose&&(0===e.dispose.length||1===e.dispose.length)}function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r={dispose:function(t){e(t)},disposableId:t};return r}var y=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Object(l.a)(this,e),this._toDispose=new Set,this._isDisposed=!1,this._once=!0,this._once=t}return Object(c.a)(e,[{key:"dispose",value:function(e){if(!this._isDisposed||!this._once)if(this._isDisposed=!0,e)this.clear(e);else{var t=j.traceRoot(this.constructor.name);this.clear(t),t.stop()}}},{key:"clear",value:function(e){var t=this;this._toDispose.forEach((function(r){var n=r.disposableId||r.constructor.name;r.dispose(e.branch(n)),r instanceof b||t._toDispose.delete(r)})),this._isDisposed=!1}},{key:"add",value:function(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return this._isDisposed&&this._once?e.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(t),t}}]),e}();y.DISABLE_DISPOSED_WARNING=!1;var _=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Object(l.a)(this,e),this._store=new y(t)}return Object(c.a)(e,[{key:"dispose",value:function(e){this._store.dispose(e)}},{key:"_register",value:function(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}}]),e}();_.None=Object.freeze({dispose:function(){}});var b=function(e){Object(s.a)(r,e);var t=h(r);function r(){return Object(l.a)(this,r),t.call(this,!1)}return Object(c.a)(r,[{key:"dispose",value:function(e){var t=this.constructor.name,n=e,o=!1;n||(n=j.traceRoot(t),o=!0),Object(a.a)(Object(u.a)(r.prototype),"dispose",this).call(this,n),o&&n.stop()}},{key:"_register",value:function(e){return Object(a.a)(Object(u.a)(r.prototype),"_register",this).call(this,e)}}]),r}(_),A=function(e){Object(s.a)(r,e);var t=h(r);function r(){var e;return Object(l.a)(this,r),e=t.call(this),Object(o.a)(e),e}return Object(c.a)(r,[{key:"dispose",value:function(e){Object(a.a)(Object(u.a)(r.prototype),"dispose",this).call(this,e)}}]),r}(_),E=function(e){return function(e){Object(s.a)(r,e);var t=h(r);function r(){var e;Object(l.a)(this,r);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a)))._store=new y,Object(o.a)(e),e}return Object(c.a)(r,[{key:"dispose",value:function(e){this._store.dispose(e)}},{key:"_register",value:function(e){return this._store.add(e)}}]),r}(e)},j=function(){function e(t){Object(l.a)(this,e),this.name=t,this._dep=[]}return Object(c.a)(e,[{key:"branch",value:function(t){var r=new e(t);return this._dep.push([t,r]),r}},{key:"stop",value:function(){["dispose ".concat(this.name),"".concat(function e(t,r){var o,a=[],s=new Array(t+1).join("\t"),i=d(r._dep);try{for(i.s();!(o=i.n()).done;){var u=Object(n.a)(o.value,2),l=u[0],c=u[1];if(c){a.push("".concat(s,"dispose -> ").concat(l));var f=e(t+1,c);f&&a.push(f)}else a.push("".concat(s,"dispose -> ").concat(l))}}catch(h){i.e(h)}finally{i.f()}return a.join("\n")}(1,this))].join("\n")}}],[{key:"traceRoot",value:function(t){return e._None}}]),e}();j._None=new(function(e){Object(s.a)(r,e);var t=h(r);function r(){return Object(l.a)(this,r),t.call(this,null)}return Object(c.a)(r,[{key:"stop",value:function(){}},{key:"branch",value:function(){return this}}]),r}(j)),j._totals=0},"../packages/services/src/dynamicLoader.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return g}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.function.name.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js");var n=r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),o=(r("../node_modules/regenerator-runtime/runtime.js"),r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js")),a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),s=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),u=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),l=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),c=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),d=r("../packages/services/src/instantiation.ts"),f=r("../packages/services/src/standaloneServices.ts"),h=r("../packages/services/src/dispose.ts");function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var o=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Object(u.a)(this,r)}}var p=function(e,t,r,n){var o,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(c.a)(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(s=(a<3?o(s):a>3?o(t,r,s):o(t,r))||s);return a>3&&s&&Object.defineProperty(t,r,s),s},v=function(e,t){return function(r,n){t(r,n,e)}},g=function(e){Object(i.a)(r,e);var t=m(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],o=arguments.length>1?arguments[1]:void 0;return Object(a.a)(this,r),(e=t.call(this)).instantiationService=o,e.loaded=!1,e.params=e.paramsToArray(n),e.disposableId="DynamicLoader",e}return Object(s.a)(r,[{key:"getInstance",value:function(){var e=Object(o.a)(regeneratorRuntime.mark((function e(t){var r,o,a,s,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.instance){e.next=2;break}return e.abrupt("return",this.instance);case 2:return e.next=4,this.loadModule();case 4:return(null===(r=e.sent)||void 0===r?void 0:r.name)&&(this.disposableId="".concat(r.name," Loader")),o=y(this.instantiationService),a=this.params.length>0?this.params:t||[],s=o.createInstance.apply(o,[r].concat(Object(n.a)(a))),this.instance=s,Object(h.e)(s)&&this._register(s),this._register(Object(h.g)((function(){i.instance=null}))),e.abrupt("return",s);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadModule",value:function(){var e=Object(o.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.loaded){e.next=6;break}return this.loaded=!0,e.next=4,this.getModule();case 4:t=e.sent,this.ctor=(null===t||void 0===t?void 0:t.default)||t;case 6:return e.abrupt("return",this.ctor);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"paramsToArray",value:function(e){return Array.isArray(e)?e:[e]}}]),r}(h.d);function y(e){var t=f.a.pluginInstantiationService.get();return e&&(e.addChild(t),t.attachParent(e)),t}g=p([v(1,d.a)],g)},"../packages/services/src/extensions.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return u}));var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../packages/services/src/descriptors.ts"),s=r("../packages/services/src/standaloneServices.ts"),i=function(){function e(){Object(n.a)(this,e),this._registry=[]}return Object(o.a)(e,[{key:"register",value:function(e,t,r,n){this._registry.push([e,new a.a(t,r,n)])}},{key:"getServiceDescriptors",value:function(){return this._registry}}]),e}();function u(e,t,r,n){s.a.pluginInstantiationService.get().addService(e,new a.a(t,r,n))}},"../packages/services/src/graph.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.symbol.description.js"),r("../node_modules/core-js/modules/es.symbol.iterator.js"),r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.from.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.function.name.js"),r("../node_modules/core-js/modules/es.map.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/esnext.map.delete-all.js"),r("../node_modules/core-js/modules/esnext.map.every.js"),r("../node_modules/core-js/modules/esnext.map.filter.js"),r("../node_modules/core-js/modules/esnext.map.find.js"),r("../node_modules/core-js/modules/esnext.map.find-key.js"),r("../node_modules/core-js/modules/esnext.map.includes.js"),r("../node_modules/core-js/modules/esnext.map.key-of.js"),r("../node_modules/core-js/modules/esnext.map.map-keys.js"),r("../node_modules/core-js/modules/esnext.map.map-values.js"),r("../node_modules/core-js/modules/esnext.map.merge.js"),r("../node_modules/core-js/modules/esnext.map.reduce.js"),r("../node_modules/core-js/modules/esnext.map.some.js"),r("../node_modules/core-js/modules/esnext.map.update.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),o=r("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js");function i(e,t){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"===typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){i=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(i)throw a}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var l=function e(t){Object(s.a)(this,e),this.incoming=new Map,this.outgoing=new Map,this.data=t},c=function(){function e(t){Object(s.a)(this,e),this._hashFn=t,this._nodes=new Map}return Object(a.a)(e,[{key:"roots",value:function(){var e,t=[],r=i(this._nodes.values());try{for(r.s();!(e=r.n()).done;){var n=e.value;0===n.outgoing.size&&t.push(n)}}catch(o){r.e(o)}finally{r.f()}return t}},{key:"insertEdge",value:function(e,t){var r=this.lookupOrInsertNode(e),n=this.lookupOrInsertNode(t);r.outgoing.set(this._hashFn(t),n),n.incoming.set(this._hashFn(e),r)}},{key:"removeNode",value:function(e){var t=this._hashFn(e);this._nodes.delete(t);var r,n=i(this._nodes.values());try{for(n.s();!(r=n.n()).done;){var o=r.value;o.outgoing.delete(t),o.incoming.delete(t)}}catch(a){n.e(a)}finally{n.f()}}},{key:"lookupOrInsertNode",value:function(e){var t=this._hashFn(e),r=this._nodes.get(t);return r||(r=new l(e),this._nodes.set(t,r)),r}},{key:"lookup",value:function(e){return this._nodes.get(this._hashFn(e))}},{key:"isEmpty",value:function(){return 0===this._nodes.size}},{key:"toString",value:function(){var e,t=[],r=i(this._nodes);try{for(r.s();!(e=r.n()).done;){var a=Object(o.a)(e.value,2),s=a[0],u=a[1];t.push("".concat(s,", (incoming)[").concat(Object(n.a)(u.incoming.keys()).join(", "),"], (outgoing)[").concat(Object(n.a)(u.outgoing.keys()).join(","),"]"))}}catch(l){r.e(l)}finally{r.f()}return t.join("\n")}}]),e}()},"../packages/services/src/idleValue.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=function(){function e(t){var r=this;Object(n.a)(this,e),this._didRun=!1,this._executor=function(){try{r._value=t()}catch(e){r._error=e}finally{r._didRun=!0}}}return Object(o.a)(e,[{key:"value",get:function(){if(this._didRun||this._executor(),this._error)throw this._error;return this._value}}]),e}()},"../packages/services/src/instantiation.ts":function(e,t,r){"use strict";(function(e){r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return o})),r.d(t,"c",(function(){return s})),r.d(t,"d",(function(){return i}));var n;r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.map.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/esnext.map.delete-all.js"),r("../node_modules/core-js/modules/esnext.map.every.js"),r("../node_modules/core-js/modules/esnext.map.filter.js"),r("../node_modules/core-js/modules/esnext.map.find.js"),r("../node_modules/core-js/modules/esnext.map.find-key.js"),r("../node_modules/core-js/modules/esnext.map.includes.js"),r("../node_modules/core-js/modules/esnext.map.key-of.js"),r("../node_modules/core-js/modules/esnext.map.map-keys.js"),r("../node_modules/core-js/modules/esnext.map.map-values.js"),r("../node_modules/core-js/modules/esnext.map.merge.js"),r("../node_modules/core-js/modules/esnext.map.reduce.js"),r("../node_modules/core-js/modules/esnext.map.some.js"),r("../node_modules/core-js/modules/esnext.map.update.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");!function(e){e.serviceIds=new Map,e.DI_TARGET="$di$target",e.DI_DEPENDENCIES="$di$dependencies",e.getServiceDependencies=function(t){return t[e.DI_DEPENDENCIES]||[]}}(n||(n={}));var o=s("instantiationService");function a(e,t,r,o){t[n.DI_TARGET]===t?t[n.DI_DEPENDENCIES].push({id:e,index:r,optional:o}):(t[n.DI_DEPENDENCIES]=[{id:e,index:r,optional:o}],t[n.DI_TARGET]=t)}function s(e){if(n.serviceIds.has(e))return n.serviceIds.get(e);var t=function e(t,r,n){if(3!==arguments.length)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");a(e,t,n,!1)};return t.toString=function(){return e},n.serviceIds.set(e,t),t}function i(e){return function(t,r,n){if(3!==arguments.length)throw new Error("@optional-decorator can only be used to decorate a parameter");a(e,t,n,!0)}}e.$di$createDecorator=s}).call(this,r("../node_modules/webpack/buildin/global.js"))},"../packages/services/src/instantiationService.ts":function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return C}));r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.symbol.description.js"),r("../node_modules/core-js/modules/es.symbol.iterator.js"),r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.from.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.function.name.js"),r("../node_modules/core-js/modules/es.number.to-fixed.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.set.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/esnext.set.add-all.js"),r("../node_modules/core-js/modules/esnext.set.delete-all.js"),r("../node_modules/core-js/modules/esnext.set.difference.js"),r("../node_modules/core-js/modules/esnext.set.every.js"),r("../node_modules/core-js/modules/esnext.set.filter.js"),r("../node_modules/core-js/modules/esnext.set.find.js"),r("../node_modules/core-js/modules/esnext.set.intersection.js"),r("../node_modules/core-js/modules/esnext.set.is-disjoint-from.js"),r("../node_modules/core-js/modules/esnext.set.is-subset-of.js"),r("../node_modules/core-js/modules/esnext.set.is-superset-of.js"),r("../node_modules/core-js/modules/esnext.set.join.js"),r("../node_modules/core-js/modules/esnext.set.map.js"),r("../node_modules/core-js/modules/esnext.set.reduce.js"),r("../node_modules/core-js/modules/esnext.set.some.js"),r("../node_modules/core-js/modules/esnext.set.symmetric-difference.js"),r("../node_modules/core-js/modules/esnext.set.union.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),o=r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),a=r("../node_modules/@babel/runtime/helpers/esm/construct.js"),s=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=r("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),u=r("../node_modules/@babel/runtime/helpers/esm/get.js"),l=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),c=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),d=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),f=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),h=r("../node_modules/@babel/runtime/helpers/esm/wrapNativeSuper.js"),m=r("../packages/services/src/graph.ts"),p=r("../packages/services/src/descriptors.ts"),v=r("../packages/services/src/instantiation.ts"),g=r("../packages/services/src/serviceCollection.ts"),y=r("../packages/services/src/idleValue.ts"),_=r("../packages/services/src/dispose.ts");function b(e,t){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"===typeof e)return A(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return A(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){i=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(i)throw a}}}}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function E(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(f.a)(e);if(t){var o=Object(f.a)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Object(d.a)(this,r)}}var j,R=function(e){Object(c.a)(r,e);var t=E(r);function r(e){var n;return Object(l.a)(this,r),(n=t.call(this,"cyclic dependency between services")).message=e.toString(),n}return r}(Object(h.a)(Error)),S="function"===typeof e.Proxy,C=function(e){Object(c.a)(r,e);var t=E(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new g.a,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2?arguments[2]:void 0;return Object(l.a)(this,r),(e=t.call(this))._services=n,e._strict=o,e._parent=a,e._services.set(v.a,Object(i.a)(e)),e}return Object(s.a)(r,[{key:"createChild",value:function(e){return new r(e,this._strict,this)}},{key:"addChild",value:function(e){return this._children||(this._children=new Set),!this._children.has(e)&&e!==this&&(this._children.add(e),this._register(e),!0)}},{key:"removeChild",value:function(e){return!!this._children&&(!!this._children.has(e)&&(this._children.delete(e),!0))}},{key:"attachParent",value:function(e){return this._parent!==e&&e!==this&&(this._parent=e,!0)}},{key:"dettachParent",value:function(){this._parent=void 0}},{key:"dispose",value:function(e){Object(u.a)(Object(f.a)(r.prototype),"dispose",this).call(this,e),this._services.dispose(),this._children&&this._children.clear()}},{key:"addService",value:function(e,t){this._services.get(e)||(t instanceof p.a||!Object(_.e)(t)||this._register(t),this._services.set(e,t))}},{key:"invokeFunction",value:function(e){var t=this,r=T.traceInvocation(e),n=!1;try{for(var o={get:function(e,o){if(n)throw new Error("service accessor is only valid during the invocation of its target method");var a=t._getOrCreateServiceInstance(e,r);if(!a&&o!==v.d)throw new Error("[invokeFunction] unknown service '".concat(e,"'"));return a}},a=arguments.length,s=new Array(a>1?a-1:0),i=1;i<a;i++)s[i-1]=arguments[i];return e.apply(void 0,[o].concat(s))}finally{n=!0,r.stop()}}},{key:"createInstance",value:function(e){for(var t,r,n=arguments.length,o=new Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];return e instanceof p.a?(t=T.traceCreation(e.ctor),r=this._createInstance(e.ctor,e.staticArguments.concat(o),t)):(t=T.traceCreation(e),r=this._createInstance(e,o,t)),t.stop(),r}},{key:"_createInstance",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,s=v.b.getServiceDependencies(e).sort((function(e,t){return e.index-t.index})),i=[],u=b(s);try{for(u.s();!(t=u.n()).done;){var l=t.value,c=this._getOrCreateServiceInstance(l.id,n);if(!c&&this._strict&&!l.optional)throw new Error("[createInstance] ".concat(e.name," depends on UNKNOWN service ").concat(l.id,"."));i.push(c)}}catch(m){u.e(m)}finally{u.f()}var d=s.length>0?s[0].index:r.length;if(r.length!==d){console.warn("[createInstance] First service dependency of ".concat(e.name," at position ").concat(d+1," conflicts with ").concat(r.length," static arguments"));var f=d-r.length;r=f>0?r.concat(new Array(f)):r.slice(0,d)}var h=Object(a.a)(e,[].concat(Object(o.a)(r),i));return h}},{key:"_setServiceInstance",value:function(e,t){if(this._services.get(e)instanceof p.a)this._services.set(e,t),Object(_.e)(t)&&this._register(t);else{if(!this._parent)throw new Error("illegalState - setting UNKNOWN service instance");this._parent._setServiceInstance(e,t)}}},{key:"_getServiceInstanceOrDescriptor",value:function(e){var t=this._services.get(e);return!t&&this._parent?this._parent._getServiceInstanceOrDescriptor(e):t}},{key:"_getOrCreateServiceInstance",value:function(e,t){var r=this._getServiceInstanceOrDescriptor(e);return r instanceof p.a?this._createAndCacheServiceInstance(e,r,t.branch(e,!0)):(T.traverse(t,e,!1)||t.branch(e,!1),r)}},{key:"_createAndCacheServiceInstance",value:function(e,t,r){for(var n=new m.a((function(e){return e.id.toString()})),o=0,a=[{id:e,desc:t,_trace:r}];a.length;){var s=a.pop();if(n.lookupOrInsertNode(s),o>1e3)throw new R(n);o+=1;var i,u=b(v.b.getServiceDependencies(s.desc.ctor));try{for(u.s();!(i=u.n()).done;){var l=i.value,c=this._getServiceInstanceOrDescriptor(l.id);if(c||l.optional||console.warn("[createInstance] ".concat(e," depends on ").concat(l.id," which is NOT registered.")),c instanceof p.a){var d={id:l.id,desc:c,_trace:s._trace.branch(l.id,!0)};n.insertEdge(s,d),a.push(d)}}}catch(A){u.e(A)}finally{u.f()}}for(;;){var f=n.roots();if(0===f.length){if(!n.isEmpty())throw new R(n);break}var h,g=b(f);try{for(g.s();!(h=g.n()).done;){var y=h.value.data,_=this._createServiceInstanceWithOwner(y.id,y.desc.ctor,y.desc.staticArguments,y.desc.supportsDelayedInstantiation,y._trace);this._setServiceInstance(y.id,_),n.removeNode(y)}}catch(A){g.e(A)}finally{g.f()}}return this._getServiceInstanceOrDescriptor(e)}},{key:"_createServiceInstanceWithOwner",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;if(this._services.get(e)instanceof p.a)return this._createServiceInstance(t,r,n,o);if(this._parent)return this._parent._createServiceInstanceWithOwner(e,t,r,n,o);throw new Error("illegalState - creating UNKNOWN service instance ".concat(t.name))}},{key:"_createServiceInstance",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0;if(!n||!S)return this._createInstance(e,r,o);var a=new y.a((function(){return t._createInstance(e,r,o)}));return new Proxy(Object.create(null),{get:function(e,t){if(t in e)return e[t];var r=a.value,n=r[t];return"function"!==typeof n||(n=n.bind(r),e[t]=n),n},set:function(e,t,r){return a.value[t]=r,!0}})}}]),r}(_.d);!function(e){e[e.Creation=0]="Creation",e[e.Invocation=1]="Invocation",e[e.Branch=2]="Branch"}(j||(j={}));var T=function(){function e(t,r){Object(l.a)(this,e),this.type=t,this.name=r,this._start=Date.now(),this._dep=[]}return Object(s.a)(e,[{key:"branch",value:function(t,r){var n=new e(j.Branch,t.toString());return this._dep.push([t,r,n]),n}},{key:"stop",value:function(){var t=Date.now()-this._start;e._totals+=t;var r=!1;var o=["".concat(this.type===j.Creation?"CREATE":"CALL"," ").concat(this.name),"".concat(function e(t,o){var a,s=[],i=new Array(t+1).join("\t"),u=b(o._dep);try{for(u.s();!(a=u.n()).done;){var l=Object(n.a)(a.value,3),c=l[0],d=l[1],f=l[2];if(d&&f){r=!0,s.push("".concat(i,"CREATES -> ").concat(c));var h=e(t+1,f);h&&s.push(h)}else s.push("".concat(i,"uses -> ").concat(c))}}catch(m){u.e(m)}finally{u.f()}return s.join("\n")}(1,this)),"DONE, took ".concat(t.toFixed(2),"ms (grand total ").concat(e._totals.toFixed(2),"ms)")];(t>2||r)&&o.join("\n")}}],[{key:"traceInvocation",value:function(t){return e._None}},{key:"traceCreation",value:function(t){return e._None}},{key:"traverse",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return r}}]),e}();T._None=new(function(e){Object(c.a)(r,e);var t=E(r);function r(){return Object(l.a)(this,r),t.call(this,-1,null)}return Object(s.a)(r,[{key:"stop",value:function(){}},{key:"branch",value:function(){return this}}]),r}(T)),T._totals=0}).call(this,r("../node_modules/webpack/buildin/global.js"))},"../packages/services/src/registry.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.map.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/esnext.map.delete-all.js"),r("../node_modules/core-js/modules/esnext.map.every.js"),r("../node_modules/core-js/modules/esnext.map.filter.js"),r("../node_modules/core-js/modules/esnext.map.find.js"),r("../node_modules/core-js/modules/esnext.map.find-key.js"),r("../node_modules/core-js/modules/esnext.map.includes.js"),r("../node_modules/core-js/modules/esnext.map.key-of.js"),r("../node_modules/core-js/modules/esnext.map.map-keys.js"),r("../node_modules/core-js/modules/esnext.map.map-values.js"),r("../node_modules/core-js/modules/esnext.map.merge.js"),r("../node_modules/core-js/modules/esnext.map.reduce.js"),r("../node_modules/core-js/modules/esnext.map.some.js"),r("../node_modules/core-js/modules/esnext.map.update.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=new(function(){function e(){Object(n.a)(this,e),this.data=new Map}return Object(o.a)(e,[{key:"add",value:function(e,t){this.data.set(e,t)}},{key:"knows",value:function(e){return this.data.has(e)}},{key:"as",value:function(e){return this.data.get(e)||null}}]),e}())},"../packages/services/src/serviceCollection.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.map.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/esnext.map.delete-all.js"),r("../node_modules/core-js/modules/esnext.map.every.js"),r("../node_modules/core-js/modules/esnext.map.filter.js"),r("../node_modules/core-js/modules/esnext.map.find.js"),r("../node_modules/core-js/modules/esnext.map.find-key.js"),r("../node_modules/core-js/modules/esnext.map.includes.js"),r("../node_modules/core-js/modules/esnext.map.key-of.js"),r("../node_modules/core-js/modules/esnext.map.map-keys.js"),r("../node_modules/core-js/modules/esnext.map.map-values.js"),r("../node_modules/core-js/modules/esnext.map.merge.js"),r("../node_modules/core-js/modules/esnext.map.reduce.js"),r("../node_modules/core-js/modules/esnext.map.some.js"),r("../node_modules/core-js/modules/esnext.map.update.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),s=r("../packages/services/src/descriptors.ts"),i=r("../packages/services/src/dynamicLoader.ts"),u=r("../packages/services/src/instantiationService.ts"),l=function e(t,r){Object(a.a)(this,e),this.instance=t,this.descriptor=r},c=function(){function e(){Object(a.a)(this,e),this._entries=new Map;for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];for(var s=0,i=r;s<i.length;s++){var u=Object(n.a)(i[s],2),l=u[0],c=u[1];this.set(l,c)}}return Object(o.a)(e,[{key:"set",value:function(e,t){var r=this._entries.get(e);if(r)if(t instanceof s.a){if(r.instance)throw new Error("should not update holder's descriptor, when it already has instance");var n;(function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){return e===t};if(e===t)return!0;if(!e||!t)return!1;if(e.length!==t.length)return!1;for(var n=0,o=e.length;n<o;n++)if(!r(e[n],t[n]))return!1;return!0})(t.staticArguments,null===(n=r.descriptor)||void 0===n?void 0:n.staticArguments)||(r=new l(null,t))}else r.instance||(r.instance=t);else r=t instanceof s.a?new l(null,t):new l(t,null);this._entries.set(e,r)}},{key:"forEach",value:function(e){this._entries.forEach((function(t,r){return e(r,t)}))}},{key:"has",value:function(e){return this._entries.has(e)}},{key:"get",value:function(e){var t=this._entries.get(e);return(null===t||void 0===t?void 0:t.instance)||(null===t||void 0===t?void 0:t.descriptor)||void 0}},{key:"dispose",value:function(){var e=this;this._entries.forEach((function(t,r){t.descriptor&&t.instance&&(t.instance instanceof i.a||(t.instance=null)),!t.descriptor&&t.instance&&(t.instance instanceof u.a||e._entries.delete(r))}))}}]),e}()},"../packages/services/src/standaloneServices.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n,o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=r("../packages/services/src/instantiation.ts"),i=r("../packages/services/src/instantiationService.ts");!function(e){var t,r=function(){function e(t,r){Object(o.a)(this,e),this._serviceId=t,this._factory=r,this._value=null}return Object(a.a)(e,[{key:"get",value:function(){if(!this._value&&(this._value||(this._value=this._factory()),!this._value))throw new Error("Service ".concat(this._serviceId," is missing!"));return this._value}},{key:"remove",value:function(){this._value=null}},{key:"id",get:function(){return this._serviceId}}]),e}();e.LazyStaticService=r,e.pluginInstantiationService=(t=s.a,new r(t,(function(){return new i.a})))}(n||(n={}))},"../packages/undoRedoStack/src/index.ts":function(e,t,r){"use strict";r.d(t,"b",(function(){return _})),r.d(t,"a",(function(){return A}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=function(){function e(t){Object(o.a)(this,e),this.spreadsheet=t.spreadsheet,this.redo=t.redo||[],this.undo=t.undo||[],this.local=!!t.local,this.sheetId=t.sheetId,this.fromMultiSheetRequest=t.fromMultiSheetRequest||!1}return Object(a.a)(e,[{key:"add",value:function(e){var t=this;this.redo=this.redo.concat(e);try{this.local&&e.forEach((function(e){var r=e.parentRequestId,n=e.invert(t.spreadsheet);n.forEach((function(e){e.parentRequestId=r})),t.undo=n.concat(t.undo)}))}catch(r){console.error(r)}}},{key:"run",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];r&&(this.redo=[]),this.undo.forEach((function(o){r&&(t.redo=[].concat(Object(n.a)(o.invert(t.spreadsheet)),Object(n.a)(t.redo))),e.applyMutation(o,{isLocal:!0},t.spreadsheet)}))}},{key:"reverse",value:function(){return new e({spreadsheet:this.spreadsheet,sheetId:this.sheetId,redo:this.undo,undo:this.redo,local:this.local,fromMultiSheetRequest:this.fromMultiSheetRequest})}}]),e}(),i=(r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.splice.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js")),u=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),l=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),c=r("../packages/mutation/src/index.ts"),d=r("../packages/mutation/src/api.interface.ts"),f=r("../packages/model/src/spreadsheet/Spreadsheet.interface.ts");function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){Object(u.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var p=function(e,t,r,n){var o,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(l.a)(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(s=(a<3?o(s):a>3?o(t,r,s):o(t,r))||s);return a>3&&s&&Object.defineProperty(t,r,s),s},v=function(e,t){return function(r,n){t(r,n,e)}},g=c.e,y=function(){function e(t,r){Object(o.a)(this,e),this.spreadsheet=t,this.mutationBehavior=r,this.undoStack=[],this.redoStack=[],this.localUndoSize=0}return Object(a.a)(e,[{key:"createUndoRedoMutations",value:function(e){return new s(m(m({},e),{},{spreadsheet:this.spreadsheet}))}},{key:"push",value:function(e){this.clearRedoStack(),this.pushUndoStack(e)}},{key:"canUndo",value:function(){return!!this.undoStack.length}},{key:"canRedo",value:function(){return!!this.redoStack.length}},{key:"undo",value:function(){var e=this.getLocalMutations(this.undoStack);if(e){this.localUndoSize-=1;var t=e.mutations,r=e.index,n=!1;r>=1&&(t=this.transform(t,{stack:this.undoStack,pointer:r-1}),r===this.undoStack.length&&(n=!0)),t.undo.forEach((function(e){e.operationType=g.UNDO})),t.run(this.mutationBehavior,r>=1);var o=t.reverse();return this.redoStack.unshift(o),n&&this.clearUndoStack(),t}}},{key:"redo",value:function(){var e=this.getLocalMutations(this.redoStack);if(!e)return console.log("redo stack is empty");var t=e.mutations,r=e.index,n=!1;r>=1&&(t=this.transform(t,{stack:this.redoStack,pointer:r-1}),r===this.redoStack.length&&(n=!0)),t.undo.forEach((function(e){e.operationType=g.REDO})),t.run(this.mutationBehavior,r>=1);var o=t.reverse();return this.pushUndoStack(o),n&&this.clearRedoStack(),t}},{key:"sync",value:function(e){this.undoStack.length>0&&this.undoStack.unshift(e),this.redoStack.length>0&&this.redoStack.unshift(e)}},{key:"transform",value:function(e,t){for(var r,n=t.stack,o=t.pointer;o>=0;){r=n[o];var a=this.mutationBehavior.followRequestMutations([e.undo],[r.redo],!0),s=Object(i.a)(a,1)[0],u=this.mutationBehavior.followRequestMutations([r.redo],[e.undo],!1),l=Object(i.a)(u,1)[0];e.undo=l,e.redo=[],n[o].redo=s,o-=1}return e}},{key:"destroy",value:function(){this.clearUndoStack(),this.clearRedoStack()}},{key:"clearUndoStack",value:function(){this.localUndoSize=0,this.undoStack.length=0}},{key:"clearRedoStack",value:function(){this.redoStack.length=0}},{key:"pushUndoStack",value:function(t){if(this.undoStack.unshift(t),this.localUndoSize+=1,!(this.localUndoSize<=e.MAX_STACK_SIZE))for(var r=this.undoStack.length-1,n=0;;r--){if(this.undoStack[r].local&&2===(n+=1)){this.localUndoSize-=1;break}this.undoStack.pop()}}},{key:"getLocalMutations",value:function(e){var t,r;for(t=0;t<e.length;t++)if((r=e[t]).local)return e.splice(t,1),{mutations:r,index:t};return null}}]),e}();y.MAX_STACK_SIZE=100;var _=y=p([v(0,f.a),v(1,d.a)],y),b=r("../packages/services/src/instantiation.ts"),A=Object(b.c)("IUndoRedoStack")},"../packages/utils/src/index.ts":function(e,t,r){"use strict";var n=r("../packages/utils/src/random.ts");r.d(t,"a",(function(){return n}));r("../packages/utils/src/url.ts"),r("../packages/utils/src/safe.ts")},"../packages/utils/src/random.ts":function(e,t,r){"use strict";function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e9,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9999999999,r=Math.floor(Math.random()*(t-e+1))+e;return String(r)}r.r(t),r.d(t,"getRandomId",(function(){return n}))},"../packages/utils/src/safe.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return a}));var n=r("../packages/common-utils/src/cookie.ts");function o(){var e=Object(n.getCookie)("skey"),t=5381;if(e){for(var r=0,o=e.length;r<o;r++)t+=(t<<5)+e.charAt(r).charCodeAt(0);return 2147483647&t}}function a(){return Object(n.getCookie)("TOK")||""}},"../packages/utils/src/url.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.index-of.js");var n=r("../packages/common-utils/src/url.ts");function o(e){var t=Object(n.getQuery)("uid"),r=Object(n.getQuery)("uid_key"),o=t?"uid=".concat(t,"&uid_key=").concat(r):"";if(!o)return e;var a=-1!==e.indexOf("?")?"&":"?";return"".concat(e).concat(a).concat(o)}},"./src/base/config/font.ts":function(e,t,r){"use strict";r.d(t,"c",(function(){return s})),r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return i}));r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.set.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/esnext.set.add-all.js"),r("../node_modules/core-js/modules/esnext.set.delete-all.js"),r("../node_modules/core-js/modules/esnext.set.difference.js"),r("../node_modules/core-js/modules/esnext.set.every.js"),r("../node_modules/core-js/modules/esnext.set.filter.js"),r("../node_modules/core-js/modules/esnext.set.find.js"),r("../node_modules/core-js/modules/esnext.set.intersection.js"),r("../node_modules/core-js/modules/esnext.set.is-disjoint-from.js"),r("../node_modules/core-js/modules/esnext.set.is-subset-of.js"),r("../node_modules/core-js/modules/esnext.set.is-superset-of.js"),r("../node_modules/core-js/modules/esnext.set.join.js"),r("../node_modules/core-js/modules/esnext.set.map.js"),r("../node_modules/core-js/modules/esnext.set.reduce.js"),r("../node_modules/core-js/modules/esnext.set.some.js"),r("../node_modules/core-js/modules/esnext.set.symmetric-difference.js"),r("../node_modules/core-js/modules/esnext.set.union.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n,o=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),a=r.n(o),s={"Microsoft YaHei":"\u5fae\u8f6f\u96c5\u9ed1",SimSun:"\u5b8b\u4f53",SimHei:"\u9ed1\u4f53",FangSong:"\u4eff\u5b8b",KaiTi:"\u6977\u4f53","DFKai-SB":"\u6807\u6977\u4f53",STFangsong:"\u534e\u6587\u4eff\u5b8b",STKaiti:"\u534e\u6587\u6977\u4f53",STSong:"\u534e\u6587\u5b8b\u4f53",NSimSun:"\u65b0\u5b8b\u4f53","Microsoft JhengHei":"\u5fae\u8f6f\u6b63\u9ed1\u4f53",PMingLiU:"\u65b0\u7ec6\u660e\u4f53","Hiragino Sans GB":"\u51ac\u9752\u9ed1\u7b80\u4f53\u4e2d\u6587","PingFang SC":"\u82f9\u65b9"},i={"\u5fae\u8f6f\u96c5\u9ed1":"Microsoft YaHei","\u5b8b\u4f53":"SimSun","\u9ed1\u4f53":"SimHei","\u4eff\u5b8b":"FangSong","\u6977\u4f53":"KaiTi","\u6807\u6977\u4f53":"DFKai-SB","\u534e\u6587\u4eff\u5b8b":"STFangsong","\u534e\u6587\u6977\u4f53":"STKaiti","\u534e\u6587\u5b8b\u4f53":"STSong","\u65b0\u5b8b\u4f53":"NSimSun","\u5fae\u8f6f\u6b63\u9ed1\u4f53":"Microsoft JhengHei","\u65b0\u7ec6\u660e\u4f53":"PMingLiU","\u51ac\u9752\u9ed1\u7b80\u4f53\u4e2d\u6587":"Hiragino Sans GB","\u82f9\u65b9":"PingFang SC"};!function(){var e=document.createElement("canvas"),t=e.getContext("2d");e.width=100,e.height=100,t.textAlign="center",t.fillStyle="black",t.textBaseline="middle";var r=o("Arial").join("");function o(e){t.clearRect(0,0,30,30),t.font="100px ".concat(e,", Arial"),t.fillText("a",15,15);var r=t.getImageData(0,0,30,30).data;return[].slice.call(r).filter((function(e){return 0!=e}))}if(a.a.isMac){n=new Set(["Hiragino Sans GB","PingFang SC","STSong","STFangsong","STKaiti","Arial","Times New Roman","Comic Sans MS","Courier New","Georgia","Impact","Trebuchet MS","Verdana","Al Bayan","Al Nile","Al Tarikh","American Typewriter","Andale Mono","Arial Black","Arial Hebrew","Arial Hebrew Scholar","Arial Narrow","Arial Rounded MT Bold","Arial Unicode MS","Athelas","Avenir","Avenir Next","Avenir Next Condensed","Ayuthaya","Baghdad","Bangla MN","Bangla Sangam MN","Baskerville","Beirut","Big Caslon","Bodoni Ornaments","Bradley Hand","Brush Script MT","Chalkboard","Chalkboard SE","Chalkduster","Charter","Cochin","Copperplate","Corsiva Hebrew","Courier","Damascus","DecoType Naskh","Devanagari MT","Devanagari Sangam MN","Didot","DIN Alternate","DIN Condensed","Diwan Kufi","Diwan Thuluth","Euphemia UCAS","Farah","Farisi","Futura","GB18030 Bitmap","Geeza Pro","Geneva","Gill Sans","Gujarati MT","Gujarati Sangam MN","Gurmukhi MN","Gurmukhi MT","Gurmukhi Sangam MN","Hei","Helvetica","Helvetica Neue","Herculanum","Hiragino Kaku Gothic Pro","Hiragino Kaku Gothic ProN","Hiragino Kaku Gothic Std","Hiragino Kaku Gothic StdN","Hiragino Maru Gothic Pro","Hiragino Maru Gothic ProN","Hiragino Mincho Pro","Hiragino Mincho ProN","Hiragino Sans","Hoefler Text","InaiMathi","Iowan Old Style","ITF Devanagari","ITF Devanagari Marathi","Kai","Kailasa","Kannada MN","Kannada Sangam MN","Kefa","Khmer MN","Khmer Sangam MN","Kohinoor Bangla","Kohinoor Devanagari","Kohinoor Telugu","Kokonor","Krungthep","KufiStandardGK","Lao MN","Lao Sangam MN","Lucida Grande","Luminari","Malayalam MN","Malayalam Sangam MN","Marion","Marker Felt","Menlo","Microsoft Sans Serif","Mishafi","Mishafi Gold","Monaco","Mshtakan","Muna","Myanmar MN","Myanmar Sangam MN","Nadeem","New Peninim MT","Noteworthy","Noto Nastaliq Urdu","Optima","Oriya MN","Oriya Sangam MN","Palatino","Papyrus","Phosphate","Plantagenet Cherokee","PT Mono","PT Sans","PT Sans Caption","PT Sans Narrow","PT Serif","PT Serif Caption","Raanana","Sana","Sathu","Savoye LET","Seravek","SignPainter","Silom","Sinhala MN","Sinhala Sangam MN","Skia","Snell Roundhand","STIXGeneral","STIXIntegralsD","STIXIntegralsSm","STIXIntegralsUp","STIXIntegralsUpD","STIXIntegralsUpSm","STIXNonUnicode","STIXSizeFiveSym","STIXSizeFourSym","STIXSizeOneSym","STIXSizeThreeSym","STIXSizeTwoSym","STIXVariants","Sukhumvit Set","Superclarendon","Symbol","Tahoma","Tamil MN","Tamil Sangam MN","Telugu MN","Telugu Sangam MN","Thonburi","Times","Trattatello","Waseem","Webdings","Wingdings","Zapf Dingbats","Zapfino","Apple Braille","Apple Chancery","Apple Color Emoji","Apple SD Gothic Neo","Apple Symbols","AppleGothic","AppleMyungjo"])}else if(a.a.isIOS){var s=["Microsoft YaHei","Times New Roman","Courier New","Futrua","Papyrus","Rockwell","Trebuchet MS","Verdana"].filter((function(e){return r!==o(e).join("")}));n=new Set(s)}else{n=new Set(["Microsoft YaHei","SimSun","SimHei","FangSong","KaiTi","DFKai-SB","STFangsong","STKaiti","STSong","NSimSun","Microsoft JhengHei","PMingLiU","Arial","Times New Roman","Calibri","Comic Sans MS","Courier New","Georgia","Microsoft Uighur","Impact","Trebuchet MS","Verdana","Aharoni","Andalus","AngsanaUPC","Angsana New","Aparajita","Arabic Typesetting","Arial Black","Arial Narrow","Batang","BatangChe","Bookman Old Style","Book Antiqua","Bradley Hand ITC","BrowalliaUPC","Browallia New","Cambria","Cambria Math","Candara","Century","Century Gothic","Consolas","Constantia","Corbel","CordiaUPC","Cordia New","DaunPenh","David","DilleniaUPC","DokChampa","Dotum","DotumChe","Ebrima","Estrangelo Edessa","EucrosiaUPC","Euphemia","Franklin Gothic","Franklin Gothic Medium","FrankRuehl","FreesiaUPC","Freestyle Script","French Script MT","Gabriola","Gadugi","Garamond","Gisha","Gulim","GulimChe","Gungsuh","GungsuhChe","Haettenschweiler","IrisUPC","Iskoola Pota","JasmineUPC","Juice ITC","Kalinga","Kartika","Khmer UI","KodchiangUPC","Kokila","Kristen ITC","Lao UI","Latha","Leelawadee","Levenim MT","LilyUPC","Lucida Console","Lucida Handwriting","Lucida Sans Unicode","Malgun Gothic","Mangal","Marlett","Meiryo","Meiryo UI","Microsoft Himalaya","Microsoft JhengHei UI","Microsoft JhengHei UI Light","Microsoft New Tai Lue","Microsoft PhagsPa","Microsoft Sans Serif","Microsoft Tai Le","Microsoft YaHei UI","Microsoft YaHei UI Light","Microsoft Yi Baiti","MingLiU-ExtB","MingLiU_HKSCS-ExtB","MingLiU_HKSCS","Miriam","Miriam Fixed","Mistral","Mongolian Baiti","Monotype.com","Monotype Corsiva","MoolBoran","MS Gothic","MS Mincho","MS Outlook","MS PGothic","MS PMincho","MS UI Gothic","MT Extra","MV Boli","Narkisim","Nirmala UI","Nyala","Palatino Linotype","Papyrus","Plantagenet Cherokee","PMingLiU-ExtB","Pristina","Raavi","Rod","Sakkal Majalla","Segoe Print","Segoe Script","Segoe UI Symbol","Shonar Bangla","Shruti","Simplified Arabic Fixed","Sylfaen","Symbol","Tahoma","Tempus Sans ITC","Traditional Arabic","Tunga","Utsaah","Vani","Vijaya","Vrinda","Webdings","Wingdings"])}}()},"./src/base/config/report.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"MONITOR_POINTS",(function(){return d})),r.d(t,"TDW_MODULE",(function(){return s})),r.d(t,"TDW_ACTION",(function(){return i})),r.d(t,"TDW_VER5_VALUE",(function(){return u})),r.d(t,"getTdwObj3Value",(function(){return f})),r.d(t,"CONFIG",(function(){return p})),r.d(t,"SENTRY_ERROR_TYPE",(function(){return h})),r.d(t,"SPEED_REPORT_POINTS",(function(){return m})),r.d(t,"SPEED_REPORT_LOG",(function(){return v}));r("../node_modules/core-js/modules/es.array.join.js");var n,o,a,s,i,u,l=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),c=r("../packages/mutation/src/MutationOperationType.ts"),d={CHECK_MUTATION_ERROR:33624582,CHECK_MUTATION_FAIL_MAP:(n={},Object(l.a)(n,c.a.HISTORY,33692346),Object(l.a)(n,c.a.LOCAL,33692347),Object(l.a)(n,c.a.UNDO,33692348),Object(l.a)(n,c.a.REDO,33692349),Object(l.a)(n,c.a.COLLAB,33692350),n),CHECK_HISTORY_MUTATION_FAIL_MAP:{0:35306455,1:35306456,2:35306457,3:35306458,4:35306459,5:35306460,6:35306461,7:35306462,8:35306463,9:35306464,10:35306465,11:35306466,12:35306467,13:35306468,14:35306469,15:35306470,16:35306471,17:35306472,18:35306473,19:35306474,20:35306475,21:35306476,22:35306477,23:35306478,24:35306479,25:35306480,26:35306481,27:35306482,28:35306483,29:35306484,30:35306485,31:35306486,32:35306487,33:35306488,34:35306489,35:35306490,36:35306491,37:35306492},CHECK_LOCAL_MUTATION_FAIL_MAP:{0:35306624,1:35306625,2:35306626,3:35306627,4:35306628,5:35306629,6:35306630,7:35306631,8:35306632,9:35306633,10:35306634,11:35306635,12:35306636,13:35306637,14:35306638,15:35306639,16:35306640,17:35306641,18:35306642,19:35306643,20:35306644,21:35306645,22:35306646,23:35306647,24:35306648,25:35306649,26:35306650,27:35306651,28:35306652,29:35306653,30:35306654,31:35306655,32:35306656,33:35306657,34:35306658,35:35306659,36:35306660,37:35306661},CHECK_UNDO_MUTATION_FAIL_MAP:{0:35308055,1:35308056,2:35308057,3:35308058,4:35308059,5:35308060,6:35308061,7:35308062,8:35308063,9:35308064,10:35308065,11:35308066,12:35308067,13:35308068,14:35308069,15:35308070,16:35308071,17:35308072,18:35308073,19:35308074,20:35308075,21:35308076,22:35308077,23:35308078,24:35308079,25:35308080,26:35308081,27:35308082,28:35308083,29:35308084,30:35308085,31:35308086,32:35308087,33:35308088,34:35308089,35:35308090,36:35308091,37:35308092},CHECK_REDO_MUTATION_FAIL_MAP:{0:35308143,1:35308144,2:35308145,3:35308146,4:35308147,5:35308148,6:35308149,7:35308150,8:35308151,9:35308152,10:35308153,11:35308154,12:35308155,13:35308156,14:35308157,15:35308158,16:35308159,17:35308160,18:35308161,19:35308162,20:35308163,21:35308164,22:35308165,23:35308166,24:35308167,25:35308168,26:35308169,27:35308170,28:35308171,29:35308172,30:35308173,31:35308174,32:35308175,33:35308176,34:35308177,35:35308178,36:35308179,37:35308180},CHECK_COLLAB_MUTATION_FAIL_MAP:{0:35308235,1:35308236,2:35308237,3:35308238,4:35308239,5:35308240,6:35308241,7:35308242,8:35308243,9:35308244,10:35308245,11:35308246,12:35308247,13:35308248,14:35308249,15:35308250,16:35308251,17:35308252,18:35308253,19:35308254,20:35308255,21:35308256,22:35308257,23:35308258,24:35308259,25:35308260,26:35308261,27:35308262,28:35308263,29:35308264,30:35308265,31:35308266,32:35308267,33:35308268,34:35308269,35:35308270,36:35308271,37:35308272},RUN_MUTATION_ERROR_MAP:(o={},Object(l.a)(o,c.a.HISTORY,33692646),Object(l.a)(o,c.a.LOCAL,33692647),Object(l.a)(o,c.a.UNDO,33692648),Object(l.a)(o,c.a.REDO,33692649),Object(l.a)(o,c.a.COLLAB,33692650),o),DESERIALIZE_MUTATION_ERROR:34817507,DESERIALIZE_MUTATION_ERROR_OLD:34817508,DESERIALIZE_MUTATION_FAIL:34817509,DESERIALIZE_MUTATION_FAIL_OLD:34860812,MERGE_GRID_RANGE_ERROR:33659770};function f(e,t){var r,n="";switch(e){case s.MUTATION:n=[null===(r=t.getAffectedSheetId)||void 0===r?void 0:r.call(t),t.parentRequestId,t.id,t.operationType].join("-")}return n}!function(e){e.MUTATION="mutation",e.OPERATION="operation"}(s||(s={})),function(e){e.CHECK_MUTATION="checkMutation",e.RUN_MUTATION="runMutation",e.DESERIALIZE_MUTATION="deserializeMutation",e.DESERIALIZE_MUTATION_FAIL="deserializeMutationFail",e.DESERIALIZE_MUTATION_ERROR="deserializeMutationError",e.PASTE_DATA_GENERATE_MUTATION="pasteDataGenerateMutation",e.MERGE_GRID_RANGE_ERROR="mergeGridRangeError"}(i||(i={})),function(e){e.CHECK_MUTATION_ERROR="1",e.CHECK_MUTATION_FAIL="2",e.RUN_MUTATION_ERROR="1",e.DESERIALIZE_MUTATION_FAIL="1",e.DESERIALIZE_MUTATION_FAIL_OLD="2",e.DESERIALIZE_MUTATION_ERROR="1",e.DESERIALIZE_MUTATION_ERROR_OLD="2",e.PASTE_DATA_GENERATE_MUTATION_INSERT_ERROR_NO_OPTION="1",e.PASTE_DATA_GENERATE_MUTATION_INSERT_ERROR_NO_EXPANSION="2",e.PASTE_DATA_GENERATE_MUTATION_SETRANGE_ERROR_NO_GRIDRANGE="3"}(u||(u={}));var h,m,p={CHECK_MUTATION_ERROR:"CHECK_MUTATION_ERROR",RUN_MUTATION_ERROR:"RUN_MUTATION_ERROR",CHECK_MUTATION_RESULT_ERROR:"CHECK_MUTATION_RESULT_ERROR",AFTER_MUTATION_RUN_CATCH_ERROR:"AFTER_MUTATION_RUN_CATCH_ERROR",AFTER_MUTATION_RUN_DATA_CHANGE_CATCH_ERROR:"AFTER_MUTATION_RUN_DATA_CHANGE_CATCH_ERROR",COMMIT_EMPTY_MUTATION:"COMMIT_EMPTY_MUTATION",DO_BEHAVIOR_AFTER_SHUTDOWN:"DO_BEHAVIOR_AFTER_SHUTDOWN",COMMIT_MUTATION_CATCH_ERROR:"COMMIT_MUTATION_CATCH_ERROR",COMMIT_MUTATION:"COMMIT_MUTATION",CACHE_DATA_FLOW_COMMIT_MUTATION:"CACHE_DATA_FLOW_COMMIT_MUTATION",PAGE_LOAD:"PAGE_LOAD",DUPLICATE_SHEET_ID:"DUPLICATE_SHEET_ID",SERIALIZE_MUTATION:"SERIALIZE_MUTATION",DESERIALIZE_MUTATION_FAIL:"DESERIALIZE_MUTATION_FAIL",DESERIALIZE_MUTATION_FAIL_OLD:"DESERIALIZE_MUTATION_FAIL_OLD",DESERIALIZE_MUTATION_CATCH_ERROR:"DESERIALIZE_MUTATION_CATCH_ERROR",DESERIALIZE_MUTATION_CATCH_ERROR_OLD:"DESERIALIZE_MUTATION_CATCH_ERROR_OLD",GET_COLLAB_MUTATIONS:"GET_COLLAB_MUTATIONS",CREATE_ZIPKETFRAME:"CREATE_ZIPKETFRAME",APPLY_NEW_CHANGES_ERROR:"APPLY_NEW_CHANGES_ERROR",LOAD_REQUEST:"LOAD_REQUEST",APPLY_BEHAVIOR_ERROR:"APPLY_BEHAVIOR_ERROR",APPLY_BEHAVIOR_CATCH_SCRIPT_ERROR:"APPLY_BEHAVIOR_CATCH_SCRIPT_ERROR",APPLY_BEHAVIOR_NOT_LOADED:"APPLY_BEHAVIOR_NOT_LOADED",APPLY_BEHAVIOR_LEVEL_INFO:"APPLY_BEHAVIOR_LEVEL_INFO",APPLY_BEHAVIOR_LEVEL_IMPORTANT:"APPLY_BEHAVIOR_LEVEL_IMPORTANT",APPLY_BEHAVIOR_LEVEL_IMPORTANT_MONITOR:"APPLY_BEHAVIOR_LEVEL_IMPORTANT_MONITOR",REQUEST_SIZE_OVER_LIMIT:"REQUEST_SIZE_OVER_LIMIT",FOLLOW_REQUEST_MUTATIONS:"FOLLOW_REQUEST_MUTATIONS",PASTE_DATA_GENERATE_MUTATION_1:"PASTE_DATA_GENERATE_MUTATION_1",PASTE_DATA_GENERATE_MUTATION_2:"PASTE_DATA_GENERATE_MUTATION_2",PASTE_DATA_GENERATE_MUTATION_3:"PASTE_DATA_GENERATE_MUTATION_3",DO_KEYFRAME_CATCH_ERROR_1:"DO_KEYFRAME_CATCH_ERROR_1",DO_KEYFRAME_CATCH_ERROR_2:"DO_KEYFRAME_CATCH_ERROR_2",DO_KEYFRAME_CATCH_ERROR_3:"DO_KEYFRAME_CATCH_ERROR_3",DO_KEYFRAME:"DO_KEYFRAME",DO_MUTATIONS:"DO_MUTATIONS",ZIP_KEYFRAME:"ZIP_KEYFRAME",ZIP_KEYFRAME_CATCH_ERROR:"ZIP_KEYFRAME_CATCH_ERROR",COPY_PASTE:"COPY_PASTE",CHOOSE_FORMAT_ERROR:"CHOOSE_FORMAT_ERROR",PARSE_FORMAT_ERROR:"PARSE_FORMAT_ERROR",RETRY_SENDMESSAGE:"RETRY_SENDMESSAGE",MOVE_MESSAGEINFO_COMMITING_QUEUE:"MOVE_MESSAGEINFO_COMMITING_QUEUE",RETRY_COMMIT:"RETRY_COMMIT",SEND_USERCHANGE:"SEND_USERCHANGE",SEND_USERCHANGE_1:"SEND_USERCHANGE_1",ACCEPT_COMMIT:"ACCEPT_COMMIT",HANDLE_COMMIT_ERROR:"HANDLE_COMMIT_ERROR",HANDLE_TASK_DUPLICATE:"HANDLE_TASK_DUPLICATE",TASK_DUPLICATE_VERSION_TOO_LOW:"TASK_DUPLICATE_VERSION_TOO_LOW",HANDLE_NEW_CHANGES:"HANDLE_NEW_CHANGES",APPLY_NEWCHANGES_VERROR:"APPLY_NEWCHANGES_VERROR",COMMITING_QUEUE_BLOCK:"COMMITING_QUEUE_BLOCK",DUPLICATE_MESSAGE:"DUPLICATE_MESSAGE",APPLY_NEWCHANGES_CATCH_ERROR:"APPLY_NEWCHANGES_CATCH_ERROR",APPLY_NEWCHANGES:"APPLY_NEWCHANGES",APPLY_NEWCHANGES_VERROR2:"APPLY_NEWCHANGES_VERROR2",APPLY_NEWCHANGES_VERROR5:"APPLY_NEWCHANGES_VERROR5",APPLY_NEWCHANGES_VERROR6:"APPLY_NEWCHANGES_VERROR6",SWITCH_CHANEL_STATUS:"SWITCH_CHANEL_STATUS",HANDLE_FETCH_RESULT:"HANDLE_FETCH_RESULT",FETCH_USERCHANGES_ERROR:"FETCH_USERCHANGES_ERROR",FETCH_AND_APPLY_MISSCHANGES:"FETCH_AND_APPLY_MISSCHANGES",EMPTY_KEYFRAME_BY_AUTOEXPAND:"EMPTY_KEYFRAME_BY_AUTOEXPAND",ADD_USER_CHANGE:"ADD_USER_CHANGE",CLEAR_OFFLINE_DATA_SIZE:"CLEAR_OFFLINE_DATA_SIZE",UPDATE_BASEVERSION:"UPDATE_BASEVERSION",UPDATE_BASEVERSION_ERROR:"UPDATE_BASEVERSION_ERROR",ACCEPT_COMMIT_2:"ACCEPT_COMMIT_2",FETCH_USERCHANGE_ARGUMENT:"FETCH_USERCHANGE_ARGUMENT",FETCH_USERCHANGES:"FETCH_USERCHANGES",FETCH_USERCHANGES_3:"FETCH_USERCHANGES_3",INIT_DATA_ERROR:"INIT_DATA_ERROR",STORE_DATA_ERROR:"STORE_DATA_ERROR",NOT_SUPPORT_INDEXEDDB:"NOT_SUPPORT_INDEXEDDB",OPEN_INDEXED_DB_FAIL:"OPEN_INDEXED_DB_FAIL",UPDATE_INDEXED_DB:"UPDATE_INDEXED_DB",STORE_UNVALIABLE_WHEN_SET:"STORE_UNVALIABLE_WHEN_SET",INDEXDB_SET_VALUE:"INDEXDB_SET_VALUE",INDEXDB_SET_VALUE_ONERROR:"INDEXDB_SET_VALUE_ONERROR",CHANGE_DATAKEY:"CHANGE_DATAKEY",STORE_UNVALIABLE_WHEN_UPDATE:"STORE_UNVALIABLE_WHEN_UPDATE",OFFLINE_DATABASE_ERROR:"OFFLINE_DATABASE_ERROR",INDEXEDDB_UPDATE_VALUE:"INDEXEDDB_UPDATE_VALUE",INDEXEDDB_UPDATE_VALUE_2:"INDEXEDDB_UPDATE_VALUE_2",INDEXEDDB_UPDATE_VALUE_3:"INDEXEDDB_UPDATE_VALUE_3",INDEXEDDB_UPDATE_VALUE_4:"INDEXEDDB_UPDATE_VALUE_4",DELETE_DATA_ERROR:"DELETE_DATA_ERROR",DELETE_VALUE:"DELETE_VALUE",DELETE_VALUE_2:"DELETE_VALUE_2",CLEAR_DATA_ERROR:"CLEAR_DATA_ERROR",CLEAR_DATA:"CLEAR_DATA",CLEAR_DATA_2:"CLEAR_DATA_2",GET_DATA_ERROR:"GET_DATA_ERROR",GET_DATA:"GET_DATA",GET_DATA_ERROR_2:"GET_DATA_ERROR_2",GET_DATA_SUCC:"GET_DATA_SUCC",NETWORK_ERROR:"NETWORK_ERROR",WEBSOCKET_CLOSE:"WEBSOCKET_CLOSE",LONG_TIME_HIDDEN_1:"LONG_TIME_HIDDEN_1",LONG_TIME_HIDDEN_2:"LONG_TIME_HIDDEN_2",ACCEPT_MESSAGE:"ACCEPT_MESSAGE",ROOM_STATE_CHANGE:"ROOM_STATE_CHANGE",HANDLE_SHUTDOWN:"HANDLE_SHUTDOWN",SWITCH_SHEET_IN_PREVIEW:"SWITCH_SHEET_IN_PREVIEW",PREVIEW_SERVER_SHEET_DATA:"PREVIEW_SERVER_SHEET_DATA",PREVIEW_SERVER_SHEET_DATA_ON_RESPONSE:"PREVIEW_SERVER_SHEET_DATA_ON_RESPONSE",SWITCH_SHEET_ON_SUCCESS:"SWITCH_SHEET_ON_SUCCESS",SWITCH_SHEET_ON_FAIL:"SWITCH_SHEET_ON_FAIL",DUPLICATE_SHEET_ID_2:"DUPLICATE_SHEET_ID_2",DUPLICATE_SHEET_ID_3:"DUPLICATE_SHEET_ID_3",FETCH_DATA_ERROR:"FETCH_DATA_ERROR",FETCH_DATA_ERROR_2:"FETCH_DATA_ERROR_2",K2S_CONVERTER:"K2S_CONVERTER",RELOAD_TIP:"RELOAD_TIP",RELOAD_TIP_DEBUG:"RELOAD_TIP_DEBUG",INIT_OFFLINE_STORE_ERROR:"INIT_OFFLINE_STORE_ERROR",GET_OFFLINE_DATA:"GET_OFFLINE_DATA",CHANGEDATAKEY_CATCH_ERROR:"CHANGEDATAKEY_CATCH_ERROR",SETDATA_CATCH_ERROR:"SETDATA_CATCH_ERROR",UPDATEDATA_CATCH_ERROR:"UPDATEDATA_CATCH_ERROR",DELETEDATA_CATCH_ERROR:"DELETEDATA_CATCH_ERROR",CLEARDATA_CATCH_ERROR:"CLEARDATA_CATCH_ERROR",GETDATA_CATCH_ERROR:"GETDATA_CATCH_ERROR",SWITCH_SHEET_NO_NETWORK:"SWITCH_SHEET_NO_NETWORK",SWITCH_SHEET_SERVER_FAIL:"SWITCH_SHEET_SERVER_FAIL",SWITCH_SHEET_FRONT_FAIL:"SWITCH_SHEET_FRONT_FAIL",PARSE_KEYFRAME_ERROR:"PARSE_KEYFRAME_ERROR",UNZIP_KEYFRAME_ERROR:"UNZIP_KEYFRAME_ERROR",PARSE_KEYFRAME_ERROR_2:"PARSE_KEYFRAME_ERROR_2",UNZIP_KEYFRAME:"UNZIP_KEYFRAME",MESSAGECENTER_DATA_ERROR_TIP:"MESSAGECENTER_DATA_ERROR_TIP",NET_OFFLINE_ERROR_TIP:"NET_OFFLINE_ERROR_TIP",MESSAGECENTER_DATA_ERROR_TIP_IMPORTANT:"MESSAGECENTER_DATA_ERROR_TIP_IMPORTANT",APPLY_BEHAVIOR_UNDO:"APPLY_BEHAVIOR_UNDO",APPLY_BEHAVIOR_REDO:"APPLY_BEHAVIOR_REDO",APPLY_BEHAVIOR_LOCAL:"APPLY_BEHAVIOR_LOCAL",CREATE_WORKER_ERROR:"CREATE_WORKER_ERROR",UPDATE_SMART_SELECTION_ERROR:"UPDATE_SMART_SELECTION_ERROR",INVER_MUTATION_ERROR:"INVER_MUTATION_ERROR",FILL_DRAG:"FILL_DRAG",FILL_SERIES:"FILL_SERIES",FILL_COPY:"FILL_COPY",FILL_OPTION:"FILL_OPTION",FILL_OPTION_COPY:"FILL_OPTION_COPY",FILL_OPTION_SERIES:"FILL_OPTION_SERIES",FILL_FORMAT:"FILL_FORMAT",FILL_WITHOUT_FORMAT:"FILL_WITHOUT_FORMAT",MOBILE_FILL_SERIES:"MOBILE_FILL_SERIES",MOBILE_FILL_COP:"MOBILE_FILL_COP",CLK_FILL_SUCCESS:"CLK_FILL_SUCCESS",LOAD_DATA_SUCC:"LOAD_DATA_SUCC",SWITCH_SHEET_SUCC:"SWITCH_SHEET_SUCC",REPORT_FILES_TIMES:"REPORT_FILES_TIMES",REPORT_FOR_QUICK_LOOK:"REPORT_FOR_QUICK_LOOK",SHEET_STATUS_REPORT:"SHEET_STATUS_REPORT",SWITCH_SHEET_SPEED:"SWITCH_SHEET_SPEED",RENDER_TRANSFORM_SPEED:"RENDER_TRANSFORM_SPEED",RENDER_CANVAS_SPEED:"RENDER_CANVAS_SPEED",TIME_PASTE_FROM_OUTER_SPEED:"TIME_PASTE_FROM_OUTER_SPEED",TIME_COPY_SPEED:"TIME_COPY_SPEED",HANDDATA_SETSHEETDATA:"HANDDATA_SETSHEETDATA",REPORT_FOR_QL_PV:"REPORT_FOR_QL_PV",REPORT_FOR_PV:"REPORT_FOR_PV",RESET_DEFAULT_TDW_DATA:"RESET_DEFAULT_TDW_DATA",REPORT_FOR_SSR:"REPORT_FOR_SSR",REPORT_FOR_JSONP:"REPORT_FOR_JSONP",PARSE_PUSH_MESSAGE_ERROR:"PARSE_PUSH_MESSAGE_ERROR",MERGE_GRID_RANGE_ERROR:"MERGE_GRID_RANGE_ERROR",MUTATION_QUEUE_MAX_SIZE:"MUTATION_QUEUE_MAX_SIZE",MUTATION_QUEUE_COMPLETE_TIMEOUT:"MUTATION_QUEUE_COMPLETE_TIMEOUT",LOADER:"LOADER",PAUSE_LOADER:"PAUSE_LOADER",WORK_LOADER:"WORK_LOADER",SERVER_LOADER_FETCH_OPEN_DOC:"SERVER_LOADER_FETCH_OPEN_DOC",SERVER_LOADER_OPEN_DOC_RESPONSE:"SERVER_LOADER_OPEN_DOC_RESPONSE",SERVER_LOADER_HANDLE_OPEN_DOC_RESPONSE:"SERVER_LOADER_HANDLE_OPEN_DOC_RESPONSE",SERVER_LOADER_OPEN_DOC_ORIGIN_TYPE:"SERVER_LOADER_OPEN_DOC_ORIGIN_TYPE",LOAD_ERROR:"LOAD_ERROR",VIEW_ERROR_INPUT:"VIEW_ERROR_INPUT",VIEW_GET_DIMENSION_OVERFLOW:"VIEW_GET_DIMENSION_OVERFLOW",LOAD_OFFLINE_VERSION_DATA_NULL:"LOAD_OFFLINE_VERSION_DATA_NULL",LOAD_OFFLINE_VERSION_DATA_INVALID:"LOAD_OFFLINE_VERSION_DATA_INVALID",MUTATION_JANK_NUMBER_FORMAT:"applyMutation_local_25",SHEETS_BAR_JANK_SWITCH_SHEET:"SHEETS_BAR_JANK_SWITCH_SHEET"};!function(e){e.CHECK_MUTATION_ERROR="CheckMutationError",e.RUN_MUTATION_ERROR="RunMutationError",e.DESERIALIZE_MUTATION_ERROR="DeserializeMutationError",e.DESERIALIZE_MUTATION_ERROR_OLD="DeserializeMutationErrorOld"}(h||(h={})),function(e){e.NAVIGATION_TO_FETCH="navigation_to_fetch",e.DNS="dns",e.CONNECT="connect",e.HTML_TTFB="html_ttfb",e.HTML_LOAD="html_load",e.WHITESCREEN="whitescreen",e.SYNC_JS_RUN="sync_js_run",e.DOM_CONTENT_LOAD="dom_content_load",e.KEYFRAME_TRANSFORM="keyframe_transform",e.KEYFRAME_V0_DESERIALIZATION="keyframe_v0_deserialization",e.AFTER_KEYFRAME_RUN="after_keyframe_run",e.MUTATIONS_DESERIALIZATION="mutations_deserialization",e.MUTATIONS_RUN="mutations_run",e.AFTER_MUTATIONS_RUN="after_mutations_run",e.FIRST_SCREEN="first_screen",e.FIRST_SCREEN_NO_SSR="first_screen_no_ssr",e.FIRST_SCREEN_SSR="first_screen_ssr",e.INTERACTABLE="interactable",e.AFTER_ALL_RENDER="after_all_render",e.LOAD_CGI_DATA_TIME="load_cgi_data_total_cost",e.LOAD_CGI_DATA_SERVER_COST_TIME="load_cgi_data_server_cost",e.SWITCH_SHEET_TIME="switch_sheet_time",e.EXPORT_FILE_FRONT_DOWNLOAD_TIME="export_file_front_download_time",e.COPY_PASTE_COPY_TIME="copy_paste_copy_time",e.COPY_PASTE_OUTER_PASTE="copy_paste_outer_paste",e.COPY_PASTE_INNER_PASTE="copy_paste_inner_paste"}(m||(m={}));var v=(a={},Object(l.a)(a,m.NAVIGATION_TO_FETCH,"[\u6253\u5f00]navigation\u5230fetch\u8017\u65f6"),Object(l.a)(a,m.DNS,"[\u6253\u5f00]DNS\u67e5\u8be2"),Object(l.a)(a,m.CONNECT,"[\u6253\u5f00]\u5efa\u7acb\u8fde\u63a5"),Object(l.a)(a,m.HTML_TTFB,"[\u6253\u5f00]html\u7684ttfb\u8017\u65f6"),Object(l.a)(a,m.HTML_LOAD,"[\u6253\u5f00]html\u52a0\u8f7d\u8017\u65f6"),Object(l.a)(a,m.WHITESCREEN,"[\u6253\u5f00]\u767d\u5c4f\u65f6\u95f4"),Object(l.a)(a,m.SYNC_JS_RUN,"[\u6253\u5f00]\u540c\u6b65js\u6267\u884c\u8017\u65f6"),Object(l.a)(a,m.DOM_CONTENT_LOAD,"[\u6253\u5f00]DomContentLoad\u8017\u65f6"),Object(l.a)(a,m.KEYFRAME_TRANSFORM,"[\u6253\u5f00]keyframe\u89e3\u6790\u8017\u65f6"),Object(l.a)(a,m.KEYFRAME_V0_DESERIALIZATION,"[\u6253\u5f00]\u5bfc\u5165\u7684keyframeV0\u53cd\u5e8f\u5217\u5316\u8017\u65f6"),Object(l.a)(a,m.AFTER_KEYFRAME_RUN,"[\u6253\u5f00]afterKeyframeRun\u8017\u65f6"),Object(l.a)(a,m.MUTATIONS_DESERIALIZATION,"[\u6253\u5f00]mutations\u53cd\u5e8f\u5217\u5316\u8017\u65f6"),Object(l.a)(a,m.MUTATIONS_RUN,"[\u6253\u5f00]mutations\u6267\u884c\u8017\u65f6"),Object(l.a)(a,m.AFTER_MUTATIONS_RUN,"[\u6253\u5f00]afterMutationsRun\u8017\u65f6"),Object(l.a)(a,m.FIRST_SCREEN,"[\u6253\u5f00]\u9996\u5c4f"),Object(l.a)(a,m.FIRST_SCREEN_NO_SSR,"[\u6253\u5f00]\u9996\u5c4f\u65e0SSR"),Object(l.a)(a,m.FIRST_SCREEN_SSR,"[\u6253\u5f00]\u9996\u5c4f\u6709SSR"),Object(l.a)(a,m.INTERACTABLE,"[\u6253\u5f00]\u53ef\u4ea4\u4e92"),Object(l.a)(a,m.AFTER_ALL_RENDER,"[\u6253\u5f00]\u6574\u4f53\u6e32\u67d3\u7ed3\u675f"),Object(l.a)(a,m.LOAD_CGI_DATA_TIME,"[\u6253\u5f00]opendoc\u6574\u4f53\u8017\u65f6"),Object(l.a)(a,m.LOAD_CGI_DATA_SERVER_COST_TIME,"[\u6253\u5f00]opendoc\u540e\u53f0\u8017\u65f6"),Object(l.a)(a,m.SWITCH_SHEET_TIME,"[\u7f16\u8f91]\u5207\u8868\u8017\u65f6"),Object(l.a)(a,m.EXPORT_FILE_FRONT_DOWNLOAD_TIME,"[\u5bfc\u51fa]\u524d\u7aef\u4e0b\u8f7d\u8017\u65f6"),Object(l.a)(a,m.COPY_PASTE_COPY_TIME,"[\u7f16\u8f91]\u590d\u5236\u8017\u65f6"),Object(l.a)(a,m.COPY_PASTE_OUTER_PASTE,"[\u7f16\u8f91]\u5916\u90e8\u7c98\u8d34\u8017\u65f6"),Object(l.a)(a,m.COPY_PASTE_INNER_PASTE,"[\u7f16\u8f91]\u5185\u90e8\u7c98\u8d34\u8017\u65f6"),a)},"./src/base/config/version.ts":function(e,t,r){"use strict";t.a={KEYFRAME_VER:5,KEYFRAME_VER_LOWEST_SUPPORT:3,CODE_VER:1,CLIENT_VER:1}},"./src/base/error/errCodeType.ts":function(e,t,r){"use strict";var n;r.d(t,"a",(function(){return n})),function(e){e.APPLY_NEW_CHANGE_ERROR="D0001",e.REQUEST_SIZE_LIMIT="D0002",e.DATA_VERSION_TOO_LOW="D0003",e.TASK_DUPLICATE_VERSION_TOO_LOW="D0004",e.KEYFRAME_UNZIP_ERROR="K0001",e.SHEET_ID_ERROR_1="S0001",e.SHEET_ID_ERROR_2="S0002",e.SHEET_ID_ERROR_3="S0003",e.SHEET_ID_INIT_OLD_DUPLICATE="S0004",e.SHEET_ID_SHEET_BAR_OLD_DUPLICATE="S0005",e.SHEET_ID_SHEET_BAR_NEW_DUPLICATE="S0006",e.SHEET_FETCH_ERROR="S0007",e.SHEET_FETCH_FRONT_ERROR="S0008",e.NOT_VIP_FULL="70001",e.KICK="N0001",e.RELOAD="N0002",e.SOCKET_NOT_SET_UP="N0003",e.OFFLINE_INDEXDB_NOT_AVAILABLE="N0004",e.COMMIT_ERROR_CODE_UNDEFINED="N0005",e.COMMITING_QUEUE_BLOCK="N0006",e.FRONTEND_SOCKET_ERROR_CODE_UNDEFINED="N0007",e.PERMISSION_CHANGE="N0008",e.FULL_MEMBER="N0009",e.LONG_TIME_HIDDEN="N0010",e.OFFLINE_SYNC_ERROR="N0011",e.FETCH_USER_CHANGE_RESPONSE_NOT_CONTINUE="F0001",e.FETCH_USER_CHANGE_TO_LESS_THAN_FROM="F0002",e.FETCH_USER_CHANGE_CGI_HTTP_ERROR="F0003",e.FETCH_USER_CHANGE_RESPONSE_DATA_EMPTY="F0004",e.FETCH_USER_CHANGE_RESPONSE_ARRAY_EMPTY="F0005",e.FETCH_USER_CHANGE_RESPONSE_ERROR_CODE="F0006",e.TASK_RUN_ERROR="T0001",e.DATABASE_ERROR="Z0001"}(n||(n={}))},"./src/base/error/errorCodeModalProxy.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=function(){function e(t){Object(n.a)(this,e),this.cache=[],this.funcName=t,this.module=null,this.init()}return Object(o.a)(e,[{key:"init",value:function(){e.stack.push(this)}},{key:"getExecuteObj",value:function(e,t){var r=t.shift();return r?0===t.length?{self:e,func:e[r]}:this.getExecuteObj(e[r],t):e}},{key:"execute",value:function(){for(var e=this.funcName.split("."),t=this.getExecuteObj(this.module,e),r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return t.func.apply(t.self,n)}},{key:"initLoad",value:function(e){this.module=e,this.cache.length&&this.cache.forEach((function(e){e()}))}},{key:"getProxy",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function(){for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return e.module?e.execute.apply(e,n):t?null:void e.cache.push((function(){return e.execute.apply(e,n)}))}}}],[{key:"eachLoad",value:function(t){e.stack.forEach((function(e){e.initLoad(t)}))}}]),e}();a.stack=[];var s={client:{showNetworkOfflineTip:new a("client.showNetworkOfflineTip").getProxy(),showSaveFrontEndErrorTip:new a("client.showSaveFrontEndErrorTip").getProxy(),showLoginExpiredTip:new a("client.showLoginExpiredTip").getProxy(),showUnAuthTip:new a("client.showUnAuthTip").getProxy(),showBigDataFromFrontTip:new a("client.showBigDataFromFrontTip").getProxy(),showSecurityTip:new a("client.showSecurityTip").getProxy(),showSheetBarDuplicateSheetId:new a("client.showSheetBarDuplicateSheetId").getProxy(),showPermissionChangesTip:new a("client.showPermissionChangesTip").getProxy(),showUserChangeSaveSuccessTip:new a("client.showUserChangeSaveSuccessTip").getProxy(),showUserChangeSaveFailTip:new a("client.showUserChangeSaveFailTip").getProxy(),showNetOfflineErrorTip:new a("client.showNetOfflineErrorTip").getProxy(),showOfflineSyncError:new a("client.showOfflineSyncError").getProxy(),showOfflineEditingTip:new a("client.showOfflineEditingTip").getProxy(),showSavedText:new a("client.showSavedText").getProxy(),showServerConnectFailTip:new a("client.showServerConnectFailTip").getProxy(),showCommonErrorModal1:new a("client.showCommonErrorModal1").getProxy(),showCommonCrashAndFeedBackModal:new a("client.showCommonCrashAndFeedBackModal").getProxy(),showDatabaseErrorModal:new a("client.showDatabaseErrorModal").getProxy(),showFileNotExsitErrorTip:new a("client.showFileNotExsitErrorTip").getProxy()},server:{showServerErrorTip:new a("server.showServerErrorTip").getProxy(),showServerConnectTimeout:new a("server.showServerConnectTimeout").getProxy(),showServerTaskTimeout:new a("server.showServerTaskTimeout").getProxy(),showFullMemberTip:new a("server.showFullMemberTip").getProxy(),showBigDataFromServerTip:new a("server.showBigDataFromServerTip").getProxy(),showFrequentEditTip:new a("server.showFrequentEditTip").getProxy(),showSaveBackEndErrorTip:new a("server.showSaveBackEndErrorTip").getProxy(),showUpgradeTip:new a("server.showUpgradeTip").getProxy(),showBlacklistBlock:new a("server.showBlacklistBlock").getProxy(),showUpdatePadTip:new a("server.showUpdatePadTip").getProxy(),showApplyNewChangeErrorTip:new a("server.showApplyNewChangeErrorTip").getProxy(),switchSheetError:new a("server.switchSheetError").getProxy(),checkVipToast:new a("server.checkVipToast").getProxy(),showFullMemberTipWithRefresh:new a("server.showFullMemberTipWithRefresh").getProxy(),showRefreshTips:new a("server.showRefreshTips").getProxy(),showFileDeletedTip:new a("server.showFileDeletedTip").getProxy()},portraitToast:new a("portraitToast").getProxy(),changePermission:new a("changePermission").getProxy(),showFormulaLayerCalcErrorTips:new a("showFormulaLayerCalcErrorTips").getProxy()};t.b=s},"./src/base/event/domEventModule.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.splice.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("./src/base/util/type.ts"),s=function(){function e(t){Object(n.a)(this,e),this.parent=t,this.cache={}}return Object(o.a)(e,[{key:"listen",value:function(e,t){if(this.parent&&this.parent.addEventListener)switch(e){case"resize":return this.bind(e,t,200);case"mousemoveLazy":return this.bind("mousemove",t,200);case"mousedown":case"mousemove":case"mouseup":case"keyup":case"keydown":case"click":case"touchstart":case"touchmove":case"touchend":case"popState":return this.bind(e,t);case"visibilitychange":case"mozvisibilitychange":case"msvisibilitychange":case"webkitvisibilitychange":return this.bind("visibilitychange",t);default:throw new Error("".concat(e," is not found in DomEventModule"))}}},{key:"remove",value:function(e,t){if(this.parent&&this.parent.addEventListener&&this.cache[e]){var r=this.cache[e];if(t)for(var n=r.length;n>=0;n--)r[n]===t&&r.splice(n,1);else r=[];0===r.length&&(this.parent.removeEventListener(e,r.eventCallback),delete this.cache[e])}}},{key:"trigger",value:function(e,t){this.cache[e]&&this.cache[e].eventCallback(t)}},{key:"one",value:function(e,t){this.listen(e,t),this.remove(e,t)}},{key:"bind",value:function(e,t,r){var n=this;this.cache[e]||(this.cache[e]=[]);var o=this.cache[e];if(r&&(t=Object(a.throttle)(t,r)),o.push(t),1===o.length){var s=function(e){o.forEach((function(t){t(e)}))};this.parent.addEventListener(e,s,!1),o.eventCallback=s}return{remove:function(){return n.remove(e,t)}}}},{key:"removeAll",value:function(){var e=this;Object.keys(this.cache).forEach((function(t){e.parent.removeEventListener(t,e.cache[t].eventCallback,!1),delete e.cache[t]}))}},{key:"destroy",value:function(){var e=this;Object.keys(this.cache).forEach((function(t){e.parent.removeEventListener(t,e.cache[t].eventCallback,!1),delete e.cache[t]}))}}]),e}();t.a=s},"./src/base/event/event.ts":function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return f}));r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=r("./src/base/event/eventModule.ts"),s=r("./src/base/event/domEventModule.ts"),i=r("../packages/services/src/instantiation.ts");function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){Object(o.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c=l(l({},function(){var e=a.a.create("sheetsBar"),t=a.a.create("default"),r=a.a.create("toolBar"),n=a.a.create("spreadsheetApp"),o=a.a.create("search"),i=a.a.create("sheetStatus"),u=a.a.create("network"),l=a.a.create("history"),c=a.a.create("init"),d=a.a.create("view"),f=a.a.create("reportEvent"),h=a.a.create("notificationCenter"),m=a.a.create("keyboard"),p=a.a.create("login"),v=a.a.create("formula"),g=a.a.create("errorCode"),y=a.a.create("mentionEvent"),_=a.a.create("pageLoad"),b=a.a.create("rangeAuthEvent"),A=a.a.create("linkCenter"),E=a.a.create("drag");return{sheetsBar:e,default:t,toolBar:r,spreadsheetEvent:n,search:o,sheetStatus:i,network:u,history:l,windowEvent:new s.a("undefined"===typeof window?{}:window),bodyEvent:new s.a("undefined"===typeof window||"undefined"===typeof window.document?{}:window.document.body),init:c,view:d,reportEvent:f,notificationCenter:h,keyboard:m,loginEvent:p,formula:v,errorCode:g,mentionEvent:y,pageLoad:_,rangeAuthEvent:b,linkCenter:A,dragCenterEvent:E}}()),{},{destroy:function(){var t;null===(t=e.log)||void 0===t||t.debug("flow IEvent destroy()"),Object.keys(c).forEach((function(e){var t,r;null===(t=(r=c[e]).destroy)||void 0===t||t.call(r)}))}});t.c=c;var d=function e(){return Object(n.a)(this,e),c},f=Object(i.c)("IEvent")}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/base/event/eventModule.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.splice.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=function(){var e=Array.prototype.shift,t=Array.prototype.unshift,r={},n=function(e,t){for(var r,n=e.length-1;n>=0;n--){var o=e[n];o&&(r=t.call(o,n,o))}return r},o=function(e,t,r){if(t[e]&&r)for(var n=t[e].length-1;n>=0;n--)if("function"===typeof t[e][n]&&t[e][n].once){t[e].splice(n,1);break}},a=function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];var s=e.call(r),i=e.call(r),u=this,l=s[i];if(l&&l.length)return n(l,(function(){var e=this.apply(u,r);return this.once&&o(i,s,this),e}))};return{create:function(e){var o={},s=[],i={listen:function(e,t,r){!function(e,t,r){r[e]||(r[e]=[]),r[e].unshift(t)}(e,t,o);var a=s[e];void 0!==a?"listened"!==a&&Array.isArray(a)&&("last"===r?a.length&&a.pop()():"ignoreOffline"===r||n(a,(function(){this()})),s[e]="listened"):s[e]="listened"},one:function(e,t,r){this.listen(e,t,r),t.once=!0},remove:function(e,t){!function(e,t,r){if(t[e])if(r)for(var n=t[e].length;n>=0;n--)t[e][n]===r&&t[e].splice(n,1);else t[e]=[]}(e,o,t)},removeAll:function(){Object.keys(o).forEach((function(e){delete o[e]}))},trigger:function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];var i=this;t.call(r,o);var u=function(){return a.apply(i,r)},l=r[1];return"listened"===s[l]?u():(s[l]||(s[l]=[]),Array.isArray(s[l])?s[l].unshift(u):void 0)},destroy:function(){this.removeAll()}};return(e=e||"default")?r[e]?r[e]:r[e]=i:i}}}(),o=function(){var e=function(e){return n.create(e)};return{create:e,init:function(){return e("default")}}}();t.a=o},"./src/base/event/eventName.ts":function(e,t,r){"use strict";var n;r.d(t,"a",(function(){return n})),function(e){e.PART_INTERACTABLE="part_interactable",e.AFTER_FIRST_RENDER="after_first_render",e.AFTER_ALL_RENDER="after_all_render",e.INTERACTABLE="interactable",e.SELECTION_CHANGE="selection_change",e.ACTIVATION_CHANGE="activation_change",e.SELECTION_ENTER_VIEW="selection_enter_view",e.SELECTION_LEAVE_VIEW="selection_view_view",e.SELECT_PIC="select_pic",e.DATA_CHANGE="dataChange",e.INPUT_END="input_end",e.INPUT_CHANGE="input_change",e.ENTER_INPUT_STATUS="enter_input_status",e.ENTER_ACTIVE_STATUS="enter_active_status",e.ENTER_NORMAL_STATUS="enter_normal_status",e.ENTER_SCAN_STATUS="enter_scan_status",e.UI_SHOW="ui_show",e.UI_HIDE="ui_hide",e.TITLE_AUTO_CHANGE="title_auto_change",e.DATABASE_ERROR="dababase_error",e.LOAD_FIRST_DATA_START="load_first_data_start",e.LOAD_FIRST_DATA_END="load_first_data_end",e.SCREEN_ROTATE="screen_rotate",e.CORE_SHEET_LAZY_LOADED="core_sheet_lazy_loaded"}(n||(n={}))},"./src/base/helper/font-polyfill.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r("./src/base/config/font.ts");function o(e){var t=n.a[e]?n.a[e]:e;return t&&n.b.has(t)?t:"Arial"}},"./src/base/index.ts":function(e,t,r){"use strict";var n={};r.r(n),r.d(n,"hasEmojiCharacter",(function(){return f})),r.d(n,"getStrBytes",(function(){return h})),r.d(n,"getSubstr36Bytes",(function(){return m}));var o=r("./src/base/event/eventName.ts"),a=r("./src/base/event/event.ts"),s=r("./src/base/util/object.ts"),i=r("./src/base/util/safe.js"),u=(r("../node_modules/core-js/modules/es.array.some.js"),r("../node_modules/@babel/runtime/helpers/esm/typeof.js")),l=[[118784,128895],[129311,129311],[129320,129327],[129329,129330],[129356,129356],[129375,129375],[129376,129387],[129426,129431],[129504,129510],[129488,129491]],c=[[8448,10239],[11013,11015],[10548,10549],[12951,12953],[169,169],[174,174],[12349,12349],[12336,12336],[11093,11093],[11036,11036],[11035,11035],[11088,11088]],d=[9786,10084,9757,9996,9994,9995];function f(e){for(var t=function(t){var r=e.charCodeAt(t);if(55296<=r&&r<=56319){if(e.length>1){var n=e.charCodeAt(t+1),o=1024*(r-55296)+(n-56320)+65536;if(l.some((function(e){return e[0]<=o&&o<=e[1]})))return{v:!0}}}else if(e.length>1){if(8419===e.charCodeAt(t+1))return{v:!0}}else{if(c.some((function(e){return e[0]<=r&&r<=e[1]})))return{v:!0}}if(d.some((function(e){return e===r}))&&(e.length>t&&65039===e.charCodeAt(t+1)))return{v:!0}},r=0;r<e.length;r++){var n=t(r);if("object"===Object(u.a)(n))return n.v}return!1}function h(e){var t,r,n=0,o=0;for(o=0,r=e.length;o<r;o++)(t=e.charCodeAt(o))<=127?n+=1:t<=2047?n+=2:t<=65535&&(n+=3);return n}function m(e){var t,r,n=0,o=0;for(o=0,r=e.length;o<r&&((t=e.charCodeAt(o))<=127?n+=1:t<=2047?n+=2:t<=65535&&(n+=3),!(n>36));o++);return e.substring(0,o)}var p,v,g,y,_=r("./src/base/util/timer.ts"),b=r("./src/base/util/type.ts"),A=r("./src/base/config/report.ts"),E=r("./src/base/report/flowlog.js"),j={QUICKLOOK_STEP:6e5,QUICKLOOK_STEP_PC:6e5,QUICKLOOK_STEP_PAD:6e5,QUICKLOOK_STEP_MOBILE:6e5,QUICKLOOK_MAX_COSTTIME:2e3,QUICKLOOK_INIT_TIME:3e4},R=r("./src/base/error/errCodeType.ts");(y=p||(p={})).EVENT_NAME=o.a,y.event=a.c,y.errCodeType=R.a,y.flowlog=E.a,(g=y.util||(y.util={})).object=s,g.safe=i,g.string=n,g.timer=_.a,g.type=b,(v=y.config||(y.config={})).report=A,v.viewConfig=j;t.a=p},"./src/base/report/flowlog.js":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.for-each.js");var n=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r]},o={isFake:!0,listeners:[],var:{},namespace:"",version:0,_pid:0,_sessionId:"",_startTime:"",_uid:"",log:function(e){n(e)},info:function(e){n(e)},error:function(e,t){n(e,t)}};["invokeWk","config","deleteDatabase","dispatch","getDBLog","getDBLogByTime","getUUID","getWorkerVar","hideConsole","listen","loadAsset","loadAssetLoader","query","raven","record","report","reportLog","showConsole","ws","debug","error","info","log","warn"].forEach((function(e){o[e]=function(){}}));try{o=WebLog?new WebLog("flow"):o}catch(a){}t.a=o},"./src/base/report/fps.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.reduce.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../packages/report/src/index.ts"),s=r("../node_modules/@tencent/tdocs_fps/lib/index.js"),i={"0-10":0,"11-20":0,"21-30":0,"31-40":0,"41-50":0,"51-55":0,56:0,57:0,58:0,59:0,60:0,"\u5927\u4e8e60":0},u=function(){function e(){var t=this;Object(n.a)(this,e),this._fps=new s.a,this._cacheAction="",this._handle=function(e){if(""!==t._cacheAction&&Math.random()<.05){var r=function(e){return e.reduce((function(e,t){return e+t}),0)/e.length}(e);!function(e){i["0-10"]=0,i["11-20"]=0,i["21-30"]=0,i["31-40"]=0,i["41-50"]=0,i[56]=0,i[57]=0,i[58]=0,i[59]=0,i[60]=0,i["\u5927\u4e8e60"]=0,e.forEach((function(e){var t=Math.round(1e3/e);switch(!0){case t<=10:i["0-10"]+=1;break;case t<=20:i["11-20"]+=1;break;case t<=30:i["21-30"]+=1;break;case t<=40:i["31-40"]+=1;break;case t<=50:i["41-50"]+=1;break;case 56===t:i[56]+=1;break;case 57===t:i[57]+=1;break;case 58===t:i[58]+=1;break;case 59===t:i[59]+=1;break;case 60===t:i[60]+=1;break;default:i["\u5927\u4e8e60"]+=1}}))}(e),a.b.tdwReport({opername:"quality_doc",module:"detail",action:t._cacheAction,ver7:r,ver8:JSON.stringify(i)})}t._cacheAction=""},this._fps.addListener(this._handle)}return Object(o.a)(e,[{key:"start",value:function(e){this._cacheAction=e,this._fps.start()}},{key:"end",value:function(e){this._cacheAction!==e&&(this._cacheAction=""),this._fps.end()}}]),e}();t.a=new u},"./src/base/util/browser.ts":function(e,t,r){"use strict";r.d(t,"f",(function(){return a})),r.d(t,"d",(function(){return s})),r.d(t,"b",(function(){return i})),r.d(t,"e",(function(){return u})),r.d(t,"c",(function(){return l})),r.d(t,"a",(function(){return c}));r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.match.js");var n=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),o=r.n(n);r("./src/base/util/timer.ts");function a(){var e=document.createEvent("Event");e.initEvent("resize",!0,!0),window.dispatchEvent(e)}function s(){if("number"===typeof window.orientation)return window.orientation/90%2==0;try{var e=window.screen.orientation.angle;if("number"===typeof e)return e/90%2==0}catch(t){}return!0}function i(){try{var e;null===(e=window.mqq)||void 0===e||e.ui.setWebViewBehavior({orientation:0})}catch(t){}}function u(){return(o.a.isTencentDocsApp?document.body.offsetWidth:Math.min(window.innerWidth,document.body.offsetWidth))>=640}function l(){var e=s()?window.screen.width:window.screen.height,t=window.innerWidth/e;return t<.4?.33:t>=.4&&t<.6?.5:t>=.6&&t<.9?.66:1}function c(){if(o.a.isIE){var e=window.screen;return e.deviceXDPI&&e.logicalXDPI?e.deviceXDPI/e.logicalXDPI*100:100}if(o.a.isFirefox)return 100;if(o.a.isChrome){var t=window.outerWidth/window.innerWidth;return o.a.isWindows&&Math.round(100*t)>95&&Math.round(100*t)<105&&(t=1),Math.round(100*t)}if(o.a.isSafari)return Math.round(window.outerWidth/window.innerWidth*100);var r=1;if(void 0!==window.devicePixelRatio&&(r=window.devicePixelRatio),void 0!==window.outerWidth&&void 0!==window.innerWidth){var n=window.outerWidth/window.innerWidth;100!==Math.round(100*n)&&0!==window.outerWidth||(r=1)}return Math.round(100*r)}},"./src/base/util/html.ts":function(e,t,r){"use strict";r.d(t,"c",(function(){return n})),r.d(t,"b",(function(){return o})),r.d(t,"e",(function(){return a})),r.d(t,"a",(function(){return s})),r.d(t,"d",(function(){return i})),r.d(t,"f",(function(){return l}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),r("./src/base/util/type.ts");function n(e){var t=/[&<>'"]/g;return t.MAP||(t.MAP={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"}),e.replace(t,(function(e){return t.MAP[e]}))}function o(e,t,r,n){return e.addEventListener?e.addEventListener(t,r,n):e.attachEvent&&e.attachEvent("on".concat(t),(function(){r(window.event)})),e}function a(e,t,r,n){e.removeEventListener?e.removeEventListener(t,r,n):e.detachEvent&&e.detachEvent("on".concat(t),(function(){r(window.event)}))}function s(e,t){e&&e.classList.add(t)}function i(e,t){e&&e.classList.remove(t)}var u={CSS:{Sequence:function(){var e=/\\((([\dA-F]{2}|[\dA-F]{1,5})\s)|([\dA-F]{6}|[\dA-F]{4}))/gim;return e.unescape=function(e){var t=window,r=t.String.fromCharCode,n=t.parseInt;return e.replace(this,(function(e){return r(n(e.slice(2),16))}))},e}()}},l=function(e){return function(e){return e.replace(/(\\.)/g,(function(e){return e.slice(1)})).replace(/(\\[$\-+/():!^&'~{}<>= ])/g,(function(e){return e.slice(1)}))}(u.CSS.Sequence.unescape(e))}},"./src/base/util/mobile.ts":function(e,t,r){"use strict";r.d(t,"b",(function(){return f})),r.d(t,"a",(function(){return d}));var n=window.devicePixelRatio;function o(e,t){var r=window.screen.width,n=window.screen.height;return r===e&&n===t||r===t&&n===e}function a(){return 3===n&&o(375,812)}function s(){return 3===n&&o(414,896)}function i(){return 2===n&&o(414,896)}function u(){return 3===n&&(o(390,844)||o(375,812))}function l(){return 3===n&&(o(428,926)||o(414,896))}function c(){var e=window.navigator.userAgent;return/iphone/gi.test(e)&&(u()||l())}var d=function(){var e=window.navigator.userAgent;return!!/iphone x/gi.test(e)||!!/iphone/gi.test(e)&&(a()||s()||i())}(),f=c()},"./src/base/util/object.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"extend",(function(){return o})),r.d(t,"deepClone",(function(){return a})),r.d(t,"clone",(function(){return s})),r.d(t,"objectMap",(function(){return i})),r.d(t,"objectEach",(function(){return u})),r.d(t,"hasOwnProperty",(function(){return l})),r.d(t,"cloneForce",(function(){return c})),r.d(t,"applyMixins",(function(){return f}));r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.get-own-property-names.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/typeof.js");function o(e,t){if(!e&&!t)return{};if(!t)return e;if(!e)return t;for(var r=Object.keys(t),n=r.length;n;)e[r[n-=1]]=t[r[n]];return e}function a(e){return"object"===Object(n.a)(e)?JSON.parse(JSON.stringify(e)):e}function s(e){var t={};return u(e,(function(e,r){t[r]=e})),t}function i(e,t){return Object.keys(e).filter((function(t){return l(e,t)})).map((function(r){return t(e[r],r,e)}))}function u(e,t){i(e,t)}function l(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function c(e){for(var t=[],r={},o=[{parent:r,key:void 0,data:e}];o.length;){var a=o.pop();if(a){var s=a.parent,i=a.key,u=a.data,l=s;"undefined"!==typeof i&&(s[i]={},l=s[i]);var c=d(t,u);if(c){s[i]=c.target;continue}for(var f in t.push({source:u,target:l}),u)u.hasOwnProperty(f)&&("object"===Object(n.a)(u[f])?o.push({parent:l,key:f,data:u[f]}):l[f]=u[f])}}return r}function d(e,t){for(var r=0;r<e.length;r++)if(e[r].source===t)return e[r];return null}function f(e,t){return t.forEach((function(t){Object.getOwnPropertyNames(t.prototype).forEach((function(r){"constructor"!==r&&Object.defineProperty(e.prototype,r,Object.getOwnPropertyDescriptor(t.prototype,r))}))})),t}},"./src/base/util/safe.js":function(e,t,r){"use strict";r.r(t),r.d(t,"escapeHTML",(function(){return n}));r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.replace.js");function n(e){if("string"!==typeof e)return"";var t=/[&<>'"]/g;return t.MAP||(t.MAP={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"}),e.replace(t,(function(e){return t.MAP[e]}))}},"./src/base/util/timer.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.splice.js"),r("../node_modules/core-js/modules/es.number.constructor.js"),r("../node_modules/core-js/modules/es.number.is-integer.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=function(){function e(t,r){Object(o.a)(this,e),this.timer=t,this.done=!1,this.callback=function(){},this.frames=r/t.interval|0}return Object(a.a)(e,[{key:"setFrame",value:function(e){this.frames=e,0!==this.frames&&(this.frames=Number.isInteger(this.frames)?this.frames:1+(0|this.frames))}},{key:"run",value:function(e){return this.callback=e,this.setFrame(this.frames+this.timer.currFrame),this.timer.push(this),this}},{key:"stop",value:function(){this.timer.erase(this)}}]),e}(),i=function(){function e(){Object(o.a)(this,e),this.zeroFrameDone=!1,this.times=0,this.started=!1,this.interval=500,this.t=null,this.cache={},this.currFrame=0,this.maxFrame=0}return Object(a.a)(e,[{key:"pause",value:function(){clearInterval(this.t)}},{key:"restart",value:function(){this.started=!1,this.start()}},{key:"clear",value:function(){this.cache={},this.started=!1,this.currFrame=0,this.maxFrame=0,clearInterval(this.t),this.t=null}},{key:"execNextFrame",value:function(){if(this.currFrame>this.maxFrame)return this.clear();var e=this.cache[this.currFrame];if(e){e.forEach((function(e,t){if(e){e.done=!0;try{e.callback&&e.callback()}catch(r){console.error(r),window.log&&window.log.error(r.stack)}}e=null}));var t,r=e.filter((function(e){return!e.done}));if(r.length)this.cache[this.currFrame+1]||(this.cache[this.currFrame+1]=[]),(t=this.cache[this.currFrame+1]).push.apply(t,Object(n.a)(r)),this.maxFrame+=1;delete this.cache[this.currFrame]}}},{key:"push",value:function(e){this.cache[e.frames]||(this.cache[e.frames]=[]),this.cache[e.frames].push(e),this.maxFrame=Math.max(this.maxFrame,e.frames),this.start()}},{key:"erase",value:function(e){if(e){var t=e.frames;if(void 0!==this.cache[t]){var r=this.cache[t].indexOf(e);r>-1&&this.cache[t].splice(r,1)}}}},{key:"wait",value:function(e){return new s(this,e)}},{key:"start",value:function(){var e=this;if(!this.started){if(this.started=!0,this.cache[0]&&!this.zeroFrameDone)return this.zeroFrameDone=!0,setTimeout((function(){try{e.execNextFrame()}catch(t){console.error(t)}}),0),this.started=!1;this.t=setInterval((function(){try{e.execNextFrame()}catch(t){console.error(t)}e.currFrame+=1}),this.interval)}}}]),e}();t.a=new i},"./src/base/util/type.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"isNumber",(function(){return n})),r.d(t,"isNull",(function(){return o})),r.d(t,"isString",(function(){return a})),r.d(t,"isArray",(function(){return s})),r.d(t,"isObject",(function(){return i})),r.d(t,"arrayEqual",(function(){return u})),r.d(t,"throttle",(function(){return l})),r.d(t,"inArray",(function(){return c})),r.d(t,"arrToObjectKey",(function(){return d}));r("../node_modules/core-js/modules/es.array.reduce.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js");function n(e){return"[object Number]"===Object.prototype.toString.call(e)&&!isNaN(e)}function o(e){return"[object Null]"===Object.prototype.toString.call(e)}function a(e){return"String"===Object.prototype.toString.call(e).slice(8,-1)}function s(e){return"[object Array]"===Object.prototype.toString.call(e)}function i(e){return"Object"===Object.prototype.toString.call(e).slice(8,-1)}function u(e,t){if(e===t)return!0;if(e instanceof Array===!1||t instanceof Array===!1||e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function l(e,t,r,n){var o;return n="undefined"===typeof n||n,function(){for(var a=arguments.length,s=new Array(a),i=0;i<a;i++)s[i]=arguments[i];var u=this;return"undefined"!==typeof r&&(u=r),n?(e.apply(u,s),n=!1):!o&&void(o=setTimeout((function(){clearTimeout(o),o=null,e.apply(u,s)}),t))}}function c(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(n&&n===t)return!0}return!1}function d(e){return e.reduce((function(e,t,r){return e[t]=1,e}),{})}},"./src/base/util/url.ts":function(e,t,r){"use strict";r.d(t,"e",(function(){return u})),r.d(t,"d",(function(){return l})),r.d(t,"f",(function(){return c})),r.d(t,"g",(function(){return d})),r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return h})),r.d(t,"h",(function(){return m})),r.d(t,"c",(function(){return p}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/core-js/modules/es.regexp.constructor.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/core-js/modules/es.string.trim.js"),r("../node_modules/regenerator-runtime/runtime.js");var n=r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),o=r("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),a=r("../packages/model/src/cell/HyperlinkType.ts"),s=r("../node_modules/axios/index.js"),i=r.n(s);function u(e){var t=e.split("#tab=");if(!t||2!==t.length)return null;var r=Object(o.a)(t,2),n=r[0],a=r[1];return""!==n?null:a}function l(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e=String(e).trim();var r=/\.com$/i,n=/^www\./i,o=/^((http(s)?|ftp|file):\/\/)/i,a=/^(mailto:(\/\/)?)?([a-z0-9_\-.])+@([a-z0-9_\-.])+\.([a-z]{2,})$/i,s=/javascript:./i,i=!s.test(e)&&(o.test(e)||r.test(e)||n.test(e)||a.test(e));return t&&!/^(https?|ftp|file):\/\//i.test(e)&&(/^(\/\/)/.test(e)?e="http:".concat(e):/^[A-Za-z0-9]/.test(e)&&(e="http://".concat(e))),i?e:null}var c=["docs.qq.com","open.txdocs.qq.com","oa.txdocs.qq.com","embed.txdocs.qq.com"],d="(?:".concat(c.map((function(e){return e.replace(/\./g,"\\.")})).join("|"),")(/|$)");function f(e){return u(e)?a.b.SHEET_LINK:h(e)}function h(e){for(var t=0,r=[["doc",a.b.DOC],["sheet",a.b.SHEET],["slide",a.b.SLIDE],["form",a.b.FORM],["pdf",a.b.PDF],["image",a.b.IMAGE],["mind",a.b.MIND],["flowchart",a.b.FLOWCHART],["desktop/mydoc/folder/",a.b.FOLDER],["desktop/shared/folder",a.b.FOLDER_SHARE],["",a.b.TECENTDOC]];t<r.length;t++){var n=Object(o.a)(r[t],2),s=n[0],i=n[1];if(new RegExp("(https://)?".concat(d).concat(s)).test(e))return i}}function m(e){return new Promise(function(){var t=Object(n.a)(regeneratorRuntime.mark((function t(r,n){var o,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"/v2/file/link/getinfo",t.prev=1,t.next=4,i()({method:"post",url:"/v2/file/link/getinfo",timeout:2e3,data:JSON.stringify({docUrl:e})});case 4:o=t.sent,(a=null===o||void 0===o?void 0:o.data)&&0===a.retcode?r(a.result.linkInfo):n(),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(1),n();case 12:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(e,r){return t.apply(this,arguments)}}())}function p(e){return new RegExp("^https://".concat(d,"(sheet|doc|slide|form|pdf|file)/")).test(e)}},"./src/core/app/BaseSpreadsheetApp.ts":function(e,t,r){"use strict";var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=function(){function e(){Object(n.a)(this,e)}return Object(o.a)(e,[{key:"EVENT",get:function(){return e.EVENT}}]),e}();a.EVENT={},t.a=a},"./src/core/app/SpreadsheetApp.interface.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r("../packages/services/src/instantiation.ts"),o=Object(n.c)("ISpreadsheetApp")},"./src/core/app/SpreadsheetApp.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),s=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),i=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),u=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),l=r("./src/core/app/BaseSpreadsheetApp.ts"),c=r("./src/base/event/event.ts"),d=r("./src/flow/utils.ts");function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(i.a)(e);if(t){var o=Object(i.a)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var h,m=function(e,t,r,n){var o,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(u.a)(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(s=(a<3?o(s):a>3?o(t,r,s):o(t,r))||s);return a>3&&s&&Object.defineProperty(t,r,s),s},p=h=function(t){Object(a.a)(s,t);var r=f(s);function s(){var e;return Object(n.a)(this,s),(e=r.call(this)).didEditable=!1,e.event=c.c,e.isInited=!1,e}return Object(o.a)(s,[{key:"setDidEditable",value:function(e){this.didEditable=e}},{key:"getDidEditable",value:function(){return this.didEditable}},{key:"setInited",value:function(e){this.isInited=e}},{key:"initDocumentManager",value:function(e){this.documentManager=e}},{key:"initEmitter",value:function(e){this.emitter=e}},{key:"setLifeCycle",value:function(t){var r;null===(r=e.log)||void 0===r||r.info("SpreadsheetApp.setLifeCycle=",t),this.lifeCycle=t}},{key:"initSheetStatus",value:function(e){this.sheetStatus=e}},{key:"initAppFeatureConfigService",value:function(e){this.appFeatureConfigService=e}},{key:"initPermissions",value:function(e){this.permissions=e}},{key:"initNetworkStatus",value:function(e){this.networkStatus=e}},{key:"initSpreadsheet",value:function(e){this.spreadsheet=e}},{key:"initMutationBehavior",value:function(e){this.mutationBehavior=e}},{key:"initMainThreadWorker",value:function(e){this.mainThreadWorker=e}},{key:"initCalcController",value:function(e){this.calcController=e}},{key:"initDataCenter",value:function(e){this.dataCenter=e}},{key:"initMessageCenter",value:function(e){this.messageCenter=e}},{key:"initSocket",value:function(e){this.socket=e}},{key:"initOfflineEdit",value:function(e){this.offlineEdit=e}},{key:"initUndoRedoStack",value:function(e){this.undoredoStack=e}},{key:"initRequestApi",value:function(e){this.requestApi=e}},{key:"initView",value:function(e){this.view=e}},{key:"initPreview",value:function(e){this.preview=e}},{key:"initServiceCollection",value:function(e){this.serviceCollection=e}},{key:"initFeature",value:function(e){this.feature=e}},{key:"initFile",value:function(e){this.file=e}},{key:"getCurrentMainThreadWorker",value:function(){var e;return(null===(e=this.preview)||void 0===e?void 0:e.isActive)?this.preview.previewMainThreadWorker:this.mainThreadWorker}},{key:"initPlugins",value:function(e){this.plugins=e}},{key:"initTocConfig",value:function(e){this.sheetTocConfig=e,e.getBoolean("permession.readonly",!1)&&this.permissions.activeTempStatus(!1)}},{key:"initInstantiationService",value:function(e){this.instantiationService=e}},{key:"EVENT",get:function(){return h.EVENT}}]),s}(l.a);p.EVENT={PAGE_LOAD_START:"PAGE_LOAD_START",SPREAD_SHEET_SDK_CORE_START:"SPREAD_SHEET_SDK_CORE_START",SPREAD_SHEET_SDK_CORE_END:"SPREAD_SHEET_SDK_CORE_END",SPREAD_SHEET_PART_INTERACTIVE_START:"SPREAD_SHEET_PART_INTERACTIVE_START",SPREAD_SHEET_PART_INTERACTIVE_END:"SPREAD_SHEET_PART_INTERACTIVE_END",SPREAD_SHEET_MESSAGE_START:"SPREAD_SHEET_MESSAGE_START",SPREAD_SHEET_MESSAGE_END:"SPREAD_SHEET_MESSAGE_END",SPREAD_SHEET_ALL_CHUNK_READY:"SPREAD_SHEET_ALL_CHUNK_READY",SPREAD_SHEET_REQUEST_API_READY:"SPREAD_SHEET_REQUEST_API_READY",SPREAD_SHEET_EDITABLE:"SPREAD_SHEET_EDITABLE",SPREAD_SHEET_PLUGINS_START:"SPREAD_SHEET_PLUGINS_START",SPREAD_SHEET_PLUGINS_END:"SPREAD_SHEET_PLUGINS_END",PAGE_LOAD_FINISHED:"PAGE_LOAD_FINISHED",NEW_DOC_SPREAD_SHEET_PART_INTERACTIVE:"NEW_DOC_SPREAD_SHEET_PART_INTERACTIVE",DESTROY:"DESTROY",RESTART:"RESTART",START_DESTROY:"START_DESTROY",RESTART_END:"RESTART_END"},m([Object(d.a)("F_Set_Editable","END")],p.prototype,"setDidEditable",null),m([Object(d.a)("F_Set_Inited","END")],p.prototype,"setInited",null),m([Object(d.a)("F_Init_Document_Manager","END")],p.prototype,"initDocumentManager",null),m([Object(d.a)("F_Init_Emitter","END")],p.prototype,"initEmitter",null),m([Object(d.a)("F_Set_Life_Cycle","END")],p.prototype,"setLifeCycle",null),m([Object(d.a)("F_Init_Sheet_Status","END")],p.prototype,"initSheetStatus",null),m([Object(d.a)("F_Init_Permissions","END")],p.prototype,"initPermissions",null),m([Object(d.a)("F_Init_Network_Status","END")],p.prototype,"initNetworkStatus",null),m([Object(d.a)("F_Init_Spreadsheet","END")],p.prototype,"initSpreadsheet",null),m([Object(d.a)("F_Init_Mutation_Behavior","END")],p.prototype,"initMutationBehavior",null),m([Object(d.a)("F_Init_Main_Thread_Worker","END")],p.prototype,"initMainThreadWorker",null),m([Object(d.a)("F_Init_Calc_Controller","END")],p.prototype,"initCalcController",null),m([Object(d.a)("F_Init_Data_Center","END")],p.prototype,"initDataCenter",null),m([Object(d.a)("F_Init_MessageCenter","END")],p.prototype,"initMessageCenter",null),m([Object(d.a)("F_Init_Socket","END")],p.prototype,"initSocket",null),m([Object(d.a)("F_Init_Offline_Edit","END")],p.prototype,"initOfflineEdit",null),m([Object(d.a)("F_Init_Undo_Redo_Stack","END")],p.prototype,"initUndoRedoStack",null),m([Object(d.a)("F_Init_Request_API","END")],p.prototype,"initRequestApi",null),m([Object(d.a)("F_Init_View","END")],p.prototype,"initView",null),m([Object(d.a)("F_Init_Preview","END")],p.prototype,"initPreview",null),m([Object(d.a)("F_Init_Service_Collection","END")],p.prototype,"initServiceCollection",null),m([Object(d.a)("F_Init_Feature","END")],p.prototype,"initFeature",null),m([Object(d.a)("F_Init_File","END")],p.prototype,"initFile",null),m([Object(d.a)("F_Init_Plugins","END")],p.prototype,"initPlugins",null),p=h=m([Object(d.a)("M_Spreadsheet_App")],p),t.a=p}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/app/contributes/interface.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r("../packages/services/src/instantiation.ts"),o=Object(n.c)("IContributes")},"./src/core/app/event-init.ts":function(e,t,r){"use strict";r("../node_modules/regenerator-runtime/runtime.js");var n=r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),o=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),s=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=r("../packages/model/src/cell/CellDataDelta.ts"),u=r("../packages/model/src/cell/CellDataSlot.ts"),l=r("../packages/model/src/cell/CellFormatDelta.ts"),c=r("../packages/mutation/src/cell/SetCellPropertiesMutation.ts"),d=r("../packages/model/src/cell/CellFormatSlot.ts"),f=r("../packages/model/src/cell/CellData.ts"),h=r("./src/base/error/errCodeType.ts"),m=r("../packages/mutation/src/MutationId.ts"),p=r("./src/base/util/timer.ts"),v=r("../packages/report/src/index.ts"),g=r("./src/base/event/eventName.ts"),y=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),_=r.n(y),b=r("../packages/model/src/workbookRange/WorkbookRangeType.ts"),A=r("./src/core/feature/formula/utils/parseUtil.ts"),E=r("../packages/model/src/spreadsheet/SpreadsheetType.ts"),j=r("./src/base/event/event.ts"),R=r("../core-sheet/js/config/sheet.js"),S=r("../packages/model/src/sheet/index.ts"),C=r("./src/external/view/mobile/header/native-header/api.ts"),T=r("./src/external/view/mobile/header/native-header/utils.ts"),w=function(){function e(t){Object(a.a)(this,e),this.parent=t,this.init()}return Object(s.a)(e,[{key:"init",value:function(){this.listenMutationRun(),this.listenUpdateCellDataDV(),this.listenUpdateCellDatFromFormula(),this.listenExcelResize(),this.listenWorkrangeChange(),this.listenBeforeUnload(),this.listenUnload(),this.listenDataVersion(),this.listenDatabaseError()}},{key:"initDataHandle",value:function(e,t){var r,n,o,a,s=e.mutation;for(r=0,o=s.lastCol;r<=o;r++)for(n=0,a=s.lastRow;n<=a;n++)t.autoUpdateCellData(s.sheetId,n,r)}},{key:"setCellPropertiesHandle",value:function(e,t){var r,n,o,a,s=e.mutation,i=s.cellDataDelta,l=i.setSlots|i.clearSlots,c=i.delta.userEnteredFormatDelta?i.delta.userEnteredFormatDelta.setSlots|i.delta.userEnteredFormatDelta.clearSlots:0;if(0!==(l&1<<u.b.SLOT_EFFIECTIVE_VALUE)||0!==(c&1<<d.b.NUMBER_FORMAT)||0!==(l&1<<u.b.SLOT_FORMULA)||0!==(c&1<<d.b.DATA_VALIDATION)||0!==(l&1<<u.b.SLOT_FORMULA)){var f=s.gridRange;for(r=f.startRowIndex,o=f.endRowIndex;r<=o;r++)for(n=f.startColIndex,a=f.endColIndex;n<=a;n++)t.autoUpdateCellData(f.sheetId,r,n)}}},{key:"setRangeHandle",value:function(e,t){var r,n,o,a,s=e.mutation;for(o=0,a=s.cellDataDeltaAtPositions.length;o<a;o++){var i=s.cellDataDeltaAtPositions[o].cellDataDelta;r=i.setSlots|i.clearSlots,Object(A.b)({cellDataDelta:i,spreadsheet:t,sheetId:s.gridRange.sheetId,rowIndex:s.cellDataDeltaAtPositions[o].rowIndex,colIndex:s.cellDataDeltaAtPositions[o].colIndex});var l=s.cellDataDeltaAtPositions[o].cellDataDelta.delta.userEnteredFormatDelta;n=l?l.setSlots|l.clearSlots:0,0===(r&1<<u.b.SLOT_EFFIECTIVE_VALUE)&&0===(n&1<<d.b.NUMBER_FORMAT)&&0===(r&1<<u.b.SLOT_FORMULA)&&0===(n&1<<d.b.DATA_VALIDATION)&&0===(r&1<<u.b.SLOT_FORMULA)||t.autoUpdateCellData(s.gridRange.sheetId,s.cellDataDeltaAtPositions[o].rowIndex,s.cellDataDeltaAtPositions[o].colIndex)}}},{key:"setSheetPropertiesHandle",value:function(e,t){var r=e.mutation.sheetDelta;if(r)for(var n=0;n<r.deltas.length;n++){var o=r.deltas[n];if(o.slotName===S.NEW_SHEET_PROPERTIES_SLOT.SLOT_HIDE&&o.value){var a=!e.isCollab;j.c.sheetsBar.trigger("listenHideSheetEvent",a)}}}},{key:"deleteSheetHandle",value:function(e){var t=e.mutation;e.isCollab&&(t.sheetId===this.parent.spreadsheet.activeSheetId&&j.c.sheetsBar.trigger("listenDelSheetEvent"))}},{key:"insertDimensionHandle",value:function(e){var t=e.mutation;j.c.rangeAuthEvent.trigger("dimensionChange",{sType:e.sType,sheetId:t.sheetId})}},{key:"deleteDimensionHandle",value:function(e){var t=e.mutation;j.c.rangeAuthEvent.trigger("dimensionChange",{sType:e.sType,sheetId:t.sheetId})}},{key:"defineWorkbookRangeHandle",value:function(e){var t=e.mutation;t.workbookRangeType===b.a.PROTECTED_RANGE&&j.c.rangeAuthEvent.trigger("addNewRangeAuth",{sType:e.sType,sheetId:t.gridRange.sheetId,rangeId:t.workbookRangeId})}},{key:"deleteWorkbookRangeHandle",value:function(e){var t=e.mutation;t.workbookRangeType===b.a.PROTECTED_RANGE&&j.c.rangeAuthEvent.trigger("deleteRangeAuth",{sType:e.sType,rangeId:t.workbookRangeId})}},{key:"updateWorkbookRangeHandle",value:function(e){var t=e.mutation;t.workbookRangeType===b.a.PROTECTED_RANGE&&j.c.rangeAuthEvent.trigger("updateRangeAuth",{sType:e.sType,sheetId:t.gridRange.sheetId})}},{key:"listenMutationRun",value:function(){var e,t=this,r=(e={},Object(o.a)(e,m.b.INIT_DATA_MUTATION,this.initDataHandle.bind(this)),Object(o.a)(e,m.b.SET_CELL_PROPERTIES_MUTATION,this.setCellPropertiesHandle.bind(this)),Object(o.a)(e,m.b.SET_RANGE_MUTATION,this.setRangeHandle.bind(this)),Object(o.a)(e,m.b.SET_SHEET_PROPERTIES_MUTATION,this.setSheetPropertiesHandle.bind(this)),Object(o.a)(e,m.b.DELETE_SHEET_MUTATION,this.deleteSheetHandle.bind(this)),Object(o.a)(e,m.b.INSERT_DIMENSION_MUTATION,this.insertDimensionHandle.bind(this)),Object(o.a)(e,m.b.DELETE_DIMENSION_MUTATION,this.deleteDimensionHandle.bind(this)),Object(o.a)(e,m.b.DEFINE_WORKBOOK_RANGE_MUTATION,this.defineWorkbookRangeHandle.bind(this)),Object(o.a)(e,m.b.DELETE_WORKBOOK_RANGE_MUTATION,this.deleteWorkbookRangeHandle.bind(this)),Object(o.a)(e,m.b.UPDATE_WORKBOOK_RANGE_MUTATION,this.updateWorkbookRangeHandle.bind(this)),e);this.parent.mutationBehavior.emitter.addListener(this.parent.mutationBehavior.EVENT.AFTER_MUTATION_RUN,(function(e){var n,o=e.sType===E.a.PREVIEW?t.parent.preview.previewsheet:t.parent.spreadsheet,a=e.mutation,s=a.id;r[s]&&r[s](e,o),(null===(n=t.parent.view)||void 0===n?void 0:n.canvas)&&j.c.spreadsheetEvent.trigger("renderAfterMutationRun",e),t.parent.calcController&&!t.parent.calcController.isDestroyed||t.parent.data.initMutations.push(a)}))}},{key:"listenUpdateCellDataDV",value:function(){var e=this;j.c.spreadsheetEvent.listen("updateCellDataDV",(function(t){var r=new i.a,n=new l.a;"undefined"!==typeof t.dataValidation?n.setSlot(d.b.DATA_VALIDATION,t.dataValidation):n.clearSlot(d.b.DATA_VALIDATION),r.setSlot(u.b.SLOT_USER_ENTERED_FORMAT_DELTA,n);var o=new c.a({gridRange:t.gridRange,cellDataDelta:r});e.parent.mutationBehavior.applyMutation(o,{isLocal:!0})}))}},{key:"listenUpdateCellDatFromFormula",value:function(){var e=this;j.c.spreadsheetEvent.listen("updateCellDataFromFormula",(function(t){e.parent.mutationBehavior.applyMutation(t,{isLocal:!0,isFromFormula:!0})}))}},{key:"listenExcelResize",value:function(){var e=this;j.c.windowEvent.listen("resize",(function(t){var r,n=e.parent,o=36;_.a.isIPad?o=Object(R.getEditorBottom)()||44:_.a.isMobile&&(o=0);var a=document.querySelector("#canvasContainer"),s=document.querySelector("#footerContainer");if(null!==a){s&&"0px"!==s.style.bottom&&_.a.isPC&&(o=0);var i,u,l=window.innerHeight-a.getBoundingClientRect().top-o;if(a.style.height="".concat(l,"px"),!(null===(r=n.preview)||void 0===r?void 0:r.isActive))null===n||void 0===n||null===(i=n.view)||void 0===i||null===(u=i.canvas)||void 0===u||u.resize.resize()}}))}},{key:"listenUnload",value:function(){window.addEventListener("unload",(function(){Object(T.a)()&&C.a.hideButtonsBeforeJump()}))}},{key:"listenBeforeUnload",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=!1,p.a.wait(15e3).run((function(){t&&v.b.monitor(33687112)})),window.addEventListener("beforeunload",(function(e){var n,o,a,s=r.parent;return s.offlineEdit&&s.offlineEdit.shutDown(!0),v.b.jank.log({moduleValue:"page",actionValue:"refresh"}),(null===(n=s.view)||void 0===n||null===(o=n.canvas)||void 0===o||null===(a=o.inputManager)||void 0===a?void 0:a.isInputtingState())?(t=!0,v.b.monitor(33687112),v.b.jank.log({}),e.returnValue="\u5173\u95ed\u8868\u683c\u5c06\u4e0d\u4f1a\u4fdd\u5b58\u4f60\u6240\u8f93\u5165\u7684\u5185\u5bb9\uff0c\u662f\u5426\u786e\u8ba4\u79bb\u5f00\uff1f"):s.messageCenter.sendMessageCenter.hasUncommittedChanges()?(v.b.jank.log({}),e.returnValue="\u6587\u6863\u5b58\u5728\u672a\u4fdd\u5b58\u4fee\u6539\uff0c\u5982\u679c\u5173\u95ed\uff0c\u4fee\u6539\u5c06\u4e0d\u4f1a\u88ab\u4fdd\u5b58\u3002\u60a8\u662f\u5426\u786e\u5b9a\u5173\u95ed\uff1f"):void 0}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"listenWorkrangeChange",value:function(){var e=this;j.c.spreadsheetEvent.listen("afterKeyframeRun",(function(t){var r=t.sheetId,n=e.parent.spreadsheet.sheetManager.getSheetBySheetId(r);if(n){var o=n.sheetRangeManager;if(!o)return;o.each((function(e,t){for(var r=e.gridRange,o=r.startRowIndex,a=r.endRowIndex,s=r.startColIndex,i=r.endColIndex,u=o;u<=a;u++)for(var l=s;l<=i;l++){var c=n.getCellDataAtPosition(u,l);c||(c=new f.a,n.setCellDataAtPosition(u,l,c)),c.addSheetRange(t,e.sheetRangeType)}}))}}))}},{key:"listenDataVersion",value:function(){var e=this;this.parent.mutationBehavior.emitter.addListener(this.parent.mutationBehavior.EVENT.DATA_VERSION_TOO_LOW,(function(t){v.b.monitor(33872862),e.parent.event.errorCode.trigger("errorCode",{type:"front",code:h.a.DATA_VERSION_TOO_LOW})}))}},{key:"listenDatabaseError",value:function(){var e=this;j.c.spreadsheetEvent.listen(g.a.DATABASE_ERROR,(function(){var t;null===(t=e.parent.socket)||void 0===t||t.client.shutDown(h.a.DATABASE_ERROR)}))}}]),e}();t.a=w},"./src/core/app/permissions/index.ts":function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return m}));r("../node_modules/core-js/modules/es.array.includes.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.string.includes.js");var n,o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),i=r("./src/core/app/sheetStatus/index.ts"),u=r("../packages/services/src/instantiation.ts"),l=r("./src/core/data/configService/spreadConfig.ts"),c=r("./src/flow/utils.ts"),d=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(s.a)(Reflect))&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},f=function(e,t){return function(r,n){t(r,n,e)}},h=Object(u.c)("IPermissions"),m=n=function(){function t(e){Object(o.a)(this,t),this.sheetStatus=e}return Object(a.a)(t,[{key:"update",value:function(e){var t=!(!e.getConfig("canEdit")||e.getConfig("isPreview")),r=!!e.getConfig("canCopy"),n=!!e.getConfig("canComment");this.sheetStatus.workbookStatus.status.setCanEdit(t),this.sheetStatus.workbookStatus.status.setCanCopy(r),this.sheetStatus.workbookStatus.status.setCanComment(n)}},{key:"setWorkbookStatusCanEdit",value:function(e){this.sheetStatus.workbookStatus.status.setCanEdit(e);var t=l.a.getConfig("readerCanComment");this.setWorkbookStatusCanComment(1===t||e)}},{key:"setWorkbookStatusCanCopy",value:function(e){this.sheetStatus.workbookStatus.status.setCanCopy(e)}},{key:"setWorkbookStatusCanComment",value:function(e){this.sheetStatus.workbookStatus.status.setCanComment(e)}},{key:"setWorkbookStatusFull",value:function(e){this.sheetStatus.workbookStatus.status.setFull(e)}},{key:"setSheetsStatusCanEdit",value:function(e,t){this.sheetStatus.sheetsStatus.setSheetsStatusCanEdit(e,t)}},{key:"resetSheetsStatusCanEdit",value:function(e){this.setSheetsStatusCanEdit(e,this.sheetStatus.workbookStatus.canEdit)}},{key:"activeTempStatus",value:function(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{isHistory:!1};null===(r=e.log)||void 0===r||r.warn("call activeTempStatus \u6fc0\u6d3b\u4e34\u65f6\u6743\u9650",t),this.sheetStatus.tempStatus.status.setHistory(n.isHistory),this.sheetStatus.tempStatus.status.activated().setCanEdit(t);var o=l.a.getConfig("readerCanComment");this.sheetStatus.tempStatus.status.setCanComment(1===o||t)}},{key:"activeShutdownStatus",value:function(t){var r;null===(r=e.log)||void 0===r||r.warn("call activeShutdownStatus \u6fc0\u6d3bShutdown\u72b6\u6001",t),this.sheetStatus.shutDownStatus.status.activated().setCanEdit(t)}},{key:"unactiveTempStatus",value:function(){var t;null===(t=e.log)||void 0===t||t.warn("call unactiveTempStatus \u53d6\u6d88\u4e34\u65f6\u6743\u9650");var r=l.a.getConfig("canEdit");this.sheetStatus.tempStatus.status.setCanEdit(r),this.sheetStatus.tempStatus.status.setHistory(!1),this.sheetStatus.tempStatus.status.unactivated()}},{key:"setWorkbookStatusOnline",value:function(e){this.sheetStatus.workbookStatus.status.setOnline(e)}},{key:"setRangeStatusCanEdit",value:function(e){this.sheetStatus.rangesStatus.status.canEdit!==e&&this.sheetStatus.rangesStatus.status.setCanEdit(e)}},{key:"addRangeAuth",value:function(e,t,r){this.sheetStatus.rangesStatus.addRangeAuth(e,t,r)}},{key:"updateRangeAuthCacheStatus",value:function(e,t,r){this.sheetStatus.rangesStatus.updateRangeAuthCacheStatus(e,t,r)}},{key:"refreshRangeAuthCache",value:function(e,t){this.sheetStatus.rangesStatus.refreshRangeAuthCache(e,t)}},{key:"resetRangeStatusBySheetId",value:function(e){this.sheetStatus.rangesStatus.resetRangeStatusBySheetId(e)}},{key:"registerCaller",value:function(e){this.callers.includes(e)||this.callers.push(e)}},{key:"events",get:function(){return n.EVENT}}]),t}();m.EVENT={CAN_EDIT_CHANGE:"0",CAN_COPY_CHANGE:"1",CAN_COMMENT_CHANGE:"2"},m=n=d([Object(c.a)("M_Permissions"),f(0,i.a)],m)}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/app/sheetSize.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n={};function o(e){return n[e]||function(e){var t=window.SpreadsheetApp.spreadsheet.sheetManager.getSheetBySheetId(e),r={allNum:0,dataNum:0,isLarge:0};if(t){var o,a=t.getRowCount(),s=t.getColCount();r.allNum=a*s;for(var i=0;i<a;i++)if(o=t.data.rowData[i])for(var u=0;u<s;u++){o.values[u]&&(r.dataNum+=1)}r.isLarge=r.dataNum>=1e4?1:0}n[e]=r}(e),n[e]}},"./src/core/app/sheetStatus/Status.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=r("../packages/lib/EventEmitter.ts");function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var l=function(){function e(){Object(o.a)(this,e),this.init()}return Object(a.a)(e,[{key:"init",value:function(){this.emitter=new s.a,this.update()}},{key:"update",value:function(){this.canEdit=!1,this.canCopy=!1,this.canComment=!1,this.canUndo=!1,this.canRedo=!1,this.isPreview=!1,this.isFormPreview=!1,this.tempDisableEdit=!1,this.full=!1,this.activate=!0,this.isHistory=!1,this.isOnline=navigator.onLine}},{key:"change",value:function(e){this.emitter.on(this.event.CHANGE,e)}},{key:"offChange",value:function(e){this.emitter.off(this.event.CHANGE,e)}},{key:"undoChange",value:function(e){this.emitter.on(this.event.UNDO_CHANGE,e)}},{key:"offUndoChange",value:function(e){this.emitter.off(this.event.UNDO_CHANGE,e)}},{key:"redoChange",value:function(e){this.emitter.on(this.event.REDO_CHANGE,e)}},{key:"offRedoChange",value:function(e){this.emitter.off(this.event.REDO_CHANGE,e)}},{key:"destroy",value:function(){this.emitter.off()}},{key:"updateFromSheetMeta",value:function(e){var t=u({},this);this.isPreview=e.preview,this.isFormPreview=!!e.isFormPreview,this.emitter.emit(this.event.CHANGE,t,u(u({},this),{},{type:"preview"}))}},{key:"setCanEdit",value:function(e){var t=u({},this);this.canEdit=e,this.emitter.emit(this.event.CHANGE,t,this,u(u({},this),{},{type:"edit"}))}},{key:"setCanCopy",value:function(e){var t=u({},this);this.canCopy=e,this.emitter.emit(this.event.COPY_CHANGE,t,u(u({},this),{},{type:"copy"}))}},{key:"setHistory",value:function(e){this.isHistory=e}},{key:"setCanComment",value:function(e){var t=u({},this);this.canComment=e,this.emitter.emit(this.event.COMMENT_CHANGE,t,u(u({},this),{},{type:"comment"}))}},{key:"setCanUndo",value:function(e){var t=u({},this);this.canUndo=e,this.emitter.emit(this.event.UNDO_CHANGE,t,this)}},{key:"setCanRedo",value:function(e){var t=u({},this);this.canRedo=e,this.emitter.emit(this.event.REDO_CHANGE,t,this)}},{key:"setFull",value:function(e){var t=u({},this);this.full=e,this.emitter.emit(this.event.CHANGE,t,u(u({},this),{},{type:"full"}))}},{key:"setOnline",value:function(e){var t=u({},this);this.isOnline=e,this.emitter.emit(this.event.CHANGE,t,u(u({},this),{},{type:"online"}))}},{key:"unactivated",value:function(){return this.activate=!1,this}},{key:"activated",value:function(){return this.activate=!0,this}},{key:"event",get:function(){return e.EVENT}}]),e}();l.EVENT={CHANGE:"change",COMMENT_CHANGE:"commentChange",COPY_CHANGE:"copyChange",UNDO_CHANGE:"undoChange",REDO_CHANGE:"redoChange"}},"./src/core/app/sheetStatus/index.ts":function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return p}));r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),s=r("./src/core/app/sheetStatus/temp.ts"),i=r("./src/core/app/sheetStatus/sheets.ts"),u=r("./src/core/app/sheetStatus/workbook.ts"),l=r("./src/core/app/sheetStatus/ranges.ts"),c=r("../packages/services/src/instantiation.ts"),d=r("../packages/model/src/range/index.ts"),f=r("./src/flow/utils.ts"),h=r("./src/core/app/sheetStatus/shutDownStatus.ts"),m=function(e,t,r,n){var o,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(a.a)(Reflect))&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(s<3?o(i):s>3?o(t,r,i):o(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},p=Object(c.c)("ISheetStatus"),v=function(){function t(){Object(n.a)(this,t),this.init()}return Object(o.a)(t,[{key:"init",value:function(){this.tempStatus=new s.a,this.sheetsStatus=new i.a,this.workbookStatus=new u.a,this.rangesStatus=new l.b,this.shutDownStatus=new h.a}},{key:"update",value:function(){this.tempStatus.update(),this.sheetsStatus.update(),this.workbookStatus.update(),this.rangesStatus.update(),this.shutDownStatus.update()}},{key:"getStatusBySheetId",value:function(e){return this.sheetsStatus.status[e]}},{key:"getActiveSheetStatus",value:function(){return this.sheetsStatus.getActiveSheetStatus()}},{key:"change",value:function(t){try{this.tempStatus.status.change(t),this.shutDownStatus.status.change(t),this.rangesStatus.status.change(t),this.sheetsStatus.change(t),this.workbookStatus.status.change(t)}catch(n){var r;null===(r=e.log)||void 0===r||r.error("sheetStatus.change",null===n||void 0===n?void 0:n.stack)}}},{key:"offChange",value:function(t){try{this.tempStatus.status.offChange(t),this.shutDownStatus.status.offChange(t),this.rangesStatus.status.offChange(t),this.sheetsStatus.offChange(t),this.workbookStatus.status.offChange(t)}catch(n){var r;null===(r=e.log)||void 0===r||r.error("sheetStatus.offChange",null===n||void 0===n?void 0:n.stack)}}},{key:"undoChange",value:function(t){try{this.tempStatus.status.undoChange(t),this.workbookStatus.status.undoChange(t)}catch(n){var r;null===(r=e.log)||void 0===r||r.error("sheetStatus.undoChange",null===n||void 0===n?void 0:n.stack)}}},{key:"offUndoChange",value:function(t){try{this.tempStatus.status.offUndoChange(t),this.workbookStatus.status.offUndoChange(t)}catch(n){var r;null===(r=e.log)||void 0===r||r.error("sheetStatus.offUndoChange",null===n||void 0===n?void 0:n.stack)}}},{key:"redoChange",value:function(t){try{this.tempStatus.status.redoChange(t),this.workbookStatus.status.redoChange(t)}catch(n){var r;null===(r=e.log)||void 0===r||r.error("sheetStatus.redoChange",null===n||void 0===n?void 0:n.stack)}}},{key:"offredoChange",value:function(t){try{this.tempStatus.status.offRedoChange(t),this.workbookStatus.status.offRedoChange(t)}catch(n){var r;null===(r=e.log)||void 0===r||r.error("sheetStatus.offredoChange",null===n||void 0===n?void 0:n.stack)}}},{key:"destroy",value:function(){try{this.tempStatus.status.destroy(),this.shutDownStatus.status.destroy(),this.sheetsStatus.destroy(),this.workbookStatus.status.destroy(),this.rangesStatus.destroy()}catch(r){var t;null===(t=e.log)||void 0===t||t.error("sheetStatus.destroy",null===r||void 0===r?void 0:r.stack)}}},{key:"getRangeCanEdit",value:function(e){if(this.shutDownStatus.status.activate)return this.shutDownStatus.status.canEdit;if(this.tempStatus.status.activate)return this.tempStatus.status.canEdit;var t=!0,r=this.getStatusBySheetId(e.sheetId);return r&&(t=r.canEdit),this.rangesStatus.checkRangeStatus(e)===l.a.EDITABLE&&this.workbookStatus.canEdit&&t}},{key:"getRangeStatusBlockByBlock",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.rangesStatus.getRangeStatusBlockByBlock(e,t)}},{key:"isGridRangeSetRangeStatus",value:function(e,t){return this.rangesStatus.isGridRangeSetRangeStatus(e,t)}},{key:"isCurrentRowCanEdit",value:function(t){var r=t.startRow,n=t.endRow,o=e.SpreadsheetApp.spreadsheet.getActiveSheetId(),a=new d.GridRange(o,r,n,d.DEFAULT_DIMENSION_INDEX,d.DEFAULT_DIMENSION_INDEX);return this.getRangeCanEdit(a)}},{key:"isCurrentColCanEdit",value:function(t){var r=t.startCol,n=t.endCol,o=e.SpreadsheetApp.spreadsheet.getActiveSheetId(),a=new d.GridRange(o,d.DEFAULT_DIMENSION_INDEX,d.DEFAULT_DIMENSION_INDEX,r,n);return this.getRangeCanEdit(a)}},{key:"canEdit",get:function(){var t=!0,r=e.SpreadsheetApp.spreadsheet.activeSheetId,n=this.getStatusBySheetId(r);return n&&(t=n.canEdit),this.canEditExceptRangeStatus&&t&&this.rangesStatus.canEdit}},{key:"canEditExceptWorkbookStatus",get:function(){var e=!0;return this.shutDownStatus.status.activate?e=this.shutDownStatus.status.canEdit:this.tempStatus.status.activate&&(e=this.tempStatus.status.canEdit),e}},{key:"canEditExceptRangeStatus",get:function(){var e=!0;return this.shutDownStatus.status.activate?e=this.shutDownStatus.status.canEdit:this.tempStatus.status.activate&&(e=this.tempStatus.status.canEdit),e&&this.workbookStatus.canEdit}},{key:"canComment",get:function(){return this.workbookStatus.status.canComment&&this.workbookStatus.status.isOnline}},{key:"canCopy",get:function(){return this.workbookStatus.status.canCopy}}]),t}();v=m([Object(f.a)("M_SheetStatus")],v),t.b=v}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/app/sheetStatus/ranges.ts":function(e,t,r){"use strict";(function(e){r.d(t,"b",(function(){return c})),r.d(t,"a",(function(){return n}));r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.object.entries.js"),r("../node_modules/core-js/modules/es.object.values.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n,o=r("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),s=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=r("../packages/model/src/range/GridRange.ts"),u=r("./src/core/app/sheetStatus/Status.ts"),l=r("./src/base/util/object.ts");!function(e){e[e.READ_ONLY=1]="READ_ONLY",e[e.EDITABLE=2]="EDITABLE"}(n||(n={}));var c=function(){function t(){Object(a.a)(this,t),this.rangeAuthMatrix={},this.rangeAuthCache={},this.status=new u.a,this.status.canEdit=!0,this.computeBlockCacheInfo={}}return Object(s.a)(t,[{key:"update",value:function(){this.rangeAuthMatrix={},this.rangeAuthCache={},this.status.update(),this.status.canEdit=!0,this.computeBlockCacheInfo={}}},{key:"destroy",value:function(){this.update(),this.status.destroy()}},{key:"resetRangeStatusBySheetId",value:function(e){this.rangeAuthMatrix[e]=[],this.rangeAuthCache[e]={},this.status.update(),this.status.canEdit=!0,this.computeBlockCacheInfo[e]={valid:!1,info:[]}}},{key:"getRangeAuthMatrixItem",value:function(e){return this.rangeAuthMatrix[e]||this.createRangeAuthMatrixItem(e)}},{key:"getRangeAuthCacheItem",value:function(e){return this.rangeAuthCache[e]||this.createRangeAuthCacheItem(e)}},{key:"refreshRangeAuthCache",value:function(e,t){var r=this;this.rangeAuthCache[e]={},Object.entries(t).forEach((function(t){var n=Object(o.a)(t,2),a=n[0],s=n[1],i=s.gridRange,u=s.rangeStatus;r.rangeAuthCache[e][a]={rangeStatus:u,gridRange:i.clone()}})),this.refreshRangeAuthMatrix(e)}},{key:"getRangeStatusBlockByBlock",value:function(e,t){var r,n=[];return Array.isArray(this.rangeAuthMatrix[e])?null===t?(Object.values(this.rangeAuthCache[e]).forEach((function(e){n.push(e.gridRange.clone())})),n):(null===(r=this.computeBlockCacheInfo[e])||void 0===r?void 0:r.valid)?this.computeBlockCacheInfo[e].info:(n=this.getStatusByGreedMethod(this.rangeAuthMatrix[e],t,e),this.computeBlockCacheInfo[e]={valid:!0,info:n},n):n}},{key:"addRangeAuth",value:function(e,t,r){t.isValid()&&(this.getRangeAuthCacheItem(t.sheetId)[e]={gridRange:t.clone(),rangeStatus:r},this.updateRangeAuthMatrix(e,t,r),this.addRangeAuthCacheItem(e,r,t))}},{key:"checkRangeStatus",value:function(e){for(var t=this.convertGridRange(e),r=t.startRow,o=t.endRow,a=t.startCol,s=t.endCol,i=this.rangeAuthMatrix[e.sheetId],u=n.EDITABLE,l=r;l<=o;l++)if(i&&i[l]){if(u===n.READ_ONLY)break;for(var c=a;c<=s;c++)if(i[l][c]&&i[l][c]===n.READ_ONLY){u=n.READ_ONLY;break}}return u}},{key:"isGridRangeSetRangeStatus",value:function(e,t){for(var r=this.convertGridRange(e),n=r.startRow,o=r.endRow,a=r.startCol,s=r.endCol,i=this.rangeAuthMatrix[e.sheetId],u=!1,l=n;l<=o;l++)if(i&&i[l]){if(u)break;for(var c=a;c<=s;c++)if(i[l][c]&&i[l][c]===t){u=!0;break}}return u}},{key:"getCacheGridRangeByRangeId",value:function(e){for(var t=void 0,r=0,n=Object.entries(this.rangeAuthCache);r<n.length;r++){var a=Object(o.a)(n[r],2)[1][e];if(void 0!==a){t=a.gridRange.clone();break}}return t}},{key:"updateRangeAuthCacheStatus",value:function(e,t,r){var n=this.rangeAuthCache[t];(null===n||void 0===n?void 0:n[e])&&(n[e].rangeStatus=r)}},{key:"convertGridRange",value:function(e){return{startRow:e.startRowIndex===i.a?0:e.startRowIndex,endRow:e.endRowIndex===i.a?this.getCurrentSheetRowCount():e.endRowIndex,startCol:e.startColIndex===i.a?0:e.startColIndex,endCol:e.endColIndex===i.a?this.getCurrentSheetColCount():e.endColIndex}}},{key:"getCurrentSheetColCount",value:function(){return e.SpreadsheetApp.spreadsheet.activeSheet.getColCount()}},{key:"getCurrentSheetRowCount",value:function(){return e.SpreadsheetApp.spreadsheet.activeSheet.getRowCount()}},{key:"createRangeAuthCacheItem",value:function(e){return this.rangeAuthCache[e]=this.rangeAuthCache[e]||{},this.rangeAuthCache[e]}},{key:"addRangeAuthCacheItem",value:function(e,t,r){var n=this.rangeAuthCache[r.sheetId];n||(n={},this.rangeAuthCache[r.sheetId]=n),n[e]={rangeStatus:t,gridRange:r.clone()}}},{key:"createRangeAuthMatrixItem",value:function(e){return this.rangeAuthMatrix[e]=this.rangeAuthMatrix[e]||[],this.rangeAuthMatrix[e]}},{key:"updateRangeAuthMatrix",value:function(e,t,r){if(!t.isSheet){for(var o=this.convertGridRange(t),a=o.startRow,s=o.endRow,i=o.startCol,u=o.endCol,l=a;l<=s;l++){var c=this.createRangeAuthMatrixItem(t.sheetId);c[l]||(c[l]=[]);for(var d=i;d<=u;d++){!!c[l][d]&&c[l][d]===n.EDITABLE||(c[l][d]=r)}}void 0!==this.computeBlockCacheInfo[t.sheetId]&&(this.computeBlockCacheInfo[t.sheetId].valid=!1)}}},{key:"refreshRangeAuthMatrix",value:function(e){var t=this;this.rangeAuthMatrix[e]=[];var r=this.rangeAuthCache[e];Object.values(r).forEach((function(e){t.updateRangeAuthMatrix("",e.gridRange,e.rangeStatus)})),void 0!==this.computeBlockCacheInfo[e]&&(this.computeBlockCacheInfo[e].valid=!1)}},{key:"getStatusByGreedMethod",value:function(e,t,r){var n=this,o=[],a=Object(l.deepClone)(e);return a.forEach((function(e,s){var u=-1,l=-1,c=-1,d=-1,f=e||[],h=f.length;f.forEach((function(e,f){var m=e===t,p=h===f+1;m&&(c=-1!==c?c:f,d=f,u=-1!==u?u:s,l=-1!==l?l:s);var v=function(e,t,r,n){return-1!==e&&-1!==t&&-1!==r&&-1!==n}(u,l,c,d);if((!m||p)&&v){for(var g=u;n.isRangeSameStatus(r,{startRow:g,endRow:g,startCol:c,endCol:d},t);)g+=1;l=Math.max(0,g-1),o.push(new i.b(r,u,l,c,d)),function(e,t,r,n){for(var o=e;o<=t&&a[o];o++)for(var s=r;s<=n;s++)a[o][s]=null}(u,l,c,d),u=-1,l=-1,c=-1,d=-1}}))})),o}},{key:"isRangeSameStatus",value:function(e,t,r){var n=!0,o=t.startRow,a=t.endRow,s=t.startCol,i=t.endCol,u=this.rangeAuthMatrix[e];if(!u)return n=!1;for(var l=o;l<=a&&(u[l]||(n=!1),n);l++)for(var c=s;c<=i;c++)if(!u[l][c]||u[l][c]!==r){n=!1;break}return n}},{key:"canEdit",get:function(){return this.status.canEdit}}]),t}();c.EVENT={CHANGE:"change"}}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/app/sheetStatus/sheets.ts":function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return i}));var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../packages/lib/EventEmitter.ts"),s=function(){function e(){Object(n.a)(this,e),this.init()}return Object(o.a)(e,[{key:"init",value:function(){this.canEdit=!1,this.sheetId=""}},{key:"setCanEdit",value:function(e){this.canEdit=e}}]),e}(),i=function(){function t(){Object(n.a)(this,t),this.status={},this.emitter=new a.a}return Object(o.a)(t,[{key:"update",value:function(){this.status={}}},{key:"change",value:function(e){this.emitter.on(t.EVENT.CHANGE,e)}},{key:"offChange",value:function(e){this.emitter.off(t.EVENT.CHANGE,e)}},{key:"destroy",value:function(){this.status={},this.emitter.off()}},{key:"createSheetsStatus",value:function(e){return this.status[e]=this.status[e]||new s,this.status[e]}},{key:"setSheetsStatusCanEdit",value:function(e,r){(void 0===this.status[e]?this.createSheetsStatus(e):this.status[e]).setCanEdit(r),this.emitter.emit(t.EVENT.CHANGE,e)}},{key:"getSheetStatus",value:function(e){return this.status[e]}},{key:"getActiveSheetStatus",value:function(){var t=e.SpreadsheetApp.spreadsheet.activeSheetId;return this.getSheetStatus(t)}}]),t}();i.EVENT={CHANGE:"change"}}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/app/sheetStatus/shutDownStatus.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("./src/core/app/sheetStatus/Status.ts"),s=function(){function e(){Object(n.a)(this,e),this.status=new a.a,this.init()}return Object(o.a)(e,[{key:"init",value:function(){this.status.unactivated()}},{key:"update",value:function(){this.status.update(),this.status.unactivated()}}]),e}()},"./src/core/app/sheetStatus/temp.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("./src/core/app/sheetStatus/Status.ts"),s=function(){function e(){Object(n.a)(this,e),this.status=new a.a,this.init()}return Object(o.a)(e,[{key:"init",value:function(){this.status.unactivated()}},{key:"update",value:function(){this.status.update(),this.status.unactivated()}}]),e}()},"./src/core/app/sheetStatus/workbook.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("./src/core/app/sheetStatus/Status.ts"),s=function(){function e(){Object(n.a)(this,e),this.status=new a.a}return Object(o.a)(e,[{key:"update",value:function(){this.status.update()}},{key:"canEdit",get:function(){return this.status.canEdit}},{key:"canCopy",get:function(){return this.status.canCopy}},{key:"isOnline",get:function(){return this.status.isOnline}}]),e}()},"./src/core/app/spreadsheet-app-worker.interface.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r("../packages/services/src/instantiation.ts"),o=Object(n.c)("ISpreadsheetApp")},"./src/core/app/tool.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.split.js");var n=r("../packages/common-utils/src/url.ts"),o=r("./src/base/event/event.ts"),a=r("../packages/utils/src/safe.ts"),s=window;var i={replace:function(e){var t=s.location.href.split("?")[1],r="",n=s.location.hash;r=t&&(t=(t=t.split("&")).filter((function(e){return e.indexOf("tab=")<0&&e.indexOf("#")<0}))).length?"?".concat(t.join("&"),"&tab=").concat(e):"?tab=".concat(e),n&&(r+=n),s.history.replaceState(e,"",r)},pop:function(e){o.c.windowEvent.listen("popState",e)}},u={window:s,document:s.document,event:o.c,setHash:function(e){s.location.hash=e},getXsrf:a.b,getUrl:function(){return s.clientVars.shortLink},getQuery:n.getQuery,resized:function(e,t){o.c.windowEvent.listen("resize",(function(){e()}))},sheetNode:s.sheetNode,clientVars:s.clientVars,windowEvent:o.c.windowEvent,bodyEvent:o.c.bodyEvent,pad:s.pad,History:i};t.a=u},"./src/core/app/utils.ts":function(e,t,r){"use strict";(function(e){r.d(t,"b",(function(){return o})),r.d(t,"a",(function(){return a}));var n;r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../packages/mutation/src/other/EmptyMutation.ts");function o(t,r){for(var n=e.SpreadsheetApp.preview.previewsheet.sheets[t].data.rowData,o=0;o<n.length;o++)if(n[o])for(var a=0;a<n[o].values.length;a++){var s=n[o].values[a];if(s){var i=s.effectiveValue;(null===i||void 0===i?void 0:i.value)&&i.value===r&&!0}}}function a(e,t){var r=e.split("."),n=t.split(".");return r[0]===n[0]&&r[1]===n[1]}!function(e){e[e.resizeColumns=0]="resizeColumns",e[e.mergeCells=1]="mergeCells",e[e.unmergeCells=2]="unmergeCells",e[e.insertRows=3]="insertRows",e[e.insertColumns=4]="insertColumns",e[e.hideRows=5]="hideRows",e[e.hideColumns=6]="hideColumns",e[e.showRows=7]="showRows",e[e.showColumns=8]="showColumns",e[e.deleteRows=9]="deleteRows",e[e.deleteColumns=10]="deleteColumns",e[e.resizeRows=11]="resizeRows",e[e.resizeRowsColumns=12]="resizeRowsColumns",e[e.moveRows=13]="moveRows",e[e.moveColumns=14]="moveColumns",e[e.setRowFormData=15]="setRowFormData",e[e.setColFormData=16]="setColFormData",e[e.reorder=17]="reorder",e[e.freeze=18]="freeze",e[e.userEnter=19]="userEnter",e[e.userEnterToSheetId=20]="userEnterToSheetId",e[e.userRangeEnter=21]="userRangeEnter",e[e.addImage=22]="addImage",e[e.updateImage=23]="updateImage",e[e.deleteImage=24]="deleteImage",e[e.insertLink=25]="insertLink",e[e.fontBold=26]="fontBold",e[e.autoWrap=27]="autoWrap",e[e.numberFormat=28]="numberFormat",e[e.formatPainter=29]="formatPainter",e[e.decreaceDecimal=30]="decreaceDecimal",e[e.increaceDecimal=31]="increaceDecimal",e[e.clearLink=32]="clearLink",e[e.clearFormat=33]="clearFormat",e[e.setLink=34]="setLink",e[e.clearContent=35]="clearContent",e[e.replace=36]="replace",e[e.redo=37]="redo",e[e.undo=38]="undo",e[e.smartSelection=39]="smartSelection",e[e.setBasicFilter=40]="setBasicFilter",e[e.clearBasicFilter=41]="clearBasicFilter",e[e.updateFilterCriteria=42]="updateFilterCriteria",e[e.applyPasteData=43]="applyPasteData",e[e.reorderWithFilter=44]="reorderWithFilter",e[e.insideSheetCopyPaste=45]="insideSheetCopyPaste",e[e.defineFormRange=46]="defineFormRange",e[e.insertImage=47]="insertImage",e[e.defineCommentRange=48]="defineCommentRange",e[e.deleteCommentRange=49]="deleteCommentRange",e[e.dataValidation=50]="dataValidation",e[e.clearDataValidation=51]="clearDataValidation",e[e.doPaste=52]="doPaste",e[e.inserRowWithLogic=53]="inserRowWithLogic",e[e.insertColWithLogic=54]="insertColWithLogic",e[e.freezePreview=55]="freezePreview",e[e.cancelFreezePreview=56]="cancelFreezePreview",e[e.addConditionFormat=57]="addConditionFormat",e[e.deleteConditionFormat=58]="deleteConditionFormat",e[e.updateConditionFormat=59]="updateConditionFormat",e[e.setSheet=60]="setSheet",e[e.setHorizontalAlign=61]="setHorizontalAlign",e[e.setVerticalAlign=62]="setVerticalAlign",e[e.inserFunction=63]="inserFunction",e[e.setBackgroundColor=64]="setBackgroundColor",e[e.setHideGridlines=65]="setHideGridlines",e[e.setBorder=66]="setBorder",e[e.setFontColor=67]="setFontColor",e[e.fontStrike=68]="fontStrike",e[e.setFontFamliy=69]="setFontFamliy",e[e.setFontFamily=70]="setFontFamily",e[e.setFontSize=71]="setFontSize",e[e.fontItalics=72]="fontItalics",e[e.fontUnderLine=73]="fontUnderLine",e[e.formatPainterSetCache=74]="formatPainterSetCache",e[e.formatPainterApply=75]="formatPainterApply",e[e.formatPainterClear=76]="formatPainterClear",e[e.insertSheet=77]="insertSheet",e[e.delSheet=78]="delSheet",e[e.moveSheet=79]="moveSheet",e[e.hideSheet=80]="hideSheet",e[e.showSheet=81]="showSheet",e[e.renameSheet=82]="renameSheet",e[e.copySheet=83]="copySheet"}(n||(n={}))}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/behavior/api.interface.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r("../packages/services/src/instantiation.ts"),o=Object(n.c)("IRequestApi")},"./src/core/behavior/request/other/CopyPaste/Embedded.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));r("../node_modules/core-js/modules/es.array.map.js");var n=r("../packages/mutation/src/embedded/AddEmbeddedObjectMutation.ts");r("../packages/mutation/src/embedded/DeleteEmbeddedObjectMutation.ts");function o(e){return e.map((function(e){return new n.a({data:e})}))}},"./src/core/behavior/request/workbook/filterUtils/handleFilterRange.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"c",(function(){return i})),r.d(t,"b",(function(){return u})),r.d(t,"d",(function(){return f}));r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.replace.js");var n,o=r("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),a=r("../packages/model/src/range/GridRange.ts"),s=r("./src/core/behavior/request/workbook/filterUtils/searchCloseDataArea.ts");function i(e,t){var r,i=t.startRowIndex,u=t.endRowIndex,d=t.startColIndex,h=t.endColIndex,v=e.getRowCount()-1,g=e.getColCount()-1,y=t;if(i===u)if(d===h)y=Object(s.a)(e,t),r=n.SINGLE_CELL;else{var _=l(e,t),b=c(e,_),A=Object(o.a)(b,2),E=A[0],j=A[1],R=e.getCellDataAtPosition(_.startRowIndex,j),S=null===R||void 0===R?void 0:R.getMergeReference();S&&S.endColIndex>j&&(j=S.endColIndex),y=new a.b(t.sheetId,_.startRowIndex,_.endRowIndex,E,j),r=0===d&&h===g?n.ONE_ROW_WHOLE:n.ONE_ROW_PART}else if(0===i&&u===v)y=function(e,t){t.startRowIndex,t.endRowIndex;var r=t.startColIndex,n=t.endColIndex,s=function(e,t){for(var r,n,o=t.startRowIndex,a=t.endRowIndex,s=t.startColIndex,i=t.endColIndex,u=function(t){for(var r=s;r<=i;r++)if(!f(e,t,r))return!1;return!0},l=o;l<=a;l++)if(!u(l)){r=l;break}if(void 0===r)return[o,o];for(var c=a;c>r;c--)if(!u(c)){n=c;break}void 0===n&&(n=r);return[r,n]}(e,t),i=Object(o.a)(s,2),u=i[0],l=i[1],d=new a.b(t.sheetId,u,l,r,n),h=c(e,d),m=Object(o.a)(h,2),p=m[0],v=m[1];return new a.b(t.sheetId,u,l,p,v)}(e,t),r=d===h?n.ONE_COL_WHOLE:n.MULTI_COL_WHOLE;else if(m(e,t))y=Object(s.a)(e,t),r=n.SINGLE_MERGE_CELL;else if(function(e,t){for(var r=t.startRowIndex,n=t.endRowIndex,o=t.startColIndex,a=t.endColIndex,s=o;s<=a;s++){var i=e.getCellDataAtPosition(r,s),u=null===i||void 0===i?void 0:i.getMergeReference();if(u)if(u.endRowIndex===n)return!0}return!1}(e,t)){var C=new a.b(t.sheetId,u,u,d,h);C=l(e,C);var T=c(e,C=new a.b(t.sheetId,i,C.endRowIndex,d,h)),w=Object(o.a)(T,2),O=w[0],I=w[1];y=new a.b(t.sheetId,i,C.endRowIndex,O,I),r=n.MULTI_ROW_COL}else{var N=c(e,t),k=Object(o.a)(N,2),M=k[0],D=k[1];y=new a.b(t.sheetId,t.startRowIndex,t.endRowIndex,M,D),r=n.MULTI_ROW_COL}return[y,r,p(e,t)]}function u(e,t){return!function(e,t){for(var r=t.startRowIndex;r<=t.endRowIndex;r++)for(var n=t.startColIndex;n<=t.endColIndex;n++)if(!f(e,r,n))return!1;return!0}(e,t)||!!function(e,t){var r=t.startRowIndex,n=t.endRowIndex,o=t.startColIndex,a=t.endColIndex;if(r===n&&o===a)return!0;if(m(e,t))return!0;return!1}(e,t)&&!Object(s.a)(e,t).equals(t)}function l(e,t){for(var r=t.startRowIndex,n=t.endRowIndex,o=t.startColIndex,s=t.endColIndex,i=e.getRowCount()-1,u=n,l=r;l<=i;l++){for(var c=!0,d=o;d<=s;d++)if(!f(e,l,d)){c=!1;break}if(c)break;u=l}return new a.b(t.sheetId,r,u,o,s)}function c(e,t){for(var r,n,o=t.startRowIndex,a=t.endRowIndex,s=t.startColIndex,i=t.endColIndex,u=function(t){for(var r=o;r<=a;r++)if(!f(e,r,t))return!1;return!0},l=s;l<=i;l++)if(!u(l)){r=l;break}if(void 0===r)return[s,s];for(var c=i;c>r;c--)if(!u(c)){n=c;break}return void 0===n&&(n=r),[r,n]}function d(e,t,r){var n=e.getCellDataAtPosition(t,r),o=null===n||void 0===n?void 0:n.getEditValue();return!o||""===o.toString().replace(/[\u200B-\u200D\uFEFF]/g,"")}function f(e,t,r){return h(e,t,r)?function(e,t,r){var n=e.getCellDataAtPosition(t,r),o=null===n||void 0===n?void 0:n.getMergeReference();if(!o)return!1;return d(e,o.startRowIndex,o.startColIndex)}(e,t,r):d(e,t,r)}function h(e,t,r){var n=e.getCellDataAtPosition(t,r);return!!(null===n||void 0===n?void 0:n.getMergeReference())}function m(e,t){var r=t.startRowIndex,n=(t.endRowIndex,t.startColIndex),o=(t.endColIndex,e.getCellDataAtPosition(r,n)),a=null===o||void 0===o?void 0:o.getMergeReference();return!!a&&a.equals(t)}function p(e,t){for(var r=t.startRowIndex,n=t.endRowIndex,o=t.startColIndex,a=t.endColIndex,s=r;s<=n;s++)for(var i=o;i<=a;i++)if(h(e,s,i))return!0;return!1}!function(e){e[e.SINGLE_CELL=0]="SINGLE_CELL",e[e.SINGLE_MERGE_CELL=1]="SINGLE_MERGE_CELL",e[e.ONE_ROW_PART=2]="ONE_ROW_PART",e[e.ONE_ROW_WHOLE=3]="ONE_ROW_WHOLE",e[e.ONE_COL_WHOLE=4]="ONE_COL_WHOLE",e[e.MULTI_COL_WHOLE=5]="MULTI_COL_WHOLE",e[e.MULTI_ROW_COL=6]="MULTI_ROW_COL"}(n||(n={}))},"./src/core/behavior/request/workbook/filterUtils/searchCloseDataArea.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return d}));r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=r("../packages/model/src/range/GridRange.ts"),a=r("./src/core/behavior/request/workbook/filterUtils/handleFilterRange.ts");function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(e,t){for(var r=t.startRowIndex;r<=t.endRowIndex;r++)for(var n=t.startColIndex;n<=t.endColIndex;n++)if(!Object(a.d)(e,r,n))return!1;return!0}function l(e,t,r){return(!Object(a.d)(e,t-1,r)||!Object(a.d)(e,t-1,r+1))&&(!Object(a.d)(e,t-1,r-1)||!Object(a.d)(e,t,r-1)||!Object(a.d)(e,t+1,r-1))}function c(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=d(e,t);return r&&!n.equals(t)?f(e,n):n}function d(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e.getRowCount(),s=e.getColCount(),c=Date.now(),d=0,f=!1;try{for(;d<n+s;){d+=1;var h=t,m=h.startRowIndex,p=h.startColIndex,v=h.endRowIndex,g=h.endColIndex;if((!r||d>1||l(e,m,p))&&(f=!0),f&&m>=1&&p>=1&&!Object(a.d)(e,m-1,p-1))t=new o.b(i(i({},t),{},{startRowIndex:m-1,startColIndex:p-1}));else if(f&&m>=1&&g<s-1&&!Object(a.d)(e,m-1,g+1))t=new o.b(i(i({},t),{},{startRowIndex:m-1,endColIndex:g+1}));else if(f&&v<n-1&&p>=1&&!Object(a.d)(e,v+1,p-1))t=new o.b(i(i({},t),{},{endRowIndex:v+1,startColIndex:p-1}));else if(v<n-1&&g<s-1&&!Object(a.d)(e,v+1,g+1))t=new o.b(i(i({},t),{},{endRowIndex:v+1,endColIndex:g+1}));else if(f&&m>=1&&!u(e,new o.b(i(i({},t),{},{startRowIndex:m-1,endRowIndex:m-1}))))t=new o.b(i(i({},t),{},{startRowIndex:m-1}));else if(v<n-1&&!u(e,new o.b(i(i({},t),{},{startRowIndex:v+1,endRowIndex:v+1}))))t=new o.b(i(i({},t),{},{endRowIndex:v+1}));else if(f&&p>=1&&!u(e,new o.b(i(i({},t),{},{startColIndex:p-1,endColIndex:p-1}))))t=new o.b(i(i({},t),{},{startColIndex:p-1}));else{if(!(g<s-1)||u(e,new o.b(i(i({},t),{},{startColIndex:g+1,endColIndex:g+1}))))return t;t=new o.b(i(i({},t),{},{endColIndex:g+1}))}}return t}finally{var y=Date.now();window.log.info("startSearchArea used ".concat(d," iterations, took ").concat(y-c,"ms"))}}function f(e,t){var r=t.isCol||0===t.startRowIndex&&t.endRowIndex===e.getRowCount()-1,n=t.isRow||0===t.startColIndex&&t.endColIndex===e.getColCount()-1;if(!r){for(;t.endRowIndex>t.startRowIndex&&u(e,new o.b(i(i({},t),{},{endRowIndex:t.startRowIndex})));)t=new o.b(i(i({},t),{},{startRowIndex:t.startRowIndex+1}));for(;t.endRowIndex>t.startRowIndex&&u(e,new o.b(i(i({},t),{},{startRowIndex:t.endRowIndex})));)t=new o.b(i(i({},t),{},{endRowIndex:t.endRowIndex-1}))}if(!n){for(;t.endColIndex>t.startColIndex&&u(e,new o.b(i(i({},t),{},{endColIndex:t.startColIndex})));)t=new o.b(i(i({},t),{},{startColIndex:t.startColIndex+1}));for(;t.endColIndex>t.startColIndex&&u(e,new o.b(i(i({},t),{},{startColIndex:t.endColIndex})));)t=new o.b(i(i({},t),{},{endColIndex:t.endColIndex-1}))}return t}},"./src/core/behavior/utils.ts":function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return o}));r("../node_modules/core-js/modules/es.array.every.js");function n(e,t,r){for(var n=0;n<r.length;n++){if(!r[n].every((function(r,n){var o=e.getCellDataAtPosition(r,n);if(!o)return!0;var a=o.getConditionalFormatResult();return!a||!a.hasSlot(t)})))return!0}return!1}function o(e){return"number"===typeof e&&(!isNaN(e)&&!(e<0))}},"./src/core/data/configService/appFeature/tencentmeeting.config.json":function(e){e.exports=JSON.parse('{"name":"TencentMeetingConfig","displayName":"\u817e\u8baf\u4f1a\u8bae\u4e2d\u817e\u8baf\u6587\u6863\u914d\u7f6e","description":"\u817e\u8baf\u4f1a\u8bae\u4e2d\u817e\u8baf\u6587\u6863\u914d\u7f6e","version":"1.0.0","publisher":"shaolongyin","license":"MIT","contributes":{"app":"sheet","common":{"blankpage":{},"menu":{"rangeAuth":false,"waterMark":false,"formInFeature":false,"newSheet":false,"importFile":false,"createCopy":false,"ownerAuth":false},"statusbar":{},"sheetsbar":{"rangeAuth":false},"toolbar":{"insertGroup":{"insertCellImage":false},"RANGE_AUTH":false}},"custom":{"contextmenu":{"pasteSpecialCombine":false,"rangeAuthButtonGroup":false,"insertImageButton":false},"feature":{"linkedRange":false},"widget":{"help-center":true}},"version":{}}}')},"./src/core/data/configService/appfeatureConfigService.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return m}));r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),s=r("../packages/services/src/instantiation.ts"),i={app:"sheet",common:{blankpage:{},menu:{rangeAuth:!0,waterMark:!0,formInFeature:!0,newSheet:!0,importFile:!0,createCopy:!0,ownerAuth:!0},statusbar:{},titlebar:{account:!0,auth:!0,back:!0,collaborators:!0,collect:!0,fileMenu:!0,login:!0,logo:!0,moreMenu:!0,move:!0,new_logo:!1,presentation:!0,readonly:!0,saveState:!0,share:!0,title:!0},toolbar:{"titlebar-toggle":!0,insertGroup:{insertCellImage:!0},RANGE_AUTH:!0},sheetsbar:{rangeAuth:!0}},custom:{contextmenu:{pasteSpecialCombine:!0,rangeAuthButtonGroup:!0,cellImage:!0,insertImageButton:!0},feature:{linkedRange:!0},widget:{"help-center":!0}},version:""},u=r("./src/core/app/contributes/interface.ts"),l=r("./src/core/data/configService/appFeature/tencentmeeting.config.json"),c=r("../node_modules/lodash/merge.js"),d=r.n(c),f=function(e,t,r,n){var o,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(a.a)(Reflect))&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(s<3?o(i):s>3?o(t,r,i):o(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},h=function(e,t){return function(r,n){t(r,n,e)}},m=Object(s.c)("IAppFeatureConfigService"),p=function(){function e(t){Object(n.a)(this,e),this.contribute=t,this.featureConfig=i,this.initFeatureConfig()}return Object(o.a)(e,[{key:"getFeatureConfig",value:function(){return this.featureConfig}},{key:"initFeatureConfig",value:function(){var e=this.getConfigName(),t=i;if(e){var r="".concat(e,".config");this.contribute.setContribute({name:r,json:l}),d()(t,this.contribute.getContribute(r))}this.featureConfig=t}},{key:"getConfigName",value:function(){var e;return(null===(e=window.TxDocAPI)||void 0===e?void 0:e.corpName)?window.TxDocAPI.corpName:null}}]),e}();p=f([h(0,u.a)],p);t.b=p},"./src/core/data/configService/spreadConfig.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return m}));r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../node_modules/lodash/set.js"),s=r.n(a),i={accountPrivs:"accountPrivs",maxRevisions:"accountPrivs.maxRevisions",advPolicy:"advPolicy",viewForbidCopyPrint:"advPolicy.view_forbid_copy_print",readerCanComment:"advPolicy.reader_can_comment",writerCanComment:"advPolicy.writer_can_comment",appInfoConfig:"appInfoConfig",clientIp:"clientIp",collabClientVars:"collab_client_vars",sid:"collab_client_vars.client.sid",upid:"collab_client_vars.client.upid",sig:"collab_client_vars.client.sig",tid:"collab_client_vars.client.tid",clientAgent:"collab_client_vars.clientAgent",dirty:"collab_client_vars.dirty",gray:"collab_client_vars.gray",dver:"collab_client_vars.dver",apid:"collab_client_vars.apid",websocket:"collab_client_vars.websocket",websocketReopenCount:"collab_client_vars.websocketReopenCount",pollingAttemptNumber:"collab_client_vars.pollingAttemptNumber",wmode:"collab_client_vars.wmode",ver:"collab_client_vars.ver",rev:"collab_client_vars.rev",pver:"collab_client_vars.pver",defaultSheetId:"collab_client_vars.padSubId",defaultData:"collab_client_vars.initialAttributedText.text",sheetList:"collab_client_vars.header[0].d",docType:"padType",createdTime:"createdDate",title:"padTitle",guestPolicy:"initialOptions.guestPolicy",ip:"clientIp",expire:"privilegeExpire",policyType:"policy",canRead:"privilegeAttribute.can_read",isAuth:"privilegeAttribute.is_auth",canEdit:"privilegeAttribute.can_edit",canLinkExp:"privilegeAttribute.can_link_exp",canWaterMark:"privilegeAttribute.can_watermark",canHistory:"privilegeAttribute.can_history",canCopyDoc:"privilegeAttribute.can_copy_doc",canTranslate:"privilegeAttribute.can_translate",canAbout:"privilegeAttribute.can_about",canCopy:"privilegeAttribute.can_copy",canComment:"privilegeAttribute.can_comment",canSearch:"privilegeAttribute.can_search",canEditTitle:"privilegeAttribute.can_edit_title",canShare:"privilegeAttribute.can_share",canSpitSlot:"privilegeAttribute.can_spit_slot",canViewImage:"privilegeAttribute.can_view_image",canPrint:"privilegeAttribute.can_print",appFlag:"userInfo.app_flag",avatar:"userInfo.avatar",corpId:"userInfo.corp_id",corpName:"userInfo.corp_name",email:"userInfo.db_email",domain:"userInfo.domain",expired:"userInfo.expired",login:"userInfo.login",isLogin:"isLogin",loginTime:"userInfo.login_time",loginType:"userInfo.login_type",nick:"userInfo.nick",qqAvatar:"userInfo.qq_avatar",qqNick:"userInfo.qq_nick",relative:"relative",thirdAppid:"userInfo.third_appid",thirdSource:"userInfo.third_source",thirdUid:"userInfo.third_uid",tinyid:"userInfo.tinyid",toid:"userInfo.toid",uid:"userInfo.uid",uidSource:"userInfo.uid_source",uin:"userInfo.uin",workId:"userInfo.work_id",wxAvatar:"userInfo.wx_avatar",wxNick:"userInfo.wx_nick",wxOpenid:"userInfp.wx_openid",userIsGuest:"userIdGuset",userLink:"userLink",userName:"userName",userPic:"userPic",userType:"userType",isVip:"vipInfo.isVip",oldVip:"vipInfo.oldVip",templateType:"templateInfo.templateType",templateId:"templateInfo.templateId"};var u,l=r("../node_modules/lodash/get.js"),c=r.n(l),d=function(){function e(t,r,o){Object(n.a)(this,e),this._clientVars=t}return Object(o.a)(e,[{key:"getConfig",value:function(e){var t=i[e]||e;return c()(this._clientVars,t)}},{key:"setConfig",value:function(e){var t=this;Object.keys(e).forEach((function(r){var n=i[r]||r,o=e[r];s()(t._clientVars,n,o)}))}},{key:"reloadConfig",value:function(e){delete this._clientVars,this._clientVars=e}}]),e}();!function(e){e.DOC="doc",e.SHEET="sheet",e.FORM="form",e.SLICE="slice"}(u||(u={}));var f=r("../packages/common-utils/src/cookie.ts"),h=r("./src/core/worker/util.ts"),m=new d({padType:"sheet",isProPad:!0,shortLink:"",docStatus:0,advPolicy:{},lastModifyUser:"",uin:"",isEmbed:!1,invitedGroupInfos:[],newOpenSvc:-1,nameGuess:null,colorPalette:[],userId:"",domainId:"",useFbChat:!1,localPadId:"",userName:"",disableFB:!1,relativeUrl:null,newPad:!1,collab_client_vars:{apid:{},apool:{},bad:-1,client:{upid:"",sid:"",sig:"",tid:0},dirty:-1,dver:"2.0.0",globalPadId:"",gray:-1,header:[{id:"BB08J2",name:"\u5de5\u4f5c\u8868"}],initialAttributedText:{text:[],attribs:""},padId:"",padSubId:"",padType:"",pollingAttemptNumber:-1,pos:-1,pver:-1,rev:-1,ver:-1,websocket:!1,websocketReopenCount:-1,wmode:"",clientAgent:""},createdDate:15489504e5,padTitle:"",isUserChangeTitle:-1,initialOptions:{guestPolicy:""},globalPadId:"",titleIsReadOnly:!1,isSnapshot:!1,relative:null,envi:null,userColor:-1,isOwner:!1,policy:-1,friendUserIds:[],clientIp:"",appInfoConfig:null,userIsGuest:!1,ownerId:"",proTitle:"",userDomain:"",specialKey:null,isTimDomain:!1,isOverConNum:!1,shouldGetFbLoginStatus:!1,initialSpaces:null,ownerAppid:"",accountPrivs:{maxRevisions:1e8},isPublicPad:!1,userInfo:{},padId:"",rightFlag:-1,isPadAdmin:!1,siteName:"",isLogin:!1,initialRevisionList:[],specialKeyTranslation:null,userPic:"",privilegeExpire:-1,privilegeAttribute:{can_edit:0,can_read:1},creatorId:"",initialTitle:"",creatorDomain:"",isOpendocxfromTim:!1,isCreator:!1,encrypted:"",userLink:"",metaCreateTime:15489504e5,dropboxConnected:!1,invitedUserInfos:[],tinyid:"",lastModifyTime:15489504e5,isTimOnline:!1,preview:"",oPadSubId:"",userType:"",uidKey:"",vipInfo:{},enableToCVipFeature:!1,templateInfo:{},newPadType:""},["metaData","extraData","dataInfo","userInfo","relativeInfo","policyInfo","advPolicyInfo","shareInfo","collabInfo","vipInfo","templateInfo"],{metaData:{docType:u.SHEET,secretId:"",globalPadId:"",padId:"",domainId:"",docStatus:0,creatorId:"",createTime:0,lastModifyTime:0,lastModifyUser:"",title:"",ownerId:"",encrypted:"",siteName:"",isOwner:"false",isCreator:!1,metaCreateTime:0,creatorDomain:""},extraData:{newPad:!1,isTimOnline:!1,isOpendocxfromTim:!1,isLogin:!1,gray:!1,colorPalette:[],dver:"",websocket:!1,websocketReopenCount:0,pollingAttemptNumber:0,isUserChangeTitle:!1,titleIsReadOnly:!1,isTemp:!1,msgFilterData:{},isPreview:!1,isSnapshot:!1,isOverConNum:!1,isOverUpdateConNum:!1,tid:"",apid:"",newDocType:"",appInfoConfig:{}},dataInfo:{wmode:"",pver:0,rev:0,ver:0,defaultSheetId:"",sheetList:[],sig:""},userInfo:{userName:"",userId:"",uid:Object(h.e)((function(){return""}),(function(){return Object(f.getCookie)("uid")})),uidKey:"",uin:0,tinyId:"",nick:"",userPic:"",wxOpenId:"",uidSource:0,email:"",wxNick:"",wxAvatar:"",qqNick:"",qqAvatar:"",workId:"",corpId:"",corpName:"",thirdAppId:"",thirdUid:"",thirdSource:0,toId:"",appFlag:0,login:!1,loginType:0,userLink:"",ip:"",userColor:0,ownerAppid:"",sid:"",upid:"",userType:"",apid:{},clientAgent:"",isDeleted:!1,fullName:"",id:"",flags:!1},relativeInfo:{relativeUrl:"",relative:[]},policyInfo:{expire:!1,policyType:0,useFbChat:!1,disableFB:!1,canRead:!1,isAuth:!1,canEdit:!1,canLinkExp:!1,canWaterMark:!1,canHistory:!1,canCopyDoc:!1,canTranslate:!1,canAbout:!1,canCopy:!1,canComment:!1,rightFlag:-1,canSearch:!1,canEditTitle:!1,canShare:!1,canSpitSlot:!1,canViewImage:!1,canPrint:!1,maxRevisions:1e6},advPolicyInfo:{viewForbidCopyPrint:!1,readerCanComment:!1,writerCanComment:!1},shareInfo:{guestPolicy:"",shortLink:""},collabInfo:{friendUserIds:[],invitedUserInfos:[],invitedGroupInfos:[]},vipInfo:{isVip:!1,oldVip:!1},templateInfo:{templateId:"",templateType:0}})},"./src/core/data/converter/keyframe/keyframe.ts":function(e,t,r){"use strict";function n(e){var t={keyframe:[],actions:[],lastKeyFrameActions:[],hasKeyFrame:!1};if(Array.isArray(e))t.actions=e;else try{t.actions=[JSON.parse(unescape(e))]}catch(r){}return t}r.d(t,"a",(function(){return n}))},"./src/core/data/converter/tencentdoc/doMutation.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.map.js");var n=r("../packages/mutation/src/MutationOperationType.ts"),o=r("../packages/mutation/src/MutationId.ts"),a=r("../packages/report/src/index.ts"),s=r("./src/base/config/report.ts");function i(e,t,r){var i,u=+new Date,l=e.parent.mutationBehavior.getCollabMutations(t);if(!a.b.speed.hasDonePagePerformanceReport()){s.SPEED_REPORT_POINTS.MUTATIONS_DESERIALIZATION;a.b.speed.runReport(s.SPEED_REPORT_POINTS.MUTATIONS_DESERIALIZATION,u,+new Date,!0)}for(var c=[],d=0,f=l.length;d<f;d++)(i=l[d]).operationType=n.a.HISTORY,e.parent.mutationBehavior.applyMutation(i,{isLocal:!0,ignoreCheck:-1===o.a.indexOf(i.id),isReplay:!0},e).isValid||c.push(i);if(c.length)try{var h=c.map((function(e){return JSON.stringify(e).substring(0,100)}));a.b.run(s.CONFIG.DO_MUTATIONS,h)}catch(m){console.error(m)}return"function"===typeof r&&r(l),e.activeSheet}},"./src/core/data/converter/tencentdoc/handleKeyframe/keyframeOne.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=r("../packages/model/src/config/index.ts"),a=r("../packages/model/src/sheet/BaseSheet.ts"),s=r("../packages/model/src/dimension/DimensionProperties.ts"),i=r("../packages/model/src/utils/serializeUtils.ts"),u=r("./src/core/data/configService/spreadConfig.ts");function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function d(e,t,r,n,l){if(t){var d;if(console.warn("\u5f53\u524dkeyframe\u7248\u672c\u4e3a\uff1a ".concat(l)),l>=5)d=a.a.deserialize(JSON.parse(t),{spreadsheet:e.spreadsheetReference,sheetId:e.getSheetId()});else{d=Object(i.deserialize)(JSON.parse(t),a.a,{keyframeVer:l,sheetId:e.getSheetId()});var f=+new Date(2019,4,24);u.a.getConfig("createdTime")>=f||function(e){var t,r,n;for(t=0,r=e.data.rowMetadata.length;t<r;t++)!(n=e.data.rowMetadata[t])||n.pixelSize>=o.DEFAULT_ROW_HEIGHT||e.setRowProperties(t,s.a.newInstance(c(c({},n),{},{pixelSize:void 0})))}(e)}e.customNumberFormatMap=d.customNumberFormatMap;var h=e.properties,m=h.index,p=h.title,v=h.sheetId;e.properties=d.properties,e.properties.sheetId=v,e.properties.title=p,e.properties.index=m,e.data=d.data,e.data.sheetReference=e,e.mergeManager=d.mergeManager,e.mergeManager.sheetReference=e,e.setBasicFilter(d.getBasicFilter()),e.getBasicFilter()&&(e.getBasicFilter().sheetReference=e),e.imageManager=d.imageManager,e.imageManager.sheetReference=e,e.sheetRangeManager=d.sheetRangeManager,e.sheetRangeManager.sheetReference=e,e.mentionManager=d.mentionManager,e.mentionManager.sheetReference=e,e.hyperlinkManager=d.hyperlinkManager,e.conditionalFormatRuleManager=d.conditionalFormatRuleManager,e.conditionalFormatRuleManager.sheetReference=e}}},"./src/core/data/converter/tencentdoc/keyframeToSheetConverter.ts":function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return u}));var n=r("../packages/report/src/index.ts"),o=r("./src/base/config/report.ts"),a=r("./src/core/data/converter/keyframe/keyframe.ts"),s=r("./src/core/data/converter/tencentdoc/doMutation.ts"),i=r("../packages/mutation/src/other/InitDataMutation.ts");function u(t,r,u){var c,d,f,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},m=t.sheetManager.getSheetBySheetId(r);if(null===(c=e.log)||void 0===c||c.debug("flow k2sConverter start"),m){var p,v=h.beforeConvert,g=(h.afterKeyframeRun,h.afterConvert);f=+new Date,p=Object(a.a)(u),window.needOpenSpeedReport&&(+new Date,n.b.speed.runReport(o.SPEED_REPORT_POINTS.KEYFRAME_TRANSFORM,f,+new Date));var y=p,_=y.keyframe;"function"===typeof v&&v(m,_),f=+new Date;for(var b=0,A=p.actions.length;b<A;b++)for(var E=l(p.actions[b]),j=0,R=E.length;j<R;j++){var S=E[j];Object(s.a)(t,S)}p.actions.length&&m.correct(),+new Date,window.needOpenSpeedReport&&n.b.tdwReport({opername:"quality_doc",module:"excel_detail",action:"first_screen_mutation_count",ver5:p.actions.length}),"function"===typeof g&&g(p);var C=new i.a({sheetId:m.getSheetId(),lastRow:m.getRowCount()-1,lastCol:m.getColCount()-1});t.parent.mutationBehavior.applyMutation(C,{isLocal:!0},m)}return null===(d=e.log)||void 0===d||d.debug("flow k2sConverter end"),m}function l(e){return"string"===typeof e?l(JSON.parse(e)):e}}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/feature/Feature.interface.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r("../packages/services/src/instantiation.ts"),o=Object(n.c)("IFeature")},"./src/core/feature/copyPaste/api/copyPasteAPI.m.ts":function(e,t,r){"use strict";r.d(t,"d",(function(){return l})),r.d(t,"c",(function(){return d})),r.d(t,"b",(function(){return h}));r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/regenerator-runtime/runtime.js");var n=r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),o=r("./src/core/feature/copyPaste/clipboardCopy.ui.ts"),a=r("./src/core/feature/copyPaste/wxCopyPaste.ui.ts"),s=r("./src/core/feature/copyPaste/copyPaste2.ui.ts"),i=r("../packages/report/src/index.ts"),u=r("./src/core/feature/copyPaste/interfaces.ts");function l(e){return c.apply(this,arguments)}function c(){return(c=Object(n.a)(regeneratorRuntime.mark((function e(t){var r,n,i,u,l,c,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.feature.getCopyPaste();case 2:return r=e.sent,n=r.copyPasteCache.getCacheState(),i=n.valid,u=n.hasDonePaste,l=r.getPasteType()!==s.CANPASTETYPE.NONE,e.next=9,new Promise((function(e){Object(o.h)((function(){e()}))}));case 9:return c=Object(o.e)(),d=a.a.isCopyInEnv()&&a.a.isCopyDataAvailable(),e.abrupt("return",i&&!u||l||c||d);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(e,t){return f.apply(this,arguments)}function f(){return(f=Object(n.a)(regeneratorRuntime.mark((function e(t,r){var n,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.callback,e.next=3,t.feature.getCopyPaste();case 3:(s=e.sent).syncMobileClipboard((function(e){var r={},u=0,l=s.copyPasteCache.getCacheState().clipboardCopyData;parseInt(l.timeStamp,10)>u&&(u=parseInt(l.timeStamp,10),r=l);var c=Object(o.d)();if(parseInt(c.timeStamp,10)>u){u=parseInt(c.timeStamp,10),r=c;try{i.b.tdwReport({module:"excel_picture",opername:"doc_excel_editor",action:"mob_picture_menu_paste"})}catch(m){}}if(e.timeStamp>u&&(u=e.timeStamp,r=e),a.a.isCopyInEnv()){var d=a.a.getServerCopyData();d.timeStamp>u&&d.plain!==r.plain&&(r=d)}var f=t.view.getSelection(),h={xRange:[f.rangeSelections[0].startColIndex,f.rangeSelections[0].endColIndex],yRange:[f.rangeSelections[0].startRowIndex,f.rangeSelections[0].endRowIndex]};s.doClipboardPaste({html:r.html||"",plain:r.plain||""},h),r.plain&&n(r.plain)}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e,t){return m.apply(this,arguments)}function m(){return(m=Object(n.a)(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.feature.getCopyPaste();case 2:n=e.sent,window.self!==window.top?n.doCopy(r):n.syncMobileClipboard((function(){n.doCopy(r)}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}r.d(t,"a",(function(){return u.b}))},"./src/core/feature/copyPaste/clipboardCopy.ui.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"g",(function(){return v})),r.d(t,"b",(function(){return g})),r.d(t,"f",(function(){return A})),r.d(t,"c",(function(){return p})),r.d(t,"d",(function(){return m})),r.d(t,"h",(function(){return _})),r.d(t,"e",(function(){return b}));r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/core-js/modules/es.promise.finally.js");var n={};if("undefined"!==typeof document&&document.addEventListener){n={copy:function(){throw Error("Unable to copy. Perhaps it's not available in your browser?")},paste:function(){throw Error("Unable to paste. Perhaps it's not available in your browser?")}};try{n.copy=function(){function e(){t=!1,r=null,n&&window.getSelection().removeAllRanges(),n=!1}var t=!1,r=null,n=!1,o=!1;return function(a){return o||(document.addEventListener("copy",(function(e){if(t){for(var n in r)try{e.clipboardData.setData(n,r[n])}catch(n){console.error(n)}e.preventDefault()}})),o=!0),new Promise((function(o,s){t=!0,r="string"===typeof a?{"text/plain":a}:a instanceof Node?{"text/html":(new XMLSerializer).serializeToString(a)}:a;try{var i=document.getSelection();if(!document.queryCommandEnabled("copy")&&i.isCollapsed){var u=document.createRange();u.selectNodeContents(document.body),i.addRange(u),n=!0}if(!document.execCommand("copy"))throw Error("Unable to copy. Perhaps it's not available in your browser?");e(),o()}catch(l){e(),s(l)}}))}}(),n.paste=function(){var e,t,r=!1,n=!1;return function(o){return n||(document.addEventListener("paste",(function(n){if(r){r=!1,n.preventDefault();var o=e;e=null,o(n.clipboardData.getData(t))}})),n=!0),new Promise((function(n,a){r=!0,e=n,t=o||"text/plain";try{document.execCommand("paste")||(r=!1,a(Error("Unable to paste. Pasting only works in Internet Explorer at the moment.")))}catch(s){r=!1,a(Error(s))}}))}}(),"undefined"===typeof ClipboardEvent&&"undefined"!==typeof window.clipboardData&&"undefined"!==typeof window.clipboardData.setData&&(n.copy=function(e){return new Promise((function(t,r){if("string"!==typeof e&&!("text/plain"in e))throw Error("You must provide a text/plain type.");window.clipboardData.setData("Text","string"===typeof e?e:e["text/plain"])?t():r(Error("Copying was rejected."))}))},n.paste=function(){return new Promise((function(e,t){var r=window.clipboardData.getData("Text");r?e(r):t(Error("Pasting was rejected."))}))})}catch(E){console.error(E)}}else n={copy:function(){throw Error("Unable to copy. Perhaps it's not available in your browser?")},paste:function(){throw Error("Unable to paste. Perhaps it's not available in your browser?")}};var o,a=n,s=r("./src/core/feature/copyPaste/interfaces.ts"),i=r("../node_modules/@tencent/clipboard/index.js"),u=r("./src/core/feature/copyPaste/wxCopyPaste.ui.ts"),l=r("./src/base/util/timer.ts"),c=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),d=r.n(c),f={html:null,plain:null,json:null,timeStamp:0},h=function(){f={html:null,plain:null,json:null,timeStamp:0}},m=function(){return f},p=function(){return o},v=function(e,t,r,n){(f={html:e,plain:t,json:r}).timeStamp=Date.now(),function(e){o=e}(n)},g=function(e){var t=e.copyContent,r=e.type,n=t.html,o=t.plain,s=t.json,i=void 0===s?"":s;if(u.a.isCopyOutEnv())return u.a.copyToSystem(o),void v(n,o,i,r);try{a.copy({"text/plain":o,"text/html":n,"text/json":i}).catch((function(e){console.error(e)})).then((function(){window.mqq&&"0"!==window.mqq.clientVersion&&l.a.wait(0).run((function(){n&&n.length>492426&&console.warn("\u5b89\u5353\u624bQ\u53ef\u80fd\u5199\u5165\u5bcc\u6587\u672c\u526a\u8d34\u677f\u5931\u8d25"),window.mqq.invoke("docx","writeSystemClipboard",{plain:o,html:n})})),v(n,o,i,r)}))}catch(E){}},y={html:"",plain:"",timeStamp:0},_=function(e){var t=window.mqq;t&&"0"!==t.clientVersion&&!d.a.isQQMiniProgram?Object(i.readInClipBoard)().then((function(e){var t=e.html,r=void 0===t?"":t,n=e.plain,o=void 0===n?"":n;r===y.html&&o===y.plain||(y.html=r,y.plain=o,y.timeStamp=Date.now())})).catch((function(e){console.error(e)})).finally((function(){null===e||void 0===e||e(y)})):null===e||void 0===e||e(y)};try{window.mqq.addEventListener("qbrowserVisibilityChange",(function(e){e.hidden||_()}))}catch(E){}var b=function(){return!(!y.html&&!y.plain||!y.timeStamp)},A=function(e,t,r){return!((null===r||void 0===r?void 0:r.length)>0)&&(!e&&!t||!function(e,t,r){return!e&&!r&&t&&p()===s.a.input&&t===m().plain}(e,t,r)&&function(e,t,r){return f.html&&e&&-1!==e.indexOf(f.html)||f.plain&&f.plain.length>0&&t===f.plain&&void 0!==f.html}(e,t))}},"./src/core/feature/copyPaste/convertor/convertParsedTableData2PasteData.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return ae}));r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.array.reduce.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.string.link.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/regenerator-runtime/runtime.js");var n=r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),o=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=r("./src/core/feature/copyPaste/middleware/factory.ts"),s=r("./src/core/feature/copyPaste/middleware/interface.ts"),i=(r("../node_modules/core-js/modules/es.array.every.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.array.splice.js"),r("../node_modules/core-js/modules/es.number.constructor.js"),r("../node_modules/core-js/modules/es.number.is-nan.js"),r("../node_modules/core-js/modules/es.object.assign.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/core-js/modules/es.regexp.constructor.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/core-js/modules/es.string.bold.js"),r("../node_modules/core-js/modules/es.string.fontcolor.js"),r("../node_modules/core-js/modules/es.string.fontsize.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js")),u=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),l=r("../packages/model/src/dimension/DimensionProperties.ts"),c=r("../packages/model/src/cell/ExtendedValueType.ts"),d=r("../packages/model/src/cell/CellData.ts"),f=r("../node_modules/@tencent/tdocs-format-render/lib/index.js"),h=r("../packages/model/src/cell/format/HorizontalAlign.ts"),m=r("../packages/model/src/cell/format/VerticalAlign.ts"),p=r("../packages/model/src/cell/format/WrapStrategy.ts"),v=r("../packages/model/src/cell/format/UnderlineType.ts"),g=r("./src/core/feature/formula/autofix.ts"),y=r("./src/core/feature/copyPaste/interfaces.ts"),_=r("../packages/model/src/utils/numberFormat/FormatParseEngine.ts"),b=r("../packages/model/src/config/index.ts"),A=r("../packages/model/src/utils/numberFormat/ParsedValueType.ts"),E=r("./src/base/util/url.ts"),j=r("../node_modules/util/util.js"),R=r("../node_modules/@tencent/tencent-doc-report/lib/index.browser.js"),S=r("../packages/report/src/index.ts"),C=r("../packages/model/src/factory/index.ts");function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?T(Object(r),!0).forEach((function(t){Object(o.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var O=function(e,t){return e===t||"object"===Object(u.a)(e)&&null!=e&&"object"===Object(u.a)(t)&&null!=t&&function(e,t){if(Object.keys(e).length!=Object.keys(t).length)return!1;for(var r in e){if(!Object.prototype.hasOwnProperty.call(t,r))return!1;if(!O(e[r],t[r]))return!1}return!0}(e,t)};function I(e){if(!e||e.length<=1)return e;for(var t,r,n=0;n<e.length-1;)t=e[n],r=e[n+1],O(t.format,r.format)?e.splice(n+1,1):n+=1;return e}function N(e){switch(e){case b.DEFAULT_CELL_FORMAT_LITERAL.fontFamily:case"microsoft yahei":case"\u5fae\u8f6f\u96c5\u9ed1":return null;default:return e}}function k(e){switch(e){case b.DEFAULT_CELL_FORMAT_LITERAL.fontSize:return null;default:return e}}function M(e){switch(e){case b.DEFAULT_CELL_FORMAT_LITERAL.color:return null;default:return e}}function D(e){switch(e){case b.DEFAULT_CELL_FORMAT_LITERAL.backgroundColor:return null;default:return e}}function x(e,t,r){var n,o=t&&!Number.isNaN(Number(t));switch(n=!!(r&&r.pattern!==f.DEFAULT_FORMAT_PATTERN||o),e){case"left":return n?h.a.LEFT:null;case"center":return h.a.CENTER;case"right":return o&&null===r?null:h.a.RIGHT;default:return null}}function F(e){switch(e){case"middle":return null;case"top":return m.a.TOP;case"bottom":return m.a.BOTTOM;default:return null}}function P(e){switch(e){case b.DEFAULT_CELL_FORMAT_LITERAL.underline:return null;case"underline":return v.a.SINGLE_LINE;default:return null}}function L(e){switch(e){case b.DEFAULT_CELL_FORMAT_LITERAL.wrapStrategy:return null;case"normal":return p.a.WRAP;default:return null}}function U(e){if(!e)return null;var t=e.colors,r=e.styles;if((!t||t.every((function(e){return null===e})))&&(!r||r.every((function(e){return null===e}))))return null;var n=null===t[0]||null===r[0]?null:C.BorderFactory.createInstance({style:r[0],color:t[0]}),o=null===t[1]||null===r[1]?null:C.BorderFactory.createInstance({style:r[1],color:t[1]}),a=null===t[2]||null===r[2]?null:C.BorderFactory.createInstance({style:r[2],color:t[2]}),s=null===t[3]||null===r[3]?null:C.BorderFactory.createInstance({style:r[3],color:t[3]});return C.BordersFactory.createInstance({top:n,right:o,bottom:a,left:s})}function B(e){var t=e.fontfamily,r=e.fontsize,n=e.fontcolor,o=e.bold,a=e.italic,s=e.underline,i=e.strikeline;return C.TextFormatFactory.createInstance({color:n||(null===e||void 0===e?void 0:e.color),fontFamily:t,fontSize:r?parseInt(r,10):null,bold:"bold"===o||!0===o||null,italic:"italic"===a||!0===a||null,strikethrough:"strikeline"===i||!0===i||null,underline:P(s)})}function H(e,t,r,n){var o,a=n.link,s=null,i=null;if(null===a||void 0===a||null===(o=a[r])||void 0===o?void 0:o[t]){var u=a[r][t];u&&(s=u.linkurl,i=u.linkType,Object(E.b)(u.linkurl)&&(i=Object(E.b)(u.linkurl)))}return{hyperlink:s,hyperlinkType:i}}var G=new RegExp(/%022/);function V(e){var t,r,n,o={color:M(e.fontcolor),fontFamily:N(e.fontfamily),fontSize:e.fontsize?k(parseInt(e.fontsize,10)):null,bold:"bold"===e.bold||null,italic:"italic"===e.italic||null,strikethrough:"strikeline"===e.strikeline||null,underline:P(e.underline)},a=I(e.textFormatRuns);a&&1===a.length&&(null===(t=a[0])||void 0===t?void 0:t.format)&&(r=o,n=function(e){var t=e.fontfamily,r=e.fontsize,n=e.fontcolor,o=e.bold,a=e.italic,s=e.underline,i=e.strikeline;return{color:n,fontFamily:t,fontSize:r?parseInt(r,10):null,bold:"bold"===o||null,italic:"italic"===a||null,strikethrough:"strikeline"===i||null,underline:P(s)}}(a[0].format),o={color:Object(j.isNullOrUndefined)(r.color)?n.color:r.color,fontFamily:Object(j.isNullOrUndefined)(n.fontFamily)?r.fontFamily:n.fontFamily,fontSize:Object(j.isNullOrUndefined)(n.fontSize)?r.fontSize:n.fontSize,bold:Object(j.isNullOrUndefined)(n.bold)?r.bold:n.bold,italic:Object(j.isNullOrUndefined)(n.italic)?r.italic:n.italic,strikethrough:Object(j.isNullOrUndefined)(n.strikethrough)?r.strikethrough:n.strikethrough,underline:Object(j.isNullOrUndefined)(n.underline)?r.underline:n.underline},a=[]);return["color","fontFamily","fontSize","bold","italic","strikethrough","underline"].every((function(e){return null===o[e]}))?null:C.TextFormatFactory.createInstance(o)}function W(e,t,r,n){var o,a=n.styles,s=(null===a||void 0===a?void 0:a[r])&&a[r]&&a[r][t],i=null,u=null,l=null,c=null;if(s){var d,h;u=function(e,t){var r=e.format_data;r&&(r=unescape(r.replace(G,'"')));var n=r&&"General"!==r?f.NumberFormatFactory.createNumberFormat({pattern:r}):null,o=Object(_.parseValueWithStyle)(t,n,{parseMode:_.PARSE_MODE.CURRENT_STYLE_FIRST});return o=Object(_.twelveNumberToText)(o),(!n||n&&n.pattern===f.DEFAULT_FORMAT_PATTERN)&&o.numberFormat.pattern!==f.DEFAULT_FORMAT_PATTERN?o.numberFormat:n}(s,e),c=V(s);var m={numberFormat:u,backgroundColor:D(s.cellcolor),horizontalAlign:x(s.h_align,e,u),verticalAlign:F(s.v_align),wrapStrategy:L(s.textwrap),borders:U(s.border),textFormat:c,dataValidation:null===(d=n.dataValidations)||void 0===d||null===(h=d[r])||void 0===h?void 0:h[t]};!function(e,t){var r;null===(r=t.textFormatRuns)||void 0===r||r.forEach((function(t){var r=e.textFormat;Object.keys(r||{}).forEach((function(r){var n,o=r.toLocaleLowerCase();e.textFormat[r]&&"undefined"===typeof(null===(n=t.format)||void 0===n?void 0:n[r])&&t.format&&(t.format[o]=e.textFormat[r])}))}))}(m,s),i=C.CellFormatFactory.createInstance(m),l=(o=I(s.textFormatRuns))&&o.length?o.map((function(e){var t=e.format;return null===t?C.TextFormatRunFactory.createInstance({startIndex:e.startIndex}):C.TextFormatRunFactory.createInstance({startIndex:e.startIndex,format:B(t)})})):null}return{numberFormat:u,userEnteredFormat:i,textFormat:c,textFormatRuns:l}}function Y(e,t,r,n,o){var a=n.formula,s=o.numberFormat,i=Object(_.parseValueWithStyle)(e,s,{parseMode:_.PARSE_MODE.CURRENT_STYLE_FIRST});(i=Object(_.twelveNumberToText)(i)).valueType===A.a.FORMULA&&"string"===typeof i.value&&(a[r][t]=Object(g.a)(i.value,[],0));var u=Number(i.valueType),l=i.value;return""===i.value&&u==c.a.STRING?null:C.ExtendedValueFactory.createInstance({type:u,value:l,originValue:void 0===i.originValue||null===i.originValue?"":String(i.originValue)})}function z(e){return K.apply(this,arguments)}function K(){return(K=Object(n.a)(regeneratorRuntime.mark((function e(t){var r,n,o,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.effectiveValue,n=t.hyperlink,o=t.hyperlinkType,!n||!o){e.next=17;break}if(a=r,1!==o){e.next=5;break}return e.abrupt("return",{hyperlinkType:1,effectiveValue:a});case 5:return e.prev=5,e.next=8,Object(E.h)(n);case 8:return s=e.sent,r&&s&&(a=C.ExtendedValueFactory.createInstance(w(w({},r.getOptions()),{},{value:s.title}))),R.AlloyReport.monitor(35271164),S.b.tdwReport({opername:"link",module:"link_set",action:"link_tdocname_autoset"}),e.abrupt("return",{hyperlinkType:8===o&&1===s.docPolicy?11:o,effectiveValue:a});case 15:e.prev=15,e.t0=e.catch(5);case 17:return e.abrupt("return",{effectiveValue:r,hyperlinkType:o});case 18:case"end":return e.stop()}}),e,null,[[5,15]])})))).apply(this,arguments)}var q=new RegExp(/\ufeff/g),Q=new RegExp(/\s+$/);function X(e,t){var r=t.x,n=t.y;return a.a.getMiddleWaresByLevel(s.a.CELL_PROPS).filter((function(t){if(t.tdToCellData){var o,a,s=t.desc.tableProps;return null===(o=e[void 0===s?"":s])||void 0===o||null===(a=o[n])||void 0===a?void 0:a[r]}return!1}))}function J(e){var t={};return a.a.getMiddleWaresByLevel(s.a.CELL_PROPS).forEach((function(r){var n=r.desc.tableProps;n&&(t[n]=e[n])})),t}function $(e,t,r,n){return Z.apply(this,arguments)}function Z(){return(Z=Object(n.a)(regeneratorRuntime.mark((function e(t,r,n,o){var u,l,c,f,h,m,p,v,g,y,_,b,A,E,j,R,S,C,T,w,O;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"string"===typeof t&&(t=(t=t.replace(q,"")).replace(Q,"")),f=o.cellSelect,h=H(0,r,n,o),m=h.hyperlink,(null===(u=o.link[n])||void 0===u||null===(l=u[r])||void 0===l?void 0:l.hyperlinkRuns)&&(m=null),p=h.hyperlinkType,v=W(t,r,n,o),g=v.numberFormat,y=v.userEnteredFormat,_=v.textFormatRuns,e.next=9,Y(t,r,n,o,{numberFormat:g});case 9:return b=e.sent,e.next=12,z({effectiveValue:b,hyperlink:m,hyperlinkType:p});case 12:if(A=e.sent,!(b||m||y&&0!==y.setSlots||_||X(o,{x:r,y:n})||(null===(c=f[n])||void 0===c?void 0:c[r]))){e.next=22;break}if(T={effectiveValue:A.effectiveValue,hyperlink:m,hyperlinkType:A.hyperlinkType,userEnteredFormat:y&&0!==y.setSlots?y:null,textFormatRuns:_,linkIconStatus:null===(E=o.link[n])||void 0===E||null===(j=E[r])||void 0===j?void 0:j.linkIconStatus,hyperlinkRuns:null===(R=o.link[n])||void 0===R||null===(S=R[r])||void 0===S?void 0:S.hyperlinkRuns},a.a.getMiddleWaresByLevel(s.a.CELL_PROPS).forEach((function(e){var t;(null===(t=e.tdToCellData)||void 0===t?void 0:t.isActive(o,{x:r,y:n},{effectiveValue:b}))&&(T=e.tdToCellData.fn(T))})),!(null===(C=f[n])||void 0===C?void 0:C[r])){e.next=21;break}if((O=f[n][r]).value){e.next=20;break}return e.abrupt("return",null);case 20:T=Object.assign(T,{metadata:O.value,refIds:Object(i.a)(null===(w=O.refId)||void 0===w?void 0:w.split(","))});case 21:return e.abrupt("return",new d.a(T));case 22:return e.abrupt("return",null);case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ee(){return(ee=Object(n.a)(regeneratorRuntime.mark((function e(t){var r,o,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.changes,o=t.formula,e.next=4,Promise.all(r.map(function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(r,n){var o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(r.map((function(e,r){return $(e,r,n,t)})));case 2:return o=e.sent,a={values:o},e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()));case 4:return a=e.sent,o=o.map((function(e,r){return e.map((function(e,n){return t.submerge[r][n]?"":e}))})),s=w({isSingle:!1,isMerge:!1,merge:t.merge,rowDataUpdate:a,formula:o,fromType:y.d.OUTER,fromApp:y.e.unknown,select:{selectAll:t.from.selectAll,selectCol:t.from.selectCol,selectRow:t.from.selectRow},containTable:!1},J(t)),t.rowsHeight&&(s.rowsDimensionProperties=t.rowsHeight.map((function(e,r){var n;return l.a.newInstance({pixelSize:e,hiddenByUser:null===(n=t.hiddenRows)||void 0===n?void 0:n[r]})}))),t.colsWidth&&(s.colsDimensionProperties=t.colsWidth.map((function(e,r){var n;return l.a.newInstance({pixelSize:e,hiddenByUser:null===(n=t.hiddenCols)||void 0===n?void 0:n[r]})}))),e.abrupt("return",s);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var te=function(e){return ee.apply(this,arguments)};function re(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var ne=function(e){e.link&&(e.link=e.link.map((function(e){return e.map((function(e){var t=(e||{link:!1}).link;if(t){var r=t.url,n=t.value,a=t.type;return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?re(Object(r),!0).forEach((function(t){Object(o.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):re(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({linkurl:r,linkvalue:n,linkType:a&&parseInt(a,10)||void 0,minType:"link"},t)}}))})))},oe=function(e){var t=function(e){var t={};t.changes=(null===e||void 0===e?void 0:e.data)?e.data:[[]],t.styles=(null===e||void 0===e?void 0:e.styles)?e.styles:null,t.link=(null===e||void 0===e?void 0:e.template)?e.template:null,t.rowsHeight=(null===e||void 0===e?void 0:e.size)&&e.size.rowHeights?e.size.rowHeights:null,t.colsWidth=(null===e||void 0===e?void 0:e.size)&&e.size.colWidths?e.size.colWidths:null;var r=(null===e||void 0===e?void 0:e.selectType)?e.selectType:null;return t.hiddenRows=(null===e||void 0===e?void 0:e.hiddenRowCol)&&e.hiddenRowCol.hiddenRows&&e.hiddenRowCol.hiddenRows.length>0?e.hiddenRowCol.hiddenRows:[],t.hiddenCols=(null===e||void 0===e?void 0:e.hiddenRowCol)&&e.hiddenRowCol.hiddenCols&&e.hiddenRowCol.hiddenCols.length>0?e.hiddenRowCol.hiddenCols:[],{pasteDataTemp:t,selectType:r}}(e),r=t.pasteDataTemp,n=t.selectType;ne(r);var o=(null===e||void 0===e?void 0:e.mergeCells)?e.mergeCells:[];r.formula=(null===e||void 0===e?void 0:e.formula)?e.formula:[[]],r.cellSelect=(null===e||void 0===e?void 0:e.cellSelect)?e.cellSelect:[[]],r.mClasses=null,r.isMaintaining=!0,r.dataValidations=(null===e||void 0===e?void 0:e.dataValidations)||[[]],a.a.getAllMiddleWares({level:s.a.CELL_PROPS,tableProps:!0}).forEach((function(t){var n=t.desc.tableProps,o=void 0===n?"":n;r[o]=(null===e||void 0===e?void 0:e[o])?null===e||void 0===e?void 0:e[o]:[[]]}));var i=(null===e||void 0===e?void 0:e.data[0])?e.data[0].length-1:0,u=e?e.data.length-1:0;r.from={xRange:[0,i],yRange:[0,u],xDiff:i,yDiff:u,selectAll:"all"===n,selectRow:"row"===n,selectCol:"col"===n};var l=function(e){return e.reduce((function(e,t){var r=t.row,n=t.col,o=t.rowspan,a=t.colspan;return e["".concat(r,"-").concat(n)]={merge:!0,w:a,h:o},e}),{})}(o),c=function(e){return e.reduce((function(e,t){for(var r=t.row,n=t.col,o=t.rowspan,a=t.colspan,s=r;s<=r+o-1;s++)for(var i=n;i<=n+a-1;i++)e["".concat(s,"-").concat(i)]={merged:!0,parentIndexX:n,parentIndexY:r};return e}),{})}(o);return function(e,t){e.styles=e.styles.map((function(r,n){return r.map((function(r,o){var a=t["".concat(n,"-").concat(o)];if(a){var s=a.parentIndexX,i=a.parentIndexY;(null===e||void 0===e?void 0:e.styles)&&e.styles[i]&&e.styles[i][s]&&e.styles[i][s].border&&(r||(r={}),r.border=e.styles[i][s].border)}return r}))}))}(r,c),function(e,t,r){e.merge=e.changes.map((function(e,r){return e.map((function(e,n){var o=t["".concat(r,"-").concat(n)];if(o){var a=o.w,s=o.h;if(a&&s)return{w:a,h:s}}return!1}))})),e.submerge=e.changes.map((function(e,t){return e.map((function(e,n){var o=r["".concat(t,"-").concat(n)];return!(!o||(null===o||void 0===o?void 0:o.parentIndexX)===n&&(null===o||void 0===o?void 0:o.parentIndexY)===t)}))}))}(r,l,c),r},ae=function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=oe(t),e.next=3,te(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},"./src/core/feature/copyPaste/convertor/convertShapeData2IAddImage.ts":function(e,t,r){"use strict";r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return a})),r.d(t,"a",(function(){return s}));r("../node_modules/core-js/modules/es.string.anchor.js");var n=r("../packages/model/src/embedded/index.ts");function o(e,t){var r=e.id,o=e.size,a=o.width,s=o.height,i=e.offset,u=i.x,l=i.y,c=e.url,d=e.clipInfo,f=0,h=0,m=e.anchor;m?(f=m.col,h=m.row):(f=0,h=0);return{type:n.EMBEDDED_OBJECT_TYPE.IMAGE,id:r,url:c,width:a,height:s,sheetId:t,x:f,y:h,offsetX:u,offsetY:l,zIndex:0,clipInfo:d}}function a(e,t){var r=e.id,n=e.size,o=n.width,a=n.height,s=e.url,i=e.clipInfo,u=0,l=0,c=e.anchor;c?(u=c.col,l=c.row):(u=0,l=0);return{id:r,sheetId:t,url:s,width:o,height:a,x:u,y:l,clipInfo:i}}function s(e){var t=e.id,r=e.position.overlayPosition,n=r.offsetXpixels,o=r.offsetYpixels,a=r.widthPixels,s=r.heightPixels,i=e.url,u=e.clipInfo;return{id:t,url:i,offset:{x:n,y:o},size:{width:a,height:s},clipInfo:{clipBottom:u.clipBottom,clipLeft:u.clipLeft,clipRight:u.clipRight,clipTop:u.clipTop}}}},"./src/core/feature/copyPaste/copyPaste2.ui.ts":function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"CANPASTETYPE",(function(){return te})),r.d(t,"addEvent",(function(){return ie})),r.d(t,"addImage",(function(){return ue})),r.d(t,"mapFromApp",(function(){return le})),r.d(t,"ICopyPaste",(function(){return de}));r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.symbol.description.js"),r("../node_modules/core-js/modules/es.symbol.iterator.js"),r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.from.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/es.array.last-index-of.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.function.name.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/core-js/modules/es.regexp.constructor.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/es.string.match.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/core-js/modules/es.string.anchor.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/regenerator-runtime/runtime.js");var n=r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),i=r("../packages/common-utils/src/url.ts"),u=r("./src/core/app/SpreadsheetApp.interface.ts"),l=r("../node_modules/@tencent/clipboard/index.js"),c=r("./src/core/feature/copyPaste/lib/ParsePasteHTML.ts"),d=r("../packages/services/src/instantiation.ts"),f=r("../node_modules/@tencent/dui/lib/components/Loading/index.js"),h=r.n(f),m=r("./src/core/feature/copyPaste/clipboardCopy.ui.ts"),p=r("./src/core/feature/copyPaste/lib/PasteSpecial/index.ui.ts"),v=r("../packages/model/src/cell/CellData.ts"),g=r("../packages/model/src/cell/ExtendedValueType.ts"),y=r("./src/core/feature/copyPaste/interfaces.ts"),_=r("./src/core/feature/copyPaste/copyPasteShape.ts"),b=r("./src/core/feature/copyPaste/copyPasteCache.ts"),A=r("../packages/model/src/cell/CellDataSlot.ts"),E=r("./src/core/feature/copyPaste/lib/tips.ui.ts"),j=r("./src/core/feature/copyPaste/lib/smartSplit/SmartSplit.ts"),R=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),S=r.n(R),C=r("./src/core/feature/copyPaste/wxCopyPaste.ui.ts"),T=r("../packages/model/src/range/gridRangeUtils.ts"),w=r("./src/core/feature/copyPaste/copyPasteUI.ui.tsx"),O=r("./src/base/util/timer.ts"),I=r("./src/core/ui/toast/index.ts"),N=r("./src/core/ui/dialog/index.ts"),k=r("../packages/report/src/index.ts"),M=r("./src/base/config/report.ts"),D=r("./src/core/feature/copyPaste/lib/parsers/automaticIdentifyLink.ts"),x=r("./src/core/feature/copyPaste/lib/parsers/parseCopyImgs.ts"),F=r("./src/core/feature/copyPaste/utils/mergeRangeUtils.ts"),P=r("./src/core/feature/copyPaste/convertor/convertParsedTableData2PasteData.ts"),L=r("./src/core/feature/copyPaste/lib/parsers/parseHTMLIsSingleImg.ts"),U=r("./src/core/utils/selection.ts"),B=r("./src/base/util/url.ts"),H=r("./src/core/feature/copyPaste/iconSource.tsx"),G=r("../packages/model/src/factory/index.ts"),V=r("../packages/model/src/range/index.ts"),W=r("./src/core/ui/loading/index.ts"),Y=r("./src/core/feature/copyPaste/utils/url.ts"),z=r("./src/core/view/level-2/shape-upload/ShapeUpload.ts"),K=r("./src/core/feature/copyPaste/utils/rangeAuthCheckUtil.ts"),q=r("./src/core/feature/copyPaste/middleware/factory.ts"),Q=r("./src/core/feature/copyPaste/middleware/interface.ts");function X(e,t){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"===typeof e)return J(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return J(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){i=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(i)throw a}}}}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Z,ee,te,re=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(s.a)(Reflect))&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},ne=function(e,t){return function(r,n){t(r,n,e)}},oe=c.a.getSingleton();!function(e){e.TEXT="text/plain",e.HTML="text/html",e.IMAGE="image/png"}(ee||(ee={})),function(e){e[e.NONE=1]="NONE",e[e.CACHE=2]="CACHE",e[e.CLIPBOARD=3]="CLIPBOARD"}(te||(te={}));var ae=0|1<<A.b.SLOT_EFFIECTIVE_VALUE|1<<A.b.SLOT_HYPERLINK|1<<A.b.SLOT_USER_ENTERED_FORMAT_DELTA|1<<A.b.SLOT_FORMULA|1<<A.b.SLOT_RICH_TEXT_STYLE_RUN,se={html:"",plain:"",timeStamp:"0"};function ie(t,r,n){t.addEventListener?t.addEventListener(r,n,!1):t.attachEvent&&t.attachEvent("on".concat(r),(function(){n(e.event)}))}function ue(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.SpreadsheetApp;return n.requestApi.addImage(t,r)}function le(e){switch(e){case"excel":return y.e.excel;case"tencent":return y.e.tencent;default:return y.e.unknown}}var ce=function(){function t(e,r){var a=this;Object(o.a)(this,t),this.hotInstance=r,this.destroy=function(){Object(m.a)()},this.clipboardCopy=function(e,t){var r=e.plain,n=e.html,o=e.json,a=void 0===o?"":o;Object(l.writeInClipBoard)({copyContent:{plain:r,html:n,json:a}}).then((function(){Object(m.g)(n,r,a,t)})).catch((function(e){console.error(e)}))},this.processClipBoardContent=function(e){var t;-1!==navigator.userAgent.indexOf("Safari")&&-1===navigator.userAgent.indexOf("Chrome")&&(""===(t=e.split("\n"))[t.length-1]&&t.pop(),e=t.join("\n")),t=e.split("\n");for(var r=0;r<t.length-1;r++){var n=t[r].length;13===t[r].slice(n-1).charCodeAt()&&(t[r]=t[r].slice(0,n-1))}return e=t.join("\n")},this.getPasteTypeForTencentDoc=function(){var e=a.copyPasteCache.getCacheState(),t=e.valid,r=!1,n=external.getClipboardType();if(n&&n.length>0&&(r=!0),!r)return e.valid=!1,te.NONE;if(t){var o=e.clipboardCopyData.html;return-1===n.indexOf(ee.HTML)?te.CLIPBOARD:o===external.getClipboardData(ee.HTML)?te.CACHE:te.CLIPBOARD}return te.CLIPBOARD},this.PasteFromOuterInIE=function(e){var t=window.ActiveXObject||"ActiveXObject"in window;"".concat(e,";").concat(t),e&&t&&localStorage&&null==localStorage.getItem("ctrl_V_key_pasteTip")&&(localStorage.setItem("ctrl_V_key_pasteTip","true"),Object(I.hideToast)(),Object(I.showToast)("\u7531\u4e8eIE\u6d4f\u89c8\u5668\u9650\u5236\uff0c\u53ea\u80fd\u7c98\u8d34\u7eaf\u6587\u5b57\uff0c\u4e0d\u652f\u6301\u7c98\u8d34\u683c\u5f0f\u3002\u5efa\u8bae\u4f7f\u7528Chrome\u6216QQ\u6d4f\u89c8\u5668\u3002",void 0,{isNeedBtn:!0,btnText:"\u6211\u77e5\u9053\u4e86",btnTextAfter:"",btnCallBack:function(){Object(I.hideToast)()}}))},this.getActiveCellPosition=function(e){var t=e.view.getSelection().activeCell;return{row:t.rowIndex,col:t.colIndex}},this.unmountLoading=function(e,t){t.hide();var r=e.spreadsheet.getActiveSheetId(),n=t.getPositionInfo(),o=n.row,a=n.col;W.b.removeInstance(o,a,r)},this.closeLoadingView=function(e,t,r){t&&(r?O.a.wait(1e3).run((function(){a.unmountLoading(e,t)})):a.unmountLoading(e,t))},this.isShapePasteFromOuter=function(e,t){return!e&&t&&t.clipboardData&&t.clipboardData.getData("text/json")},this.isImgPasteFromOuter=function(e,t){return!e&&t&&t.length>=1},this.isRichTextFromOuter=function(e,t){return!e&&t&&t.length>0},this.isTextFromOuter=function(e,t){return!e&&t},this.pasteFromOuter=function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(t,r,n,o,s,i,u){var l,c,d,f,h,m,p,v,g,_,b,A,E,R,S,C,T,w;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=a.hotInstance.spreadsheet.activeSheetId,c=a.copyPasteShape,d=!1,f=!1,a.isShapePasteFromOuter(d,t)&&(d=!0,h=t.clipboardData.getData("text/json"),h=JSON.parse(h),c.onParse(h,"json")),a.isImgPasteFromOuter(d,r)&&(d=!0,c.onParse(r,"files")),!a.isRichTextFromOuter(d,n)){e.next=48;break}if(!((null===(m=oe.parseHTML(n))||void 0===m?void 0:m.table)&&m.table.data.length>0)){e.next=47;break}return a.pasteBegin(n),d=!0,e.next=13,Object(P.a)(m.table);case 13:(p=e.sent).images=m.images,p.containTable=m.containTable,p.fromOuterContentType=y.c.richText,m.fromApp&&(p.fromApp=le(m.fromApp)),g=!1,(v=!1)&&(g=Object(j.f)(a.hotInstance,!0)),_=q.a.getAllMiddleWares({level:Q.a.CELL_PROPS}),b=X(_),e.prev=23,b.s();case 25:if((A=b.n()).done){e.next=32;break}if(!(E=A.value).beforePaste){e.next=30;break}return e.next=30,E.beforePaste(p,a.copyPasteShape.handleOuterImg.bind(a.copyPasteShape));case 30:e.next=25;break;case 32:e.next=37;break;case 34:e.prev=34,e.t0=e.catch(23),b.e(e.t0);case 37:return e.prev=37,b.f(),e.finish(37);case 40:R=Object(K.a)(p,a.hotInstance,s),S=R.rowsDimensionArr,C=R.colsDimensionArr,p.rowsDimensionProperties=S,p.colsDimensionProperties=C,f=a.doPaste({activeSheetId:l,pasteData:p,pasteHtmlString:n,selectAreaCellRange:s}),a.pasteFinish(v,o,g),e.next=48;break;case 47:(null===m||void 0===m?void 0:m.images)&&(d=!0,m.images.forEach((function(e){delete e.anchor,c.addShape(e)})));case 48:if(!a.isTextFromOuter(d,o)){e.next=56;break}return d=!0,w=!1,(T=!1)&&(w=Object(j.f)(a.hotInstance,!0)),e.next=55,a.automaticIdentifyLink.call(a,o);case 55:T&&Object(j.b)(o,a.hotInstance,w);case 56:return a.copyPasteCache.cancelCopy(),a.closeLoadingView(a.hotInstance,i,u),e.abrupt("return",d&&f);case 60:case"end":return e.stop()}}),e,null,[[23,34,37,40]])})));return function(t,r,n,o,a,s,i){return e.apply(this,arguments)}}(),this.showPasteloading=function(e,t,r){var n=new Date;return e&&e.length>15e3||n.getTime()-t.getTime()>20||r||Object(Y.a)(e)||a.hasHyperLinkType(e)},this.getPasteErrorMsgContent=function(e,t,r){var n="";return 0!==e.length?n=-1!=t.indexOf("urn:schemas-microsoft-com:office:office")?-1!=t.indexOf("urn:schemas-microsoft-com:office:excel")?e&&e.length<=5?Object(w.a)("copy",r):Object(w.a)("import",r):Object(w.a)("copy",r):Object(w.a)("save",r):-1!=t.indexOf("<img")&&-1!=t.indexOf('src="blob:')&&(n=Object(w.a)("save",r)),n},this.processClipBoardHtml=function(e,t,r){var n,o=null===(n=e.clipboardData)||void 0===n?void 0:n.getData("text/link-preview");if(S.a.isChromiumEdge&&o&&"text/html;content=titled-hyperlink"===JSON.parse(o).preferred_format)return"";var a=oe.getParsedDocument(t).body,s=a.childElementCount,i=a.firstElementChild;if(1===s&&i&&"a"===i.tagName.toLowerCase()){var u=i.getAttribute("href"),l=i.textContent;if(r===u&&r!==l)return""}return t},this.textarea=e||this.hotInstance.view.canvas.inputManager.alloyRTE.input,this.enablePlugin(),this.copyPasteShape=new _.a(this.hotInstance,ue),this.copyPasteCache=new b.default({spreadsheetApp:this.hotInstance,config:{setSlots:ae,tile:!0}}),C.a.isCopyInEnv()&&C.a.init(),this.destroy(),this.iconsList=(new H.a).iconsList}return Object(a.a)(t,[{key:"closePasteSpecial",value:function(){Object(p.a)()}},{key:"enablePlugin",value:function(){this.registerEvents()}},{key:"registerEvents",value:function(){var e=this;ie(this.textarea,"paste",(function(t){return e.onPaste(t)})),ie(this.textarea,"cut",(function(t){return e.onCut(t)})),ie(this.textarea,"copy",(function(t){return e.onCopy(t)}))}},{key:"getCacheData",value:function(){return this.copyPasteCache.getCacheData()}},{key:"onCopy",value:function(e){this.hotInstance.view.canvas.inputManager.isInputtingState()||e.preventDefault()}},{key:"onCut",value:function(e){this.hotInstance.view.canvas.inputManager.isInputtingState()||e.preventDefault()}},{key:"isPasteInvalid",value:function(){var e=this.hotInstance,t=e.view.getSelection();return!!this.hotInstance.view.canvas.inputManager.isInputtingState()||(!e.sheetStatus.canEdit||1!==t.rangeSelections.length)}},{key:"onPaste",value:function(t){var r;k.b.run(M.CONFIG.COPY_PASTE),k.b.tdwReport({module:"cut_copy_paste",opername:"doc_excel_editor",action:"cut_copy_paste_paste_click",ver10:"quick_click"});var n=this.hotInstance;if(!this.isPasteInvalid()&&!n.view.canvas.inputManager.isInputtingState()){var o=n.view.getSelection(),a={xRange:[o.rangeSelections[0].startColIndex,o.rangeSelections[0].endColIndex],yRange:[o.rangeSelections[0].startRowIndex,o.rangeSelections[0].endRowIndex]};(null===t||void 0===t?void 0:t.preventDefault)&&t.preventDefault();var s="";t&&"undefined"!==typeof t.clipboardData?s=t.clipboardData.getData("text/plain"):"undefined"===typeof ClipboardEvent&&"undefined"!==typeof e.clipboardData&&(s=e.clipboardData.getData("Text"));var i=null===(r=t.clipboardData)||void 0===r?void 0:r.getData("text/html");i=this.processClipBoardHtml(t,i,s),s=this.processClipBoardContent(s);try{Object(m.c)()===y.a.shapes&&k.b.tdwReport({module:"excel_picture",opername:"doc_excel_editor",action:"picture_menu_ctrl_v"})}catch(u){}this.doClipboardPaste({html:i,plain:s},a,t)}}},{key:"onPastePCClient",value:function(){var e=this.hotInstance.view.getSelection();if(!this.isPasteInvalid()){var t={xRange:[e.rangeSelections[0].startColIndex,e.rangeSelections[0].endColIndex],yRange:[e.rangeSelections[0].startRowIndex,e.rangeSelections[0].endRowIndex]},r="",n="",o=[],a=external.getClipboardData,s=external.getClipboardType();if(s.indexOf(ee.TEXT)>-1){if(r=a(ee.TEXT),-1!==navigator.userAgent.indexOf("Safari")&&-1===navigator.userAgent.indexOf("Chrome")){var i=r.lastIndexOf("\n");i>-1&&""===r.slice(i+1)&&(r=r.slice(0,i))}r=r.replace(/\r\n/g,"\n")}if(s.indexOf(ee.HTML)>-1&&(n=a(ee.HTML)),s.indexOf(ee.IMAGE)>-1){var u=a(ee.IMAGE);if(u){var l=u.type,c={type:l,getAsFile:function(){return new File([u],"fromOutImage".concat(l.replace(/[^/]+\/([^/]+)/,"$1")),{type:l,lastModified:Date.now()})}};o.push(c)}}var d={clipboardData:{items:o,getData:function(e){switch(e){case ee.TEXT:return a(ee.TEXT);case ee.HTML:return a(ee.HTML);case ee.IMAGE:return a(ee.IMAGE);default:return}}}};this.doClipboardPaste({html:n,plain:r},t,d)}}},{key:"getPasteType",value:function(){var e=this.copyPasteCache.getCacheState().valid,t=Object(m.c)();return S.a.isPCTencentDocsClient&&"function"===typeof external.getClipboardType?this.getPasteTypeForTencentDoc():t===y.a.table&&e||t===y.a.shapes||t===y.a.input?te.CACHE:te.NONE}},{key:"pasteBegin",value:function(e){Object(Y.a)(e)&&(Z=h.a.show({tip:"\u6b63\u5728\u7c98\u8d34\u5185\u5bb9\u4e2d..."}))}},{key:"showCellImgToast",value:function(){var e,t=null===(e=this.downLoadError)||void 0===e?void 0:e.fileSize;if(t)return-1===t?Object(I.showToast)("\u90e8\u5206\u56fe\u7247\u7c98\u8d34\u4e0d\u6210\u529f\uff0c\u8bf7\u91cd\u65b0\u8bd5\u8bd5",void 0,{btnText:"\u6211\u77e5\u9053\u4e86",toolToastCloseTime:5e3}):t>2*z.VIP_IMG_SIZE_LIMIT?Object(I.showToast)("\u90e8\u5206\u56fe\u7247\u8d85\u51fa20M\uff0c\u8bf7\u91cd\u65b0\u7c98\u8d34\u5408\u9002\u7684\u56fe\u7247",void 0,{btnText:"\u6211\u77e5\u9053\u4e86",toolToastCloseTime:5e3}):void Object(I.showVipToast)({errorCode:70002,fileSize:t})}},{key:"pasteFinish",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(t,r,n){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.downLoadError&&this.showCellImgToast(),null===(o=Z)||void 0===o||o.close(),t&&Object(j.b)(r,this.hotInstance,n);case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"pasteHandler",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(t,r,n,o,a,s,i,u){var l,c,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=this.copyPasteShape,c=Object(m.c)(),k.b.jank.log({moduleValue:"pasteHandle",actionValue:"analysis",detail:[{isFromOuter:t,preImages:null===n||void 0===n?void 0:n.length,pasteHtmlString:o.length,clipboardContents:a.length,hasImg:u}]}),e.prev=3,!t){e.next=6;break}return e.abrupt("return",this.pasteFromOuter(r,n,o,a,s,i,u));case 6:if(!c){e.next=19;break}if(!this.isImageTextPaste(c,o)){e.next=11;break}this.doImageTextPaste({type:c,pasteHtmlString:o,selectAreaCellRange:s}),e.next=17;break;case 11:if(c!==y.a.input){e.next=16;break}return e.next=14,this.automaticIdentifyLink.call(this,a);case 14:e.next=17;break;case 16:c===y.a.table?this.doPaste({activeSheetId:this.hotInstance.spreadsheet.activeSheetId,selectAreaCellRange:s}):c===y.a.shapes&&(d=Object(m.d)().json,d=JSON.parse(d),l.onParse(d,"json"));case 17:e.next=21;break;case 19:if(a){e.next=21;break}return e.abrupt("return",!1);case 21:return this.closeLoadingView(this.hotInstance,i,u),e.abrupt("return",!0);case 25:return e.prev=25,e.t0=e.catch(3),e.t0,i&&this.unmountLoading(this.hotInstance,i),e.abrupt("return",!1);case 30:case"end":return e.stop()}}),e,this,[[3,25]])})));return function(t,r,n,o,a,s,i,u){return e.apply(this,arguments)}}()},{key:"doClipboardPaste",value:function(t,r,n){var o,a=this,s=+new Date;if(t){var i=new Date,u=t.plain,l=t.html;null===(o=e.log)||void 0===o||o.log("\u7c98\u8d34\u6570\u636e\u5927\u5c0f",{plain:t.plain.length,html:t.html.length});Object(m.c)();var c=l&&(l.length>3e3||!Object(L.a)(l))?[]:this.parseCopyImgs(n),d=!Object(m.f)(l,u,c);this.copyPasteCache.setIsFromOuter(d),this.PasteFromOuterInIE(d),this.value=u;var f=null,h=d&&!l&&c&&c.length>0;return t.isApi?this.pasteHandler(d,n,c,l,u,r,f,h):new Promise((function(e,t){if(a.showPasteloading(l,i,h)){var r,n=a.getActiveCellPosition(a.hotInstance),o=n.row,s=n.col;null===(r=f=W.b.createInstance(a.hotInstance,o,s,a.hotInstance.spreadsheet.getActiveSheetId(),W.a.LEFT))||void 0===r||r.show()}O.a.wait(100).run((function(){e()}))})).then((function(){a.pasteHandler(d,n,c,l,u,r,f,h)})).then((function(){k.b.speed.runReport(d?M.SPEED_REPORT_POINTS.COPY_PASTE_OUTER_PASTE:M.SPEED_REPORT_POINTS.COPY_PASTE_INNER_PASTE,s,+new Date)}))}this.doPaste({activeSheetId:this.hotInstance.spreadsheet.activeSheetId,selectAreaCellRange:r})}},{key:"isImageTextPaste",value:function(e,t){var r=!1;if(t&&t.length>0){var n=void 0;e===y.a.table&&(n=t.match(/cutShapeIDs[\S]+cutShapeIDs/)),void 0!==n&&null!==n&&(r=!0)}return r}},{key:"hasHyperLinkType",value:function(e){var t=new RegExp('<a href="https://'.concat(B.g,".*?>"));return e&&t.test(e)||""===e&&Object(B.b)(this.value)}},{key:"doImageTextPasteForCut",value:function(e){var t=this.hotInstance;if(this.copyPasteCache.getCacheState().pasteType==y.b.cut){var r=this.copyPasteCache.getCacheState().sheetId,n=e[0];(n=n.replace(/cutShapeIDs/g,"")).split("|").forEach((function(e){r&&t.requestApi.deleteImage({id:e,sheetId:t.spreadsheet.activeSheetId})})),t.view.canvas.shapeEdit.hide()}else this.copyPasteCache.cancelCopy()}},{key:"doImageTextPaste",value:function(e){var t=e.type,r=e.pasteHtmlString,n=e.pasteData,o=e.selectAreaCellRange,a=void 0;if(t===y.a.table&&r&&r.length>0&&(a=r.match(/cutShapeIDs[\S]+cutShapeIDs/)),void 0!==a&&null!==a&&r&&r.length>0&&this.doImageTextPasteForCut(a),r&&r.length>0){var s=oe.parseHTML(r);n=n||this.copyPasteCache.getCacheData(),(null===s||void 0===s?void 0:s.table)&&s.table.data.length>0&&(n.images=s.images,n.containTable=!0,this.doPaste({activeSheetId:this.hotInstance.spreadsheet.activeSheetId,pasteData:n,pasteHtmlString:r,selectAreaCellRange:o}))}else this.doPaste({activeSheetId:this.hotInstance.spreadsheet.activeSheetId,pasteData:n,selectAreaCellRange:o})}},{key:"doPaste",value:function(e){var t=e=e||{},r=t.selectAreaCellRange,n=t.activeSheetId,o=e,a=o.pasteData,s=o.cb,i=o.envs,u=o.pasteHtmlString;if(n=n||this.hotInstance.spreadsheet.getActiveSheetId(),void 0===r){var l=this.hotInstance.view.getSelection();r={xRange:[l.rangeSelections[l.rangeSelections.length-1].startColIndex,l.rangeSelections[l.rangeSelections.length-1].endColIndex],yRange:[l.rangeSelections[l.rangeSelections.length-1].startRowIndex,l.rangeSelections[l.rangeSelections.length-1].endRowIndex]}}var c=s||!(S.a.isMobilePhone||S.a.isAndroidPad)&&p.b,d=!1;try{d=this.handlerDoPaste({activeSheetId:n,pasteData:a,cb:c,undoCb:p.a,selectAreaCellRange:r,envs:i})}catch(f){console.error(f)}return"doPasteSuccess = ".concat(d),d&&u&&u.length>0&&this.showPlaceHolderImgTipsV2((null===a||void 0===a?void 0:a.images)||[],u),this.copyPasteCache.cancelCopy(),d}},{key:"showPlaceHolderImgTipsV2",value:function(t,r){/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor);var n=navigator.userAgent.match(/Mac\sOS\sX/i),o=t.filter((function(e){return!(!e.url||e.url!==_.d&&e.url!==_.b)})),a=this.getPasteErrorMsgContent(o,r,n).msgContent;if(a){Object(I.showToast)(a,{top:"182px","z-index":501,"max-width":800},{toastType:"typeNotice",isNeedClose:!0,isNeedReflush:!0}),$(".view_announcement").off("click").on("click",(function(){e.onlineDocDialog.createDialog(e.res.afterUpdateTip.content_afterupdate,null,(function(){Object(I.hideToast)()}))}))}}},{key:"doCopy",value:function(e){var t,r,n,o=e.copyType,a=e.previewActiveSheetId,s=e.isSelectAll,u=+new Date;Object(i.getQuery)("inToastPreview")&&k.b.tdwReport({opername:"doc_preview",module:"pc_qqview",action:"cli_copy"});var l,c=this.hotInstance,d=(null===(t=c.preview)||void 0===t?void 0:t.isActive)?c.preview.view.getSelection(s):c.view.getSelection(s),f={xRange:[d.rangeSelections[d.rangeSelections.length-1].startColIndex,d.rangeSelections[d.rangeSelections.length-1].endColIndex],yRange:[d.rangeSelections[d.rangeSelections.length-1].startRowIndex,d.rangeSelections[d.rangeSelections.length-1].endRowIndex]};k.b.jank.log({moduleValue:"copy",actionValue:"analysis",detail:[{x:f.xRange[0],y:f.yRange[0],w:f.xRange[1]-f.xRange[0]+1,h:f.yRange[1]-f.yRange[0]+1}]}),Object(E.a)(),(null===(r=c.preview)||void 0===r?void 0:r.isActive)?a=(l=c.preview.previewsheet.activeSheet).getSheetId():l=c.spreadsheet.activeSheet;var h=a||l.getSheetId(),m=Object(T.convertXYRangeToSheetIdXYRange)(f,h),p=Object(T.convertSheetIdXYRange2GridRange)(m),v=Object(U.isSelectRow)(c),g=Object(U.isSelectColoumn)(c);if(o===y.b.cut&&!c.sheetStatus.getRangeCanEdit(V.GridRange.newInstance({sheetId:h,startRowIndex:f.yRange[0],endRowIndex:f.yRange[1],startColIndex:f.xRange[0],endColIndex:f.xRange[1]})))return se;if((g||v)&&o==y.b.cut&&!Object(F.c)(p,l))return N.dialog.alert("\u63d0\u793a","\u65e0\u6cd5\u5bf9\u5408\u5e76\u5355\u5143\u683c\u6267\u884c\u6b64\u64cd\u4f5c\u3002",(function(){})),se;var _,b,A=this.copyPasteCache.onCopy({from:f,copyType:o,hotInstance:this.hotInstance,previewActiveSheetId:a,isSelectAll:s});try{this.clipboardCopy(A,y.a.table)}catch(j){console.error(j)}(S.a.isMobile||c.view.canvas.inputManager.focus(),null===(n=c.preview)||void 0===n?void 0:n.isActive)?null===(_=c.preview.view.canvas.copyFrame)||void 0===_||_.doCopy(d.rangeSelections[d.rangeSelections.length-1]):null===(b=c.view.canvas.copyFrame)||void 0===b||b.doCopy(d.rangeSelections[d.rangeSelections.length-1]);return k.b.speed.runReport(M.SPEED_REPORT_POINTS.COPY_PASTE_COPY_TIME,u,+new Date),A}},{key:"handlerDoPaste",value:function(t){var r,n=t.activeSheetId,o=t.pasteData,a=t.cb,s=t.undoCb,i=t.selectAreaCellRange,u=t.envs,l=this.hotInstance,c=this.hotInstance.view.getSelection();void 0===i&&(i={xRange:[c.rangeSelections[c.rangeSelections.length-1].startColIndex,c.rangeSelections[c.rangeSelections.length-1].endColIndex],yRange:[c.rangeSelections[c.rangeSelections.length-1].startRowIndex,c.rangeSelections[c.rangeSelections.length-1].endRowIndex]});var d={xRange:[i.xRange[0],i.xRange[1]],yRange:[i.yRange[0],i.yRange[1]]},f=c.rangeSelections[c.rangeSelections.length-1];if("undefined"===typeof f.startRowIndex||"undefined"===typeof f.startColIndex||"undefined"===typeof f.endRowIndex||"undefined"===typeof f.endColIndex)return N.dialog.info({title:"\u8b66\u544a",content:"\u65e0\u6cd5\u6267\u884c\u6b64\u64cd\u4f5c\u3002\u8bf7\u9009\u4e2d\u533a\u57df\u91cd\u8bd5"}),!1;try{var h;null===(h=e.log)||void 0===h||h.info("pasteSelectRange",JSON.stringify(i),JSON.stringify(l.view.canvas.normalSelectData.selectQueue),JSON.stringify(l.view.getSelection().rangeSelections[l.view.getSelection().rangeSelections.length-1]))}catch(g){}var m,p,v=this.copyPasteCache.onPaste({activeSheetId:n,to:d,hotInstance:this.hotInstance,pasteData:o,cb:a,undoCb:s,envs:u});(null===(r=l.preview)||void 0===r?void 0:r.isActive)?null===(m=l.preview.view.canvas.copyFrame)||void 0===m||m.closeCopy():null===(p=l.view.canvas.copyFrame)||void 0===p||p.closeCopy();return v}},{key:"doShapesCopy",value:function(e){var t,r,n,o=this.hotInstance,a=this.copyPasteShape.getCopyContent();if(this.clipboardCopy(a,y.a.shapes),e===y.b.cut){var s=o.view.canvas.shapeEdit.shapeId;o.spreadsheet.activeSheet.imageManager.getImage(s);o.requestApi.deleteImage({id:s,sheetId:o.spreadsheet.activeSheetId}),o.view.canvas.shapeEdit.hide()}(this.copyPasteCache.cancelCopy(),null===(t=o.preview)||void 0===t?void 0:t.isActive)?null===(r=o.preview.view.canvas.copyFrame)||void 0===r||r.closeCopy():null===(n=o.view.canvas.copyFrame)||void 0===n||n.closeCopy()}},{key:"parseCopyImgs",value:function(e){return Object(x.a)(e)}},{key:"automaticIdentifyLink",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(t){var r,n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(null===(r=this.hotInstance.preview)||void 0===r?void 0:r.isActive)?this.hotInstance.preview.view.getSelection():this.hotInstance.view.getSelection(),o={xRange:[n.rangeSelections[n.rangeSelections.length-1].startColIndex,n.rangeSelections[n.rangeSelections.length-1].endColIndex],yRange:[n.rangeSelections[n.rangeSelections.length-1].startRowIndex,n.rangeSelections[n.rangeSelections.length-1].endRowIndex]},e.next=4,Object(D.a)(t);case 4:(a=e.sent)&&(a.fromOuterContentType=y.c.text,this.doPaste({activeSheetId:this.hotInstance.spreadsheet.activeSheetId,pasteData:a,selectAreaCellRange:o}));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"syncMobileClipboard",value:function(e){Object(m.h)(e)}},{key:"doCopyToClipboard",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&this.clipboardCopy(e,e.type||y.a.table),this.copyPasteCache.setCacheData({isSingle:!0,isMerge:!1,merge:[[]],rowDataUpdate:[{values:[new v.a({effectiveValue:G.ExtendedValueFactory.createInstance({type:g.a.STRING,value:e.plain})})]}],fromType:y.d.COPY_CACHE,fromApp:y.e.tencent,select:{selectAll:!1,selectCol:!1,selectRow:!1},containTable:!0}),this.copyPasteCache.setValid(!0),this.copyPasteCache.setStateCopyData(e)}},{key:"judgeForInsertCopy",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t,r,n,o,a,s,i,u,l,c,d,f,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.hotInstance,e.next=3,t.feature.getCopyPaste();case 3:return r=e.sent,n=r.copyPasteCache,o=t.view.canvas,a=!Object(U.isSelectColoumn)(t)&&!Object(U.isSelectRow)(t),s=n.getCacheData(),i=n.getCacheState(),u=i.valid,l=u&&i.pasteType==y.b.cut,c=s&&i.select&&i.select.selectRow,d=s&&i.select&&i.select.selectCol,f=!c&&!d&&!(s&&1==s.isSingle&&0==s.isMerge),h=!!o.shapeEdit.shapeId,e.abrupt("return",{canPaste:u,inValid:a,isCut:l,notSingle:f,cacheState:i,isSelectPic:h});case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),t}();ce=re([ne(1,u.a)],ce);var de=Object(d.c)("ICopyPaste");t.default=ce}.call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/feature/copyPaste/copyPasteCache.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"imageRelativeToAbsolute",(function(){return Ae})),r.d(t,"default",(function(){return Ee}));r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.map.js"),r("../node_modules/core-js/modules/es.object.assign.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/es.string.anchor.js"),r("../node_modules/core-js/modules/esnext.map.delete-all.js"),r("../node_modules/core-js/modules/esnext.map.every.js"),r("../node_modules/core-js/modules/esnext.map.filter.js"),r("../node_modules/core-js/modules/esnext.map.find.js"),r("../node_modules/core-js/modules/esnext.map.find-key.js"),r("../node_modules/core-js/modules/esnext.map.includes.js"),r("../node_modules/core-js/modules/esnext.map.key-of.js"),r("../node_modules/core-js/modules/esnext.map.map-keys.js"),r("../node_modules/core-js/modules/esnext.map.map-values.js"),r("../node_modules/core-js/modules/esnext.map.merge.js"),r("../node_modules/core-js/modules/esnext.map.reduce.js"),r("../node_modules/core-js/modules/esnext.map.some.js"),r("../node_modules/core-js/modules/esnext.map.update.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n,o=r("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),s=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),u=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),l=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),c=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),d=r("./src/core/feature/copyPaste/iconSource.tsx"),f=r("./src/core/feature/formula/utils.ts"),h=(new d.a).iconsList.spinner,m=function(e){for(var t=e.mergeReference,r=e.hiddenRowMap,n=e.copyRange,o=(e.hideRowMap,e.hideColMap,n.endRowIndex),a=n.endColIndex,s=!1,i=t.getColCount(),u=t.startColIndex,l=u+i-1,c=u,d=u;d<=l;d++){if(d>a)return{xUnit:-1,yUnit:-1,x:-1,y:-1};s||(c=d,s=!0)}for(var f=!1,h=t.getRowCount(),m=t.startRowIndex,p=m+h-1,v=m,g=m;g<=p;g++){if(g>o)return{xUnit:-1,yUnit:-1,x:-1,y:-1};r&&r.get(g)?h-=1:f||(v=g,f=!0)}return{xUnit:i,yUnit:h,x:c,y:v}},p={loadingView:document.createElement("loadingView"),showLoading:function(e){var t=p.loadingView;return t.setAttribute("width",e.style.width),t.setAttribute("height",e.style.height),t.style.backgroundColor="#E2E2E2",t.style.width=e.style.width,t.style.height=e.style.height,t.style.borderColor="#E2E2E2",t.id="copyLoadingView",t.style.background='url("'.concat(h,'") center left no-repeat'),t.style.display="flex",t.style.marginLeft="5px",t.style.content="",e.appendChild(t),t},closeLoading:function(e){e.removeChild(p.loadingView)}},v=r("./src/base/util/object.ts"),g=r("../packages/report/src/index.ts"),y=r("../packages/model/src/range/GridRange.ts"),_=r("../packages/model/src/range/DimensionRange.ts"),b=r("../packages/model/src/dimension/DimensionType.ts"),A=r("../packages/model/src/config/index.ts"),E=r("../packages/model/src/cell/format/UnderlineType.ts"),j=r("../packages/model/src/range/gridRangeUtils.ts"),R=r("./src/core/feature/copyPaste/convertor/convertShapeData2IAddImage.ts"),S=r("./src/core/feature/copyPaste/lib/smartSplit/SmartSplit.ts"),C=(r("../node_modules/core-js/modules/es.symbol.description.js"),r("../node_modules/core-js/modules/es.symbol.iterator.js"),r("../node_modules/core-js/modules/es.array.from.js"),r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.function.name.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/core-js/modules/es.string.bold.js"),r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js")),T=r("../node_modules/@tencent/tdocs-format-render/lib/index.js"),w=r("./src/core/feature/copyPaste/lib/unescapeCssSequences.ts"),O=r("./src/core/feature/copyPaste/interfaces.ts"),I=r("../packages/model/src/cell/ExtendedValueType.ts"),N=r("./src/core/utils/index.ts"),k=r("./src/core/feature/copyPaste/utils/mergeRangeUtils.ts"),M=r("./src/core/utils/cell.ts"),D=r("../packages/model/src/cell/format/BorderStyle.ts"),x=(n={},Object(c.a)(n,D.a.NONE,"none"),Object(c.a)(n,D.a.HAIR,".5pt hairline"),Object(c.a)(n,D.a.DASH_DOT,".5pt dot-dash"),Object(c.a)(n,D.a.DASH_DOT_DOT,".5pt dot-dot-dash"),Object(c.a)(n,D.a.DOTTED,".5pt dotted"),Object(c.a)(n,D.a.DASHED,".5pt dashed"),Object(c.a)(n,D.a.THIN,".5pt solid"),Object(c.a)(n,D.a.MEDIUM_DASH_DOT_DOT,"1.0pt dot-dot-dash"),Object(c.a)(n,D.a.SLANTED_DASH_DOT,"1.0pt dot-dash-slanted"),Object(c.a)(n,D.a.MEDIUM_DASH_DOT,"1.0pt dot-dash"),Object(c.a)(n,D.a.MEDIUM_DASHED,"1.0pt dashed"),Object(c.a)(n,D.a.MEDIUM,"1.0pt solid"),Object(c.a)(n,D.a.DOUBLE,"2.0pt double"),Object(c.a)(n,D.a.THICK,"1.5pt solid"),n),F=r("./src/base/util/url.ts"),P=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),L=r.n(P),U=r("../packages/model/src/cell/cellFormatUtils.ts"),B=r("../packages/model/src/factory/index.ts"),H=r("../packages/model/src/cell/metadata/CustomDataType.ts"),G=r("../packages/model/src/embedded/index.ts"),V=r("./src/core/feature/copyPaste/middleware/factory.ts"),W=r("./src/core/feature/copyPaste/middleware/interface.ts"),Y=r("./src/base/util/safe.js");function z(e,t){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"===typeof e)return K(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return K(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){i=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(i)throw a}}}}function K(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var q={styles:{}};function Q(e,t,r,n){var o,a,s=e.startColIndex,i=e.endColIndex,u=e.startRowIndex,l=e.endRowIndex,c="";for(a=u;a<=l;a++)if(!n.get(a)){var d=[];for(o=s;o<=i;o++){var f=r[a]?r[a].values[o]:null;t.getCellDataAtPosition(a,o);var h=f&&f.getFormattedValue()&&f.getFormattedValue().value||"";if(h===T.INVALID_VALUE){var m=r[a]?r[a].values[o]:null;h=(h=m&&m.getEditValue()||"").replace(/\ufeff/g,"").replace(/</g,"&lt;").replace(/>/g,"&gt;")}d.push(h)}c+=d.join("\t"),a!=l&&(L.a.isWindows?c+="\r\n":c+="\n")}return c}function X(e){switch(e){case"td":return"empty-cells:show;line-height:normal;color:#000;vertical-align:middle;outline-width:0;word-wrap:break-word;word-break:normal;white-space:nowrap; text-align:left;font-size:10pt;";case"table":return"border-collapse: collapse;";case"font":return"white-space: pre-wrap";default:return""}}function J(e,t,r){return"".concat(e.map((function(e){return"<".concat(e,">")})).concat([r]).concat(t.map((function(e){return"</".concat(e,">")}))).join(""))}function $(e,t){var r=null===t||void 0===t?void 0:t.getMetadata(),n=null===r||void 0===r?void 0:r.customDataType;if(n){if(n!==H.o.IMAGE){var o=t.getRefIds();return"data-online-sheet-type='".concat(n,"' data-online-sheet-value='").concat(JSON.stringify(null===r||void 0===r?void 0:r.serialize()),"' data-online-sheet-refId='").concat(o,"'")}return""}}function Z(e,t){var r,n=null===t||void 0===t||null===(r=t.getUserEnteredFormat())||void 0===r?void 0:r.getDataValidation();return n?"data-online-sheet-validation='".concat(JSON.stringify(n.serialize()),"'"):""}function ee(e,t,r,n,a,s,i,u,l,c){var d,f,h,p,v,g=e.xRange,_=e.yRange,b=Object(j.convertIXYRangeToGridRange)(e,"sheetId"),E=function(e,t,r,n,o){for(var a=r,s=t,i=r;i<=o&&i<e.length;i++)for(var u=t;u<=n&&e[i]&&e[i].values;u++)e[i].values[u]&&(a<i&&(a=i),s<u&&(s=u));return{maxY:a,maxX:s}}(i.rowData,e.xRange[0],e.yRange[0],e.xRange[1],e.yRange[1]),S=E.maxY,w=E.maxX,D=g[0],x=w,F=_[0],P=S,H="",Y="",K="\x3c!--cutShapeIDs",q=function(e){if(e.selectAll)return"all";if(e.selectRow)return"row";if(e.selectCol)return"col";return"cells"}(u);Y+='<table style="border-collapse:collapse" selectType="'+q+'">',Y+=function(e,t,r){for(var n="",o=e;o<=t;o++){var a=r[o],s=a?a.pixelSize:A.DEFAULT_COL_WIDTH,i=!!a&&a.hiddenByUser;n+="<col "+(i?' hiddenCol="hiddenCol" ':"")+' width="'+s+'" style="width: '+s+'px;">'}return n}(D,x,i.colMetadata);var Q=r[0],ee=function(e){var t=e.rowCount,r=e.colCount,n=e.range,o=e.tableData,a=e.app,s=n.xRange,i=n.yRange,u=s[0],l=s[1],c=i[0],d=i[1],f=new Array,h=a.view;return o.imageManager.each((function(e,a){if(e.type!==G.EMBEDDED_OBJECT_TYPE.CELL_IMAGE){for(var s=e.position.overlayPosition.anchorCell.colIndex,i=e.position.overlayPosition.anchorCell.rowIndex,m=e.position.overlayPosition.offsetXpixels;m>=o.data.getColWidth(s)&&s<=r-1;)m-=o.data.getColWidth(s),s++;for(var p=e.position.overlayPosition.offsetYpixels;p>=h.canvas.rowcolAccessor.getRowDisplayHeight(i)&&i<=t-1;)p-=h.canvas.rowcolAccessor.getRowDisplayHeight(i),i++;if(i>=c&&i<=d&&s>=u&&s<=l&&function(e,t,r,n,o,a,s,i){for(var u=e.xRange,l=e.yRange,c=u[1],d=l[1],f=!1,h=0,m=0,p=o;p<=d;p++)m+=i.canvas.rowcolAccessor.getRowDisplayHeight(p);for(var v=n;v<=c;v++)h+=i.canvas.rowcolAccessor.getColSetWidth(v);return m-=s,h-=a,r.position.overlayPosition.widthPixels<=h&&r.position.overlayPosition.heightPixels<=m&&(f=!0),f}(n,0,e,s,i,m,p,h)){var v=i+"_"+s,g=Object.assign({},Object(R.a)(e));if(g.offset.x=m,g.offset.y=p,f.hasOwnProperty(v))f[v].push(g);else{var y=new Array;y.push(g),f[v]=y}}}})),Object.keys(f),f}({range:e,tableData:t,rowCount:r.length,colCount:Q?Q.values.length:0,app:c});for(var oe in ee)if(Object.prototype.hasOwnProperty.call(ee,oe)){var le=oe.split("_").map((function(e){return parseInt(e,10)})),ce=Object(o.a)(le,2),de=ce[0],fe=ce[1];fe>x&&(x=fe),de>P&&(P=de)}for(h=F;h<=P;h++)if(!n.get(h)){v=ne(D,x,i.colMetadata.length,h,i.rowMetadata),p=re(h,i.rowMetadata),Y+="<tr "+p+v+">";var he=function(){var e=f,o=h;if(d=r[o]?r[o].values[e]:null,me=d?d.getMergeReference():null){var i=(me=me.clone()).startColIndex,u=me.startRowIndex,p=m({mergeReference:me,hiddenRowMap:n,copyRange:b}),v=p.xUnit,g=p.yUnit,_=p.x,A=p.y;_===f&&A===h?(me=v>1||g>1?new y.b("sheetid",A,A+g-1,_,_+v-1):null,e=i,d=r[o=u]?r[o].values[e]:null):me=null}else me=null;if(Object(k.b)(d,o,e)&&!me)return"continue";var E=[];if(d){var j=[d.getConditionalFormatResult(),d.getEffectiveFormat(),d.getUserEnteredFormat()].filter((function(e){return null!==e}));E.push.apply(E,Object(C.a)(j))}var R=E.length>0&&Object(U.mergeCellFormats)(E),S="",w=R&&R.getTextFormat()||B.TextFormatFactory.createInstance();if(d&&R){var D=w?w.fontSize:null,x=R.getNumberFormat();S+=ie(d,D,x,r,w,R)}else S+=ue();var F="";me&&(F+=ae(me,e,o,a,s));var P="",L=void 0,H=d&&d.getFormula();H&&(P=H.toString(o,e,t.spreadsheetReference.sheetManager),l===O.b.copy&&(L=N.a.formula.util.getRelativeFormulaWithFormula(P,o,e)));var G="";L&&"string"===typeof L&&(G+=se(L));var q=V.a.getMiddleWaresByLevel(W.a.CELL_PROPS).map((function(e){return e.copyToHtml(c,d)})).join(" ")+$(0,d);Y+='<td style="'.concat(S,'" ').concat(F," ").concat(G," ").concat(q," ").concat(Z(0,d),">");var Q=te(d);Q&&(Y+=Q);var X=[];w.strikethrough&&X.push("s");var re=X.reverse();if(L&&"string"===typeof L)Y+=d?Object(M.getMergedValue)(d):"\u8ba1\u7b97\u4e2d...";else{var ne=d&&d.getEffectiveValue(),oe=d&&d.getTextFormatRuns();if(ne&&ne.type===I.a.STRING&&"string"===typeof ne.value&&oe){var le=ne.value;P=oe.map((function(e,t){var r=oe[t+1]?oe[t+1].startIndex:le.length,n=le.slice(e.startIndex,r);if(n=n.replace(/</g,"&lt;").replace(/>/g,"&gt;"),!e.format)return n;var o=e.format,a=o.fontSize,s=o.color,i=o.fontFamily,u=o.bold,l=o.italic,c=o.strikethrough,d=o.underline,f=[];a&&f.push("font-size:"+a+"pt"),s&&f.push("color:"+s.toHex()),l&&f.push("font-style:italic"),u&&f.push("font-weight:bold"),d&&f.push("text-decoration:underline"),i&&f.push("font-family:".concat(i.replace(/"/g,"'")));var h=f.join(";")+";",m=[];c&&m.push("s");var p=m.reverse();return'<font style="'.concat(h,'">').concat(J(m,p,n),"</font>")})).join("")}else if((P=d?Object(M.getMergedValue)(d):"")===T.INVALID_VALUE){var ce=d&&d.getEditValue()||"";P=(P=ce.replace(/\ufeff/g,"")).replace(/</g,"&lt;").replace(/>/g,"&gt;")}else P=(P+"").replace(/\ufeff/g,"").replace(/</g,"&lt;").replace(/>/g,"&gt;");V.a.getMiddleWaresByLevel(W.a.CELL).forEach((function(e){e.getCellValue&&(P=e.getCellValue(c,d,P))})),P=P.replace(/\r?\n/g,'<br style="mso-data-placement:same-cell;">'),Y+=J(X,re,P)}if(Q&&(Y+="</a>"),ee&&Object.keys(ee).length>0)if(me)for(var de=me.startRowIndex,fe=me.endRowIndex,he=me.startColIndex,pe=me.endColIndex,ve=de;ve<=fe;ve++)for(var ge=he;ge<=pe;ge++){var ye=ee[ve+"_"+ge];if(ye&&ye.length>0){for(var _e=0,be=ge;be>he;be--)_e+=t.data.getColWidth(be-1);for(var Ae=0,Ee=ve;Ee>de;Ee--)Ae+=t.data.getRowHeight(Ee-1);var je,Re=z(ye);try{for(Re.s();!(je=Re.n()).done;){var Se=je.value,Ce='<img src="'.concat(Se.url,'" type="tencent-sheet-float-img" width=').concat(Se.size.width," height=").concat(Se.size.height,' style="width: ').concat(Se.size.width,"px; height: ").concat(Se.size.height,"px; margin-left: ").concat(Se.offset.x+_e,"px; margin-top: ").concat(Se.offset.y+Ae,'px" data-clip="').concat(Se.clipInfo.clipTop,"px ").concat(Se.clipInfo.clipRight,"px ").concat(Se.clipInfo.clipBottom,"px ").concat(Se.clipInfo.clipLeft,'px"/>');Y+=Ce,K+=Se.id+"|"}}catch(ke){Re.e(ke)}finally{Re.f()}}}else{var Te=ee[o+"_"+e];if(Te&&Te.length>0){var we,Oe=z(Te);try{for(Oe.s();!(we=Oe.n()).done;){var Ie=we.value,Ne='<img src="'.concat(Ie.url,'" type="tencent-sheet-float-img" width=').concat(Ie.size.width," height=").concat(Ie.size.height,' style="width: ').concat(Ie.size.width,"px; height: ").concat(Ie.size.height,"px; margin-left: ").concat(Ie.offset.x,"px; margin-top: ").concat(Ie.offset.y,'px" data-clip="').concat(Ie.clipInfo.clipTop,"px ").concat(Ie.clipInfo.clipRight,"px ").concat(Ie.clipInfo.clipBottom,"px ").concat(Ie.clipInfo.clipLeft,'px"/>');Y+=Ne,K+=Ie.id+"|"}}catch(ke){Oe.e(ke)}finally{Oe.f()}}}Y+="</td>"};for(f=D;f<=x;f++){var me;he()}Y+="</tr>"}return ee&&Object.keys(ee).length>0&&(K=K.substring(0,K.length-1),Y+=K+="cutShapeIDs--\x3e"),Y+="</table>",H+='<html xmlns:x="tencent"><meta charset="utf-8"><style type=\'text/css\'>'.concat(function(){if(L.a.isMobilePhone||L.a.isAndroidPad)return"";var e=X("td"),t=X("table"),r=X("font"),n="";return(e||t)&&(n="\x3c!-- td { ".concat(e," } table { ").concat(t," } font{ ").concat(r," }--\x3e")),n}(),"</style>"),H+="<body>\x3c!--StartFragment--\x3e",H+=Y,H+="\x3c!--EndFragment--\x3e</body></html>"}function te(e){var t=e&&e.getHyperlink()||void 0,r=e&&e.getHyperlinkRuns()||void 0,n=e&&e.getHyperlinkType()||void 0,o=e&&e.getLinkIconStatus()||void 0,a=!(!t||!Object(F.e)(t));if(t||r&&r.length>0){var s;r?s=r[0].linkUrl:t&&(s="".concat(a?t:Object(F.d)(t,!0)));var i=r?'data-sheets-hyperlinkruns="'.concat(Object(Y.escapeHTML)(JSON.stringify(r)),'"'):"",u={hyperlinkType:n,linkIconStatus:o},l='data-sheets-hyperlink="'.concat(Object(Y.escapeHTML)(JSON.stringify(u)),'"');return"<a ".concat(l," ").concat(i,' href="').concat(s,'" title="" style="cursor: default;color: blue; text-decoration: underline;pointer-events: auto" >')}return null}function re(e,t){var r=t[e],n=r?r.pixelSize:null,o=!!n;return' height="'+(n=n||A.DEFAULT_ROW_HEIGHT)+'" style="mso-height-source:'+(o?"userset":"auto")+";height:"+n+'px;"'}function ne(e,t,r,n,o){var a="";if(oe(e,t,r)&&o&&o[n]){var s=o[n];(null===s||void 0===s?void 0:s.hiddenByUser)&&(a=' hiddenRow="hiddenRow" ')}return a}function oe(e,t,r){return 0===e&&t-e+1>=r}function ae(e,t,r,n,o){var a="";if(e){for(var s=e.getColCount(),i=t+s-1,u=t;u<=i;u++)o&&o[u]&&o[u].hiddenByUser&&(s-=1);for(var l=e.getRowCount(),c=r+l-1,d=r;d<=c;d++)n&&n[d]&&n[d].hiddenByUser&&(l-=1);a=' colspan="'+s+'" rowspan="'+l+'" '}return a}function se(e){var t="";return e&&(t=' data-online-sheet-formula="'+e.replace(/"/g,"&#34;")+'" '),t}function ie(e,t,r,n,o,a){var s=[],i=a.getBackgroundColor();if(i){var u=i.toHex();u!==A.DEFAULT_CELL_FORMAT_LITERAL.backgroundColor&&s.push("background-color:"+u)}s.push("font-size:"+(t||A.DEFAULT_CELL_FORMAT_LITERAL.fontSize)+"pt");var l=o.color?o.color:q.styles.color;l!==q.styles.color&&l&&s.push("color:"+l.toHex()),o.italic&&s.push("font-style:italic"),o.bold&&s.push("font-weight:bold"),o.underline&&s.push("text-decoration:underline");var c=o.fontFamily?o.fontFamily.replace(/"/g,"'"):A.DEFAULT_CELL_FORMAT_LITERAL.fontFamily;c&&s.push("font-family:"+c);var d=a.getBorderTop(),f=a.getBorderRight(),h=a.getBorderBottom(),m=a.getBorderLeft(),p=e.getMergeReference();function v(e){var t=e.color?e.color.toHex():"#000000",r="number"===typeof e.style?x[e.style]:x[D.a.THIN];return"".concat(r," ").concat(t)}if(d&&(d.color||d.style)&&s.push("border-top: ".concat(v(d))),!p&&f&&(f.color||f.style)&&s.push("border-right: ".concat(v(f))),!p&&h&&(h.color||h.style)&&s.push("border-bottom: ".concat(v(h))),m&&(m.color||m.style)&&s.push("border-left: ".concat(v(m))),p){var g=p.startRowIndex,y=p.endRowIndex,_=p.startColIndex,b=p.endColIndex;if(n&&n[g]&&n[g].values&&n[g].values[b]){var E=n[g].values[b];if(E){var j=E.getUserEnteredFormat();if(j){var R=j.getBorderRight();R&&(R.color||R.style)&&s.push("border-right: ".concat(v(R)))}}}if(n&&n[y]&&n[y].values&&n[y].values[_]){var S=n[y].values[_];if(S){var C=S.getUserEnteredFormat();if(C){var O=C.getBorderBottom();O&&(O.color||O.style)&&s.push("border-bottom: ".concat(v(O)))}}}}var I=Object(M.getMergedFormat)(e,"verticalAlign");I&&s.push("vertical-align:".concat(I));var N=Object(M.getMergedFormat)(e,"textAlign");N&&s.push("text-align:".concat(N));var k=a.getWrapStrategy();if(k&&s.push("white-space:".concat(k)),r){var F=Object(w.a)(Object(T.getFormatCodeByNumberFormat)(r));s.push("mso-number-format: ".concat(F))}return s.join(";")+";"}function ue(){var e="";return e+="font-size: ".concat(A.DEFAULT_CELL_FORMAT_LITERAL.fontSize,"pt;")}var le=r("../packages/model/src/cell/CellDataSlot.ts"),ce=(r("../node_modules/core-js/modules/es.array.reduce.js"),r("../node_modules/@babel/runtime/helpers/esm/typeof.js")),de=r("./src/core/feature/copyPaste/preVerify/showTips.ui.ts"),fe=r("../packages/model/src/dimension/DimensionProperties.ts"),he=r("./src/core/feature/formula/utils/parseUtil.ts");function me(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function pe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?me(Object(r),!0).forEach((function(t){Object(c.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):me(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ve=function(){function e(t){var r=this;Object(a.a)(this,e),this.shapeData=[],this.mappingTypeWithOutMergeAndUnMerge=!1,this.isChangeRow=!1,this.isChangeCol=!1,this.setMappingTypeWithOutMergeAndUnMerge=function(e){r.mappingTypeWithOutMergeAndUnMerge=!1,r.fromGridRangeType.isSingle&&r.toGridRangeType.isSingle&&(r.fromGridRangeType.isMerge?r.mappingTypeWithOutMergeAndUnMerge=r.toGridRangeType.isMerge:r.mappingTypeWithOutMergeAndUnMerge=!0),!1===e&&1===r.useXYLen.useXLen&&1===r.useXYLen.useYLen&&(r.mappingTypeWithOutMergeAndUnMerge=!0)},this.calcFromAndToGridType=function(e){r.fromGridRangeType={isSingle:e.isSingle,isMerge:e.isMerge};var t=r.activeSheet.getCellDataAtPosition(r.toGridRange.startRowIndex,r.toGridRange.startColIndex),n=Object(k.d)(r.toGridRange,t);r.toGridRange.isSingle()||n?r.toGridRangeType={isSingle:!0,isMerge:n}:r.toGridRangeType={isSingle:!1,isMerge:!1}},this.isMergeCellInPasteData=function(e){return"object"===Object(ce.a)(e)},this.initTablePropsInPaste=function(){var e={};return V.a.getAllMiddleWares({level:W.a.CELL_PROPS,tableProps:!0}).forEach((function(t){var r=t.desc.tableProps,n=void 0===r?"":r;n&&(e[n]=[])})),e},this.getFormulaFromGridForOuter=function(e,t,r){var n=e.formula;if(n){var o=n[t.fromOffsetY]?n[t.fromOffsetY][t.fromOffsetX]:null;if(o)return o=Object(f.n)(o),N.a.formula.util.getFormulaWithRelativeFormula(o,r.toY,r.toX)}},this.getFormulaFromGridForCut=function(e,t,n){var o,a=r.cacheState.from,s=[a.xRange[0],a.yRange[0],a.xRange[1],a.yRange[1]];if(null===e||void 0===e?void 0:e.getFormula()){var i=e.getFormula();i&&(o=i.clone()).updateAfterCutAndPaste({cutRanges:r.cutRanges,oldRow:s[1]+t.fromOffsetY,oldCol:s[0]+t.fromOffsetX,newRow:n.toY,newCol:n.toX})}return o},this.spreadsheetApp=t.spreadsheetApp,this.config=t.config,this.cacheData={isSingle:!1,isMerge:!1,formula:[[]],merge:[[]],rowDataUpdate:[{values:[]}],fromType:O.d.COPY_CACHE,fromApp:O.e.tencent,select:{selectAll:!1,selectCol:!1,selectRow:!1},containTable:!0},this.cacheState={copyHTMLType:O.a.table,sheetId:"string",pasteType:O.b.copy,valid:!1,cellSelect:[],select:{selectAll:!1,selectRow:!1,selectCol:!1},copyRangeIsChange:!1,from:{xRange:[0,0],yRange:[0,0]},clipboardCopyData:{html:"",plain:"",timeStamp:""}}}return Object(s.a)(e,[{key:"setCopyCacheData",value:function(e){var t=this.initTablePropsInPaste();this.cacheState=pe(pe({},e),t)}},{key:"isPasteCellInCopyRange",value:function(e,t,r){if(!r)return!1;if(this.cacheState.sheetId!==this.spreadsheetApp.spreadsheet.activeSheetId)return!1;var n=r.endColIndex,o=r.endRowIndex,a=r.startColIndex,s=r.startRowIndex;return e>=a&&e<=n&&t>=s&&t<=o}},{key:"toGridMapping",value:function(e,t,r){for(var n=this,o=this.initTablePropsInPaste(),a=this.toGridRange,s=a.startRowIndex,i=a.startColIndex,u=this.useXYLen,l=u.useXLen,c=u.useYLen,d=[],f=[],h=[],m=[],p=[],v=function(a){var u=s+a,c=a%e.fromYLen;d.push({values:[]});for(var v=function(s){var l=i+s,v=s%e.fromXLen,g=t.rowDataUpdate[c].values[v],y=n.isPasteCellInCopyRange(l,u,n.fromGridRange);V.a.getMiddleWaresByLevel(W.a.CELL_PROPS).forEach((function(e){var a={cellData:g,pasteData:t,offset:{row:u,col:l,fromRow:c,fromCol:v},hotInstance:n.spreadsheetApp,activeSheetId:r,cacheState:n.cacheState,ext:{propsKeys:o,isPasteCellInCopyRange:y}},s=(e.processPasteData(a)||{}).newCellData;s&&(g=s)}));var _=n.isCut?n.getFormulaFromGridForCut(g,{fromOffsetX:v,fromOffsetY:c},{toX:l,toY:u}):n.getFormulaFromGridForOuter(t,{fromOffsetX:v,fromOffsetY:c},{toX:l,toY:u});if(n.setDimensionProperties({offsetX:s,offsetY:a},n.toGridRangeLen,{fromOffsetX:v,fromOffsetY:c},{toX:l,toY:u},f,h,t),g&&(g=n.processLink(g)),_&&(n.isCut?g.setFormula(_):g.setFormula(Object(he.c)(_,u,l,n.spreadsheetApp.spreadsheet.getActiveSheetId()))),d[a].values.push(g),n.mappingTypeWithOutMergeAndUnMerge)return"continue";n.breakMergeCells({toX:l,toY:u},m),n.setMergeCells({fromOffsetX:v,fromOffsetY:c},{toX:l,toY:u},t,p)},g=0;g<l;g++)v(g)},g=0;g<c;g++)v(g);return{rowDataUpdate:d,newColsDimensionProperties:h,newRowsDimensionProperties:f,unMergeCellsPaste:m,mergeCellsPaste:p,propsKeys:o}}},{key:"checkGridMapping",value:function(){for(var e=this.useXYLen,t=e.useXLen,r=e.useYLen,n=this.toGridRange,o=n.startRowIndex,a=n.startColIndex,s=0;s<r;s++)for(var i=o+s,u=0;u<t;u++){var l=a+u;if(Object(k.b)(this.activeSheet.getCellDataAtPosition(i,l),i,l)){var c=this.activeSheet.getCellDataAtPosition(i,l),d=null===c||void 0===c?void 0:c.getMergeReference();if(d&&!this.toGridRange.contain(d))return console.error("\u7c98\u8d34\u533a\u57df\u4e0d\u5141\u8bb8\u548c\u5408\u5e76\u5355\u5143\u683c\u76f8\u4ea4"),Object(de.a)(),!1}if(this.config.isFormatPainter&&Object(k.a)(this.activeSheet.getCellDataAtPosition(i,l),i,l)){var f=this.activeSheet.getCellDataAtPosition(i,l),h=null===f||void 0===f?void 0:f.getMergeReference();if(h&&!this.toGridRange.contain(h))return console.error("\u683c\u5f0f\u5237\u5728\u5237\u5355\u5143\u683c\u7684\u65f6\u5019\uff0c\u76ee\u7684\u8303\u56f4\u5fc5\u987b\u5305\u542b\u5408\u5e76\u5355\u5143\u683c"),Object(de.b)(),!1}}return!0}},{key:"setDimensionProperties",value:function(e,t,r,n,o,a,s){var i=this.activeSheet.data,u=i.rowMetadata,l=i.colMetadata;if(e.offsetX%t.toXLen===0&&s.rowsDimensionProperties){var c=s.rowsDimensionProperties[r.fromOffsetY],d=null===u||void 0===u?void 0:u[n.toY],f=null===d||void 0===d?void 0:d.pixelSize;s.fromApp===O.e.tencent||void 0===f||0===f||null===f||(c=fe.a.newInstance(pe(pe({},c),{},{pixelSize:f}))),o.push(c)}if(e.offsetY%t.toYLen===0&&s.colsDimensionProperties){var h=s.colsDimensionProperties[r.fromOffsetX],m=null===l||void 0===l?void 0:l[n.toX],p=null===m||void 0===m?void 0:m.pixelSize;s.fromApp===O.e.tencent||null===p||void 0===p||0===p||(h=fe.a.newInstance(pe(pe({},h),{},{pixelSize:p}))),a.push(h)}}},{key:"breakMergeCells",value:function(e,t){if(Object(k.a)(this.activeSheet.getCellDataAtPosition(e.toY,e.toX),e.toY,e.toX)){var r=this.activeSheet.getCellDataAtPosition(e.toY,e.toX);if(r){var n=r.getMergeReference();if(n)if(this.cacheState.sheetId===this.spreadsheetApp.spreadsheet.getActiveSheetId())this.cutData.cutUnmergeOptions.reduce((function(e,t){return e||t.startRowIndex===n.startRowIndex&&t.startColIndex===n.startColIndex&&t.endRowIndex===n.endRowIndex&&t.endColIndex===n.endColIndex}),!1)||t.push(n);else t.push(n)}}}},{key:"setMergeCells",value:function(e,t,r,n){var o,a=null===(o=r.merge)||void 0===o?void 0:o[e.fromOffsetY][e.fromOffsetX];if(this.isMergeCellInPasteData(a)){var s=this.toGridRange,i=s.endRowIndex,u=s.endColIndex,l=Math.min(t.toY+a.h-1,i),c=Math.min(t.toX+a.w-1,u);if(this.config.isFormatPainter&&c===t.toX&&l===t.toY)return;n.push({startRowIndex:t.toY,endRowIndex:l,startColIndex:t.toX,endColIndex:c,sheetId:this.spreadsheetApp.spreadsheet.getActiveSheetId()})}}},{key:"activeSheet",get:function(){return this.spreadsheetApp.spreadsheet.activeSheet}}]),e}(),ge=r("../packages/mutation/src/MutationId.ts");function ye(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var o=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Object(u.a)(this,r)}}function _e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function be(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_e(Object(r),!0).forEach((function(t){Object(c.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_e(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ae(e){var t=e.xIndex,r=e.yIndex;return e.shapeDatas.map((function(e){return be(be({},e),{},{anchor:{col:e.anchor?e.anchor.col+t:t,row:e.anchor?e.anchor.row+r:r}})}))}var Ee=function(e){Object(i.a)(r,e);var t=ye(r);function r(e){var n,s=e.spreadsheetApp,i=e.config;return Object(a.a)(this,r),(n=t.call(this,{spreadsheetApp:s,config:i})).calcUseXAndYLen=function(){var e,t,r,o,a=n.toGridRange,s=a.startRowIndex,i=a.startColIndex,u=n.fromGridRangeLen,l=u.fromXLen,c=u.fromYLen,d=n.pasteTile,f=d.repeatX,h=d.repeatY,m=n.toGridRangeLen,p=m.toXLen,v=m.toYLen;if((null===(e=n.config)||void 0===e?void 0:e.tile)||1===p&&1===v)r=f*l,o=h*c;else if(null===(t=n.config)||void 0===t?void 0:t.isFormatPainter){var g=n.activeSheet.getColCount();r=p,o=v,s+c-1>=n.activeSheet.getRowCount()&&(r=l),i+l-1>=g&&(o=c)}else r=p,o=v;return n.useXYLen={useXLen:r,useYLen:o},n.useXYLen},n.getPasteDimensionPropsRanges=function(e,t,r,o){var a=!1,s=!1,i=n.fromGridRangeLen,u=i.fromXLen,l=i.fromYLen;if(e&&n.cacheState.select)a=n.cacheState.select.selectAll||n.cacheState.select.selectRow,s=n.cacheState.select.selectAll||n.cacheState.select.selectCol;else if(t.fromApp===O.e.tencent)a=t.select.selectAll||t.select.selectRow,s=t.select.selectAll||t.select.selectCol;else{var c=1===u&&1===l;a=!c,s=!c}var d=t.infoDimension,f=Object(j.convertGridRangeToSheetIdXYRange)(n.toGridRange),h=f.rowsRange,m=f.columnsRange,p=[];if(d){var v=d.insertDimensionRanges;v&&v.forEach((function(e){var t=e.dimension;t===b.a.ROWS?p.push(h):t===b.a.COLUMNS&&p.push(m)}))}else r.length>0&&a&&p.push(h),o.length>0&&s&&p.push(m);return n.isChangeRow=a,n.isChangeCol=s,p},n.processLink=function(e){var t=e.getHyperlink(),r=e.getUserEnteredFormat();if(t){var n,o=null===r||void 0===r?void 0:r.getColor(),a=null===r||void 0===r?void 0:r.getUnderline(),s={};o||(s.color=A.HYPERLINK_COLOR),a||(s.underline=E.a.SINGLE_LINE),e.setUserEnteredFormat(B.CellFormatFactory.createInstance(be(be({},null===r||void 0===r?void 0:r.getOptions()),{},{textFormat:be(be({},null===r||void 0===r||null===(n=r.textFormat)||void 0===n?void 0:n.getOptions()),s)})))}return e},n.getPasteRanges=function(){for(var e=0,t=n.activeSheet.getBasicFilter(),r=[],o=t?t.getHiddenRowMap():new Map,a=n.spreadsheetApp.spreadsheet.getActiveSheetId(),s=n.toGridRange,i=s.startRowIndex,u=s.startColIndex,l=n.useXYLen,c=l.useXLen,d=l.useYLen,f=0,h=i,m=i-1;f<d;f++)if(m+=1,o.get(m)){if(f-=1,e+=1,m-h<1){h=m+1;continue}var p=new y.b(a,h,m-1,u,u+c-1);r.push(p),h=m+1}else if(f===d-1){var v=new y.b(a,h,m,u,u+c-1);r.push(v)}return n.pasteRanges=r,e},n.setCutData=function(e,t){if(e&&n.isCut&&n.cacheState.sheetId){var r,a=Object(o.a)(n.cacheState.from.xRange,2),s=a[0],i=a[1],u=Object(o.a)(n.cacheState.from.yRange,2),l=u[0],c=u[1],d=n.cacheState.sheetId,f=n.spreadsheetApp.spreadsheet.sheetManager.getSheetBySheetId(n.cacheState.sheetId),h=n.fromGridRangeLen,m=h.fromXLen,p=h.fromYLen;if(r=Object(j.divideGridRangesByFilter)([new y.b(d,l,c,s,i)],null===f||void 0===f?void 0:f.getBasicFilter()),n.cutData={cutGridRanges:r,cutUnmergeOptions:[],cutRowsDimensionRanges:[],cutColumnsDimensionRanges:[]},t.merge)for(var v=0;v<p;v++)for(var g=l+v,A=0;A<m;A++){var E=s+A,R=t.merge[v][A];R&&n.isMergeCellInPasteData(R)&&n.cutData.cutUnmergeOptions.push({startRowIndex:g,endRowIndex:g+R.h-1,startColIndex:E,endColIndex:E+R.w-1,sheetId:d})}n.cacheState.select.selectCol&&(n.cutData.cutColumnsDimensionRanges=[new _.a(d,s,s+m-1,b.a.COLUMNS)]),n.cacheState.select.selectRow&&(n.cutData.cutRowsDimensionRanges=[new _.a(d,l,l+p-1,b.a.ROWS)])}else n.cutData={cutGridRanges:[],cutUnmergeOptions:[],cutRowsDimensionRanges:[],cutColumnsDimensionRanges:[]}},n.setShape=function(e){e.images&&e.images.length>0?n.shapeData=e.images:n.shapeData=[]},n.getToYLen=function(){for(var e=1,t=n.toGridRange,r=t.startRowIndex,o=t.endRowIndex,a=n.activeSheet.getBasicFilter(),s=a?a.getHiddenRowMap():new Map,i=r;i<o;i++)s.get(i)||(e+=1);return e},n.calcRepeatTile=function(e,t,r){var o=1,a=1;n.mappingTypeWithOutMergeAndUnMerge||!r?(o=1,a=1):(o=e.fromXLen<t.toXLen?t.toXLen/e.fromXLen>>0:1,a=e.fromYLen<t.toYLen?t.toYLen/e.fromYLen>>0:1),n.pasteTile={repeatX:o,repeatY:a}},n.subscribe(),n}return Object(s.a)(r,[{key:"setIsFromOuter",value:function(e){this.isFromOuter=e}},{key:"onCopy",value:function(e){var t,r=e.from,n=e.copyType,a=e.hotInstance,s=e.previewActiveSheetId,i=e.isSelectAll;this.cacheData={isSingle:!1,isMerge:!1,merge:[[]],rowDataUpdate:[{values:[]}],fromType:O.d.COPY_CACHE,fromApp:O.e.tencent,select:{selectAll:!1,selectCol:!1,selectRow:!1},containTable:!0};var u,l,c,d,f,h=s||a.spreadsheet.activeSheetId,p=s&&a.preview.previewsheet.sheetManager.getSheetBySheetId(s)||a.spreadsheet.activeSheet,v=p.data.rowData,g=p.data.rowMetadata,_=p.data.colMetadata,b=Object(o.a)(r.xRange,2),A=b[0],E=b[1],R=Object(o.a)(r.yRange,2),S=R[0],C=R[1];this.cacheState.sheetId=h;var T=Object(j.convertXYRangeToSheetIdXYRange)(r,h),w=Object(j.convertSheetIdXYRange2GridRange)(T);Object(k.d)(w,p.getCellDataAtPosition(w.startRowIndex,w.startColIndex))||w.isSingle()?(this.cacheData.isSingle=!0,Object(k.d)(w,p.getCellDataAtPosition(w.startRowIndex,w.startColIndex))?this.cacheData.isMerge=!0:this.cacheData.isMerge=!1):(this.cacheData.isSingle=!1,this.cacheData.isMerge=!1),this.cacheData.rowDataUpdate=[],this.cacheData.merge=[],this.cacheData.formula=[];var I=[],N=[];this.cacheData.rowsDimensionProperties=I,this.cacheData.colsDimensionProperties=N;var M=p.getColCount(),D=p.getRowCount();E>M&&(E=M),C>D&&(C=D);var x,F=p.getBasicFilter(),P=F?F.getHiddenRowMap():new Map;for(l=S;l<=C;l++)if(!P.get(l))for(c={values:[]},d=[],f=[],[],this.cacheData.rowDataUpdate.push(c),this.cacheData.merge.push(d),this.cacheData.formula.push(f),u=A;u<=E;u++){var U,B=u,H=l,G=v[l]?v[H].values[B]:null,V=G?G.getMergeReference():null;if(l%(C-S+1)===0&&N.push(_[B]),u%(E-A+1)===0&&I.push(g[H]),V){var W=(V=V.clone()).startColIndex,Y=V.startRowIndex,z=m({mergeReference:V,hiddenRowMap:P,copyRange:w}),K=z.xUnit,q=z.yUnit,X=z.x,J=z.y;X===u&&J===l&&(K>1||q>1)?(V=new y.b("sheetid",J,J+q-1,X,X+K-1),G=v[H]?v[H].values[B]:null):V=null,B=W,H=Y}else V=null;d.push(!!V&&{w:V.getColCount(),h:V.getRowCount()}),(null===(U=G)||void 0===U?void 0:U.clone)&&(G=G.clone()),c.values.push(G)}if(this.cacheState.valid=!0,null===(x=i?{selectAll:!0,selectRow:!1,selectCol:!1}:(null===(t=a.preview)||void 0===t?void 0:t.isActive)?a.preview.view.canvas.normalSelectData.select:a.view.canvas.normalSelectData.select))throw new Error("\u590d\u5236\u7c98\u8d34\u9009\u533a\u5f02\u5e38\uff01");var $=x,Z=$.selectAll,te=$.selectRow,re=$.selectCol;this.setCopyCacheData({copyHTMLType:O.a.table,from:r,pasteType:n,sheetId:h,valid:!0,cellSelect:[],select:{selectAll:Z,selectRow:te,selectCol:re},copyRangeIsChange:!!s,clipboardCopyData:{html:"",plain:"",timeStamp:""}}),this.cacheState.cutRange&&this.cacheState.sheetId&&(this.cacheState.cutRange=null),n===O.b.cut&&(this.cacheState.cutRange=new y.b(h,S,C,A,E)),this.cacheState.copyRange&&this.cacheState.sheetId&&(this.cacheState.copyRange=null),n===O.b.copy&&(this.cacheState.copyRange=new y.b(h,S,C,A,E));var ne=function(e){var t=e.spreadsheetApp,r=e.copyType,n=e.range,o=e.select,a=e.previewActiveSheetId,s=a&&t.preview.previewsheet.sheetManager.getSheetBySheetId(a),i=s||t.spreadsheet.activeSheet,u=(new Date).getTime().toString();if(!i)return{timeStamp:u,html:"",plain:""};var l=i.data.rowData,c=i.getBasicFilter(),d=c?c.getHiddenRowMap():new Map,f=o.selectRow?i.data.rowMetadata:[],h=o.selectCol?i.data.colMetadata:[],m=Object(j.convertIXYRangeToGridRange)(n,i.getSheetId()),p=L.a.isWxMiniProgram&&L.a.isAndroid,v=o.selectCol||o.selectRow||o.selectAll;return{timeStamp:u,html:p&&v?"":ee(n,i,l,d,f,h,t.spreadsheet.activeSheet.data,o,r,t),plain:Q(m,i,l,d)}}({spreadsheetApp:this.spreadsheetApp,copyType:n,range:r,previewActiveSheetId:s,select:{selectAll:Z,selectRow:te,selectCol:re}});return this.cacheState.clipboardCopyData=ne,ne}},{key:"onPaste",value:function(e){var t,r,n=this,o=e.activeSheetId,a=e.to,s=e.hotInstance,i=e.pasteData,u=(e.config,e.cb),l=(e.undoCb,e.envs),c=this.cacheState,d=s.spreadsheet.activeSheet,f=this.spreadsheetApp.spreadsheet.activeSheet.data,h=f.rowMetadata,m=f.colMetadata,p=!i||i.fromType===O.d.COPY_CACHE||i.fromType===O.d.TRANSPOSE;if(o=o||s.spreadsheet.getActiveSheetId(),!(i=i||(this.cacheState.valid?this.cacheData:void 0))||!i.rowDataUpdate||void 0===i.rowDataUpdate[0])return!1;var _=d.getBasicFilter();this.isCut=p&&c.pasteType===O.b.cut;var b=c.from,A=Object(j.convertXYRangeToSheetIdXYRange)(b,o);this.fromGridRange=Object(j.convertSheetIdXYRange2GridRange)(A);var E=Object(j.convertXYRangeToSheetIdXYRange)(a,o);this.toGridRange=Object(j.convertSheetIdXYRange2GridRange)(E);var C=i.containTable,T=this.toGridRange,w=T.startRowIndex,I=T.startColIndex,N=T.endColIndex,k=i.rowDataUpdate[0].values.length,M=i.rowDataUpdate.length,D=N-I+1,x=this.getToYLen();this.fromGridRangeLen={fromXLen:k,fromYLen:M},this.toGridRangeLen={toXLen:D,toYLen:x};var F={style:[]};this.calcFromAndToGridType(i),this.calcRepeatTile(this.fromGridRangeLen,this.toGridRangeLen,p);var P=this.calcUseXAndYLen(),L=P.useXLen,U=P.useYLen;this.setMappingTypeWithOutMergeAndUnMerge(C),this.setCutData(p,i),this.setShape(i);var B=i.infoDimension;if(this.toGridRange.endRowIndex=this.toGridRange.startRowIndex+U-1,this.toGridRange.endColIndex=this.toGridRange.startColIndex+L-1,!this.checkGridMapping())return!1;this.cutRanges=[].concat(this.cutData.cutGridRanges,this.cutData.cutColumnsDimensionRanges,this.cutData.cutRowsDimensionRanges);var H=this.toGridMapping(this.fromGridRangeLen,i,o),G=H.rowDataUpdate,V=H.newColsDimensionProperties,W=H.newRowsDimensionProperties,Y=H.unMergeCellsPaste,z=H.mergeCellsPaste,K=H.propsKeys,q=!(1!==L||!Object(S.f)(s)),Q=!1;q&&(Q=Object(S.f)(s,!0));var X=this.getPasteDimensionPropsRanges(p,i,W,V),J=this.getPasteRanges(),$=new y.b(c.sheetId,b.yRange[0],b.yRange[1],b.xRange[0],b.xRange[1]),Z=i.cellMask,ee=void 0===Z?le.a.ALL:Z,te=i,re=te.formatMask,ne=te.fromOuterContentType,oe=c.pasteType===O.b.cut&&"undefined"!==typeof ee;c.pasteType===O.b.copy&&"undefined"!==typeof ee&&(ee-=1<<le.b.SLOT_MENTION);var ae=be({params:{fromOuterContentType:ne,isNeedMention:oe},cellMask:ee,formatMask:re,sheetId:o,pasteRanges:this.pasteRanges,unmergeInfos:Y,mergeInfos:z,cutData:this.cutData,copyRange:$,toGridRange:this.toGridRange,propsKeys:K,infoDimension:Object.assign(B||{},{sheet:d,pasteRange:this.toGridRange,pasteDimensionPropsRanges:X,rowsDimensionProperties:W,columnsDimensionProperties:V}),pasteEmbeddedObjects:Ae({xIndex:this.toGridRange.startColIndex,yIndex:this.toGridRange.startRowIndex,shapeDatas:this.shapeData}).map((function(e){return Object(R.b)(e,o)})),isFormatPainter:!!this.config.isFormatPainter},(null===l||void 0===l?void 0:l.clearRangeContent)?{clearRangeContent:l.clearRangeContent}:{}),se=h.filter((function(e){return null===e||void 0===e?void 0:e.hiddenByUser})),ie=m.filter((function(e){return null===e||void 0===e?void 0:e.hiddenByUser})),ue=window.performance.now();if(i.fromType!==O.d.COPY_CACHE||o!==c.sheetId||c.pasteType!==O.b.copy||c.copyRangeIsChange||_||0!==(null===K||void 0===K||null===(t=K.cellImage)||void 0===t?void 0:t.length)||this.config.isFormatPainter||0!==se.length||0!==ie.length||$.isCross(this.pasteRanges[0])&&B&&B.insertDimensionRanges){this.spreadsheetApp.requestApi.applyPasteData(be({gridData:{startRow:w,startCol:I,rowData:G,rowMetadata:[],colMetadata:[]}},ae));var ce=window.performance.now(),de=Math.round(ce-ue);g.b.tdwReport({module:"cut_copy_paste",opername:"doc_excel_editor",action:"apply_paste_data",ver5:de})}else{this.spreadsheetApp.requestApi.insideSheetCopyPaste(be({copyPasteMutationsOptions:{copyRange:$}},ae));var fe=window.performance.now(),he=Math.round(fe-ue);g.b.tdwReport({module:"cut_copy_paste",opername:"doc_excel_editor",action:"inside_sheet_copy_paste",ver5:he})}p&&(this.cacheState.pasteType=O.b.copy,this.cacheState.hasDonePaste=!0);var me={xRange:[I,Math.max(I+L-1,I)],yRange:[w,Math.max(w+U-1+J,w)]};return null===(r=s.view.canvas)||void 0===r||r.selectApi.selectCells(me),n.isCut&&p&&s.feature.copyPaste&&(s.feature.copyPaste.copyPasteCache.cacheState.valid=!1),u&&(setTimeout((function(){u.call({pasteData:Object(v.clone)(i),stateBefore:Object(v.clone)(F)},{hotInstance:s,active:be({},a),fromCache:p,pasteType:n.isCut?O.b.cut:O.b.copy,toCheckSmartSplit:q,isNewSheet:Q,envs:l})})),g.b.tdwReport({module:"cut_copy_paste",opername:"doc_excel_editor",action:n.isCut?"cut_copy_paste_cut_click":"cut_copy_paste_paste_sucess"})),!0}},{key:"cancelCopy",value:function(){this.spreadsheetApp.spreadsheet.sheetManager.getSheetBySheetId(this.cacheState.sheetId)&&(this.cacheState.cutRange&&(this.cacheState.cutRange=null),this.cacheState.copyRange&&(this.cacheState.copyRange=null))}},{key:"getCacheData",value:function(){return this.cacheData}},{key:"getCacheState",value:function(){return this.cacheState}},{key:"setStateCopyData",value:function(e){this.cacheState.clipboardCopyData=e}},{key:"setCacheDataType",value:function(e){this.cacheState.pasteType=e}},{key:"setCacheData",value:function(e){this.cacheData=e}},{key:"setValid",value:function(e){this.cacheState.valid=e}},{key:"isCopyFromSingleCell",value:function(e){return!!e&&!(e.length>1||e[0]&&e[0].length>1)}},{key:"subscribe",value:function(){var e=this;this.spreadsheetApp.mutationBehavior.emitter.addListener(this.spreadsheetApp.mutationBehavior.EVENT.AFTER_MUTATION_RUN,(function(t){var r;switch(t.mutation.id){case ge.b.INSERT_DIMENSION_MUTATION:r=t.mutation,e.insertDimension({sheetId:r.sheetId,type:r.type,index:r.index,amount:r.amount});break;case ge.b.DELETE_DIMENSION_MUTATION:r=t.mutation,e.deleteDimension({sheetId:r.sheetId,type:r.type,index:r.index,amount:r.amount})}}))}},{key:"insertDimension",value:function(e){if(this.cacheState.cutRange){var t=this.cacheState.cutRange;t.clone().insertDimension(e),t.endRowIndex-t.startRowIndex!==t.endColIndex-t.startColIndex&&(this.cacheState.valid=!1,console.warn("cut operation fail because of insertDimension"))}this.cacheState.copyRange&&(this.cacheState.copyRangeIsChange=!0)}},{key:"deleteDimension",value:function(e){if(this.cacheState.cutRange){var t=this.cacheState.cutRange;t.clone().deleteDimension(e),t.endRowIndex-t.startRowIndex!==t.endColIndex-t.startColIndex&&(this.cacheState.valid=!1,console.warn("cut operation fail because of deleteDimension"))}this.cacheState.copyRange&&(this.cacheState.copyRangeIsChange=!0)}}]),r}(ve)},"./src/core/feature/copyPaste/copyPasteShape.ts":function(e,t,r){"use strict";r.d(t,"b",(function(){return c})),r.d(t,"d",(function(){return d})),r.d(t,"c",(function(){return f})),r.d(t,"a",(function(){return h}));r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.number.to-fixed.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.anchor.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=r("./src/core/feature/copyPaste/utils/url.ts"),i=r("./src/core/feature/copyPaste/convertor/convertShapeData2IAddImage.ts"),u=r("./src/core/view/level-2/shape-upload/utils.ts");function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var c="https://pub.idqqimg.com/pc/misc/files/20180727/b6ffe3bcf0d74c5f90f591e69a26291d.png",d="https://pub.idqqimg.com/pc/misc/files/20180727/c7de8a354e6f4ef99a1a8672e9b24593.png",f=function(e){e="undefined"!==typeof e?e:4;var t="";for(var r=0;r<e;r++)t+=Math.floor(65536*(1+Math.random())).toString(16).substring(1);return t},h=function(){function e(t,r){Object(o.a)(this,e),this.hot=t,this.addImageFunc=r}return Object(a.a)(e,[{key:"addShape",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.hot,n=r.spreadsheet.getActiveSheetId();if(!e.anchor){var o=null===r||void 0===r?void 0:r.view.canvas;if(o){var a=o.normalSelectData.activeRow,s=o.normalSelectData.activeCol;e.anchor=a<0||s<0?{row:0,col:0}:{row:a,col:s}}else e.anchor={row:0,col:0};e.offset={x:0,y:0}}e.size||(e.size={width:-1,height:-1}),this.addImageFunc(Object(i.c)(e,n),t)}},{key:"getCopyContent",value:function(){var e=this.hot.view.canvas.shapeEdit.shapeId;return this.getPickShapeCopyContent(e)}},{key:"getPickShapeCopyContent",value:function(e){if(e){var t=this.hot.spreadsheet.activeSheet.imageManager.getImage(e);if(t){var r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},Object(i.a)(t)),o=t.position.overlayPosition.widthPixels.toFixed(),a=t.position.overlayPosition.heightPixels.toFixed(),s=t.clipInfo.clipTop.toFixed(),u=t.clipInfo.clipLeft.toFixed(),c=t.clipInfo.clipRight.toFixed(),d=t.clipInfo.clipBottom.toFixed();return{html:'<img src="'.concat(t.url,'" style="width: ').concat(o,"px; height: ").concat(a,'px;" data-clip="').concat(s,"px ").concat(c,"px ").concat(d,"px ").concat(u,'px"/>'),plain:"",json:JSON.stringify([r])}}}return{html:"",plain:"",json:""}}},{key:"onParse",value:function(e,t){var r=this;if(!this.hot.view||!this.hot.view.canvas)return null;var n=this.hot.view.canvas;return"json"===t||"files"===t?e.map((function(e){if("json"===t){e=JSON.stringify(e);var o=JSON.parse(e);return o.anchor=void 0,o.offset={x:0,y:0},o.id=Object(u.c)(),r.newShape(o),o}return n.shapeUpload.handleImage(e,"parse").then((function(e){var t={url:e.url,id:e.id,size:{width:e.width,height:e.height},offset:{x:0,y:0},clipInfo:e.clipInfo};return r.addShape(t),t})),null})):("html"===t||console.error("unkonw format to paste"),null)}},{key:"newShape",value:function(e){this.addShape(e)}},{key:"findShapeById",value:function(e,t){return e[t]}},{key:"handleOuterImg",value:function(e){var t=null,r=this.hot.view.canvas;return Object(s.b)(e)?(t=Object(u.b)(e),r.shapeUpload.handleImage(t,"parse").then((function(e){return{url:e.url,id:e.id,size:{width:e.width,height:e.height},offset:{x:0,y:0},clipInfo:e.clipInfo}}))):Object(s.d)(e)?void 0:r.shapeUpload.handleImageLink(e).then((function(e){return{url:e.url,id:e.id,size:{width:e.width,height:e.height},offset:{x:0,y:0},clipInfo:e.clipInfo}}))}}]),e}()},"./src/core/feature/copyPaste/copyPasteUI.ui.tsx":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n=function(e,t){var r=window.React;if(t)switch(e){case"copy":return r.createElement("p",null,"\u56fe\u7247\u7c98\u8d34\u4e0d\u6210\u529f\u3002\u8bd5\u8bd5",r.createElement("strong",null,"\u5355\u72ec\u590d\u5236\u539f\u56fe"),"\u5e76\u7528",r.createElement("strong",null,"\u2318+V"),"\u7c98\u8d34\u3002");case"import":return r.createElement("p",null,"\u56fe\u7247\u7c98\u8d34\u4e0d\u6210\u529f\u3002\u8bd5\u8bd5",r.createElement("strong",null,"\u5355\u72ec\u590d\u5236\u539f\u56fe"),"\u5e76\u7528",r.createElement("strong",null,"\u2318+V"),"\u7c98\u8d34\uff0c\u6216",r.createElement("strong",null,"\u5bfc\u5165\u8868\u683c"),"\u3002");case"save":return r.createElement("p",null,"\u56fe\u7247\u7c98\u8d34\u4e0d\u6210\u529f\u3002\u8bd5\u8bd5",r.createElement("strong",null,"\u5355\u72ec\u590d\u5236\u539f\u56fe"),"\u7528",r.createElement("strong",null,"\u2318+V"),"\u7c98\u8d34\uff0c\u6216\u5c06\u539f\u56fe\u4fdd\u5b58\u5230\u7535\u8111\u540e\u70b9\u51fb\u201c",r.createElement("strong",null,"\u63d2\u5165\u56fe\u7247"),"\u201d\u3002")}else switch(e){case"copy":return r.createElement("p",null,"\u56fe\u7247\u7c98\u8d34\u4e0d\u6210\u529f\u3002\u8bd5\u8bd5",r.createElement("strong",null,"\u5355\u72ec\u590d\u5236\u539f\u56fe"),"\u5e76\u7528",r.createElement("strong",null,"Ctrl+V"),"\u7c98\u8d34\u3002");case"import":return r.createElement("p",null,"\u56fe\u7247\u7c98\u8d34\u4e0d\u6210\u529f\u3002\u8bd5\u8bd5",r.createElement("strong",null,"\u5355\u72ec\u590d\u5236\u539f\u56fe"),"\u5e76\u7528",r.createElement("strong",null,"Ctrl+V"),"\u7c98\u8d34\uff0c\u6216",r.createElement("strong",null,"\u5bfc\u5165\u8868\u683c"),"\u3002");case"save":return r.createElement("p",null,"\u56fe\u7247\u7c98\u8d34\u4e0d\u6210\u529f\u3002\u8bd5\u8bd5",r.createElement("strong",null,"\u5355\u72ec\u590d\u5236\u539f\u56fe"),"\u7528",r.createElement("strong",null,"Ctrl+V"),"\u7c98\u8d34\uff0c\u6216\u5c06\u539f\u56fe\u4fdd\u5b58\u5230\u7535\u8111\u540e\u70b9\u51fb\u201c",r.createElement("strong",null,"\u63d2\u5165\u56fe\u7247"),"\u201d\u3002")}}},"./src/core/feature/copyPaste/iconSource.tsx":function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));r("../node_modules/core-js/modules/es.object.keys.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=function(){function e(){Object(n.a)(this,e),this.iconSrc={spinner:"data:image/gif;base64,R0lGODlhEAAQAKUAAAQCBHR2dKyurERCRMzKzJSSlGRiZNza3CQmJLy+vKSipISGhFRSVNTS1HRydDQyNLS2tJyenGxqbOTi5MTGxKyqrIyOjDw6PAwKDISChLSytERGRMzOzJSWlGRmZNze3MTCxKSmpIyKjFRWVNTW1DQ2NOLi4gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQJCgAmACwAAAAAEAAQAAAGpUCT0HQQjjbC4nAYeoRMF4QJBJAshYnH4FCSDgCL4SREMDkei6gCgPhM3ITBZkG5eCKdACA0OXw+JiEMGyMNgCYTBB9+bkkiGVcmfxNCGR4eEgKRfYsfAQagFZF/jEIfGhGHYo1CFAsOAQ2UpgelHw4OBQQWFRwgDQl+fpQQICYCIhoQIcAUE2+zJg0WBachBwQgJJEgIgkmy7UJHJEm21MClKwmQQAh+QQJCgAqACwAAAAAEAAQAIUEAgR0dnSsrqxEQkTMysyUkpRcWlwcHhyEhoTc2ty8vrxMTkykoqRkZmR8fnzU0tQ0NjQMDgy0trRkYmQkJiSMjozk4uTExsRUVlSsqqwEBgR8enxERkTMzsycmpxcXlwkIiSMiozc3tzEwsRUUlSkpqRsamyEgoTU1tS8urzi4uIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGpECVUJUQTkhC1HAp4AhUHIjqQtkshSOOIRFVGQ6FoUVAUJ0GhWjmMBB1ECiC4VO4LAIlDwKU2UQAFSoCDQYmKCJCFh0cABomRUQFgVcbJCNCBQ6aKVcqIgmfIiEBGwESnRagoEIiChmISyIiFkMEHiEVKLSJoYiiIQwdGSkoD58WobQjFyojJcsjqsjIQyglrwQKsrKdHSVlFyOzq52QHRe0s0NBACH5BAkKACkALAAAAAAQABAAhQwKDHx6fLSytERGRMzOzJyanCQmJGRiZIyKjMTCxNza3BQWFKSmpDQyNFxaXHRydISChLy+vExOTNTW1KSipGxqbJSSlMzKzOTi5BweHDw6PAwODHx+fLS2tExKTNTS1JyenCwqLGRmZIyOjMTGxNze3BwaHKyurDQ2NOLi4gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAajwJQwpRA+DsLicNhxdFKOQYqk4SyFF4eoFE2JGoUhpkNIjRwgh+fU8JQ+lgnh8aAQDpATZdQ4IUIZYR0BDxwTJUIYBA4ZBgFKCgwgVykIIhdCFBabCZQICyYLAyAjpRGUEACqKIkXEYhLJSUYQx8nDAwKtIklCrIpJbgdEwkXGLK+yLQXHykECQS9srPHu8AJCdPHupQTERPAuhi+lMCJ5BjWQQAh+QQJCgAtACwAAAAAEAAQAIUEAgR0dnSsrqxERkSUkpTMysxcXlwkIiSEhoS8vrykoqTc2txsamw0MjR8fny0trRUUlScmpzU0tRkZmSMjozExsSsqqzk4uR0cnQ8OjwUEhR8eny0srRMSkyUlpTMzsxkYmQsKiyMiozEwsSkpqTc3txsbmw0NjSEgoS8urxcWlycnpzU1tTi4uIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGo8CWsFUSojDCxXCZwCRaDEOr0KEshQWMoxRtYQaK4SXBakUwluhjYLhIPAuWSCSQBDwcQWTwIGQaKy0JBCJwRUQSEw0nKIclHBZXLRQYFUIPFpkFkh4nDQ0qHCSjm1cUIQchEEIXLB8XVyYmZUkVCSMlsEIlBwAaIkQjCQULJbnGJRIGAAAkLSxKJcXSF9MpAYdE1NsLukvVRcYXyJItutTm2UEAIfkECQoAKwAsAAAAABAAEACFBAIEdHZ0tLK0PD48lJKUzM7MXFpchIaExMLEpKKkJCIk3NrcTEpMdHJ0fH58vLq8nJqcZGJkHB4cREZE1NbUjI6MzMrMrKqsPDo85OLkBAYEfHp8tLa0REJElJaU1NLUXF5cjIqMxMbEpKakLC4s3N7cTE5MhIKEvL68nJ6cZGZk4uLiAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABqPAlXBVEhIOwuJwKAqJVqfAqgCCLIWfEKHkkJ4Ml2HGQlldQpzow9AoURIUymiEolRGD07CwEmZJmEWFyMXC0oZFAETDBULSQgPVysQDhZCFgiZZVcpHZ4qIggoCJtLHhioBkIZJSUZV1GlrSULGa9CFAMKJB4rrIYZwFwaCQ0SCgJEr7O0EAAkJQgHjqsLtbQlGAAhkrNErhwaEZK+SbVTSitBACH5BAkKACkALAAAAAAQABAAhQQCBHR2dKyurDw+PJSSlFxaXMzOzKSipGxqbISGhNza3CQiJLy+vExOTJyanGRiZISChNTW1KyqrHRydIyOjOTi5DQyNMTGxFRWVBweHHx6fLS2tERGRJSWlFxeXNTS1KSmpGxubIyKjNze3MTCxFRSVJyenGRmZDw6POLi4gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAaiwJQwNRIeHMLicGgAGVIdSuoTAC2FEZCkQpASJpthJaJIMQ6kKGmSGEUkihGDZFCANheSJEQCPQoCKREkcyMVQmMJBR4OSiMfT1cHIpEjIwpxVykgGJ0Bl5ZKSwcNpQiIlodLIhBlSaAVqoINFgMmKRWwcSYIIgsgGhYWYYZEcSgAFBkcIyQUrrhxFRYABiUZSFegKcgGDAsTmrhCJwtlBqJBACH5BAkKACsALAAAAAAQABAAhQQCBHR2dKyurDw+PJSSlMzKzFxeXISGhLy+vKSipNza3BweHExOTGxqbHx+fLS2tJyanNTS1GRmZIyOjMTGxKyqrOTi5DQyNFRWVBQWFHx6fLSytERGRJSWlMzOzGRiZIyKjMTCxKSmpNze3FRSVHRydISChLy6vJyenNTW1DQ2NOLi4gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAalwJVwZRE+NsLRcJkKpVYV0SoyQS5XCgTFEl0lQIihZVT0ICICUQHUsaQeirFiNAoV7g9QQaApPVZ0c2RJCh0lASJKRINXFRARhCNzVysCEg0SJpKblBUfBh8OQmOMQwQTCkN0kpNCCgYcJFJyIxEZDCIaBBcCBxwcJ4BFBgASJAsdFxgWFBCKKycAGSnHEQYXEJQEACArDAseIReilAVCGgOpEc9BACH5BAkKAC0ALAAAAAAQABAAhQQCBHR2dKyurERCRJSSlMzKzFxeXISGhLy+vKSipNza3BweHFRWVGxubHx+fLS2tExKTJyanNTS1DQyNGRmZIyOjMTGxKyqrOTi5CQmJAQGBHx6fLSytERGRJSWlMzOzGRiZIyKjMTCxKSmpNze3CQiJFxaXHRydISChLy6vExOTJyenNTW1OLi4gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAamwJawhREWLELScEkiFUWiFuuCWAoxiqYl+hgVhhhni5TdfkYcMsJJZpNYEstIkqqEos0spkhUJEIVaVdNVi0pIyxJWVmFDygODgRtjFYcARsBFUkoDApWKxGeQhcZABoWSkIKDSYUAi0KAAADAhMgFwcREBwEBiZRISstJwsbJhMrHRQkBQmpLSIlEywGEx8NHReFKwseLdUfFhAHhS0fQigQShLPQQAh+QQJCgAqACwAAAAAEAAQAIUMCgx8eny0srREQkTMzsyUlpRcXlwkIiTEwsSMiozc2tykpqQUFhRsbmy8urxUVlSEgoTU1tScnpw0MjTMysyUkpTk4uSsrqwcHhx0dnQMDgx8fny0trRERkTU0tRsamwkJiTExsSMjozc3tysqqwcGhx0cnS8vrxcWlykoqTi4uIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGpECVUGURjkbC4nB4LCqQCgRhmXwekZRTZGgZFUdWheIU6lK8YDTac1KEFguK6vjsJkecBQmBJB6pKhQOWyoDDAwlIoAIFY0LEwAAGgmADiKXKUYiHwpUJAudQgIDGCBnQwoQJgEcKgoYGCgcAx8CIgsGDhIZJiEqBRcqARMbDR0kKBkjBBd9KggTAxENAx4BKMFUjxIqHx0eIQYFgCpTKgkGUM5BACH5BAkKACsALAAAAAAQABAAhQQCBHR2dKyurERGRMzKzJSSlGRiZLy+vNza3KSipCwqLISGhFRSVLS2tNTS1JyanGxubBQSFHx+fExOTMTGxOTi5KyqrDQyNIyOjFxaXHx6fLSytExKTMzOzJSWlGRmZMTCxNze3KSmpIyKjFRWVLy6vNTW1JyenHRydBwaHDQ2NOLi4gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAaiwJVwVRGGQsLicHgsIpCV5zL5PCJD0uTosMIeEdFQJWSqHACAjKNpDTlAB9NqEQGkxMkK4QBaC00fJFMrDh1IKyQXig+DBBaPDRwKkx6DFCIiFg1GHgEIUw0NhysNExcqBKMhDyMFXAiKBiUMGg0PAgEgAiMjHSsnAnMDGBIZGygLFR0loxQcDAgaGSYYKJtTFgMiK9ImHSgJg4RCHhBIWStBACH5BAkKACsALAAAAAAQABAAhQQCBHx6fLSytERCRMzOzJSWlFxeXCQiJMTCxKSmpNza3IyKjFRWVGxqbBwaHLy6vJyenDQ2NExKTNTW1GRmZMzKzKyurOTi5JSSlAwODISChLS2tERGRNTS1JyanGRiZCwuLMTGxKyqrNze3IyOjFxaXHRydBweHLy+vKSipDw6POLi4gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAahwJVwNRGORsLLcOkBFFYjxepyXAo3AMekGkUmC4gVA9A4XhSjC/WCOB1MqAyHGqWjVwXQKUKQTqloaUITAQ1WUIIrHwOMKYcdCJEVDCoRKh6PKAgoFUYQGl5DIQihDx8cEgShIxYJIp0KHBxwFAsoCQ8kFbcJHSsJGysYJR4kJg8LHhcTIUpCFQYUCsYTKbaHAiUWK9QdJNuHRb+gKwrOK0EAIfkECQoAKgAsAAAAABAAEACFBAYEfHp8tLK0PD48zM7MlJaUXFpcJCIkxMLEpKak3NrcjIqMbGpsLC4svLq8TE5MnJ6cHB4chIKE1NbUZGZkzMrMrK6s5OLkNDY0DAoMfH58tLa0REJE1NLUnJqcXF5cLCosxMbErKqs3N7cjI6MdHJ0NDI0vL68VFZUpKKk4uLiAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABp5AlVClEA4awstwmYqkVBGA6jIaLYWng0kRVY0U1iQEoaJENJHMBXyhXkImUyAEMhQWX+rX6jlyOkVeVGAjSioTEiVXXoVCJSiQIotVhBQPl09Xa3tJIiRhQx0Ehionjx8doBcIrBNeBgYSCBoFIQIhCaInCK4WDioQJQkpC7gCa6lDBCUaChALCgIpFYumGyrEExMJZIuuKgIFSgqkQQA7"},this.iconsList={},this.init(this.iconSrc,this.iconsList)}return Object(o.a)(e,[{key:"init",value:function(e,t){for(var r=Object.keys(e),n=0;n<r.length;n++){var o=r[n],a=e[o];t[o]=a}}}]),e}()},"./src/core/feature/copyPaste/interfaces.ts":function(e,t,r){"use strict";var n,o,a,s,i,u;r.d(t,"e",(function(){return o})),r.d(t,"d",(function(){return a})),r.d(t,"c",(function(){return s})),r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return u})),function(e){e.TEXT="text/plain",e.HTML="text/html",e.IMAGE="image/png"}(n||(n={})),function(e){e[e.tencent=0]="tencent",e[e.excel=1]="excel",e[e.unknown=2]="unknown"}(o||(o={})),function(e){e[e.COPY_CACHE=0]="COPY_CACHE",e[e.OUTER=1]="OUTER",e[e.TRANSPOSE=2]="TRANSPOSE",e[e.ONLYVALUE=3]="ONLYVALUE",e[e.CLEAR_AUTO_PARSE=4]="CLEAR_AUTO_PARSE"}(a||(a={})),function(e){e[e.illegal=-1]="illegal",e[e.richText=3]="richText",e[e.text=4]="text"}(s||(s={})),function(e){e[e.copy=0]="copy",e[e.cut=1]="cut"}(i||(i={})),function(e){e[e.table=1]="table",e[e.shapes=2]="shapes",e[e.input=3]="input"}(u||(u={}))},"./src/core/feature/copyPaste/lib/ParsePasteHTML.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.from.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.last-index-of.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.number.constructor.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/es.string.match.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/core-js/modules/es.string.trim.js"),r("../node_modules/core-js/modules/es.string.bold.js"),r("../node_modules/core-js/modules/es.string.fontcolor.js"),r("../node_modules/core-js/modules/es.string.fontsize.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),o=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),a=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),s=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),i=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),u=(r("../node_modules/core-js/modules/es.array.includes.js"),r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/es.object.assign.js"),r("../node_modules/core-js/modules/es.object.entries.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.includes.js"),r("../node_modules/core-js/modules/es.array.reduce.js"),r("../node_modules/core-js/modules/es.regexp.constructor.js"),function(){this.cssImportStatements=[],this.cssKeyframeStatements=[],this.cssRegex=new RegExp("([\\s\\S]*?){([\\s\\S]*?)}","gi"),this.cssMediaQueryRegex="((@media [\\s\\S]*?){([\\s\\S]*?}\\s*?)})",this.cssKeyframeRegex="((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})",this.combinedCSSRegex="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",this.cssCommentsRegex="(\\/\\*[\\s\\S]*?\\*\\/)",this.cssImportStatementRegex=new RegExp("@import .*?;","gi"),this.cssComments=/<!--|-->/g});u.prototype.stripComments=function(e){var t=new RegExp(this.cssCommentsRegex,"gi");return e.replace(t,"")},u.prototype.parseCSS=function(e){if(void 0===e)return[];for(var t=[];;){var r=this.cssImportStatementRegex.exec(e);if(null===r)break;this.cssImportStatements.push(r[0]),t.push({selector:"@imports",type:"imports",styles:r[0]})}e=(e=e.replace(this.cssComments,"")).replace(this.cssImportStatementRegex,"");for(var n,o=new RegExp(this.cssKeyframeRegex,"gi");null!==(n=o.exec(e));)t.push({selector:"@keyframes",type:"keyframes",styles:n[0]});e=e.replace(o,"");for(var a=new RegExp(this.combinedCSSRegex,"gi");null!==(n=a.exec(e));){var s="";s=void 0===n[2]?n[5].split("\r\n").join("\n").trim():n[2].split("\r\n").join("\n").trim();var i=new RegExp(this.cssCommentsRegex,"gi"),u=i.exec(s);if(null!==u&&(s=s.replace(i,"").trim()),-1!==(s=s.replace(/\n+/,"\n")).indexOf("@media")){var l={selector:s,type:"media",subStyles:this.parseCSS(n[3]+"\n}")};null!==u&&(l.comments=u[0]),t.push(l)}else{var c={selector:s,rules:this.parseRules(n[6])};"@font-face"===s&&(c.type="font-face"),null!==u&&(c.comments=u[0]),t.push(c)}}return t},u.prototype.parseRules=function(e){var t=[];e=(e=(e=e.split("\r\n").join("\n")).replace("\\;","8cbdb7f1309a1f76b65356e6afc3948b")).replace("\\\\;","8cbdb7f1309a1f76b65356e6afc3948a").split(new RegExp(";")).map((function(e){return(e=e.replace("8cbdb7f1309a1f76b65356e6afc3948b","\\;")).replace("8cbdb7f1309a1f76b65356e6afc3948a","\\\\;")}));for(var r=0;r<e.length;r++){var n=e[r];if(-1!==(n=n.trim()).indexOf(":")){var o=(n=n.split(":"))[0].trim(),a=n.slice(1).join(":").trim();if(o.length<1||a.length<1)continue;t.push({directive:o,value:a})}else"base64,"===n.trim().substr(0,7)?t[t.length-1].value+=n.trim():n.length>0&&t.push({directive:"",value:n,defective:!0})}return t},u.prototype.findCorrespondingRule=function(e,t,r){void 0===r&&(r=!1);for(var n=!1,o=0;o<e.length&&(e[o].directive!==t||(n=e[o],r!==e[o].value));o++);return n},u.prototype.findBySelector=function(e,t,r){void 0===r&&(r=!1);for(var n=[],o=0;o<e.length;o++)!1===r?e[o].selector===t&&n.push(e[o]):-1!==e[o].selector.indexOf(t)&&n.push(e[o]);if("@imports"===t||n.length<2)return n;var a=n[0];for(o=1;o<n.length;o++)this.intelligentCSSPush([a],n[o]);return[a]},u.prototype.deleteBySelector=function(e,t){for(var r=[],n=0;n<e.length;n++)e[n].selector!==t&&r.push(e[n]);return r},u.prototype.compressCSS=function(e){for(var t=[],r={},n=0;n<e.length;n++){var o=e[n];if(!0!==r[o.selector]){var a=this.findBySelector(e,o.selector);0!==a.length&&(t=t.concat(a),r[o.selector]=!0)}}return t},u.prototype.cssDiff=function(e,t){if(e.selector!==t.selector)return!1;if("media"===e.type||"media"===t.type)return!1;for(var r,n,o={selector:e.selector,rules:[]},a=0;a<e.rules.length;a++)r=e.rules[a],(!1===(n=this.findCorrespondingRule(t.rules,r.directive,r.value))||r.value!==n.value)&&o.rules.push(r);for(var s=0;s<t.rules.length;s++)n=t.rules[s],!1===(r=this.findCorrespondingRule(e.rules,n.directive))&&(n.type="DELETED",o.rules.push(n));return 0!==o.rules.length&&o},u.prototype.intelligentMerge=function(e,t,r){void 0===r&&(r=!1);for(var n=0;n<t.length;n++)this.intelligentCSSPush(e,t[n],r);for(n=0;n<e.length;n++){var o=e[n];"media"!==o.type&&"keyframes"!==o.type&&(o.rules=this.compactRules(o.rules))}},u.prototype.intelligentCSSPush=function(e,t,r){var n=t.selector,o=!1;if(void 0===r&&(r=!1),!1===r){for(var a=0;a<e.length;a++)if(e[a].selector===n){o=e[a];break}}else for(var s=e.length-1;s>-1;s--)if(e[s].selector===n){o=e[s];break}if(!1===o)e.push(t);else if("media"!==t.type)for(var i=0;i<t.rules.length;i++){var u=t.rules[i],l=this.findCorrespondingRule(o.rules,u.directive);!1===l?o.rules.push(u):"DELETED"===u.type?l.type="DELETED":l.value=u.value}else o.subStyles=o.subStyles.concat(t.subStyles)},u.prototype.compactRules=function(e){for(var t=[],r=0;r<e.length;r++)"DELETED"!==e[r].type&&t.push(e[r]);return t},u.prototype.getCSSForEditor=function(e,t){void 0===t&&(t=0);var r="";void 0===e&&(e=this.css);for(var n=0;n<e.length;n++)"imports"===e[n].type&&(r+=e[n].styles+"\n\n");for(n=0;n<e.length;n++){var o=e[n];if(void 0!==o.selector){var a="";void 0!==o.comments&&(a=o.comments+"\n"),"media"===o.type?(r+=a+o.selector+"{\n",r+=this.getCSSForEditor(o.subStyles,t+1),r+="}\n\n"):"keyframes"!==o.type&&"imports"!==o.type&&(r+=this.getSpaces(t)+a+o.selector+" {\n",r+=this.getCSSOfRules(o.rules,t+1),r+=this.getSpaces(t)+"}\n\n")}}for(n=0;n<e.length;n++)"keyframes"===e[n].type&&(r+=e[n].styles+"\n\n");return r},u.prototype.getImports=function(e){for(var t=[],r=0;r<e.length;r++)"imports"===e[r].type&&t.push(e[r].styles);return t},u.prototype.getCSSOfRules=function(e,t){for(var r="",n=0;n<e.length;n++)void 0!==e[n]&&(void 0===e[n].defective?r+=this.getSpaces(t)+e[n].directive+": "+e[n].value+";\n":r+=this.getSpaces(t)+e[n].value+";\n");return r||"\n"},u.prototype.getSpaces=function(e){for(var t="",r=0;r<4*e;r++)t+=" ";return t},u.prototype.applyNamespacing=function(e,t){var r=e,n="."+this.cssPreviewNamespace;void 0!==t&&(n=t),"string"===typeof e&&(r=this.parseCSS(e));for(var o=0;o<r.length;o++){var a=r[o];if(!(a.selector.indexOf("@font-face")>-1||a.selector.indexOf("keyframes")>-1||a.selector.indexOf("@import")>-1||a.selector.indexOf(".form-all")>-1||a.selector.indexOf("#stage")>-1))if("media"!==a.type){for(var s=a.selector.split(","),i=[],u=0;u<s.length;u++)-1===s[u].indexOf(".supernova")?i.push(n+" "+s[u]):i.push(s[u]);a.selector=i.join(",")}else a.subStyles=this.applyNamespacing(a.subStyles,t)}return r},u.prototype.clearNamespacing=function(e,t){void 0===t&&(t=!1);var r=e,n="."+this.cssPreviewNamespace;"string"===typeof e&&(r=this.parseCSS(e));for(var o=0;o<r.length;o++){var a=r[o];if("media"!==a.type){for(var s=a.selector.split(","),i=[],u=0;u<s.length;u++)i.push(s[u].split(n+" ").join(""));a.selector=i.join(",")}else a.subStyles=this.clearNamespacing(a.subStyles,!0)}return!1===t?this.getCSSForEditor(r):r},u.prototype.createStyleElement=function(e,t,r){if(void 0===r&&(r=!1),!1===this.testMode&&"nonamespace"!==r&&(t=this.applyNamespacing(t)),"string"!==typeof t&&(t=this.getCSSForEditor(t)),!0===r&&(t=this.getCSSForEditor(this.parseCSS(t))),!1!==this.testMode)return this.testMode("create style #"+e,t);var n=document.getElementById(e);n&&n.parentNode.removeChild(n);var o=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.id=e,a.type="text/css",o.appendChild(a),a.styleSheet&&!a.sheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t))};var l,c=u,d=r("./src/core/feature/copyPaste/lib/unescapeCssSequences.ts"),f=new c,h=function(){function e(t){Object(s.a)(this,e);var r,n=(r=t)?f.parseCSS(r):(console.error("invalid css string"),[]);this.styleSheetsParsed=this.transform(n),this.getComputedStyle=this.getComputedStyle.bind(this)}return Object(i.a)(e,[{key:"transform",value:function(e){return e.reduce((function(e,t){return e[t.selector]=(e[t.selector]||[]).concat(t.rules),e}),{})}},{key:"getComputedStyle",value:function(e){var t=e.getAttribute("class"),r=e.getAttribute("style");return this.getMergedStyles(t,r,e.tagName.toLocaleLowerCase())}},{key:"getMergedStyles",value:function(e,t,r){var n=this.getRulesBySelector(".".concat(e)),o=this.parseRules(t),a=this.getRulesBySelector(r)||[],s=n||[];return this.getMergeStyles(a.concat(s,o))}},{key:"getMergeStyles",value:function(e){var t={};return e.forEach((function(e){var r=e.value;/mso/.test(e.directive)&&(r=Object(d.b)(e.value)),t[e.directive]=r})),t}},{key:"reaplaceStylePropertyUnit",value:function(e,t,r){var n=getComputedStyle(e);return t[r]&&(t[r]=n.getPropertyValue(r)),t}},{key:"parseRules",value:function(e){return(t=e)?f.parseRules(t):[];var t}},{key:"getRulesBySelector",value:function(e){return this.styleSheetsParsed[e]}}]),e}(),m=r("../node_modules/@tencent/tdocs-format-render/lib/index.js");r("../node_modules/core-js/modules/es.symbol.description.js"),r("../node_modules/core-js/modules/es.symbol.iterator.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.function.name.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");function p(e,t){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"===typeof e)return v(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return v(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){i=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(i)throw a}}}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}!function(e){e[e.TEXT=0]="TEXT",e[e.BR=1]="BR"}(l||(l={}));var g=function e(t,r,n,o){if(!t)return[];if(3===t.nodeType)return function(e){var t=e.textContent;return(t=function(e){return e.replace(/[\r\n]\s/,"")}(t.replace(/^[\r\n]\s+/,"")))?[{len:t.length,format:null,text:t,type:l.TEXT}]:[]}(t);if(t.nodeType!==Node.ELEMENT_NODE)return[];if("br"==t.tagName.toLowerCase())return[{len:1,format:null,text:"\n",type:l.BR}];var a=function(e,t,r){var n=r(e),o={style:{}};if("a"==e.tagName.toLowerCase()&&(o.style.fontcolor=t("#018ffb"),o.style.underline="underline"),n){var a=n["font-family"];if(a){var s=a.indexOf(",");-1!=s&&(a=a.slice(0,s)),'"'==a[0]&&(a=a.slice(1,a.length-1)),o.style.fontfamily=a}var i=n["font-size"];if(i)if(-1!==i.toString().toLowerCase().indexOf("pt"))o.style.fontsize=i;else{var u=parseFloat(i);u=3*u/4,(u=Math.round(10*u)/10)&&(o.style.fontsize=u+"pt")}var l=t(n.color);l&&(o.style.fontcolor=l);var c=n["font-weight"];"bold"!=c&&700!=c||(o.style.bold="bold"),"italic"==n["font-style"]&&(o.style.italic="italic");var d=n["text-decoration"];d&&(-1!=d.indexOf("underline")&&(o.style.underline="underline"),-1!=d.indexOf("line-through")&&(o.style.strikeline="strikeline"))}return function(e,t){switch(e.tagName.toLowerCase()){case"b":case"strong":t.style.bold="bold";break;case"i":case"em":t.style.italic="italic";break;case"u":case"ins":t.style.underline="underline";break;case"s":case"strike":case"del":t.style.strikeline="strikeline"}return t}(e,o)}(t,r,n),s=t.childNodes;if(s&&s.length){if(function(e,t){return e.isRootNode&&1===t.length&&t[0].nodeName&&("s"==t[0].nodeName.toLowerCase()||"u"==t[0].nodeName.toLowerCase())}(o,s))return[];var i=[];if(s.forEach((function(t,o){i=i.concat(e(t,r,n,{isRootNode:!1}))})),!o.isRootNode){var u,c=p(i);try{for(c.s();!(u=c.n()).done;){var d=u.value;d&&(d.format?d.format=Object.assign({},a.style,d.format):d.format=Object.assign({},a.style))}}catch(f){c.e(f)}finally{c.f()}}return i}return[]},y=function(e,t){return/^[^\S\r\n]+$/.test(e)&&/^[\r\n]$/.test(t)},_=function(e,t,r){if(!r)return{effectTextFormatRuns:[],allTextFormatRuns:[]};var n=[];return function(e,t){var r=0,n=e.length-1;e.forEach((function(o,a){if(o){if((0===r||a===n)&&o.type===l.TEXT&&/^\s+$/.test(o.text))return;if(y(o.text,e[Math.max(a-1,0)].text))return;t.push({startIndex:r,format:o.format,text:o.text}),r+=o.len}}))}(g(e,t,r,{isRootNode:!0}),n),n.filter((function(e){return!e.format||!Object.keys(e.format).length})).length===n.length?{effectTextFormatRuns:[],allTextFormatRuns:n}:{effectTextFormatRuns:n,allTextFormatRuns:n}},b={white:"#FFFFFF",silver:"#C0C0C0",gray:"#808080",black:"#000000",red:"#FF0000",maroon:"#800000",yellow:"#FFFF00",olive:"#808000",lime:"#00FF00",green:"#008000",aqua:"#00FFFF",teal:"#008080",blue:"#0000FF",navy:"#000080",fuchsia:"#FF00FF",purple:"#800080"},A={windowtext:"",windowframe:"",window:"",threedshadow:"",threedlightshadow:"",threedhighlight:"",threedface:"",threeddarkshadow:"",scrollbar:"",menutext:"",menu:"",infotext:"",infobackground:"",inactivecaptiontext:"",inactivecaption:"",inactiveborder:"",highlighttext:"",highlight:"",grayText:"",captiontext:"",buttontext:"",buttonshadow:"",buttonhighlight:"",buttonface:"",background:"",appworkspace:"",activecaption:"",activeborder:""},E=r("../packages/model/src/cell/format/BorderStyle.ts"),j=new(function(){function e(){Object(s.a)(this,e),this.type=null}return Object(i.a)(e,[{key:"getApp",value:function(e){return this.type?this.type:this.parseFromApp(e)}},{key:"parseFromApp",value:function(e){e||(this.type=null);var t=null===e||void 0===e?void 0:e.getElementsByTagName("html")[0],r=null===t||void 0===t?void 0:t.getAttribute("xmlns:x");return this.type="excel","urn:schemas-microsoft-com:office:excel"===r?this.type="excel":"tencent"===r&&(this.type="tencent"),this.type}}]),e}()),R=r("./src/base/util/url.ts");function S(e){var t=e.toString();if(-1!==t.toLowerCase().indexOf("pt"))return t;var r=parseFloat(t);return r=3*r/4,r=Math.round(10*r)/10,e?"".concat(r,"pt"):""}function C(e,t,r,n,o){var a=null===t||void 0===t?void 0:t.replace(/^\s+|\s+$/g,""),s=!(!e||!Object(R.e)(e));return e&&""!==e&&(function(e){return/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(e)}(e)||s)||o&&o.length>0?{link:{url:e,value:a,type:r,linkIconStatus:n,hyperlinkRuns:o}}:{}}var T=function(e){var t=e,r=t.indexOf(",");return-1!==r&&(t=t.slice(0,r)),'"'===t[0]&&(t=t.slice(1,t.length-1)),t.replace(/-webkit-standard|-webkit-body|-webkit-pictograph/g,"")},w=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),O=r.n(w),I=r("../packages/model/src/embedded/index.ts"),N=r("../packages/model/src/cell/metadata/Metadata.ts"),k=r("../packages/model/src/cell/format/index.ts"),M=r("./src/core/feature/copyPaste/middleware/factory.ts"),D=r("./src/core/feature/copyPaste/middleware/interface.ts"),x=r("./src/core/feature/copyPaste/lib/parsers/automaticIdentifyLink.ts"),F=r("../packages/model/src/cell/HyperlinkRun.ts");function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function L(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(Object(r),!0).forEach((function(t){Object(a.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var U,B=Object.keys(A);!function(e){e.STYLE_NODE="style",e.TABLE_NODE="table",e.IMG_NODE="img",e.TBODY_NODE="tbody",e.THEAD_NODE="thead",e.A_NODE="a",e.TR_NODE="tr",e.HR_NODE="hr",e.TH_NODE="th",e.TD_NODE="td",e.BR_NODE="br"}(U||(U={}));var H=function(){function e(){var t=this;Object(s.a)(this,e),this.getColorFromExcel=function(e){if("excel"===j.getApp()){var r=e.toLocaleLowerCase();if(B.includes(r)){if(A[r])return A[r];t.sandBox.style.borderColor=e,e=getComputedStyle(t.sandBox).borderColor}}return e},this.parseSizeInfo=function(e){if(e){var r=t.parseColCount(e),n=t.parseRowCount(e),o=t.parseColWidthsAndHidden(e,r),a=t.parseRowHeightsAndHidden(e,n);return{col:r,row:n,colWidths:o?o.map((function(e){return e.size})):null,hiddenCols:o?o.map((function(e){return e.hidden})):null,rowHeights:a?a.map((function(e){return e.size})):null,hiddenRows:a?a.map((function(e){return e.hidden})):null}}return!t.size&&t.tableDOM&&(t.size=t.parseSizeInfo(t.tableDOM)),t.size},this.unsubscribe=function(e,r){if(void 0==r)delete t.notificationCenter[e];else{var n=t.notificationCenter[e],o=n?n.indexOf(r):-1;o>-1&&delete t.notificationCenter[e][o]}},this.sandBox=document.createElement("div"),this.init(),this.getHexColor=this.getHexColor.bind(this)}return Object(i.a)(e,[{key:"init",value:function(){this.initNotificationCenter(),this.initSubscription(),this.getTableProps(),document.body.appendChild(this.sandBox)}},{key:"initNotificationCenter",value:function(){this.notificationCenter={}}},{key:"getTableProps",value:function(){var e=this;this.propsKeys={},M.a.getAllMiddleWares({level:D.a.CELL_PROPS,tableProps:!0}).forEach((function(t){var r=t.desc.tableProps,n=void 0===r?"":r;e.propsKeys[n]=[[]]}))}},{key:"initSubscription",value:function(){this.subscribe("beforeStandardizeCells",this.standardizeCellsWithMergeCells),this.subscribe("beforeParseCell",this.parseFormula),this.subscribe("beforeParseCell",this.parseFontFamily),this.subscribe("beforeParseCell",this.parseFontSize),this.subscribe("beforeParseCell",this.parseFontColor),this.subscribe("beforeParseCell",this.parseFontWeight),this.subscribe("beforeParseCell",this.parseFontStyle),this.subscribe("beforeParseCell",this.parseFontDecoration),this.subscribe("beforeParseCell",this.parseBackgroundColor),this.subscribe("beforeParseCell",this.parseBorder),this.subscribe("beforeParseCell",this.parseTextAlign),this.subscribe("beforeParseCell",this.parseVerticalAlign),this.subscribe("beforeParseCell",this.parseWhiteSpace),this.subscribe("beforeParseCell",this.parseLink),this.subscribe("beforeParseCell",this.parseFormat),this.subscribe("beforeParseCell",this.parseTextFormatRuns),this.subscribe("beforeParseCell",this.parseData),this.subscribe("beforeParseCell",this.parseSelect),this.subscribe("beforeParseCell",this.parseDataValidation)}},{key:"clearTableInfo",value:function(){this.tableDOM=null,this.mergeCells=[],this.cellsStyleMaps=[[]],this.nowrap=null,this.noFormula=!1,this.rgba2hex={},this.size=void 0,this.isCopySourceExcel=void 0,this.cells=void 0,this.colgroup=void 0,this.getTableProps()}},{key:"setStyleGroup",value:function(e){try{this.mSOStyle=new h(e||"")}catch(t){console.warn("\u89e3\u6790\u683c\u5f0f\u76f8\u5173\u6837\u5f0f\u62a5\u9519")}}},{key:"initInfoArrays",value:function(){return{styles:[[]],data:[[]],template:[[]],formula:[[]],cellSelect:[[]],dataValidations:[[]],propsKeys:this.propsKeys}}},{key:"setInfoItem",value:function(e){var t,r,n,o,a,s=e.styles,i=void 0===s?[[]]:s,u=e.data,l=void 0===u?[[]]:u,c=e.template,d=void 0===c?[[]]:c,f=e.formula,h=void 0===f?[[]]:f,m=e.cellSelect,p=void 0===m?[[]]:m,v=e.dataValidations,g=void 0===v?[[]]:v,y=e.index,_=e.info,b=e.propsKeys;i[y].push(_.style),l[y].push(null!==(t=_.data)&&void 0!==t?t:null),d[y].push(null!==(r=_.template)&&void 0!==r?r:null),h[y].push(null!==(n=_.formula)&&void 0!==n?n:null),p[y].push(null!==(o=_.cellSelect)&&void 0!==o?o:null),g[y].push(null!==(a=_.dataValidation)&&void 0!==a?a:null),Object.keys(b).forEach((function(e){return b[e][y].push(_[e])}))}},{key:"exceptionInExcel",value:function(e,t,r,n,o){var a,s=o.styles,i=o.data,u=o.template,l=o.formula,c=o.cellSelect,d=o.dataValidations,f=o.propsKeys,h=parseInt(null===(a=e.attributes.getNamedItem("colspan"))||void 0===a?void 0:a.value);if(h>1){var m=n.style.border,p=null===m||void 0===m?void 0:m.colors[1];m.colors[1]=null,r=!0,this.setInfoItem({styles:s,data:i,template:u,formula:l,propsKeys:f,cellSelect:c,dataValidations:d,index:t,info:n});for(var v=1;v<h;v++){var g={style:{border:{colors:[null,null,null,null],styles:[null,null,null,null]},cellcolor:""},data:null,template:{},formula:void 0};g.style.border.colors[0]=n.style.border.colors[0],g.style.border.colors[2]=n.style.border.colors[2],g.style.cellcolor=n.style.cellcolor,v===h-1&&(g.style.border.colors[t]=p),this.setInfoItem({styles:s,data:i,template:u,formula:l,propsKeys:f,cellSelect:c,dataValidations:d,index:t,info:g})}}return r}},{key:"getTablePropsNull",value:function(e){var t={};return Object.keys(e).forEach((function(e){t[e]=null})),t}},{key:"parseCell",value:function(e,t,r,n){var o=n.styles,a=n.data,s=n.template,i=n.formula,u=n.cellSelect,l=n.dataValidations,c=n.propsKeys;if(e){var d,f={style:{},data:null,template:{}},h=void 0;this.mSOStyle&&(h=this.cellsStyleMaps[t]&&this.cellsStyleMaps[t][r]),this.notify("beforeParseCell",e,h,f),M.a.getMiddleWaresByLevel(D.a.CELL_PROPS).map((function(t){return t.parseHTML(e,h)})).forEach((function(e){e&&Object.assign(f,e)}));var m=!1;"colspan"===(null===(d=h)||void 0===d?void 0:d["mso-ignore"])&&(m=this.exceptionInExcel(e,t,m,f,{styles:o,data:a,template:s,formula:i,cellSelect:u,dataValidations:l,propsKeys:c})),m||this.setInfoItem({styles:o,data:a,template:s,formula:i,propsKeys:c,cellSelect:u,dataValidations:l,index:t,info:f})}else void 0===a[t][r]&&this.setInfoItem({styles:o,data:a,template:s,formula:i,propsKeys:c,cellSelect:u,dataValidations:l,index:t,info:L({style:null,data:null,template:null,formula:null,cellSelect:null},this.getTablePropsNull(c))})}},{key:"parse",value:function(e,t){var r=this,n=t.isNowrap,o=t.noFormula,a=void 0!==o&&o;this.clearTableInfo(),this.tableDOM=e,this.nowrap=n,this.noFormula=a;for(var s=this.parseSizeInfo(),i=this.getStandardCells(e),u=this.initInfoArrays(),l=u.styles,c=u.data,d=u.template,f=u.formula,h=u.propsKeys,m=u.cellSelect,p=u.dataValidations,v=function(e,t){var n=i[e];l[e]=l[e]||[],c[e]=c[e]||[],d[e]=d[e]||[],f[e]=f[e]||[],m[e]=m[e]||[],p[e]=p[e]||[],Object.keys(h).forEach((function(t){h[t][e]=h[t][e]||[]}));for(var o=0,a=s?s.col:0;o<a;o++){var u=n[o];r.parseCell(u,e,o,{styles:l,data:c,template:d,formula:f,propsKeys:h,cellSelect:m,dataValidations:p})}},g=0,y=s?s.row:0;g<y;g++)v(g);return this.nowrap=null,L(L({styles:l,data:c,template:d,formula:f,cellSelect:m,mergeCells:this.mergeCells,size:s,hiddenRowCol:{hiddenRows:s.hiddenRows,hiddenCols:s.hiddenCols}},h),{},{selectType:"",dataValidations:p})}},{key:"parseData",value:function(e,t,r){var n,o,a="";e&&(null===(n=r.style)||void 0===n||null===(o=n.allTextFormatRuns)||void 0===o||o.forEach((function(e){a+=e.text})),(a=a||e.textContent)&&"\u3000"!=a&&"\xa0"!==a?(a=a.replace(/([\r\n])([^\S\r\n]+)/g,"$1"),r.data=a):r.data="")}},{key:"parseFormula",value:function(e,t,r){if(!this.noFormula&&e){var n=e.getAttribute("data-online-sheet-formula");r.formula=n&&"string"===typeof n?n:null}}},{key:"parseSelect",value:function(e,t,r){if(e){var n=e.getAttribute("data-online-sheet-type"),o=e.getAttribute("data-online-sheet-value");if(n!==I.EMBEDDED_OBJECT_TYPE.CELL_IMAGE&&o)try{r.cellSelect={value:N.a.deserialize(JSON.parse(o)),refId:e.getAttribute("data-online-sheet-refId"),type:Number(n)}}catch(a){r.cellSelect=null}else r.cellSelect=null}}},{key:"parseDataValidation",value:function(e,t,r){if(e){var n=e.getAttribute("data-online-sheet-validation");r.dataValidation=n?k.DataValidation.deserialize(JSON.parse(n)):null}}},{key:"parseFontFamily",value:function(e,t,r){var n=null===t||void 0===t?void 0:t["font-family"];n&&(r.style.fontfamily=T(n))}},{key:"parseFontSize",value:function(e,t,r){var n=null===t||void 0===t?void 0:t["font-size"];n&&(r.style.fontsize=S(n))}},{key:"parseFontColor",value:function(e,t,r){var n=null===t||void 0===t?void 0:t.color;if(n){var o=this.getHexColor(n);o&&(r.style.fontcolor=o)}}},{key:"getHexColor",value:function(e){if("string"==typeof e)return"#"==(e=this.getColorFromExcel(e))[0]?e:"rgb"==e.substring(0,3).toLowerCase()?(this.rgba2hex||(this.rgba2hex={}),this.rgba2hex[e]||(this.rgba2hex[e]=this.transRgba2hex(e)),this.rgba2hex[e]):b[e]?b[e]:void 0}},{key:"transRgba2hex",value:function(e){var t=e.toString().match(/\d+(\.\d+)?/g);if(null===t||void 0===t?void 0:t.length){var r=1;if(t[3]&&"undefined"!=typeof t[3]&&(r=Number(t[3])),0==r)return"";var n="#";if(1===r)for(var o=0;o<3;o++)n+=("0"+Number(t[o]).toString(16)).slice(-2);else{for(var a=0;a<3;a++)n+=("0"+Number(t[a]).toString(16)).slice(-2);n+=(255*r).toString(16).substring(0,2)}return n}}},{key:"parseFontWeight",value:function(e,t,r){var n=null===t||void 0===t?void 0:t["font-weight"];n&&("bold"!=n&&700!==parseInt(n)||(r.style.bold="bold"))}},{key:"parseFontStyle",value:function(e,t,r){var n=null===t||void 0===t?void 0:t["font-style"];n&&"italic"==n&&(r.style.italic="italic")}},{key:"parseFontDecoration",value:function(e,t,r){var n=null===t||void 0===t?void 0:t["text-decoration"];if(n&&(-1!=n.indexOf("underline")&&(r.style.underline="underline"),-1!=n.indexOf("line-through")&&(r.style.strikeline="strikeline")),e)for(var o=e.firstElementChild,a=10;o&&a--;)"u"==o.tagName.toLowerCase()?r.style.underline="underline":"s"==o.tagName.toLowerCase()&&(r.style.strikeline="strikeline"),o=o.firstElementChild}},{key:"parseBackgroundColor",value:function(e,t,r){var n=(null===t||void 0===t?void 0:t["background-color"])||(null===t||void 0===t?void 0:t.background);if(n){var o=this.getHexColor(n);o&&(r.style.cellcolor=o)}}},{key:"parseBorder",value:function(e,t,r){var n=this;function o(e){var t=e.split(" "),r=null;return t&&t.length>2&&(r=t.slice(0,2).join(" ")),r?function(e){var t={none:E.a.NONE,".5pt hairline":E.a.HAIR,".5pt dot-dash":E.a.DASH_DOT,".5pt dot-dot-dash":E.a.DASH_DOT_DOT,".5pt dotted":E.a.DOTTED,".5pt dashed":E.a.DASHED,".5pt solid":E.a.THIN,"1.0pt dot-dot-dash":E.a.MEDIUM_DASH_DOT_DOT,"1.0pt dot-dash-slanted":E.a.SLANTED_DASH_DOT,"1.0pt dot-dash":E.a.MEDIUM_DASH_DOT,"1.0pt dashed":E.a.MEDIUM_DASHED,"1.0pt solid":E.a.MEDIUM,"2.0pt double":E.a.DOUBLE,"1.5pt solid":E.a.THICK},r={".5pt dotted":E.a.DOTTED,".5pt dashed":E.a.DASHED,".5pt solid":E.a.THIN,"1.2pt solid":E.a.MEDIUM,"1.2pt dashed":E.a.MEDIUM_DASHED,"2.0pt solid":E.a.THICK,"2.0pt double":E.a.DOUBLE};return t[e]||r[e]||null}(r):null}if(t){var a=t?t["border-top"]||t.border:"0px",s=t?t["border-right"]||t.border:"0px",i=t?t["border-bottom"]||t.border:"0px",u=t?t["border-left"]||t.border:"0px",l=[parseInt(a)>0||parseFloat(a)>0,parseInt(s)>0||parseFloat(s)>0,parseInt(i)>0||parseFloat(i)>0,parseInt(u)>0||parseFloat(u)>0],c=function(e){if("string"==typeof e){var t=n.getHexColor(e);return"#dadbda"===t&&(t=void 0),t}},d=t.border&&c(t.border.split(/\s+/)[2]),f=[l[0]&&t["border-top"]?c(t["border-top"].split(/\s+/)[2]):d,l[1]&&t["border-right"]?c(t["border-right"].split(/\s+/)[2]):d,l[2]&&t["border-bottom"]?c(t["border-bottom"].split(/\s+/)[2]):d,l[3]&&t["border-left"]?c(t["border-left"].split(/\s+/)[2]):d],h=[l[0]&&a?o(a):null,l[1]&&s?o(s):null,l[2]&&i?o(i):null,l[3]&&u?o(u):null];r.style.border={colors:f,styles:h}}}},{key:"parseTextAlign",value:function(e,t,r){var n;(n="excel"===j.getApp()&&(null===e||void 0===e?void 0:e.align)||(null===t||void 0===t?void 0:t["text-align"]))&&("start"===(n=(n=n&&n.toLowerCase()||"").replace(/^-(webkit|moz)-(.*)/,"$2"))||"justify"===n?n="left":"end"===n&&(n="right"),"121"===n&&(n="center"),-1!==["right","left","center"].indexOf(n)&&(r.style.h_align=n))}},{key:"parseVerticalAlign",value:function(e,t,r){var n=null===t||void 0===t?void 0:t["vertical-align"];t&&(r.style.v_align=n)}},{key:"parseWhiteSpace",value:function(e,t,r){if(t){var n=e.style.whiteSpace,o=null===t||void 0===t?void 0:t["white-space"];o&&(n=o),"normal"===n?r.style.textwrap=n:this.nowrap?r.style.textwrap="nowrap":"nowrap"!==n&&(r.style.textwrap=n)}}},{key:"parseTextFormatRuns",value:function(e,t,r){if(e)try{var n=_(e,this.getHexColor,this.mSOStyle?this.mSOStyle.getComputedStyle:void 0),o=n.effectTextFormatRuns,a=n.allTextFormatRuns;r.style.textFormatRuns=o||[],r.style.allTextFormatRuns=a||[]}catch(s){}}},{key:"parseFormat",value:function(e,t,r){if(e){if(!this.mSOStyle)return;var n=t&&t["mso-number-format"];if(void 0!==n){n=n.replace(/^['|"]/,"").replace(/['|"]$/,"");var o=m.MSO_FORMAT_MAP[n];o&&(n=o),r.style.format_data=n}}}},{key:"parseLink",value:function(e,t,r){if(e){var n,a,s,i=e.getElementsByTagName("a");i.length&&function(){for(var t,u,l=void 0,c=[],d=0,f=i.length;d<f;d++){n=i[d].getAttribute("href"),s=i[d].dataset.tencent_doc_hyperlink_type||"";var h=i[d].getAttribute("data-sheets-hyperlink"),m=i[d].getAttribute("data-sheets-hyperlinkruns");try{var p=h?JSON.parse(h):void 0;Object(x.b)(p)&&(l=p)}catch(g){}try{var v=m?JSON.parse(m):void 0;Array.isArray(v)&&v.forEach((function(e){"object"===Object(o.a)(e)&&c.push(new F.a(e))}))}catch(g){}if(n)break}a=e.innerText,r.template={},r.template=C(n||a,a,s&&parseInt(s)||(null===(t=l)||void 0===t?void 0:t.hyperlinkType),null===(u=l)||void 0===u?void 0:u.linkIconStatus,c.length>0?c:void 0)}()}}},{key:"parseColCount",value:function(e){var t=this.getColGroupDOM(e),r=0;if(t)if(t.getAttribute("span"))r+=parseInt(t.getAttribute("span"));else for(var n=0,o=t.childElementCount;n<o;n++){var a=t.children[n],s=parseInt(a.getAttribute("span"));r+=s||1}else{var i,u,l=this.getTNodeDOM(e),c=l&&Object.entries(l.children).sort((function(e,t){return t[1].children.length-e[1].children.length}));if(l&&(i=c&&c[0][1]||l.firstElementChild),i&&(u=i.firstElementChild),u&&(u.tagName.toLowerCase()==U.TD_NODE||u.tagName.toLowerCase()==U.TH_NODE))for(var d=u;d;){var f=parseInt(d.getAttribute("colspan"));r+=f||1,d=d.nextElementSibling}}return r}},{key:"parseRowCount",value:function(e){var t=this.getTNodeDOM(e),r=0;return t&&(r=t.childElementCount),r}},{key:"parseColWidthsAndHidden",value:function(e,t){var r=this.getColGroupDOM(e),n=[];if(r)for(var o=r.getElementsByTagName("col"),a=0;a<o.length;a++){var s=o[a],i=parseInt(s.getAttribute("span"),10),u=parseInt(s.style.width,10),l=isNaN(u),c=O.a.isMac&&!l?u:parseInt(s.getAttribute("width"),10),d=!!s.getAttribute("hiddenCol");if(isNaN(i))n.push({hidden:d,size:c||null});else for(var f=0;f<i;f++)n.push({hidden:d,size:c})}else{var h,m=this.getTNodeDOM(e);if(m&&(h=m.firstElementChild),!h)return null;var p=h.getElementsByTagName("td");n=Array.from(p&&p.length>0?p:h.getElementsByTagName("th")).map((function(e){var t=!!e.getAttribute("hiddenCol");return null!=e.getAttribute("width")?{hidden:t,size:parseInt(e.getAttribute("width"),10)}:{hidden:t,size:null}}))}return n.length==t?n:null}},{key:"parseRowHeightsAndHidden",value:function(e,t){var r=this.getTNodeDOM(e);if(null===r||0===t)return null;var n=Array.from(r.getElementsByTagName(U.TR_NODE)).map((function(e){var t,r=!!e.getAttribute("hiddenRow"),n=parseInt(e.getAttribute("height"),10),o=parseInt(e.style.height,10);return isNaN(n)&&isNaN(o)&&null,{hidden:r,size:-1!==(null===(t=e.getAttribute("style"))||void 0===t?void 0:t.indexOf("mso-height-source:userset"))?O.a.isMac?isNaN(o)?n:o:isNaN(n)?o:n:null}}));return n.length==t?n:null}},{key:"standardizeCellsWithMergeCells",value:function(e){var t=[],r=[],n=[],o=this.parseSizeInfo();if(o)for(var a=0;a<o.row;a++){r[a]||(r[a]=[]),n[a]||(n[a]=[]);for(var s=e[a],i=0,u=0;i<o.col&&u<s.length;i++)if(void 0===r[a][i]){var l=s[u++];r[a][i]=l;var c=parseInt(l.getAttribute("rowspan"));c=c||1;var d=parseInt(l.getAttribute("colspan"));d=d||1;var f=this.mSOStyle&&this.mSOStyle.getComputedStyle(l)||{};n[a][i]=f;var h=f["mso-ignore"];if(h&&-1!==h.indexOf("colspan")&&(d=0),h&&-1!==h.indexOf("rowspan")&&(c=0),d>1)for(var m=1;m<d;m++){var p=l.cloneNode(!0);p.innerHTML="",r[a][i+m]=p}if(c>1)for(var v=1;v<c;v++){r[a+v]||(r[a+v]=[]);for(var g=0;g<d;g++){var y=l.cloneNode(!0);y.innerHTML="",r[a+v][i+g]=y}}(c>1||d>1)&&t.push({row:a,col:i,rowspan:c,colspan:d}),i+=d-1}}return this.mergeCells=t,this.cellsStyleMaps=n,r}},{key:"getStandardCells",value:function(e){var t=this.getCells(e),r=this.notify("beforeStandardizeCells",t);return void 0!=r&&(t=r),t}},{key:"getCells",value:function(e){if(!e)return!this.cells&&this.tableDOM&&(this.cells=this.getCells(this.tableDOM)),this.cells;var t=this.getTNodeDOM(e);if(t){for(var r=t.children,n=[],o=0,a=r?r.length:0;o<a;o++){for(var s=r[o].children,i=[],u=0,l=s?s.length:0;u<l;u++){var c=s[u];(c&&c.tagName.toLowerCase()==U.TD_NODE||c.tagName.toLowerCase()==U.TH_NODE)&&i.push(c)}n.push(i)}return n}}},{key:"getColGroupDOM",value:function(e){if(e){var t=e.firstElementChild;if(t&&"colgroup"==t.tagName.toLowerCase())return t;for(var r=e.children,n=1;n<r.length;n++)if(r[n]&&"colgroup"==r[n].tagName.toLowerCase())return r[n];return null}return!this.colgroup&&this.tableDOM&&(this.colgroup=this.getColGroupDOM(this.tableDOM)),this.colgroup}},{key:"getTNodeDOM",value:function(e){if(!e)return null;for(var t=null,r=0;r<e.children.length;r++){var n=e.children[r];if(n&&n.tagName.toLowerCase()===U.THEAD_NODE||n&&n.tagName.toLowerCase()===U.TBODY_NODE)if(t)for(var o=n.children;0<o.length;)t.appendChild(o[0]);else t=n}return t}},{key:"subscribe",value:function(e,t){if(Array.isArray(t))for(var r=0,n=t.length;r<n;r++)this.subscribe(e,t[r]);this.notificationCenter[e]?this.notificationCenter[e].push(t):this.notificationCenter[e]=[t]}},{key:"notify",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];for(var o=this.notificationCenter[e],a=-1,s=o?o.length:0,i=null,u=[],l=1,c=arguments.length;l<c;l++)u.push(arguments[l]);for(;++a<s;){var d=o[a],f=d.apply(this,u);void 0!=f&&(i=f)}return i}}]),e}();H.getSingleton=function(){return G};var G=new H,V=H,W=r("./src/core/feature/copyPaste/copyPasteShape.ts"),Y=r("./src/core/feature/copyPaste/lib/parsers/validUrl.ts"),z=r("../node_modules/@tencent/dui/lib/components/Snackbar/index.js"),K=r.n(z);function q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?q(Object(r),!0).forEach((function(t){Object(a.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var X=function(){function e(){var t=this;Object(s.a)(this,e),this.cacheLinkFn=function(e){t.cacheLink=e}}return Object(i.a)(e,[{key:"securityCheck",value:function(e){return e=this.deleteTagByTagName(e,"script"),e=this.deleteTagByTagName(e,"iframe")}},{key:"deleteTagByTagName",value:function(e,t){if(!e||!t)return e;for(var r,n=e,o=100;o--;){if((r=this.deleteOneTagByTagName(n,t))===n)return r;n=r}return 0==o?"":r}},{key:"deleteOneTagByTagName",value:function(e,t){if(!t)return e;var r=e.indexOf("<"+t);if(-1!=r){var n=e.indexOf("</"+t);if(-1!=n)return e.substring(0,r)+e.substring(n+t.length+3)}return e}},{key:"parsePasteTableHTML",value:function(e,t){var r=t.noFormula;return V.getSingleton().parse(e,{isNowrap:!0,noFormula:r})}},{key:"fillRangeItem",value:function(e,t){var r=t.maxCols;return e.map((function(e){var t=e.length;return e=e.concat(new Array(r-t))}))}},{key:"cellsToRange",value:function(e){e.data=this.fillRangeItem(e.data,e),e.styles=this.fillRangeItem(e.styles,e),e.template=this.fillRangeItem(e.template,e),e.formula=this.fillRangeItem(e.formula,e)}},{key:"initResult",value:function(){return{styles:[],data:[],template:[],formula:[],mergeCells:[],size:null,hiddenRowCol:{hiddenRows:[],hiddenCols:[]},selectType:"",hasRowValue:!1,images:[],maxCols:0}}},{key:"parseHTML",value:function(e){if(!e)return null;if(e=this.securityCheck(e),!(e=this.clipHTML(e)))return null;var t=(new DOMParser).parseFromString(e,"text/html");this.fromApp=j.getApp(t);var r=this.parseSelectType(t);if(t&&t.body){this.styleHTML="";for(var n=t.getElementsByTagName(U.STYLE_NODE),o=0;o<(null===n||void 0===n?void 0:n.length);o++)n[o]&&(this.styleHTML+=n[o].innerHTML);V.getSingleton().setStyleGroup(this.styleHTML);var a=this.initResult();return this.parseNodes(t.body,a),a?(a.containTable&&a.containText&&(this.cellsToRange(a),a.size=null,a.hiddenRowCol=null),a.selectType=r,{table:a,images:a.images,fromApp:this.fromApp,containTable:a.containTable}):null}}},{key:"parseImgIntable",value:function(e,t,r,n,o){for(var a,s=[].slice.call(e.rows),i=t.parentNode;i.tagName.toLowerCase()!==U.TD_NODE;)i=i.parentNode;for(var u=i.parentNode;u.tagName.toLowerCase()!==U.TR_NODE;)u=u.parentNode;if(-1===s.indexOf(u)){for(i=i.parentNode;i.tagName.toLowerCase()!==U.TD_NODE;)i=i.parentNode;for(u=i.parentNode;u.tagName.toLowerCase()!==U.TR_NODE;)u=u.parentNode}var l=[].slice.call(u.children),c=parseInt((null===(a=i)||void 0===a?void 0:a.getAttribute("colSpan"))||"1",10);return r=0+l.indexOf(i)*c,{imgRow:0+s.indexOf(u),col:r}}},{key:"handleImgElement",value:function(e){var t,r=e.totalRows,n=e.tagName,o=e.node,a=e.images,s=Array.from(o.getElementsByTagName("img"));if("img"===n&&(s=[o]),null===(t=s)||void 0===t?void 0:t.length)for(var i=0;i<s.length;i++){var u=s[i],l=u.src,c=0,d=0+r,f=d,h=u.getAttribute("width"),m=u.getAttribute("height");if(!u.getAttribute("tencent-sheet-cell-img")&&!(h&&Number(h)<=2&&m&&Number(m)<=2)){var p=null!==u.attributes.getNamedItem("v:shapes");if(n===U.TABLE_NODE){if("tencent-sheet-float-img"!==u.getAttribute("type"))continue;var v=this.parseImgIntable(o,u,c,d,f);f=v.imgRow,c=v.col}else if(n!==U.IMG_NODE){var g=o.innerText||"";f=d,(g=g.replace(/^\s+|\s+$/g,"")).length>0&&(d+=1)}var y=this.getImageData(u,l,f,c,p);y&&a.push(y)}}}},{key:"makeMap",value:function(e){for(var t={},r=e.split(","),n=0;n<r.length;n++)t[r[n]]=!0;return t}},{key:"getChildren",value:function(e){return e?e.childNodes:[]}},{key:"getStyle",value:function(e){var t=e.style,r=t.fontWeight,n=t.color,o=t.fontFamily,a=t.fontSize,s=t.fontStyle,i=t.textDecoration;return{bold:"bold"===r||"700"===r?"bold":null,fontcolor:n||null,fontfamily:o?T(o):null,fontsize:a?S(a):null,italic:s||null,underline:i.indexOf("underline")>-1?"underline":null,strikeline:i.indexOf("line-through")>-1?"strikeline":null}}},{key:"setEnterFormat",value:function(e){for(var t=0;t<e.styles.length;t++){var r=e.styles[t];if(r)for(var n=0;n<r.length;n++){var o,a,s,i,u,l,c,d,f,h=null===(o=r[n])||void 0===o?void 0:o.textFormatRuns;if(1===(null===h||void 0===h?void 0:h.length))e.styles[t][n]=Q(Q({},e.styles[t][n]),{},{bold:null===(a=h[n])||void 0===a||null===(s=a.format)||void 0===s?void 0:s.bold,fontfamily:null===(i=h[n])||void 0===i||null===(u=i.format)||void 0===u?void 0:u.fontfamily,fontsize:null===(l=h[n])||void 0===l||null===(c=l.format)||void 0===c?void 0:c.fontsize,fontcolor:null===(d=h[n])||void 0===d||null===(f=d.format)||void 0===f?void 0:f.fontcolor})}}}},{key:"insertNewLine",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(e.hasRowValue||t)&&(e.data.push([""]),e.styles.push([]),e.formula.push([]),e.template.push([]),e.h_align=""),e.hasRowValue=!1}},{key:"mergeTableData",value:function(e,t){var r=t.styles,n=t.data,o=t.template,a=t.formula,s=t.mergeCells,i=t.size,u=t.hiddenRowCol,l=t.cellSelect,c=t.dataValidations;e.styles=e.styles!==[[]]?e.styles.concat(r):r,e.data=e.data!==[[]]?e.data.concat(n):n,e.template=e.template!==[[]]?e.template.concat(o):o,e.formula=e.formula!==[[]]?e.formula.concat(a):a,e.cellSelect=l,M.a.getAllMiddleWares({level:D.a.CELL_PROPS,tableProps:!0}).forEach((function(r){var n=r.desc.tableProps,o=void 0===n?"":n;e[o]=t[o]})),e.size=i,e.hiddenRowCol=u,e.dataValidations=c;var d=s.map((function(t){return Q(Q({},t),{},{row:Math.max(e.data.length,0)-Math.max(n.length,0)+t.row})}));e.mergeCells=e.mergeCells.concat(d)}},{key:"handleATag",value:function(e,t){var r,n,a=e.getAttribute("href"),s=e.getAttribute("data-sheets-hyperlink"),i=e.getAttribute("data-sheets-hyperlink"),u=void 0,l=[];try{var c=s?JSON.parse(s):void 0;Object(x.b)(c)&&(u=c)}catch(p){}try{var d=i?JSON.parse(i):void 0;Array.isArray(d)&&d.forEach((function(e){"object"===Object(o.a)(e)&&l.push(new F.a(e))}))}catch(p){}var f=e.dataset.tencent_doc_hyperlink_type||"",h=e.innerText;h&&(h=h.trim()),t.hasRowValue=!0;var m=C(a||h,h,f&&parseInt(f)||(null===(r=u)||void 0===r?void 0:r.hyperlinkType),null===(n=u)||void 0===n?void 0:n.linkIconStatus,l.length>0?l:void 0);this.cacheLinkFn(m)}},{key:"handleTextTag",value:function(e,t,r,n){var o,a,s=(null===(o=(r.styles[t]||[])[0])||void 0===o?void 0:o.textFormatRuns)||[],i=(n[t]||[])[0]||"";s.push({startIndex:i.length,format:this.getStyle(e.parentElement)}),r.styles[t]=[{textFormatRuns:s,h_align:r.h_align}],r.hasRowValue=!0,r.containText=!0;var u=(null===(a=e.nodeValue)||void 0===a?void 0:a.trim())||"";Object(Y.a)(u)&&(r.template[t]=[C(u,u)],s[s.length-1].format=null);n[t]=[(i||"")+e.nodeValue],"a"===r.parentTag&&this.cacheLink&&(r.template[t]=[this.cacheLink],this.cacheLink=null)}},{key:"parseNodes",value:function(e,t){for(var r=this.makeMap("style,meta,script,title,xml"),n=this.makeMap("a,address,article,applet,aside,audio,blockquote,button,canvas,center,div,dd,del,dir,dl,dt,fieldset,figcaption,figure,footer,form,frameset,h1,h2,h3,h4,h5,h6,header,hgroup,iframe,img,ins,isindex,li,map,menu,noframes,noscript,object,ol,output,p,pre,section,script,table,tbody,td,tfoot,th,thead,tr,ul,video"),o=this.getChildren(e),a=0;a<o.length;a++){var s=t.data||[],i=Math.max(s.length-1,0),u=o[a];if(!r[u.nodeName.toLowerCase()])if(u.nodeType===Node.TEXT_NODE){var l;if(!(null===(l=u.nodeValue)||void 0===l?void 0:l.trim().length))continue;this.handleTextTag(u,i,t,s)}else if(u.nodeType===Node.ELEMENT_NODE){var c=u.nodeName.toLowerCase();if(c===U.IMG_NODE){var d=this.getImageData(u,u.src,i,0,!1);d&&t.images.push(d)}if(c===U.BR_NODE||c===U.HR_NODE){this.insertNewLine(t,!0);continue}if(c===U.A_NODE&&this.handleATag(u,t),c===U.TABLE_NODE){var f=this.parsePasteTableHTML(u,{noFormula:"tencent"!==this.fromApp});this.mergeTableData(t,f),this.handleImgElement({totalRows:i,tagName:U.TABLE_NODE,node:u,images:t.images});var h=f.data[0].length;t.maxCols=Math.max(1,t.maxCols,h),t.containTable=!0,t.hasRowValue=!0;continue}n[c]&&(t.h_align=u.style.textAlign,t.parentTag=c,this.insertNewLine(t)),this.parseNodes(u,t)}}}},{key:"domainFromUrl",value:function(e){var t,r;return(r=e.match(/^(?:https?:\/\/)?(?:[^@\n]+@)?(?:www\.)?([^:\/\n\?\=]+)/im))&&(r=(t=r[1]).match(/^[^\.]+\.(.+\..+)$/))&&(t=r[1]),t}},{key:"getImageData",value:function(e,t,r,o,a){var s,i=/^data:image\/(png|gif|jpeg|x-icon|jpg|tiff);base64,.+/i.test(t),u="";if(u=(null===(s=window)||void 0===s?void 0:s.devicePixelRatio)>=2?W.d:W.b,t.match(/^file:\/\/[\/].+(gif|jpg|jpeg|tiff|png)$/i)||t.match(/^[a-zA-Z]:.+(gif|jpg|jpeg|tiff|png)$/i)||a&&t&&!i)return t=u,e.src=t,{isFromHTML:!0,id:"attachment-"+ +new Date+"-"+Object(W.c)(4),url:t,order:void 0,size:{width:440,height:330},anchor:{row:r,col:o},offset:{x:0,y:0},clipInfo:{clipTop:0,clipLeft:0,clipRight:0,clipBottom:0}};if(Object(Y.a)(t)||i){var l=["qpic.cn"].concat(R.f),c=this.domainFromUrl(t),d=c&&-1!==l.indexOf(c),f=e.style.width?parseInt(e.style.width.replace("px","")):-1,h=e.style.height?parseInt(e.style.height.replace("px","")):-1,m=0,p=0,v=0,g=0,y=e.dataset.clip;if(y){var _=y.match(/[\d\.]+/g);if(_&&_.length>=4){var b=_.map(Number),A=Object(n.a)(b,4);m=A[0],p=A[1],v=A[2],g=A[3]}}var E=e.style.marginLeft?parseInt(e.style.marginLeft.replace("px","")):-1,j=e.style.marginTop?parseInt(e.style.marginTop.replace("px","")):-1;return{isFromHTML:!0,url:d?t:u,id:"attachment-"+ +new Date+"-"+Object(W.c)(4),type:"pic",order:void 0,anchor:{row:r,col:o},offset:{x:E,y:j},size:{width:f,height:h},clipInfo:{clipTop:m,clipLeft:g,clipRight:p,clipBottom:v}}}return null}},{key:"parseSelectType",value:function(e){if(!e)return null;var t=e.getElementsByTagName("table")[0];return t&&t.getAttribute("selectType")}},{key:"clipHTML",value:function(e){if(!e)return null;function t(e,t,r,n){var o=e.indexOf(t),a=e.lastIndexOf(r);return-1!=o&&-1!=a&&(n?o+=t.length:a+=r.length,e=e.substring(o,a)),e}var r="<html>\r\n<body>\r\n\x3c!--StartFragment--\x3e",n="\x3c!--EndFragment--\x3e\r\n</body>\r\n</html>";return e=t(e,r,n,!0),e=t(e,r="<html",n="</html>",!1)}},{key:"parseHyperLinkRun",value:function(e){!!e.querySelector("#isFromOutHyperLinkRun")&&K.a.show({type:"info",message:"\u94fe\u63a5\u5931\u6548",autoClose:!0})}},{key:"getParsedDocument",value:function(e){return(new DOMParser).parseFromString(e,"text/html")}}],[{key:"getSingleton",value:function(){return J}}]),e}(),J=new X;t.a=X},"./src/core/feature/copyPaste/lib/PasteSpecial/PasteSpecial.ui.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.array.concat.js");var n=r("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=r("./src/core/feature/copyPaste/lib/PasteSpecial/PasteSpecialMenu/PasteSpecialMenu.ui.ts"),i=r("./src/core/feature/copyPaste/lib/PasteSpecial/PasteSpecialPanel/PasteSpecialPanel.ui.ts"),u=r("./src/core/feature/copyPaste/lib/PasteSpecial/logics/userAction.ts"),l=r("./src/core/feature/copyPaste/lib/PasteSpecial/position.ui.ts"),c=r("./src/core/feature/copyPaste/lib/PasteSpecial/logics/pasteTypes.ts"),d=r("./src/base/event/event.ts"),f=r("../packages/report/src/index.ts"),h=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),m=r.n(h),p=e.$;function v(e,t,r,n){e.addEventListener?e.addEventListener(t,r,n):e.attachEvent&&e.attachEvent("on"+t,(function(){r(window.event)}))}function g(e,t,r,n){e.removeEventListener?e.removeEventListener(t,r,n):e.detachEvent&&e.detachEvent("on"+t,(function(){r(window.event)}))}var y=m.a.isFirefox?"DOMMouseScroll":"mousewheel",_=function(){function e(t){var r=t.styleCssText,n=t.stateBefore,a=t.pasteData,u=t.active,l=t.hotInstance,c=t.fromCache,d=t.__mergeBefore,f=t.itemsOptions,h=t.closeCb,m=t.envs;Object(o.a)(this,e),this.wrap=document.querySelector("#canvasContainer"),this.containerCls="paste-special-container",this.domIdPasteSpecialMenu="paste-special-menu",this.domIdPasteSpecialPanel="paste-special-panel",this.init(r),this.render(),this.childComponents=[],this.childComponents[0]=new s.a({handleClick:this.handleClickMenu.bind(this)},document.body.querySelector('[data-id="'.concat(this.domIdPasteSpecialMenu,'"]'))),this.childComponents[1]=this.pasteSpecialPanel=new i.a({handleClickItem:this.handleClickItem.bind(this),fromCache:c,itemsOptions:f},document.body.querySelector('[data-id="'.concat(this.domIdPasteSpecialPanel,'"]'))),this.pasteCacheData={pasteData:a,stateBefore:n,active:u,hotInstance:l,__mergeBefore:d,smartSplitObj:[],cacheDoneActionsLength:l.undoredoStack.undoStack.length},this.registerListener(),this.smartSplitMenuCB,this.closeCb=h,this.envs=m||{}}return Object(a.a)(e,[{key:"init",value:function(e){this.styleCssText=e}},{key:"enableSmartSplitObj",value:function(e,t){window.CoreSheet.configurations&&window.CoreSheet.configurations.aiAutoColumnEnable&&(this.pasteCacheData.smartSplitObj=e,this.childComponents[1].setSmartSplitEnable(),"function"===typeof t&&(this.smartSplitMenuCB=t))}},{key:"triggerSmartSplit",value:function(){var e=this.pasteCacheData,t=e.pasteData,r=e.active,n=e.hotInstance,o=(e.__mergeBefore,e.cacheDoneActionsLength),a=e.smartSplitObj;Object(u.b)({pasteData:t,type:c.e,active:r,hotInstance:n,cacheDoneActionsLength:o,smartSplitObj:a,envs:this.envs})}},{key:"registerListener",value:function(){this.pasteCacheData.hotInstance;this.closeBind=this.close.bind(this),this.setPanelHideBind=this.setPanelHide.bind(this),this.tableMoveHandlerBind=this.tableMoveHandler.bind(this),this.scaleHandlerBind=this.scaleHandler.bind(this),d.c.default.listen("enterInputStatus",this.closeBind,"ignoreOffline"),d.c.default.listen("changeActivation",this.closeBind,"ignoreOffline"),d.c.default.listen("tableMove",this.tableMoveHandlerBind),d.c.default.listen("scale",this.scaleHandlerBind),this.registerDocumentOnmousewheel(),this.registerDocumentClick()}},{key:"tableMoveHandler",value:function(){this.resetPosition()}},{key:"scaleHandler",value:function(){this.resetPosition()}},{key:"unRegisterListener",value:function(){this.pasteCacheData.hotInstance;d.c.default.remove("enterInputStatus",this.closeBind),d.c.default.remove("changeActivation",this.closeBind),d.c.default.remove("tableMove",this.tableMoveHandlerBind),d.c.default.remove("scale",this.scaleHandlerBind),g(document,"click",this.documentClick,!0),g(document,y,this.documentOnmousewheel,!0)}},{key:"calTableMovePrevent",value:function(){return"block"===this.pasteSpecialPanel.rootEl.style.display}},{key:"render",value:function(){var e=document.body.querySelector(".".concat(this.containerCls)),t=this.wrap;t&&(e||((e=document.createElement("div")).classList.add(this.containerCls),t.appendChild(e)),e.style.cssText=this.styleCssText,this.container=e,e.innerHTML='\n            <div class="paste-panel-container" style="visibility: visible;" >\n                <div data-id="'.concat(this.domIdPasteSpecialMenu,'" style="visibility: visible;"></div>\n                <div data-id="').concat(this.domIdPasteSpecialPanel,'" style="display: none;"></div>\n            </div>\n        '))}},{key:"resetPosition",value:function(){var e=this.pasteCacheData.hotInstance,t=Object(l.a)(e);if(t){var r=Object(n.a)(t,3),o=r[0],a=r[1],s=r[2];this.container.style.left="".concat(a+"px"),this.container.style.top="".concat(o+"px"),s&&(this.container.style.display="none")}}},{key:"handleClickItem",value:function(e){var t=this.pasteCacheData,r=t.pasteData,n=t.active,o=t.hotInstance,a=(t.__mergeBefore,t.cacheDoneActionsLength),s=t.smartSplitObj;this.togglePanelShowHide(),Object(u.b)({pasteData:r,type:e,active:n,hotInstance:o,cacheDoneActionsLength:a,smartSplitObj:s,envs:this.envs}),o.view.canvas.inputManager.focus(),e===c.e&&this.smartSplitMenuCB&&(this.smartSplitMenuCB(),f.b.tdwReport({opername:"doc_excel_editor",module:"excel_paste_split",action:"clk_menu"}),this.envs&&this.envs.pasteSpecialType&&this.envs.pasteSpecialType!==c.e&&f.b.tdwReport({opername:"doc_excel_editor",module:"excel_paste_split",action:"clk_menu_indirect"}))}},{key:"registerDocumentClick",value:function(){var e=this,t=this.container;this.documentClick=function(r){if(!1!==r.isTrusted){var n=r.target;n===t||t.contains&&t.contains(n)||e.close()}},v(document,"click",this.documentClick,!0)}},{key:"registerDocumentOnmousewheel",value:function(){var e=this.container;this.documentOnmousewheel=function(t){var r=t.target;if(this.calTableMovePrevent())return t.preventDefault(),window.event?t.cancelBubble=!0:t.stopPropagation(),void(t.stopPropagation&&t.stopPropagation());r===e||e.contains(r)||r.classList.contains("filter-span")||this.resetPosition()}.bind(this),v(document,y,this.documentOnmousewheel,!0)}},{key:"handleClickMenu",value:function(){this.togglePanelShowHide()}},{key:"togglePanelShowHide",value:function(){var e=this.childComponents[1].rootEl,t=this.childComponents[0].rootEl;if("none"===e.style.display){var r=p(window).height()-p(t).height()-p(t).offset().top+p(document).scrollTop(),n=p(window).width()-p(t).width()-p(t).offset().left+p(document).scrollLeft(),o=p(e).width(),a=p(e).height()+11;r<a&&(e.style.top="-"+a+"px",e.style.position="absolute"),n<o&&(e.style.left="-"+o+"px",e.style.position="absolute")}else t.style.position="static";e.style.display="block"===e.style.display?"none":"block"}},{key:"setPanelHide",value:function(){this.childComponents[1].rootEl.style.display="none"}},{key:"close",value:function(){try{var e=this.wrap;if(!e)return;e.removeChild(this.container)}catch(t){}this.unRegisterListener(),"function"===typeof this.closeCb&&this.closeCb()}}]),e}();t.a=_}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/feature/copyPaste/lib/PasteSpecial/PasteSpecialMenu/PasteSpecialMenu.less":function(e,t,r){var n=r("../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/feature/copyPaste/lib/PasteSpecial/PasteSpecialMenu/PasteSpecialMenu.less");"string"===typeof n&&(n=[[e.i,n,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};r("../node_modules/style-loader/lib/addStyles.js")(n,o);n.locals&&(e.exports=n.locals)},"./src/core/feature/copyPaste/lib/PasteSpecial/PasteSpecialMenu/PasteSpecialMenu.ui.ts":function(e,t,r){"use strict";var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=(r("./src/core/feature/copyPaste/lib/PasteSpecial/PasteSpecialMenu/PasteSpecialMenu.less"),function(){function e(t,r){Object(n.a)(this,e),this.props=t,this.rootEl=r,this.render(),this.registerListener()}return Object(o.a)(e,[{key:"componentWillReceiveProps",value:function(e){this.props=e,this.render()}},{key:"getTemplate",value:function(){return'\n          <div class="postpaste-parent" style="top: 297px; left: 508px; width: 32px; height: 26px;">\n              <div id="post-paste-menu" class="postpaste-container tx-toolbar-menu-button tx-inline-block" aria-label="\u7c98\u8d34\u683c\u5f0f" title="\u7c98\u8d34\u683c\u5f0f" role="button" tabindex="0" aria-expanded="false" style="user-select: none;" aria-haspopup="true">\n                  <div class="tx-toolbar-menu-button-outer-box tx-inline-block">\n                      <div class="tx-toolbar-menu-button-inner-box tx-inline-block">\n                          <div class="tx-toolbar-menu-button-caption tx-inline-block">\n                              <div class="docs-icon tx-inline-block ">\n                                  <div class="docs-icon-img-container tx-docs-icon-img docs-icon-paste" aria-hidden="true"> </div>\n                              </div>\n                          </div>\n                          <div class="tx-toolbar-menu-button-dropdown postpaste-arrow tx-inline-block"> </div>\n                      </div>\n                  </div>\n              </div>\n          </div>\n    '}},{key:"render",value:function(){this.rootEl.innerHTML=this.getTemplate()}},{key:"registerListener",value:function(){var e=this.props.handleClick,t=void 0===e?function(){}:e;this.rootEl.addEventListener("click",t)}},{key:"close",value:function(){}}]),e}());t.a=a},"./src/core/feature/copyPaste/lib/PasteSpecial/PasteSpecialPanel/PasteSpecialPanel.less":function(e,t,r){var n=r("../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/lib/index.js?!../node_modules/less-loader/dist/cjs.js!./src/core/feature/copyPaste/lib/PasteSpecial/PasteSpecialPanel/PasteSpecialPanel.less");"string"===typeof n&&(n=[[e.i,n,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};r("../node_modules/style-loader/lib/addStyles.js")(n,o);n.locals&&(e.exports=n.locals)},"./src/core/feature/copyPaste/lib/PasteSpecial/PasteSpecialPanel/PasteSpecialPanel.ui.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.find.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=(r("./src/core/feature/copyPaste/lib/PasteSpecial/PasteSpecialPanel/PasteSpecialPanel.less"),r("./src/core/feature/copyPaste/lib/PasteSpecial/logics/pasteTypes.ts")),s=function(){function t(e,r){Object(n.a)(this,t),this.props=e,this.rootEl=r,this.render(),this.registerListener()}return Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.props=e,this.render()}},{key:"getTemplate",value:function(){var t,r,n,o,s=this.props,i=(s.fromCache,s.itemsOptions),u='\n    <div class="tx-menuitem postpaste-menu-item tx-menuitem-disabled" role="menuitem" aria-disabled="true" style="user-select: none;" data-id="'.concat(a.e,'">\n        <div class="tx-menuitem-content" style="user-select: none;" data-id="').concat(a.e,'" aria-disabled="true">\u667a\u80fd\u5206\u5217</div>\n    </div>'),l="</div>";return'\n<div class="tx-menu tx-menu-vertical" role="menu" aria-haspopup="true" style="'.concat((null===(t=e)||void 0===t||null===(r=t.CoreSheet)||void 0===r?void 0:r.configurations.aiAutoColumnEnable)?"height: 192px":"height: 160px",'" >\n  <div class="tx-menuitem postpaste-menu-item" role="menuitem" aria-disabled="false" style="user-select: none;" data-id="').concat(a.b,'">\n    <div class="tx-menuitem-content" style="user-select: none;" data-id="').concat(a.b,'">\u4fdd\u7559\u6e90\u683c\u5f0f</div>\n  </div>\n  <div class="tx-menuitem postpaste-menu-item" role="menuitem" aria-disabled="false" style="user-select: none;" data-id="').concat(a.c,'">\n    <div class="tx-menuitem-content" style="user-select: none;" data-id="').concat(a.c,'">\u5408\u5e76\u683c\u5f0f</div>\n  </div>\n  <div class="tx-menuitem postpaste-menu-item role="menuitem"  aria-hidden="true" data-id="').concat(a.d,'">\n    <div class="tx-menuitem-content" style="user-select: none;" data-id="').concat(a.d,'">\u4ec5\u7c98\u8d34\u503c</div>\n  </div>\n\n  <div class="tx-menuitem postpaste-menu-item role="menuitem"  aria-hidden="true" data-id="').concat(a.a,'">\n    <div class="tx-menuitem-content" style="user-select: none;" data-id="').concat(a.a,'">\u6e05\u9664\u81ea\u52a8\u8bc6\u522b</div>\n  </div>\n  <div class="tx-menuseparator" style="user-select: none;"  role="separator" id=":1o"></div>\n  <div class="tx-menuitem postpaste-menu-item ').concat(i.disableTranspose&&"tx-menuitem-disabled",'" role="menuitem" aria-disabled="').concat(i.disableTranspose&&"true",'" style="user-select: none;" data-id="').concat(a.f,'">\n    <div class="tx-menuitem-content" style="user-select: none;" data-id="').concat(a.f,'" aria-disabled="').concat(i.disableTranspose&&"true",'">\u8f6c\u7f6e\u884c\u5217</div>\n  </div>').concat((null===(n=e.CoreSheet)||void 0===n||null===(o=n.configurations)||void 0===o?void 0:o.aiAutoColumnEnable)?u:"").concat(l)}},{key:"render",value:function(){this.rootEl.innerHTML=this.getTemplate(this.props.data)}},{key:"setMenuStatus",value:function(e,t){var r=$(this.rootEl).find('.tx-menuitem[data-id="'.concat(e,'"]'));t&&r.hasClass("tx-menuitem-disabled")&&r.removeClass("tx-menuitem-disabled"),r.attr("aria-disabled",(!t).toString()),r.find('.tx-menuitem-content[data-id="'.concat(e,'"]')).attr("aria-disabled",(!t).toString())}},{key:"setSmartSplitEnable",value:function(){this.setMenuStatus(a.e,!0)}},{key:"registerListener",value:function(){var e=this.props.handleClickItem,t=void 0===e?function(){}:e;this.rootEl.addEventListener("click",(function(e){var r=e.target,n=r.getAttribute("data-id");"true"!==r.getAttribute("aria-disabled")&&t(n)}))}},{key:"close",value:function(){}}]),t}();t.a=s}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/feature/copyPaste/lib/PasteSpecial/index.ui.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.string.trim.js");var n=r("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),o=r("./src/core/feature/copyPaste/lib/PasteSpecial/PasteSpecial.ui.ts"),a=r("./src/core/feature/copyPaste/lib/PasteSpecial/position.ui.ts"),s=r("./src/core/feature/copyPaste/lib/smartSplit/SmartSplit.ts"),i=r("./src/core/feature/copyPaste/lib/PasteSpecial/logics/pasteTypes.ts"),u=r("./src/core/feature/copyPaste/interfaces.ts"),l=r("../packages/report/src/index.ts"),c=null;function d(){}function f(e){var t=e.hotInstance,r=e.active,s=e.fromCache,i=e.pasteType,l=(e.doPasteCb,e.smartSplitObj,e.closeCb),d=e.envs,f=t.view.getSelection().rangeSelections[0],h=Object(a.a)(t,!0);if(h){var m=Object(n.a)(h,2),p=m[0],v=m[1];if(i!==u.b.cut){var g=this.stateBefore,y=this.__mergeBefore,_=this.pasteData;c&&c.close(),c=new o.a({styleCssText:"\n            position: fixed;\n            left: ".concat(v+"px",";\n            top: ").concat(p+"px",";\n            z-index: 104;\n        "),stateBefore:g,pasteData:_,active:r,hotInstance:t,fromCache:s,__mergeBefore:y,closeCb:l,envs:d,itemsOptions:{disableTranspose:f.startColIndex===f.endColIndex&&f.startRowIndex===f.endRowIndex}})}}}t.b=function(e){var t=e.hotInstance,r=e.active,n=e.fromCache,o=e.pasteType,a=e.doPasteCb,u=e.toCheckSmartSplit,h=e.envs,m=e.isNewSheet;f.bind(this,{hotInstance:t,active:r,fromCache:n,pasteType:o,doPasteCb:a,closeCb:d,envs:h})();var p=t&&t.feature&&t.feature.copyPaste&&t.feature.copyPaste.value||"";h&&h.triggeredBySP&&Object(s.c)()?c&&h.pasteSpecialType!==i.e&&c.enableSmartSplitObj(Object(s.c)(),(function(){})):h&&h.triggeredBySP||!0!==u||""===p.trim()?Object(s.g)(null):(Object(s.d)(p,(function(e){c&&c.enableSmartSplitObj(e,(function(){Object(s.e)()})),Object(s.h)(t,(function(){c&&c.triggerSmartSplit(),m&&l.b.tdwReport({opername:"doc_excel_editor",module:"excel_paste_split",action:"new_sheet_trigger"})}),c)})),l.b.tdwReport({opername:"doc_excel_editor",module:"excel_paste_split",action:"active_trigger"}))};var h=function(){c&&c.close(),c=null}},"./src/core/feature/copyPaste/lib/PasteSpecial/logics/pasteTypes.ts":function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return a})),r.d(t,"f",(function(){return i})),r.d(t,"e",(function(){return u})),r.d(t,"a",(function(){return s}));var n="keepDefault",o="mergeStyles",a="onlyValues",s="clearAutoParse",i="transpose",u="smartSplit"},"./src/core/feature/copyPaste/lib/PasteSpecial/logics/userAction.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return _}));r("../node_modules/core-js/modules/es.object.assign.js"),r("../node_modules/regenerator-runtime/runtime.js");var n=r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),o=(r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),function(e){return Array.isArray(e)&&e.length>0?e[0].map((function(t,r){return e.map((function(e){return e[r]}))})):e}),a=r("./src/core/feature/copyPaste/interfaces.ts"),s=r("./src/base/util/object.ts");var i=function(e){var t,r=Object(s.clone)(e),n=r.merge,i=r.rowDataUpdate;return r.fromType=a.d.OUTER,r.merge=(t=n)?o(t).map((function(e,t){return e.map((function(e,t){return e?{w:e.h,h:e.w}:e}))})):t,r.rowDataUpdate=function(e){var t=e.map((function(e){return e.values}));return o(t).map((function(e){return{values:e}}))}(i),r},u=r("../packages/model/src/cell/CellDataSlot.ts"),l=(r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js")),c=r("../packages/model/src/cell/ExtendedValueType.ts"),d=r("../packages/model/src/factory/index.ts");function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){Object(l.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var m=function(e){var t=Object(s.clone)(e),r=t.rowDataUpdate;return t.fromType=a.d.CLEAR_AUTO_PARSE,t.rowDataUpdate=function(e){return e.map((function(e){return e.values})).map((function(e){return{values:e.map((function(e){var t=e&&e.getEffectiveValue();if(e&&t&&null!==t.originValue){var r,n=e.clone();return n.setEffectiveValue(d.ExtendedValueFactory.createInstance({type:c.a.STRING,value:t.originValue})),n.setUserEnteredFormat(d.CellFormatFactory.createInstance(h(h({},null===(r=n.getUserEnteredFormat())||void 0===r?void 0:r.getOptions()),{},{numberFormat:{id:49,pattern:"@"}}))),n}return e}))}}))}(r),t},p=r("./src/core/feature/copyPaste/lib/smartSplit/transformDataSP.ts"),v=r("./src/core/feature/copyPaste/lib/PasteSpecial/logics/pasteTypes.ts"),g=function(e){var t=e.pasteData,r=e.type,n=e.smartSplitObj;switch(r){case v.f:return i(t);case v.c:return function(e){return Object.assign(e,{merge:null,cellMask:u.a.ALL-(1<<u.b.SLOT_RICH_TEXT_STYLE_RUN),formatMask:0})}(t);case v.d:return function(e){var t,r=e.merge;return Object.assign(e,{cellMask:u.a.ALL-(1<<u.b.SLOT_FORMULA)-(1<<u.b.SLOT_RICH_TEXT_STYLE_RUN)-(1<<u.b.SLOT_HYPERLINK_TYPE),formatMask:0,merge:r?(t=r,t.map((function(e){return e.map((function(){return!1}))}))):r,fromType:a.d.ONLYVALUE})}(t);case v.a:return m(t);case v.e:return Object(p.b)(n);case v.b:default:return t}},y=r("./src/core/feature/copyPaste/lib/PasteSpecial/index.ui.ts");function _(e){return b.apply(this,arguments)}function b(){return(b=Object(n.a)(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,u,l,c,d,f,h,m,p,_;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.pasteData,n=t.type,o=t.active,a=t.hotInstance,i=t.smartSplitObj,u=t.envs,l=a.view,c=u&&u.triggeredBySP&&u.originPasteData||r,d={xRange:o.xRange,yRange:o.yRange},l.canvas.selectApi.selectCells(d),f=n===v.f?r:c,(h=Object.assign({},f)).rowDataUpdate=f.rowDataUpdate,m=g({pasteData:h,type:n,smartSplitObj:i}),p=y.b.bind({pasteData:Object(s.clone)(m)}),e.next=12,a.feature.getCopyPaste();case 12:(_=e.sent).doPaste({pasteData:m,selectAreaCellRange:d,cb:p,envs:{triggeredBySP:!0,pasteSpecialType:n,originPasteData:c}}),_.copyPasteCache.cancelCopy();case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}t.b=function(e){var t=e.pasteData,r=e.type,n=e.active,o=e.hotInstance,a=e.cacheDoneActionsLength,s=e.smartSplitObj,i=e.envs;if(o.undoredoStack.undoStack.length===a){o.spreadsheet.activeSheetId;o.requestApi.undo().then((function(){_({pasteData:t,type:r,active:n,hotInstance:o,smartSplitObj:s,envs:i})}))}else console.warn("not invalid doneActon length")}},"./src/core/feature/copyPaste/lib/PasteSpecial/position.ui.ts":function(e,t,r){"use strict";var n;t.a=function(e,t){var r,o=e.view.canvas,a=$(o.container).offset();if(a){var s=a.top,i=a.left,u=(null===(r=document.body.querySelector("footer"))||void 0===r?void 0:r.offsetHeight)||36;if(!0===t)try{var l=e.view.getSelection().rangeSelections[0];n=l.clone()}catch(A){}var c,d,f=n||e.view.getSelection().rangeSelections[0],h=o.areaData.getDisplayViewTopByRow(f.startRowIndex)+o.headSize.displayColHeadHeight,m=o.areaData.getDisplayViewBottomByRow(f.endRowIndex)+o.headSize.displayColHeadHeight,p=[o.areaData.getDisplayViewLeftByCol(f.startColIndex)+o.headSize.displayRowHeadWidth,o.areaData.getDisplayViewRightByCol(f.endColIndex)+o.headSize.displayRowHeadWidth],v=[h,m],g=window.innerHeight,y=window.innerWidth;if(y&&g){var _=v[1]+s+210+u<g,b=p[1]+i+140+35<y;return _&&b?(c=p[1]+4,d=v[1]):_?(c=p[0]-38-4,d=v[1]):b?(c=p[1]+4,d=v[0]):(c=p[0]-38-4,d=v[0]),c+=i,d+=s,c=Math.max(c,i+50),[d=Math.max(d,s+21),c,c+38>=y-35||d+30>=g-u]}}}},"./src/core/feature/copyPaste/lib/parsers/automaticIdentifyLink.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return A})),r.d(t,"b",(function(){return E}));r("../node_modules/core-js/modules/es.array.includes.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.number.constructor.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.object.values.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/core-js/modules/es.string.includes.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/regenerator-runtime/runtime.js");var n=r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),o=r("./src/core/utils/sheetClip/SheetClip.js"),a=r.n(o),s=r("./src/core/feature/copyPaste/interfaces.ts"),i=r("../packages/model/src/cell/CellData.ts"),u=r("../packages/model/src/cell/ExtendedValueType.ts"),l=r("./src/core/feature/copyPaste/lib/parsers/validUrl.ts"),c=r("../packages/model/src/utils/numberFormat/FormatParseEngine.ts"),d=r("../packages/model/src/utils/numberFormat/ParsedValueType.ts"),f=r("./src/base/util/url.ts"),h=r("../node_modules/@tencent/tencent-doc-report/lib/index.browser.js"),m=r("../packages/report/src/index.ts"),p=r("../node_modules/@tencent/tdocs-format-render/lib/index.js"),v=r("./src/core/feature/formula/autofix.ts"),g=r("../packages/model/src/factory/index.ts"),y=r("../packages/model/src/cell/HyperlinkType.ts"),_=r("../packages/model/src/cell/LinkIconType.ts"),b=function(e){var t=e.editValues,r=e.formulas;return Promise.all(t.map(function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(t,o){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map(function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(t,n){var a,s,y,_,b,A,E,j;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null,s=null,(a=t&&""!==t&&Object(l.a)(t)?t:null)&&Object(f.b)(a)&&(s=Object(f.b)(a)),y=null,_=Object(c.parseValueWithStyle)(t,null,{parseMode:c.PARSE_MODE.CURRENT_STYLE_FIRST}),(_=Object(c.twelveNumberToText)(_)).numberFormat.pattern!==p.DEFAULT_FORMAT_PATTERN&&(y=g.CellFormatFactory.createInstance({numberFormat:_.numberFormat})),_.valueType===d.a.FORMULA&&"string"===typeof _.value&&(r[o]=r[o]||[],r[o][n]=Object(v.a)(_.value,[],0)),b=Number(_.valueType),A=_.value,!a||!s){e.next=25;break}return e.prev=12,e.next=15,Object(f.h)(a);case 15:E=e.sent,A=E.title,s=8===s&&1===E.docPolicy?11:s,h.AlloyReport.monitor(35271164),m.b.tdwReport({opername:"link",module:"link_set",action:"link_tdocname_autoset"}),e.next=25;break;case 22:e.prev=22,e.t0=e.catch(12),A=_.value;case 25:return j=""===_.value&&b==u.a.STRING?null:g.ExtendedValueFactory.createInstance({type:b,value:A,originValue:void 0===_.originValue||null===_.originValue?"":String(_.originValue)}),e.abrupt("return",new i.a({effectiveValue:j,editValue:t,hyperlink:a,hyperlinkType:s,userEnteredFormat:y}));case 27:case"end":return e.stop()}}),e,null,[[12,22]])})));return function(t,r){return e.apply(this,arguments)}}()));case 2:return a=e.sent,e.abrupt("return",{values:a});case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()))},A=function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(t){var r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((r=a.a.parse(t))instanceof Array)){e.next=15;break}return n=[],e.next=5,b({editValues:r,formulas:n});case 5:return e.t0=e.sent,e.t1=r.map((function(e){return e.map((function(){return!1}))})),e.t2=s.d.OUTER,e.t3=s.e.unknown,e.t4={selectAll:!1,selectCol:!1,selectRow:!1},(o={rowDataUpdate:e.t0,merge:e.t1,isSingle:!1,isMerge:!1,fromType:e.t2,fromApp:e.t3,select:e.t4,containTable:!1}).formula=n,e.abrupt("return",o);case 15:return e.abrupt("return",null);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function E(e){return e&&(e.hyperlinkType&&Object.values(y.b).includes(e.hyperlinkType)||e.linkIconStatus&&Object.values(_.a).includes(e.linkIconStatus))}},"./src/core/feature/copyPaste/lib/parsers/parseCopyImgs.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n=function(e){var t=[];if(!e||!e.clipboardData||!e.clipboardData.items)return null;for(var r=e.clipboardData.items,n=0;n<r.length;++n){var o=r[n];if("image/png"===o.type||"image/jpeg"===o.type){var a=o.getAsFile();a&&t.push(a)}}return t}},"./src/core/feature/copyPaste/lib/parsers/parseHTMLIsSingleImg.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n=function(e){var t=(new DOMParser).parseFromString(e,"text/html");return 1===t.body.children.length&&"img"===t.body.children[0].tagName.toLocaleLowerCase()}},"./src/core/feature/copyPaste/lib/parsers/validUrl.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n=function(e){return/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(e)}},"./src/core/feature/copyPaste/lib/smartSplit/SmartSplit.ts":function(e,t,r){"use strict";(function(e){r.d(t,"h",(function(){return p})),r.d(t,"e",(function(){return g})),r.d(t,"d",(function(){return _})),r.d(t,"f",(function(){return S})),r.d(t,"a",(function(){return E})),r.d(t,"c",(function(){return b})),r.d(t,"g",(function(){return A})),r.d(t,"i",(function(){return v})),r.d(t,"b",(function(){return C}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.string.trim.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),o=r("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),a=r("./src/core/feature/copyPaste/lib/smartSplit/transformDataSP.ts"),s=r("./src/base/util/timer.ts"),i=r("./src/core/ui/toast/index.ts"),u=r("../packages/report/src/index.ts"),l=r("./src/core/feature/smartSplit/utils.ts"),c=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),d=r.n(c),f=null;function h(t,r,n,o){t.addEventListener?t.addEventListener(r,n,o):t.attachEvent&&t.attachEvent("on"+r,(function(){n(e.event)}))}function m(t,r,n,o){t.removeEventListener?t.removeEventListener(r,n,o):t.detachEvent&&t.detachEvent("on"+r,(function(){n(e.event)}))}function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};a();var r={isNeedBtn:!0,toolToastCloseTime:5e3,btnText:"\u8bd5\u8bd5\u667a\u80fd\u5206\u5217",btnCallBack:function(){a(),t(),e.view.canvas.inputManager.focus(),u.b.tdwReport({opername:"doc_excel_editor",module:"excel_paste_split",action:"clk_toast"})}};function n(){e.view.canvas.normalSelectData.emitter.on(e.view.canvas.normalSelectData.EVENT.MODIFY_SELECTION,a)}function o(){e.view.canvas.normalSelectData.emitter.off(e.view.canvas.normalSelectData.EVENT.MODIFY_SELECTION,a)}function a(){g(),o()}Object(i.showToast)("\u4f60\u53ef\u80fd\u5e0c\u671b\u5bf9\u6570\u636e\u8fdb\u884c\u81ea\u52a8\u6574\u7406\u3002    ".replace(/ /g,"\xa0"),{top:"182px"},r),n()}function v(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};function n(){t.view.canvas.normalSelectData.emitter.on(t.view.canvas.normalSelectData.EVENT.MODIFY_SELECTION,a),h(document,"tap",l,!1),h(document,"click",l,!1),s.a.wait(0).run((function(){h(document,"input",a,!1)}))}function o(){t.view.canvas.normalSelectData.emitter.off(t.view.canvas.normalSelectData.EVENT.MODIFY_SELECTION,a),m(document,"tap",l,!1),m(document,"click",l,!1),m(document,"input",a,!1)}function a(){g(),o()}function l(e){e.target.classList.contains("table-input-content")||a()}s.a.wait(0).run((function(){e.scrollTo(0,0)})),g(),Object(i.showToast)("\u4f60\u53ef\u80fd\u5e0c\u671b\u5bf9\u6570\u636e\u8fdb\u884c\u81ea\u52a8\u6574\u7406\u3002",void 0,{isNeedBtn:!0,btnText:"\u8bd5\u8bd5\u667a\u80fd\u5206\u5217",supportMobile:!0,autoClose:!0,toolToastCloseTime:3e3,btnCallBack:function(){a(),r(),u.b.tdwReport({opername:"doc_excel_editor",module:"excel_paste_split",action:"clk_toast"})}}),n(),u.b.tdwReport({opername:"doc_excel_editor",module:"excel_paste_split",action:"trigger_toast"})}function g(){"\u8bd5\u8bd5\u667a\u80fd\u5206\u5217"===$("#toolToastBtn").text().trim()&&Object(i.hideToast)()}function y(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};$.ajax({url:"//".concat(location.host,"/cgi-bin/online_docs/ai_autocolumn"),type:"POST",xhrFields:{withCredentials:!0},data:{type:"textanalysis.autocolumn",data:JSON.stringify({text:t,docID:e.location.pathname.replace(/^.*\/([^\/]+)$/,"$1")}),xsrf:e.CoreSheet.util.getXsrf()},success:function(e){var t={},n={},o=[];t=Object(l.a)(e,t),n=Object(l.a)(t.ssodata,n),o=Object(l.a)(n.result,o),0===t.cgicode&&0===t.retcode&&n&&0===n.code&&Array.isArray(o)&&o.length>0&&r(o)}}),u.b.tdwReport({opername:"doc_excel_editor",module:"excel_paste_split",action:"total_trigger"})}function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};f=null,y(e,(function(e){f=e,t(e)}))}function b(){return f}function A(e){f=e}function E(t,r){t=t||f;var n=Object(a.b)(t);r.feature.copyPaste&&r.feature.copyPaste.doPaste({pasteData:n,cb:function(){}}),(d.a.isMobilePhone||d.a.isAndroidPad)&&s.a.wait(0).run((function(){e.scrollTo(0,0)}))}function j(e,t,r){for(var n=Object(o.a)(e,4),a=n[0],s=n[1],i=n[2],u=n[3],l=a;l<=s;l++)if(t[l])for(var c=t[l].values,d=i;d<=u;d++){var f=c[d];if(r){if(f)return!1}else if(f&&f.effectiveValue&&f.effectiveValue.value&&""!==f.effectiveValue.value.toString())return!1}return!0}function R(e,t,r){return void 0===t?[0,e-1]:void 0===r?[t,t>e-1?-1:e-1]:t>e-1?[t,-1]:[t,r>e-1?e-1:r]}function S(t,r){var o=t.spreadsheet.activeSheet,a=o.data.rowData,s=o.getRowCount()||0,i=o.getColCount()||0;if(!function(t,r,n){var o,a;if(!(null===(o=e.CoreSheet)||void 0===o||null===(a=o.configurations)||void 0===a?void 0:a.aiAutoColumnEnable))return!1;if(!t)return!1;if("number"!==typeof r||"number"!==typeof n||r<1||n<1)return!1;if(r>500)return!1;var s=t.spreadsheet.activeSheet.images;return!(s&&Object.keys(s).length>0)}(t,s,i))return!1;var u=[].concat(Object(n.a)(R(s,0,25)),Object(n.a)(R(i,0,8))),l=[].concat(Object(n.a)(R(s,0,25)),Object(n.a)(R(i,9,16))),c=[].concat(Object(n.a)(R(s,26,50)),Object(n.a)(R(i,0,16))),d=[].concat(Object(n.a)(R(s,0,50)),Object(n.a)(R(i,17))),f=[].concat(Object(n.a)(R(s,51)),Object(n.a)(R(i,0)));return!!(j(u,a,r)&&j(l,a,r)&&j(c,a,r)&&j(d,a,r)&&j(f,a,r))}function C(e,t,r){_(e,(function(e){v(t,(function(){t.requestApi.undo().then((function(){E(e,t)}))})),u.b.tdwReport({opername:"doc_excel_editor",module:"excel_paste_split",action:"active_trigger"}),r&&u.b.tdwReport({opername:"doc_excel_editor",module:"excel_paste_split",action:"new_sheet_trigger"})}))}}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/feature/copyPaste/lib/smartSplit/transformDataSP.ts":function(e,t,r){"use strict";r.d(t,"c",(function(){return d})),r.d(t,"a",(function(){return p}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.array.splice.js"),r("../node_modules/core-js/modules/es.object.assign.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.string.trim.js");var n=r("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),o=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),a=r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),s=r("../packages/model/src/cell/CellData.ts"),i=r("../packages/model/src/cell/ExtendedValueType.ts"),u=r("./src/core/feature/copyPaste/interfaces.ts"),l=r("../packages/model/src/cell/format/WrapStrategy.ts"),c=r("../packages/model/src/factory/index.ts");function d(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=[],n=[],o=[],s=0,i=e.length,u=0;u<i;u++){var l=e[u],c=Object.keys(l);m.apply(void 0,[c,"prefix","suffix","num"].concat(Object(a.a)(t))),c.sort((function(e,t){return e-t})),c.length<1||(n[u]=c,s=Math.max(l[c[0]].length,s))}if(s<1)return[r,r.length,s,o];for(var d=0;d<i;d++){var h=n[d],p=h.length;if(h||!(p<1)){var v=e[d],g=v.prefix,y=v.suffix;g&&""!==g.trim()&&(r.push([g].concat(Object(a.a)(f(s-1,"")))),o.push(r.length-1));for(var _=f(s-v[h[0]].length,""),b=0;b<p;b++)r.push([].concat(Object(a.a)(v[h[b]]),Object(a.a)(_)));y&&""!==y.trim()&&(r.push([y].concat(Object(a.a)(f(s-1,"")))),o.push(r.length-1)),n[d+1]&&n[d+1].length>0&&(r.push(Object(a.a)(f(s,""))),r.push(Object(a.a)(f(s,""))))}}return[r,r.length,s,o]}function f(e,t){var r=[];t&&"object"===Object(o.a)(t)&&(t=Object.assign({},t));for(var n=0;n<e;n++)r.push(t);return r}function h(e,t,r){for(var n=[],o=0;o<e;o++)n.push(f(t,r));return n}function m(e){for(var t=0;t<(arguments.length<=1?0:arguments.length-1);t++){var r=e.indexOf(t+1<1||arguments.length<=t+1?void 0:arguments[t+1]);-1!==r&&e.splice(r,1)}}function p(e){var t=Object(n.a)(e,4),r=t[0],o=t[1],a=t[2],d=t[3],f=r.map((function(e,t){var r=-1!==d.indexOf(t);return{values:e.map((function(e){var t={wrapStrategy:r?l.a.OVERFLOW_CELL:null},n=c.CellFormatFactory.createInstance(t),o=c.ExtendedValueFactory.createInstance({type:i.a.STRING,value:e});return new s.a({userEnteredFormat:n,effectiveValue:o})}))}}));return{isSingle:!1,isMerge:!1,merge:h(o,a,!1),formula:h(o,a,null),fromType:1,images:[],rowDataUpdate:f,fromApp:u.e.tencent,select:{selectAll:!1,selectCol:!1,selectRow:!1},containTable:!0}}t.b=function(e){return p(d(e))}},"./src/core/feature/copyPaste/lib/tips.ui.ts":function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return a}));var n=r("./src/core/ui/toast/index.ts"),o=e.ActiveXObject||"ActiveXObject"in e,a=function(){o&&localStorage&&null==localStorage.getItem("ctrl_C_key_copyTip")&&(localStorage.setItem("ctrl_C_key_copyTip","true"),Object(n.hideToast)(),Object(n.showToast)("\u7531\u4e8eIE\u6d4f\u89c8\u5668\u9650\u5236\uff0c\u53ea\u80fd\u590d\u5236\u7eaf\u6587\u5b57\uff0c\u4e0d\u652f\u6301\u590d\u5236\u683c\u5f0f\u3002\u5efa\u8bae\u4f7f\u7528Chrome\u6216QQ\u6d4f\u89c8\u5668\u3002",void 0,{isNeedBtn:!0,btnText:"\u6211\u77e5\u9053\u4e86",btnTextAfter:"",btnCallBack:function(){Object(n.hideToast)()}}))}}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/feature/copyPaste/lib/unescapeCssSequences.ts":function(e,t,r){"use strict";r.d(t,"b",(function(){return o})),r.d(t,"a",(function(){return a}));r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.string.split.js");var n={CSS:{Sequence:function(){var e=/\\((([\dA-F]{2}|[\dA-F]{1,5})\s)|([\dA-F]{6}|[\dA-F]{4}))/gim;return e.unescape=function(e){var t=window,r=t.String.fromCharCode,n=t.parseInt;return e.replace(this,(function(e){return r(n(e.slice(2),16))}))},e}()}},o=function(e){return function(e){return e.replace(/(\\.)/g,(function(e){return e.slice(1)})).replace(/(\\[\$\-+/\(\):!\^&'~{}<>= ])/g,(function(e){return e.slice(1)}))}(n.CSS.Sequence.unescape(e))},a=function(e){var t=s(e);return"'".concat(t,"'")},s=function(e){var t=0;return e=e.split('"').map((function(e){return++t%2===0?e:e.replace(/([\\\)\|\(#;,\.\[\]\$\xa5])/g,"\\$1")})).join("\\0022")}},"./src/core/feature/copyPaste/middleware/factory.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.object.keys.js");var n=r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=r("./src/core/feature/copyPaste/middleware/interface.ts"),i=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),u=(r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.object.assign.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js")),l=(r("../node_modules/regenerator-runtime/runtime.js"),r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js")),c=r("./src/core/view/level-2/shape-upload/utils.ts"),d=r("../packages/model/src/cell/metadata/CustomDataType.ts"),f=r("../packages/model/src/factory/index.ts"),h=r("../packages/model/src/cell/ExtendedValueType.ts"),m=r("../packages/model/src/cell/metadata/Metadata.ts"),p=r("../packages/model/src/embedded/index.ts"),v=r("./src/core/feature/copyPaste/utils/url.ts"),g=r("./src/core/behavior/request/other/CopyPaste/Embedded.ts");function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach((function(t){Object(i.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var b,A=new(function(){function e(){var t=this;Object(o.a)(this,e),this.desc={name:s.b.cellImage,tableProps:s.b.cellImage},this.tdToCellData={isActive:function(e,r,n){var o,a=r.x,s=r.y;return(null===(o=e[t.desc.tableProps][s])||void 0===o?void 0:o[a])&&!n.effectiveValue},fn:function(e){return Object.assign(e,{metadata:m.a.newInstance({customDataType:d.o.IMAGE})})}}}return Object(a.a)(e,[{key:"beforePaste",value:function(){var e=Object(l.a)(regeneratorRuntime.mark((function e(t,r){var n,o,a,s,i,u,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.cellImage,o=void 0===n?[]:n,a=null,s=0;case 3:if(!(s<o.length)){e.next=28;break}i=0;case 5:if(!(i<o[s].length)){e.next=25;break}if(!o[s][i]){e.next=22;break}if(!(u=o[s][i].url)||!Object(v.b)(u)&&Object(v.d)(u)){e.next=22;break}return l=void 0,e.prev=10,e.next=13,r(u);case 13:l=e.sent,e.next=21;break;case 16:return e.prev=16,e.t0=e.catch(10),o[s][i].url="",a=e.t0,e.abrupt("continue",22);case 21:o[s][i]={width:l.size.width,height:l.size.height,url:l.url};case 22:i++,e.next=5;break;case 25:s++,e.next=3;break;case 28:return e.abrupt("return",a);case 29:case"end":return e.stop()}}),e,null,[[10,16]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"copyToHtml",value:function(e,t){var r=null===t||void 0===t?void 0:t.getMetadata(),n=null===r||void 0===r?void 0:r.customDataType;if(n&&n===d.o.IMAGE){var o,a=null===(o=t.getRefIds())||void 0===o?void 0:o[0],s=a&&e.spreadsheet.activeSheet.imageManager.getImage(a);return s?"data-online-sheet-type='".concat(s.type,"' data-online-sheet-url='").concat(s.url,"' data-online-sheet-width='").concat(Math.floor(s.position.overlayPosition.widthPixels),"' data-online-sheet-height='").concat(Math.floor(s.position.overlayPosition.heightPixels),"'"):""}}},{key:"processPasteData",value:function(e){var t=e.cellData,r=e.pasteData,n=e.offset,o=n.row,a=n.col,s=n.fromRow,i=n.fromCol,u=e.hotInstance,l=e.activeSheetId,p=e.cacheState,v=e.ext,g=v.propsKeys,y=v.isPasteCellInCopyRange;if(t&&!y){var _=Object(c.c)(),b=t.getMetadata(),A=t;if(A&&(null===b||void 0===b?void 0:b.customDataType)===d.o.IMAGE&&!y&&(A=t.clone()),(null===b||void 0===b?void 0:b.customDataType)===d.o.IMAGE){var E=this.setCellImage(r,o,a,s,i,_,u,g[this.desc.tableProps],l,p);if(!(null===E||void 0===E?void 0:E.url))return;A.setEffectiveValue(f.ExtendedValueFactory.createInstance({type:h.a.STRING,value:"\u56fe\u7247"})),A.setMetadata(m.a.newInstance({customDataType:d.o.IMAGE})),A.setRefIds([_])}return{newCellData:A}}}},{key:"parseHTML",value:function(e,t){var r={cellImage:null};if(!e)return r;if(e.getAttribute("data-online-sheet-type")===p.EMBEDDED_OBJECT_TYPE.CELL_IMAGE)return r.cellImage={url:e.getAttribute("data-online-sheet-url"),width:e.getAttribute("data-online-sheet-width"),height:e.getAttribute("data-online-sheet-height")},r;var n=e.querySelector("img"),o=null===n||void 0===n?void 0:n.getAttribute("src");return o?(Object(v.c)(o)||!Object(v.b)(o)&&Object(v.d)(o)||(r.cellImage={url:o}),r):r}},{key:"genMutation",value:function(e){return Object(g.a)(e[this.desc.tableProps])}},{key:"getCellValue",value:function(e,t,r){var n=null===t||void 0===t?void 0:t.getMetadata();if((null===n||void 0===n?void 0:n.customDataType)===d.o.IMAGE){var o,a=null===(o=t.getRefIds())||void 0===o?void 0:o[0],s=a&&e.spreadsheet.activeSheet.imageManager.getImage(a);if(s)return"<img src=".concat(s.url,"/ tencent-sheet-cell-img='true'>")}return r}},{key:"setCellImage",value:function(e,t,r,n,o,a,s,i,u,l){var c,d=e.cellImage,f=void 0===d?[]:d,h=0,m=0;if(f.length){var v=c=f[n][o];h=v.width,m=v.height}else{var g;if(!(null===(g=c=this.setCellImageInner(e,n,o,s,l))||void 0===g?void 0:g.url))return{url:""};var y=c.position.overlayPosition;h=y.widthPixels,m=y.heightPixels}return c.url&&i.push(_(_({},c),{},{type:p.EMBEDDED_OBJECT_TYPE.CELL_IMAGE,sheetId:u,x:r,y:t,width:h,height:m,id:a,offsetX:0,offsetY:0,zIndex:0})),c}},{key:"setCellImageInner",value:function(e,t,r,n,o){var a,s;try{var i=e.rowDataUpdate[t].values[r].getRefIds();a=Object(u.a)(i,1)[0]}catch(c){return{url:""}}if(n.spreadsheet.activeSheetId===o.sheetId)s=n.spreadsheet.activeSheet.imageManager.getImage(a);else{var l=n.spreadsheet.sheetManager.getSheetBySheetId(o.sheetId);s=null===l||void 0===l?void 0:l.imageManager.getImage(a)}return s}}]),e}()),E=(b={},Object(i.a)(b,s.a.COL,{}),Object(i.a)(b,s.a.ROW,{}),Object(i.a)(b,s.a.CELL,{cellImageMiddleware:A}),Object(i.a)(b,s.a.SHEET,{}),Object(i.a)(b,s.a.ROW_PROPS,{}),Object(i.a)(b,s.a.COL_PROPS,{}),Object(i.a)(b,s.a.SHEET_PROPS,{}),Object(i.a)(b,s.a.CELL_PROPS,{cellImageMiddleware:A}),Object(i.a)(b,s.a.RANGE,{}),b),j=new(function(){function e(){Object(o.a)(this,e),this.phase=s.c.IDLE,this.middleWares=E}return Object(a.a)(e,[{key:"getMiddleWaresByLevel",value:function(e){var t=this;return Object.keys(this.middleWares[e]).map((function(r){return t.middleWares[e][r]}))}},{key:"getAllMiddleWares",value:function(e){var t=e.level,r=e.tableProps;if(!t)return[];var o=Object(n.a)(this.getMiddleWaresByLevel(t));return r&&(o=this.getMiddleWaresByTableProps(o,r)),o}},{key:"getMiddleWaresByTableProps",value:function(e,t){return e?e.filter((function(e){return e.desc.tableProps})):[]}},{key:"report",value:function(){}}]),e}());t.a=j},"./src/core/feature/copyPaste/middleware/interface.ts":function(e,t,r){"use strict";var n,o,a;r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return o})),r.d(t,"c",(function(){return a})),function(e){e.cellImage="cellImage"}(n||(n={})),function(e){e[e.CELL=1]="CELL",e[e.ROW=2]="ROW",e[e.COL=3]="COL",e[e.SHEET=4]="SHEET",e[e.ROW_PROPS=5]="ROW_PROPS",e[e.COL_PROPS=6]="COL_PROPS",e[e.SHEET_PROPS=7]="SHEET_PROPS",e[e.CELL_PROPS=8]="CELL_PROPS",e[e.RANGE=9]="RANGE"}(o||(o={})),function(e){e[e.IDLE=1]="IDLE",e[e.BEFORE_COPY=2]="BEFORE_COPY",e[e.COPY=3]="COPY",e[e.SET_CACHE=4]="SET_CACHE",e[e.COPY_TO_HTML=5]="COPY_TO_HTML",e[e.BEFORE_PARSE=6]="BEFORE_PARSE",e[e.PARSE=7]="PARSE",e[e.PARSE_HTML=8]="PARSE_HTML",e[e.HTML_TABLE=9]="HTML_TABLE",e[e.PROCESS_CELL_DATA=10]="PROCESS_CELL_DATA",e[e.RUN_REQUEST=11]="RUN_REQUEST"}(a||(a={}))},"./src/core/feature/copyPaste/preVerify/showTips.ui.ts":function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s}));var n=r("./src/core/ui/dialog/index.ts"),o=e,a=function(){n.dialog.confirm({title:"\u63d0\u793a",content:"\u4e0d\u80fd\u6267\u884c\u4e0e\u5408\u5e76\u5355\u5143\u683c\u76f8\u4ea4\u7684\u7c98\u8d34\uff0c\u5efa\u8bae\u53d6\u6d88\u5408\u5e76\u5355\u5143\u683c\u3002",onOk:function(e){return e.preventDefault(),e.stopPropagation(),o.focus(),!0},onCancel:function(e){e.preventDefault(),e.stopPropagation(),o.focus()}})},s=function(){n.dialog.alert("\u63d0\u793a","\u65e0\u6cd5\u5bf9\u5408\u5e76\u5355\u5143\u683c\u6267\u884c\u6b64\u64cd\u4f5c\u3002",(function(){}))}}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/feature/copyPaste/utils/mergeRangeUtils.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return o})),r.d(t,"d",(function(){return a})),r.d(t,"c",(function(){return s}));var n=function(e,t,r){if(!e)return!1;var n=e.getMergeReference();return!!n&&(n.startRowIndex===t&&n.startColIndex===r)},o=function(e,t,r){if(!e)return!1;var n=e.getMergeReference();return!!n&&(n.startRowIndex!==t||n.startColIndex!==r)},a=function(e,t){if(!t)return!1;var r=t.getMergeReference();return!!r&&r.equals(e)},s=function(e,t){for(var r=e.startRowIndex,n=e.startColIndex,o=e.endRowIndex,a=e.endColIndex,s=r;s<=o;s++)for(var i=n;i<=a;i++){var u=t.getCellDataAtPosition(s,i);if(u){var l=u.getMergeReference();if(l&&!e.contain(l))return!1}}return!0}},"./src/core/feature/copyPaste/utils/rangeAuthCheckUtil.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),o=r("../node_modules/@tencent/dui/lib/components/Snackbar/index.js"),a=r.n(o);function s(e,t,r){var o=[],a=[],s=!1,u=e.colsDimensionProperties,l=e.rowsDimensionProperties,c=r.xRange,d=r.yRange,f=Object(n.a)(c,1)[0],h=Object(n.a)(d,1)[0];return null===u||void 0===u||u.forEach((function(e,r){var n=f+r;t.sheetStatus.isCurrentColCanEdit({startCol:n,endCol:n})?a.push(e):s=!0})),null===l||void 0===l||l.forEach((function(e,r){var n=h+r;t.sheetStatus.isCurrentRowCanEdit({startRow:n,endRow:n})?o.push(e):s=!0})),i(s),{rowsDimensionArr:0===o.length?void 0:o,colsDimensionArr:0===a.length?void 0:a}}function i(e){e&&a.a.show({message:"\u6240\u5728\u884c\u5217\u542b\u6709\u88ab\u4fdd\u62a4\u5355\u5143\u683c\uff0c\u6682\u4e0d\u652f\u6301\u7c98\u8d34\u884c\u9ad8\u5217\u5bbd\u3002",type:"info",duration:3e3})}},"./src/core/feature/copyPaste/utils/url.ts":function(e,t,r){"use strict";r.d(t,"b",(function(){return a})),r.d(t,"a",(function(){return s})),r.d(t,"d",(function(){return i})),r.d(t,"c",(function(){return u}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.match.js");var n=r("./src/base/util/url.ts"),o=["qpic.cn"].concat(n.f);function a(e){return/^data:image\/(png|gif|jpeg|x-icon|jpg|tiff);base64,.+/i.test(e)}function s(e){var t=e.match('<img[^<>]*? src="([^<>]*?)"');return!(!(null===t||void 0===t?void 0:t[1])||u(t[1]))&&(!i(t[1])||a(t[1]))}function i(e){return-1!==o.indexOf(function(e){var t,r;return(r=e.match(/^(?:https?:\/\/)?(?:[^@\n]+@)?(?:www\.)?([^:/\n?=]+)/im))&&(r=(t=r[1]).match(/^[^.]+\.(.+\..+)$/))&&(t=r[1]),t||""}(e))}function u(e){return e.match(/^file:\/\/[/].+(gif|jpg|jpeg|tiff|png)$/i)}},"./src/core/feature/copyPaste/wxCopyPaste.ui.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.match.js"),r("../node_modules/core-js/modules/es.string.split.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),s=r.n(a),i=r("../packages/utils/src/safe.ts"),u=r("./src/base/util/timer.ts"),l=new(function(){function t(){Object(n.a)(this,t),this.serverCopyData={plain:"",timeStamp:0},this.visibilityState=document.visibilityState||"visible"}return Object(o.a)(t,[{key:"init",value:function(){this.getCopyDataFromServer(),document.addEventListener("visibilitychange",this.onVisibilitychange.bind(this))}},{key:"copyToSystem",value:function(e){var t=document.createElement("textarea");t.readOnly=!0,t.style.zIndex="0",t.style.opacity="0",t.style.top="-9999px",t.style.left="-9999px",t.style.position="fixed",document.body.appendChild(t),t.value=e;var r=document.createRange();r.selectNode(t),window.getSelection().addRange(r),t.select(),document.execCommand("SelectAll"),document.execCommand("copy"),document.body.removeChild(t)}},{key:"isCopyOutEnv",value:function(){return(s.a.isMobilePhone||s.a.isAndroidPad||s.a.isIPad)&&this.isSupportExecCommand()&&(s.a.isWeChat||s.a.isMiniProgram)}},{key:"isCopyInEnv",value:function(){return s.a.isMiniProgram}},{key:"isCopyDataAvailable",value:function(){return!!this.serverCopyData.plain}},{key:"getServerCopyData",value:function(){return this.serverCopyData}},{key:"isSupportExecCommand",value:function(){var e,t,r,n;return(null===(e=(t=document).queryCommandSupported)||void 0===e?void 0:e.call(t,"copy"))&&(null===(r=(n=document).queryCommandSupported)||void 0===r?void 0:r.call(n,"SelectAll"))}},{key:"getCopyDataFromServer",value:function(){var t=this;new Promise((function(t,r){e.$.ajax({url:"//".concat(location.host,"/sdc/datadown"),type:"POST",xhrFields:{withCredentials:!0},data:{key:"weixin_copypaste_hack_key",xsrf:Object(i.b)()},success:function(e){t(e)},error:function(e){r(e)}})})).then((function(e){var r=e.retcode,n=e.result;0===r&&n&&"string"===typeof n.data?t.saveServerData(n.data):t.saveServerData("")})).catch((function(e){t.saveServerData("")}))}},{key:"onVisibilitychange",value:function(){var e=this,t=document.visibilityState;"hidden"===this.visibilityState&&"visible"===t&&(u.a.wait(1500).run((function(){e.getCopyDataFromServer()})),u.a.wait(3500).run((function(){e.getCopyDataFromServer()}))),this.visibilityState=t}},{key:"saveServerData",value:function(e){var t="",r=0,n=/^(wxcp):\d{13}:/;if(e&&n.test(e)){var o=e.match(n),a=null===o||void 0===o?void 0:o[0];t=a&&e.split(a)[1]||"",r=+((null===a||void 0===a?void 0:a.substr(5,13))||0)}this.serverCopyData={plain:t,timeStamp:r}}}]),t}());t.a=l}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/feature/dataValidation/DVInterface.ts":function(e,t,r){"use strict";r.d(t,"b",(function(){return a})),r.d(t,"f",(function(){return s})),r.d(t,"d",(function(){return i})),r.d(t,"c",(function(){return u})),r.d(t,"e",(function(){return l}));r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.map.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/esnext.map.delete-all.js"),r("../node_modules/core-js/modules/esnext.map.every.js"),r("../node_modules/core-js/modules/esnext.map.filter.js"),r("../node_modules/core-js/modules/esnext.map.find.js"),r("../node_modules/core-js/modules/esnext.map.find-key.js"),r("../node_modules/core-js/modules/esnext.map.includes.js"),r("../node_modules/core-js/modules/esnext.map.key-of.js"),r("../node_modules/core-js/modules/esnext.map.map-keys.js"),r("../node_modules/core-js/modules/esnext.map.map-values.js"),r("../node_modules/core-js/modules/esnext.map.merge.js"),r("../node_modules/core-js/modules/esnext.map.reduce.js"),r("../node_modules/core-js/modules/esnext.map.some.js"),r("../node_modules/core-js/modules/esnext.map.update.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("../packages/model/src/index.ts"),o=r("./src/core/feature/dataValidation/type.ts");r.d(t,"g",(function(){return o.c})),r.d(t,"a",(function(){return o.a}));var a=new Map([[n.Cell.Format.DATA_VALIDATION_CONDITION_TYPE.BETWEEN,"\u4ecb\u4e8e"],[n.Cell.Format.DATA_VALIDATION_CONDITION_TYPE.NOT_BETWEEN,"\u4e0d\u4ecb\u4e8e"],[n.Cell.Format.DATA_VALIDATION_CONDITION_TYPE.EQUAL,"\u7b49\u4e8e"],[n.Cell.Format.DATA_VALIDATION_CONDITION_TYPE.NOT_EQUAL,"\u4e0d\u7b49\u4e8e"],[n.Cell.Format.DATA_VALIDATION_CONDITION_TYPE.LESS,"\u65e9\u4e8e"],[n.Cell.Format.DATA_VALIDATION_CONDITION_TYPE.LESS_EQUAL,"\u4e0d\u665a\u4e8e"],[n.Cell.Format.DATA_VALIDATION_CONDITION_TYPE.GREAT,"\u665a\u4e8e"],[n.Cell.Format.DATA_VALIDATION_CONDITION_TYPE.GREAT_EQUAL,"\u4e0d\u65e9\u4e8e"]]),s=new Map([[n.Cell.Format.DATA_VALIDATION_CONDITION_TYPE.BETWEEN,"\u4ecb\u4e8e"],[n.Cell.Format.DATA_VALIDATION_CONDITION_TYPE.NOT_BETWEEN,"\u4e0d\u4ecb\u4e8e"],[n.Cell.Format.DATA_VALIDATION_CONDITION_TYPE.EQUAL,"\u7b49\u4e8e"],[n.Cell.Format.DATA_VALIDATION_CONDITION_TYPE.NOT_EQUAL,"\u4e0d\u7b49\u4e8e"],[n.Cell.Format.DATA_VALIDATION_CONDITION_TYPE.LESS,"\u5c0f\u4e8e"],[n.Cell.Format.DATA_VALIDATION_CONDITION_TYPE.LESS_EQUAL,"\u5c0f\u4e8e\u6216\u7b49\u4e8e"],[n.Cell.Format.DATA_VALIDATION_CONDITION_TYPE.GREAT,"\u5927\u4e8e"],[n.Cell.Format.DATA_VALIDATION_CONDITION_TYPE.GREAT_EQUAL,"\u5927\u4e8e\u6216\u7b49\u4e8e"],[n.Cell.Format.DATA_VALIDATION_CONDITION_TYPE.INCLUDE,"\u5305\u62ec"],[n.Cell.Format.DATA_VALIDATION_CONDITION_TYPE.NOT_INCLUDE,"\u4e0d\u5305\u62ec"]]),i=new Map([[n.Cell.Format.DATA_VALIDATION_CONDITION_TYPE.BETWEEN,"\u4ecb\u4e8e"],[n.Cell.Format.DATA_VALIDATION_CONDITION_TYPE.NOT_BETWEEN,"\u4e0d\u4ecb\u4e8e"],[n.Cell.Format.DATA_VALIDATION_CONDITION_TYPE.EQUAL,"\u7b49\u4e8e"],[n.Cell.Format.DATA_VALIDATION_CONDITION_TYPE.NOT_EQUAL,"\u4e0d\u7b49\u4e8e"],[n.Cell.Format.DATA_VALIDATION_CONDITION_TYPE.LESS,"\u5c0f\u4e8e"],[n.Cell.Format.DATA_VALIDATION_CONDITION_TYPE.LESS_EQUAL,"\u5c0f\u4e8e\u6216\u7b49\u4e8e"],[n.Cell.Format.DATA_VALIDATION_CONDITION_TYPE.GREAT,"\u5927\u4e8e"],[n.Cell.Format.DATA_VALIDATION_CONDITION_TYPE.GREAT_EQUAL,"\u5927\u4e8e\u6216\u7b49\u4e8e"]]),u=new Map([[o.a.NONE,"\u6570\u503c"],[o.a.INT,"\u6574\u6570"],[o.a.FLOAT,"\u5c0f\u6570"]]),l=new Map([[o.a.ID_CARD,"\u8eab\u4efd\u8bc1\u53f7\u7801"],[o.a.MAIL,"\u90ae\u7bb1\u53f7\u7801"],[o.a.PHONE,"\u624b\u673a\u53f7\u7801"]])},"./src/core/feature/dataValidation/api/DataValidationRule.ts":function(e,t,r){"use strict";r.d(t,"b",(function(){return u})),r.d(t,"a",(function(){return f}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/es.object.values.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../packages/model/src/index.ts"),o=r("./src/core/feature/dataValidation/api/DataValidationUtils.ts"),a=r("./src/core/feature/formula/utils.ts"),s=r("./src/core/utils/formula.ts"),i=r("./src/core/feature/dataValidation/type.ts"),u=function(e){switch(e.ruleType){case n.Cell.Format.DATA_VALIDATION_RULE_TYPE.NUMBER_FLOAT_AND_INT:return c(e,i.b.NONE);case n.Cell.Format.DATA_VALIDATION_RULE_TYPE.CUSTOM_MUST_FLOAT:return c(e,i.b.FLOAT);case n.Cell.Format.DATA_VALIDATION_RULE_TYPE.NUMBER_INT:return c(e,i.b.INT);case n.Cell.Format.DATA_VALIDATION_RULE_TYPE.DATE:return c(e,i.b.NONE);case n.Cell.Format.DATA_VALIDATION_RULE_TYPE.TEXT_LENGTH:return c(e,i.b.LENGTH);case n.Cell.Format.DATA_VALIDATION_RULE_TYPE.LIST:return d(e);case n.Cell.Format.DATA_VALIDATION_RULE_TYPE.CUSTOM_TEXT_CONTAINS:return l(e);case n.Cell.Format.DATA_VALIDATION_RULE_TYPE.CUSTOM_ID_CARD:return f(e);case n.Cell.Format.DATA_VALIDATION_RULE_TYPE.CUSTOM_TEXT_MAIL:return h(e);case n.Cell.Format.DATA_VALIDATION_RULE_TYPE.CUSTOM_NUM_PHONE:return m(e);default:return null}},l=function(e){var t=e.operator,r=e.argTokens;if(Object(o.d)(t)||null==r)return null;var n=Object(o.s)(r[0].userEnteredValue,e);return'=DATA_VALID_TEXT("'.concat(t,'", ').concat(n,", ").concat("$SLOT",")")},c=function(e,t,r){var n,a=e.operator,s=e.argTokens;if(Object(o.b)(a)||null==s)return null;var i=r||"$SLOT",u=Object(o.s)(Object(o.i)(s[0].userEnteredValue),e),l=Object(o.s)(Object(o.i)(null===(n=s[1])||void 0===n?void 0:n.userEnteredValue),e)||null;return'=DATA_VALID_NUMBER("'.concat(a,'", ').concat(t,", ").concat(u,", ").concat(l,", ").concat(i,")")},d=function(e){var t=e.argTokens;if(null==t)return null;var r=t[0].userEnteredValue;if(Object(a.C)(t[0].userEnteredValue)){var n=Object(s.moveEqualChar)(r);return"DATA_VALID_LIST(".concat(n,", ").concat("$SLOT",")")}var i=Object(o.a)(r).join(",");return'DATA_VALID_LIST("'.concat(i,'", ').concat("$SLOT",")")},f=function(e){return"ISNUMBER(ID(".concat("$SLOT",",0))")},h=function(e){return'=DATA_VALID_TEXT("'.concat(e.operator,'", "#REGEXP ').concat(p,'", ').concat("$SLOT",")")},m=function(e){var t=Object.values(v),r="";return t.forEach((function(e){r+="#REGEXP ".concat(e)})),'=DATA_VALID_TEXT("'.concat(e.operator,'", "').concat(r,'", ').concat("$SLOT",")")},p="^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\\.[a-zA-Z0-9_-]+)+$",v={"ar-DZ":"^(\\+?213|0)(5|6|7)\\d{8}$","ar-SY":"^(!?(\\+?963)|0)?9\\d{8}$","ar-SA":"^(!?(\\+?966)|0)?5\\d{8}$","en-US":"^(\\+?1)?[2-9]\\d{2}[2-9](?!11)\\d{6}$","cs-CZ":"^(\\+?420)? ?[1-9][0-9]{2} ?[0-9]{3} ?[0-9]{3}$","de-DE":"^(\\+?49[ \\.\\-])?([\\(]{1}[0-9]{1,6}[\\)])?([0-9 \\.\\-\\/]{3,20})((x|ext|extension)[ ]?[0-9]{1,4})?$","da-DK":"^(\\+?45)?(\\d{8})$","el-GR":"^(\\+?30)?(69\\d{8})$","en-AU":"^(\\+?61|0)4\\d{8}$","en-GB":"^(\\+?44|0)7\\d{9}$","en-HK":"^(\\+?852\\-?)?[569]\\d{3}\\-?\\d{4}$","en-IN":"^(\\+?91|0)?[789]\\d{9}$","en-NZ":"^(\\+?64|0)2\\d{7,9}$","en-ZA":"^(\\+?27|0)\\d{9}$","en-ZM":"^(\\+?26)?09[567]\\d{7}$","es-ES":"^(\\+?34)?(6\\d{1}|7[1234])\\d{7}$","fi-FI":"^(\\+?358|0)\\s?(4(0|1|2|4|5)?|50)\\s?(\\d\\s?){4,8}\\d$","fr-FR":"^(\\+?33|0)[67]\\d{8}$","he-IL":"^(\\+972|0)([23489]|5[0248]|77)[1-9]\\d{6}","hu-HU":"^(\\+?36)(20|30|70)\\d{7}$","it-IT":"^(\\+?39)?\\s?3\\d{2} ?\\d{6,7}$","ja-JP":"^(\\+?81|0)\\d{1,4}[ \\-]?\\d{1,4}[ \\-]?\\d{4}$","ms-MY":"^(\\+?6?01){1}(([145]{1}(\\-|\\s)?\\d{7,8})|([236789]{1}(\\s|\\-)?\\d{7}))$","nb-NO":"^(\\+?47)?[49]\\d{7}$","nl-BE":"^(\\+?32|0)4?\\d{8}$","nn-NO":"^(\\+?47)?[49]\\d{7}$","pl-PL":"^(\\+?48)? ?[5-8]\\d ?\\d{3} ?\\d{2} ?\\d{2}$","pt-BR":"^(\\+?55|0)\\-?[1-9]{2}\\-?[2-9]{1}\\d{3,4}\\-?\\d{4}$","pt-PT":"^(\\+?351)?9[1236]\\d{7}$","ru-RU":"^(\\+?7|8)?9\\d{9}$","sr-RS":"^(\\+3816|06)[- \\d]{5,9}$","tr-TR":"^(\\+?90|0)?5\\d{9}$","vi-VN":"^(\\+?84|0)?((1(2([0-9])|6([2-9])|88|99))|(9((?!5)[0-9])))([0-9]{7})$","zh-CN":"^(\\+?0?86\\-?)?1[345789]\\d{9}$","zh-TW":"^(\\+?886\\-?|0)?9\\d{8}$"}},"./src/core/feature/dataValidation/api/DataValidationUIUtils.ts":function(e,t,r){"use strict";r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return s})),r.d(t,"a",(function(){return i}));var n=r("./src/core/feature/dataValidation/type.ts"),o=r("../packages/model/src/cell/format/index.ts");function a(e,t,r){var n=i(e,t,r);if(null==n)return null;var o=s(n.ruleType),a=null;return null!=o&&null!=n&&(a={validType:o.validType,dataType:o.dataType,inputMessage:n.inputMessage,isStrict:n.isStrict,showDropDown:n.showDropDown,operator:n.operator,argTokens:n.argTokens}),a}function s(e){switch(e){case o.DATA_VALIDATION_RULE_TYPE.LIST:return{validType:n.c.LIST,dataType:n.a.NONE};case o.DATA_VALIDATION_RULE_TYPE.NUMBER_INT:return{validType:n.c.NUMBER,dataType:n.a.INT};case o.DATA_VALIDATION_RULE_TYPE.NUMBER_FLOAT_AND_INT:return{validType:n.c.NUMBER,dataType:n.a.NONE};case o.DATA_VALIDATION_RULE_TYPE.CUSTOM_MUST_FLOAT:return{validType:n.c.NUMBER,dataType:n.a.FLOAT};case o.DATA_VALIDATION_RULE_TYPE.TEXT_LENGTH:return{validType:n.c.TEXT,dataType:n.a.LENGTH};case o.DATA_VALIDATION_RULE_TYPE.DATE:return{validType:n.c.DATE,dataType:n.a.NONE};case o.DATA_VALIDATION_RULE_TYPE.CUSTOM_NUM_PHONE:return{validType:n.c.AVAILABLE,dataType:n.a.PHONE};case o.DATA_VALIDATION_RULE_TYPE.CUSTOM_ID_CARD:return{validType:n.c.AVAILABLE,dataType:n.a.ID_CARD};case o.DATA_VALIDATION_RULE_TYPE.CUSTOM_TEXT_CONTAINS:return{validType:n.c.TEXT,dataType:n.a.CONTENT};case o.DATA_VALIDATION_RULE_TYPE.CUSTOM_TEXT_MAIL:return{validType:n.c.AVAILABLE,dataType:n.a.MAIL};case o.DATA_VALIDATION_RULE_TYPE.CUSTOM_TEXT_URL:return{validType:n.c.AVAILABLE,dataType:n.a.URL};case o.DATA_VALIDATION_RULE_TYPE.CUSTOM_TEXT_GENDER:return{validType:n.c.AVAILABLE,dataType:n.a.GENDER}}return null}function i(e,t,r){var n=e.getCellDataAtPosition(t,r),o=null===n||void 0===n?void 0:n.getUserEnteredFormat();return o?o.getDataValidation():null}},"./src/core/feature/dataValidation/api/DataValidationUtils.ts":function(e,t,r){"use strict";r.d(t,"o",(function(){return m})),r.d(t,"l",(function(){return p})),r.d(t,"q",(function(){return v})),r.d(t,"p",(function(){return g})),r.d(t,"a",(function(){return y})),r.d(t,"h",(function(){return _})),r.d(t,"b",(function(){return A})),r.d(t,"d",(function(){return E})),r.d(t,"g",(function(){return j})),r.d(t,"f",(function(){return R})),r.d(t,"i",(function(){return S})),r.d(t,"s",(function(){return C})),r.d(t,"m",(function(){return T})),r.d(t,"k",(function(){return w})),r.d(t,"e",(function(){return O})),r.d(t,"c",(function(){return I})),r.d(t,"n",(function(){return N}));r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.from.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.set.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/es.string.match.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/core-js/modules/es.string.trim.js"),r("../node_modules/core-js/modules/esnext.set.add-all.js"),r("../node_modules/core-js/modules/esnext.set.delete-all.js"),r("../node_modules/core-js/modules/esnext.set.difference.js"),r("../node_modules/core-js/modules/esnext.set.every.js"),r("../node_modules/core-js/modules/esnext.set.filter.js"),r("../node_modules/core-js/modules/esnext.set.find.js"),r("../node_modules/core-js/modules/esnext.set.intersection.js"),r("../node_modules/core-js/modules/esnext.set.is-disjoint-from.js"),r("../node_modules/core-js/modules/esnext.set.is-subset-of.js"),r("../node_modules/core-js/modules/esnext.set.is-superset-of.js"),r("../node_modules/core-js/modules/esnext.set.join.js"),r("../node_modules/core-js/modules/esnext.set.map.js"),r("../node_modules/core-js/modules/esnext.set.reduce.js"),r("../node_modules/core-js/modules/esnext.set.some.js"),r("../node_modules/core-js/modules/esnext.set.symmetric-difference.js"),r("../node_modules/core-js/modules/esnext.set.union.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("../packages/model/src/index.ts"),o=r("../node_modules/@tencent/txdoc_dayjs/dayjs.min.js"),a=r.n(o),s=r("./src/core/feature/dataValidation/api/DataValidationUIUtils.ts");r.d(t,"j",(function(){return s.b})),r.d(t,"r",(function(){return s.c}));r("./src/core/feature/dataValidation/DVInterface.ts");var i=r("./src/core/feature/formula/utils.ts"),u=r("./src/core/utils/cell.ts"),l=r("./src/core/utils/formula.ts"),c=r("./src/core/utils/numberFromat.ts"),d=r("../packages/model/src/range/hexRangeUtils.ts"),f=r("../packages/model/src/cell/metadata/CustomDataType.ts"),h=n.Cell.Format.DATA_VALIDATION_RULE_TYPE,m=function(e,t,r){return e?e.split(t).join(r):""},p=function(e){switch(e.ruleType){case h.LIST:case h.NUMBER_INT:case h.NUMBER_FLOAT_AND_INT:case h.CUSTOM_MUST_FLOAT:case h.TEXT_LENGTH:case h.DATE:return!0}return!1},v=function(e,t,r){return m(e,"$SLOT",Object(i.Q)(t,r))},g=function(e,t,r){return m(e,Object(i.Q)(t,r),"$SLOT")},y=function(e){var t;return t=(t=(t=e.split(",")).map((function(e){return e.trim()}))).filter((function(e){return e})),Array.from(new Set(t))};function _(e,t,r){try{var n=Object(s.a)(e.spreadsheet.activeSheet,t,r);if(null==n||null==n.argTokens||null==n.argTokens[0].userEnteredValue||"list"!==n.ruleType)return console.warn("\u6570\u636e\u9a8c\u8bc1\uff1a\u7c7b\u578b\u4e0d\u4e3alist\u6216\u8005\u7528\u6237\u8f93\u5165\u4e3a\u7a7a\uff0c\u4e0d\u80fd\u83b7\u53d6\u4e0b\u62c9\u5217\u8868\u4fe1\u606f"),null;var o=n.argTokens[0].userEnteredValue,a=function(e){var t,r=null===e||void 0===e||null===(t=e.argTokens)||void 0===t?void 0:t[0].userEnteredValue;if(!r||"list"!==e.ruleType)return null;if(0!=r.length&&"="===r[0])return"range-list";if(0!=r.length)return"item-list";return null}(n);if("range-list"===a){var i=function(e,t){if(null==t)return null;var r=t,n=e.spreadsheet.activeSheet.data.getCellDatasAtRange(r),o=[];return null===n||void 0===n||n.forEach((function(e){return e.forEach((function(e){null!=e&&o.push(Object(u.getMergedValue)(e))}))})),o}(e,b(e,o));return null===i?[]:(i=i.filter((function(e){return e})),Array.from(new Set(i)))}return"item-list"===a&&null!=o?y(o):null}catch(l){return console.warn("\u6570\u636e\u9a8c\u8bc1\u83b7\u53d6\u4e0b\u62c9\u5217\u8868\u9519\u8bef\uff0c",l),null}}var b=function(e,t,r){return t?(!r&&e&&(r=e.spreadsheet.activeSheetId),r?Object(d.hex2Range)(t,r):null):null};var A=function(e){return-1===["between","notBetween","equal","notEqual","lessThan","lessThanOrEqual","greaterThan","greaterThanOrEqual"].indexOf(e)},E=function(e){return-1===["contains","notContains","equal"].indexOf(e)};function j(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYY-MM-DD",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"date",o=a()(e),s=o.format(t);return"date"==r&&(s+="T00:00:00"),n.Utils.numberFormatUtils.formatParseEngine.datetime2Numeric(s)}function R(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYY-MM-DD",r=n.Utils.numberFormatUtils.formatRenderEngine.render(e,t);return r.error?e:r.data.value||e}var S=function(e){if(e){var t=n.Utils.numberFormatUtils.formatParseEngine.parseValueWithStyle(e);return null==t?e:t.value}return e},C=function(e,t){var r,n=Object(i.C)(e);if("string"===typeof e)if('""'===e)r=e;else{if(n)return Object(l.moveEqualChar)(e);r='"'.concat(e,'"')}else{if("number"===typeof e||"boolean"===typeof e)return r="".concat(e);r='""'}return r},T=function(e,t,r){for(var n=t,o=t.sheetId,a=e.sheetManager.getSheetBySheetId(t.sheetId),s=n.isCol?0:n.startRowIndex,i=n.isCol?a.getRowCount()-1:n.endRowIndex,u=n.isRow?0:n.startColIndex,l=n.isRow?a.getColCount()-1:n.endColIndex,c=s;c<=i;c++)for(var d=u;d<=l;d++)r(c,d,o)},w=function(e){var t;if(e.preview&&!(null===(t=e.preview)||void 0===t?void 0:t.isActive)){var r=e.view.getSelection();if(!r)return!1;var n=r.activeCell,o=n.rowIndex,a=n.colIndex;return!!Object(s.b)(e.spreadsheet.activeSheet,o,a)}};function O(e,t,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=o.fractionFirst,s=void 0!==a&&a,i=e.inputOne,u=e.inputTwo,d=e.operate,f=e.inputTwoShow;if(!f)return null;if(d!==n.Cell.Format.DATA_VALIDATION_CONDITION_TYPE.BETWEEN&&d!==n.Cell.Format.DATA_VALIDATION_CONDITION_TYPE.NOT_BETWEEN)return null;if(""===i.trim()||""===u.trim())return null;if(Object(l.isFormulaString)(i)||Object(l.isFormulaString)(u))return null;var h=Object(c.stringToNumber)(i,{fractionFirst:s}),m=Object(c.stringToNumber)(u,{fractionFirst:s});if(!h||!m)return null;var p=h.numericValue,v=m.numericValue;return"number"!==typeof p||"number"!==typeof v?null:v-p<0?1===t?{inputOneIsError:!0,inputOneErrorTip:"\u8bf7\u8f93\u5165\u5c0f\u4e8e\u6700\u5927\u503c\u7684".concat(r),inputTwoIsError:!1}:{inputOneIsError:!1,inputTwoIsError:!0,inputTwoErrorTip:"\u8bf7\u8f93\u5165\u5927\u4e8e\u6700\u5c0f\u503c\u7684".concat(r)}:null}var I=function(e,t){switch(t.ruleType){case h.DATE:return!!n.Utils.numberFormatUtils.formatParseEngine.parseDate(e);case h.NUMBER_INT:case h.CUSTOM_MUST_FLOAT:case h.NUMBER_FLOAT_AND_INT:return!n.Utils.numberFormatUtils.formatParseEngine.parseDate(e)}return!0};function N(e,t,r){var n;return(null===r||void 0===r||null===(n=r.getMetadata())||void 0===n?void 0:n.customDataType)===f.o.PROGRESS?"(".concat(e," * 100)"):e}},"./src/core/feature/dataValidation/calc-plugin/DataValidationApi.ts":function(e,t,r){"use strict";var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("./src/core/feature/dataValidation/calc-plugin/DataValidationHandler.ts"),s=function(){function e(t){Object(n.a)(this,e),this.formulaHandler=new a.a(t)}return Object(o.a)(e,[{key:"add",value:function(e,t){return this.formulaHandler.deleteDVToFMap(t),this.formulaHandler.updateDirtyRange(t),this.formulaHandler.addDVToFMap(e,t)}},{key:"delete",value:function(e){this.formulaHandler.deleteDVToFMap(e),this.formulaHandler.updateDirtyRange(e)}},{key:"clearDirtyRange",value:function(e){this.formulaHandler.updateDirtyRange(e)}},{key:"updateDirtyRange",value:function(e){this.formulaHandler.updateDirtyRange(e)}}]),e}();t.a=s},"./src/core/feature/dataValidation/calc-plugin/DataValidationHandler.ts":function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return A}));r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("./src/core/utils/index.ts"),s=r("./src/base/index.ts"),i=r("../packages/mutation/src/cell/SetCellPropertiesMutation.ts"),u=r("../packages/model/src/range/GridRange.ts"),l=r("../packages/model/src/cell/CellDataDelta.ts"),c=r("../packages/model/src/cell/CellFormatDelta.ts"),d=r("../packages/model/src/cell/CellDataSlot.ts"),f=r("../packages/model/src/cell/CellFormatSlot.ts"),h=r("./src/core/feature/formula/utils.ts"),m=r("./src/core/feature/formula/utils/parseUtil.ts"),p=r("./src/core/feature/dataValidation/api/DataValidationRule.ts"),v=r("./src/core/feature/dataValidation/api/DataValidationUtils.ts"),g=r("./src/core/worker/worker-thread/index.ts"),y=r("../packages/model/src/factory/index.ts"),_=r("../packages/mutation/src/cell/SetRangeMutation.ts"),b=r("./src/core/feature/dataValidation/custom-formula/index.ts"),A=function(){function t(r){var o=this;Object(n.a)(this,t),this.addDVNode=function(e,t,r,n,a){var s=o.generateFormula(e,t,r,a);if(null===s)return null;var i={row:t,col:r,formula:s,sheetId:n},u=[],l=o.addToFMap(i);l&&u.push(l);var c=o.addUserValueToFMap(e,t,r,n)||void 0;return c&&u.push(c),u},this.addUserValueToFMap=function(e,t,r,n){var s=null===e||void 0===e?void 0:e.argTokens;if(null==s||s&&0==s.length)return null;if(0===s.filter((function(e){return Object(h.C)(e.userEnteredValue)})).length)return null;var i="";s.map((function(e,t){var r=e.userEnteredValue;return r=Object(h.C)(r)?a.a.formula.util.moveEqualChar(r):'"SLOT"',i+=0==t?"=".concat(r):"&".concat(r),null}));var u=Object(m.c)(i,t,r,n);o.externalMethods.addCustomFormulaNodeAndGenerateDependency({formulaModel:u,row:t,col:r,sheetId:n,customType:"dvuser"})},this.addDVToFMap=function(t,r){var n=[],a=e.SpreadsheetApp.spreadsheet;return Object(v.m)(a,r,(function(e,r,s){var i,u=null===(i=a.sheetManager.getSheetBySheetId(s))||void 0===i?void 0:i.getCellDataAtPosition(e,r),l=o.addDVNode(t,e,r,s,u);Array.prototype.push.apply(n,l)})),n},this.deleteDVToFMap=function(t){Object(v.m)(e.SpreadsheetApp.spreadsheet,t,(function(e,t,r){o.externalMethods.removeCustomFormulaNode({row:e,col:t,sheetId:r,customType:"dv"})}))},this.updateDirtyRange=function(t,r){if(!t)return null;Object(v.m)(e.SpreadsheetApp.spreadsheet,t,(function(e,t,n){var a=o.externalMethods.getItemsAccordingToCustomTypeAndPosition([{customTypes:["dv"],row:e,col:t,sheetId:n}]),s=a&&function(e,t,r){var n=e.results,o=null;if(Object.keys(n).forEach((function(e){-1!==e.indexOf("dv")&&(o=e)})),null===o)return null;var a=n[o];if(a){var s=null===a||void 0===a?void 0:a.value;return s=!(!0!==s&&"TRUE"!==s)}return a}(a[0]);return null===s?o.clearDataValidationResult(e,t,n,r):o.setDataValidationResult(s,e,t,n,r)}))},this.setDataValidationResult=function(e,t,r,n,a){o.onUpdateCellDataDataValidationResult(n,t,r,e,a)},this.clearDataValidationResult=function(e,t,r,n){o.onUpdateCellDataDataValidationResult(r,e,t,null,n)},this.onBatchUpdateDataValidation=function(e){var t=e[0].sheetId,r=new _.a({gridRange:new u.b(t,0,o.externalMethods.countRows(t)-1,0,o.externalMethods.countCols(t)-1),cellDataDeltaAtPositions:e.map((function(e){var t=e.row,r=e.col,n=e.dataValidation,o=new l.a,a=new c.a;return a.setSlot(f.b.DATA_VALIDATION,n),o.setSlot(d.b.SLOT_USER_ENTERED_FORMAT_DELTA,a),{rowIndex:t,colIndex:r,cellDataDelta:o}}))});"string"===typeof e[0].options.mutationQueueIdRelatedSheetId&&g.a.workerThreadWorker.mutationData.syncNonPersistentMutationsToMainThread({mutations:[r],isFromFormula:!0})},this.getDataValidation=function(e,t,r){var n,a,s=o.externalMethods.getCellData(e,t,r),i=null===s||void 0===s||null===(n=s.getUserEnteredFormat)||void 0===n?void 0:n.call(s),u=null===i||void 0===i||null===(a=i.getDataValidation)||void 0===a?void 0:a.call(i);return u||null},this.onUpdateDataValidation=function(e,t,r,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=new l.a,s=new u.b(e,t,t,r,r),h=new c.a;h.setSlot(f.b.DATA_VALIDATION,n),a.setSlot(d.b.SLOT_USER_ENTERED_FORMAT_DELTA,h);var m=new i.a({gridRange:s,cellDataDelta:a});"string"===typeof o.mutationQueueIdRelatedSheetId&&g.a.workerThreadWorker.mutationData.syncNonPersistentMutationsToMainThread({mutations:[m],isFromFormula:!0})},this.onUpdateCellDataDataValidationResult=function(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s=new l.a,c=new u.b(e,t,t,r,r);if(o.externalMethods.cellDataHasValue(c)){s.setSlot(d.b.SLOT_IS_DATA_VALID,n);var f=new i.a({gridRange:c,cellDataDelta:s});"string"===typeof a.mutationQueueIdRelatedSheetId&&g.a.workerThreadWorker.mutationData.syncNonPersistentMutationsToMainThread({mutations:[f],isFromFormula:!0})}},this.customTypeResultChange=function(e){var t=e.customType,r=e.datas,n=e.options;if(!/^dv$/.test(t))return null;r.forEach((function(e){var t=e.value,r=e.row,a=e.col,s=e.sheetId;n||(n={mutationQueueIdRelatedSheetId:s});var i=!1;if("boolean"===typeof t)i=!0===t;else if(Array.isArray(t)){i=t[0].value}o.resultList.push({sheetId:s,row:r,col:a,isDataValid:i,options:n})})),o.batchSendResult()},this.customTypeFormulaModelChange=function(e){var t=e.customType,r=e.datas,n=e.options;(function(e){return/dvuser/.test(e+="")})(t)&&r.forEach((function(e){var t=e.row,r=e.col,s=e.sheetId;n||(n={mutationQueueIdRelatedSheetId:s});var i=o.getDataValidation(t,r,s),u=function(e,t,r,n){var o=e.toString(t,r,n);return a.a.formula.util.moveEqualChar(o).split("&").map((function(e,t){if('"SLOT"'!=e)return{value:"=".concat(e),index:t}}))}(e.formulaModel,t,r,n);if(!u)return null;var l=function(e,t){if(null===e)return null;var r=e.ruleType,n=e.inputMessage,o=e.isStrict,a=e.showDropDown,s=e.operator,i=e.argTokens;return null!==i&&t?(i=i.map((function(e){return{userEnteredValue:e.userEnteredValue}})),t.forEach((function(e){if(!i||!e)return null;i[e.index]={userEnteredValue:e.value}})),y.DataValidationFactory.createInstance({ruleType:r,inputMessage:n,isStrict:o,showDropDown:a,operator:s,argTokens:i})):null}(i,u);o.onUpdateDataValidation(s,t,r,l,n)}))},this.batchSendResult=function(){for(;o.resultList.length>=1e3||0!=o.resultList.length;){var e=Math.min(1e3,o.resultList.length);o.onBatchUpdateCellDataDataValidationResult(o.resultList.slice(0,e)),o.resultList=o.resultList.slice(e,o.resultList.length)}},this.generateFormula=function(e,t,r,n){if(null===e)return null;var o=Object(p.b)(e);if(null===o)return null;var a=Object(h.Q)(t,r),s=Object(v.n)(a,e,n);return o=Object(v.o)(o,"$SLOT",s)},this.addToFMap=function(e){var t=e.formula,r=e.row,n=e.col,a=e.sheetId,s=Object(m.c)(t,r,n,a);return o.externalMethods.addCustomFormulaNodeAndGenerateDependency({formulaModel:s,row:r,col:n,sheetId:a,customType:"dv"})},this.externalMethods=r,this.subscribe(),this.resultList=[],Object(b.a)()}return Object(o.a)(t,[{key:"onBatchUpdateCellDataDataValidationResult",value:function(e){var t=e[0].sheetId,r=this.externalMethods.countRows(t),n=this.externalMethods.countCols(t),o=r-1,a=0,s=n-1,i=0,c=e.map((function(e){return e.row>=r||e.col>=n||e.col<0||e.col<0?null:(o=Math.min(e.row,o),a=Math.max(e.row,a),s=Math.min(e.col,s),i=Math.max(e.col,i),{rowIndex:e.row,colIndex:e.col,cellDataDelta:null!=e.isDataValid?new l.a({setSlots:1<<d.b.SLOT_IS_DATA_VALID,clearSlots:0,delta:{isDataValid:e.isDataValid}}):new l.a({setSlots:0,clearSlots:1<<d.b.SLOT_IS_DATA_VALID})})})).filter((function(e){return e})),f=new _.a({gridRange:new u.b(t,o,a,s,i),cellDataDeltaAtPositions:c});"string"===typeof e[0].options.mutationQueueIdRelatedSheetId&&g.a.workerThreadWorker.mutationData.syncNonPersistentMutationsToMainThread({mutations:[f],isFromFormula:!0})}},{key:"subscribe",value:function(){s.a.event.formula.listen("customTypeFormulaModelChange",this.customTypeFormulaModelChange),s.a.event.formula.listen("customTypeResultChange",this.customTypeResultChange)}}]),t}()}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/feature/dataValidation/custom-formula/index.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return g}));var n=r("./src/core/feature/formula/custom-formula/index.ts"),o=(r("../node_modules/core-js/modules/es.number.constructor.js"),r("../node_modules/core-js/modules/es.number.is-integer.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("./src/core/feature/formula/lib/utils.js")),a=r("../packages/model/src/cell/format/DataValidationConditionType.ts"),s=r("../packages/model/src/utils/numberFormat/FormatParseEngine.ts"),i=r("./src/core/feature/dataValidation/type.ts"),u={acceptRef:!1,min:5};function l(e,t,r,n,s){var u,l=Object(o.m)(s)?null===(u=s.toArray())||void 0===u?void 0:u[0]:s;return[[function(e,t,r,n,o){return null!==r&&(function(e,t){var r=!1;switch(e){case i.b.INT:r="number"===typeof t&&Number.isInteger(t);break;case i.b.FLOAT:r="number"===typeof t&&!Number.isInteger(t);break;default:r="number"===typeof t}return r}(t,r)&&function(e,t,r,n){var o=!1;switch(e){case a.a.BETWEEN:o=t>=r&&t<=n;break;case a.a.NOT_BETWEEN:o=t<r||t>n;break;case a.a.EQUAL:o=t===r;break;case a.a.NOT_EQUAL:o=t!==r;break;case a.a.LESS:o=t<r;break;case a.a.LESS_EQUAL:o=t<=r;break;case a.a.GREAT:o=t>r;break;case a.a.GREAT_EQUAL:o=t>=r}return o}(e,r,n,o))}(e,t,t===i.b.LENGTH?l.toString().length:c(l),c(r),c(n))]]}function c(e){var t;if("number"===typeof e)return e;var r=(null===(t=Object(s.parseValue)(e,null))||void 0===t?void 0:t.numericValue)||e;return"string"!==typeof r||isNaN(parseFloat(r))?r:parseFloat(r)}r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.regexp.constructor.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var d=r("./src/core/feature/formula/utils.ts"),f={acceptRef:!1,min:3};function h(e,t,r){var n,s=Object(o.m)(r)?null===(n=r.toArray())||void 0===n?void 0:n[0]:r,i=!1;if((null===t||void 0===t?void 0:t.indexOf("#REGEXP"))<0){var u=t.toString();i=null!==s&&function(e,t,r){switch(e){case a.a.INCLUDE:return!m(t)&&-1!==t.indexOf(r);case a.a.NOT_INCLUDE:return m(t)||-1===t.indexOf(r);case a.a.EQUAL:return!m(t)&&t===r}return!1}(e,s.toString(),u)}else{var l=null===t||void 0===t?void 0:t.split("#REGEXP ").map((function(e){if(!(e.length<=0))return new RegExp(e,"g")}));i=null!==s&&function(e,t,r){var n=!1;!m(t)&&r&&r.forEach((function(e){(null===e||void 0===e?void 0:e.test(t))&&(n=!0)}));return n}(0,s.toString(),l)}return[[i]]}function m(e){return Object(d.v)(e)||"number"===typeof e&&(isNaN(e)||!isFinite(e))}r("../node_modules/core-js/modules/es.array.some.js");var p={acceptRef:!1,min:5};function v(e,t){var r,n=Object(o.m)(t)?null===(r=t.toArray())||void 0===r?void 0:r[0]:t;return null===n?[[!0]]:(n=n.toString(),[[(Object(o.m)(e)?e.toArray():e.split(",")).some((function(e){return null!==e&&e.toString()===n}))]])}function g(){n.a.register("DATA_VALID_NUMBER",l,u),n.a.register("DATA_VALID_TEXT",h,f),n.a.register("DATA_VALID_LIST",v,p)}},"./src/core/feature/dataValidation/type.ts":function(e,t,r){"use strict";var n,o,a;r.d(t,"a",(function(){return n})),r.d(t,"c",(function(){return o})),r.d(t,"b",(function(){return a})),function(e){e.CONTENT="content",e.LENGTH="length",e.INT="int",e.FLOAT="float",e.ID_CARD="id-card",e.PHONE="phone",e.MAIL="mail",e.URL="url",e.GENDER="gender",e.NONE="none"}(n||(n={})),function(e){e.LIST="list",e.NUMBER="number",e.TEXT="text",e.DATE="date",e.AVAILABLE="available"}(o||(o={})),function(e){e[e.NONE=0]="NONE",e[e.INT=1]="INT",e[e.FLOAT=2]="FLOAT",e[e.LENGTH=3]="LENGTH",e[e.DATE=4]="DATE"}(a||(a={}))},"./src/core/feature/formula/UIUtils.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return o}));r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.replace.js");function n(e){if("string"===typeof e&&o(e)){var t=e.replace(/(")[^"]*?\1/g,"");t=(t=t.replace(/'.*?'!/g,"")).replace(/\n$/g,"");for(var r=0,n=0,a=0;a<t.length;++a)"("===t[a]?r+=1:")"===t[a]&&(n+=1);r-n===1&&(e+=")")}return e}function o(e){return"string"===typeof e&&"="===e[0]&&e.length>1}},"./src/core/feature/formula/ast_node/NODE_TYPE.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"c",(function(){return o})),r.d(t,"e",(function(){return a})),r.d(t,"b",(function(){return s})),r.d(t,"d",(function(){return i}));var n,o,a,s,i;r("./src/core/feature/formula/ast_node/node/CalcRef.ts");!function(e){e.CELL="CELL",e.EMPTY_CELL="EMPTY_CELL",e.FUNCTION="FUNCTION",e.VARIABLE="VARIABLE",e.CELL_RANGE="CELL_RANGE",e.CELL_RANGE_BINARY="CELL_RANGE_BINARY"}(n||(n={})),function(e){e.NONE="NONE",e.NORMAL="NORMAL",e.THREE_DIMENSION="THREE_DIMENSION"}(o||(o={})),function(e){e.VARIABLE="VARIABLE",e.BINARY="BINARY",e.ORIGIN="ORIGIN",e.STR="STR",e.NUM="NUM",e.MINUS="MINUS",e.PERCENTAGE="PERCENTAGE",e.PLACEHOLDER="PLACEHOLDER",e.BOOL="BOOL",e.TIME="TIME",e.ERROR="ERROR"}(a||(a={})),function(e){e.NORMAL="NORMAL",e.ROW="ROW",e.COL="COL",e.USER_RANGE="USER_RANGE",e.CELL="CELL"}(s||(s={})),function(e){e.INTERSECTION="INTERSECTION",e.CONCAT="CONCAT"}(i||(i={}))},"./src/core/feature/formula/ast_node/index.ts":function(e,t,r){"use strict";r.d(t,"c",(function(){return d})),r.d(t,"b",(function(){return b.a})),r.d(t,"e",(function(){return h})),r.d(t,"d",(function(){return p})),r.d(t,"f",(function(){return g})),r.d(t,"g",(function(){return _})),r.d(t,"a",(function(){return l}));r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.last-index-of.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.replace.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),s=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),i=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),u=r("./src/core/feature/formula/ast_node/NODE_TYPE.ts"),l=function(){function e(){Object(n.a)(this,e),this.calculateParentFunctionNode=void 0}return Object(o.a)(e,[{key:"setCalculateParentFunctionNode",value:function(e){this.calculateParentFunctionNode=e}},{key:"setValue",value:function(e){this.value=e}},{key:"toString",value:function(e,t){}},{key:"toFormulaModel",value:function(e,t){return[]}}]),e}();function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(i.a)(e);if(t){var o=Object(i.a)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var d=function(e){Object(a.a)(r,e);var t=c(r);function r(e,o,a,s,i,l){var c;return Object(n.a)(this,r),(c=t.call(this)).cellId=e,c.originValue=o,c.row=a,c.col=s,c.sheetId=i,c.nodeType=u.a.CELL,c.crossTableType=l,c.asyncFunctionNodeList=[],c}return Object(o.a)(r,[{key:"setFormula",value:function(e){this.formula=e}},{key:"equalsFormula",value:function(e){return this.formula===e}},{key:"setAsyncFunctionNodeList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.asyncFunctionNodeList=e}},{key:"getAsyncFunctionNodeList",value:function(){return this.asyncFunctionNodeList}},{key:"setBody",value:function(e){this.body=e}},{key:"toString",value:function(e,t){if("function"===typeof t.CELL)t.CELL(e,this);else{if(this.originValue.indexOf("'")>=0){var r=this.originValue.lastIndexOf("!"),n=this.originValue.slice(0,r);"'"===n[0]&&n.slice(1,n.length-1).indexOf("'")>=0&&(n=(n=(n=n.slice(1,n.length-1)).replace(/'/g,"''")).slice(1,n.length-1)),this.originValue=n+this.originValue.slice(r)}e.push(this.originValue)}}},{key:"toFormulaModel",value:function(e,t){var r=[];return"function"===typeof e.CELL&&e.CELL(r,this,t),r}}]),r}(l);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(i.a)(e);if(t){var o=Object(i.a)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var h=function(e){Object(a.a)(r,e);var t=f(r);function r(e,o,a,s,i,l,c,d,f){var h;return Object(n.a)(this,r),(h=t.call(this)).nodeType=u.a.CELL_RANGE,h.startSheetId=e,h.endSheetId=o,h.cellRangeType=c,h.crossTableType=d,h.start=a,h.end=s,h.scope=i,h.sheetIds=l,h.originValue=f,h}return Object(o.a)(r,[{key:"updateSheetIds",value:function(e){this.sheetIds=e}},{key:"toString",value:function(e,t){if("function"===typeof t.CELL_RANGE)t.CELL_RANGE(e,this);else{if(this.originValue.indexOf("'")>=0){var r=this.originValue.lastIndexOf("!"),n=this.originValue.slice(0,r);"'"===n[0]&&n.slice(1,n.length-1).indexOf("'")>=0&&(n=(n=(n=n.slice(1,n.length-1)).replace(/'/g,"''")).slice(1,n.length-1)),this.originValue=n+this.originValue.slice(r)}e.push(this.originValue)}}},{key:"toFormulaModel",value:function(e,t){var r=[];return"function"===typeof e.CELL_RANGE&&e.CELL_RANGE(r,this,t),r}}]),r}(l);r("../node_modules/core-js/modules/es.array.concat.js");function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(i.a)(e);if(t){var o=Object(i.a)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var p=function(e){Object(a.a)(r,e);var t=m(r);function r(e,o,a){var s;return Object(n.a)(this,r),(s=t.call(this)).nodeType=u.a.CELL_RANGE_BINARY,s.binaryType=a,s.leftRange=e,s.rightRange=o,s}return Object(o.a)(r,[{key:"toString",value:function(e,t){this.binaryType===u.d.CONCAT?(this.leftRange.toString(e,t),e.push(","),this.rightRange.toString(e,t)):this.binaryType===u.d.INTERSECTION&&(this.leftRange.toString(e,t),e.push(" "),this.rightRange.toString(e,t))}},{key:"toFormulaModel",value:function(e,t){var r=[];return this.binaryType===u.d.CONCAT?((r=r.concat(this.leftRange.toFormulaModel(e,t))).push(","),r=r.concat(this.rightRange.toFormulaModel(e,t))):this.binaryType===u.d.INTERSECTION&&((r=r.concat(this.leftRange.toFormulaModel(e,t))).push(" "),r=r.concat(this.rightRange.toFormulaModel(e,t))),r}}]),r}(l);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(i.a)(e);if(t){var o=Object(i.a)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var g=function(e){Object(a.a)(r,e);var t=v(r);function r(e,o){var a;return Object(n.a)(this,r),(a=t.call(this)).nodeType=u.a.FUNCTION,a.args=o,a.funcName=e,a}return Object(o.a)(r,[{key:"setFormatType",value:function(e){this.formatType=e}},{key:"toString",value:function(e,t){e.parentFunctionNode=this;if({LOGICMATCH:!0,SPECIALMATCH:!0,MATHMATCH:!0}[this.funcName])this.args[0].toString(e,t),this.args[2].toString(e,t),this.args[1].toString(e,t);else{e.push("".concat(this.funcName,"("));for(var r=0;r<this.args.length;r++){this.args[r].toString(e,t),r!==this.args.length-1&&e.push(",")}e.push(")")}}},{key:"toFormulaModel",value:function(e,t){var r=[];if({LOGICMATCH:!0,SPECIALMATCH:!0,MATHMATCH:!0}[this.funcName])r=(r=(r=r.concat(this.args[0].toFormulaModel(e,this))).concat(this.args[2].toFormulaModel(e,this))).concat(this.args[1].toFormulaModel(e,this));else{r.push("".concat(this.funcName,"("));for(var n=0;n<this.args.length;n++){var o=this.args[n];r=r.concat(o.toFormulaModel(e,this)),n!==this.args.length-1&&r.push(",")}r.push(")")}return r}}]),r}(l);function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(i.a)(e);if(t){var o=Object(i.a)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var _=function(e){Object(a.a)(r,e);var t=y(r);function r(e,o,a){var s;return Object(n.a)(this,r),(s=t.call(this)).nodeType=u.a.VARIABLE,s.variableType=o,s.originValueNode=e,s.toString=a||function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=this.originValueNode;return this.variableType===u.e.STR&&((t=t.slice(1,t.length-1)).indexOf('"')>=0&&(t=t.replace(/"/g,'""')),t='"'.concat(t,'"')),e.push(t),t},s}return Object(o.a)(r,[{key:"toFormulaModel",value:function(e,t){var r=[];return this.toString(r,e),r}}]),r}(l),b=r("./src/core/feature/formula/ast_node/node/CalcRef.ts")},"./src/core/feature/formula/ast_node/node/CalcRef.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=function(){function e(t,r,o){var a=this;Object(n.a)(this,e),this.identities=t,this.isCell=r,this.toArray=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=o.apply(a,t);return a.setValue(n),n}}return Object(o.a)(e,[{key:"getRangeCount",value:function(){return this.identities.length}},{key:"getIdentities",value:function(e){return this.identities[e]}},{key:"getRowCount",value:function(e){return this.identities[e].rowCount}},{key:"getColumnCount",value:function(e){return this.identities[e].colCount}},{key:"getRow",value:function(e){return this.identities[e].row}},{key:"getColumn",value:function(e){return this.identities[e].col}},{key:"getSheetId",value:function(e){return this.identities[e].sheetId}},{key:"setValue",value:function(e){this.value=e}}]),e}()},"./src/core/feature/formula/ast_node/utils.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return i})),r.d(t,"d",(function(){return u})),r.d(t,"l",(function(){return l})),r.d(t,"g",(function(){return c})),r.d(t,"h",(function(){return d})),r.d(t,"e",(function(){return f})),r.d(t,"f",(function(){return h})),r.d(t,"j",(function(){return m})),r.d(t,"k",(function(){return p})),r.d(t,"m",(function(){return v})),r.d(t,"i",(function(){return g})),r.d(t,"n",(function(){return _}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("./src/core/feature/formula/ast_node/NODE_TYPE.ts"),o=r("./src/core/feature/formula/ast_node/index.ts");r("./src/core/feature/formula/func-config.ts");function a(e){return e&&e instanceof o.b}function s(e){return e&&(e.nodeType===n.a.CELL||e.nodeType===n.a.EMPTY_CELL)}function i(e){return!!e&&e.nodeType===n.a.CELL}function u(e){return e&&e.crossTableType===n.c.NORMAL}function l(e){return!!h(e)&&e.cellRangeType===n.b.USER_RANGE}function c(e){return e&&e.crossTableType!==n.c.NONE}function d(e){return e&&e.crossTableType===n.c.THREE_DIMENSION}function f(e){return e&&e.nodeType===n.a.CELL_RANGE_BINARY}function h(e){return e&&e.nodeType===n.a.CELL_RANGE}function m(e){return"boolean"!==typeof e&&e&&e.nodeType===n.a.FUNCTION}function p(e){return m(e)&&"MATHMATCH"!==e.funcName&&"LOGICMATCH"!==e.funcName&&"SPECIALMATCH"!==e.funcName}function v(e){return e&&e.nodeType===n.a.VARIABLE}function g(e,t){if(t)if("OFFSET"===t.funcName){if(0===t.args.indexOf(e))return!0}else if("ROW"===t.funcName||"COLUMN"===t.funcName)return!0;return!1}var y={stopSearchingDown:!1,stopParallelTraversal:!1,stopAll:!1,walkContext:{}};function _(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.preorder,o=void 0!==n&&n,a=r.walkContext,s=void 0===a?{}:a,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(u.length||u.push(e),i(e))return b(e,t,{preorder:o,walkContext:s},u);if(m(e))return A(e,t,{preorder:o,walkContext:s},u);if(h(e)){var l=!1;return{stopAll:l}}return v(e)?E(e,t,{preorder:o,walkContext:s},u):f(e)?j(e,t,{preorder:o,walkContext:s},u):{stopAll:!1}}function b(e,t,r,n){var o=r.preorder,a=r.walkContext;if(!e.body)return{stopAll:!1};var s=n.concat([e.body]),i=t(e.body,s,{walkContext:a})||y,u=i.stopSearchingDown,l=void 0!==u&&u,c=i.stopAll,d=void 0!==c&&c,f=i.walkContext;return d?{stopAll:!0}:!0!==l?_(e.body,t,{preorder:o,walkContext:f||a},s):{stopAll:d}}function A(e,t,r,n){for(var o=r.preorder,a=r.walkContext,s=e.args,i=o?0:s.length-1,u=o?s.length-1:0,l=i;o?l<=u:l>=u;o?l+=1:l-=1){var c=s[l],d=n.concat(c),f=t(c,d,{walkContext:a})||y,h=f.stopSearchingDown,m=void 0!==h&&h,p=f.stopParallelTraversal,v=void 0!==p&&p,g=f.stopAll,b=void 0!==g&&g,A=f.walkContext;if(b)return{stopAll:b};if(!0!==m)if(_(c,t,{preorder:o,walkContext:A||a},d).stopAll)return{stopAll:!0};if(!0===v)break}return{stopAll:!1}}function E(e,t,r,n){var o=r.preorder,a=r.walkContext,s=e.originValueNode;if(function(e){return!!e&&"string"!==typeof e&&void 0!==e.nodeType&&null!==e.nodeType}(s)){var i=n.concat([s]),u=t(s,i,{walkContext:a})||y,l=u.stopSearchingDown,c=void 0!==l&&l,d=u.stopAll,f=void 0!==d&&d,h=u.walkContext;return f?{stopAll:!0}:!0!==c?_(s,t,{preorder:o,walkContext:h||a},i):{stopAll:f}}return{stopAll:!1}}function j(e,t,r,n){var o=r.preorder,a=r.walkContext,s={rightRange:n.concat([e.rightRange]),leftRange:n.concat([e.leftRange])},i=!1,u=!1;return(o?["leftRange","rightRange"]:["rightRange","leftRange"]).forEach((function(r){if(!i&&!u){var n=t(e[r],s[r],{walkContext:a})||y,l=n.stopSearchingDown,c=void 0!==l&&l,d=n.stopParallelTraversal,f=void 0!==d&&d,h=n.stopAll,m=void 0!==h&&h,p=n.walkContext;if(m)u=m;else if(i=!!f,!0===c)i=f;else{var v=_(e[r],t,{preorder:o,walkContext:p||a},s[r]).stopAll;u=v}}})),{stopAll:u}}},"./src/core/feature/formula/autofix.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"c",(function(){return c})),r.d(t,"b",(function(){return d}));r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.match.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/core-js/modules/es.string.trim.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../packages/model/src/cell/formula/formulaUtils.ts"),o=r("../packages/model/src/sheet/sheetUtils.ts"),a=r("./src/core/feature/formula/utils.ts");var s={"\uff1d":{reg:/[\uff1d]/g,target:"="},"\uff08":{reg:/[\uff08]/g,target:"("},"\uff09":{reg:/[\uff09]/g,target:")"},"\uff0c":{reg:/[\uff0c]/g,target:","},"\uff1a":{reg:/[\uff1a]/g,target:":"},"\uff1b":{reg:/[\uff1b]/g,target:";"},"\uff01":{reg:/[\uff01]/g,target:"!"},"\uff0f":{reg:/[\uff0f]/g,target:"/"},"\u3000":{reg:/[\u3000]/g,target:" "}};function i(e,t,r){return e=function(e){return e=~e.indexOf(" (")?e.replace(/[A-Z]+\s+\(/g,(function(e){return e.replace(/\s+/,"")})):e}(e=function(e,t){return Object.keys(s).forEach((function(r){t.indexOf(r)>=0||(e=e.replace(s[r].reg,s[r].target))})),e}(e,r)),e=function(e,t){return t.forEach((function(t){e=(e=e.split("".concat(t.toUpperCase(),"!")).join("".concat(t,"!"))).split("".concat(t.toUpperCase(),":")).join("".concat(t,":"))})),e}(e=function(e){var t=e;try{if(t.match(/ID/i)){var r,n,o=/ID\(\s*((\d{17}x)|(\d{18})|(\d{15})|([a-zA-Z]\d+))s*,\s*\)/gi,a=t.match(o);null===(r=a)||void 0===r||r.map((function(e){var r=(e.match(/(\d+x|\d+)\s*,/i)||[])[0];t=t.replace(r,"".concat(r,"0"))})),o=/ID\(\s*((\d{17}x)|(\d{18})|(\d{15}|([a-zA-Z]\d+)))\s*\)/gi,null===(n=a=t.match(o))||void 0===n||n.map((function(e){var r=(e.match(/(\d+x|\d+)\s*/i)||[])[0];t=t.replace(r,"".concat(r,",0"))}))}}catch(s){}return t}(e=function(e){var t=e;if(t.match(/STOCK/i)){var r=t.match(/STOCK\(\s*(\d+\.\w+)\s*(,\s*)?\)/gi);null===r||void 0===r||r.map((function(){t=t.replace(/(\d+\.\w+)\s*(,\s*)?\)/i,(function(e){return e.replace(/(,\s*)?\)/i,",0)")}))}))}return t}(e=function(e){if(!~e.indexOf(","))return e;var t=e.split(",");return t.forEach((function(e,r){(0===r||e.trim())&&(t[r]=e.replace(/(\s+$)/,""))})),t.join(",")}(e=Object(n.makeSelectionInOrder)(e)))),t)}function u(e,t,r){e=function(e){return e.toUpperCase()}(e);var n=t.filter((function(e){return Object(o.isSheetTitleValidateForCrossSheet)(e)})),a=t.join(""),s=/('.*?'!)/;if(s.test(e)){var u=e.split(s)||[];u.forEach((function(e,r){s.test(e)?(t.forEach((function(t){var r=t.toUpperCase();e=(e=(e=e.replace("'".concat(r,":"),(function(){return"'".concat(t,":")}))).replace(":".concat(r,"'!"),(function(){return":".concat(t,"'!")}))).replace("'".concat(r,"'!"),(function(){return"'".concat(t,"'!")}))})),u[r]=e):u[r]=i(e,n,a)})),e=u.join("")}else e=i(e,n,a);return e}function l(e,t,r){if(!Object(a.C)(e))return e;var n=e;n=Object(a.n)(n);var o=/(".*?")/;if(o.test(n)){var s=n.split(o)||[];s.forEach((function(e,r){var n=o.test(e);s[r]=n?e:u(e,t)})),n=s.join("")}else n=u(n,t);return n=d(n=c(n))}function c(e){var t=e;return e.indexOf("STOCK")>-1&&/(stock)(?=\()/gi.test(t)&&(t=t.replace(/STOCK\((\w+(\.\w+)+),([^)]+)\)/i,'STOCK("$1",$3)')),t}function d(e){if(-1===e.indexOf("ID("))return e;var t=e;try{var r=e.match(/ID\(\s*((\d{17}x)|(\d{18})|(\d{15}))\s*,/gi);null===r||void 0===r||r.forEach((function(r){var n=r.match(/(\d+x|\d+)/i)[0];t=e.replace(n,'"'.concat(n,'"'))}))}catch(n){console.error("\u9000\u51fa\u8eab\u4efd\u8bc1\u89e3\u6790",n)}return t}},"./src/core/feature/formula/calcControllerTaskQueue.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return a}));var n=[];function o(e){n.push(e)}function a(){for(;n.length>0;){var e=n.pop();e&&e()}}},"./src/core/feature/formula/calculate/calculateCenter.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return ue}));r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.symbol.description.js"),r("../node_modules/core-js/modules/es.symbol.iterator.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.from.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.function.name.js"),r("../node_modules/core-js/modules/es.map.js"),r("../node_modules/core-js/modules/es.object.assign.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.set.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/esnext.map.delete-all.js"),r("../node_modules/core-js/modules/esnext.map.every.js"),r("../node_modules/core-js/modules/esnext.map.filter.js"),r("../node_modules/core-js/modules/esnext.map.find.js"),r("../node_modules/core-js/modules/esnext.map.find-key.js"),r("../node_modules/core-js/modules/esnext.map.includes.js"),r("../node_modules/core-js/modules/esnext.map.key-of.js"),r("../node_modules/core-js/modules/esnext.map.map-keys.js"),r("../node_modules/core-js/modules/esnext.map.map-values.js"),r("../node_modules/core-js/modules/esnext.map.merge.js"),r("../node_modules/core-js/modules/esnext.map.reduce.js"),r("../node_modules/core-js/modules/esnext.map.some.js"),r("../node_modules/core-js/modules/esnext.map.update.js"),r("../node_modules/core-js/modules/esnext.set.add-all.js"),r("../node_modules/core-js/modules/esnext.set.delete-all.js"),r("../node_modules/core-js/modules/esnext.set.difference.js"),r("../node_modules/core-js/modules/esnext.set.every.js"),r("../node_modules/core-js/modules/esnext.set.filter.js"),r("../node_modules/core-js/modules/esnext.set.find.js"),r("../node_modules/core-js/modules/esnext.set.intersection.js"),r("../node_modules/core-js/modules/esnext.set.is-disjoint-from.js"),r("../node_modules/core-js/modules/esnext.set.is-subset-of.js"),r("../node_modules/core-js/modules/esnext.set.is-superset-of.js"),r("../node_modules/core-js/modules/esnext.set.join.js"),r("../node_modules/core-js/modules/esnext.set.map.js"),r("../node_modules/core-js/modules/esnext.set.reduce.js"),r("../node_modules/core-js/modules/esnext.set.some.js"),r("../node_modules/core-js/modules/esnext.set.symmetric-difference.js"),r("../node_modules/core-js/modules/esnext.set.union.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),o=(r("../node_modules/regenerator-runtime/runtime.js"),r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js")),a=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),s=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),i=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),u=r("./src/core/feature/formula/utils.ts"),l=r("./src/core/feature/formula/report.ts"),c=r("../packages/report/src/index.ts"),d=function(){function e(){Object(s.a)(this,e),this.asyncFuncNodeList=[],this.initCellMapData()}return Object(i.a)(e,[{key:"initCellMapData",value:function(){this.cell={},this.rangeCache={},this.cacheStatus=!1,this.asyncFuncNodeList=[]}},{key:"cleanAllAstNodes",value:function(e,t,r,n,o){for(var a=t;a<=r;a++)for(var s=n;s<=o;s++)this.deleteCell(e,a,s)}},{key:"destroy",value:function(){this.cell={},this.rangeCache={},this.asyncFuncNodeList=[]}},{key:"toggleCacheStatus",value:function(e){this.cacheStatus=e}},{key:"getCacheStatus",value:function(){return this.cacheStatus}},{key:"setCell",value:function(e,t,r,n){if(this.cacheStatus){var o=this.cell[e];void 0===o&&(o=[],this.cell[e]=[]),void 0===o[t]&&(o[t]=[]),o[t][r],o[t][r]=n}}},{key:"getCell",value:function(e,t,r){if(this.cacheStatus){var n=this.cell[e],o=null===n||void 0===n?void 0:n[t];return null===o||void 0===o?void 0:o[r]}}},{key:"deleteCell",value:function(e,t,r){var n,o;(null===(n=this.cell[e])||void 0===n||null===(o=n[t])||void 0===o?void 0:o[r])&&delete this.cell[e][t][r]}},{key:"addAsyncFunctionNodeList",value:function(e){this.asyncFuncNodeList.push(e)}},{key:"getAsyncFunctionNodeList",value:function(){return this.asyncFuncNodeList}},{key:"cleanAsyncFunctionNodeList",value:function(){this.asyncFuncNodeList&&this.asyncFuncNodeList.length>0&&(this.asyncFuncNodeList=[])}},{key:"startCalc",value:function(){this.rangeCache={}}}]),e}();d.asyncFunctions={STOCK:!0};var f,h=new d,m=(r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.splice.js"),r("../node_modules/core-js/modules/es.number.constructor.js"),r("../node_modules/core-js/modules/es.object.values.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.match.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"));!function(e){e.CELL="CELL",e.COL="COL",e.ROW="ROW",e.VARIABLE="VARIABLE",e.STRING="STRING",e.ERROR="ERROR",e.NUMBER="NUMBER",e.SHEET="SHEET",e.SEPARATOR="SEPARATOR",e.USERARRAY="USERARRAY",e.UNKNOW="UNKNOW"}(f||(f={}));var p=function e(t,r){Object(s.a)(this,e),this.value=t,this.type=r},v=r("./src/core/feature/formula/ast_node/NODE_TYPE.ts"),g=(r("../node_modules/core-js/modules/es.regexp.constructor.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("./src/core/feature/formula/ast_node/index.ts")),y=r("./src/core/feature/formula/func-config.ts");function _(e,t,r,n,o){var a=Object(u.f)(t);return new g.c(t,n,a.row,a.col,r,o)}function b(e,t,r,n){return new g.d(t,r,n)}function A(e,t,r){var n=new g.f(t,r);return y.c[t]&&h.addAsyncFunctionNodeList(n),n}function E(e,t,r,n){return new g.g(t,r,n)}function j(e,t){var r=t.start,n=t.end,o=t.startSheetId,a=t.endSheetId,s=t.originValue,i=t.cellRangeType,l=t.crossTableType,c=[o];a!==o&&(c=e.getSheetIdsAmongTwoSheets(o,a));var d=Object(u.e)(r,n,i);return new g.e(o,a,r,n,d,c,i,l,s)}var R=Object.values(u.l),S=function(){function e(t){var r=this;Object(s.a)(this,e),this.value="",this.tokenStack=[],this.start=0,this.formula="",this.strateyies=[{match:function(e,t){return w(t)},action:function(e){r.value+=e}},{match:function(e,t){return C(t)||T(e)},action:function(e){if(r.value.length>0)r.value+=e;else{var t=F(r.formula,r.start);if(t.isError)throw new Error("number parse error\uff0c ".concat(r.formula.slice(r.start)));r.start=t.end-1;var n=r.formula[r.start+1];if(I(n)||void 0===n){var o=new p(t.result,f.NUMBER);r.tokenStack.push(o)}else r.value+=t.result}}},{match:function(e,t){return 34===t},action:function(e){if(r.value.length>0)throw new Error("\u65e0\u6cd5\u88ab\u8bc6\u522b\u7684token:".concat(r.value).concat(e));var t=P(r.formula,r.start,'"','"');if(t.isError)throw new Error("\u65e0\u6cd5\u88ab\u8bc6\u522b\u7684token:".concat(r.formula.slice(r.start,t.end)));r.start=t.end;var n=new p(t.result,f.STRING);r.tokenStack.push(n)}},{match:function(e,t){return I(e)},action:function(e){if(r.value.length>0){var t=x(r.value);if(t.isError)throw new Error("\u65e0\u6cd5\u88ab\u8bc6\u522b\u7684token:".concat(r.value));var n=new p(r.value,t.tokenType);r.tokenStack.push(n)}if(" "===e){r.start=N(r.start+1,r.formula);var o=r.formula[r.start+1];I(o)&&(e=o,r.start+=1)}var a=new p(e,f.SEPARATOR);r.tokenStack.push(a),r.value="",r.start=N(r.start+1,r.formula)}},{match:function(e,t){return 123===t},action:function(e){if(r.value.length>0)throw new Error("\u65e0\u6cd5\u88ab\u8bc6\u522b\u7684token:".concat(r.value).concat(e));var t=P(r.formula,r.start,"{","}");if(t.isError)throw new Error("\u65e0\u6cd5\u88ab\u8bc6\u522b\u7684token:".concat(r.formula.slice(r.start,t.end)));r.start=t.end;var n=new p(t.result,f.USERARRAY);r.tokenStack.push(n)}},{match:function(e,t){return 39===t},action:function(e){var t=P(r.formula,r.start,"'","'"),n=r.formula[t.end+1].charCodeAt(0);if(t.isError)throw new Error("\u65e0\u6cd5\u88ab\u8bc6\u522b\u7684token:".concat(r.formula.slice(r.start,t.end)));if(!O(n))throw new Error("\u65e0\u6cd5\u88ab\u8bc6\u522b\u7684token:".concat(r.formula.slice(r.start,t.end+1)));r.start=t.end+1;var o=new p("'".concat(t.result,"'"),f.SHEET);r.tokenStack.push(o)}},{match:function(e,t){return O(t)},action:function(e){if(""===r.value)throw new Error("\u8bed\u6cd5\u6709\u8bef\uff1a".concat(r.formula));var t=new p(r.value,f.SHEET);r.tokenStack.push(t),r.value=""}},{match:function(e,t){return 35===t},action:function(e){if(r.value.length>0)throw new Error("\u65e0\u6cd5\u88ab\u8bc6\u522b\u7684token:".concat(r.value).concat(e));var t=function(e,t){for(var r=R.length,n=!0,o="",a=0;a<r;a++){var s=R[a];if(t+s.length<=e.length){var i=e.slice(t,t+s.length);if(i===s){t+=s.length,o=i,n=!1;break}}}return{result:o,end:t,isError:n}}(r.formula,r.start);if(t.isError)throw new Error("\u65e0\u6cd5\u88ab\u8bc6\u522b\u7684token:".concat(r.formula.slice(r.start)));r.start=t.end-1;var n=new p(t.result,f.ERROR);r.tokenStack.push(n)}},{match:function(e,t){return 13===t||10===t},action:function(e){}},{match:function(e,t){return!0},action:function(e){r.value+=e}}],this.formula=t}return Object(i.a)(e,[{key:"traverseFormula",value:function(){for(var e=this.formula.length;this.start<e;this.start++)for(var t=this.formula[this.start],r=t.charCodeAt(0),n=0;n<this.strateyies.length;n++){var o=this.strateyies[n];if(o.match(t,r)){o.action(t);break}}if(this.value.length>0){var a=x(this.value);if(a.isError)throw new Error("\u65e0\u6cd5\u88ab\u8bc6\u522b\u7684token:".concat(this.value));var s=new p(this.value,a.tokenType);this.tokenStack.push(s)}}},{key:"getTokenStack",value:function(){return this.tokenStack}}]),e}();function C(e){return e>=48&&e<=57}function T(e){return"."===e}function w(e){return e>=97&&e<=122||e>=65&&e<=90}function O(e){return 33===e}function I(e){return{"&":!0,"=":!0,"<":!0,">":!0,"+":!0,"-":!0,"*":!0,"/":!0,"%":!0,"^":!0,":":!0,"(":!0,")":!0,",":!0," ":!0}[e]}function N(e,t){for(var r=e;" "===t[r];)r+=1;return r-1}function k(e,t,r,n,o){for(var a=e.length,s=0;r<a;r++){if(!t(e[r].charCodeAt(0)))break;s+=1}return{accept:s>=n&&s<=o,end:r}}var M=function(e,t){var r=k(e,w,t+1,0,2),n=1;return r.accept||(n=6),{state:n,idx:r.end-1}},D=function(e,t){var r=k(e,C,t+1,0,5),n=7;r.end-t>=7&&(Number(e.slice(t,r.end))>1048576&&(n=6));return{state:n,idx:r.end-1}},x=function(){var e={1:f.COL,6:f.VARIABLE,7:f.CELL,8:f.ROW},t=[[M,2,,6],[,5,D,6],[M,,function(e,t){return{state:8,idx:k(e,C,t+1,0,5).end-1}}],[],[],[,,function(e,t){return{state:7,idx:k(e,C,t+1,0,5).end-1}}],[6,,6,6],[6,,,6],[]];return function(r){for(var o=0,a=0,s=!1,i=r.length;a<i;a++){var l=r[a],c=void 0;c=w(l.charCodeAt(0))?0:Object(u.E)(l)?2:"$"===l?1:3;var d=t[o][c],h=Object(n.a)(d);if("number"===h)o=d;else{if("function"!==h){s=!0;break}var m=d(r,a);if(void 0===m){s=!0;break}o=m.state,a=m.idx}}return{tokenType:e[o]||f.UNKNOW,isError:s}}}(),F=function(){var e=[[1,2],[1,2,4],[3,,4],[3,,4],[6,,,5],[6],[6]],t={1:!0,3:!0,6:!0},r=0;return function(n,o){r=0;for(var a="",s=n.length,i=o;i<s;i++){var u=n[i],l=-1;l=C(u.charCodeAt(0))?0:T(u)?1:"E"===u||"e"===u?2:"+"===u||"-"===u?3:4;var c=e[r][l];if(void 0===c)break;a+=u,r=c}var d=i;return i-=1,{result:a,end:d,isError:!t[r]}}}();function P(e,t,r,n){for(var o=e.length,a="",s=!0,i=!1;t<o;t++){var u=e[t];if(i||u!==r){if(i&&u===n){if(e[t+1]===u){t+=1,a+=u;continue}s=!1;break}i&&(a+=u)}else i=!0}return{result:a,end:t,isError:s}}var L=function(){function e(t){Object(s.a)(this,e),this.context=t}return Object(i.a)(e,[{key:"parse",value:function(e,t){this.idx=0,this.stack=[],this.context.element=t,this.tokens=function(e){var t=new S(e);return t.traverseFormula(),t.getTokenStack()}(e),this.expression(!0);var r=this.stack[this.stack.length-1],n=Object(u.N)(t.id),o=_(this.context,n,t.sheetId,n,v.c.NONE);return o.setBody(r),o.setFormula(e),o}},{key:"llkMatchType",value:function(e,t){var r=this.tokens[this.idx+t];return r&&r.type===e}},{key:"llkMatchTypeAndChar",value:function(e,t,r){var n=this.tokens[this.idx+r];return n&&n.value===t&&n.type===e}},{key:"matchType",value:function(e){return this.llkMatchType(e,0)}},{key:"matchTypeAndChar",value:function(e,t){return this.llkMatchTypeAndChar(e,t,0)}},{key:"advance",value:function(){this.idx+=1}},{key:"back",value:function(){this.idx-=1}},{key:"currentTokenValue",value:function(){return this.tokens[this.idx].value}},{key:"isGTorLTorNotEqual",value:function(e,t){return">"===e&&"="===t||"<"===e&&("="===t||">"===t)}},{key:"expression",value:function(e){this.expression1(),this.expression0(e)}},{key:"expression1",value:function(){this.expression2(),this.expression21()}},{key:"expression0",value:function(e){if(this.matchPriorityOperation0()){var t=this.currentTokenValue();if(this.advance(),this.idx>=this.tokens.length)throw new Error("expected expression\uff0cbut got empty");var r=this.currentTokenValue();if(this.isGTorLTorNotEqual(t,r)&&(this.advance(),t+=r),this.expression1(),this.stack.length<2)throw new Error("expected expression\uff0cbut got empty");var n=E(this.context,t,v.e.BINARY),o=this.stack[this.stack.length-2],a=this.stack[this.stack.length-1],s=A(this.context,"LOGICMATCH",[o,a,n]);this.stack.pop(),this.stack.pop(),this.stack.push(s),this.expression0()}else if(e&&this.idx!==this.tokens.length)throw new Error("expected operation, but got ".concat(this.currentTokenValue()))}},{key:"expression21",value:function(){if(this.matchTypeAndChar(f.SEPARATOR,"&")){var e=this.currentTokenValue();if(this.advance(),this.expression2(),this.stack.length<2)throw new Error("expected expression\uff0cbut got empty");var t=E(this.context,e,v.e.BINARY),r=this.stack[this.stack.length-2],n=this.stack[this.stack.length-1],o=A(this.context,"SPECIALMATCH",[r,n,t]);this.stack.pop(),this.stack.pop(),this.stack.push(o),this.expression21()}}},{key:"expression2",value:function(){this.expression3(),this.expression31()}},{key:"expression31",value:function(){if(this.matchTypeAndChar(f.SEPARATOR,"+")||this.matchTypeAndChar(f.SEPARATOR,"-")){var e=this.currentTokenValue();if(this.advance(),this.expression3(),this.stack.length<2)throw new Error("expected expression\uff0cbut got empty");var t=E(this.context,e,v.e.BINARY),r=this.stack[this.stack.length-2],n=this.stack[this.stack.length-1],o=A(this.context,"MATHMATCH",[r,n,t]);this.stack.pop(),this.stack.pop(),this.stack.push(o),this.expression31()}}},{key:"expression3",value:function(){this.expression4(),this.expression41()}},{key:"expression41",value:function(){if(this.matchTypeAndChar(f.SEPARATOR,"*")||this.matchTypeAndChar(f.SEPARATOR,"/")){var e=this.currentTokenValue();if(this.advance(),this.expression4(),this.stack.length<2)throw new Error("expected expression\uff0cbut got empty");var t=E(this.context,e,v.e.BINARY),r=this.stack[this.stack.length-2],n=this.stack[this.stack.length-1],o=A(this.context,"MATHMATCH",[r,n,t]);this.stack.pop(),this.stack.pop(),this.stack.push(o),this.expression41()}}},{key:"expression4",value:function(){if(this.matchTypeAndChar(f.SEPARATOR,"-")||this.matchTypeAndChar(f.SEPARATOR,"+")){var e=this.currentTokenValue();this.advance(),this.expression4();var t=this.stack[this.stack.length-1],r="-"===e?v.e.MINUS:v.e.NUM,n=E(this.context,t,r,(function(t,r){t.push(e),this.originValueNode.toString(t,r)}));this.stack.pop(),this.stack.push(n)}else this.expression5(),this.expression51()}},{key:"expression51",value:function(){if(this.matchTypeAndChar(f.SEPARATOR,"%")){this.advance();var e=this.stack[this.stack.length-1],t=E(this.context,e,v.e.PERCENTAGE,(function(e,t){this.originValueNode.toString(e,t),e.push("%")}));this.stack.pop(),this.stack.push(t),this.expression51()}else if(this.matchTypeAndChar(f.SEPARATOR,"^")){var r=this.currentTokenValue();if(this.advance(),this.expression5(),this.stack.length<2)throw new Error("expected expression\uff0cbut got empty");var n=E(this.context,r,v.e.BINARY),o=this.stack[this.stack.length-2],a=this.stack[this.stack.length-1],s=A(this.context,"MATHMATCH",[o,a,n]);this.stack.pop(),this.stack.pop(),this.stack.push(s),this.expression51()}}},{key:"expression5",value:function(){this.expression6(),this.expression61()}},{key:"expression61",value:function(){}},{key:"expression6",value:function(){if(this.matchTypeAndChar(f.SEPARATOR,"("))this.advance(),this.expression7();else if(this.lfFunction())this.function();else if(this.lfReference())this.reference(),this.matchTypeAndChar(f.SEPARATOR," ")&&this.cellRangeIntersectionSeq();else if(this.matchType(f.STRING)){var e=E(this.context,'"'.concat(this.currentTokenValue(),'"'),v.e.STR);this.stack.push(e),this.advance()}else if(this.matchType(f.NUMBER)){var t=E(this.context,this.currentTokenValue(),v.e.NUM);this.stack.push(t),this.advance()}else if(this.lfVariable())this.variable();else if(this.matchType(f.ERROR)){var r=E(this.context,this.currentTokenValue(),v.e.ERROR);this.stack.push(r),this.advance()}}},{key:"cellRangeIntersectionSeq",value:function(){this.cellRangeIntersectionSeq1()}},{key:"cellRangeIntersectionSeq1",value:function(){this.matchTypeAndChar(f.SEPARATOR," ")&&(this.stack.push(this.currentTokenValue()),this.advance(),this.reference(),this.newCellRangeIntersection(),this.cellRangeIntersectionSeq1())}},{key:"newCellRangeIntersection",value:function(){var e=v.d.INTERSECTION,t=this.stack[this.stack.length-3],r=this.stack[this.stack.length-1],n=b(this.context,t,r,e);return this.stack.pop(),this.stack.pop(),this.stack.pop(),this.stack.push(n),n}},{key:"function",value:function(){if(this.stack.push(this.currentTokenValue()),this.advance(),!this.matchTypeAndChar(f.SEPARATOR,"("))throw new Error("expected (\uff0cbut got".concat(this.currentTokenValue()));if(this.stack.push(this.currentTokenValue()),this.advance(),this.matchTypeAndChar(f.SEPARATOR,")"))this.stack.push([]),this.stack.push(this.currentTokenValue()),this.advance(),this.newFunctionNode();else{if(this.expseq(),!this.matchTypeAndChar(f.SEPARATOR,")"))throw new Error("expected )\uff0cbut got".concat(this.currentTokenValue()));this.stack.push(this.currentTokenValue()),this.advance(),this.newFunctionNode()}}},{key:"newFunctionNode",value:function(){var e=this.stack[this.stack.length-4],t=this.stack[this.stack.length-2],r=A(this.context,e,t);this.stack.pop(),this.stack.pop(),this.stack.pop(),this.stack.pop(),this.stack.push(r)}},{key:"variable",value:function(){if(!this.matchType(f.VARIABLE)&&!this.matchType(f.COL))throw new Error("expected VARIABLE or COL\uff0cbut got".concat(this.currentTokenValue()));var e=this.currentTokenValue(),t=E(this.context,e,v.e.VARIABLE);this.stack.push(t),this.advance()}},{key:"isCellOrRangeWithComma",value:function(){return this.lfCell()&&this.llkMatchTypeAndChar(f.SEPARATOR,",",1)||this.lfCellRange()&&this.llkMatchTypeAndChar(f.SEPARATOR,",",3)}},{key:"expression7",value:function(){if(this.isCellOrRangeWithComma()?this.cellRangeConcatSeq():this.expression(),!this.matchTypeAndChar(f.SEPARATOR,")"))throw new Error("expected )\uff0cbut got".concat(this.currentTokenValue()));this.advance();var e=this.stack[this.stack.length-1],t=E(this.context,e,v.e.ORIGIN,(function(e,t){e.push("("),this.originValueNode.toString(e,t),e.push(")")}));this.stack.pop(),this.stack.push(t)}},{key:"cellRangeConcatSeq",value:function(){this.reference(),this.cellRangeConcatSeq1()}},{key:"cellRangeConcatSeq1",value:function(){this.matchTypeAndChar(f.SEPARATOR,",")&&(this.stack.push(this.currentTokenValue()),this.advance(),this.reference(),this.newCellRangeConcatSeq(),this.cellRangeConcatSeq1())}},{key:"newCellRangeConcatSeq",value:function(){var e=v.d.CONCAT,t=this.stack[this.stack.length-3],r=this.stack[this.stack.length-1],n=b(this.context,t,r,e);return this.stack.pop(),this.stack.pop(),this.stack.pop(),this.stack.push(n),n}},{key:"reference",value:function(){this.lfWildcardSheetNameReference()?this.wildcardReference():this.lfCell()?this.cell():this.cellRange()}},{key:"wildcardReference",value:function(){var e=this.currentTokenValue(),t=function(e,t){function r(e,t){var r=null;if(e[0]===t)r=[{startSheetName:e[1],endSheetName:e[e.length-1]}];else if(e[e.length-1]===t)r=[{startSheetName:e[0],endSheetName:e[e.length-2]}];else{var n=e.indexOf(t);r=[{startSheetName:e[0],endSheetName:e[n-1]},{startSheetName:e[n+1],endSheetName:e[e.length-1]}]}return r}var n=e.getSheetNames();if(1===n.length)throw new Error("sheet is not enough");var o=Object(u.h)(t),a=e.getSheetNameBySheetId(e.element.sheetId),s=null;if("*"===o)s=r(n,a);else{var i=o;i.indexOf("*")>=0&&(i=i.replace(/\*/g,"[\\w\\W]*")),i.indexOf("?")>=0&&(i=i.replace(/\?/g,"[\\w\\W]"));for(var l=new RegExp("^".concat(i,"$"),"i"),c=[],d=0;d<n.length;d++){var f=n[d];l.test(f)&&c.push(f)}-1===c.indexOf(a)&&c.push(a),s=r(c,a)}return s}(this.context,e);if(this.advance(),1===t.length){var r=t[0],n=r.startSheetName,o=r.endSheetName,a=n===o?n:"".concat(n,":").concat(o),s=new p("'".concat(a,"'"),f.SHEET);return this.back(),this.tokens[this.idx]=s,this.reference()}var i=t[0],l=i.startSheetName,c=i.endSheetName,d=l===c?l:"".concat(l,":").concat(c),h=new p("'".concat(d,"'"),f.SHEET),m=t[1],v=m.startSheetName,g=m.endSheetName,y=v===g?v:"".concat(v,":").concat(g),_=new p("'".concat(y,"'"),f.SHEET),b=new p(",",f.SEPARATOR);if(this.lfLocalCell()){var A=this.tokens[this.idx];this.back(),this.tokens[this.idx]=h,this.tokens.splice(this.idx+2,0,b,_,A)}else if(this.lfLocalCellRange()){var E=this.tokens[this.idx],j=this.tokens[this.idx+1],R=this.tokens[this.idx+2];this.back(),this.tokens[this.idx]=h,this.tokens.splice(this.idx+4,0,b,_,E,j,R)}return this.reference()}},{key:"cell",value:function(){this.lfLocalCell()?this.localCell():this.lfSheetCell()&&this.sheetCell()}},{key:"localCell",value:function(){var e=this.currentTokenValue(),t=v.c.NONE,r=_(this.context,e,this.context.element.sheetId,e,t);this.stack.push(r),this.advance()}},{key:"sheetCell",value:function(){var e=this.currentTokenValue(),t=this.context.getSheetIdBySheetName(e);this.advance();var r=this.currentTokenValue();this.advance();var n="".concat(e,"!").concat(r),o=v.c.NORMAL,a=_(this.context,r,t,n,o);this.stack.push(a)}},{key:"cellRange",value:function(){if(this.lfLocalCellRange())this.localCellRange();else if(this.lfSheetCellRange()){var e=this.currentTokenValue();if(e.indexOf(":")>=0){this.advance();var t=e.slice(1,e.length-1).split(":"),r=Object(m.a)(t,2),n=r[0],o=r[1],a=this.context.getSheetIdBySheetName(n),s=this.context.getSheetIdBySheetName(o);e+="!",this.isSheetSingleCell()?this.newThreeDimensionCellNode(e,a,s):this.threeDimensionCellRange({sheetName:e,startSheetId:a,endSheetId:s})}else this.sheetCellRange()}else if(this.lfThreeDimensionCellRange()){var i=this.currentTokenValue(),l=this.context.getSheetIdBySheetName(i,u.l.name);this.advance(),this.advance();var c=this.currentTokenValue(),d=this.context.getSheetIdBySheetName(c,u.l.name);this.advance();var f="".concat(i,":").concat(c,"!");this.threeDimensionCellRange({sheetName:f,startSheetId:l,endSheetId:d})}}},{key:"localCellRange",value:function(){if(this.isSheetCellRangeNormal()){var e=v.b.NORMAL,t=v.c.NONE;this.newCellRangeNode(e,t,j)}else if(this.isSheetColRange()){var r=v.b.COL,n=v.c.NONE;this.newCellRangeNode(r,n,j)}else if(this.isSheetRowRange()){var o=v.b.ROW,a=v.c.NONE;this.newCellRangeNode(o,a,j)}else{if(!this.matchType(f.USERARRAY))throw new Error("expected cellRange\uff0cbut got".concat(this.currentTokenValue()));var s=this.currentTokenValue(),i=v.b.USER_RANGE,u=v.c.NONE,l="{".concat(s,"}"),c=this.context.element.sheetId,d=j(this.context,{start:l,end:l,startSheetId:c,endSheetId:c,originValue:l,cellRangeType:i,crossTableType:u});this.stack.push(d),this.advance()}}},{key:"sheetCellRange",value:function(){var e=this.currentTokenValue(),t=this.context.getSheetIdBySheetName(e);if(this.advance(),this.isSheetCellRangeNormal()){var r=v.b.NORMAL,n=v.c.NORMAL;this.newCellRangeNode(r,n,j,{startSheetId:t,endSheetId:t,sheetName:"".concat(e,"!")})}else if(this.isSheetCellRangeNormalWithSheetName()){var o=v.b.NORMAL,a=v.c.NORMAL,s=this.currentTokenValue();this.advance();var i=this.currentTokenValue();this.advance(),this.advance();var u=this.currentTokenValue();this.advance();var l=e+s+i+e+u,c=j(this.context,{start:s,end:u,startSheetId:t,endSheetId:t,originValue:l,cellRangeType:o,crossTableType:a});this.stack.push(c)}else if(this.isSheetColRange()){var d=v.b.COL,f=v.c.NORMAL;this.newCellRangeNode(d,f,j,{startSheetId:t,endSheetId:t,sheetName:"".concat(e,"!")})}else{if(!this.isSheetRowRange())throw new Error("expected cross table cellRange\uff0cbut got".concat(this.currentTokenValue()));var h=v.b.ROW,m=v.c.NORMAL;this.newCellRangeNode(h,m,j,{startSheetId:t,endSheetId:t,sheetName:"".concat(e,"!")})}}},{key:"isSheetSingleCell",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.llkMatchType(f.CELL,e)&&!this.llkMatchTypeAndChar(f.SEPARATOR,":",e+1)}},{key:"isSheetCellRangeNormal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.llkMatchType(f.CELL,e)&&this.llkMatchTypeAndChar(f.SEPARATOR,":",e+1)&&this.llkMatchType(f.CELL,e+2)}},{key:"isSheetCellRangeNormalWithSheetName",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.llkMatchType(f.CELL,e)&&this.llkMatchTypeAndChar(f.SEPARATOR,":",e+1)&&this.llkMatchType(f.SHEET,e+2)&&this.llkMatchType(f.CELL,e+3)}},{key:"isSheetColRange",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.llkMatchType(f.COL,e)&&this.llkMatchTypeAndChar(f.SEPARATOR,":",e+1)&&this.llkMatchType(f.COL,e+2)}},{key:"isSheetRowRange",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(this.llkMatchType(f.ROW,e)||this.llkMatchType(f.NUMBER,e))&&this.llkMatchTypeAndChar(f.SEPARATOR,":",e+1)&&(this.llkMatchType(f.ROW,e+2)||this.llkMatchType(f.NUMBER,e+2))}},{key:"newCellRangeNode",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{startSheetId:this.context.element.sheetId,endSheetId:this.context.element.sheetId,sheetName:""},o=n.startSheetId,a=n.endSheetId,s=n.sheetName;this.stack.push(this.currentTokenValue()),this.advance(),this.stack.push(this.currentTokenValue()),this.advance(),this.stack.push(this.currentTokenValue()),this.advance();var i=this.stack[this.stack.length-3],u=this.stack[this.stack.length-2],l=this.stack[this.stack.length-1],c=s+i+u+l;this.stack.pop(),this.stack.pop(),this.stack.pop();var d=r(this.context,{start:i,end:l,startSheetId:o,endSheetId:a,originValue:c,cellRangeType:e,crossTableType:t});this.stack.push(d)}},{key:"newThreeDimensionCellNode",value:function(e,t,r){var n=v.b.NORMAL,o=v.c.THREE_DIMENSION,a=this.currentTokenValue();this.advance();var s=e+a,i=j(this.context,{start:a,end:a,startSheetId:t,endSheetId:r,originValue:s,cellRangeType:n,crossTableType:o});this.stack.push(i)}},{key:"threeDimensionCellRange",value:function(e){var t=e.startSheetId,r=e.endSheetId,n=e.sheetName;if(this.isSheetSingleCell())this.newThreeDimensionCellNode(n,t,r);else if(this.isSheetCellRangeNormal()){var o=v.b.NORMAL,a=v.c.THREE_DIMENSION;this.newCellRangeNode(o,a,j,{startSheetId:t,endSheetId:r,sheetName:n})}else if(this.isSheetColRange()){var s=v.b.COL,i=v.c.THREE_DIMENSION;this.newCellRangeNode(s,i,j,{startSheetId:t,endSheetId:r,sheetName:n})}else{if(!this.isSheetRowRange())throw new Error("expected cross table cellRange\uff0cbut got".concat(this.currentTokenValue()));var u=v.b.ROW,l=v.c.THREE_DIMENSION;this.newCellRangeNode(u,l,j,{startSheetId:t,endSheetId:r,sheetName:n})}}},{key:"expseq",value:function(){var e=this.stack;if(this.stack=[],this.expression(),this.expseq1(),this.llkMatchTypeAndChar(f.SEPARATOR,",",-1)){var t=E(this.context,"",v.e.PLACEHOLDER);this.stack.push(t)}e.push(this.stack),this.stack=e}},{key:"expseq1",value:function(){if(this.matchTypeAndChar(f.SEPARATOR,",")){if(this.llkMatchTypeAndChar(f.SEPARATOR,"(",-1)||this.llkMatchTypeAndChar(f.SEPARATOR,",",-1)){var e=E(this.context,"",v.e.PLACEHOLDER);this.stack.push(e)}this.advance(),this.expression(),this.expseq1()}}},{key:"lfWildcardSheetNameReference",value:function(){var e=this.currentTokenValue();return this.matchType(f.SHEET)&&(-1!==e.indexOf("*")||-1!==e.indexOf("?"))}},{key:"lfCell",value:function(){return this.lfLocalCell()||this.lfSheetCell()}},{key:"lfLocalCell",value:function(){return this.matchType(f.CELL)&&!this.llkMatchTypeAndChar(f.SEPARATOR,":",1)}},{key:"lfSheetCell",value:function(){var e=this.currentTokenValue();return this.matchType(f.SHEET)&&-1===e.indexOf(":")&&this.llkMatchType(f.CELL,1)&&!this.llkMatchTypeAndChar(f.SEPARATOR,":",2)}},{key:"lfCellRange",value:function(){return this.lfLocalCellRange()||this.lfSheetCellRange()||this.lfThreeDimensionCellRange()}},{key:"lfLocalCellRange",value:function(){return this.isSheetCellRangeNormal()||this.isSheetColRange()||this.isSheetRowRange()||this.matchType(f.USERARRAY)}},{key:"lfSheetCellRange",value:function(){if(this.matchType(f.SHEET)){var e=this.currentTokenValue();return this.llkMatchType(f.CELL,1)&&!this.llkMatchTypeAndChar(f.SEPARATOR,":",2)&&e.indexOf(":")>=0||this.isSheetCellRangeNormalWithSheetName(1)||this.isSheetCellRangeNormal(1)||this.isSheetColRange(1)||this.isSheetRowRange(1)}return!1}},{key:"lfThreeDimensionCellRange",value:function(){return!(!this.llkMatchTypeAndChar(f.SEPARATOR,":",1)||!this.llkMatchType(f.SHEET,2))&&(this.isSheetSingleCell(3)||this.isSheetCellRangeNormal(3)||this.isSheetColRange(3)||this.isSheetRowRange(3))}},{key:"lfFunction",value:function(){return(this.matchType(f.VARIABLE)||this.matchType(f.COL)||this.matchType(f.CELL))&&this.llkMatchTypeAndChar(f.SEPARATOR,"(",1)}},{key:"lfVariable",value:function(){return this.matchType(f.VARIABLE)||this.matchType(f.COL)&&!this.llkMatchTypeAndChar(f.SEPARATOR,":",1)}},{key:"lfReference",value:function(){return this.lfCell()||this.lfCellRange()}},{key:"matchPriorityOperation0",value:function(){var e=this.tokens[this.idx];return e&&("="===e.value||"<"===e.value||">"===e.value)}}]),e}(),U=r("./src/core/feature/formula/autofix.ts"),B=(window.location.href.indexOf("showFormulaLog=1"),Object(u.P)(c.b.monitor,300)),H=function(){function e(t){var r=this;Object(s.a)(this,e),this.parse=function(e,t){var n,o=void 0;try{var a=e;a=Object(U.b)(a),a=Object(U.c)(a),n=r.parser.parse(a,t);var s=h.getAsyncFunctionNodeList();s.length>0&&(n.setAsyncFunctionNodeList(s),h.cleanAsyncFunctionNodeList()),h.setCell(t.sheetId,t.row,t.col,n)}catch(i){o=Object(u.p)(i.message),l.b(e),null===B||void 0===B||B(3429247),n={error:o,errorProp:i.prop,value:n}}return n},this.processInjectFunctions(t),this.parser=new L(t)}return Object(i.a)(e,[{key:"processInjectFunctions",value:function(e){var t=e.getSheetIdBySheetName;e.getSheetIdBySheetName=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.l.ref,n=Object(u.h)(e),o=t(n);if(!o)throw new Error(r);return o}}}]),e}(),G=(r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.string.ends-with.js"),r("../node_modules/core-js/modules/es.string.starts-with.js"),r("../node_modules/core-js/modules/es.string.trim.js"),r("../packages/model/src/utils/numberFormat/FormatParseEngine.ts")),V=r("./src/core/feature/formula/ast_node/utils.ts"),W=r("./src/core/feature/formula/lib/calcContext.ts"),Y={LEFT:!0,RIGHT:!0,MID:!0,SUMPRODUCT:!0,FIND:!0,SUBSTITUTE:!0,CONCATENATE:!0,CONCAT:!0,OFFSET:!0,FIXED:!0,REPT:!0,SMALL:!0,LARGE:!0,EOMONTH:!0,EDATE:!0,WEEKNUM:!0,DOLLAR:!0,"FLOOR.MATH":!0,"CEILING.MATH":!0,"FLOOR.PRECISE":!0,"CEILING.PRECISE":!0,BIN2OCT:!0,BIN2HEX:!0,OCT2BIN:!0,OCT2HEX:!0,HEX2BIN:!0,HEX2OCT:!0,DEC2BIN:!0,DEC2OCT:!0,DEC2HEX:!0,COMPLEX:!0,MODE:!0,"MODE.SNGL":!0,PERCENTRANK:!0,"PERCENTRANK.INC":!0,"PERCENTRANK.EXC":!0,ERF:!0,"WORKDAY.INTL":!0,RANDBETWEEN:!0},z=window.location.href.indexOf("showFormulaLog=1")>=0;z&&(window.debugFormula=!0);var K,q=function(){return window.debugFormula},Q=function(e){var t=e.astNode;e.args,e.result;if(q()&&Object(V.j)(t)){var r=[];t.toString(r,{}),r.join("")}},X={number:function(e){var t;if(Object(V.a)(e)){var r=e.toArray();t=Object(m.a)(r,1)[0]}else t=e;return K.custom.isNumeric(t)?"number"===typeof t?t:"string"===typeof e?Object(G.parseValueWithStyle)(e).value:t:t},string:function(e){var t=e.slice(1,e.length-1),r=t.length-1,n=t;if(t.startsWith("(")&&t.endsWith(")")){var o=F(t,1);o.isError||o.end!==r||(n=X.numberInverted(o.result))}return n},numberInverted:function(e){var t,r=e;if(Object(V.a)(r))if(r.isCell){var n=r.toArray();r=Object(m.a)(n,1)[0]}else r=r.toArray();if(Array.isArray(r))t=r.map((function(e){return-1*Object(G.parseValueWithStyle)(e).value}));else{if(t=X.number(r),isNaN(t))return u.l.value;t*=-1}return t},percentNumber:function(e){var t=X.number(e);return isNaN(t)?u.l.value:t*=.01},getRangeValue:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0,n=r.sheetId,o=r.row,a=r.col,s=r.rowCount,i=r.colCount;if(1===s&&1===i){var u=X.getCellValueByData(o,a,n);(e=[u]).rangeCount=1,e.row=o,e.col=a,e.rowCount=s,e.colCount=i}else(e=X.calcRangeValue(t,n,o,a,s,i)).rangeCount=1,e.row=o,e.col=a,e.rowCount=s,e.colCount=i;return e},getSheetIdBySheetName:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.l.ref,r=Object(u.h)(e),n=K.custom.getSheetIdBySheetName(r);if(!n)throw new Error(t);return n},calcRangeValue:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,i=t.newLine,l=0,c=[];c.error=[];for(var d=n+a,f=o+s,h=n;h<d;h++)for(var m=o;m<f;m++)if(e=X.getCellValueByData(h,m,r),Object(u.v)(e)&&c.error.push(e),"undefined"!==typeof i){var p=Math.floor(l/i);void 0===c[p]&&(c[p]=[]);var v=c[p];v.push(e),l+=1}else c.push(e);return c},specialMatch:function(e,t,r,n,o){return X.callFunction("specialMatch",[e,t,r],n,o)},logicMatch:function(e,t,r,n,o){return X.callFunction("logicMatch",[e,t,r],n,o)},mathMatch:function(e,t,r,n,o){return X.callFunction("mathMatch",[e,t,r],n,o)},callFunction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,o=e.toUpperCase(),a=K,s=a.element,i=K.formulas[o];if(i){W.a.setAstNodes(r),W.a.setFuncNode(n),s&&W.a.setElement(s),W.a.setInstance(K);var l=Object(u.m)(i(t),15);return l}throw console.error("".concat(o,"\u51fd\u6570\u4e0d\u5b58\u5728\u6216\u8fd8\u65e0\u6cd5\u4f7f\u7528")),new Error(u.l.name)},callVariable:function(e){if(e){var t=e.toUpperCase();return"TRUE"===t||"FALSE"!==t&&u.l.name}return u.l.name},cellValue:function(e,t,r){var n={sheetId:t,row:r.row,col:r.col,rowCount:1,colCount:1,refType:v.b.CELL};return new g.b([n],!0,X.cellValueCalcFunc)},cellValueCalcFunc:function(){var e,t=Object(m.a)(this.identities,1)[0],r=X.getCellValueByData(t.row,t.col,t.sheetId);Object(u.v)(r)&&(e=[r]);var n=[r];return n.error=e,n.rowCount=t.rowCount,n.colCount=t.colCount,n.rangeCount=1,n},getCellValueByData:function(e,t,r){var o=W.a.getFuncNode(),a=(null===o||void 0===o?void 0:o.funcName)||"",s=!y.h[a],i=K.custom.cellValue(e,t,r);if("object"===Object(n.a)(i)&&i&&i.displayText)i=i.displayText;else if(""===i){""===K.custom.cellEditValue(e,t,r)&&(i=null)}else s&&(i=Object(u.M)(i));return i},cellRangeIntersection:function(e,t){if(!Object(V.a)(e)||!Object(V.a)(t))return u.l.null;var r=Object(m.a)(e.identities,1)[0],n=Object(m.a)(t.identities,1)[0],o=r,a=n;r.row>n.row&&(a=r,o=n);var s=r,i=n;if(r.col>n.col&&(i=r,s=n),a.row>=o.row+o.rowCount||i.col>=s.col+s.colCount)return u.l.null;var l=i.col,c=a.row,d=r;r.row+r.rowCount>n.row+n.rowCount&&(d=n);var f=r;r.col+r.colCount>n.col+n.colCount&&(f=n);var h=d.row+d.rowCount-a.row,p=f.col+f.colCount-i.col,y=1===h&&1===p,_=y?X.cellValueCalcFunc:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return X.getRangeValue(e,this.identities[0])},b=[{sheetId:r.sheetId,row:c,col:l,rowCount:h,colCount:p,refType:v.b.NORMAL}];return new g.b(b,y,_)},cellRangeConcat:function(e,t){var r=[];return Array.prototype.push.apply(r,e.identities),Array.prototype.push.apply(r,t.identities),new g.b(r,!1,X.cellRangeCalcFunc)},getUserRangeTextAndValue:function(e){var t=e.split(";"),r=[];return t.forEach((function(e){for(var t=e.split(","),n=0;n<t.length;n++){var o=t[n].trim(),a=Number(o);if(isNaN(a))if(o.startsWith('"')&&o.endsWith('"'))t[n]=o.slice(1,-1);else{if("TRUE"!==o&&"FALSE"!==o&&"true"!==o&&"false"!==o)throw new Error(u.l.value);t[n]="TRUE"===o.toUpperCase()}else t[n]=a}r.push(t)})),[r]},getCalcRef:function(e,t,r){var n=r||X.cellRangeCalcFunc;return new g.b(e,t,n)},cellRangeCalcFunc:function(){var e,t,r,n=K.cellMap.getCacheStatus(),o=this.identities,a=0,s=0,i=0,l=0,c=0,d=0,f=[],h=!1,m=n?K.cellMap.rangeCache:{},p=W.a.getFuncNode(),v=(null===p||void 0===p?void 0:p.funcName)||"";f.error=[];for(var g=o.length,_=0;_<g;_++){var b=o[_];a=b.rowCount,s=b.colCount,e=b.sheetId,c=(i=b.row)+a,d=(l=b.col)+s;var A=void 0;if((h=a*s>1500)&&(A=m[r="".concat(i,"_").concat(l,"_").concat(a,"_").concat(s,"_").concat(e)]),A)Array.prototype.push.apply(f,A);else{for(var E=!y.h[v],j=i;j<c;j++)for(var R=l;R<d;R++){var S=K.custom.cellValue(j,R,e);if(null===S||void 0===S?void 0:S.displayText)t=S.displayText;else if(""===S){t=""===K.custom.cellEditValue(j,R,e)?null:S}else t=E?Object(u.M)(S):S;Object(u.v)(t)&&f.error.push(t),f.push(t)}h&&(m[r]=f)}}return f.rowCount=a,f.colCount=s,f.rangeCount=g,f.row=i,f.col=l,f},callCellRangeValue:function(e){var t,r,n=e.scope,o=n.row,a=n.col,s=n.rowCount,i=n.colCount,u=e.sheetIds,l=[];u.length>1&&(u=K.custom.getSheetIdsAmongTwoSheets(u[0],u[u.length-1]),e.updateSheetIds(u));var c=o,d=a;return u.forEach((function(n){t=K.custom.countRows(n),r=K.custom.countCols(n),l.push({row:c,col:d,rowCount:"undefined"===typeof s?t-c:Math.min(s,t-c),colCount:"undefined"===typeof i?r-d:Math.min(i,r-d),sheetId:n,refType:e.cellRangeType})})),new g.b(l,!1,X.cellRangeCalcFunc)},calculateFunctionNode:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.value,n=y.c[e.funcName];if(!t&&!n||t&&n){for(var o=e.args.length,a=[],s=0;s<o;s++){var i=e.args[s];i.setCalculateParentFunctionNode(e);var l=X.calculateAstNode(i);Object(V.m)(i)&&i.variableType===v.e.PLACEHOLDER&&(l=Y[e.funcName]?"":0),a.push(l)}try{r=X.callFunction(e.funcName,a,e.args,e),Q({astNode:e,args:a,result:r})}catch(c){r=Object(u.p)(c.message)}"number"!==typeof r||isFinite(r)||(r=u.l.num)}return r},calculateCellRangeBinaryNode:function(e){e.leftRange.setCalculateParentFunctionNode(e.calculateParentFunctionNode),e.rightRange.setCalculateParentFunctionNode(e.calculateParentFunctionNode);var t,r=X.calculateAstNode(e.leftRange),n=X.calculateAstNode(e.rightRange);return e.binaryType===v.d.INTERSECTION?t=X.cellRangeIntersection(r,n):e.binaryType===v.d.CONCAT&&(t=X.cellRangeConcat(r,n)),t},asyncCalculate:function(e){return Object(o.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return!0,t.next=3,X.calculateFunctionNode(e,!0);case 3:return r=t.sent,e.setValue(r),t.abrupt("return",r);case 6:case"end":return t.stop()}}),t)})))()},calculateVariableNode:function(e){var t,r=e.originValueNode;switch(e.originValueNode instanceof g.a&&(e.originValueNode.setCalculateParentFunctionNode(e.calculateParentFunctionNode),r=X.calculateAstNode(e.originValueNode)),e.variableType){case v.e.NUM:var n=r;t=X.number(n);break;case v.e.PERCENTAGE:var o=r;t=X.percentNumber(o);break;case v.e.MINUS:var a=r;t=X.numberInverted(a);break;case v.e.STR:t=X.string(r);break;case v.e.ORIGIN:t=r;break;case v.e.PLACEHOLDER:t="";break;case v.e.BINARY:case v.e.ERROR:t=r;break;case v.e.VARIABLE:t=X.callVariable(r)}return t},calculateAstNode:function(e){var t=null;if(Object(V.c)(e))t=X.cellValue(e.cellId,e.sheetId,e);else if(Object(V.j)(e))t=X.calculateFunctionNode(e);else if(Object(V.f)(e))if(Object(V.l)(e)){var r=e.start.slice(1,e.start.length-1);t=X.getUserRangeTextAndValue(r)}else t=X.callCellRangeValue(e);else Object(V.e)(e)?t=X.calculateCellRangeBinaryNode(e):Object(V.m)(e)&&(t=X.calculateVariableNode(e));return e.setValue(t),t}};var J={init:function(){(K=this).cellMap=h,K.NODE_TYPE={AST_TYPE:v.a,CROSS_TABLE_TYPE:v.c,CELL_RANGE_TYPE:v.b,VARIABLE_TYPE:v.e,RANGE_BINARY_TYPE:v.d}},custom:{},calculate:function(e,t){K.element=t,q();var r=X.calculateAstNode(e.body);return e.setValue(r),r},helper:X,bindCustomMethod:function(e){this.custom=e}},$=r("../packages/model/src/cell/ErrorValue.ts"),Z=r("./src/core/feature/formula/formula-graph/utils.ts"),ee=r("../node_modules/@tencent/tdocs-format-render/lib/index.js"),te=function(){function e(t){var r=this;Object(s.a)(this,e),this.getInheritFormat=function(e){var t,n,o=e.formula,a=e.ast;e.row,e.col,e.sheetId;if(r.hasTextInheritFunction(o))return{userEnteredNumberFormat:n=ee.NumberFormatFactory.createNumberFormat({pattern:"@"})};if(n)return{userEnteredNumberFormat:n};if(/(today|now|date)\([^)]*\)/i.test(o)&&"="===o.replace(/\s/g,"").replace(/(today|now|date)\([^)]*\)/i,"").replace(/\+|-/g,"").replace(/\d+(\.\d+)?([Ee][+-]?\d+)?/g,"")){var s=o.toLowerCase();return{effectiveFormatNumberFormat:t=ee.NumberFormatFactory.createNumberFormat({pattern:s.indexOf("today")>-1||s.indexOf("date")>-1?"yyyy/m/d":"yyyy/m/d h:mm:ss;@"})}}var i=r.getInheritanceFormatByAST(a);return i&&(t=i),{effectiveFormatNumberFormat:t}},this.getInheritanceFormatByAST=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t)return t;function n(e,r,n){var o=n(r.row,r.col,r.sheetId);return o&&!Object(ee.isGeneralCell)(o)?(t=o,{stopAll:!0}):{stopSearchingDown:!0,stopParallelTraversal:e}}function o(e,r){var n=e.start,o=e.cellRangeType,a=e.sheetIds[0],s={COL:function(){var e=n;return r(0,Object(u.i)(e),a)},ROW:function(){var e=n;return r(Object(u.O)(e),0,a)},NORMAL:function(){var t=e.scope,n=t.row,o=t.col;return r(n,o,a)},USER_RANGE:function(){return null},CELL:function(){return null}}[o]();return s&&!Object(ee.isGeneralCell)(s)?(t=s,{stopAll:!0}):{stopSearchingDown:!0,stopParallelTraversal:!0}}return Object(V.n)(e,(function(e,a){if(t)return{stopAll:!0};var s=a.length>2&&a[a.length-2],i=Object(V.k)(s);if(Object(V.k)(e)){if(e.formatType&&"string"===typeof e.formatType)return t=ee.NumberFormatFactory.createNumberFormat({pattern:e.formatType}),{stopAll:!0};var u=e.funcName.toUpperCase();if(!(["SUM","AVERAGE","MIN","MAX","ROUND","TRUNC"].indexOf(u)>-1))return{stopSearchingDown:!0,stopParallelTraversal:i}}return Object(V.c)(e)?n(i,e,r.getCellFormat):Object(V.f)(e)&&!Object(V.h)(e)?o(e,r.getCellFormat):{stopParallelTraversal:i}}),{preorder:!0}),t},this.getCellFormat=function(e,t,n){var o,a=r.externalMethods.getCellValueCache(e,t,n);return a&&"undefined"!==typeof a.result&&(o=a.userEnteredNumberFormat||a.effectiveFormatNumberFormat),o||r.externalMethods.getRealCellFormat(e,t,n)},this.externalMethods=t}return Object(i.a)(e,[{key:"hasTextInheritFunction",value:function(e){return/^=?(ASC|CLEAN|CONCAT|DBCS|DOLLAR|EXACT|FIXED|LEFT|LEFTB|LOWER|MID|MIDB|PROPER|REPLACE|REPLACEB|REPT|RIGHT|RIGHTB|SUBSTITUTE|TEXT|TEXTJOIN|TRIM|UPPER|USDOLLAR)\(.*\)$/i.test(e)}}]),e}(),re=r("./src/core/feature/formula/type.ts");function ne(e,t){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"===typeof e)return oe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return oe(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){i=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(i)throw a}}}}function oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ae(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function se(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(r),!0).forEach((function(t){Object(a.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ae(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ie=0,ue=function(){function e(t,r){var n=this;Object(s.a)(this,e),this.cellMap=h,this.valueCache={},this.asyncCalculateTaskMap=new Map,this.getResultBySingleFormula=function(e,t){var r;n.initCalculationEnvironment();var o={startRow:-1,endRow:-1,startCol:-1,endCol:-1,sheetId:t,markType:re.d.LOADED,referenced:new Set,dependency:new Set,type:re.c.CUSTOM_NODE},a=n.getAstByCellInfo({row:-1,col:-1,sheetId:t,formula:e}),s=n.calculateAndRunPostProcessing({ast:a,formula:e},o),i=!1;s.result instanceof $.a&&Object(u.v)(s.result.displayText)&&(i=!0);var l=null===(r=Object(u.r)(s.result))||void 0===r?void 0:r.result;return s.result=Object(u.D)(l)?s.result:l,se(se({},s),{},{isError:i})},this.getValueByTopCellPosition=function(e,t,r){if(Object(V.a)(e)){var o,a,s=(a=(e.identities.length,e.identities[0])).sheetId;if(1===a.colCount&&1===a.rowCount)o=n.formulaCalculate.helper.getCellValueByData(a.row,a.col,s);else if(1===a.colCount){if(t>a.row+a.rowCount-1||t<a.row)return u.l.value;var i=a.col,l=t;o=n.formulaCalculate.helper.getCellValueByData(l,i,s)}else if(1===a.rowCount){if(r>a.col+a.colCount-1||r<a.col)return u.l.value;var c=a.row,d=r;o=n.externalMethods.getCellValue(c,d,s)}return void 0!==o?o:u.l.value}},this.externalMethods=t,this.formulaCalculate=J,this.formulaCalculate.init(),this.inheritFormat=new te({getRealCellFormat:t.getRealCellFormat,getCellValueCache:this.getCellValueCache.bind(this)}),this.formulaParser=new H({getSheetIdsAmongTwoSheets:t.getSheetIdsAmongTwoSheets,getSheetNames:t.getSheetNames,getSheetNameBySheetId:t.getSheetNameBySheetId,getSheetIdBySheetName:t.getSheetIdBySheetName}),this.formulaCalculate.bindCustomMethod(Object.assign({},t,{parse:this.formulaParser.parse.bind(this.formulaParser),addDependency:this.hijackAddDependency.bind(this),cellValue:this.hijackGetCellValue.bind(this),getValueByTopCellPosition:this.getValueByTopCellPosition,markNodeToRecalculateAfterNetworkChange:function(){},isCellHidden:this.externalMethods.isCellHidden,cellEditValue:this.externalMethods.getCellEditValue,getLegalValueResultInfo:u.r,isNumeric:ee.isNumeric,parseValueWithStyle:G.parseValueWithStyle})),this.isInWorker=r}return Object(i.a)(e,[{key:"initCalculationEnvironment",value:function(){var e=this;if(this.isInWorker){var t=r("./src/core/feature/formula/lib/index.js").default;this.formulaCalculate.formulas=t}else r.e("bundle_calculation-environment").then(r.bind(null,"./src/core/feature/formula/calculation-environment.ts")).then((function(t){var r=t.formulajs;e.formulaCalculate.formulas=r}))}},{key:"formulaBecomeConstant",value:function(e,t){e.row,e.col,e.sheetId;var r=this.asyncCalculateTaskMap.get(t);r&&r.resolve(!0)}},{key:"calculateTopSortNodes",value:function(e,t,r){var n=t.afterCalculateSingleNodeHook,o=t.afterCalculateAllSyncNodes,a=t.afterCalculateAllAsyncNodes;ie=r,this.cleanValueCache(),this.resetFlags();for(var s=e.length,i=new Set,u=0;u<s;u++){var c=Date.now(),d=e[u],f=this.calculateAndRunPreProcessing(d);if(f){l.j(ie,{formulaCount:l.d(ie).formulaCount+1});var h=this.analyseAsyncNode({formulaInfo:f,node:d}),m=h.isAsyncNode,p=h.asyncTask;if(m)i.add({sortedNode:d,task:p});else{var v=this.calculateAndRunPostProcessing(f,d),g=Date.now()-c;l.j(r,{calculateSingleDuration:l.d(r).calculateSingleDuration+g}),this.afterCalculateResult({result:v,formulaInfo:f,formulaModel:f.formulaModel,sortedNode:d,afterCalculateSingleNodeHook:n})}}}if(this.needRecalculate){var y=this.externalMethods.getRecalculateTopSortNodesByGraphNodes(e);this.calculateTopSortNodes(y,{afterCalculateSingleNodeHook:n,afterCalculateAllSyncNodes:o,afterCalculateAllAsyncNodes:a},r)}else i.size>0&&(this.calculateTopSortNodesAsync(i,{afterCalculateSingleNodeHook:n,afterCalculateAllAsyncNodes:a}),l.j(r,{asyncFormulaCount:l.d(r).asyncFormulaCount+i.size})),o(this.valueCache)}},{key:"analyseAsyncNode",value:function(e){var t,r=this,n=e.formulaInfo,o=e.node,a=void 0,s=[],i=this.asyncCalculateTaskMap.get(o),u=Object(V.c)(n.ast)&&(null===(t=n.ast.getAsyncFunctionNodeList())||void 0===t?void 0:t.length)>0;(i||u)&&(s=this.getNodeDependencyTasks(o));var l=s.length>0,c=u||l;return c?(a=this.dealWithAsyncTask(i,s),this.asyncCalculateTaskMap.set(o,a),this.externalMethods.getReferencedCellNode(o,(function(e){return r.asyncCalculateTaskMap.set(e,{resolve:function(e){return e},promise:Promise.resolve(!1),dependencyTasks:[a.promise]}),!1}))):i&&i.resolve(!0),{isAsyncNode:c,asyncTask:a}}},{key:"calculateTopSortNodesAsync",value:function(){var e=Object(o.a)(regeneratorRuntime.mark((function e(t,r){var n,o,a,s,i,u,l,c,d,f=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r.afterCalculateSingleNodeHook,o=r.afterCalculateAllAsyncNodes,a=[],s=ne(t);try{for(s.s();!(i=s.n()).done;)u=i.value,l=u.sortedNode,c=u.task,d=this.runAsyncCalculate({sortedNode:l,task:c,afterCalculateSingleNodeHook:n}),a.push(d)}catch(h){s.e(h)}finally{s.f()}return e.abrupt("return",Promise.all(a).then((function(){o(f.valueCache)})));case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"runAsyncCalculate",value:function(){var e=Object(o.a)(regeneratorRuntime.mark((function e(t){var r,n,a,s=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.sortedNode,n=t.task,a=t.afterCalculateSingleNodeHook,e.abrupt("return",new Promise(function(){var e=Object(o.a)(regeneratorRuntime.mark((function e(t){var o,i,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(n.dependencyTasks);case 2:if((o=s.calculateAndRunPreProcessing(r))&&Object(V.c)(o.ast)){e.next=7;break}return s.asyncCalculateTaskMap.delete(r),t(),e.abrupt("return");case 7:return e.next=9,s.calculateAsyncNodes(o.ast);case 9:return i=!1,n.resolve(i),e.next=13,n.promise.then((function(e){i=e}));case 13:if(!i){e.next=17;break}return s.asyncCalculateTaskMap.delete(r),t(),e.abrupt("return");case 17:u=s.calculateAndRunPostProcessing(o,r),s.afterCalculateResult({result:u,formulaInfo:o,formulaModel:o.formulaModel,sortedNode:r,afterCalculateSingleNodeHook:a}),s.asyncCalculateTaskMap.delete(r),t();case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"calculateAsyncNodes",value:function(){var e=Object(o.a)(regeneratorRuntime.mark((function e(t){var r,n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(r=t.getAsyncFunctionNodeList()).length){e.next=3;break}return e.abrupt("return");case 3:n=ne(r),e.prev=4,n.s();case 6:if((o=n.n()).done){e.next=12;break}return a=o.value,e.next=10,this.formulaCalculate.helper.asyncCalculate(a);case 10:e.next=6;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),n.e(e.t0);case 17:return e.prev=17,n.f(),e.finish(17);case 20:case"end":return e.stop()}}),e,this,[[4,14,17,20]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getNodeDependencyTasks",value:function(e){var t=this,r=[];return this.externalMethods.getDependencyCellNode(e,(function(e){var n=t.asyncCalculateTaskMap.get(e);return n&&r.push(n.promise),!1})),r}},{key:"dealWithAsyncTask",value:function(e,t){var r=function(e){return e},n=null===e||void 0===e?void 0:e.resolve,o=new Promise((function(e){r=function(t){return e(t),null===n||void 0===n||n(!0),!0}}));return e&&(e.resolve=function(e){return e}),{resolve:r,promise:o,dependencyTasks:t}}},{key:"calculateAndRunPreProcessing",value:function(e){var t=e.startRow,r=e.startCol,n=e.sheetId,o=e.customType,a=this.externalMethods.getFormulaModelByRowCol(t,r,n,o);if(a){var s=a.toString(t,r,{getSheetTitleBySheetId:this.externalMethods.getSheetTitleBySheetId});return{ast:this.getAstByCellInfo({row:t,col:r,sheetId:n,formula:s}),formula:s,formulaModel:a}}}},{key:"calculateAndRunPostProcessing",value:function(e,t){var r,n,o,a=t.startRow,s=t.startCol,i=t.sheetId,c=t.markType;t.customType;r=c===re.d.CYCLE?{result:re.e.circle,error:re.e.circle}:this.calculateCell(e,t);var d=Date.now(),f=this.dealWithResultAfterCalculate(e.ast,r);if(l.j(ie,{formatDuration:l.d(ie).formatDuration+(Date.now()-d)}),Object(V.c)(e.ast)){var h=Date.now(),m=this.inheritFormat.getInheritFormat({formula:e.formula,ast:e.ast,row:a,col:s,sheetId:i});n=m.userEnteredNumberFormat,o=m.effectiveFormatNumberFormat,l.j(ie,{inheritFormatDuration:l.d(ie).inheritFormatDuration+(Date.now()-h)})}var p=f.result;if(f.error){var v=f.error;p=new $.a({displayText:v,title:"\u9519\u8bef",type:u.b[v],message:u.a[v]}),l.a(f.error,e.formula)}return{result:p,userEnteredNumberFormat:n,effectiveFormatNumberFormat:o}}},{key:"afterCalculateResult",value:function(e){var t=e.result,r=e.formulaInfo,n=e.formulaModel,o=e.sortedNode,a=e.afterCalculateSingleNodeHook;if(!this.needRecalculate){var s=o.startRow,i=o.startCol,u=o.sheetId,l=o.customType;Object(Z.f)(l)||this.setCellValueCache({row:s,col:i,sheetId:u,cellValueResult:t,formulaModel:n}),this.analyseCalculateNode(r,o),a({result:t,formulaModel:n,formulaInfo:r,sortedNode:o})}}},{key:"hijackAddDependency",value:function(e,t,r){var n=this.externalMethods.addDependency(e,t,r);return n&&(this.needRecalculate=!0),n}},{key:"hijackGetCellValue",value:function(e,t,r){var n=this.getCellValueCache(e,t,r);return n&&"undefined"!==typeof n.result?n.result:this.externalMethods.getCellValue(e,t,r)}},{key:"getCellValueCache",value:function(e,t,r){if(this.valueCache[r]&&this.valueCache[r][e])return this.valueCache[r][e][t]}},{key:"setCellValueCache",value:function(e){var t=e.row,r=e.col,n=e.sheetId,o=e.formulaModel,a=e.cellValueResult,s=a.result,i=a.userEnteredNumberFormat,u=a.effectiveFormatNumberFormat;this.valueCache[n]||(this.valueCache[n]=[]),this.valueCache[n][t]||(this.valueCache[n][t]=[]),this.valueCache[n][t][r]={userEnteredNumberFormat:i,effectiveFormatNumberFormat:u,result:s,formulaModel:o}}},{key:"cleanValueCache",value:function(){this.valueCache={}}},{key:"getAstByCellInfo",value:function(e){var t=e.row,r=e.col,n=e.sheetId,o=e.formula,a=Object(u.Q)(t,r);o=this.clearFormula(o);var s={row:t,col:r,rowCount:this.externalMethods.countRows(n),colCount:this.externalMethods.countCols(n),id:a,sheetId:n},i=Date.now(),c=this.formulaParser.parse(o,s),d=Date.now()-i;return l.j(ie,{parseDuration:l.d(ie).parseDuration+d}),c}},{key:"calculateCell",value:function(e,t){var r,o,a=e.ast,s=e.formula;if(this.isParseError(a))return a.error===re.e.error&&s.indexOf(re.e.ref)>-1&&(a.error=re.e.ref),{result:""===s?"=":a.error,error:a.error};var i=t.startRow,c=t.startCol,d=t.sheetId,f=Object(u.Q)(i,c),h={row:i,col:c,rowCount:this.externalMethods.countRows(d),colCount:this.externalMethods.countCols(d),id:f,sheetId:d};try{var m=Date.now();o=this.formulaCalculate.calculate(a,h);var p=Date.now()-m;l.j(ie,{calculateDuration:l.d(ie).calculateDuration+p})}catch(r){console.error("\u51fd\u6570\u8ba1\u7b97\u65f6\u51fa\u73b0\u9519\u8bef",r),o="object"===Object(n.a)(r)?r.message:u.l.error}return l.j(ie,{calculateCount:l.d(ie).calculateCount+1}),{result:Object(u.m)(o,15)}}},{key:"dealWithResultAfterCalculate",value:function(e,t){if(!Object(V.c)(e))return t;var r=Object(u.j)(e,t,this.getValueByTopCellPosition.bind(this)),n=r.result;return Object(u.v)(n)&&(r.error=n),Object(u.A)(r.result)&&(r.result=u.l.ref,r.error=u.l.ref),r}},{key:"analyseCalculateNode",value:function(e,t){var r=e.formula,n=t.sheetId,o=t.startRow,a=t.startCol;/\bRAND\b\(|\bNOW\b\(|\bRANDBETWEEN\b\(/g.test(r)?this.externalMethods.addAlwaysCalculateNodes({sheetId:n,row:o,col:a}):/STOCK\(\s*"(\w+(\.\w+)*)\.([A-Z]+)"\s*,\s*8\s*\)/i.test(r)&&this.externalMethods.addScheduleUpdateNode(t)}},{key:"resetFlags",value:function(){this.needRecalculate=!1,this.externalMethods.clearAlwaysCalculateNodes()}},{key:"isParseError",value:function(e){return!(Object(V.c)(e)&&e.body)}},{key:"clearFormula",value:function(e){return"="===e[0]&&(e=e.slice(1)),e}}]),e}()},"./src/core/feature/formula/controller.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.from.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.array.some.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.set.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/esnext.set.add-all.js"),r("../node_modules/core-js/modules/esnext.set.delete-all.js"),r("../node_modules/core-js/modules/esnext.set.difference.js"),r("../node_modules/core-js/modules/esnext.set.every.js"),r("../node_modules/core-js/modules/esnext.set.filter.js"),r("../node_modules/core-js/modules/esnext.set.find.js"),r("../node_modules/core-js/modules/esnext.set.intersection.js"),r("../node_modules/core-js/modules/esnext.set.is-disjoint-from.js"),r("../node_modules/core-js/modules/esnext.set.is-subset-of.js"),r("../node_modules/core-js/modules/esnext.set.is-superset-of.js"),r("../node_modules/core-js/modules/esnext.set.join.js"),r("../node_modules/core-js/modules/esnext.set.map.js"),r("../node_modules/core-js/modules/esnext.set.reduce.js"),r("../node_modules/core-js/modules/esnext.set.some.js"),r("../node_modules/core-js/modules/esnext.set.symmetric-difference.js"),r("../node_modules/core-js/modules/esnext.set.union.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=r("./src/base/index.ts"),i=r("../packages/mutation/src/MutationId.ts"),u=r("../packages/model/src/spreadsheet/SpreadsheetType.ts"),l=r("../node_modules/@tencent/tdocs-format-render/lib/index.js"),c=r("./src/core/feature/formula/utils.ts"),d=r("../packages/mutation/src/cell/SetCellPropertiesMutation.ts"),f=r("../packages/mutation/src/cell/SetRangeMutation.ts"),h=r("../packages/model/src/range/GridRange.ts"),m=r("../packages/model/src/cell/CellDataDelta.ts"),p=r("../packages/model/src/cell/CellDataSlot.ts"),v=r("../packages/model/src/cell/CellFormatSlot.ts"),g=r("./src/core/worker/worker-thread/index.ts"),y=r("../packages/mutation/src/dimension/SetDimensionPropertiesMutation.ts"),_=r("./src/core/feature/formula/cross-sheet-service/sheet-formula-layer-status.ts"),b=r("../packages/model/src/cell/cellDataUtils.ts"),A=r("./src/base/event/event.ts"),E=r("./src/core/feature/formula/report.ts"),j=r("./src/core/feature/formula/mutationUtil.ts"),R=r("../packages/model/src/sheet/SheetPropertiesSlot.ts"),S=r("./src/core/feature/formula/utils/parseUtil.ts"),C=r("./src/base/event/eventName.ts"),T=r("./src/core/feature/dataValidation/calc-plugin/DataValidationApi.ts"),w=r("./src/core/view/level-2/chart/charts/calc-plugin/ChartsApi.ts"),O=r("./src/core/view/level-2/condition-format-center/data/calc-plugin/ConditionFormatApi.ts"),I=r("../packages/services/src/dispose.ts"),N=r("./src/core/feature/formula/calculate/calculateCenter.ts"),k=r("./src/core/feature/formula/formula-graph/formulaGraph.ts"),M=r("./src/core/feature/formula/formula-graph/utils.ts"),D=r("./src/core/feature/formula/cross-sheet-service/crossSheetService.ts"),x=r("./src/core/feature/formula/cross-sheet-service/loadSheetManager.ts"),F=r("./src/core/feature/formula/formula-graph/updateGraphService.ts"),P=r("./src/core/feature/formula/formula-graph/customGraphNodeService.ts"),L=r("./src/core/feature/formula/formula-model-service/updateFormulaModelService.ts"),U=r("../packages/model/src/dimension/DimensionType.ts"),B=r("../packages/model/src/cell/ExtendedValueType.ts"),H=r("../packages/model/src/factory/index.ts");e.FORMULA_RESULT_NEED_TO_WRITE_BACK_TO_DATA_LAYER=!1;var G=function(){function t(r){var a=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=s.isInWorker,m=void 0!==i&&i,p=s.isPreview,v=void 0!==p&&p,y=s.previewMainThreadWorker;Object(o.a)(this,t),this.graphUpdateTimes=0,this.scheduleUpdateNodesSet=new Set,this.SCHEDULE_UPDATE_INTERVAL=-1,this.disposables=new I.b,this.countRows=function(e){if(!e||"string"!==typeof e)throw new Error("\u83b7\u53d6\u884c\u6570\u91cf\u5fc5\u987b\u8981\u63d0\u4f9b sheetId");var t=a.getSheetBySheetId(e);return t?t.getRowCount():0},this.countCols=function(e){if(!e||"string"!==typeof e)throw new Error("\u83b7\u53d6\u5217\u6570\u91cf\u5fc5\u987b\u8981\u63d0\u4f9b sheetId");var t=a.getSheetBySheetId(e);return t?t.getColCount():0},this.hijackAddGraphDependency=function(e,t,r){a.crossSheetService.analyseCrossSheetNode(t);var n=a.crossSheetService.getCurrentBatchCrossSheetIds();return a.loadSheetManager.addSomeLoadSheetTasks(n),a.graph.addDependency(e,t,r)},this.getActiveSheetId=function(){return a.spreadsheet.activeSheetId},this.getSheetBySheetId=function(e){var t=e||a.currentSheetId;return a.spreadsheet.sheetManager.getSheetBySheetId(t)},this.getSheetIdBySheetName=function(e){var t=a.spreadsheet.sheetManager.getSheetBySheetTitle(e);return t?t.getSheetId():"#REF!"},this.getSheetIdsAmongTwoSheets=function(e,t){return a.spreadsheet.sheetManager.getSheetIdsAmongTwoSheets(e,t)},this.getSheetNameBySheetId=function(e){var t=a.getSheetBySheetId(e);return t?t.getTitle():""},this.getSheetIds=function(){return a.spreadsheet.sheetManager.sheetList.map((function(e){return e.getSheetId()}))},this.getSheetNames=function(){return a.spreadsheet.sheetManager.sheetList.map((function(e){return e.getTitle()}))},this.getCellData=function(e,t,r){var n=a.getSheetBySheetId(r);return n?n.getCellDataAtPosition(e,t):null},this.getCellValue=function(e,t,r){if(!r||"string"!==typeof r)throw new Error("\u83b7\u53d6 cellValue \u5fc5\u987b\u8981\u63d0\u4f9b sheetId");var n=a.getSheetBySheetId(r);if(n){var o=n.getCellDataAtPosition(e,t)||null;if(!o)return null;var s=o.getEffectiveValue();return void 0!==(null===s||void 0===s?void 0:s.value)?s.value:null}return null},this.getCellEditValue=function(e,t,r){if(!r||"string"!==typeof r)throw new Error("\u83b7\u53d6 cellEditValue \u5fc5\u987b\u8981\u63d0\u4f9b sheetId");var n=a.getSheetBySheetId(r);if(n){var o=n.getCellDataAtPosition(e,t)||null;return o?o.getEditValue():null}return null},this.getRealCellFormat=function(e,t,r){if(!r||"string"!==typeof r)throw new Error("\u83b7\u53d6 cellFormat \u5fc5\u987b\u8981\u63d0\u4f9b sheetId");var n=a.getSheetBySheetId(r);if(n){var o=n.getCellDataAtPosition(e,t)||null;if(!o)return null;var s=Object(b.getExportFormat)(o);return s?s.getNumberFormat():null}return null},this.isGridRangeInVisbleArea=function(e){var t=a.visibleArea;if(!t)return!1;var r=a.getActiveSheetId();return e.sheetId===r&&(e.startRowIndex>=t.frozenRowStart&&e.endRowIndex<=t.frozenRowEnd&&e.startColIndex>=t.frozenColStart&&e.endColIndex<=t.frozenColEnd||e.startRowIndex>=t.flowRowStart&&e.endRowIndex<=t.flowRowEnd&&e.startColIndex>=t.flowColStart&&e.endColIndex<=t.flowColEnd)},this.keyframeHandler=function(e){e.sType;var t=e.sheetId;a.sheetFormulaLayerStatusMap.isSheetLoaded(t)||a.sheetFormulaLayerStatusMap.setWaitingStart(t);var r=a.getSheetBySheetId(t);if(r){var n=r.data.rowData,o=[];n.forEach((function(e,r){e&&e.values.forEach((function(e,n){var s;if(e){var i,u=a.getFormulaModelByRowCol(r,n,t),l=null===(s=e.getUserEnteredFormat())||void 0===s?void 0:s.getDataValidation();if(l)null===(i=a.dataValidationApi)||void 0===i||i.add(l,new h.b(t,r,r,n,n));u&&o.push({row:r,col:n,formulaModel:u,sheetId:t})}}))})),a.isInWorker&&(E.m(),a.updateGraphAndAnalyseCrossSheetReference(o),E.l()),r.conditionalFormatRuleManager.rules.forEach((function(e){var t;null===(t=a.conditionalFormatApi)||void 0===t||t.add(e.index,e.rule)}))}},this.afterMutationRunHandler=function(e){var t=e.mutation,r=e.sheetId,n=e.sType,o=e.isFromFormula,s=e.isCrossSheetMutation,i=void 0!==s&&s;if("string"===typeof r)a.mutationHandler({mutation:t,sheetId:r,sType:n,isFromFormula:o,isCrossSheetMutation:i});else{var u=r;a.mutationHandler({mutation:t,sheetId:u[0],sType:n,isFromFormula:o,isCrossSheetMutation:i,mutationAffectedSheetIds:u})}},this.mutationHandler=function(e){var t=e.mutation,r=e.sheetId,n=e.sType,o=e.isFromFormula,s=e.mutationAffectedSheetIds,i=e.isCrossSheetMutation,l=void 0!==i&&i;if(!o&&n===u.a.PREVIEW===a.isPreview){if(l){if(a.sheetFormulaLayerStatusMap.hasSheetStartedLoadingInFormulaLayer(r))return;a.loadSheetManager.addLoadSheetTask(r)}var c=a.spreadsheet.sheetManager.getSheetBySheetId(r);l||a.sheetFormulaLayerStatusMap.isSheetLoaded(r)||!c||!c.isFetching&&!c.isLoaded||a.sheetFormulaLayerStatusMap.setWaitingStart(r),a.mutationHandlerBeforeInit(t,r,l),a.mutationHandlerInWorkerBeforeInit(t),a.sheetFormulaLayerStatusMap.isSheetWaitingDone(r)||a.mutationHandlerAfterInit(t,s)}},this.sendNoOperationMutationCallBackFromWorker=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.needToSetIntializedDone,r=e.relatedSheetIds;a.isInWorker&&(t&&r?a.syncNonPersistentMutationsToMainThread({mutations:[],isFromFormula:!0,needToSetIntializedDone:t,relatedSheetIds:r}):a.syncNonPersistentMutationsToMainThread({mutations:[],isFromFormula:!0}),g.a.workerThreadWorker.mutationData.debounceCacheFormulaResult([]))},this.isCellHidden=function(e,t,r,n){var o=a.getSheetBySheetId(r);return!!o&&a.isSheetCellHidden(o,e,t,n)},this.isInRowColMove=function(){return a.inRowColMove},this.markRowColMove=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];a.inRowColMove=e},this.syncAllFormulaResultToMainThread=function(e){var t=[];a.traverseCellDataBySheetId(e,(function(e){var r,n,o=e.row,a=e.col,s=e.sheetId,i=e.iCellData,u=null===i||void 0===i?void 0:i.getFormula();if(u){var l=null===i||void 0===i?void 0:i.getEffectiveValue(),c=null===i||void 0===i||null===(r=i.getUserEnteredFormat())||void 0===r?void 0:r.getNumberFormat(),d=null===i||void 0===i||null===(n=i.getEffectiveFormat())||void 0===n?void 0:n.getNumberFormat();t.push({row:o,col:a,formulaModel:u,sheetId:s,effectiveValue:l,userEnteredNumberFormat:c,effectiveFormatNumberFormat:d})}})),a.updateCellsByChangedFormulaNodes(t)},this.cellDataHasValue=function(e){for(var t=!0,r=e,n=r.sheetId,o=r.startRowIndex;o<=r.endRowIndex;o++)for(var s=r.startColIndex;s<=r.endColIndex;s++){var i=a.getCellData(o,s,n),u=null===i||void 0===i?void 0:i.getEffectiveValue(),l=null===u||void 0===u?void 0:u.value;null!==l&&""!==l&&void 0!==l||(t=!1)}return t},this.mutationForDataValidation=function(e){e&&(e instanceof d.a?a.setCellPropertiesMutationForDataValidation(e):e instanceof f.a&&a.setRangeMutationForDataValidation(e))},this.addScheduleUpdateNode=function(e){a.scheduleUpdateNodesSet.add(e)},this.calculateScheduleFormulas=function(){var e=a.scheduleUpdateNodesSet;if(e.size>0){var t=Array.from(e),r=a.graph.getRecalculateTopSortNodesByGraphNodes(t);a.calculateSortNodesResultAndRunHook(r,{toMainThreadDataLayer:!0,toWorkerThreadDataLayer:!0})}},this.getFormulaModelByRowCol=function(e,t,r,n){if(Object(M.f)(n))return a.customGraphNodeService.getCustomNodeFormulaModel({row:e,col:t,sheetId:r,customType:n});var o=a.getCellData(e,t,r),s=null===o||void 0===o?void 0:o.getFormula();if(!s){var i=null===o||void 0===o?void 0:o.getEffectiveValue();if(i&&"string"===typeof i.value&&Object(c.C)(i.value)){var u=null===o||void 0===o?void 0:o.getUserEnteredFormat();if(!(u&&Object(l.isTextCell)(u.getNumberFormat()))||Object(c.w)(i.value)){var d=i.value;s=Object(S.c)(d,e,t,r);var f=Object(j.b)({formula:s,gridRange:new h.b(r,e,e,t,t)});a.updateCellDataFromFormula(f)}}}return s||null},this.afterCalculateAllNodes=function(e,t){var r=t.toMainThreadDataLayer,n=t.toWorkerThreadDataLayer;a.customGraphNodeService.afterCalculateAllNodes();var o=Date.now();a.syncAllCalculationResultToDataLayer(e,{toMainThreadDataLayer:r,toWorkerThreadDataLayer:n}),E.j(a.graphUpdateTimes,{syncRangeResultDuration:E.d(a.graphUpdateTimes).syncRangeResultDuration+(Date.now()-o)}),a.cacheFormulaSnapshot(e)},this.afterCalculateSingleNode=function(e){var t=e.result,r=e.formulaInfo,n=e.formulaModel,o=e.sortedNode;if(Object(M.f)(o.customType)){var s={row:o.startRow,col:o.startCol,sheetId:o.sheetId,customType:o.customType,value:t.result,formulaModel:n};a.customGraphNodeService.addResultChangedCustomNode(s)}else{var i=t,u=Date.now();a.syncSingleCalculationResultToDataLayer(i,r,o),E.j(a.graphUpdateTimes,{resultToSpreadsheetDuration:E.d(a.graphUpdateTimes).resultToSpreadsheetDuration+(Date.now()-u)})}},this.traverseCellDataBySheetId=function(e,t){var r=a.getSheetBySheetId(e);r&&r.data.rowData.forEach((function(r,n){r&&r.values.forEach((function(r,o){r&&t({row:n,col:o,sheetId:e,iCellData:r})}))}))},this.setSheetInitializedForSwitchSheet=function(e){var t=e.sheetId;a.sheetFormulaLayerStatusMap.isSheetLoaded(t)||a.sheetFormulaLayerStatusMap.setWaitingStart(t),a.sheetFormulaLayerStatusMap.isSheetInitialized(t)||(a.sheetFormulaLayerStatusMap.setWaitingDone(t),a.sheetFormulaLayerStatusMap.setInitializedDone(t))},this.updateCellDataFromFormula=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.isInVisibleArea,n=t.runInWorker,o=void 0===n||n;t.needToSetIntializedDone,e.gridRange;if(o){var s=Date.now();a.syncNonPersistentMutationsToMainThread({mutations:[e],isInVisibleArea:r,isFromFormula:!0}),E.j(a.graphUpdateTimes,{syncMutationDuration:E.d(a.graphUpdateTimes).syncMutationDuration+(Date.now()-s)})}else A.c.spreadsheetEvent.trigger("updateCellDataFromFormula",e)},this.updateCellsByChangedFormulaNodes=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=a.getSetRangeMutationsFromChangedFormulaNodes(e,t);r.forEach((function(e){a.isInWorker&&a.updateCellDataFromFormula(e,{runInWorker:!0}),a.updateCellDataFromFormula(e,{runInWorker:!1})}))},this.getSetRangeMutationsFromChangedFormulaNodes=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=[],n={};e.forEach((function(e){var r=t.formulaOnly,o=void 0!==r&&r,s=a.getCellDataDeltaByChangedFormulaNode(e,{formulaOnly:o});if(s){var i=e.sheetId,u=e.row,l=e.col,c={rowIndex:u,colIndex:l,cellDataDelta:s};if(n[i]){var d=n[i];d.cellDataDeltaAtPositions.push(c),d.minRow=Math.min(d.minRow,u),d.maxRow=Math.max(d.maxRow,u),d.minCol=Math.min(d.minCol,l),d.maxCol=Math.max(d.maxCol,l)}else n[i]={cellDataDeltaAtPositions:[c],minCol:l,minRow:u,maxRow:u,maxCol:l}}}));for(var o=0,s=Object.keys(n);o<s.length;o++){var i=s[o],u=n[i],l=u.minRow,c=u.minCol,d=u.maxRow,m=u.maxCol,p=u.cellDataDeltaAtPositions,v=new f.a({gridRange:new h.b(i,l,d,c,m),cellDataDeltaAtPositions:p});r.push(v)}return r},this.syncSingleCalculationResultToDataLayer=function(t,r,o){var s=t.userEnteredNumberFormat,i=t.effectiveFormatNumberFormat,u=t.result,l=o.startRow,d=o.startCol,f=o.sheetId;if(a.graph.getGraphCellNode({sheetId:f,row:l,col:d})){var m=new h.b(f,l,l,d,d);if(a.isGridRangeInVisbleArea(m)){var p=(null===u||void 0===u?void 0:u.displayText)?B.a.ERROR:c.c[Object(n.a)(u)],v={effectiveValue:H.ExtendedValueFactory.createInstance({type:p,value:u}),gridRange:m,userEnteredNumberFormat:s,effectiveFormatNumberFormat:i};if(Object(c.z)()||e.FORMULA_RESULT_NEED_TO_WRITE_BACK_TO_DATA_LAYER){var g=Object(j.b)(v);return g?a.updateCellDataFromFormula(g,{isInVisibleArea:!0}):void 0}}}},this.isDestroyed=!1,this.mainThreadWorker=v?y||r.spreadsheet.parent.mainThreadWorker:r.mainThreadWorker,this.parent=r,this.isPreview=v,this.isInWorker=m,this.spreadsheet=this.isPreview?this.parent.preview.previewsheet:this.parent.spreadsheet,this.inRowColMove=!1,this.sheetFormulaLayerStatusMap=new _.a,this.graph=new k.a({getSheetIdsAmongTwoSheets:this.getSheetIdsAmongTwoSheets,getSheetIndexBySheetId:this.spreadsheet.sheetManager.getSheetIndexBySheetId.bind(this.spreadsheet.sheetManager),isSheetLoaded:this.sheetFormulaLayerStatusMap.isSheetLoaded.bind(this.sheetFormulaLayerStatusMap),isSheetInitialized:this.sheetFormulaLayerStatusMap.isSheetInitialized.bind(this.sheetFormulaLayerStatusMap),countRows:this.countRows,countCols:this.countCols}),this.crossSheetService=new D.a({getSheetIdsAmongTwoSheets:this.getSheetIdsAmongTwoSheets}),this.loadSheetManager=new x.a({getSheetBySheetId:this.getSheetBySheetId},this.isInWorker,this.parent),this.updateGraphService=new F.a({countRows:this.countRows,countCols:this.countCols,getSheetIndexBySheetId:this.spreadsheet.sheetManager.getSheetIndexBySheetId.bind(this.spreadsheet.sheetManager),getSheetIdBySheetIndex:this.spreadsheet.sheetManager.getSheetIdBySheetIndex.bind(this.spreadsheet.sheetManager)},this.graph),this.customGraphNodeService=new P.a({getOrGenerateGraphNode:this.graph.getOrGenerateGraphNode.bind(this.graph),analyseFormulaModelAndGenerateDependency:this.graph.analyseFormulaModelAndGenerateDependency.bind(this.graph),getGraphVirtualNode:this.graph.getGraphVirtualNode.bind(this.graph),getGraphMap:this.graph.getGraphMap.bind(this.graph),deleteGraphNode:this.graph.deleteGraphNode.bind(this.graph)}),this.updateFormulaModelService=new L.a({isSheetAmongTwoSheets:this.spreadsheet.sheetManager.isSheetAmongTwoSheets.bind(this.spreadsheet.sheetManager),getFormulaModelByRowCol:this.getFormulaModelByRowCol,traverseCellDataBySheetId:this.traverseCellDataBySheetId,getSheetIdBySheetIndex:this.spreadsheet.sheetManager.getSheetIdBySheetIndex.bind(this.spreadsheet.sheetManager),getSheetIds:this.getSheetIds,getSheetIndexBySheetId:this.spreadsheet.sheetManager.getSheetIndexBySheetId.bind(this.spreadsheet.sheetManager),getSheetTitleBySheetId:this.spreadsheet.sheetManager.getSheetTitleBySheetId.bind(this.spreadsheet.sheetManager)}),this.calculateCenter=new N.a({getRecalculateTopSortNodesByGraphNodes:this.graph.getRecalculateTopSortNodesByGraphNodes.bind(this.graph),addScheduleUpdateNode:this.addScheduleUpdateNode,isCellHidden:this.isCellHidden,getCellEditValue:this.getCellEditValue,getCellValue:this.getCellValue,countRows:this.countRows,countCols:this.countCols,getSheetIdBySheetName:this.getSheetIdBySheetName,getSheetIdsAmongTwoSheets:this.getSheetIdsAmongTwoSheets,getSheetNames:this.getSheetNames,getSheetNameBySheetId:this.getSheetNameBySheetId,getFormulaModelByRowCol:this.getFormulaModelByRowCol,getRealCellFormat:this.getRealCellFormat,addDependency:this.hijackAddGraphDependency,getSheetTitleBySheetId:this.spreadsheet.sheetManager.getSheetTitleBySheetId.bind(this.spreadsheet.sheetManager),addAlwaysCalculateNodes:this.graph.addAlwaysChangedNodes.bind(this.graph),clearAlwaysCalculateNodes:this.graph.clearAlwaysCalculateNodes.bind(this.graph),getDependencyCellNode:this.graph.getDependencyCellNode.bind(this.graph),getReferencedCellNode:this.graph.getReferencedCellNode.bind(this.graph)},m),this.getResultBySingleFormula=this.calculateCenter.getResultBySingleFormula,m&&(this.dataValidationApi=new T.a({getCellData:this.getCellData,cellDataHasValue:this.cellDataHasValue,addCustomFormulaNodeAndGenerateDependency:this.customGraphNodeService.addCustomFormulaNodeAndGenerateDependency.bind(this.customGraphNodeService),removeCustomFormulaNode:this.customGraphNodeService.removeCustomFormulaNode.bind(this.customGraphNodeService),getItemsAccordingToCustomTypeAndPosition:this.customGraphNodeService.getItemsAccordingToCustomTypeAndPosition.bind(this.customGraphNodeService),countRows:this.countRows,countCols:this.countCols}),this.conditionalFormatApi=new O.a({getSheetTitleBySheetId:this.spreadsheet.sheetManager.getSheetTitleBySheetId.bind(this.spreadsheet.sheetManager),getSheetBySheetId:this.getSheetBySheetId,addCustomFormulaNodeAndGenerateDependency:this.customGraphNodeService.addCustomFormulaNodeAndGenerateDependency.bind(this.customGraphNodeService),removeCustomFormulaNodeByType:this.customGraphNodeService.removeCustomFormulaNodeByType.bind(this.customGraphNodeService),getItemByCustomTypeAndRowCol:this.customGraphNodeService.getItemByCustomTypeAndRowCol.bind(this.customGraphNodeService),countRows:this.countRows,countCols:this.countCols}),this.chartsApi=new w.a({getSheetTitleBySheetId:this.spreadsheet.sheetManager.getSheetTitleBySheetId.bind(this.spreadsheet.sheetManager),addCustomFormulaNodeAndGenerateDependency:this.customGraphNodeService.addCustomFormulaNodeAndGenerateDependency.bind(this.customGraphNodeService),removeCustomFormulaNodeByType:this.customGraphNodeService.removeCustomFormulaNodeByType.bind(this.customGraphNodeService),getChartWorkbookRangeById:this.spreadsheet.workbookRangeManager.getChartWorkbookRangeById.bind(this.spreadsheet.workbookRangeManager)})),Object(S.a)({parse:this.calculateCenter.formulaParser.parse}),this.subscribe(),m?this.visibleArea||(this.visibleArea={flowColEnd:24,flowColStart:0,flowRowEnd:50,flowRowStart:0,frozenColEnd:0,frozenColStart:0,frozenRowEnd:0,frozenRowStart:0,sheetId:this.getActiveSheetId()}):this.bindVisbileAreaMonitor(),this.SCHEDULE_UPDATE_INTERVAL=setInterval(this.calculateScheduleFormulas,6e4)}return Object(a.a)(t,[{key:"destroy",value:function(){var t;null===(t=e.log)||void 0===t||t.debug("flow controller destroy()"),this.isDestroyed=!0,this.parent.mutationBehavior.emitter.removeListener(this.parent.mutationBehavior.EVENT.AFTER_MUTATION_RUN,this.afterMutationRunHandler),clearInterval(this.SCHEDULE_UPDATE_INTERVAL),A.c.default.remove("setSheetInitializedForSwitchSheet",this.setSheetInitializedForSwitchSheet),this.disposables.dispose()}},{key:"startReCalculateAfterSheetInitial",value:function(e){var t=this;e.forEach((function(e){E.n(e,t.graphUpdateTimes+1)}));var r=E.f(),n=E.e()-r;this.calculateCenter.initCalculationEnvironment();var o=Date.now();e.forEach((function(e){t.graph.loadSheet(e)})),n+=Date.now()-o;var a=Date.now(),s=this.graph.getRecalculateTopSortNodesBySheetIds(e),i=Date.now(),u=i-a;this.calculateSortNodesResultAndRunHook(s,{toMainThreadDataLayer:!0,toWorkerThreadDataLayer:!0,isInitSheet:!0});var l=Date.now(),c=n+l-a,d=l-i;E.j(this.graphUpdateTimes,{nodeSortDuration:E.d(this.graphUpdateTimes).nodeSortDuration+u}),E.g({hasFormula:s.length>0,graphAndCalculateDuration:c,buildGraphDuration:n,calculateDuration:d,sheetId:e[0]}),e.forEach((function(e){t.sheetFormulaLayerStatusMap.isSheetCalculating(e)&&t.sheetFormulaLayerStatusMap.setInitializedDone(e),t.graph.generateGraphVirtualNodeDependencyAfterSheetInitialized(e)}))}},{key:"initEdit",value:function(e){var t=this;e.forEach((function(e){t.mutationHandler({mutation:e,sheetId:t.getActiveSheetId()})}))}},{key:"subscribe",value:function(){var e=this;this.parent.mutationBehavior.emitter.addListener(this.parent.mutationBehavior.EVENT.AFTER_MUTATION_RUN,this.afterMutationRunHandler),A.c.default.listen("setSheetInitializedForSwitchSheet",this.setSheetInitializedForSwitchSheet),this.disposables.add(this.spreadsheet.onUpdateConditionalFormat((function(t){var r,n=null===(r=e.conditionalFormatApi)||void 0===r?void 0:r.update(t.ruleIndex,t.newConditionalFormatRule,t.oldRuleRanges);e.calculateResultAndSyncDataByChangedGraphNodes(n)})))}},{key:"bindVisbileAreaMonitor",value:function(){var e=this,t=this.parent;Object(c.R)((function(){var e;return null===(e=t.view)||void 0===e?void 0:e.canvas}),(function(){var r=t.view.canvas;t.event.init.listen(C.a.AFTER_FIRST_RENDER,s.a.util.type.throttle((function(){var t=r.areaData,n=t.row,o=n.frozen,a=o.renderFrom,s=o.renderTo,i=n.flow,u=i.renderFrom,l=i.renderTo,c=t.col,d=c.frozen,f=d.renderFrom,h=d.renderTo,m=c.flow,p={frozenRowStart:a,frozenRowEnd:s,flowRowStart:u,flowRowEnd:l,frozenColStart:f,frozenColEnd:h,flowColStart:m.renderFrom,flowColEnd:m.renderTo,sheetId:e.currentSheetId};e.mainThreadWorker.sheetData.syncVisibleAreaToWorker({visibleArea:p})}),1e3,e,!0))}))}},{key:"doesCellDataDeltaChangeFormulaLayer",value:function(e){var t=e.cellDataDelta;e.rowIndex,e.colIndex,e.sheetId;if(t.setSlots&1<<p.b.SLOT_FORMULA)return!0;if(t.clearSlots&1<<p.b.SLOT_EFFIECTIVE_VALUE)return!0;if(t.setSlots&1<<p.b.SLOT_EFFIECTIVE_VALUE)return!0;var r=t.delta.userEnteredFormatDelta;if(r){if(r.clearSlots&1<<v.b.NUMBER_FORMAT)return!0;if(r.setSlots&1<<v.b.NUMBER_FORMAT)return!0}return!1}},{key:"getInvertMutationsForDeleteDimensionMutation",value:function(e){return this.updateFormulaModelService.getInvertMutationsForDeleteDimensionMutation(e)}},{key:"getInvertMutationsForRowReorderMutation",value:function(e){return this.updateFormulaModelService.getInvertMutationsForRowReorderMutation(e)}},{key:"resetSheet",value:function(e){var t;this.isInWorker||(null===(t=this.mainThreadWorker)||void 0===t||t.sheetData.resetSheetOnWorkerFormula({sheetId:e}));this.calculateCenter.cellMap.initCellMapData(),this.sheetFormulaLayerStatusMap.resetSheet(e),this.graph.resetGraph()}},{key:"calculateResultAndSyncDataByChangedNodes",value:function(e){if(this.isInWorker)if(e&&0!==e.length){var t=this.graph.getRecalculateTopSortNodesByChangedNodes(e);this.calculateSortNodesResultAndRunHook(t,{toMainThreadDataLayer:!0,toWorkerThreadDataLayer:!0})}else this.sendNoOperationMutationCallBackFromWorker()}},{key:"calculateResultAndSyncDataByChangedGraphNodes",value:function(e){if(this.isInWorker)if(e&&0!==e.length){var t=this.graph.getRecalculateTopSortNodesByGraphNodes(e);this.calculateSortNodesResultAndRunHook(t,{toMainThreadDataLayer:!0,toWorkerThreadDataLayer:!0})}else this.sendNoOperationMutationCallBackFromWorker()}},{key:"shouldSyncToSameThreadDataLayer",value:function(){return!this.isInWorker||window.FORMULA_RESULT_NEED_TO_WRITE_BACK_TO_DATA_LAYER}},{key:"setCellPropertiesMutationForDataValidation",value:function(e){var t,r,n=e.gridRange,o=e.cellDataDelta,a=null===o||void 0===o?void 0:o.delta.userEnteredFormatDelta;if(o.clearSlots&1<<p.b.SLOT_USER_ENTERED_FORMAT_DELTA&&!a)return null===(t=this.dataValidationApi)||void 0===t||t.delete(n),null;if(!a)return null;if(a.setSlots&1<<v.b.DATA_VALIDATION){var s=null===a||void 0===a?void 0:a.delta.getDataValidation();if(s){var i,u=null===(i=this.dataValidationApi)||void 0===i?void 0:i.add(s,n);this.calculateResultAndSyncDataByChangedGraphNodes(u)}}a.clearSlots&1<<v.b.DATA_VALIDATION&&(null===(r=this.dataValidationApi)||void 0===r||r.delete(n))}},{key:"setRangeMutationForDataValidation",value:function(e){var t=this,r=e.gridRange,n=e.cellDataDeltaAtPositions;if(!n)return null;n.forEach((function(e){var n=e.cellDataDelta,o=null===n||void 0===n?void 0:n.delta.userEnteredFormatDelta;if(!o)return null;var a,s=e.colIndex,i=e.rowIndex,u=r.sheetId;if(o.setSlots&1<<v.b.DATA_VALIDATION){var l=null===o||void 0===o?void 0:o.delta.getDataValidation();if(l){var c,d=null===(c=t.dataValidationApi)||void 0===c?void 0:c.add(l,new h.b(u,i,i,s,s));t.calculateResultAndSyncDataByChangedGraphNodes(d)}}o.clearSlots&1<<v.b.DATA_VALIDATION&&(null===(a=t.dataValidationApi)||void 0===a||a.delete(new h.b(u,i,i,s,s)))}))}},{key:"isSheetCellHidden",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"ALL",o=e.data,a=o.rowMetadata,s=o.colMetadata,i=null===a||void 0===a?void 0:a[t],u=null===s||void 0===s?void 0:s[r],l=!1;return i&&(l=this.isCellRowOrColInfoHidden(i,n)),u&&(l=this.isCellRowOrColInfoHidden(u,n)||l),l}},{key:"isCellRowOrColInfoHidden",value:function(e,t){switch(t){case"ALL":return e.hiddenByUser||e.hiddenByFilter;case"USER":return e.hiddenByUser;case"FILTER":return e.hiddenByFilter;default:return!1}}},{key:"calculateSortNodesResultAndRunHook",value:function(e,t){var r=this,n=t.toMainThreadDataLayer,o=t.toWorkerThreadDataLayer,a=t.isInitSheet;if(this.isInWorker)if(0!==e.length){this.graphUpdateTimes+=1;var s=Date.now();this.calculateCenter.calculateTopSortNodes(e,{afterCalculateSingleNodeHook:this.afterCalculateSingleNode,afterCalculateAllSyncNodes:function(e){r.afterCalculateAllNodes(e,{toMainThreadDataLayer:n,toWorkerThreadDataLayer:o})},afterCalculateAllAsyncNodes:function(e){r.afterCalculateAllNodes(e,{toMainThreadDataLayer:n,toWorkerThreadDataLayer:o})}},this.graphUpdateTimes);var i=Date.now()-s,u=E.c()||0;E.o({isInitSheet:!!a,mutationSubscribeTime:u,isAfterMutationRun:!0}),E.p({calculateDuration:i,graphUpdateTimes:this.graphUpdateTimes,isInitSheet:!!a,mutationSubscribeTime:u,isAfterMutationRun:!0}),E.i({isInitSheet:!!a}),E.h({isInitSheet:!!a})}else this.sendNoOperationMutationCallBackFromWorker()}},{key:"cacheFormulaSnapshot",value:function(e){var t=Object.keys(e);g.a.workerThreadWorker.mutationData.debounceCacheFormulaResult(t)}},{key:"syncNonPersistentMutationsToMainThread",value:function(e){if(e.needToSetIntializedDone&&e.relatedSheetIds){var t=this.graph.toJson();log.log("formulaGraph",{nodes:t.nodes,edges:t.edges})}g.a.workerThreadWorker.mutationData.syncNonPersistentMutationsToMainThread(e)}},{key:"getCellDataDeltaByChangedFormulaNode",value:function(e,t){var r=t.formulaOnly,n=e.sheetId,o=e.formulaModel,a=e.effectiveFormatNumberFormat,s=e.userEnteredNumberFormat,i=e.effectiveValue;if(this.getSheetBySheetId(n)){if(!r)return Object(j.a)({effectiveValue:i,effectiveFormatNumberFormat:a,userEnteredNumberFormat:s});if(o){var u=new m.a;return u.setSlot(p.b.SLOT_FORMULA,o),u}}}},{key:"mutationHandlerBeforeInit",value:function(e,t,r){var n,o,a,s=Date.now();switch(e.id){case i.b.SET_RANGE_MUTATION:case i.b.SET_CELL_PROPERTIES_MUTATION:E.k(s),this.calculateFormulasAfterSetCellMutation(e,{isCrossSheetMutation:r}),this.isInWorker&&this.mutationForDataValidation(e);break;case i.b.INIT_DATA_MUTATION:this.sheetFormulaLayerStatusMap.setWaitingDone(t),this.startReCalculateAfterSheetInitial([t]);break;case i.b.DEFINE_WORKBOOK_RANGE_MUTATION:null===(n=this.chartsApi)||void 0===n||n.add(e.workbookRangeType,e.workbookRangeId);break;case i.b.DELETE_WORKBOOK_RANGE_MUTATION:null===(o=this.chartsApi)||void 0===o||o.delete(e.workbookRangeType,e.workbookRangeId);break;case i.b.UPDATE_WORKBOOK_RANGE_MUTATION:null===(a=this.chartsApi)||void 0===a||a.update(e.workbookRangeType,e.workbookRangeId)}}},{key:"mutationHandlerInWorkerBeforeInit",value:function(e){var t,r;if(this.isInWorker)switch(e.id){case i.b.ADD_CONDITIONAL_FORMAT_MUTATION:var n,o=null===(n=this.conditionalFormatApi)||void 0===n?void 0:n.add(e.ruleIndex,e.rule);this.calculateResultAndSyncDataByChangedGraphNodes(o);break;case i.b.DELETE_CONDITIONAL_FORMAT_MUTATION:null===(t=this.conditionalFormatApi)||void 0===t||t.delete(e.ruleIndex,e.oldRuleRanges);break;case i.b.UPDATE_CONDITIONAL_FORMAT_MUTATION:var a,s=null===(a=this.conditionalFormatApi)||void 0===a?void 0:a.update(e.ruleIndex,e.rule,e.oldRuleRanges);this.calculateResultAndSyncDataByChangedGraphNodes(s);break;case i.b.REORDER_RANGE_MUTATION:null===(r=this.conditionalFormatApi)||void 0===r||r.clearDirtyRange([e.range])}}},{key:"mutationHandlerAfterInit",value:function(e,t){var r,n=Date.now();switch(e.id){case i.b.SET_RANGE_MUTATION:case i.b.SET_CELL_PROPERTIES_MUTATION:case i.b.INIT_DATA_MUTATION:break;case i.b.INSERT_DIMENSION_MUTATION:case i.b.DELETE_DIMENSION_MUTATION:E.k(n),this.updateFormulaModelAfterInsertDeleteDimensionMutation(e,{mutationAffectedSheetIds:t}),this.calculateFormulasAfterInsertDeleteDimensionMutation(e,{mutationAffectedSheetIds:t});break;case i.b.MAP_RANGE_MUTATION:E.k(n),this.updateFormulaModelAfterMoveDimensionMutation(e,{mutationAffectedSheetIds:t}),this.calculateFormulasAfterMoveDimensionMutation(e,{mutationAffectedSheetIds:t});break;case i.b.REORDER_RANGE_MUTATION:E.k(n),this.updateFormulaModelAfterReorderRangeMutation(e),this.calculateFormulasAfterReorderRangeMutation(e);break;case i.b.SET_DIMENSION_PROPERTIES_MUTATION:e.operation.some((function(e){return e.slot&y.a.SLOT_HIDDEN}))?(E.k(n),this.calculateFormulasAfterShowHiddenDimensionMutation(e)):this.sendNoOperationMutationCallBackFromWorker();break;case i.b.UPDATE_FILTER_MUTATION:case i.b.DELETE_FILTER_MUTATION:E.k(n),this.calculateFormulasAfterUpdateFilterDimensionMutation(e);break;case i.b.MERGE_CELLS_MUTATION:E.k(n);break;case i.b.DELETE_SHEET_MUTATION:this.updateFormulaModelAfterSheetDeletedMutation({sheetId:e.sheetId,sheetIndex:e.sheetIndex}),this.calculateFormulasAfterSheetDeleted({sheetId:e.sheetId,sheetIndex:e.sheetIndex});break;case i.b.INSERT_SHEET_MUTATION:this.calculateFormulasAfterSheetInserted({sheetId:e.sheetId,sheetIndex:e.sheetIndex});break;case i.b.MOVE_SHEET_MUTATION:this.calculateFormulasAfterSheetMove({originSheetIndex:e.fromIndex,targetSheetIndex:e.toIndex});break;case i.b.SET_SHEET_PROPERTIES_MUTATION:if(null===(r=e.sheetDelta)||void 0===r?void 0:r.deltas)for(var o=0;o<e.sheetDelta.deltas.length;o++){var a=e.sheetDelta.deltas[o];if(a&&a.slotName===R.a.SLOT_NAME){this.updateFormulaModelAfterSheetRenameMutation({sheetId:e.sheetId,sheetName:a.value});break}}break;default:this.sendNoOperationMutationCallBackFromWorker()}}},{key:"calculateFormulasAfterSetCellMutation",value:function(e,t){var r=t.isCrossSheetMutation;if(this.isInWorker){var n=this.getChangeNodesByMutation(e,r);this.updateGraphAndAnalyseCrossSheetReference(n),this.sheetFormulaLayerStatusMap.isSheetInitialized(e.gridRange.sheetId)&&this.calculateResultAndSyncDataByChangedNodes(n)}}},{key:"updateGraphAndAnalyseCrossSheetReference",value:function(e){if(this.isInWorker){this.crossSheetService.clearCurrentBatchCrossSheetIds(),this.graph.updateGraphFromChangedNodes(e,this.crossSheetService.analyseCrossSheetNode);var t=this.crossSheetService.getCurrentBatchCrossSheetIds();this.loadSheetManager.addSomeLoadSheetTasks(t)}}},{key:"updateFormulaModelAfterInsertDeleteDimensionMutation",value:function(e,t){t.mutationAffectedSheetIds;var r=this.updateFormulaModelService.updateFormulaModelAfterRowColAddDeleteMutation(e,!0);this.updateCellsByChangedFormulaNodes(r,{formulaOnly:!0})}},{key:"updateFormulaModelAfterMoveDimensionMutation",value:function(e,t){t.mutationAffectedSheetIds;var r=this.updateFormulaModelService.updateFormulaModelAfterRowColCutMoveMutation(e);this.updateCellsByChangedFormulaNodes(r,{formulaOnly:!0})}},{key:"updateFormulaModelAfterReorderRangeMutation",value:function(e){var t=this.updateFormulaModelService.updateFormulaModelAfterReorderRangeMutation(e,!0);this.updateCellsByChangedFormulaNodes(t,{formulaOnly:!0})}},{key:"updateFormulaModelAfterSheetRenameMutation",value:function(e){var t=e.sheetId,r=e.sheetName,n=this.updateFormulaModelService.updateFormulaModelAfterSheetRenameMutation({sheetId:t,sheetName:r});this.updateCellsByChangedFormulaNodes(n,{formulaOnly:!0})}},{key:"updateFormulaModelAfterSheetDeletedMutation",value:function(e){var t=e.sheetId,r=e.sheetIndex,n=this.updateFormulaModelService.updateFormulaModelAfterSheetDeletedMutation({sheetId:t,originSheetIndex:r});this.updateCellsByChangedFormulaNodes(n,{formulaOnly:!0})}},{key:"calculateFormulasAfterInsertDeleteDimensionMutation",value:function(e,t){t.mutationAffectedSheetIds;var r=this.updateGraphService.updateGraphAfterInsertDeleteDimension(e);this.calculateResultAndSyncDataByChangedGraphNodes(r);var n=this.customGraphNodeService.getNeedCheckChangedCustomNodes(),o=this.updateFormulaModelService.updateFormulaModelAfterRowColAddDeleteMutation(e,!1,n);this.customGraphNodeService.notifyCustomTypeFormulaModelChange(o),this.customGraphNodeService.updateCustomNodeMap(n),this.calculateResultAndSyncDataByChangedNodes(o)}},{key:"calculateFormulasAfterMoveDimensionMutation",value:function(e,t){t.mutationAffectedSheetIds;var r=this.updateGraphService.updateGraphAfterRowColMove(e);this.calculateResultAndSyncDataByChangedGraphNodes(r);var n=this.customGraphNodeService.getNeedCheckChangedCustomNodes(),o=this.updateFormulaModelService.updateFormulaModelAfterRowColCutMoveMutation(e,n);this.customGraphNodeService.updateCustomNodeMap(n),this.customGraphNodeService.notifyCustomTypeFormulaModelChange(o),this.calculateResultAndSyncDataByChangedNodes(o)}},{key:"calculateFormulasAfterReorderRangeMutation",value:function(e){for(var t=e.sheetId,r=e.range,n=r.endColIndex,o=r.startColIndex,a=r.startRowIndex,s=r.endRowIndex,i=[],u=a;u<=s;u++)for(var l=o;l<=n;l++){var c=this.getFormulaModelByRowCol(u,l,t)||void 0;i.push({row:u,col:l,formulaModel:c,sheetId:t})}this.updateGraphAndAnalyseCrossSheetReference(i);var d=this.customGraphNodeService.getNeedCheckChangedCustomNodes(),f=this.updateFormulaModelService.updateFormulaModelAfterReorderRangeMutation(e,!1,d);this.customGraphNodeService.notifyCustomTypeFormulaModelChange(f),this.customGraphNodeService.updateCustomNodeMap(d),Array.prototype.push.apply(i,f),this.calculateResultAndSyncDataByChangedNodes(i)}},{key:"calculateFormulasAfterShowHiddenDimensionMutation",value:function(e){var t=this,r=(e.sheetId,e.ranges),n=[];r.forEach((function(e){for(var r=e.dimension,o=e.startIndex,a=e.endIndex,s=e.sheetId,i=U.a.ROWS===r,u=i?o:0,l=i?a:t.countRows(s),c=i?0:o,d=i?t.countCols(s):a,f=u;f<=l;f++)for(var h=c;h<=d;h++){var m=t.getFormulaModelByRowCol(f,h,s)||void 0;n.push({row:f,col:h,formulaModel:m,sheetId:s})}})),this.updateGraphAndAnalyseCrossSheetReference(n),this.calculateResultAndSyncDataByChangedNodes(n)}},{key:"calculateFormulasAfterUpdateFilterDimensionMutation",value:function(e){var t=e.sheetId,r=this.graph.getRecalculateTopSortNodesBySheetIds([t]);this.calculateSortNodesResultAndRunHook(r,{toMainThreadDataLayer:!0,toWorkerThreadDataLayer:!0})}},{key:"calculateFormulasAfterSheetMove",value:function(e){var t=e.originSheetIndex,r=e.targetSheetIndex,n=this.updateGraphService.updateGraphAfterSheetMove({originSheetIndex:t,targetSheetIndex:r});this.calculateResultAndSyncDataByChangedGraphNodes(n)}},{key:"calculateFormulasAfterSheetInserted",value:function(e){var t=e.sheetId,r=e.sheetIndex;this.updateGraphService.updateGraphAfterSheetInsert({sheetId:t,sheetIndex:r}).length>0&&this.loadSheetManager.addLoadSheetTask(t)}},{key:"calculateFormulasAfterSheetDeleted",value:function(e){var t=e.sheetId,r=e.sheetIndex,n=this.updateGraphService.updateGraphAfterSheetDelete({sheetId:t,sheetIndex:r});this.calculateResultAndSyncDataByChangedGraphNodes(n);var o=this.customGraphNodeService.getNeedCheckChangedCustomNodes(),a=this.updateFormulaModelService.updateFormulaModelAfterSheetDeletedMutation({sheetId:t,originSheetIndex:r},o);this.customGraphNodeService.notifyCustomTypeFormulaModelChange(a),this.customGraphNodeService.updateCustomNodeMap(o),this.calculateResultAndSyncDataByChangedNodes(a)}},{key:"getCellDataDeltaByMutations",value:function(e){var t=e.gridRange,r=e instanceof f.a?e.cellDataDeltaAtPositions:[];if(e instanceof d.a)for(var n=e.cellDataDelta,o=t.startRowIndex;o<=t.endRowIndex;o++)for(var a=t.startColIndex;a<=t.endColIndex;a++)r.push({rowIndex:o,colIndex:a,cellDataDelta:n});return r}},{key:"getFormulaNodesByCurrentBatchValueCache",value:function(e){var t=this,r=[];return Object.keys(e).forEach((function(o){e[o].forEach((function(e,a){e.forEach((function(e,s){var i=e.formulaModel,u=e.effectiveFormatNumberFormat,l=e.userEnteredNumberFormat,d=e.result;if(t.graph.getGraphCellNode({sheetId:o,row:a,col:s})){var f=(null===d||void 0===d?void 0:d.displayText)?B.a.ERROR:c.c[Object(n.a)(d)],h=H.ExtendedValueFactory.createInstance({type:f,value:d});r.push({row:a,col:s,formulaModel:i,sheetId:o,effectiveFormatNumberFormat:u,userEnteredNumberFormat:l,effectiveValue:h})}}))}))})),r}},{key:"syncAllCalculationResultToDataLayer",value:function(e,t){var r=this,n=t.toMainThreadDataLayer,o=t.toWorkerThreadDataLayer,a=this.getFormulaNodesByCurrentBatchValueCache(e);this.getSetRangeMutationsFromChangedFormulaNodes(a).forEach((function(e){n&&r.updateCellDataFromFormula(e,{runInWorker:!0}),o&&r.updateCellDataFromFormula(e,{runInWorker:!1})}))}},{key:"getChangeNodesByMutation",value:function(e,t){var r=this,n=e.gridRange.sheetId,o=[];return this.getCellDataDeltaByMutations(e).forEach((function(e){var a=e.cellDataDelta,s=e.rowIndex,i=e.colIndex,u=t?a.delta.formula:r.getFormulaModelByRowCol(s,i,n);if(!u){var l=r.graph.getGraphCellNode({row:s,col:i,sheetId:n});if(Object(M.m)(null===l||void 0===l?void 0:l.customType)&&r.formulaBecomeConstant({row:s,col:i,sheetId:n},l),!r.doesCellDataDeltaChangeFormulaLayer({cellDataDelta:a,rowIndex:s,colIndex:i,sheetId:n}))return}o.push({row:s,col:i,formulaModel:u||void 0,sheetId:n})})),o}},{key:"formulaBecomeConstant",value:function(e,t){this.scheduleUpdateNodesSet.delete(t),this.calculateCenter.formulaBecomeConstant(e,t)}},{key:"currentSheet",get:function(){return this.spreadsheet.activeSheet}},{key:"currentSheetId",get:function(){return this.spreadsheet.activeSheetId}},{key:"currentSheetTitle",get:function(){return this.spreadsheet.activeSheet.getTitle()}}]),t}();t.a=G}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/feature/formula/cross-sheet-service/crossSheetService.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.set.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/esnext.set.add-all.js"),r("../node_modules/core-js/modules/esnext.set.delete-all.js"),r("../node_modules/core-js/modules/esnext.set.difference.js"),r("../node_modules/core-js/modules/esnext.set.every.js"),r("../node_modules/core-js/modules/esnext.set.filter.js"),r("../node_modules/core-js/modules/esnext.set.find.js"),r("../node_modules/core-js/modules/esnext.set.intersection.js"),r("../node_modules/core-js/modules/esnext.set.is-disjoint-from.js"),r("../node_modules/core-js/modules/esnext.set.is-subset-of.js"),r("../node_modules/core-js/modules/esnext.set.is-superset-of.js"),r("../node_modules/core-js/modules/esnext.set.join.js"),r("../node_modules/core-js/modules/esnext.set.map.js"),r("../node_modules/core-js/modules/esnext.set.reduce.js"),r("../node_modules/core-js/modules/esnext.set.some.js"),r("../node_modules/core-js/modules/esnext.set.symmetric-difference.js"),r("../node_modules/core-js/modules/esnext.set.union.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=function(){function e(t){var r=this;Object(n.a)(this,e),this.analyseCrossSheetNode=function(e){var t=e.startSheetId,n=e.endSheetId;t&&n&&(t!==n?r.externalMethods.getSheetIdsAmongTwoSheets(t,n).forEach((function(e){return r.currentBatchCrossSheetIds.add(e)})):r.currentBatchCrossSheetIds.add(t))},this.externalMethods=t,this.currentBatchCrossSheetIds=new Set}return Object(o.a)(e,[{key:"getCurrentBatchCrossSheetIds",value:function(){return this.currentBatchCrossSheetIds}},{key:"clearCurrentBatchCrossSheetIds",value:function(){this.currentBatchCrossSheetIds.clear()}}]),e}()},"./src/core/feature/formula/cross-sheet-service/loadSheetManager.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=function(){var e=[],t=!1,r=function r(){if(e.length){1===e.length&&(t=!1),e.shift();var n=e[0];"function"===typeof n&&n(r)}};return{add:function(){e.push.apply(e,arguments)},run:function(){if(e.length&&!t){t=!0;var n=e[0];"function"===typeof n&&n(r)}}}}(),a=r("./src/base/index.ts"),s=r("./src/core/worker/worker-thread/index.ts");t.a=function e(t,r,i){var u=this;Object(n.a)(this,e),this.addSomeLoadSheetTasks=function(e){e.forEach(u.addLoadSheetTask)},this.addLoadSheetTask=function(e){return!!u.unloadedSheetsMap[e]||!!e&&(!!u.externalMethods.getSheetBySheetId(e)&&(o.add((function(t){a.a.util.timer.wait(50).run((function(){u.loadSheet(e),t()}))})),o.run(),u.unloadedSheetsMap[e]=!0,!0))},this.loadSheet=function(e){u.isInWorker?s.a.workerThreadWorker.sheetData.loadSheet({sheetId:e,waitForFormulaLayerToBeInitialized:!1}):u.parent.dataCenter.loadSheetData({sheetId:e,onSuccess:function(){}})},this.externalMethods=t,this.unloadedSheetsMap={},this.isInWorker=r,this.parent=i}},"./src/core/feature/formula/cross-sheet-service/sheet-formula-layer-status.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("./src/core/feature/formula/utils.ts"),s=function(){function e(){Object(n.a)(this,e),this.statusMap={}}return Object(o.a)(e,[{key:"getInitialPromise",value:function(e){var t=this.statusMap[e];return t&&Object(a.F)(t.initialized)?t.initialized:Promise.reject()}},{key:"getCurrentStatusMap",value:function(){for(var e={},t=0,r=Object.keys(this.statusMap);t<r.length;t++){var n=r[t];this.isSheetInitialized(n)?e[n]="initialized":this.isSheetCalculating(n)?e[n]="calculating":this.isSheetWaitingDone(n)?e[n]="waiting":e[n]="loaded"}return e}},{key:"getSheetIds",value:function(){return Object.keys(this.statusMap)}},{key:"getWaitingPromise",value:function(e){var t=this.statusMap[e];return t&&Object(a.F)(t.waiting)?t.waiting:Promise.reject()}},{key:"hasSheetStartedLoadingInFormulaLayer",value:function(e){return this.isSheetWaitingDone(e)||this.isSheetCalculating(e)||this.isSheetInitialized(e)}},{key:"isSheetLoaded",value:function(e){return!!this.statusMap[e]}},{key:"isSheetWaitingDone",value:function(e){var t=this.statusMap[e];return!(!t||!Object(a.F)(t.waiting)||Object(a.F)(t.initialized))}},{key:"isSheetCalculating",value:function(e){var t=this.statusMap[e];return!(!t||t.ready||!Object(a.F)(t.initialized))}},{key:"isSheetInitialized",value:function(e){var t=this.statusMap[e];return!(!t||!t.ready)}},{key:"resetSheet",value:function(e){delete this.statusMap[e]}},{key:"setWaitingStart",value:function(e){if(!this.statusMap[e]){var t=Object(a.s)(),r=t.promise,n=t.reject,o=t.resolve;this.statusMap[e]={waiting:r,waitingReject:n,waitingResolve:o}}}},{key:"setWaitingDone",value:function(e){var t=this.statusMap[e];if(!t||!Object(a.F)(t.waiting))throw new Error("\u5728".concat("\u4e3b\u7ebf\u7a0b\u4e2d"," ").concat(e,"\u8bbe\u7f6e waiting \u72b6\u6001\u7684\u65f6\u673a\u6709\u8bef"));if(Object(a.F)(t.initialized)&&console.warn("\u6536\u5230\u4e86\u4e24\u4e2a InitDataMutation\uff0c\u5728\u4fee\u8ba2\u8bb0\u5f55\u9884\u89c8\u5207\u6362\u7684\u65f6\u5019\u4f1a\u51fa\u73b0\u8fd9\u4e2a\u95ee\u9898\u3002"),!t.waitingResolve)throw new Error("".concat(e," waiting resolve function miss"));if(t.waitingResolve(),!t.ready){var r=Object(a.s)(),n=r.promise,o=r.reject,s=r.resolve;t.initialized=n,t.initializedReject=o,t.initializedResolve=s}}},{key:"setInitializedDone",value:function(e){var t=this.statusMap[e];if(!t||!Object(a.F)(t.initialized))throw new Error("".concat(e," \u8bbe\u7f6e initialized \u7684\u65f6\u673a\u6709\u8bef"));if(!t.initializedResolve)throw new Error("".concat(e," resolve function miss"));t.initializedResolve(),t.ready=!0}}]),e}()},"./src/core/feature/formula/custom-formula/index.ts":function(e,t,r){"use strict";var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("./src/core/feature/formula/lib/index.js"),s=r("./src/core/feature/formula/func-config.ts");var i=new(function(){function e(){Object(n.a)(this,e),this.registry={}}return Object(o.a)(e,[{key:"register",value:function(e,t,r){if(!this.hasFormulaRegistered(e)){var n=function(e){return function(t){return e.apply(this,t)}}(t);this.registry[e]=n,a.default[e]=n,s.f[e]=r,s.d[e]=r}}},{key:"getAllRegistries",value:function(){return this.registry}},{key:"hasFormulaRegistered",value:function(e){return void 0!==this.registry[e]}}]),e}());t.a=i},"./src/core/feature/formula/formula-graph/customGraphNodeService.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.find.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.array.reduce.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.object.values.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=r("./src/core/feature/formula/type.ts"),i=r("./src/core/feature/formula/formula-graph/utils.ts"),u=r("../packages/model/src/cell/ExtendedValueType.ts"),l=r("../packages/model/src/factory/index.ts"),c=r("./src/core/feature/formula/utils.ts"),d=r("./src/base/index.ts"),f=function(){function e(t){Object(o.a)(this,e),this.externalMethods=t,this.customNodesMap={},this.resultChangedCustomNodesMap={}}return Object(a.a)(e,[{key:"setCustomNodeValue",value:function(e){var t=e.customType,r=e.row,n=e.col,o=e.sheetId,a=e.value,s=this.generateCustomNodeId({customType:t,row:r,col:n,sheetId:o});this.customNodesMap[s].value=a}},{key:"getCustomNodeFormulaModel",value:function(e){var t,r=e.customType,n=e.row,o=e.col,a=e.sheetId,s=this.generateCustomNodeId({customType:r,row:n,col:o,sheetId:a});return null===(t=this.customNodesMap[s])||void 0===t?void 0:t.formulaModel}},{key:"updateCustomNodeMap",value:function(e){var t=this,r={};e.forEach((function(e){var n=t.generateCustomNodeId(e);r[n]=e})),Object.values(this.customNodesMap).forEach((function(e){if(Object(i.i)(e.customType)){var n=t.generateCustomNodeId(e);r[n]=e}})),this.customNodesMap=r}},{key:"getNeedCheckChangedCustomNodes",value:function(){return Object.values(this.customNodesMap).filter((function(e){return!Object(i.i)(e.customType)}))}},{key:"addCustomFormulaNodeAndGenerateDependency",value:function(e){var t=e.formulaModel,r=e.row,n=e.col,o=e.sheetId,a=e.customType,u=this.generateCustomNodeId({customType:a,row:r,col:n,sheetId:o});this.customNodesMap[u]={formulaModel:t,row:r,col:n,sheetId:o,customType:a,value:void 0};var l=this.externalMethods.getOrGenerateGraphNode({startRow:r,endRow:r,startCol:n,endCol:n,startSheetId:o,endSheetId:o},s.c.CUSTOM_NODE,a),c=Object(i.i)(a);return this.externalMethods.analyseFormulaModelAndGenerateDependency({sheetInfo:{},graphNode:l,changedFormulaNode:{formulaModel:t,row:r,col:n,sheetId:o},isReferencedStaticRange:c}),l}},{key:"removeCustomFormulaNodeByType",value:function(e){var t=this,r=this.externalMethods.getGraphMap();Object.values(r).forEach((function(r){var n=r.graphVirtualNodes;Object.values(n).forEach((function(r){var n=r.type,o=r.customType,a=r.startRow,s=r.startCol,u=r.sheetId;if(Object(i.k)(n)&&-1!==e.indexOf(o)){t.externalMethods.deleteGraphNode(r);var l=t.generateCustomNodeId({customType:o,row:a,col:s,sheetId:u});delete t.customNodesMap[l]}}))}))}},{key:"removeCustomFormulaNode",value:function(e){var t=e.row,r=e.col,n=e.sheetId,o=e.customType,a={startRow:t,endRow:t,startCol:r,endCol:r,startSheetId:n,endSheetId:n},i=this.externalMethods.getGraphVirtualNode(a,s.c.CUSTOM_NODE,o);if(i){this.externalMethods.deleteGraphNode(i);var u=this.generateCustomNodeId({row:t,col:r,sheetId:n,customType:o});delete this.customNodesMap[u]}}},{key:"getItemByCustomTypeAndRowCol",value:function(e){var t=e.customType,r=e.row,n=e.col,o=e.sheetId,a=this.generateCustomNodeId({row:r,col:n,sheetId:o,customType:t}),s=this.customNodesMap[a],i={customType:t,row:r,col:n,sheetId:o,value:!1};if(!s)return i;var u=s.value;if(!u)return i;var l=u.find((function(e){return e.row===r&&e.col===n}));return l&&(i.value=l.value),i}},{key:"getItemsAccordingToCustomTypeAndPosition",value:function(e){var t=this,r={};return e.map((function(e){var o=e.row,a=e.col,s=e.sheetId,i=e.customTypes;return{row:o,col:a,sheetId:s,results:i.reduce((function(e,r){var i=t.generateCustomNodeId({row:o,col:a,sheetId:s,customType:r}),d=t.customNodesMap[i];if(!d)return e;var f=d.value,h=(null===f||void 0===f?void 0:f.displayText)?u.a.ERROR:c.c[Object(n.a)(f)],m=l.ExtendedValueFactory.createInstance({type:h,value:f});return e[r]=m,e}),r)}}))}},{key:"afterCalculateAllNodes",value:function(){this.notifyCustomTypesToUpdate(this.resultChangedCustomNodesMap,s.b.customTypeResultChange),this.resultChangedCustomNodesMap={}}},{key:"addResultChangedCustomNode",value:function(e){var t=e.customType;this.resultChangedCustomNodesMap[t]||(this.resultChangedCustomNodesMap[t]=[]),this.resultChangedCustomNodesMap[t].push(e),this.setCustomNodeValue(e)}},{key:"notifyCustomTypeFormulaModelChange",value:function(e){var t=this,r={};e.forEach((function(e){var n=e.customType,o=e.row,a=e.col,s=e.sheetId;r[n]=r[n]||[],r[n].push(e);var i=t.generateCustomNodeId({customType:n,row:o,col:a,sheetId:s});t.customNodesMap[i]=e})),this.notifyCustomTypesToUpdate(r,s.b.customTypeFormulaModelChange)}},{key:"notifyCustomTypesToUpdate",value:function(e,t){for(var r=0,n=Object.keys(e);r<n.length;r++){var o=n[r],a=e[o];d.a.event.formula.trigger(t,{customType:o,datas:a})}}},{key:"generateCustomNodeId",value:function(e){var t=e.customType,r=e.row,n=e.col,o=e.sheetId;return"dv"===t?"".concat(o,"@").concat(t,"@").concat(r,",").concat(n):t}}]),e}()},"./src/core/feature/formula/formula-graph/formulaGraph.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.symbol.description.js"),r("../node_modules/core-js/modules/es.symbol.iterator.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.from.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.function.name.js"),r("../node_modules/core-js/modules/es.object.assign.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.object.values.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.set.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/esnext.set.add-all.js"),r("../node_modules/core-js/modules/esnext.set.delete-all.js"),r("../node_modules/core-js/modules/esnext.set.difference.js"),r("../node_modules/core-js/modules/esnext.set.every.js"),r("../node_modules/core-js/modules/esnext.set.filter.js"),r("../node_modules/core-js/modules/esnext.set.find.js"),r("../node_modules/core-js/modules/esnext.set.intersection.js"),r("../node_modules/core-js/modules/esnext.set.is-disjoint-from.js"),r("../node_modules/core-js/modules/esnext.set.is-subset-of.js"),r("../node_modules/core-js/modules/esnext.set.is-superset-of.js"),r("../node_modules/core-js/modules/esnext.set.join.js"),r("../node_modules/core-js/modules/esnext.set.map.js"),r("../node_modules/core-js/modules/esnext.set.reduce.js"),r("../node_modules/core-js/modules/esnext.set.some.js"),r("../node_modules/core-js/modules/esnext.set.symmetric-difference.js"),r("../node_modules/core-js/modules/esnext.set.union.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=r("./src/core/feature/formula/type.ts"),i=r("./src/core/feature/formula/formula-graph/utils.ts"),u=r("./src/core/feature/formula/utils.ts"),l=function(){function e(){Object(o.a)(this,e),this.graphMap={}}return Object(a.a)(e,[{key:"getCellNode",value:function(e){var t=e.row,r=e.col,n=e.sheetId,o=this.graphMap[n];if(!o)return null;var a=o.graphCells;return a[t]&&a[t][r]?a[t][r]:null}},{key:"getGraphVirtualNode",value:function(e,t){var r=this.graphMap[t];return r&&r.graphVirtualNodes[e]||null}},{key:"getGraphSheetNodes",value:function(e){return this.graphMap[e]||null}},{key:"deleteGraphSheetNodes",value:function(e){delete this.graphMap[e]}},{key:"getGraphMap",value:function(){return this.graphMap}},{key:"addCellNode",value:function(e){var t=e.sheetId,r=e.startRow,n=e.startCol;this.generateGraphMap(t);var o=this.graphMap[t].graphCells;o[r]=o[r]||[],o[r][n]=e}},{key:"addGraphVirtualNode",value:function(e,t){var r=t.sheetId;this.generateGraphMap(t.sheetId),this.graphMap[r].graphVirtualNodes[e]=t}},{key:"getIn",value:function(e){return e.referenced}},{key:"getInSize",value:function(e){return e.referenced.size}},{key:"getOut",value:function(e){return e.dependency}},{key:"getOutSize",value:function(e){return e.dependency.size}},{key:"isNodeInTargetNodeIn",value:function(e,t){return null===e||void 0===e?void 0:e.dependency.has(t)}},{key:"isNodeInTargetNodeOut",value:function(e,t){return e.referenced.has(t)}},{key:"hasEdge",value:function(e,t){return e.dependency.has(t)}},{key:"setEdge",value:function(e,t){e.dependency.add(t),t.referenced.add(e)}},{key:"removeEdge",value:function(e,t){e.dependency.delete(t),t.referenced.delete(e)}},{key:"deleteCell",value:function(e,t,r){delete this.graphMap[e].graphCells[t][r]}},{key:"deleteVirtualNode",value:function(e,t){delete this.graphMap[e].graphVirtualNodes[t]}},{key:"updateGraphMap",value:function(e,t){var r=e.graphCells,n=e.graphVirtualNodes;r&&(this.graphMap[t].graphCells=r),n&&(this.graphMap[t].graphVirtualNodes=n)}},{key:"toJson",value:function(){var e=[],t=0;return Object.values(this.graphMap).forEach((function(r){r.graphCells.forEach((function(r){r.forEach((function(r){e.push(r),t+=r.referenced.size}))})),Object.values(r.graphVirtualNodes).forEach((function(r){t+=r.referenced.size,e.push(r)}))})),{nodes:e,edges:t}}},{key:"generateGraphMap",value:function(e){this.graphMap[e]||(this.graphMap[e]={graphCells:[],graphVirtualNodes:{}})}}]),e}();function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function f(e,t){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"===typeof e)return h(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return h(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){i=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(i)throw a}}}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var m=function(){function e(t){Object(o.a)(this,e),this.graphSheetRanges={},this.externalMethods=t,this.graph=new l,this.alwaysChangedNodes=new Set,this.unGenerateDependencyVirtualNodes={}}return Object(a.a)(e,[{key:"addNodesFromChangedNodes",value:function(e){var t=this;e.forEach((function(e){var r=e.row,n=e.col,o=e.sheetId,a=t.getGraphCellNode({row:r,col:n,sheetId:o});a&&t.resetGraphNodeDependency(a),Object(i.g)(e)?a?Object(i.j)(a.customType)&&(t.updateGraphNodeProperties(a,{customType:s.a.FORMULA}),t.updateNodeMarkType(a,s.d.LOADED)):a=t.addNode({startRow:r,endRow:r,startCol:n,endCol:n,startSheetId:o,endSheetId:o},s.c.CELL,s.a.FORMULA):a&&t.clearSingleGraphNode(a)}))}},{key:"updateGraphFromChangedNodes",value:function(e,t){var r=this,n={};this.addNodesFromChangedNodes(e),e.forEach((function(e){var o=e.row,a=e.col,s=e.sheetId,u=r.getGraphCellNode({row:o,col:a,sheetId:s});Object(i.g)(e)&&r.analyseFormulaModelAndGenerateDependency({sheetInfo:n,graphNode:u,changedFormulaNode:e,afterAnalyseDependencyCallback:t})}))}},{key:"loadSheet",value:function(e){var t=this,r=this.getGraphSheetNodes(e);if(r){var n=[],o=[];r.graphCells.forEach((function(e){e.forEach((function(e){Object(i.j)(e.customType)?t.updateNodeMarkType(e,s.d.LOADED):t.generateGraphRangeDependencyWithFormulaNode(e);var r=t.graph.getInSize(e);s.d.LOADED===e.markType&&0!==r?n.push(e):s.d.UNLOAD===e.markType&&0!==r&&o.push(e)}))}));var a=this.unGenerateDependencyVirtualNodes[e];null===a||void 0===a||a.forEach((function(e){0===t.graph.getOutSize(e)&&(t.updateNodeMarkType(e,s.d.LOADED),n.push(e))})),this.markReferencedNodeLoadStatus(o),this.markReferencedNodeLoadStatus(n)}}},{key:"generateGraphRangeDependencyWithFormulaNode",value:function(e){var t=this,r=e.startRow,n=e.startCol,o=e.sheetId,a=this.unGenerateDependencyVirtualNodes[o];null===a||void 0===a||a.forEach((function(o){Object(i.e)({row:r,col:n},o)&&t.graph.setEdge(o,e)}))}},{key:"generateGraphVirtualNodeDependencyAfterSheetInitialized",value:function(e){var t=this;delete this.unGenerateDependencyVirtualNodes[e];var r=this.getGraphSheetNodes(e);r&&Object.values(r.graphVirtualNodes).forEach((function(e){var r=e.startRow,n=e.endRow,o=e.startCol;(n-r+1)*(e.endCol-o+1)!==t.graph.getOutSize(e)&&t.generateGraphVirtualNodeDependency(e,{})}))}},{key:"getRecalculateTopSortNodesByChangedNodes",value:function(e){this.alwaysChangedNodes.forEach((function(t){var r=t.startRow,n=t.startCol,o=t.sheetId;e.push({row:r,col:n,sheetId:o})}));var t=this.getVertexNodesAndDyeGraphByChangedNodes(e);return this.getTopSortNodes(t)}},{key:"getRecalculateTopSortNodesBySheetIds",value:function(e){var t=this.getVertexNodesAndDyeGraphBySheetIds(e);return this.getTopSortNodes(t)}},{key:"getRecalculateTopSortNodesByGraphNodes",value:function(e){this.alwaysChangedNodes.forEach((function(t){e.push(t)}));var t=this.getVertexNodesAndDyeGraphByGraphNodes(e);return this.getTopSortNodes(t)}},{key:"resetGraphNodeDependency",value:function(e){var t=this;this.graph.getOut(e).forEach((function(r){var n=r.customType,o=r.markType;if(t.graph.removeEdge(e,r),o!==s.d.UNLOAD){var a=t.graph.getInSize(r);!Object(i.m)(n)&&a<=0&&(t.resetGraphNodeDependency(r),t.clearSingleGraphNode(r))}}))}},{key:"regenerateGraphVirtualNodeDependency",value:function(e,t){var r=this;e.forEach((function(e){r.resetGraphNodeDependency(e),r.generateGraphVirtualNodeDependency(e,t)}))}},{key:"resetGraph",value:function(){this.graph=new l,this.graphSheetRanges={},this.alwaysChangedNodes=new Set}},{key:"getGraphCellNode",value:function(e){var t=e.row,r=e.col,n=e.sheetId;return this.graph.getCellNode({row:t,col:r,sheetId:n})}},{key:"getGraphSheetNodes",value:function(e){return this.graph.getGraphSheetNodes(e)}},{key:"getGraphMap",value:function(){return this.graph.getGraphMap()}},{key:"deleteGraphSheetNodes",value:function(e){this.graph.deleteGraphSheetNodes(e)}},{key:"updateGraphNodeProperties",value:function(e,t){Object.assign(e,t)}},{key:"updateGraphMap",value:function(e,t){this.graph.updateGraphMap(e,t)}},{key:"deleteGraphNode",value:function(e){var t=this;this.graph.getIn(e).forEach((function(r){t.removeDependencyRelationship(r,e)})),this.resetGraphNodeDependency(e),this.clearSingleGraphNode(e),this.deleteNodeInMap(e)}},{key:"analyseReferencesAndGenerateDependencies",value:function(e){var t=this,r=e.sheetInfo,n=e.graphNode,o=e.referenceNodeType,a=e.reference,i=a.startSheetId,u=a.endSheetId;this.getSheetIds({startSheetId:i,endSheetId:u},n.sheetId).forEach((function(e){a.startSheetId=e,a.endSheetId=e;var i=t.externalMethods.isSheetLoaded(e),u=t.generateReferenceNodeByReference({reference:a,currentSheetId:e,referenceNodeType:o,sheetInfo:r,isSheetLoaded:i});u.markType===s.d.UNLOAD&&t.updateNodeMarkType(n,s.d.UNLOAD),t.buildDependencyRelationship(n,u)}))}},{key:"addAlwaysChangedNodes",value:function(e){var t=e.row,r=e.col,n=e.sheetId,o=this.getGraphCellNode({row:t,col:r,sheetId:n});o&&this.alwaysChangedNodes.add(o)}},{key:"clearAlwaysCalculateNodes",value:function(){this.alwaysChangedNodes.clear()}},{key:"getSheetRanges",value:function(){return this.graphSheetRanges}},{key:"deleteNodeInMap",value:function(e){var t=e.sheetId,r=e.startRow,n=e.startCol,o=e.endRow,a=e.endCol,s=e.endSheetId,u=e.customType;if(Object(i.h)(e.type))this.graph.deleteCell(t,r,n);else if(Object(i.p)(e.type)){var l=Object(i.b)({startRow:r,startCol:n,endRow:o,endCol:a,startSheetId:t,endSheetId:s},e.type);delete this.graphSheetRanges[l]}else{var c=Object(i.a)({startRow:r,startCol:n,endRow:o,endCol:a,startSheetId:t,endSheetId:t},e.type,u);this.graph.deleteVirtualNode(t,c)}}},{key:"addDependency",value:function(e,t,r){var n=e.row,o=e.col,a=e.sheetId,i=this.getOrGenerateGraphNode({startRow:n,startCol:o,endRow:n,endCol:o,startSheetId:a,endSheetId:a},s.c.CELL),u=this.getGraphNode(t,r);if(u&&this.graph.isNodeInTargetNodeOut(u,i))return!1;var l=t.startSheetId===t.endSheetId,c=t.endSheetId!==a;return l&&!c&&(t.startSheetId="",t.endSheetId=""),this.dealWithRefByRefType({graphNode:i,sheetInfo:{},reference:t,referenceNodeType:r}),u||(u=this.getGraphNode(t,r)),u&&this.graph.isNodeInTargetNodeOut(u,i)}},{key:"getOrGenerateGraphNode",value:function(e,t,r){var n=this.getGraphNode(e,t,r);return n||(n=this.addNode(e,t,r)),n}},{key:"analyseFormulaModelAndGenerateDependency",value:function(e){var t=this,r=e.sheetInfo,n=e.graphNode,o=e.changedFormulaNode,a=e.isReferencedStaticRange,s=e.afterAnalyseDependencyCallback;o.formulaModel.getAllCellRangeWithFixedInfo().forEach((function(e){var i=e.isPositionRely,u=t.getReferenceByCellRangeWithFixedInfo(e,o),l=t.analyseGraphNodeType(u,{isPositionRely:i,isStaticRange:a});t.dealWithRefByRefType({graphNode:n,sheetInfo:r,reference:u,referenceNodeType:l}),s&&s(e)}))}},{key:"getGraphVirtualNode",value:function(e,t,r){var n=Object(i.a)(e,t,r);return this.graph.getGraphVirtualNode(n,e.startSheetId)}},{key:"analyseGraphNodeType",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.startSheetId,n=e.endSheetId,o=Object(i.d)(r,n);if(t.isPositionRely)return s.c.POSITION_RELY;if(o||t.isStaticRange)return s.c.STATIC_RANGE;var a=Object(i.s)(e);return a?s.c.CELL:s.c.CELL_RANGE}},{key:"getReferencedCellNode",value:function(e,t){var r,n=f(this.graph.getIn(e).values());try{for(n.s();!(r=n.n()).done;){var o=r.value,a=!1;if(a=Object(i.r)(o.type)?t(o):this.getReferencedCellNode(o,t))return a}}catch(s){n.e(s)}finally{n.f()}return!1}},{key:"getDependencyCellNode",value:function(e,t){var r,n=f(this.graph.getOut(e).values());try{for(n.s();!(r=n.n()).done;){var o=r.value,a=!1;if(a=Object(i.r)(o.type)?t(o):this.getDependencyCellNode(o,t))return a}}catch(s){n.e(s)}finally{n.f()}return!1}},{key:"buildDependencyRelationship",value:function(e,t){this.graph.setEdge(e,t)}},{key:"removeDependencyRelationship",value:function(e,t){this.graph.removeEdge(e,t)}},{key:"getReferencedNodesByTargetNode",value:function(e){return this.graph.getIn(e)}},{key:"getDependencyNodesByTargetNode",value:function(e){return this.graph.getOut(e)}},{key:"toJson",value:function(){var e=this.graph.toJson(),t=[];return Object.values(this.graphSheetRanges).forEach((function(r){e.edges+=r.referenced.size,t.push(r)})),d(d({},e),{},{graphSheetRanges:t})}},{key:"generateReferenceNodeByReference",value:function(e){var t=e.reference,r=e.currentSheetId,n=e.referenceNodeType,o=e.sheetInfo,a=e.isSheetLoaded,u=this.getGraphNode(t,n);this.generateSheetInfo(o,r),u||(u=this.addNode(t,n)),a?Object(i.h)(u.type)||this.updateNodeMarkType(u,s.d.LOADED):this.updateNodeMarkType(u,s.d.UNLOAD);var l=u,c=l.startRow,d=l.endRow,f=l.startCol,h=(d-c+1)*(l.endCol-f+1),m=this.externalMethods.isSheetInitialized(r),p=h<700||m,v=this.graph.getOutSize(u);return a&&p&&0===v?this.generateGraphVirtualNodeDependency(u,o):0!==v||Object(i.h)(u.type)||(this.unGenerateDependencyVirtualNodes[r]=this.unGenerateDependencyVirtualNodes[r]||new Set,this.unGenerateDependencyVirtualNodes[r].add(u)),u}},{key:"getTopSortNodes",value:function(e){var t=this,r=[],n=[];return e.forEach((function(e){if(e.markType===s.d.DYE){n.push(e);for(var o=!1,a=function(){var e=n[n.length-1];e.startRow,e.startCol,e.sheetId,e.customType;t.updateNodeMarkType(e,s.d.SEARCH),t.getDependencyCellNode(e,(function(r){var a=r.markType;r.customType,r.type;return a===s.d.SEARCH?(console.error("\u6709\u73af"),o=!0,t.updateNodeMarkType(e,s.d.CYCLE),!1):a===s.d.DYE&&(n.push(r),!0)}));var a=e===n[n.length-1],u=e.markType!==s.d.LOADED;if(a&&u){n.pop();var l=Object(i.r)(e.type);if(t.updateNodeMarkType(e,s.d.LOADED),!l)return"continue";o&&t.updateNodeMarkType(e,s.d.CYCLE),r.push(e)}};n.length;)a()}})),r}},{key:"getVertexNodesAndDyeGraphByChangedNodes",value:function(e){var t=this,r=new Set;return e.forEach((function(e){var n=e.row,o=e.col,a=e.sheetId,s=t.getGraphCellNode({row:n,col:o,sheetId:a});if(s){var i=t.getNeedDyeNodesByGraphNode(s);t.markNeedReCalculateGraphNodes(r,i)}})),r}},{key:"getVertexNodesAndDyeGraphBySheetIds",value:function(e){var t=this,r=new Set;return this.alwaysChangedNodes.forEach((function(e){t.markNeedReCalculateGraphNodes(r,[e])})),e.forEach((function(e){var n=t.graph.getGraphSheetNodes(e);if(n){t.markGraphFormulaCellNode(r,n.graphCells);var o=t.unGenerateDependencyVirtualNodes[e];o&&t.markNeedReCalculateGraphNodes(r,Array.from(o))}})),r}},{key:"getVertexNodesAndDyeGraphByGraphNodes",value:function(e){var t=this,r=new Set;return e.forEach((function(e){var n=t.getNeedDyeNodesByGraphNode(e);t.markNeedReCalculateGraphNodes(r,n)})),r}},{key:"markGraphFormulaCellNode",value:function(e,t){var r=this;t.forEach((function(t){return t.forEach((function(t){var n=r.getNeedDyeNodesByGraphNode(t);r.markNeedReCalculateGraphNodes(e,n)}))}))}},{key:"getNeedDyeNodesByGraphNode",value:function(e){var t=e.customType,r=Object(i.j)(t),n=[];return r?this.getReferencedCellNode(e,(function(e){return n.push(e),!1})):n=[e],n}},{key:"markNeedReCalculateGraphNodes",value:function(e,t){for(var r=0;r<t.length;r++){var n=t[r],o=n.markType;n.sheetId;if(o!==s.d.DYE){var a=t[t.length-1];this.markDyeNodes(n,t),a===t[t.length-1]&&Object(i.r)(n.type)&&n.markType===s.d.DYE&&(!0,e.add(n))}}}},{key:"markReferencedNodeLoadStatus",value:function(e){for(var t=this,r=function(r){var n=e[r],o=n.markType,a=o;t.graph.getIn(n).forEach((function(r){if(!Object(i.h)(r.type)||r.markType!==a){if(o===s.d.LOADED&&r.markType===s.d.UNLOAD){if(!t.checkDependencyNodeIsLoaded(r))return;t.updateNodeMarkType(r,s.d.LOADED)}else o===s.d.UNLOAD&&r.markType===s.d.LOADED&&t.updateNodeMarkType(r,s.d.UNLOAD);e.push(r)}}))},n=0;n<e.length;n++)r(n)}},{key:"markDyeNodes",value:function(e,t){e.markType!==s.d.UNLOAD&&(Object(i.r)(e.type)&&this.updateNodeMarkType(e,s.d.DYE),this.getReferencedCellNode(e,(function(e){return e.markType!==s.d.LOADED&&e.markType!==s.d.CYCLE||t.push(e),!1})))}},{key:"checkDependencyNodeIsLoaded",value:function(e){var t=!0;return this.graph.getOut(e).forEach((function(e){t&&e.markType===s.d.UNLOAD&&(t=!1)})),t}},{key:"getReferenceByCellRangeWithFixedInfo",value:function(e,t){var r=t.row,n=t.col,o=(t.sheetId,e.startRowIndex),a=e.endRowIndex,s=e.startColIndex,i=e.endColIndex,l=e.isStartRowRelative,c=e.isStartColRelative,d=e.isEndRowRelative,f=e.isEndColRelative,h=e.startSheetId,m=e.endSheetId,p=(e.isPositionRely,e.isRowArray),v=e.isColArray,g=l?r+o:o,y=d?r+a:a,_=c?n+s:s,b=f?n+i:i;return p?(_=-1,b=u.d):v&&(g=-1,y=u.d),{startRow:g,endRow:y,startCol:_,endCol:b,startSheetId:h,endSheetId:m}}},{key:"dealWithRefByRefType",value:function(e){var t=e.graphNode,r=e.sheetInfo,n=e.reference,o=e.referenceNodeType;if(Object(i.n)(o)){n.startSheetId=n.startSheetId||t.sheetId,n.endSheetId=n.endSheetId||t.sheetId;var a=this.getOrGenerateGraphNode(n,s.c.POSITION_RELY);this.buildDependencyRelationship(t,a)}else{var u=this.dealWithCrossSheetNodeAndGetParentNode({reference:n,graphNode:t});if(!u)return;this.analyseReferencesAndGenerateDependencies({sheetInfo:r,graphNode:u,referenceNodeType:o,reference:n}),u.markType===s.d.UNLOAD&&u!==t&&this.updateNodeMarkType(t,s.d.UNLOAD)}}},{key:"dealWithCrossSheetNodeAndGetParentNode",value:function(e){var t=e.reference,r=e.graphNode,n=t.startSheetId,o=t.endSheetId;if(!Object(i.c)(n,o))return r;var a=this.externalMethods.getSheetIndexBySheetId(n),u=this.externalMethods.getSheetIndexBySheetId(o);if(!(a>=0&&u>=0))return null;if(!Object(i.d)(n,o))return r;var l=this.getOrGenerateGraphNode(t,s.c.SHEET_RANGE);return this.buildDependencyRelationship(r,l),l}},{key:"generateGraphVirtualNodeDependency",value:function(e,t){if(Object(i.o)(e.type)&&!Object(i.n)(e.type)){this.externalMethods.isSheetInitialized(e.sheetId);for(var r=!1,n=e.sheetId,o=this.externalMethods.isSheetLoaded(n),a=this.getGraphVirtualNodeRealRefArea(t,e,o),u=a.startRow,l=a.startCol,c=a.endRow,d=a.endCol,f=u;f<=c;f++)for(var h=l;h<=d;h++){var m,p={startRow:f,endRow:f,startCol:h,endCol:h,startSheetId:n,endSheetId:n},v=this.getGraphCellNode({row:p.startRow,col:p.startCol,sheetId:p.startSheetId});v||(v=this.addNode(p,s.c.CELL)),v&&!this.graph.hasEdge(e,v)&&this.buildDependencyRelationship(e,v),r||(null===(m=v)||void 0===m?void 0:m.markType)!==s.d.UNLOAD||(r=!0,this.updateNodeMarkType(e,s.d.UNLOAD))}}}},{key:"getGraphVirtualNodeRealRefArea",value:function(e,t,r){var n=t.sheetId,o=t.startRow,a=t.startCol,s=t.endRow,i=t.endCol;this.generateSheetInfo(e,n);var u=e[n],l=u.countRows,c=u.countCols;return r&&(o>=l||a>=c)?{startRow:-1,startCol:-1,endRow:-2,endCol:-2}:{startRow:o=o>=0?o:0,startCol:a=a>=0?a:0,endRow:s=s>=l?l:s,endCol:i=i>=c?c:i}}},{key:"clearSingleGraphNode",value:function(e){var t=this.graph.getInSize(e),r=this.graph.getOutSize(e);t<=0&&r<=0&&this.deleteNodeInMap(e)}},{key:"addNode",value:function(e,t,r){var n=e.startSheetId,o=e.endSheetId,a=e.startRow,u=e.startCol,l=e.endRow,c=e.endCol,d={startRow:a,endRow:l,startCol:u,endCol:c,sheetId:n,markType:s.d.LOADED,referenced:new Set,dependency:new Set,type:t};if(r&&(d.customType=r),Object(i.h)(t))!r&&(d.customType=s.a.CONST),this.graph.addCellNode(d);else if(Object(i.p)(t)){d.endSheetId=o;var f=Object(i.b)({startRow:a,endRow:l,startCol:u,endCol:c,startSheetId:n,endSheetId:o},t);this.graphSheetRanges[f]=d}else{var h=Object(i.a)({startRow:a,endRow:l,startCol:u,endCol:c,startSheetId:n,endSheetId:o},t,r);this.graph.addGraphVirtualNode(h,d)}return d}},{key:"getGraphNode",value:function(e,t,r){return Object(i.h)(t)?this.getGraphCellNode({row:e.startRow,col:e.startCol,sheetId:e.startSheetId}):Object(i.p)(t)?this.getGraphSheetRangeNode(e,t):this.getGraphVirtualNode(e,t,r)}},{key:"getGraphSheetRangeNode",value:function(e,t){var r=Object(i.b)(e,t);return this.graphSheetRanges[r]||null}},{key:"updateNodeMarkType",value:function(e,t){e.markType=t}},{key:"generateSheetInfo",value:function(e,t){e[t]||(e[t]={countRows:this.externalMethods.countRows(t),countCols:this.externalMethods.countCols(t)})}},{key:"getSheetIds",value:function(e,t){var r=e.startSheetId,n=e.endSheetId;return Object(i.c)(r,n)?r===n?[r]:this.externalMethods.getSheetIdsAmongTwoSheets(r,n):[t]}}]),e}();t.a=m},"./src/core/feature/formula/formula-graph/updateGraphService.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.from.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.object.values.js"),r("../node_modules/core-js/modules/es.set.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/esnext.set.add-all.js"),r("../node_modules/core-js/modules/esnext.set.delete-all.js"),r("../node_modules/core-js/modules/esnext.set.difference.js"),r("../node_modules/core-js/modules/esnext.set.every.js"),r("../node_modules/core-js/modules/esnext.set.filter.js"),r("../node_modules/core-js/modules/esnext.set.find.js"),r("../node_modules/core-js/modules/esnext.set.intersection.js"),r("../node_modules/core-js/modules/esnext.set.is-disjoint-from.js"),r("../node_modules/core-js/modules/esnext.set.is-subset-of.js"),r("../node_modules/core-js/modules/esnext.set.is-superset-of.js"),r("../node_modules/core-js/modules/esnext.set.join.js"),r("../node_modules/core-js/modules/esnext.set.map.js"),r("../node_modules/core-js/modules/esnext.set.reduce.js"),r("../node_modules/core-js/modules/esnext.set.some.js"),r("../node_modules/core-js/modules/esnext.set.symmetric-difference.js"),r("../node_modules/core-js/modules/esnext.set.union.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=r("./src/core/feature/formula/type.ts"),i=r("../packages/mutation/src/MutationId.ts"),u=r("./src/core/feature/formula/formula-graph/utils.ts"),l=function(){function e(t,r){var n=this;Object(o.a)(this,e),this.moveGraphVirtualNodeAfterRowColAdd=function(e){var t=e.isRow,r=e.graphVirtualNodes,o=e.insertStartNum,a=e.insertEndNum,s=[],i={};return Object.values(r).forEach((function(e){var r=e.startRow,l=e.endRow,c=e.startCol,d=e.endCol,f=e.sheetId,h=e.type,m=e.customType,p=Object(u.l)(m),v=t?r:c,g=v>=o,y=v<o&&(t?l:d)>=o,_=Object(u.n)(h);if(Object(u.q)(h))s.push(e);else if(p){if(g){var b=a-o+1;n.moveNode(b,b,e,t),_&&s.push(e)}else if(y){var A=a-o+1;n.moveNode(0,A,e,t),!_&&s.push(e)}}else;var E=Object(u.a)({startRow:e.startRow,endRow:e.endRow,startCol:e.startCol,endCol:e.endCol,startSheetId:f,endSheetId:f},h,m);i[E]=e})),{changedGraphVirtualNodes:s,newGraphVirtualNodes:i,delGraphVirtualNodes:[]}},this.moveGraphVirtualNodeAfterRowColDel=function(e){var t=e.isRow,r=e.graphVirtualNodes,o=e.deleteStartNum,a=e.deleteEndNum,s=[],i=[],l={};return Object.values(r).forEach((function(e){var r=e.startRow,c=e.endRow,d=e.startCol,f=e.endCol,h=e.sheetId,m=e.type,p=e.customType,v=Object(u.l)(p),g=t?r:d,y=t?c:f,_=Object(u.q)(m),b=g>a,A=g>=o&&y<=a,E=g>=o&&g<=a,j=g<o&&y>a,R=y>=o&&y<=a,S=Object(u.n)(m);if(!A||_){if(_)s.push(e);else if(v){if(b){var C=a-o+1;n.moveNode(-C,-C,e,t),S&&s.push(e)}else if(E||j||R){var T=g-o,w=T>0?T:0,O=Math.min(y,a)-Math.max(g,o)+1+w;n.moveNode(-w,-O,e,t),s.push(e)}}else;var I=Object(u.a)({startRow:e.startRow,endRow:e.endRow,startCol:e.startCol,endCol:e.endCol,startSheetId:h,endSheetId:h},m,p);l[I]?n.dealWithSameRefCellRanges({graphVirtualNode:e,key:I,newGraphVirtualNodes:l,changedGraphVirtualNodes:s}):l[I]=e}else i.push(e)})),{changedGraphVirtualNodes:s,newGraphVirtualNodes:l,delGraphVirtualNodes:i}},this.formulaGraph=r,this.externalMethods=t}return Object(a.a)(e,[{key:"updateGraphAfterInsertDeleteDimension",value:function(e){var t=e.amount,r=e.index,n=e.sheetId,o=e.type,a=e.id===i.b.INSERT_DIMENSION_MUTATION,s=r,u=r+t-1,l=o.toLowerCase().indexOf("row")>-1,c=this.formulaGraph.getGraphSheetNodes(n);if(c){var d=this.getNewGraphMapAfterRowColAddDel({startNum:s,endNum:u,isRow:l,isAdd:a,sourceGraphSheetNodes:c}),f=d.graphCells,h=d.graphVirtualNodes,m=d.changedGraphVirtualNodes,p=d.delGraphNodes;return this.updateGraphMapAndReGenerateDependency({graphCells:f,graphVirtualNodes:h,changedGraphVirtualNodes:m,currentSheetId:n,delGraphNodes:p})}}},{key:"updateGraphAfterRowColMove",value:function(e){var t=e.row,r=e.column,n=-1!==t.to,o=n?t:r,a=o.from,s=a.startIndex,i=a.endIndex,u=o.destinationSheetId,l=o.sourceSheetId,c=o.to,d=this.formulaGraph.getGraphSheetNodes(l);if(d&&l===u){var f=this.getNewGraphMapAfterRowColMove({sourceGraphSheetNodes:d,isRow:n,sourceStartIndex:s,sourceEndIndex:i,destinationIndex:c}),h=f.graphCells,m=f.graphVirtualNodes,p=f.changedGraphVirtualNodes;return this.updateGraphMapAndReGenerateDependency({graphCells:h,graphVirtualNodes:m,changedGraphVirtualNodes:p,currentSheetId:l})}}},{key:"updateGraphAfterSheetMove",value:function(e){var t=e.originSheetIndex,r=e.targetSheetIndex,n=this.getChangedSheetRangeNodeAfterSheetMove(t,r);return this.regenerateGraphSheetRangeDependency(n),n}},{key:"updateGraphAfterSheetDelete",value:function(e){var t=this,r=e.sheetId,n=e.sheetIndex,o=this.moveSheetRangeAfterSheetDeleted(n,r),a=(this.formulaGraph.getGraphSheetNodes(r)||{}).graphCells,s=[];a&&a.forEach((function(e){e.forEach((function(e){s.push(e)}))}));var i=this.deleteNodeAndGetRecalculateNodes(s);return o.forEach((function(e){t.formulaGraph.getReferencedCellNode(e,(function(e){return i.add(e),!1}))})),this.regenerateGraphSheetRangeDependency(o),this.formulaGraph.deleteGraphSheetNodes(r),Array.from(i)}},{key:"updateGraphAfterSheetInsert",value:function(e){e.sheetId;var t=e.sheetIndex,r=this.getChangedSheetRangeNodeAfterSheetInserted(t);return this.regenerateGraphSheetRangeDependency(r),r}},{key:"moveSheetRangeAfterSheetDeleted",value:function(e,t){var r=this,n=this.formulaGraph.getSheetRanges(),o=[];return Object.keys(n).forEach((function(a){var i=n[a],l=i.startRow,c=i.startCol,d=i.endRow,f=i.endCol,h=i.endSheetId,m=i.sheetId,p=t===m||t===h,v=r.externalMethods.getSheetIndexBySheetId(m),g=r.externalMethods.getSheetIndexBySheetId(h);if(v<0&&(v=e),g<0&&(g=e),p){if(m===t){var y=v>g?-1:0;m=r.externalMethods.getSheetIdBySheetIndex(e+y)}else if(h===t){var _=v>=g?0:-1;h=r.externalMethods.getSheetIdBySheetIndex(e+_)}var b={startRow:l,startCol:c,endRow:d,endCol:f,sheetId:m,endSheetId:h};r.formulaGraph.updateGraphNodeProperties(i,b),delete n[a];var A=Object(u.b)({startRow:l,startCol:c,endRow:d,endCol:f,startSheetId:m,endSheetId:h},s.c.SHEET_RANGE);n[A]=i,o.push(i)}else{var E;if(v>g&&(v=(E=[g,v])[0],g=E[1]),!(v<=e&&g>=e))return;o.push(i)}})),o}},{key:"getChangedSheetRangeNodeAfterSheetInserted",value:function(e){var t=this,r=this.formulaGraph.getSheetRanges(),n=[];return Object.values(r).forEach((function(r){var o,a=r.sheetId,s=r.endSheetId;r.type;if(!Object(u.d)(a,s))return!1;var i=t.externalMethods.getSheetIndexBySheetId(a),l=t.externalMethods.getSheetIndexBySheetId(s);if(i>l&&(i=(o=[l,i])[0],l=o[1]),!(i<e&&l>e))return!1;n.push(r)})),n}},{key:"getChangedSheetRangeNodeAfterSheetMove",value:function(e,t){var r=this,n=this.formulaGraph.getSheetRanges(),o=[];return Object.values(n).forEach((function(n){var a,s=n.sheetId,i=n.endSheetId;n.type;if(!Object(u.d)(s,i))return!1;var l=r.externalMethods.getSheetIndexBySheetId(s),c=r.externalMethods.getSheetIndexBySheetId(i);l>c&&(l=(a=[c,l])[0],c=a[1]);var d=r.externalMethods.getSheetIdBySheetIndex(t);if(s===d||i===d)o.push(n);else{var f=l<=e&&c>e;t>e&&(f=l<e&&c>=e),f===(l<t&&c>t)||o.push(n)}})),o}},{key:"getNewGraphMapAfterRowColAddDel",value:function(e){var t=e.startNum,r=e.endNum,n=e.isRow,o=e.isAdd,a=e.sourceGraphSheetNodes,s=a.graphCells,i=a.graphVirtualNodes,u=this.moveGraphCellsAfterRowColAddDel({graphCells:s,isRow:n,insertStartNum:t,insertEndNum:r,isAdd:o}),l=u.newGraphCells,c=u.delGraphCells,d=(o?this.moveGraphVirtualNodeAfterRowColAdd:this.moveGraphVirtualNodeAfterRowColDel)({graphVirtualNodes:i,isRow:n,insertStartNum:t,insertEndNum:r,deleteStartNum:t,deleteEndNum:r}),f=d.changedGraphVirtualNodes,h=d.newGraphVirtualNodes,m=d.delGraphVirtualNodes;return Array.prototype.push.apply(c,m),{graphCells:l,graphVirtualNodes:h,changedGraphVirtualNodes:f,delGraphNodes:c}}},{key:"moveGraphCellsAfterRowColAddDel",value:function(e){var t=this,r=e.isRow,n=e.isAdd,o=e.graphCells,a=e.insertStartNum,s=e.insertEndNum,i=[],l=[],c=[];return o.forEach((function(e,o){r&&o<a?i[o]=e:e.forEach((function(e,d){if(!r&&d<a)return i[o]=i[o]||[],void(i[o][d]=e);if(n||(r?o:d)>s){var f=s-a+1,h=n?f:-f;t.moveNode(h,h,e,r),Object(u.n)(e.type)&&l.push(e);var m=e.startRow,p=e.startCol;return i[m]=i[m]||[],void(i[m][p]=e)}c.push(e)}))})),{newGraphCells:i,delGraphCells:c,changedGraphCells:l}}},{key:"getNewGraphMapAfterRowColMove",value:function(e){var t=e.sourceStartIndex,r=e.sourceEndIndex,n=e.destinationIndex,o=e.sourceGraphSheetNodes,a=e.isRow,s=o.graphCells,i=o.graphVirtualNodes,u=this.cutGraphCellToDestination({graphCells:s,isRow:a,sourceStartIndex:t,sourceEndIndex:r,destinationIndex:n}),l=this.cutGraphVirtualNodeToDestination({graphVirtualNodes:i,isRow:a,sourceStartIndex:t,sourceEndIndex:r,destinationIndex:n}),c=l.changedGraphVirtualNodes;return{graphCells:u,graphVirtualNodes:l.newGraphVirtualNodes,changedGraphVirtualNodes:c}}},{key:"cutGraphCellToDestination",value:function(e){var t=this,r=e.graphCells,n=e.isRow,o=e.sourceStartIndex,a=e.sourceEndIndex,s=e.destinationIndex;return r.forEach((function(e,i){if(n&&i>=o&&i<=a){r[i-o+s]=e;var u=s-o;return e.forEach((function(e){return t.moveNode(u,u,e,n)})),void(r[i]=[])}e.forEach((function(e,u){if(!n&&u>=o&&u<=a){var l=u-o+s;r[i][l]=e,t.formulaGraph.deleteNodeInMap(e);var c=s-o;t.moveNode(c,c,e,n)}else;}))})),r}},{key:"cutGraphVirtualNodeToDestination",value:function(e){var t=this,r=e.graphVirtualNodes,n=e.isRow,o=e.sourceStartIndex,a=e.sourceEndIndex,s=e.destinationIndex,i=[],l={};return Object.values(r).forEach((function(e){var r=e.startRow,c=e.endRow,d=e.startCol,f=e.endCol,h=e.sheetId,m=e.type,p=e.customType,v=!1,g=Object(u.q)(m),y=Object(u.l)(p),_=Object(u.n)(m),b=n?r:d,A=n?c:f,E=o<=b&&a>=b,j=o<=A&&a>=A,R=o<=b&&a>=A;if(g)i.push(e);else if(y){if(R){var S=s-o;t.moveNode(S,S,e,n),_&&i.push(e),v=!0}else if(E||j){var C=s-o,T=E?C:0,w=j?C:0;t.moveNode(T,w,e,n),0===T&&_||(i.push(e),v=!0)}}else;var O=Object(u.a)({startRow:e.startRow,endRow:e.endRow,startCol:e.startCol,endCol:e.endCol,startSheetId:h,endSheetId:h},m,p);l[O]?v&&(l[O]=e):l[O]=e})),{changedGraphVirtualNodes:i,newGraphVirtualNodes:l}}},{key:"moveNode",value:function(e,t,r,n){var o=r.startRow,a=r.endRow,s=r.startCol,i=r.endCol,u=n?o+e:o,l=n?a+t:a,c=n?s:s+e,d=n?i:i+t;if(u>l){var f=[l,u];u=f[0],l=f[1]}if(c>d){var h=[d,c];c=h[0],d=h[1]}var m={startRow:u,endRow:l,startCol:c,endCol:d};this.formulaGraph.updateGraphNodeProperties(r,m)}},{key:"dealWithSameRefCellRanges",value:function(e){var t=this,r=e.graphVirtualNode,n=e.key,o=e.newGraphVirtualNodes,a=e.changedGraphVirtualNodes,s=o[n],i=a.indexOf(r);-1===i&&(i=a.indexOf(s)),a[i]=s,a.push(r),this.formulaGraph.getReferencedNodesByTargetNode(r).forEach((function(e){t.formulaGraph.removeDependencyRelationship(e,r),t.formulaGraph.buildDependencyRelationship(e,s)})),this.formulaGraph.updateGraphNodeProperties(r,{startRow:-1,endRow:-1,startCol:-1,endCol:-1})}},{key:"updateGraphMapAndReGenerateDependency",value:function(e){var t=e.graphCells,r=e.graphVirtualNodes,n=e.changedGraphVirtualNodes,o=e.currentSheetId,a=e.delGraphNodes,s=this.deleteNodeAndGetRecalculateNodes(a);return this.formulaGraph.updateGraphMap({graphCells:t,graphVirtualNodes:r},o),this.generateGraphVirtualNodeDependency({changedGraphVirtualNodes:n,currentSheetId:o}),Array.prototype.push.apply(n,Array.from(s)),n}},{key:"deleteNodeAndGetRecalculateNodes",value:function(e){var t=this,r=new Set;return null===e||void 0===e||e.forEach((function(e){t.formulaGraph.getReferencedCellNode(e,(function(e){return r.add(e),!1})),t.formulaGraph.deleteGraphNode(e)})),r}},{key:"regenerateGraphSheetRangeDependency",value:function(e){var t=this,r={};e.forEach((function(e){var n=e.sheetId,o=e.endSheetId,a={startSheetId:n,endSheetId:o,startRow:e.startRow,startCol:e.startCol,endRow:e.endRow,endCol:e.endCol},s=t.formulaGraph.analyseGraphNodeType(a);n===o?(t.formulaGraph.getReferencedNodesByTargetNode(e).forEach((function(e){return t.formulaGraph.analyseReferencesAndGenerateDependencies({sheetInfo:r,graphNode:e,referenceNodeType:s,reference:a}),!1})),t.formulaGraph.deleteGraphNode(e)):(t.formulaGraph.resetGraphNodeDependency(e),t.formulaGraph.analyseReferencesAndGenerateDependencies({sheetInfo:r,graphNode:e,referenceNodeType:s,reference:a}))}))}},{key:"generateGraphVirtualNodeDependency",value:function(e){var t=e.changedGraphVirtualNodes,r=e.currentSheetId,o=Object(n.a)({},r,{countRows:this.externalMethods.countRows(r),countCols:this.externalMethods.countCols(r)});this.formulaGraph.regenerateGraphVirtualNodeDependency(t,o)}}]),e}()},"./src/core/feature/formula/formula-graph/utils.ts":function(e,t,r){"use strict";r.d(t,"g",(function(){return o})),r.d(t,"e",(function(){return a})),r.d(t,"l",(function(){return s})),r.d(t,"f",(function(){return i})),r.d(t,"i",(function(){return u})),r.d(t,"m",(function(){return l})),r.d(t,"j",(function(){return c})),r.d(t,"h",(function(){return d})),r.d(t,"p",(function(){return f})),r.d(t,"k",(function(){return h})),r.d(t,"o",(function(){return m})),r.d(t,"q",(function(){return p})),r.d(t,"n",(function(){return v})),r.d(t,"d",(function(){return g})),r.d(t,"c",(function(){return y})),r.d(t,"s",(function(){return _})),r.d(t,"r",(function(){return b})),r.d(t,"a",(function(){return A})),r.d(t,"b",(function(){return E}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.index-of.js");var n=r("./src/core/feature/formula/type.ts");function o(e){return!!e.formulaModel}function a(e,t){var r=e.row,n=e.col,o=t.startRow,a=t.startCol,s=t.endRow,i=t.endCol;return r>=o&&r<=s&&n>=a&&n<=i}function s(e){return!u(e)}function i(e){return!!e&&(function(e){return!!e&&e.indexOf("dv")>=0}(e)||function(e){return!!e&&e.indexOf("chart")>=0}(e)||u(e))}function u(e){return!!e&&e.indexOf("cond")>=0}function l(e){return e===n.a.FORMULA}function c(e){return e===n.a.CONST}function d(e){return e===n.c.CELL}function f(e){return e===n.c.SHEET_RANGE}function h(e){return e===n.c.CUSTOM_NODE}function m(e){return e===n.c.CELL_RANGE||e===n.c.STATIC_RANGE}function p(e){return e===n.c.STATIC_RANGE}function v(e){return e===n.c.POSITION_RELY}function g(e,t){return e!==t&&""!==e}function y(e,t){return!(!e||!t)}function _(e){var t=e.startRow,r=e.startCol,n=e.endRow,o=e.endCol;return t===n&&r===o}function b(e){return d(e)||h(e)}function A(e,t){var r=e.startRow,n=e.endRow,o=e.startCol,a=e.endCol,s=(e.startSheetId,e.endSheetId,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"");return"".concat(t,"@").concat(s,"@").concat(r,",").concat(n,",").concat(o,",").concat(a)}function E(e,t){var r=e.startRow,n=e.endRow,o=e.startCol,a=e.endCol,s=e.startSheetId,i=e.endSheetId;return"".concat(s,":").concat(i,"!").concat(r,",").concat(n,",").concat(o,",").concat(a)}},"./src/core/feature/formula/formula-model-service/updateFormulaModelService.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.array.reduce.js"),r("../node_modules/core-js/modules/es.object.values.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../packages/model/src/cell/CellDataDelta.ts"),s=r("../packages/model/src/cell/CellDataSlot.ts"),i=r("../packages/mutation/src/MutationId.ts"),u=r("./src/core/feature/formula/utils.ts"),l=r("../packages/mutation/src/cell/SetCellPropertiesMutation.ts"),c=r("../packages/model/src/range/GridRange.ts"),d=function(){function e(t){var r=this;Object(n.a)(this,e),this.updateFormulaModelAfterRowColCutMove=function(e,t){var r,n=t.migrationMap,o=t.sourceStartIndex,a=t.sourceEndIndex,s=t.destinationIndex,i=t.sourceSheetId,l=t.isRow,c=t.row,d=t.col,f=t.nodeSheetId,h=!1,m=l?c:d,p=f===i&&(null===(r=n[m])||void 0===r?void 0:r.num),v="number"===typeof p?p:m;return e.setParts(e.getParts().map((function(e){var t;if("string"===typeof e)return e;var r=e.isCrossSheetReference,n=e.isStartRowRelative,c=e.isStartColRelative,d=e.isEndRowRelative,f=e.isEndColRelative,p=e.isCellRangeReferenceCorrect,g=e.isThreeDimensionalReference,y=e.startSheetId;if(!p)return e;var _=l?"startRowIndex":"startColIndex",b=l?"endRowIndex":"endColIndex",A=l?n:c,E=l?d:f,j=e[_],R=e[b],S=Object(u.o)(j,m,A),C=Object(u.o)(R,m,E),T=o<=S&&a>=S,w=o<=C&&a>=C;if(g);else if(r&&i!==y);else if(o<=S&&a>=C){var O=s-o;S+=O,C+=O,h=!0}else if(T||w){var I=s-o;S+=T?I:0,C+=w?I:0,h=!0}return v!==m&&(h=!0),e[_]=A?S-v:S,e[b]=E?C-v:C,e[_]>e[b]&&(t=[e[b],e[_]],e[_]=t[0],e[b]=t[1]),e}))),h},this.updateFormulaModelAfterRowColAdd=function(e,t){var n=t.mutationSheetId,o=t.index,a=t.amount,s=t.isRow,i=t.row,u=t.col,l=t.nodeSheetId,c=!1,d=l===n,f=s?i:u,h=d&&f>=o;return e.setParts(e.getParts().map((function(e){if("string"===typeof e)return e;var t=e.isCrossSheetReference,i=e.isRowArray,u=e.isColArray;if(!e.isCellRangeReferenceCorrect)return e;var m=!1,p=s?u:i;if(t){if(e.isThreeDimensionalReference){var v=r.externalMethods.isSheetAmongTwoSheets(n,e.startSheetId,e.endSheetId);if(!h&&!v)return e;m=!0}else if(d)m=e.startSheetId!==n;else if(e.startSheetId!==n)return e}else if(l!==n)return e;if(p)return e;var g=s?"startRowIndex":"startColIndex",y=s?"endRowIndex":"endColIndex",_=e[g],b=e[y];return function(e){var t=s?e.isStartRowRelative:e.isStartColRelative,r=s?e.isEndRowRelative:e.isEndColRelative;t?h!==(!m&&_+f>=o)&&(e[g]=_+(h?-a:a),c=!0):!m&&_>=o&&(e[g]=_+a,c=!0),r?h!==(!m&&b+f>=o)&&(e[y]=b+(h?-a:a),c=!0):!m&&b>=o&&(e[y]=b+a,c=!0)}(e),e}))),c},this.updateFormulaModelAfterRowColDel=function(e,t){var n=t.mutationSheetId,o=t.index,a=t.amount,s=t.isRow,i=t.row,u=t.col,l=t.nodeSheetId,c=!1,d=l===n,f=s?i:u,h=d&&f>=o;return e.setParts(e.getParts().reduce((function(e,t){if("string"===typeof t)return e.push(t),e;var i=t.isCrossSheetReference,u=t.isRowArray,m=t.isColArray;if(!t.isCellRangeReferenceCorrect)return e.push(t),e;var p=!1,v=s?m:u;if(i){if(t.isThreeDimensionalReference){var g=r.externalMethods.isSheetAmongTwoSheets(n,t.startSheetId,t.endSheetId);if(!h&&!g)return e.push(t),e;p=!0}else if(d)p=t.startSheetId!==n;else if(t.startSheetId!==n)return e.push(t),e}else if(l!==n)return e.push(t),e;if(v)return e.push(t),e;var y="startColIndex",_="endColIndex",b=t.isStartColRelative,A=t.isEndColRelative,E=t.getAbsoluteStartCol(f),j=t.getAbsoluteEndCol(f);s&&(y="startRowIndex",_="endRowIndex",b=t.isStartRowRelative,A=t.isEndRowRelative,E=t.getAbsoluteStartRow(f),j=t.getAbsoluteEndRow(f));var R=!p&&E>=o&&E<o+a,S=!p&&j>=o&&j<o+a;if((S||R)&&(c=!0),!p&&R&&S)return function(t){var r=e.length-1;return c=!0,i?(t.isCellRangeReferenceCorrect=!1,e.push(t)):"string"===typeof e[r]?e[r]=e[r].concat("#REF!"):e.push("#REF!"),e}(t);return function(e){var t=R?o+a:E,r=S?o-1:j,n=b?t-f:t,s=A?r-f:r;e[y]=n,e[_]=s,b?h!==(!p&&t>=o)&&(e[y]=n-(h?-a:a),c=!0):!p&&t>=o&&(e[y]=n-a,c=!0),A?h!==(!p&&r>=o)&&(e[_]=s-(h?-a:a),c=!0):!p&&r>=o&&(e[_]=s-a,c=!0)}(t),e.push(t),e}),[])),c},this.externalMethods=t}return Object(o.a)(e,[{key:"getInvertMutationsForDeleteDimensionMutation",value:function(e,t){var r=e.amount,n=e.index,o=e.sheetId,a=e.type.toLowerCase().indexOf("row")>-1;t||(t=this.getAllFormulaNodes());var s=t.filter((function(e){var t=e.formulaModel,s=e.sheetId,i=e.row,u=e.col;return t.isAffectedByRowColDel({index:n,amount:r,isRow:a,sheetId:o,nodeSheetId:s,row:i,col:u})}));return this.getInvertMutationsFromFormulaNodes(s)}},{key:"getInvertMutationsForRowReorderMutation",value:function(e,t){var r=e.operation.rules,n=e.sheetId,o=this.getMigrationMapForRowReorderFromRules({rules:r,sheetId:n});t||(t=this.getAllFormulaNodes());var a=t.reduce((function(e,t){var r=t.row,n=o[r];return Object(u.I)(n)||e.push(t),e}),[]);return this.getInvertMutationsFromFormulaNodes(a)}},{key:"updateFormulaModelAfterRowColAddDeleteMutation",value:function(e,t,r){var n=e.amount,o=e.index,a=e.sheetId,s=e.type.toLowerCase().indexOf("row")>-1,u=e.id===i.b.INSERT_DIMENSION_MUTATION,l=[],c=u?this.updateFormulaModelAfterRowColAdd:this.updateFormulaModelAfterRowColDel;return r||(r=this.getAllFormulaNodes()),r.forEach((function(e){var r=e.row,i=e.col,d=e.sheetId,f=e.formulaModel,h=r,m=i,p=r,v=i,g=u?1:-1;d!==a&&(g=0);var y=(s?r:i)>=o?g:0;t?s?h=r-y*n:m=i-y*n:s?p=r+y*n:v=i+y*n;var _=c(f,{mutationSheetId:a,index:o,amount:n,isRow:s,row:h,col:m,nodeSheetId:d}),b=h!==p||m!==v;b&&(e.row=p,e.col=v),(_||b)&&l.push(e)})),l}},{key:"updateFormulaModelAfterRowColCutMoveMutation",value:function(e,t){for(var r=this,n=e.row,o=e.column,a=-1!==n.to,s=a?n:o,i=s.from,l=i.startIndex,c=i.endIndex,d=s.destinationSheetId,f=s.sourceSheetId,h=s.to,m=[],p={},v=l,g=0;v<=c;v++,g++){var y=h+g;p[v]={num:y,destinationSheetId:d,sourceSheetId:f}}return t||(t=this.getAllFormulaNodes()),t.forEach((function(e){var t=e.row,n=e.col,o=e.sheetId,s=e.formulaModel,i=r.updateFormulaModelAfterRowColCutMove(s,{sourceStartIndex:l,sourceEndIndex:c,destinationIndex:h,migrationMap:p,isRow:a,row:t,col:n,nodeSheetId:o,sourceSheetId:f}),d=a?"row":"col",v=p[e[d]],g=o===f&&!Object(u.I)(v)&&e[d]!==v.num;g&&(e[d]=v.num),(i||g)&&m.push(e)})),m}},{key:"updateFormulaModelAfterReorderRangeMutation",value:function(e,t,r){var n=this,o=e.operation.rules,a=e.sheetId,s=e.range,i=s.startColIndex,l=s.endColIndex,c=[],d=-1,f=-1;r||(r=this.getAllFormulaNodes());var h=Object.values(o||{}).reduce((function(e,r){var n,o=r.from,s=r.to;return d=-1===d?o:Math.min(d,o),f=-1===f?o:Math.max(f,o),t&&(o=(n=[s,o])[0],s=n[1]),e[o]={num:s,destinationSheetId:a,sourceSheetId:a},e}),{});return r.forEach((function(e){var r=e.col,o=e.sheetId,s=e.formulaModel;if(o===a){var d=e.row,f=(h[d]||{}).num;if(t){var m=[f,d];d=m[0],f=m[1]}if(!(Object(u.I)(f)||r<i||r>l)){var p=n.updateFormulaModelAfterReorderRange(s,{row:d,newRow:f}),v=!t&&e.row!==f;v&&(e.row=f),(p||v)&&c.push(e)}}})),c}},{key:"updateFormulaModelAfterSheetDeletedMutation",value:function(e,t){var r=this,n=e.sheetId,o=e.originSheetIndex,a=[];return t||(t=this.getAllFormulaNodes()),t.forEach((function(e){var t=e.formulaModel;r.updateFormulaModelAfterSheetDeleted(t,{sheetId:n,originSheetIndex:o})&&a.push(e)})),a}},{key:"updateFormulaModelAfterSheetRenameMutation",value:function(e,t){var r=this,n=e.sheetId,o=(e.sheetName,[]);return t||(t=this.getAllFormulaNodes()),t.forEach((function(e){var t=e.formulaModel;r.updateFormulaModelAfterSheetRename(t,{sheetId:n})&&o.push(e)})),o}},{key:"updateFormulaModelAfterSheetRename",value:function(e,t){var r=t.sheetId,n=!1;return e.setParts(e.getParts().map((function(e){return"string"===typeof e?e:e.isCrossSheetReference?(e.isThreeDimensionalReference?(e.startSheetId===r||e.endSheetId===r)&&(n=!0):e.startSheetId===r&&(n=!0),e):e}))),n}},{key:"updateFormulaModelAfterSheetDeleted",value:function(e,t){var r=this,n=t.sheetId,o=t.originSheetIndex,a=!1;return e.setParts(e.getParts().map((function(e){if("string"===typeof e)return e;if(!e.isCrossSheetReference)return e;if(e.isThreeDimensionalReference){var t=r.externalMethods.getSheetIndexBySheetId(e.startSheetId),s=r.externalMethods.getSheetIndexBySheetId(e.endSheetId);if(t<0&&(t=o),s<0&&(s=o),e.startSheetId===n){var i=t>s?-1:0;e.startSheetId=r.externalMethods.getSheetIdBySheetIndex(o+i),a=!0}else if(e.endSheetId===n){var u=t>=s?0:-1;e.endSheetId=r.externalMethods.getSheetIdBySheetIndex(o+u),a=!0}}else e.startSheetId===n&&(e.startSheetId="#REF!",e.endSheetId="#REF!",a=!0);return e}))),a}},{key:"updateFormulaModelAfterReorderRange",value:function(e,t){var r=t.row,n=t.newRow,o=!1;return e.setParts(e.getParts().reduce((function(e,t){if("string"===typeof t)return e.push(t),e;var a=t.isCrossSheetReference,s=t.isColArray;if(!t.isCellRangeReferenceCorrect||s)return e.push(t),e;var i=a,u=t.isStartRowRelative,l=t.isEndRowRelative,c=t.startRowIndex,d=t.endRowIndex,f=r-n;if(function(e){u&&(i?(e.startRowIndex+=f,o=!0):c+n<0&&(e.startRowIndex=-n,o=!0))}(t),l)if(i)t.endRowIndex+=f,o=!0;else if(d+n<0){var h=e.length-1;return"string"===typeof e[h]?e[h]=e[h].concat("#REF!"):e.push("#REF!"),o=!0,e}return e.push(t),e}),[])),o}},{key:"getInvertMutationsFromFormulaNodes",value:function(e){return e.reduce((function(e,t){var r=t.row,n=t.col,o=t.sheetId,i=t.formulaModel.clone(),u=new a.a;u.setSlot(s.b.SLOT_FORMULA,i);var d=new l.a({gridRange:new c.b(o,r,r,n,n),cellDataDelta:u});return e.push(d),e}),[])}},{key:"getMigrationMapForRowReorderFromRules",value:function(e){var t=e.rules,r=e.sheetId;return Object.values(t||{}).reduce((function(e,t){var n=t.from,o=t.to;return e[n]={num:o,destinationSheetId:r,sourceSheetId:r},e}),{})}},{key:"getAllFormulaNodes",value:function(){var e=this,t=[];return this.externalMethods.getSheetIds().forEach((function(r){e.externalMethods.traverseCellDataBySheetId(r,(function(r){var n=r.row,o=r.col,a=r.sheetId,s=e.externalMethods.getFormulaModelByRowCol(n,o,a);s&&t.push({formulaModel:s.clone(),col:o,row:n,sheetId:a})}))})),t}}]),e}()},"./src/core/feature/formula/formula-result-cache-service/accuracy-report.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),s=r("../packages/report/src/index.ts"),i=r("./src/core/app/spreadsheet-app-worker.interface.ts"),u=function(e,t,r,n){var o,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(a.a)(Reflect))&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(s<3?o(i):s>3?o(t,r,i):o(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},l=function(e,t){return function(r,n){t(r,n,e)}},c=function(){function t(e){Object(n.a)(this,t),this.app=e,this.hasReportResultAccuracySheetMap={}}return Object(o.a)(t,[{key:"analyzeResultAccuracy",value:function(e){var t=this;e.sheets.map((function(e){return e.id})).forEach((function(r,n){if(!t.hasReportResultAccuracySheetMap[r]){var o=t.app.spreadsheet.sheetManager.getSheetBySheetId(r);if(o&&!1!==o.isLoaded){var a=e.sheets[n].cells;if(a&&0!==a.length){var s=!1,i=0;if(a.forEach((function(e){var r=e.row,n=e.col,a=e.value,u=o.getCellDataAtPosition(r,n);if(u){var l=u.getEffectiveValue();null!==l&&(s=!0,t.isEffectiveValueEqualToCacheValue(l,a)&&(i+=1))}})),s){var u=i/a.length;t.reportResultAccuracy(u,r,e.rev)}t.hasReportResultAccuracySheetMap[r]=!0}else t.hasReportResultAccuracySheetMap[r]=!0}else t.hasReportResultAccuracySheetMap[r]=!0}}))}},{key:"isEffectiveValueEqualToCacheValue",value:function(e,t){return e.value===t||"object"===Object(a.a)(e.value)&&"object"===Object(a.a)(t)&&e.value.type===t.type}},{key:"reportResultAccuracy",value:function(t,r,n){var o;t>=1?s.b.monitor(35421526):t>.9?s.b.monitor(35421527):t>.7?s.b.monitor(35421528):t>.5?s.b.monitor(35421529):s.b.monitor(35421530);var a={version:n,sheetId:r,accuracy:t};s.b.tdwReport({opername:"doc_excel",module:"formula_worker",action:"back_end_result_accuracy",ver5:JSON.stringify(a)}),null===(o=e.log)||void 0===o||o.log("\u4f7f\u7528\u540e\u53f0\u51fd\u6570\u7f13\u5b58\u51c6\u786e\u7387",a)}}]),t}();c=u([l(0,i.a)],c),t.a=c}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/feature/formula/formula-result-cache-service/commit-queue.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/regenerator-runtime/runtime.js");var n=r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),i=r("../node_modules/axios/index.js"),u=r.n(i),l=r("../packages/report/src/index.ts"),c=r("./src/core/app/spreadsheet-app-worker.interface.ts"),d=r("./src/core/worker/worker-thread/interfaces/cookie.interface.ts"),f=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(s.a)(Reflect))&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},h=function(e,t){return function(r,n){t(r,n,e)}},m=function(){function t(e,r){Object(o.a)(this,t),this.app=e,this.cookie=r,this.maxTaskLength=5,this.commitTimeout=1e4,this.task=[],this.isCommitting=!1}return Object(a.a)(t,[{key:"commit",value:function(t){var r;null===(r=e.log)||void 0===r||r.log("\u63d0\u4ea4\u51fd\u6570\u7f13\u5b58",{version:t.rev,sheets:t.sheets.map((function(e){return e.id}))}),this.addTask(t),this.runTask()}},{key:"addTask",value:function(e){this.task.length>0&&this.task[this.task.length-1].commitData.rev>e.rev||(this.task.length>=this.maxTaskLength&&this.task.shift(),this.task.push({commitData:e}))}},{key:"runTask",value:function(){if(!this.isCommitting){var e=this.task.shift();e&&(this.isCommitting=!0,this.commitToServer(e.commitData))}}},{key:"commitToServer",value:function(){var t=Object(n.a)(regeneratorRuntime.mark((function t(r){var n,o,a,s=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return null===(n=e.log)||void 0===n||n.log("\u5f00\u59cb\u63d0\u4ea4\u51fd\u6570\u7f13\u5b58\u5230\u540e\u53f0"),t.next=3,this.cookie.getXsrf();case 3:o=t.sent,a=this.app.spreadsheet.getSpreadsheetId(),u()({method:"post",url:"https://docs.qq.com/v1/dop-api/commitformula?padId=".concat(a,"&xsrf=").concat(o),data:r,timeout:this.commitTimeout}).then((function(t){var n,o;return 0===(null===(n=t.data)||void 0===n?void 0:n.retcode)?(l.b.monitor(35407658),null===(o=e.log)||void 0===o||o.log("\u63d0\u4ea4\u51fd\u6570\u7f13\u5b58\u5230\u540e\u53f0\u6210\u529f",{version:r.rev,sheets:r.sheets.map((function(e){return e.id}))}),void s.runNextTask()):Promise.reject("\u51fd\u6570\u7ed3\u679c\u63d0\u4ea4\u5931\u8d25")})).catch((function(t){var n,o;l.b.monitor(35407659),null===(n=e.log)||void 0===n||n.error("\u63d0\u4ea4\u51fd\u6570\u7f13\u5b58\u5230\u540e\u53f0\u5931\u8d25",t),null===(o=e.log)||void 0===o||o.log("\u63d0\u4ea4\u51fd\u6570\u7f13\u5b58\u5230\u540e\u53f0\u5931\u8d25",{version:r.rev,sheets:r.sheets.map((function(e){return e.id}))}),s.runNextTask()}));case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"runNextTask",value:function(){this.isCommitting=!1,this.runTask()}}]),t}();m=f([h(0,c.a),h(1,d.a)],m),t.a=m}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/feature/formula/formula-result-cache-service/commit.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js");var t,n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),s=r("./src/core/app/spreadsheet-app-worker.interface.ts"),i=r("./src/core/worker/worker-thread/interfaces/cookie.interface.ts"),u=r("./src/core/feature/formula/formula-result-cache-service/commit-queue.ts"),l=r("./src/core/feature/formula/formula-result-cache-service/accuracy-report.ts"),c=r("./src/core/feature/formula/formula-result-cache-service/get-commit-data.ts"),d=function(e,t,r,n){var o,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(a.a)(Reflect))&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(s<3?o(i):s>3?o(t,r,i):o(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},f=function(e,t){return function(r,n){t(r,n,e)}};!function(e){e[e.Commit=0]="Commit",e[e.Accept=1]="Accept"}(t||(t={}));var h=function(){function r(e,o){Object(n.a)(this,r),this.app=e,this.cookie=o,this.commitButNotAcceptTotal=0,this.afterNetworkStatus=t.Accept,this.commitData=null,this.commitQueue=new u.a(e,o),this.accuracyReport=new l.a(e),this.getCommitData=new c.a(e)}return Object(o.a)(r,[{key:"commit",value:function(e,t){this.commitData=this.getCommitData.get(e,t),this.accuracyReport.analyzeResultAccuracy(this.commitData),this.checkCanCommitToServer()&&this.commitToServer(this.commitData)}},{key:"addIgnoreVersion",value:function(e){void 0!==this.ignoreVersion?this.ignoreVersion<e&&(this.ignoreVersion=e):this.ignoreVersion=e}},{key:"changeToCommitStatus",value:function(e){this.afterNetworkStatus=t.Commit,this.commitButNotAcceptTotal+=1,this.commitData=null}},{key:"changeToAcceptStatus",value:function(e){this.afterNetworkStatus=t.Accept,this.commitButNotAcceptTotal-=1,this.checkCanCommitToServer()&&null!==this.commitData&&(this.commitData.rev=e,this.commitToServer(this.commitData),this.commitData=null)}},{key:"checkCanCommitToServer",value:function(){return this.afterNetworkStatus===t.Accept&&0===this.commitButNotAcceptTotal}},{key:"commitToServer",value:function(t){var r,n;this.ignoreVersion>=t.rev?null===(r=e.log)||void 0===r||r.log("\u63d0\u4ea4\u51fd\u6570\u7f13\u5b58","\u65e0\u6548\u63d0\u4ea4, \u8be5\u7248\u672c\u4e3a\u5ffd\u7565\u7248\u672c"):0!==t.sheets.length?this.commitQueue.commit(t):null===(n=e.log)||void 0===n||n.log("\u63d0\u4ea4\u51fd\u6570\u7f13\u5b58","\u65e0\u6548\u63d0\u4ea4, \u6ca1\u6709\u9700\u8981\u63d0\u4ea4\u7684\u5b50\u8868")}}]),r}();h=d([f(0,s.a),f(1,i.a)],h)}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/feature/formula/formula-result-cache-service/get-commit-data.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.includes.js"),r("../node_modules/core-js/modules/es.array.reduce.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.string.includes.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),s=r("../packages/model/src/cell/ExtendedValueType.ts"),i=r("./src/core/feature/formula/utils.ts"),u=r("./src/core/feature/formula/type.ts"),l=r("./src/core/app/spreadsheet-app-worker.interface.ts"),c=function(e,t,r,n){var o,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(a.a)(Reflect))&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(s<3?o(i):s>3?o(t,r,i):o(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},d=function(e,t){return function(r,n){t(r,n,e)}},f=function(){function e(t){var r=this;Object(n.a)(this,e),this.app=t,this.preCellsCountMap={},this.traverseCellDataBySheetId=function(e,t){var n=r.app.spreadsheet.sheetManager.getSheetBySheetId(e);if(n){var o=r.app.calcController.graph.getGraphMap()[e].graphCells;o&&o.forEach((function(e){e.forEach((function(e){if(e&&e.customType===u.a.FORMULA){var r=e.startRow,o=e.startCol,a=n.getCellDataAtPosition(r,o);a&&t({row:r,col:o,cellData:a})}}))}))}}}return Object(o.a)(e,[{key:"get",value:function(e,t){var r=this,n={dataRev:1,rev:e,sheets:[]},o=this.app.calcController.graph.getGraphMap(),a=Object.keys(o),s=this.app.calcController.graphUpdateTimes,i=a.reduce((function(e,t){return e[t]=[],e}),{});return a.forEach((function(e){void 0===r.preCellsCountMap[e]&&(r.preCellsCountMap[e]=0)})),a.forEach((function(e){r.traverseCellDataBySheetId(e,(function(t){var n=t.row,o=t.col,a=t.cellData,s=r.getCommitCell({row:n,col:o,cellData:a});s&&i[e].push(s)}))})),a.forEach((function(e){var o=r.getSheetGraphCellsCount(e);if(r.preCellsCountMap[e]!==o)return n.sheets.push({id:e,nochange:!1,cells:i[e]}),void(r.preCellsCountMap[e]=o);r.preGraphUpdateTime!==s&&t.includes(e)?0!==i[e].length&&n.sheets.push({id:e,nochange:!1,cells:i[e]}):n.sheets.push({id:e,nochange:!0})})),this.preGraphUpdateTime=s,n}},{key:"getCommitCell",value:function(e){var t,r,n=e.row,o=e.col,u=e.cellData;if(!(null===u||void 0===u?void 0:u.getFormula()))return null;var l=(null===u||void 0===u?void 0:u.getEditValue())||"";if(!l||/(STOCK|RAND|NOW|RANDBETWEEN)\(/.test(l))return null;var c=null===u||void 0===u?void 0:u.getEffectiveValue(),d=null===c||void 0===c?void 0:c.value,f=null===c||void 0===c?void 0:c.originValue,h=null===d||void 0===d?void 0:d.displayText,m=null===u||void 0===u||null===(t=u.getUserEnteredFormat())||void 0===t?void 0:t.getNumberFormat(),p=null===u||void 0===u||null===(r=u.getEffectiveFormat())||void 0===r?void 0:r.getNumberFormat(),v=f||d,g=i.c[Object(a.a)(v)];if(h&&(v={type:i.b[h],displayText:h,title:"\u9519\u8bef",message:i.a[h]},g=s.a.ERROR),"string"!==typeof v&&"number"!==typeof v&&"boolean"!==typeof v&&"object"!==Object(a.a)(v))return null;var y={row:n,col:o,type:g,value:v};if(p){var _=p.serialize();2===_.length&&(y.ef={id:_[0],pattern:_[1]})}if(m){var b=m.serialize();2===b.length&&(y.ef={id:b[0],pattern:b[1]})}return y}},{key:"getSheetGraphCellsCount",value:function(e){var t=this.app.calcController.graph.getGraphMap()[e].graphCells;return t?Object.keys(t).reduce((function(e,r){return e+t[r].filter((function(e){return!!e})).filter((function(e){return e.customType===u.a.FORMULA})).length}),0):0}}]),e}();f=c([d(0,l.a)],f),t.a=f},"./src/core/feature/formula/func-config.ts":function(e,t,r){"use strict";r.d(t,"j",(function(){return o})),r.d(t,"h",(function(){return a})),r.d(t,"k",(function(){return s})),r.d(t,"e",(function(){return i})),r.d(t,"i",(function(){return u})),r.d(t,"a",(function(){return l})),r.d(t,"c",(function(){return c})),r.d(t,"g",(function(){return d})),r.d(t,"b",(function(){return n})),r.d(t,"d",(function(){return f})),r.d(t,"f",(function(){return h}));var n,o={AND:!0,STOCK:!0,DAYS360:!0,DATEDIF:!0,E:!0,FALSE:!0,HLOOKUP:!0,IF:!0,INT:!0,ISEVEN:!0,ISODD:!0,ISNUMBER:!0,IFERROR:!0,ISNA:!0,ISERROR:!0,ISERR:!0,INDIRECT:!0,INDEX:!0,LOOKUP:!0,MATCH:!0,NOT:!0,OR:!0,TRUE:!0,VLOOKUP:!0,COUNTIF:!0,ASC:!0,CONCATENATE:!0,CONCAT:!0,TRIM:!0,VALUE:!0,SUBSTITUTE:!0,UPPER:!0,"WORKDAY.ORIGIN":!0,"WORKDAY.INTL":!0,FIXED:!0,PRODUCT:!0,REPT:!0,LOGICMATCH:!0,SPECIALMATCH:!0,EOMONTH:!0,EDATE:!0,IMSUB:!0,IMCONJUGATE:!0,COMPLEX:!0,SQRTPI:!0,FVSCHEDULE:!0,PROPER:!0,N:!0,EFFECT:!0,NOMINAL:!0,BIN2DEC:!0,BIN2OCT:!0,BIN2HEX:!0,OCT2BIN:!0,OCT2DEC:!0,OCT2HEX:!0,HEX2BIN:!0,HEX2OCT:!0,HEX2DEC:!0,DEC2BIN:!0,DEC2OCT:!0,DEC2HEX:!0,"ERF.ORIGIN":!0,"ERF.PRECISE":!0,"ERFC.PRECISE":!0,RANDBETWEEN:!0,CONVERT:!0,DELTA:!0,GESTEP:!0,LEN:!0},a={ID:!0,MID:!0,RIGHT:!0,LEFT:!0,SPECIALMATCH:!0,COUNTIF:!0,COUNTIFS:!0},s={ISERROR:!0,IFERROR:!0,ISERR:!0,ISNA:!0,IF:!0,COUNT:!0,COUNTA:!0,COUNTIF:!0,COUNTIFS:!0,CHOOSE:!0,ISNUMBER:!0,SUMIF:!0,SUMIFS:!0,ISBLANK:!0,COLUMN:!0,MATCH:!0,ISFORMULA:!0,ISREF:!0},i={VLOOKUP:!0,HLOOKUP:!0,LOOKUP:!0,ISNUMBER:!0,OR:!0,MATHMATCH:!0,LOGICMATCH:!0,AVERAGEA:!0,COUNTIFS:!0,MOD:!0,RANK:!0,"RANK.EQ":!0,"RANK.AVG":!0},u={IFERROR:!0,OFFSET:!0,VLOOKUP:!0,HLOOKUP:!0},l={ROW:!0,COLUMN:!0,N:!0},c={STOCK:!0},d={SUMPRODUCT:!0,LOOKUP:!0};!function(e){e.BOOL="BOOL",e.STRING="STRING",e.NUMBER="NUMBER",e.DATE="DATE",e.ARRAY="ARRAY",e.NOT_ARRAY="NOT_ARRAY",e.ANY="ANY"}(n||(n={}));var f={},h={SUM:{argumentsType:n.ANY,acceptRef:!0,min:1},IF:{argumentsType:[n.BOOL,n.NOT_ARRAY,n.NOT_ARRAY],min:2,max:3,acceptRef:!0},STOCK:{min:2,max:2},ID:{min:2,max:2},ROUND:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},AVERAGE:{argumentsType:n.ANY,min:1,max:255,acceptRef:!0},COUNTIF:{argumentsType:[n.ANY,n.STRING],min:2,max:2,acceptRef:!0},MID:{argumentsType:[n.STRING,n.NUMBER,n.NUMBER],min:3,max:3},MAX:{argumentsType:n.ANY,min:1,max:255,acceptRef:!0},COUNTA:{argumentsType:n.ANY,min:1,max:255,acceptRef:!0},DATEDIF:{argumentsType:[n.DATE,n.DATE,n.STRING],min:3,max:3},COUNTIFS:{argumentsType:[n.ANY,n.STRING,n.ANY,n.STRING,n.ANY,n.STRING,n.ANY,n.STRING],min:2},SUBTOTAL:{argumentsType:[n.NUMBER,n.ANY,n.ANY],min:2,acceptRef:!0},MIN:{argumentsType:n.ANY,min:1,max:255,acceptRef:!0},COUNT:{argumentsType:n.ANY,min:1,acceptRef:!0},SUMIF:{argumentsType:[n.ANY,n.STRING,n.ANY],min:2,max:3,acceptRef:!0},SUMIFS:{argumentsType:[n.ANY,n.ANY,n.STRING,n.ANY,n.STRING,n.ANY,n.STRING],min:3,max:254},TEXT:{argumentsType:[n.NOT_ARRAY,n.STRING],min:2,max:2},LEFT:{argumentsType:[n.STRING,n.NUMBER],min:1,max:2},RIGHT:{argumentsType:[n.STRING,n.NUMBER],min:1,max:2},YEAR:{argumentsType:[n.DATE],min:1,max:1},INT:{argumentsType:[n.NUMBER],min:1,max:1},MOD:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},DATE:{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER],min:3,max:3},NOW:{argumentsType:[n.ANY],min:0,max:0},ABS:{argumentsType:[n.NUMBER],min:1,max:1},MONTH:{argumentsType:[n.DATE],min:1,max:1},RAND:{argumentsType:[n.ANY],min:0,max:0},SQRT:{argumentsType:[n.NUMBER],min:1,max:1},DAY:{argumentsType:[n.DATE],min:1,max:1},LEN:{argumentsType:[n.STRING],min:1,max:1},WEEKDAY:{argumentsType:[n.DATE,n.NUMBER],min:1,max:2},OR:{argumentsType:[n.ANY],min:1,max:255},INDIRECT:{argumentsType:[n.STRING,n.BOOL],min:1,max:2,acceptRef:!0},AND:{argumentsType:[n.ANY],min:1,max:255},ROUNDUP:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},ROUNDDOWN:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},VLOOKUP:{argumentsType:[n.NOT_ARRAY,n.ANY,n.STRING,n.BOOL],min:3,max:4,acceptRef:!0},HLOOKUP:{argumentsType:[n.NOT_ARRAY,n.ANY,n.STRING,n.BOOL],min:3,max:4,acceptRef:!0},LOOKUP:{argumentsType:[n.NOT_ARRAY,n.ANY,n.ANY],min:2,max:3,acceptRef:!0},INDEX:{argumentsType:[n.ANY,n.NUMBER,n.NUMBER,n.NUMBER],min:2,max:4,acceptRef:!0},ISERROR:{argumentsType:[n.NOT_ARRAY],min:1,max:1},ISERR:{argumentsType:[n.NOT_ARRAY],min:1,max:1},FIND:{argumentsType:[n.STRING,n.STRING,n.NUMBER],min:2,max:3},SUMPRODUCT:{argumentsType:n.ANY,min:1,acceptRef:!0},ISNA:{argumentsType:[n.ANY],min:1,max:1},ISNUMBER:{argumentsType:[n.NOT_ARRAY],min:1,max:1},IFERROR:{argumentsType:[n.ANY,n.NOT_ARRAY],min:2,max:2},ROW:{argumentsType:[n.ANY],min:0,max:1,acceptRef:!0},TODAY:{argumentsType:[n.ANY],min:0,max:0},MATCH:{argumentsType:[n.NOT_ARRAY,n.ANY,n.ANY],min:2,max:3,acceptRef:!0},TRIM:{argumentsType:[n.STRING],min:1,max:1},CONCATENATE:{argumentsType:[n.ARRAY],min:1},CONCAT:{argumentsType:n.ANY,min:1},CHOOSE:{argumentsType:[n.NUMBER,n.ANY],min:2,max:255,acceptRef:!0},PRODUCT:{argumentsType:n.ANY,min:1,acceptRef:!0},SPECIALMATCH:{argumentsType:[n.ANY,n.ANY,n.STRING],min:3,max:3},MATHMATCH:{argumentsType:[n.NUMBER,n.NUMBER,n.STRING],min:3,max:3,acceptRef:!0},LOGICMATCH:{argumentsType:[n.NOT_ARRAY,n.NOT_ARRAY,n.STRING],min:3,max:3},SUBSTITUTE:{argumentsType:[n.STRING,n.STRING,n.STRING,n.NUMBER],min:3,max:4},TRUNC:{argumentsType:[n.NUMBER,n.NUMBER],min:1,max:2},OFFSET:{argumentsType:[n.ANY,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER],min:3,max:5,acceptRef:!0},VALUE:{argumentsType:[n.STRING],min:1,max:1},FIXED:{argumentsType:[n.NUMBER,n.NUMBER,n.BOOL],min:1,max:3},ISBLANK:{argumentsType:[n.NOT_ARRAY],min:1,max:1},ASC:{argumentsType:[n.STRING],min:1,max:1},UPPER:{argumentsType:[n.STRING],min:1,max:1},LN:{argumentsType:[n.NUMBER],min:1,max:1},"CEILING.ORIGIN":{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},"CEILING.MATH":{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER],min:1,max:3},"CEILING.PRECISE":{argumentsType:[n.NUMBER,n.NUMBER],min:1,max:2},"FLOOR.ORIGIN":{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},"FLOOR.MATH":{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER],min:1,max:3},"FLOOR.PRECISE":{argumentsType:[n.NUMBER,n.NUMBER],min:1,max:2},ADDRESS:{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER,n.BOOL,n.STRING],min:2,max:5},COLUMN:{argumentsType:[n.ANY],min:0,max:1,acceptRef:!0},"WORKDAY.ORIGIN":{argumentsType:[n.DATE,n.NOT_ARRAY,n.ARRAY],min:2,max:3},"WORKDAY.INTL":{argumentsType:[n.DATE,n.NOT_ARRAY,n.NUMBER,n.ARRAY],min:2,max:4},AVERAGEIF:{argumentsType:[n.ANY,n.ANY,n.ANY],min:2,max:3,acceptRef:!0},"RANK.EQ":{argumentsType:[n.NUMBER,n.ARRAY,n.NUMBER],min:2,max:3},"RANK.AVG":{argumentsType:[n.NUMBER,n.ARRAY,n.NUMBER],min:2,max:3},AVERAGEA:{argumentsType:n.ANY,min:1},LOG:{argumentsType:[n.NUMBER,n.NUMBER],min:1,max:2},CHAR:{argumentsType:[n.NUMBER],min:1,max:1},COS:{argumentsType:[n.NUMBER],min:1,max:1},SIN:{argumentsType:[n.NUMBER],min:1,max:1},SINH:{argumentsType:[n.NUMBER],min:1,max:1},TAN:{argumentsType:[n.NUMBER],min:1,max:1},ASIN:{argumentsType:[n.NUMBER],min:1,max:1},ACOS:{argumentsType:[n.NUMBER],min:1,max:1},ATAN:{argumentsType:[n.NUMBER],min:1,max:1},PI:{argumentsType:[],min:0,max:0},DEGREES:{argumentsType:[n.NUMBER],min:1,max:1},RADIANS:{argumentsType:[n.NUMBER],min:1,max:1},ISODD:{argumentsType:[n.NOT_ARRAY],min:1,max:1},N:{argumentsType:[n.ANY],min:1,max:1},REPT:{argumentsType:[n.STRING,n.NUMBER],min:2,max:2},SMALL:{argumentsType:[n.ARRAY,n.NOT_ARRAY],min:2,max:2},LARGE:{argumentsType:[n.ARRAY,n.NOT_ARRAY],min:2,max:2},MINUTE:{argumentsType:[n.DATE],min:1,max:1},HOUR:{argumentsType:[n.DATE],min:1,max:1},SECOND:{argumentsType:[n.DATE],min:1,max:1},NOT:{argumentsType:[n.NOT_ARRAY],min:1,max:1},PROPER:{argumentsType:[n.NOT_ARRAY],min:1,max:1},LOWER:{argumentsType:[n.NOT_ARRAY],min:1,max:1},EOMONTH:{argumentsType:[n.DATE,n.NUMBER],min:2,max:2},EDATE:{argumentsType:[n.DATE,n.NUMBER],min:2,max:2},PMT:{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER],min:3,max:5},IMSUB:{argumentsType:[n.NOT_ARRAY,n.NOT_ARRAY],min:2,max:2},IMCONJUGATE:{argumentsType:[n.NOT_ARRAY],min:1,max:1},COMPLEX:{argumentsType:[n.NUMBER,n.NUMBER,n.STRING],min:2,max:3},POWER:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},TRUE:{argumentsType:[],min:0,max:0},FALSE:{argumentsType:[],min:0,max:0},LOG10:{argumentsType:[n.NUMBER],min:1,max:1},EXP:{argumentsType:[n.NUMBER],min:1,max:1},RATE:{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER],min:3,max:6},SUMSQ:{argumentsType:n.ANY,min:1},STDEVA:{argumentsType:n.ANY,min:1},STDEVPA:{argumentsType:n.ANY,min:1},VARA:{argumentsType:n.ANY,min:1},VARPA:{argumentsType:n.ANY,min:1},AVEDEV:{argumentsType:n.ANY,min:1},DEVSQ:{argumentsType:n.ANY,min:1},EXACT:{argumentsType:[n.STRING,n.STRING],min:2,max:2},ROMAN:{argumentsType:[n.NUMBER,n.NUMBER],min:1,max:2},CORREL:{argumentsType:[n.ARRAY,n.ARRAY],min:2,max:2},TEXTJOIN:{argumentsType:n.ANY,min:3},GEOMEAN:{argumentsType:n.ANY,min:1},HARMEAN:{argumentsType:n.ANY,min:1},IPMT:{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER],min:4,max:6},PPMT:{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER],min:4,max:6},UNICHAR:{argumentsType:[n.NUMBER],min:1,max:1},UNICODE:{argumentsType:[n.ANY],min:1,max:1},CHIDIST:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},KURT:{argumentsType:n.ANY,min:1},INTERCEPT:{argumentsType:[n.ARRAY,n.ARRAY],min:2,max:2},PEARSON:{argumentsType:[n.ARRAY,n.ARRAY],min:2,max:2},RSQ:{argumentsType:[n.ARRAY,n.ARRAY],min:2,max:2},ISEVEN:{argumentsType:[n.NOT_ARRAY],min:1,max:1},"SKEW.ORIGIN":{argumentsType:n.ANY,min:1},"SKEW.P":{argumentsType:n.ANY,min:1},WEEKNUM:{argumentsType:[n.DATE,n.NUMBER],min:1,max:2},ISOWEEKNUM:{argumentsType:[n.DATE],min:1,max:1},SLOPE:{argumentsType:n.ANY,min:2,max:2},CODE:{min:1,max:1},ATAN2:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},ASINH:{argumentsType:[n.NUMBER],min:1,max:1},ACOSH:{argumentsType:[n.NUMBER],min:1,max:1},TANH:{argumentsType:[n.NUMBER],min:1,max:1},ATANH:{argumentsType:[n.NUMBER],min:1,max:1},COSH:{argumentsType:[n.NUMBER],min:1,max:1},COT:{argumentsType:[n.NUMBER],min:1,max:1},COTH:{argumentsType:[n.NUMBER],min:1,max:1},ACOT:{argumentsType:[n.NUMBER],min:1,max:1},ACOTH:{argumentsType:[n.NUMBER],min:1,max:1},REPLACE:{argumentsType:[n.STRING,n.NUMBER,n.NUMBER,n.STRING],min:4,max:4},CLEAN:{argumentsType:[n.STRING],min:1,max:1},FV:{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER],min:3,max:5},DOLLAR:{argumentsType:[n.NUMBER,n.NUMBER],min:1,max:2},XOR:{argumentsType:n.ANY,min:1},PV:{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER],min:3,max:5},SQRTPI:{argumentsType:[n.NUMBER],min:1,max:1},TIME:{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER],min:3,max:3},DATEVALUE:{argumentsType:[n.STRING],min:1,max:1},TIMEVALUE:{argumentsType:[n.STRING],min:1,max:1},FVSCHEDULE:{argumentsType:[n.NOT_ARRAY,n.ANY],min:2,max:2},"VAR.P":{argumentsType:n.ANY,min:1},"VAR.S":{argumentsType:n.ANY,min:1},"STDEV.S":{argumentsType:n.ANY,min:1},IRR:{argumentsType:[n.ARRAY,n.NUMBER],min:1,max:2},DAYS:{argumentsType:[n.DATE,n.DATE],min:2,max:2},DAYS360:{argumentsType:[n.DATE,n.DATE,n.BOOL],min:2,max:3},YEARFRAC:{argumentsType:[n.DATE,n.DATE,n.NUMBER],min:2,max:3},CUMIPMT:{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER],min:6,max:6},CUMPRINC:{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER],min:6,max:6},T:{argumentsType:[n.ANY],min:1,max:1},MROUND:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},EFFECT:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},NOMINAL:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},EVEN:{argumentsType:[n.NUMBER],min:1,max:1},ODD:{argumentsType:[n.NUMBER],min:1,max:1},BESSELI:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},BESSELJ:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},BESSELK:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},BESSELY:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},TRIMMEAN:{argumentsType:[n.ANY,n.NUMBER],min:2,max:2},BIN2DEC:{argumentsType:[n.STRING],min:1,max:1},BIN2OCT:{argumentsType:[n.STRING,n.NUMBER],min:1,max:2},BIN2HEX:{argumentsType:[n.STRING,n.NUMBER],min:1,max:2},OCT2DEC:{argumentsType:[n.STRING],min:1,max:1},OCT2BIN:{argumentsType:[n.STRING,n.NUMBER],min:1,max:2},OCT2HEX:{argumentsType:[n.STRING,n.NUMBER],min:1,max:2},HEX2BIN:{argumentsType:[n.STRING,n.NUMBER],min:1,max:2},HEX2OCT:{argumentsType:[n.STRING,n.NUMBER],min:1,max:2},HEX2DEC:{argumentsType:[n.STRING],min:1,max:1},DEC2BIN:{argumentsType:[n.STRING,n.NUMBER],min:1,max:2},DEC2OCT:{argumentsType:[n.STRING,n.NUMBER],min:1,max:2},DEC2HEX:{argumentsType:[n.STRING,n.NUMBER],min:1,max:2},SYD:{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER],min:4,max:4},SLN:{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER],min:3,max:3},MAXA:{argumentsType:n.ANY,min:1},MINA:{argumentsType:n.ANY,min:1},PRICE:{argumentsType:[n.DATE,n.DATE,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER],min:6,max:7},PRICEDISC:{argumentsType:[n.DATE,n.DATE,n.NUMBER,n.NUMBER,n.NUMBER],min:4,max:5},"MODE.SNGL":{argumentsType:n.ANY,min:1},MEDIAN:{argumentsType:n.ANY,min:1},PRICEMAT:{argumentsType:[n.DATE,n.DATE,n.DATE,n.NUMBER,n.NUMBER,n.NUMBER],min:5,max:6},"PERCENTRANK.INC":{argumentsType:[n.ARRAY,n.NUMBER,n.NUMBER],min:2,max:3},"PERCENTRANK.EXC":{argumentsType:[n.ARRAY,n.NUMBER,n.NUMBER],min:2,max:3},YIELD:{argumentsType:[n.DATE,n.DATE,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER],min:6,max:7},YIELDMAT:{argumentsType:[n.DATE,n.DATE,n.DATE,n.NUMBER,n.NUMBER,n.NUMBER],min:5,max:6},YIELDDISC:{argumentsType:[n.DATE,n.DATE,n.NUMBER,n.NUMBER,n.NUMBER],min:4,max:5},DB:{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER],min:4,max:5},"ERF.ORIGIN":{argumentsType:[n.NUMBER,n.NUMBER],min:1,max:2},"ERF.PRECISE":{argumentsType:[n.NUMBER],min:1,max:1},"ERFC.PRECISE":{argumentsType:[n.NUMBER],min:1,max:1},NA:{argumentsType:[],min:0,max:0},SEARCH:{argumentsType:[n.STRING,n.STRING,n.NUMBER],min:2,max:3},RANDBETWEEN:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},CONVERT:{argumentsType:[n.NUMBER,n.STRING,n.STRING],min:3,max:3},COUNTBLANK:{argumentsType:[n.ARRAY],min:1,max:1},DELTA:{argumentsType:[n.NUMBER,n.NUMBER],min:1,max:2},GESTEP:{argumentsType:[n.NUMBER,n.NUMBER],min:1,max:2},MINVERSE:{argumentsType:[n.ANY],min:1,max:1,acceptRef:!0},MMULT:{argumentsType:[n.ANY,n.ANY],min:2,max:2,acceptRef:!0},"NETWORKDAYS.ORIGIN":{argumentsType:[n.NOT_ARRAY,n.NOT_ARRAY],min:2,max:3},"NETWORKDAYS.INTL":{argumentsType:[n.NOT_ARRAY,n.NOT_ARRAY],min:2,max:4},ISFORMULA:{argumentsType:n.ANY,min:1,max:1,acceptRef:!0},ISREF:{argumentsType:n.ANY,min:1,max:1,acceptRef:!0},AVERAGEIFS:{argumentsType:n.ANY,min:1,acceptRef:!0},FREQUENCY:{argumentsType:[n.ANY,n.ANY],min:2,max:2,acceptRef:!0},TRANSPOSE:{argumentsType:n.ANY,min:1,max:1},MINIFS:{argumentsType:n.ANY,min:3,acceptRef:!0},MAXIFS:{argumentsType:n.ANY,min:3,acceptRef:!0}}},"./src/core/feature/formula/lib/calcContext.ts":function(e,t,r){"use strict";var n={_astNodes:void 0,_element:void 0,_instance:void 0,_funcNode:void 0,getAstNodes:function(){return this._astNodes},setAstNodes:function(e){this._astNodes=e},getFuncNode:function(){return this._funcNode},setFuncNode:function(e){this._funcNode=e},getElement:function(){return this._element},setElement:function(e){this._element=e},getInstance:function(){return this._instance},setInstance:function(e){this._instance=e}};t.a=n},"./src/core/feature/formula/lib/idCard/chineseLunar.js":function(e,t,r){var n;r("../node_modules/core-js/modules/es.number.constructor.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.constructor.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.match.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/core-js/modules/es.number.constructor.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.constructor.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.match.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.string.split.js");var o=r("../node_modules/@babel/runtime/helpers/typeof.js");!function(){var a=[[8,"0131","0301","0331","0429","0528","0627","0726","0825","0924","1023","1122","1222","1320"],[0,"0219","0320","0419","0518","0616","0716","0814","0913","1012","1111","1211","1310"],[0,"0208","0310","0408","0508","0606","0705","0804","0902","1002","1031","1130","1230"],[5,"0129","0227","0329","0427","0527","0625","0724","0823","0921","1020","1119","1219","1317"],[0,"0216","0317","0416","0515","0614","0713","0811","0910","1009","1107","1207","1306"],[0,"0204","0306","0405","0504","0603","0703","0801","0830","0929","1028","1127","1226"],[4,"0125","0223","0325","0424","0523","0622","0721","0820","0918","1018","1116","1216","1314"],[0,"0213","0314","0413","0512","0611","0710","0809","0908","1007","1106","1205","1304"],[0,"0202","0303","0401","0430","0530","0629","0728","0827","0925","1025","1124","1223"],[2,"0122","0220","0322","0420","0519","0618","0717","0816","0914","1014","1113","1213","1311"],[0,"0210","0311","0410","0509","0607","0707","0805","0904","1003","1102","1202","1301"],[6,"0130","0301","0330","0429","0528","0626","0726","0824","0922","1022","1121","1220","1319"],[0,"0218","0319","0417","0517","0615","0714","0813","0911","1010","1109","1209","1307"],[0,"0206","0308","0407","0506","0605","0704","0802","0901","0930","1029","1128","1227"],[5,"0126","0225","0327","0425","0525","0623","0723","0821","0920","1019","1117","1217","1315"],[0,"0214","0316","0414","0514","0613","0712","0811","0909","1009","1107","1207","1305"],[0,"0203","0304","0403","0502","0601","0630","0730","0829","0927","1027","1125","1225"],[2,"0123","0222","0323","0421","0521","0619","0719","0818","0916","1016","1115","1214","1313"],[0,"0211","0313","0411","0510","0609","0708","0807","0905","1005","1104","1203","1302"],[7,"0201","0302","0401","0430","0529","0628","0727","0825","0924","1024","1122","1222","1321"],[0,"0220","0320","0419","0518","0616","0716","0814","0912","1012","1110","1210","1309"],[0,"0208","0310","0408","0508","0606","0705","0804","0902","1001","1031","1129","1229"],[5,"0128","0227","0328","0427","0527","0625","0724","0823","0921","1020","1119","1218","1317"],[0,"0216","0317","0416","0516","0614","0714","0812","0911","1010","1108","1208","1306"],[0,"0205","0305","0404","0504","0602","0702","0801","0830","0929","1028","1127","1226"],[4,"0124","0223","0324","0423","0522","0621","0721","0819","0918","1018","1116","1216","1314"],[0,"0213","0314","0412","0512","0610","0710","0808","0907","1007","1105","1205","1304"],[0,"0202","0304","0402","0501","0531","0629","0729","0827","0926","1025","1124","1224"],[2,"0123","0221","0322","0420","0519","0618","0717","0815","0914","1013","1112","1212","1311"],[0,"0210","0311","0410","0509","0607","0707","0805","0903","1003","1101","1201","1231"],[6,"0130","0228","0330","0429","0528","0626","0726","0824","0922","1022","1120","1220","1319"],[0,"0217","0319","0418","0517","0616","0715","0814","0912","1011","1110","1209","1308"],[0,"0206","0307","0406","0506","0604","0704","0802","0901","0930","1029","1128","1227"],[5,"0126","0224","0326","0425","0524","0623","0722","0821","0920","1019","1118","1217","1315"],[0,"0214","0315","0414","0513","0612","0712","0810","0909","1008","1107","1207","1305"],[0,"0204","0305","0403","0503","0601","0701","0730","0829","0928","1027","1126","1226"],[3,"0124","0223","0323","0421","0521","0619","0718","0817","0916","1015","1114","1214","1313"],[0,"0211","0313","0411","0510","0609","0708","0806","0905","1004","1103","1203","1302"],[7,"0131","0302","0401","0430","0529","0628","0727","0825","0924","1023","1122","1222","1320"],[0,"0219","0321","0420","0519","0617","0717","0815","0913","1013","1111","1211","1309"],[0,"0208","0309","0408","0507","0606","0705","0804","0902","1001","1031","1129","1229"],[6,"0127","0226","0328","0426","0526","0625","0724","0823","0921","1020","1119","1218","1317"],[0,"0215","0317","0415","0515","0614","0713","0812","0910","1010","1108","1208","1306"],[0,"0205","0306","0405","0504","0603","0702","0801","0831","0929","1029","1127","1227"],[4,"0125","0224","0324","0423","0522","0621","0720","0819","0917","1017","1116","1215","1314"],[0,"0213","0314","0412","0512","0610","0709","0808","0906","1006","1105","1205","1303"],[0,"0202","0304","0402","0501","0531","0629","0728","0827","0925","1025","1124","1223"],[2,"0122","0221","0323","0421","0520","0619","0718","0816","0915","1014","1113","1212","1311"],[0,"0210","0311","0409","0509","0607","0707","0805","0903","1003","1101","1201","1230"],[7,"0129","0228","0329","0428","0528","0626","0726","0824","0922","1022","1120","1220","1318"],[0,"0217","0318","0417","0517","0615","0715","0814","0912","1011","1110","1209","1308"],[0,"0206","0308","0406","0506","0605","0704","0803","0901","1001","1030","1129","1228"],[5,"0127","0225","0326","0424","0524","0622","0722","0820","0919","1019","1117","1217","1315"],[0,"0214","0315","0414","0513","0611","0711","0810","0908","1008","1107","1206","1305"],[0,"0203","0305","0403","0503","0601","0630","0730","0828","0927","1027","1126","1225"],[3,"0124","0222","0324","0422","0522","0620","0719","0818","0916","1016","1114","1214","1313"],[0,"0212","0312","0411","0510","0609","0708","0806","0905","1004","1103","1203","1301"],[8,"0131","0302","0331","0430","0529","0628","0727","0825","0924","1023","1122","1221","1320"],[0,"0218","0320","0419","0519","0617","0717","0815","0913","1013","1111","1211","1309"],[0,"0208","0309","0408","0508","0606","0706","0804","0903","1002","1101","1130","1230"],[6,"0128","0227","0327","0426","0525","0624","0724","0822","0921","1020","1119","1218","1317"],[0,"0215","0317","0415","0515","0613","0713","0811","0910","1010","1108","1208","1306"],[0,"0205","0306","0405","0504","0602","0702","0731","0830","0929","1028","1127","1227"],[4,"0125","0224","0325","0424","0523","0621","0721","0819","0918","1017","1116","1216","1315"],[0,"0213","0314","0412","0512","0610","0709","0808","0906","1006","1104","1204","1303"],[0,"0202","0303","0402","0501","0531","0629","0728","0827","0925","1024","1123","1223"],[3,"0121","0220","0322","0421","0520","0619","0718","0816","0915","1014","1112","1212","1311"],[0,"0209","0311","0410","0509","0608","0708","0806","0904","1004","1102","1202","1231"],[7,"0130","0228","0329","0427","0527","0626","0725","0824","0922","1022","1120","1220","1318"],[0,"0217","0318","0417","0516","0615","0714","0813","0912","1011","1110","1209","1308"],[0,"0206","0308","0406","0505","0604","0703","0802","0901","0930","1030","1129","1228"],[5,"0127","0225","0327","0425","0524","0623","0722","0821","0919","1019","1118","1218","1316"],[0,"0215","0315","0414","0513","0611","0711","0809","0908","1007","1106","1206","1304"],[0,"0203","0305","0403","0503","0601","0630","0730","0828","0926","1026","1125","1224"],[4,"0123","0222","0324","0422","0522","0620","0719","0818","0916","1015","1114","1214","1312"],[0,"0211","0313","0412","0511","0610","0709","0807","0906","1005","1103","1203","1301"],[8,"0131","0301","0331","0429","0529","0627","0727","0825","0924","1023","1121","1221","1319"],[0,"0218","0320","0418","0518","0617","0716","0815","0913","1013","1111","1211","1309"],[0,"0207","0309","0407","0507","0606","0705","0804","0902","1002","1101","1130","1230"],[6,"0128","0227","0328","0426","0526","0624","0724","0823","0921","1021","1120","1219","1318"],[0,"0216","0317","0415","0514","0613","0712","0811","0909","1009","1108","1207","1306"],[0,"0205","0306","0405","0504","0602","0702","0731","0829","0928","1028","1126","1226"],[4,"0125","0224","0325","0424","0523","0621","0721","0819","0917","1017","1115","1215","1314"],[0,"0213","0315","0413","0513","0611","0710","0809","0907","1006","1105","1204","1303"],[10,"0202","0303","0401","0501","0531","0629","0728","0827","0925","1024","1123","1222","1321"],[0,"0220","0321","0420","0520","0618","0718","0816","0915","1014","1112","1212","1310"],[0,"0209","0310","0409","0509","0607","0707","0806","0904","1004","1102","1202","1231"],[6,"0129","0228","0329","0428","0527","0626","0726","0824","0923","1023","1121","1221","1319"],[0,"0217","0318","0416","0516","0614","0714","0812","0911","1011","1109","1209","1308"],[0,"0206","0308","0406","0505","0604","0703","0802","0831","0930","1029","1128","1228"],[5,"0127","0225","0327","0425","0524","0623","0722","0820","0919","1018","1117","1217","1316"],[0,"0215","0316","0415","0514","0612","0712","0810","0908","1008","1106","1206","1305"],[0,"0204","0304","0403","0503","0601","0630","0730","0828","0926","1026","1124","1224"],[3,"0123","0221","0323","0422","0521","0620","0719","0818","0916","1015","1114","1213","1312"],[0,"0210","0312","0411","0511","0609","0709","0807","0906","1005","1103","1203","1301"],[8,"0131","0301","0331","0430","0529","0628","0727","0826","0925","1024","1122","1222","1320"],[0,"0219","0319","0418","0517","0616","0715","0814","0912","1012","1111","1211","1309"],[0,"0207","0309","0407","0507","0605","0705","0803","0902","1002","1031","1130","1230"],[5,"0128","0227","0328","0426","0526","0624","0723","0822","0921","1020","1119","1219","1317"],[0,"0216","0318","0416","0515","0614","0713","0811","0910","1009","1108","1208","1307"],[0,"0205","0306","0405","0504","0602","0702","0731","0829","0928","1027","1126","1226"],[4,"0124","0223","0325","0423","0523","0621","0721","0819","0917","1017","1115","1215","1313"],[0,"0212","0314","0413","0512","0611","0710","0809","0907","1006","1105","1204","1303"],[0,"0201","0303","0402","0501","0531","0630","0729","0828","0926","1025","1124","1223"],[2,"0122","0220","0321","0419","0519","0618","0717","0816","0914","1014","1112","1212","1310"],[0,"0209","0310","0409","0508","0607","0706","0805","0904","1003","1102","1201","1231"],[7,"0129","0228","0329","0428","0527","0626","0725","0824","0922","1022","1121","1220","1319"],[0,"0218","0319","0417","0517","0615","0714","0813","0911","1011","1110","1210","1308"],[0,"0207","0308","0406","0505","0604","0703","0801","0831","0929","1029","1128","1227"],[5,"0126","0225","0327","0425","0524","0623","0722","0820","0919","1018","1117","1216","1315"],[0,"0214","0316","0414","0514","0612","0712","0810","0908","1008","1106","1206","1304"],[0,"0203","0305","0403","0503","0602","0701","0731","0829","0927","1027","1125","1225"],[4,"0123","0222","0322","0421","0521","0619","0719","0817","0916","1015","1114","1213","1312"],[0,"0210","0312","0410","0510","0608","0708","0807","0905","1005","1103","1203","1301"],[9,"0131","0301","0331","0429","0529","0627","0727","0825","0924","1024","1122","1222","1320"],[0,"0219","0320","0419","0518","0616","0716","0814","0913","1013","1112","1211","1310"],[0,"0208","0309","0407","0507","0605","0704","0803","0901","1001","1031","1129","1229"],[6,"0128","0226","0328","0426","0526","0624","0723","0822","0920","1020","1118","1218","1317"],[0,"0216","0317","0416","0515","0614","0713","0811","0910","1009","1108","1207","1306"],[0,"0205","0307","0405","0505","0603","0703","0801","0830","0929","1028","1126","1226"],[4,"0125","0223","0324","0423","0523","0621","0721","0819","0917","1017","1115","1215","1313"],[0,"0212","0313","0412","0512","0610","0710","0808","0907","1006","1105","1204","1303"],[0,"0201","0303","0401","0501","0530","0629","0729","0827","0926","1025","1124","1223"],[2,"0122","0220","0322","0420","0519","0618","0718","0816","0915","1015","1113","1213","1311"],[0,"0210","0310","0409","0508","0606","0706","0804","0903","1003","1101","1201","1231"],[6,"0129","0228","0329","0428","0527","0625","0725","0823","0922","1021","1120","1220","1319"],[0,"0217","0319","0417","0517","0615","0714","0813","0911","1010","1109","1209","1308"],[0,"0206","0308","0407","0506","0605","0704","0802","0901","0930","1029","1128","1228"],[5,"0126","0225","0326","0425","0524","0623","0722","0820","0919","1018","1116","1216","1315"],[0,"0213","0315","0414","0513","0612","0711","0810","0908","1008","1106","1205","1304"],[0,"0203","0304","0403","0502","0601","0701","0730","0829","0927","1027","1125","1225"],[3,"0123","0221","0323","0422","0521","0620","0719","0818","0917","1016","1115","1214","1313"],[0,"0211","0312","0410","0509","0608","0707","0806","0905","1004","1103","1203","1301"],[7,"0131","0301","0331","0429","0528","0627","0726","0825","0923","1023","1122","1222","1320"],[0,"0219","0320","0419","0518","0616","0716","0814","0913","1012","1111","1211","1309"],[0,"0208","0310","0408","0508","0606","0705","0804","0902","1001","1031","1130","1229"],[6,"0128","0227","0328","0426","0526","0624","0723","0822","0920","1019","1118","1217","1316"],[0,"0215","0317","0416","0515","0614","0713","0811","0910","1009","1107","1207","1305"],[0,"0204","0306","0405","0504","0603","0702","0801","0830","0929","1028","1126","1226"],[5,"0124","0223","0325","0423","0523","0622","0721","0820","0918","1018","1116","1216","1314"],[0,"0212","0313","0411","0511","0610","0709","0808","0906","1006","1105","1204","1303"],[0,"0201","0302","0401","0430","0530","0628","0728","0827","0925","1025","1124","1223"],[2,"0122","0220","0322","0420","0519","0618","0717","0816","0914","1014","1113","1212","1311"],[0,"0210","0311","0410","0509","0607","0707","0805","0903","1003","1102","1201","1231"],[7,"0130","0229","0329","0428","0527","0625","0725","0823","0921","1021","1119","1219","1318"],[0,"0217","0319","0417","0517","0615","0714","0813","0911","1010","1109","1208","1307"],[0,"0206","0308","0406","0506","0604","0704","0802","0901","0930","1029","1128","1227"],[5,"0126","0225","0326","0425","0525","0623","0723","0821","0920","1019","1117","1217","1315"],[0,"0214","0314","0413","0513","0611","0711","0810","0908","1008","1106","1205","1304"],[0,"0202","0304","0402","0502","0531","0630","0730","0828","0927","1027","1125","1225"],[3,"0123","0221","0323","0421","0521","0619","0719","0817","0916","1016","1114","1214","1313"],[0,"0211","0313","0411","0510","0609","0708","0806","0905","1005","1103","1203","1302"],[8,"0201","0301","0331","0429","0528","0627","0726","0824","0923","1022","1121","1221","1320"],[0,"0219","0320","0419","0518","0616","0716","0814","0912","1012","1110","1210","1309"],[0,"0208","0309","0408","0508","0606","0705","0804","0902","1001","1031","1129","1229"],[6,"0128","0226","0328","0427","0526","0625","0724","0823","0921","1020","1119","1218","1317"],[0,"0215","0316","0415","0515","0613","0713","0811","0910","1009","1107","1207","1305"],[0,"0204","0305","0404","0504","0602","0702","0731","0830","0929","1028","1126","1226"],[4,"0124","0223","0324","0423","0522","0621","0720","0819","0918","1017","1116","1216","1314"],[0,"0212","0314","0412","0512","0610","0710","0808","0907","1006","1105","1205","1304"],[0,"0202","0303","0401","0501","0530","0628","0727","0826","0924","1024","1123","1223"],[3,"0121","0220","0322","0420","0519","0618","0717","0815","0914","1013","1112","1212","1311"],[0,"0209","0311","0410","0509","0607","0707","0805","0903","1003","1101","1201","1231"],[7,"0129","0228","0330","0428","0528","0626","0726","0824","0922","1022","1120","1220","1318"],[0,"0217","0318","0417","0516","0615","0714","0813","0911","1010","1109","1208","1307"],[0,"0205","0307","0406","0505","0604","0704","0802","0901","0930","1029","1128","1227"],[5,"0126","0224","0326","0424","0524","0623","0722","0821","0919","1019","1117","1217","1315"],[0,"0214","0315","0414","0513","0612","0711","0810","0909","1008","1107","1206","1305"],[0,"0203","0304","0402","0502","0531","0629","0729","0828","0926","1026","1125","1224"],[4,"0123","0221","0323","0421","0521","0619","0718","0817","0915","1015","1114","1214","1312"],[0,"0211","0312","0411","0510","0609","0708","0806","0905","1004","1103","1203","1301"],[8,"0131","0302","0331","0430","0529","0628","0727","0825","0924","1023","1122","1221","1320"],[0,"0219","0320","0418","0518","0616","0716","0814","0912","1012","1110","1210","1308"],[0,"0207","0309","0407","0507","0605","0704","0803","0901","0930","1030","1128","1228"],[6,"0126","0225","0326","0425","0525","0623","0723","0821","0920","1019","1118","1217","1316"],[0,"0214","0316","0414","0514","0612","0712","0811","0909","1009","1107","1207","1305"],[0,"0204","0304","0403","0502","0601","0630","0730","0828","0927","1027","1125","1225"],[0,"0123","0222","0323","0422","0521","0620","0719","0818","0917","1017","1115","1215"],[0,"0113","0212","0313","0412","0511","0609","0709","0807","0906","1006","1104","1204"],[0,"0103","0201","0303","0401","0501","0530","0628","0728","0826","0925","1024","1123"],[3,"1223","0122","0220","0321","0419","0519","0617","0716","0815","0913","1012","1111","1211"],[0,"0110","0208","0310","0409","0508","0607","0706","0804","0903","1002","1031","1130"],[7,"1230","0128","0227","0329","0428","0527","0625","0725","0823","0922","1021","1119","1219"],[0,"0118","0216","0318","0417","0516","0615","0714","0813","0911","1011","1109","1209"],[0,"0107","0206","0306","0405","0504","0603","0703","0801","0831","0929","1029","1127"],[5,"1227","0125","0224","0325","0423","0523","0622","0721","0820","0919","1018","1117","1216"],[0,"0115","0213","0315","0413","0512","0611","0710","0809","0908","1007","1106","1206"],[0,"0104","0203","0304","0403","0502","0531","0630","0729","0828","0926","1026","1125"],[4,"1225","0123","0222","0322","0421","0520","0618","0718","0816","0914","1014","1113","1213"],[0,"0111","0210","0312","0410","0510","0608","0707","0806","0904","1003","1102","1202"],[8,"1231","0130","0301","0331","0429","0529","0627","0726","0825","0923","1022","1121","1221"],[0,"0119","0218","0320","0418","0518","0616","0716","0814","0913","1012","1110","1210"],[0,"0108","0207","0308","0406","0506","0605","0704","0803","0901","1001","1030","1129"],[6,"1228","0126","0225","0327","0425","0525","0623","0723","0822","0920","1020","1118","1218"],[0,"0116","0214","0316","0414","0514","0612","0712","0811","0909","1009","1108","1207"],[0,"0106","0204","0306","0404","0503","0602","0701","0731","0829","0928","1028","1127"],[4,"1226","0125","0223","0324","0422","0521","0620","0719","0817","0916","1016","1115","1214"],[0,"0113","0212","0313","0412","0511","0609","0709","0807","0905","1005","1104","1203"],[0,"0102","0201","0303","0401","0501","0530","0628","0727","0826","0924","1024","1122"],[2,"1222","0121","0220","0321","0420","0520","0618","0717","0816","0914","1013","1112","1211"]],s={},i=function(e,t,r){var n=e.getTime()-t.getTime();switch(r){case"y":return parseInt(e.getFullYear()-t.getFullYear());case"M":return parseInt(12*(e.getFullYear()-t.getFullYear())+(e.getMonth()-t.getMonth()));case"d":return Math.ceil(n/1e3/60/60/24);case"w":return Math.floor(n/1e3/60/60/24/7);case"h":return Math.floor(n/1e3/60/60);case"m":return Math.floor(n/1e3/60);case"s":return Math.floor(n/1e3);case"ms":return parseInt(n)}},u=function(e,t,r,n,o){var s=a[t];if(!s)return!1;for(var i,u,l,c=e.getFullYear(),d=e.getMonth()+1,f=e.getDate(),h=c,m=s.length-1;m>0;m--){i=m;var p=Number(s[m].substring(0,2)),v=Number(s[m].substring(2,4));if(u=(l=o&&p>12?p-12:p)<d||l==d&&v<=f||(p<=r||p>=n)&&o,12==l&&l>d&&1==m&&(u=!0,c--),u)break}return!!u&&(o&&12==p&&(c-=1),{year:c,month:l,day:v,lunarYear:h=o?h-1:h,lunarMonth:i,leapMonth:s[0]})},l=function(e,t,r){if("M"==r)return s.monthAdd(e,t);var n=s.lunarToSolar(e);return n=void 0,s.solarToLunar(n)};s.dateAdd=function(e,t){for(var r=function(e){for(var t=e.match(/[+-]?\d+((ms)|[yMdhmsw])/g),r=[],n=0;n<t.length;n++){if(/([+-])(\d+)(.+)/.test(t[n])){var o=parseInt(RegExp.$2);"-"===RegExp.$1&&(o=-o),r.push({value:o,unit:RegExp.$3})}return r}}(t),n=0;n<r.length;n++)e=l(e,r[n]);return e},s.dateDiff=function(e,t,r){if("M"==r)return s.monthDiff(e,t);var n=s.lunarToSolar(e),o=s.lunarToSolar(t);return i(o,n,r)},s.monthAdd=function(e,t){if(e instanceof Date&&(e=s.solarToLunar(e)),0==t)return e;var r,n=e.year,o=e.month;(e.leap||e.leapMonth>0&&e.month>e.leapMonth)&&o++;var a=!0;do{(t=t+o-(r=s.monthsOfYear(n)))<=0?(a=!1,o=n==e.year?r+t:r+t-o):(n++,o=1)}while(a);var i=s.leapMonthOfYear(n),u=!1;return i>0&&o>i&&(u=--o==i),{year:n,month:o,leap:u,leapMonth:i}},s.monthDiff=function(e,t){var r=0;if(e instanceof Date&&(e=s.solarToLunar(e)),t instanceof Date&&(t=s.solarToLunar(t)),e.year==t.year)r=t.month-e.month,e.leapMonth>=e.month&&e.leapMonth<=t.month&&r++;else{r=12,(e.leapMonth>e.month||e.leapMonth==e.month&&!e.isLeaMonth)&&(r+=1),r-=e.month;for(var n=e.year+1,o=n;o<t.year;o++)r+=s.monthsOfYear(n++);r+=t.month,(t.isLeapMonth||t.month<t.leapMonth)&&r++}return r},s.daysOfMonth=function(e,t,r){"object"==o(e)&&(t=e.month,r=e.leap,e=e.year);var n=s.lunarToSolar(e,t,1,r);s.leapMonthOfYear(e)!=t||r?12==t?(e++,t=1):(r=!1,t++):r=!0;var a=s.lunarToSolar(e,t,1,r);return s.dateDiff(a,n,"d")},s.monthsOfYear=function(e){return a[e-1900].length-1},s.leapMonthOfYear=function(e){var t=a[e-1900];return t?t[0]:0},s.lunarToSolar=function(e,t,r,n){var s=arguments[0];"object"==o(s)&&1==arguments.length&&(e=s.year,t=s.month,r=s.day,n=s.leap);var i=e-1900;if(i<0||i>a.length)throw new Error("Specified date range is invalid.");var u=a[i][0];(n&&t==u||u>0&&t>u)&&(t+=1);var l=a[i][t],c=Number(l.substring(0,2)),d=Number(l.substring(2,4));c>12&&(e+=1,c-=12);var f=new Date(e,c-1,d),h=f.getTime()+24*(r-1)*60*60*1e3;return new Date(h)},s.solarToLunar=function(e,t){var r=e.getFullYear()-1900;if(r<=0||r>=a.length)throw new Error("Specified date range is invalid.");var n=u(e,r,0,13,!1);if(!(n=n||u(e,r-1,12,99,!0)))return!1;var o=new Date(n.year,n.month-1,n.day),l=i(e,o,"d")+1,c={leap:n.leapMonth>0&&n.leapMonth+1==n.lunarMonth,year:n.lunarYear,month:n.leapMonth>0&&n.lunarMonth>n.leapMonth?n.lunarMonth-1:n.lunarMonth,day:l,leapMonth:n.leapMonth};return t&&c?s.format(c,t):c},s.traditionalYearName=function(e){var t="\u7532\u4e59\u4e19\u4e01\u620a\u5df1\u5e9a\u8f9b\u58ec\u7678".split(""),r="\u5b50\u4e11\u5bc5\u536f\u8fb0\u5df3\u5348\u672a\u7533\u9149\u620c\u4ea5".split("");return t[(e=e-1900+36)%10]+r[e%12]+"\u5e74"},s.yearName=function(e){for(var t="\u3007,\u4e00,\u4e8c,\u4e09,\u56db,\u4e94,\u516d,\u4e03,\u516b,\u4e5d".split(","),r=e.toString(),n="",o=0;o<r.length;o++)n+=t[parseInt(r.charAt(o))];return n+"\u5e74"},s.animalName=function(e){return"\u9f20\u725b\u864e\u5154\u9f99\u86c7\u9a6c\u7f8a\u7334\u9e21\u72d7\u732a".split("")[(e-4)%12]},s.monthName=function(e,t,r){var n="\u6b63,\u4e8c,\u4e09,\u56db,\u4e94,\u516d,\u4e03,\u516b,\u4e5d,\u5341,\u5341\u4e00,\u5341\u4e8c".split(",");return t&&(n[11]="\u814a"),(r?"\u95f0":"")+n[e-1]+"\u6708"},s.dayName=function(e){switch(e){case 10:return"\u521d\u5341";case 20:return"\u4e8c\u5341";case 30:return"\u4e09\u5341";default:return"\u521d\u5341\u5eff\u5345".split("")[Math.floor(e/10)]+"\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341".split("")[(e-1)%10]||e}},s.format=function(e,t){return t.replace(/[TAYyMmdD]/g,(function(t,r){switch(t){case"T":return s.traditionalYearName(e.year);case"A":return s.animalName(e.year);case"Y":return s.yearName(e.year);case"y":return e.year;case"m":return s.monthName(e.month,!1,e.leap);case"M":return s.monthName(e.month,!0,e.leap);case"d":return s.dayName(e.day);case"D":return 1==e.day?s.monthName(e.month,!1,e.leap):s.dayName(e.day)}}))},void 0===(n=function(){return s}.call(t,r,t,e))||(e.exports=n)}()},"./src/core/feature/formula/lib/index.js":function(e,t,r){"use strict";r.r(t);var n={};r.r(n),r.d(n,"ERROR",(function(){return Pe})),r.d(n,"ISERR",(function(){return Le})),r.d(n,"ISERROR",(function(){return Ue})),r.d(n,"ISFORMULA",(function(){return Be})),r.d(n,"ISLOGICAL",(function(){return He})),r.d(n,"ISNA",(function(){return Ge})),r.d(n,"ISNUMBER",(function(){return Ve})),r.d(n,"ISREF",(function(){return We})),r.d(n,"ISTEXT",(function(){return Ye})),r.d(n,"NA",(function(){return ze})),r.d(n,"TYPE",(function(){return Ke})),r.d(n,"ISBLANK",(function(){return qe})),r.d(n,"ISODD",(function(){return Qe})),r.d(n,"ISEVEN",(function(){return Xe})),r.d(n,"N",(function(){return Je}));var o={};r.r(o),r.d(o,"ABS",(function(){return Ct})),r.d(o,"SPECIALMATCH",(function(){return Tt})),r.d(o,"MATHMATCH",(function(){return It})),r.d(o,"LOGICMATCH",(function(){return Nt})),r.d(o,"STOCK",(function(){return kt})),r.d(o,"DECIMAL",(function(){return Dt})),r.d(o,"INT",(function(){return xt})),r.d(o,"ISO",(function(){return Ft})),r.d(o,"MOD",(function(){return Pt})),r.d(o,"RAND",(function(){return Lt})),r.d(o,"ROUND",(function(){return Ut})),r.d(o,"ROUNDUP",(function(){return Bt})),r.d(o,"SQRT",(function(){return Ht})),r.d(o,"SUBTOTAL",(function(){return Gt})),r.d(o,"ADD",(function(){return Vt})),r.d(o,"MINUS",(function(){return Wt})),r.d(o,"DIVIDE",(function(){return Yt})),r.d(o,"MULTIPLY",(function(){return zt})),r.d(o,"GTE",(function(){return Kt})),r.d(o,"LT",(function(){return qt})),r.d(o,"LTE",(function(){return Qt})),r.d(o,"EQ",(function(){return Xt})),r.d(o,"NE",(function(){return Jt})),r.d(o,"POW",(function(){return $t})),r.d(o,"IFERROR",(function(){return Zt})),r.d(o,"ROW",(function(){return tr})),r.d(o,"COLUMN",(function(){return rr})),r.d(o,"SUM",(function(){return nr})),r.d(o,"MINVERSE",(function(){return or})),r.d(o,"MMULT",(function(){return ar})),r.d(o,"SUMIFS",(function(){return ir})),r.d(o,"MAXIFS",(function(){return ur})),r.d(o,"MINIFS",(function(){return lr})),r.d(o,"SUMIF",(function(){return cr})),r.d(o,"SUMPRODUCT",(function(){return dr})),r.d(o,"ID",(function(){return fr})),r.d(o,"TRUNC",(function(){return mr})),r.d(o,"ROUNDDOWN",(function(){return pr})),r.d(o,"round",(function(){return vr})),r.d(o,"LN",(function(){return gr})),r.d(o,"CEILING",(function(){return Ar})),r.d(o,"FLOOR",(function(){return Er})),r.d(o,"ADDRESS",(function(){return jr})),r.d(o,"PRODUCT",(function(){return Sr})),r.d(o,"LOG",(function(){return Cr})),r.d(o,"SIN",(function(){return wr})),r.d(o,"COS",(function(){return Or})),r.d(o,"TAN",(function(){return Ir})),r.d(o,"ASIN",(function(){return Nr})),r.d(o,"ACOS",(function(){return kr})),r.d(o,"ATAN",(function(){return Mr})),r.d(o,"PI",(function(){return Dr})),r.d(o,"DEGREES",(function(){return xr})),r.d(o,"RADIANS",(function(){return Fr})),r.d(o,"POWER",(function(){return Pr})),r.d(o,"LOG10",(function(){return Lr})),r.d(o,"EXP",(function(){return Ur})),r.d(o,"SUMSQ",(function(){return Br})),r.d(o,"AVEDEV",(function(){return Gr})),r.d(o,"DEVSQ",(function(){return Vr})),r.d(o,"ROMAN",(function(){return Wr})),r.d(o,"SINH",(function(){return Yr})),r.d(o,"ATAN2",(function(){return zr})),r.d(o,"ASINH",(function(){return Kr})),r.d(o,"ACOSH",(function(){return qr})),r.d(o,"TANH",(function(){return Qr})),r.d(o,"ATANH",(function(){return Xr})),r.d(o,"COSH",(function(){return Jr})),r.d(o,"COT",(function(){return $r})),r.d(o,"COTH",(function(){return Zr})),r.d(o,"ACOT",(function(){return en})),r.d(o,"ACOTH",(function(){return tn})),r.d(o,"SQRTPI",(function(){return rn})),r.d(o,"MROUND",(function(){return nn})),r.d(o,"ODD",(function(){return an})),r.d(o,"EVEN",(function(){return sn})),r.d(o,"RANDBETWEEN",(function(){return un}));var a={};r.r(a),r.d(a,"FLATTEN",(function(){return ln})),r.d(a,"JOIN",(function(){return cn}));var s={};r.r(s),r.d(s,"AVERAGE",(function(){return mn})),r.d(s,"AVERAGEIFS",(function(){return pn})),r.d(s,"COUNT",(function(){return vn})),r.d(s,"COUNTA",(function(){return gn})),r.d(s,"COUNTBLANK",(function(){return yn})),r.d(s,"COUNTIF",(function(){return En})),r.d(s,"COUNTIFS",(function(){return jn})),r.d(s,"COUNTUNIQUE",(function(){return Rn})),r.d(s,"FREQUENCY",(function(){return Sn})),r.d(s,"MAX",(function(){return Tn})),r.d(s,"MIN",(function(){return wn})),r.d(s,"STDEV",(function(){return On})),r.d(s,"TRANSPOSE",(function(){return In})),r.d(s,"VAR",(function(){return Nn})),r.d(s,"RANK",(function(){return Mn})),r.d(s,"AVERAGEIF",(function(){return Fn})),r.d(s,"AVERAGEA",(function(){return Pn})),r.d(s,"SMALL",(function(){return Un})),r.d(s,"LARGE",(function(){return Bn})),r.d(s,"MEDIAN",(function(){return Hn})),r.d(s,"MODE",(function(){return Gn})),r.d(s,"STDEVA",(function(){return Wn})),r.d(s,"STDEVPA",(function(){return Yn})),r.d(s,"VARA",(function(){return zn})),r.d(s,"VARPA",(function(){return Kn})),r.d(s,"CORREL",(function(){return qn})),r.d(s,"GEOMEAN",(function(){return Xn})),r.d(s,"HARMEAN",(function(){return Jn})),r.d(s,"CHIDIST",(function(){return $n})),r.d(s,"KURT",(function(){return eo})),r.d(s,"INTERCEPT",(function(){return to})),r.d(s,"PEARSON",(function(){return ro})),r.d(s,"RSQ",(function(){return no})),r.d(s,"SKEW",(function(){return oo})),r.d(s,"SLOPE",(function(){return so})),r.d(s,"TRIMMEAN",(function(){return uo})),r.d(s,"MAXA",(function(){return co})),r.d(s,"MINA",(function(){return fo})),r.d(s,"PERCENTRANK",(function(){return Ao}));var i={};r.r(i),r.d(i,"MATCH",(function(){return Io})),r.d(i,"VLOOKUP",(function(){return Bo})),r.d(i,"HLOOKUP",(function(){return Ho})),r.d(i,"LOOKUP",(function(){return Go}));var u={};r.r(u),r.d(u,"DATE",(function(){return $o})),r.d(u,"DAY",(function(){return Zo})),r.d(u,"MONTH",(function(){return ea})),r.d(u,"NETWORKDAYS",(function(){return na})),r.d(u,"NOW",(function(){return oa})),r.d(u,"TODAY",(function(){return aa})),r.d(u,"WEEKDAY",(function(){return sa})),r.d(u,"YEAR",(function(){return ia})),r.d(u,"isLeapYear",(function(){return ua})),r.d(u,"transSpDate",(function(){return la})),r.d(u,"TIMEVALUE",(function(){return ca})),r.d(u,"weekday",(function(){return da})),r.d(u,"WORKDAY",(function(){return pa})),r.d(u,"MINUTE",(function(){return va})),r.d(u,"HOUR",(function(){return ga})),r.d(u,"SECOND",(function(){return ya})),r.d(u,"EOMONTH",(function(){return ba})),r.d(u,"EDATE",(function(){return Aa})),r.d(u,"ISOWEEKNUM",(function(){return Ea})),r.d(u,"WEEKNUM",(function(){return Ra})),r.d(u,"TIME",(function(){return Sa})),r.d(u,"DATEVALUE",(function(){return Ca})),r.d(u,"DAYS",(function(){return wa})),r.d(u,"DAYS360",(function(){return Oa})),r.d(u,"YEARFRAC",(function(){return Ia}));var l={};r.r(l),r.d(l,"FIND",(function(){return Ds})),r.d(l,"LEFT",(function(){return xs})),r.d(l,"RIGHT",(function(){return Fs})),r.d(l,"LEN",(function(){return Ls})),r.d(l,"MID",(function(){return Us})),r.d(l,"SUBSTITUTE",(function(){return Bs})),r.d(l,"TRIM",(function(){return Hs})),r.d(l,"CONCATENATE",(function(){return Vs})),r.d(l,"CONCAT",(function(){return Ws})),r.d(l,"VALUE",(function(){return Ys})),r.d(l,"FIXED",(function(){return Ks})),r.d(l,"ASC",(function(){return Qs})),r.d(l,"UPPER",(function(){return Xs})),r.d(l,"CHAR",(function(){return Js})),r.d(l,"REPT",(function(){return $s})),r.d(l,"PROPER",(function(){return Zs})),r.d(l,"EXACT",(function(){return ei})),r.d(l,"TEXTJOIN",(function(){return ri})),r.d(l,"UNICHAR",(function(){return ni})),r.d(l,"UNICODE",(function(){return oi})),r.d(l,"LOWER",(function(){return ai})),r.d(l,"CODE",(function(){return si})),r.d(l,"REPLACE",(function(){return ii})),r.d(l,"CLEAN",(function(){return ui})),r.d(l,"DOLLAR",(function(){return ci})),r.d(l,"T",(function(){return di})),r.d(l,"TEXT",(function(){return fi})),r.d(l,"SEARCH",(function(){return hi}));var c={};r.r(c),r.d(c,"INDEX",(function(){return Oi})),r.d(c,"INDIRECT",(function(){return Ii})),r.d(c,"OFFSET",(function(){return Ni})),r.d(c,"IMSUB",(function(){return Mi})),r.d(c,"IMCONJUGATE",(function(){return Di})),r.d(c,"COMPLEX",(function(){return xi})),r.d(c,"BESSELI",(function(){return Li})),r.d(c,"BESSELJ",(function(){return Ui})),r.d(c,"BESSELK",(function(){return Bi})),r.d(c,"BESSELY",(function(){return Hi})),r.d(c,"BIN2DEC",(function(){return Ki})),r.d(c,"BIN2OCT",(function(){return qi})),r.d(c,"BIN2HEX",(function(){return Qi})),r.d(c,"OCT2DEC",(function(){return Xi})),r.d(c,"OCT2BIN",(function(){return Ji})),r.d(c,"OCT2HEX",(function(){return $i})),r.d(c,"HEX2DEC",(function(){return Zi})),r.d(c,"HEX2BIN",(function(){return eu})),r.d(c,"HEX2OCT",(function(){return tu})),r.d(c,"DEC2BIN",(function(){return ru})),r.d(c,"DEC2HEX",(function(){return nu})),r.d(c,"DEC2OCT",(function(){return ou})),r.d(c,"DATEDIF",(function(){return au})),r.d(c,"ERF",(function(){return su})),r.d(c,"ERFC",(function(){return iu})),r.d(c,"CONVERT",(function(){return Su})),r.d(c,"DELTA",(function(){return Cu})),r.d(c,"GESTEP",(function(){return Tu}));var d={};r.r(d),r.d(d,"FVSCHEDULE",(function(){return vl})),r.d(d,"PMT",(function(){return yl})),r.d(d,"RATE",(function(){return bl})),r.d(d,"IPMT",(function(){return Al})),r.d(d,"PPMT",(function(){return El})),r.d(d,"FV",(function(){return Rl})),r.d(d,"PV",(function(){return Sl})),r.d(d,"IRR",(function(){return Il})),r.d(d,"CUMIPMT",(function(){return kl})),r.d(d,"CUMPRINC",(function(){return Ml})),r.d(d,"EFFECT",(function(){return Dl})),r.d(d,"NOMINAL",(function(){return xl})),r.d(d,"SYD",(function(){return Fl})),r.d(d,"SLN",(function(){return Pl})),r.d(d,"PRICE",(function(){return Ll})),r.d(d,"PRICEDISC",(function(){return Ul})),r.d(d,"PRICEMAT",(function(){return Bl})),r.d(d,"YIELD",(function(){return Gl})),r.d(d,"YIELDMAT",(function(){return Vl})),r.d(d,"YIELDDISC",(function(){return Wl})),r.d(d,"DB",(function(){return Yl}));var f={};r.r(f),r.d(f,"AND",(function(){return ql})),r.d(f,"FALSE",(function(){return Ql})),r.d(f,"IF",(function(){return Xl})),r.d(f,"OR",(function(){return Jl})),r.d(f,"TRUE",(function(){return $l})),r.d(f,"CHOOSE",(function(){return Zl})),r.d(f,"NOT",(function(){return ec})),r.d(f,"XOR",(function(){return tc}));r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.object.assign.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var h=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),m=(r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/esnext.array.last-index.js"),r("./src/core/feature/formula/utils.ts")),p=(r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.every.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.number.constructor.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js")),v=r("./src/core/feature/formula/lib/utils.js"),g=(r("../node_modules/core-js/modules/es.array.find.js"),r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/es.number.is-nan.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/regenerator-runtime/runtime.js"),r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js")),y=r("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),_=(r("../node_modules/core-js/modules/es.function.name.js"),r("./src/core/feature/formula/lib/spreadjs/common/resource.js")),b=(r("../node_modules/core-js/modules/es.array.last-index-of.js"),r("../node_modules/core-js/modules/es.string.trim.js"),r("./src/core/feature/formula/lib/spreadjs/common/dateTimeHelper.js")),A=r("./src/core/feature/formula/lib/spreadjs/common/stringHelper.js"),E=Math.abs,j=(Math.pow,function(e){this.array=e});function R(e,t){return"number"===Object(h.a)(e)||e instanceof Date||!t&&("boolean"===Object(h.a)(e)||!isNaN(e)&&!isNaN(parseFloat(e)))}function S(e){return Object(m.v)(e)}function C(e){return isNaN(e)||!isFinite(e)}function T(e){var t=w(e);if(E(t)<1e21)return parseInt(t,10);throw new Error(m.l.value)}function w(e){var t={value:0};if(I(e,t))return t.value;throw new Error(m.l.value)}var O={JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12};function I(e,t){var r=null;if(!e)return t.value=0,!0;var n=Object(h.a)(e);try{if("number"===n)r=e;else if("string"===n){if(0===(e=e.trim()).length)return t.value=0,!0;0;var o=!1;if("%"===e.charAt(e.length-1)&&(o=!0,e=e.substr(0,e.length-1)),"$"===e[0])return!1;if(e.indexOf(".")!==e.lastIndexOf("."))return!1;if(e.length>=2&&"0"===e[0]&&"x"===e[1])return!1;if(C(r=Number(e).valueOf())){var a=e.charCodeAt(0);if(a|=32,e.length>4&&a>=96&&a<=122){var s=e[0]+e[1]+e[2];if(s=s.toUpperCase(),!O[s])return!1}if("/"===e[0]||"/"===e[e.length-1])return!1;if(e.indexOf('"')>-1||e.indexOf("'")>-1)return!1;if(C((r=new Date(e.replace(/-/g,"/"))).valueOf()))return!1;r=b.default._toOADate(r)}o&&(r/=100)}else if("boolean"===n)r=e?1:0;else{if(!(e instanceof Date))return!1;r=b.default._toOADate(e)}}catch(i){return!1}return t.value=r,!0}function N(e,t){try{if(e)if("boolean"===Object(h.a)(e));else if(e instanceof Date)e=0!==b.default._toOADate(e);else{if(!R(e))return!1;e=0!==e}else e=!1}catch(r){return!1}return t.value=e,!0}function k(e){try{if(void 0===e||null===e)return"";if("boolean"===Object(h.a)(e))return e?"TRUE":"FALSE";if("string"===Object(h.a)(e))return e;if(e instanceof Date)return b.default._toOADate(e).toString();if(function(e){return e instanceof j}(e))throw new Error(m.l.value);return e.toString()}catch(t){throw new Error(m.l.value)}}function M(e){return C(e)?m.l.num:e}function D(e){var t={value:null};if(F(e,t))return t.value;throw new Error(m.l.value)}function x(e){var t;if(e&&e.length&&e.rowCount&&e.colCount)return e.error=e.error||[],e;if(Object(v.m)(e))(t=e.toArray()).isReference=!0;else if(Array.isArray(e)&&e.length>0){(t=[]).error=[];for(var r=e[0],n=0,o=!0,a=0;a<r.length;a++)for(var s=0;s<r[a].length;s++){for(var i=0;i<e.length;i++){o&&(n+=e[i][a].length);var u=e[i][a][s];t.error&&t.error.length>0||!Object(m.v)(u)||(t.error=[u]),t.push(u)}o=!1}t.isArray=!0,t.rowCount=e[0].length,t.colCount=n,t.rangeCount=1}else(t=[]).error=[],t.push(e),t.rowCount=1,t.colCount=1,t.rangeCount=1;return t}function F(e,t){if(e)if(e instanceof Date)t.value=new Date(e);else if("string"===Object(h.a)(e)){var r=b.default._parseLocale(e);if(!r)if(isNaN(e)){if(r=new Date(e),isNaN(r.valueOf()))return!1;try{var n=A.a._trimEnd(A.a._trimStart(e.replace(/ |\n/g,"")," ")," "),o=/^[-+=\s]*(\d+)\W+(\d+)\W+(\d+)$/.exec(n);if(o&&4===o.length&&(-1===o.indexOf(r.getYear().toString())||-1===o.indexOf(r.getMonth().toString())||-1===o.indexOf(r.getDate().toString())))return!1}catch(a){return!1}}else if(!(r=b.default._fromOADate(parseFloat(e))))return!1;t.value=r}else{if("number"!==Object(h.a)(e))return!1;t.value=b.default._fromOADate(e)}else t.value=b.default._fromOADate(0);return!0}var P={},L=r("./src/core/feature/formula/lib/spreadjs/common/arrayHelper.js"),U=r("./src/core/feature/formula/lib/spreadjs/common/regexHelper.js"),B=(r("../node_modules/core-js/modules/es.string.match.js"),r("./src/core/feature/formula/lib/spreadjs/common/types.js")),H=r("./src/core/feature/formula/ast_node/utils.ts"),G=B.a._isNullOrUndefined,V=L.a._getLength,W=isNaN,Y=Math.abs,z=Math.exp,K=Math.log,q=Math.pow,Q=0,X=1,J=2,$=3,Z=4,ee=5,te=179769e303;function re(e,t){return e===t||Y(e-t)<Y(e)/281474976710656}function ne(e,t,r){var n;return!(2!==e&&4!==e&&"string"===typeof t&&"string"===typeof r&&!isNaN(r)&&!r.match(/^(0x|0b|0o)/i))&&(0===e?n=t<=r:1===e?n=t>=r:2===e?n=t!==r:3===e?n=t<r:4===e?n=t===r:5===e&&(n=t>r),n)}function oe(e,t){var r=-1,n=!0,o={value:0},a=U.default._getWildcardCriteriaFullMatch(t),s=!1;if(e===Z&&(s=!0),G(t))n=!1,r=null;else if(""===t)n=!1,r="";else if(a){n=!1;var i=function(e){var t=U.default._getRegWithConditions(a,"gim");return t.lastIndex=0,t.test(e)}}else I(t.toString(),o)?r=o.value:n=!1;return function(o){if(Object(m.v)(o))return!1;var u={value:0};if(null===o&&e===Z&&""===t)return!0;if(null===o&&e!==J)return!1;if(n&&""!==o&&I(o,u))return ne(e,u.value,r);if(a&&R(o,!0))return!1;if(i&&!s){var l=i(o.toString()),c=o.toString().toUpperCase(),d=c;return l||(d=G(t)?"":t.toString().toUpperCase()),ne(e,c,d)}var f=G(t)?null:t.toString().toUpperCase(),h=G(o)?null:o.toString();return a&&s?i(h):ne(e,null===h?h:h.toUpperCase(),f)}}var ae={},se={_approxFloor:function(e){var t=Math.floor(e);return re(e,t+1)?t+1:t},_parseCriteria:function(e){var t=e;Object(H.a)(t)&&(t=x(t));var r=ae;r||(ae=r={});var n=r[t];if(n)return n;if(R(t))return n=r[t]=oe(Z,t);var o,a,s=G(t)?"":t.toString().toUpperCase(),i="\0";for(o=0;o<2&&o<V(s);o++){if(a=s[o],-1==="=><".indexOf(a)){if("<"===i)return r[t]=n=oe($,s.substring(1)),n;if(">"===i)return r[t]=n=oe(ee,s.substring(1)),n;break}if("="===a)return n="<"===i?oe(Q,s.substring(2)):">"===i?oe(X,s.substring(2)):oe(Z,"\0"===i?s.substring(1):t),r[t]=n,n;if("\0"===i)i=a;else{if("<"===i)return n=">"===a?oe(J,s.length>2?s.substring(2):null):oe($,s.substring(1)),r[t]=n,n;if(">"===i)return r[t]=n=oe(ee,s.substring(1)),n}}return r[t]=n=oe(Z,t),n},_pow10:function(e){var t=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13,1e14,1e15,1e16][e];return G(t)?q(10,parseFloat(e)):t},_approxCeiling:function(e){var t=Math.ceil(e);return re(e,t-1)?t-1:t},_round:function(e,t){var r=se._pow10(Y(t));return e=(e=t<0?e/r:e*r)<0?se._approxCeiling(e-.5):se._approxFloor(e+.5),M(e=t<0?e*r:e/r)},_combin:function(e,t){if(e<0||t<0||e<t)return CalcErrorsNumber;var r,n=1;for(t=Math.min(e-t,t),r=1;r<=t;r++)n*=e-r+1,n/=r;return M(n)},_pow1p:function(e,t){var r=Y(e)>.5?q(1+e,t):z(t*K(1+e));return isFinite(r)?W(r)&&(r=5e-324):r===Number.POSITIVE_INFINITY?r=te:r===Number.NEGATIVE_INFINITY&&(r=-te),r},_sinhCosh:function(e,t){return(z(e)+(t?-1:1)*z(-e))/2},_log:function(e,t){return W(e)?e:W(t)?t:1!==t&&1===e||0!==t&&t!==Number.POSITIVE_INFINITY?K(e)/K(t):NaN}},ie=se,ue=b.default._toOADate,le=L.a._getLength,ce=B.a._inArray,de=(B.a._isNullOrUndefined,isNaN,parseInt),fe=Math.abs,he=(Math.exp,Math.log,Math.pow,Math.floor,m.l.value,m.l.num),me=(m.l.div0,m.l.na),pe=m.l.null,ve=T,ge=w;var ye={};function _e(e){return e%400===0||e%4===0&&e%100!==0}function be(e,t){switch(t){case 0:case 2:case 4:return 360;case 1:return _e(e.getFullYear())?366:365;case 3:return 365;default:return-1}}function Ae(e,t){return e-t}function Ee(e,t){return ce(t,[0,2,4,6,7,9,11])>=0?31:ce(t,[3,5,8,10])>=0?30:1===t?_e(e)?29:28:void 0}function je(e,t,r,n){var o=r.getFullYear(),a=r.getMonth(),s=r.getDate(),i=n.getFullYear(),u=n.getMonth(),l=n.getDate();if(e){var c=1===a&&Ee(o,a)===s,d=1===u&&Ee(i,u)===l;t?(c&&d&&(l=30),c&&(s=30),31===s&&(s=30),30===s&&31===l&&(l=30),31===l&&(l=30)):(31===s&&(s=30),31===l&&(l=30))}return 360*(i-o)+30*(u-a)+l-s}function Re(e,t,r){var n=1;if(Ae(e,t)>0){var o=e;e=t,t=o,n=-1}return ce(r,[1,2,3])>=0?n*ve(ue(t)-ue(e)):ce(r,[4,5])>=0?n*je(!0,!1,e,t):n*je(!0,!0,e,t)}function Se(e){var t,r=[];for(t=0;t<le(e);t++)Te(e[t],r);return r}function Ce(e){e.sort((function(e,t){return e-t}))}function Te(e,t){for(var r=0;r<le(e);r++){var n=e[r];n!==P&&t.push(n)}Ce(t)}function we(e,t,r){var n=[];Te(t,n);var o=le(n);return r<=0||o<r?he:e?n[o-r]:n[r-1]}function Oe(e,t,r){this._real=e,this._imag=t,this._suffix=r||"i"}function Ie(e,t){return e.charAt(t)}function Ne(e,t){for(var r=e.length,n=!1;t<r&&!isNaN(Ie(e,t));)t++,n=!0;for(t<r&&"."===Ie(e,t)&&t++;t<r&&!isNaN(Ie(e,t));)t++,n=!0;if(t<r&&("E"===Ie(e,t)||"e"===Ie(e,t)))for(n=!1,++t<r&&("+"===Ie(e,t)||"-"===Ie(e,t))&&t++;t<r&&!isNaN(Ie(e,t));)t++,n=!0;return{_digitFlag:n,_index:t}}function ke(e){try{return e?"number"===typeof e?new Oe(parseFloat(e),0):"string"===typeof e?function(e){var t,r,n,o=0,a=0,s=!1,i=0,u=0,l=0,c=e.length;if(!e)throw _.b.Exp_ArgumentNull;if(0===c)throw _.b.Exp_Format;l<c&&("+"===Ie(e,l)||"-"===Ie(e,l))&&l++;var d=Ne(e,l);if(l=d._index,t=d._digitFlag,l<c&&("+"===Ie(e,l)||"-"===Ie(e,l))?(i=l,l=(d=Ne(e,++l))._index,r=d._digitFlag,l<c&&("i"===Ie(e,l)||"j"===Ie(e,l))&&(n=Ie(e,l),l++,s=!0),u=l-i):l<c&&("i"===Ie(e,l)||"j"===Ie(e,l))?(n=Ie(e,l),u=++l,r=t,s=!0,t=!1):i=l,l<c)throw _.b.Exp_Format;if(i>0){if(!t)throw _.b.Exp_Format;o=parseInt(e.substr(0,i),10)}if(u>0){if(!s)throw _.b.Exp_Format;if(1===u||2===u&&"+"===Ie(e,i))a=1;else if(2===u&&"-"===Ie(e,i))a=-1;else{if(!r)throw _.b.Exp_Format;a=parseInt(e.substr(i,u-1),10)}}return new Oe(o,a,n)}(e):null:new Oe(0,0)}catch(t){return null}}ye._MAX_DOUBLE_VALUE=179769e303,ye._isBoolean=function(e){return"boolean"===typeof e},ye._isString=function(e){return"string"===typeof e},ye._isNumber=function(e){return"number"===typeof e},ye._isLeapYear=_e,ye._annualYearBasis=be,ye._compareDateTime=Ae,ye._getDaysInMonth=Ee,ye._daysBetweenBasis=Re,ye._st_normsdist=function(e){var t,r,n;return r=0===e?0:(n=.5*fe(e))>=3?1:n<1?((((((((.000124818987*(t=n*n)-.001075204047)*t+.005198775019)*t-.019198292004)*t+.059054035642)*t-.151968751364)*t+.319152932694)*t-.5319230073)*t+.797884560593)*n*2:(((((((((((((-45255659e-12*(n-=2)+.00015252929)*n-19538132e-12)*n-.000676904986)*n+.001390604284)*n-.00079462082)*n-.002034254874)*n+.006549791214)*n-.010557625006)*n+.011630447319)*n-.009279453341)*n+.005353579108)*n-.002141268741)*n+.000535310849)*n+.999936657524,e>0?.5*(r+1):.5*(1-r)},ye._st_includeAggregateMulti=function(e,t){var r,n,o=13===t,a=14===t,s=15===t;return 12===t?function(){var e=Se(arguments[0]),t=le(e);return 0===t?he:t%2===0?(ge(e[t/2-1])+ge(e[t/2]))/2:e[de((t/2).toString())]}(e):o?function(){var e,t,r,n=null,o=0,a=arguments[0],s=le(a);for(e=0;e<s;e++){for(r=0,t=0;t<s;t++)t!==e&&a[t]===a[e]&&r++;r>o&&(o=r,n=a[e])}return 0===o?me:n}(e):a?(r=e[0],n=e[1],we(!0,r,n)):s?function(e,t){return we(!1,e,t)}(e[0],e[1]):pe},ye._fact=function(e){var t,r=1;for(t=e;t>1;t--)r*=t;return r},ye._days360=function(e,t,r){var n=e.getDate(),o=t.getDate(),a=e.getMonth(),s=t.getMonth(),i=e.getFullYear(),u=t.getFullYear();return n=31===n?30:n,r?o=31===o?30:o:31===o&&(n<30?(o=1,++s>12&&(s=1,u++)):o=30),30*(12*(u-i)+s-a)+o-n},ye._yearfrac=function(e,t,r){return r<0||r>4?he:function(e,t,r){var n,o=Re(e,t,r);if(o<0){o=-o;var a=e;e=t,t=a}if(1===r){var s,i,u,l,c=e.getFullYear(),d=t.getFullYear();(s=new Date(e.valueOf())).setFullYear(s.getFullYear()+1),Ae(t,s)>0?(l=d+1-c,s=new Date(c,0,1),i=new Date(d+1,0,1),u=ve(ue(i)-ue(s))-365*(d+1-c)):(l=1,u=_e(c)&&e.getMonth()<3||_e(d)&&256*t.getMonth()+t.getDate()>=541?1:0),n=365+ge(u)/ge(l)}else n=be(new Date,r);return o/n}(e,t,r)},Oe.prototype={_getReal:function(){return this._real},_getImag:function(){return this._imag},_getSuffix:function(){return this._suffix},_toString:function(e){e=e||this._suffix||"i";var t=this._real,r=this._imag,n="";return 0===t&&0!==r||(n+=t.toString()),-1===r?n+="-":0!==t&&r>0&&(n+="+"),-1!==r&&0!==r&&1!==r&&(n+=r.toString()),0!==r&&(n+=e),n}},ye._Complex=Oe,ye._convertToComplex=ke,ye.convertArgToComplex=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=ke(e);return r=!r||t&&0===r._getReal()&&0===r._getImag()?m.l.num:{_real:r._getReal(),_imag:r._getImag(),_suffix:r._getSuffix()}};var Me=ye,De=r("./src/core/feature/formula/lib/calcContext.ts"),xe=ie._approxFloor,Fe=B.a._isNullOrUndefined,Pe={};function Le(e){if(e&&e[0]&&e[0].length>1||e&&e[0]&&e[0].length>0&&e[0][0].length>1)return!0;e=v.c(e);var t=!1;return Object(m.v)(e)&&(t=!0),!!(t=t||"number"===typeof e&&(isNaN(e)||!isFinite(e)))&&e!==m.l.na}function Ue(e){if(e&&e[0]&&e[0].length>1||e&&e[0]&&e[0].length>0&&e[0][0].length>1)return!0;e=v.c(e);var t=!1;return Object(m.v)(e)&&(t=!0),t||"number"===typeof e&&(isNaN(e)||!isFinite(e))}function Be(e){var t=De.a._instance,r=e.getRow(0),n=e.getColumn(0),o=e.getSheetId(0),a=t.custom.cellEditValue(r,n,o);return!!Object(m.C)(a)}function He(e){return!0===e||!1===e}function Ge(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if((t=v.i(t)).length>1)return!1;var n=v.c(t);return n===m.l.na}function Ve(e){var t=v.i(e);if(t.length>1&&!e.__isUserWrite)return!1;var r=t[0];return""!==r&&null!==r&&void 0!==r&&"boolean"!==typeof r&&!Ue(r)&&("number"===typeof r&&!("number"!==typeof(r=Number(r))||isNaN(r)||!isFinite(r)))}function We(e){return Object(H.a)(e)}function Ye(e){return"string"===typeof e}function ze(){return m.l.na}function Ke(e){return Ve(e)?1:Ye(e)?2:He(e)?4:Ue(e)?16:Array.isArray(e)?64:void 0}function qe(e){return""===e||Fe(e)}function Qe(e){return"number"!==typeof(e=Object(v.B)(e,De.a._astNodes[0],!1))&&""!==e?m.l.value:xe(Math.abs(e))%2!==0}function Xe(e){return"number"!==typeof(e=Object(v.B)(e,De.a._astNodes[0],!1))&&""!==e?m.l.value:xe(Math.abs(e))%2===0}function Je(e){return Array.isArray(e)&&(e=(e=v.i(e))[0]),R(e,!0)?w(e):(e=v.y(e,De.a._astNodes[0]),Me._isBoolean(e)?e?1:0:S(e)?e:0)}Pe.TYPE=function(e){switch(e){case m.l.null:return 1;case m.l.div0:return 2;case m.l.value:return 3;case m.l.ref:return 4;case m.l.name:return 5;case m.l.num:return 6;case m.l.na:return 7;case m.l.data:return 8}throw new Error(m.l.na)};r("../node_modules/core-js/modules/es.string.split.js");var $e=r("./src/core/feature/formula/lib/idCard/chineseLunar.js"),Ze=r.n($e),et=function(e,t,r){return{0:"\u661f\u671f\u4e00",1:"\u661f\u671f\u4e8c",2:"\u661f\u671f\u4e09",3:"\u661f\u671f\u56db",4:"\u661f\u671f\u4e94",5:"\u661f\u671f\u516d",6:"\u661f\u671f\u5929"}[new Date(e,t-1,r).getUTCDay()]},tt=function(e){return(e=e%12-4)<0&&(e+=12),"\u9f20\u725b\u864e\u5154\u9f99\u86c7\u9a6c\u7f8a\u7334\u9e21\u72d7\u732a"[e]},rt=function(e,t){var r=2*e-(t<[20,19,21,21,21,22,23,23,23,23,22,22][e-1]?2:0);return"\u6469\u7faf\u6c34\u74f6\u53cc\u9c7c\u767d\u7f8a\u91d1\u725b\u53cc\u5b50\u5de8\u87f9\u72ee\u5b50\u5904\u5973\u5929\u79e4\u5929\u874e\u5c04\u624b\u6469\u7faf".substring(r,r+2)+"\u5ea7"};function nt(e){e=e.toString();for(var t=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],r=0,n=0;n<17;n++)r+=e[n]*t[n];return[1,0,"X",9,8,7,6,5,4,3,2][r%11]}function ot(e){var t,r,n,o,a,s,i;return"TIME_ERROR"!=(a=function(e){e=(e=e.split(/\/|\\|-/))[0]+"-"+e[1]+"-"+e[2];var t=new Date(e);try{var r=Ze.a.solarToLunar(t);return r.year+"-"+r.month+"-"+r.day}catch(n){return"TIME_ERROR"}}(t=(o=(e=e.toString()).substr(6,4))+"-"+(r=e.substr(10,2))+"-"+(n=e.substr(12,2))))?(s=a.substr(0,4),i=tt(s)):i=null,{date:t,nong:a,year:o,month:r,day:n,week:et(o,r,n),zodiac:rt(r,n),zodiac_zh:i}}function at(e){return e=e.toString(),!(!/^\d{17}(\d|x)$/i.test(e)||nt(e)!=e[17].toUpperCase())}function st(e){if(e=e.toString(),/(^\d{15}$)/.test(e))return function(e){return e=e.toString(),/(^\d{17}$)/.test(e)?e+nt(e):/(^\d{18}$)/.test(e)?e.slice(0,17)+nt(e):void 0}(e.slice(0,6)+"19"+e.slice(6,15))}function it(e){return(e=e.toString())[16]%2?"\u7537":"\u5973"}var ut={},lt=(ut.BAND_INDEX_CONST=-2147483648,ut.MAX_ROW_COUNT=1048576,ut.MAX_COLUMN_COUNT=16384,[14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,11,24,24,24,26,24,24,24,20,21,24,25,24,19,24,24,8,8,8,8,8,8,8,8,8,8,24,24,25,25,25,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,20,24,21,27,18,27,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,20,25,21,25,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,11,24,26,26,26,26,28,28,27,28,1,22,25,19,28,27,28,25,10,10,27,1,28,24,27,10,1,23,10,10,10,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,25,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,25,1,1,1,1,1,1,1,1]);function ct(e){return e<=255}function dt(e){return e<=127}ut.isDigit=function(e){return e>=48&&e<=57};ut._isLetter=function(e){var t=e.charCodeAt(0);return!ct(t)||(dt(t)?(t|=32)>=96&&t<=122:0===lt[t]||1===lt[t])};ut._isLetterOrDigit=function(e){var t=e.charCodeAt(0);return!ct(t)||(dt(t)?t<=57?t>=48:(t|=32)>=96&&t<=122:0===lt[t]||1===lt[t])};var ft=ut,ht=r("./src/core/feature/formula/type.ts"),mt=r("../packages/model/src/utils/numberFormat/FormatParseEngine.ts"),pt=ie._pow10,vt=ie._approxFloor,gt=ie._approxCeiling,yt=L.a._getLength,_t=Math.abs,bt=Math.sqrt,At=Math.floor,Et=Math.exp,jt=Math.log,Rt=Math.PI,St=Math.random;function Ct(e){if(v.b(e))throw new Error(e);if(e=v.A(e||0),v.b(e))throw new Error(e);return Math.abs(e)}function Tt(e,t,r){var n;switch(r){case"&":n=Array.isArray(e)&&!Array.isArray(t)?e.map((function(e){return e.map((function(e){return e.map((function(e){return null===e?t.toString():e.toString()+t.toString()}))}))})):Array.isArray(t)&&!Array.isArray(e)?t.map((function(t){return t.map((function(t){return t.map((function(t){return null===t?e.toString():e.toString()+t.toString()}))}))})):e.toString()+t.toString()}return n}function wt(e){var t=e;return v.m(t)&&((t=t.toArray()).error&&t.error.length?t=new Error(t.error[0]):null===(t=t[0])?t=0:Object(m.G)(t)&&(t=new Error(m.l.ref))),t}function Ot(e){var t=e;if("string"===typeof t&&""!==t){var r=Number(t).valueOf();if(isNaN(r)){var n=mt.parseValue(t);t=n?n.numericValue:t}else t=r}return t}function It(e,t,r){var n,o=[e,t].map(wt),a=Object(y.a)(o,2),s=a[0],i=a[1],u=[s,i].find((function(e){return e instanceof Error}));if(u)throw u;var l=[s,i].map(Ot),c=Object(y.a)(l,2);if(s=c[0],i=c[1],s=v.d(s),i=v.d(i),isNaN(s)||isNaN(i)||""===s||""===i){if(s&&"="===s[0]||i&&"="===i[0])throw new Error(m.l.needUpdate);throw new Error(m.l.value)}switch(r){case"+":n=Vt(s,i);break;case"-":n=Wt(s,i);break;case"/":n=Yt(s,i);break;case"*":n=zt(s,i);break;case"^":n=$t(s,i)}return n}function Nt(e,t,r){if(Le(e))return e;if(Le(t))return t;var n;switch("TRUE"===e&&(e=!0),"TRUE"===t&&(t=!0),"FALSE"===e&&(e=!1),"FALSE"===t&&(t=!1),null!==e||0!==t&&""!==t||(e=t),null!==t||0!==e&&""!==e||(t=e),r){case"=":"string"===typeof e&&"string"===typeof t&&(e=e.toUpperCase(),t=t.toUpperCase()),n=e===t;break;case">":n=1===v.g(e,t);break;case"<":n=-1===v.g(e,t);break;case">=":n=v.g(e,t)>-1;break;case"<=":n=v.g(e,t)<1;break;case"<>":case"NOT":"string"===typeof e&&"string"===typeof t&&(e=e.toUpperCase(),t=t.toUpperCase()),n=e!==t}return n}function kt(e,t){return Mt.apply(this,arguments)}function Mt(){return(Mt=Object(g.a)(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=De.a._funcNode,e.abrupt("return",new Promise((function(e){Object(m.u)(t,r,(function(t){if(t.error){e(t.error);var r=De.a._element,o=De.a._funcNode;De.a._instance.custom.markNodeToRecalculateAfterNetworkChange(r.id,o.id)}else n.setFormatType(t.currencyFormat),e(t.result)}),n)})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Dt(e,t){if(arguments.length<1)throw new Error(m.l.value);return parseInt(e,t)}function xt(e){return e=v.B(e,De.a._astNodes[0]),isNaN(e)?m.l.value:"number"!==typeof(e=v.A(e||0))?e:Math.floor(e)}var Ft={CEILING:Ar};function Pt(e,t){var r=De.a._astNodes,n=v.A(e),o=r[0];if(v.b(n)&&(""!==e||!v.n(o)))throw new Error(m.l.value);var a=r[1],s=null===t?0:v.A(t);if(v.b(s)&&(""!==t||!v.n(a)))throw new Error(m.l.value);if(0===s||v.n(a)&&""===a.value)throw new Error(m.l.div0);return n-s*xt(n/s)}function Lt(){if(arguments.length>0)throw new Error(m.l.error);return Math.random()}function Ut(e,t){return e=v.A(e||0),"number"===typeof(t=v.A(t||0))&&(t=Math.floor(t)),v.b(e)?e:v.b(t)?t:ie._round(e,t)}function Bt(e,t){if(e=e,e=v.A(e||0),t=t,t=v.A(t||0),v.b(e,t))throw new Error(m.l.value);var r=e>0?1:-1;return t<0?r*Math.ceil(Math.abs(e)*Math.pow(10,t))*Math.pow(10,-t):r*Math.ceil(Math.abs(e)*Math.pow(10,t))/Math.pow(10,t)}function Ht(e){if(e=v.A(e||0),v.b(e))return e;if(e<0)throw new Error(m.l.num);return Math.sqrt(e)}function Gt(){for(var e,t,r,n,o,a,i,u,l=arguments.length,c=new Array(l),d=0;d<l;d++)c[d]=arguments[d];var f=v.A(c[0]);if(f<1||f>11&&f<101||f>111)throw new Error(m.l.value);if(v.b(f))return f;var h,g=c.slice(1),y=[],_={},b=De.a._instance.custom.isCellHidden;if(g)for(var A=0;A<g.length;A++){var E=g[A];if(!v.m(E))throw new Error(m.l.value);if(E.isCell){var j=E.identities[0];if(b(j.row,j.col,j.sheetId,f>100?"ALL":"FILTER"))continue;y.push(E)}else{y.push(E);for(var R=0;R<E.identities.length;R++)for(var S=E.identities[R],C=S.row;C<S.row+S.rowCount;C++)for(var T=S.col;T<S.col+S.colCount;T++)b(C,T,S.sheetId,f>100?"ALL":"FILTER")&&(_[R]=_[R]||{},_[R][C]=_[R][C]||{},_[R][C][T]=!0)}}else y=g;switch(_.isHiddenCells=!0,y.push(_),f){case 1:h=mn.apply(s,Object(p.a)(y));break;case 2:h=vn.apply(s,Object(p.a)(y));break;case 3:h=gn.apply(s,Object(p.a)(y));break;case 4:h=Tn.apply(s,Object(p.a)(y));break;case 5:h=wn.apply(s,Object(p.a)(y));break;case 6:h=Sr.apply(void 0,Object(p.a)(y));break;case 7:h=(e=On).S.apply(e,Object(p.a)(y));break;case 8:h=(t=On).P.apply(t,Object(p.a)(y));break;case 9:h=nr.apply(void 0,Object(p.a)(y));break;case 10:h=(r=Nn).S.apply(r,Object(p.a)(y));break;case 11:h=(n=Nn).P.apply(n,Object(p.a)(y));break;case 101:h=mn.apply(s,Object(p.a)(y));break;case 102:h=vn.apply(s,Object(p.a)(y));break;case 103:h=gn.apply(s,Object(p.a)(y));break;case 104:h=Tn.apply(s,Object(p.a)(y));break;case 105:h=wn.apply(s,Object(p.a)(y));break;case 106:h=Sr.apply(void 0,Object(p.a)(y));break;case 107:h=(o=On).S.apply(o,Object(p.a)(y));break;case 108:h=(a=On).P.apply(a,Object(p.a)(y));break;case 109:h=nr.apply(void 0,Object(p.a)(y));break;case 110:h=(i=Nn).S.apply(i,Object(p.a)(y));break;case 111:h=(u=Nn).P.apply(u,Object(p.a)(y))}return h}function Vt(e,t){return e+t}function Wt(e,t){return e-t}function Yt(e,t){return 0===t?m.l.div0:e/t}function zt(e,t){return e*t}function Kt(e,t){if(2!==arguments.length)throw new Error(m.l.na);if(e=v.A(e),t=v.A(t),v.b(e,t))throw new Error(m.l.error);return e>=t}function qt(e,t){if(2!==arguments.length)throw new Error(m.l.na);if(e=v.A(e),t=v.A(t),v.b(e,t))throw new Error(m.l.error);return e<t}function Qt(e,t){if(2!==arguments.length)throw new Error(m.l.na);if(e=v.A(e),t=v.A(t),v.b(e,t))throw new Error(m.l.error);return e<=t}function Xt(e,t){if(2!==arguments.length)throw new Error(m.l.na);return e===t}function Jt(e,t){if(2!==arguments.length)throw new Error(m.l.na);return e!==t}function $t(e,t){return 0===e&&0===t?m.l.num:Math.pow(e,t)}function Zt(e,t){var r=De.a._astNodes[0];return v.x(r)&&Array.isArray(e)?e[0][0][0]:Array.isArray(e)||Ue(e)?t:e}function er(e,t){var r=De.a._instance,n=r.helper.getCalcRef,o=De.a._element;r.custom.addDependency({row:o.row,col:o.col,sheetId:o.sheetId},{endRow:o.row,startRow:o.row,endCol:o.col,startCol:o.col,startSheetId:o.sheetId,endSheetId:o.sheetId},ht.c.POSITION_RELY);var a=void 0!==e;return(e=a?e:n([{sheetId:o.sheetId,row:o.row,col:o.col,refType:r.NODE_TYPE.CELL_RANGE_TYPE.CELL,rowCount:1,colCount:1}],!0))&&v.m(e)&&1===e.getRangeCount()?(t?e.getRow(0):e.getColumn(0))+1:Object(m.v)(e)?e:m.l.value}function tr(e){return er(e,!0)}function rr(e){return er(e,!1)}function nr(){var e,t=arguments;t[t.length-1].isHiddenCells&&"[object Object]"===Object.prototype.toString.call(t[t.length-1])&&(e=t[t.length-1],t=Object(p.a)(t).slice(0,-1));var r,n=0;for(r=0;r<t.length;r++){var o,a=t[r],s=void 0,i=!1;if(v.m(a)){if(s=e&&e[r],(o=a.toArray()).error&&o.error.length>0)return o.error[0]}else if(Array.isArray(a)){if((o=x(a)).error&&o.error.length>0)return o.error[0]}else i=!0,o=x(a);for(var u=0;u<o.length;u++){if(s){var l=o.row+Math.floor(u/o.colCount),c=o.col+u%o.colCount;if(s[l]&&s[l][c])continue}var d=o[u];if("number"===typeof d)n+=d;else if(i&&"string"===typeof d){var f=parseFloat(d);if(isNaN(f))throw new Error(m.l.value);n+=f}else i&&"boolean"===typeof d&&(n+=Number(d))}}return n}function or(e){if(v.m(e)){var t=De.a._instance.helper.getRangeValue,r=e.getIdentities(0);e=t({newLine:r.colCount},r)}var n,o,a,s,i,u,l,c,d,f,h,p,g,y,_,b,A=e.rowCount,E=[];if(e.rangeCount>1||A!==e.colCount)return m.l.value;for(n=0;n<A;n++)for(E[n]=[A],s=0;s<A;s++)E[n][s]=n===s?1:0;for(o=0;o<A;o++){if(0===e[o][o]){for(b=!1,i=o+1;!b&&i<A;i++)if(0!==e[i][o]){for(l=o;l<A;l++)y=e[o][l],e[o][l]=e[i][l],e[i][l]=y;for(c=1;c<A;c++)_=E[o][c],E[o][c]=E[i][c],E[i][c]=_;b=!0}if(!b)return m.l.num}for(u=0;u<A;u++)if(u!==o&&0!==e[u][o]){for(p=e[u][o]/e[o][o],d=o;d<A;d++)e[u][d]-=p*e[o][d];for(f=0;f<A;f++)E[u][f]-=p*E[o][f]}}for(a=0;a<A;a++)for(g=e[a][a],h=0;h<A;h++)E[a][h]/=g;return[E]}function ar(e,t){var r=De.a._instance.helper.getRangeValue;if(v.m(e)){var n=e.getIdentities(0);e=r({newLine:n.colCount},n)}if(v.m(t)){var o=t.getIdentities(0);t=r({newLine:o.colCount},o)}var a,s,i,u,l,c,d=e.rowCount,f=e.colCount,h=t.rowCount,p=t.colCount,g=[];if(f!==h)return m.l.value;for(i=0;i<d;i++)for(g[i]=a=[],s=e[i],u=0;u<p;u++){for(c=0,l=0;l<h;l++)c+=s[l]*t[l][u];a[u]=c}return[g]}function sr(e,t){var r,n,o,a,s,i,u=x(e[0]),l=yt(u),c=u.rowCount,d=u.colCount,f=[],h=[],p=[];for(a=1;a<yt(e);a+=2){if((i=x(e[a])).rowCount!==c||i.colCount!==d||1===i.rowCount&&1===i.colCount)return m.l.value;s=ie._parseCriteria(e[a+1]),f.push(i),h.push(s)}for(o=0;o<l;o++){for(n=!0,a=0;a<yt(f)&&(s=h[a],r=f[a][o],n=s&&s(r));a++);n&&"number"===typeof(r=u[o])&&p.push(r)}return t(p)}function ir(){return sr(arguments,(function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t}))}function ur(){return sr(arguments,(function(e){var t=null;return e.length>0&&(t=Math.max.apply(null,e)),t}))}function lr(){return sr(arguments,(function(e){var t=null;return e.length>0&&(t=Math.min.apply(null,e)),t}))}function cr(e,t,r){var n=De.a._instance.helper.getRangeValue;if(v.m(t)&&(t=t.toArray()[0]),r=void 0!==r?r:e,!v.m(e)||!v.m(e))throw new Error(m.l.paramsErr);B.a._isNullOrUndefined(t)&&(t=0);var o,a=0,s=ie._parseCriteria(t),i=e.identities[0],u=r.identities[0],l={sheetId:u.sheetId,row:u.row,col:u.col,rowCount:i.rowCount,colCount:i.colCount,refType:i.refType},c=e.toArray(),d=n(void 0,l);for(o=0;o<L.a._getLength(c);o++)"number"===typeof d[o]&&s&&s(c[o])&&(a=v.k(a,d[o]));return M(a)}function dr(){var e,t,r,n,o,a,s,i=arguments,u=0,l=[],c=0;for(e=0;e<yt(i);e++){if((n=x(i[e])).error&&n.error.length>0)return n.error[0];if(0===e)t=n.rowCount,r=n.colCount,c=yt(n);else if(n.rowCount!==t||n.colCount!==r)throw new Error(m.l.value);l.push(n)}for(e=0;e<c;e++){for(o=1,a=0;a<yt(i);a++){if("number"!==typeof(s=l[a][e])||isNaN(s)){o=0;break}o*=s}u+=o}return M(u)}function fr(e,t){var r=String(e),n=De.a._funcNode;try{if(15===r.length&&(r=String(st(e))),!at(r))return console.warn("\u975e\u6cd5\u8eab\u4efd\u8bc1\u53f7\u7801\uff0c",r),"#\u8eab\u4efd\u8bc1\u53f7\u7801\u9519\u8bef"}catch(a){throw console.warn(a),new Error(m.l.paramsErr)}switch(parseInt(t)){case 0:return function(e){var t=new Date,r=t.getMonth()+1,n=t.getDate(),o=t.getFullYear()-e.substring(6,10)-1;return(e.substring(10,12)<r||e.substring(10,12)==r&&e.substring(12,14)<=n)&&o++,o<=0&&(o=1),o}(r);case 1:return it(r);case 2:return n.setFormatType("yyyy/m/d"),mt.parseDateTimeValue(ot(r).date).numericValue;case 3:return ot(r).zodiac;case 4:var o=ot(r).zodiac_zh;if(!o)throw new Error(m.l.paramsErr);return o;default:throw new Error(m.l.paramsErr)}}function hr(e,t,r){t=v.B(t,De.a._astNodes[0]);var n=T(r=v.B(r,De.a._astNodes[1])),o=w(t),a=pt(Math.abs(n)),s=gt(o=n<0?o/a:o*a),i=vt(o);if(e){var u=s;s=i,i=u}return o=o<0?s:i,M(o=n<0?o*a:o/a)}function mr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return hr.call(this,!1,e,t)}function pr(e,t){return hr.call(this,!1,e,t)}function vr(e,t){return ie._round(e,t)}function gr(e){return""===(e=v.B(e,De.a._astNodes[0]))&&(e=0),e=parseFloat(e),isNaN(e)?m.l.value:M(Math.log(e))}function yr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;return""===(e=v.B(e,De.a._astNodes[0],!0))&&(e=0),""===(t=v.B(t,De.a._astNodes[1],!0))&&(t=1),""===(r=v.B(r,De.a._astNodes[2],!0))&&(r=0),e=w(e),t=w(t),r=w(r),0===t||0===e?0:0!==r&&e<0?!0===n?vt(e/Math.abs(t))*Math.abs(t):gt(e/Math.abs(t))*Math.abs(t):!0===n?gt(e/Math.abs(t))*Math.abs(t):vt(e/Math.abs(t))*Math.abs(t)}function _r(e,t,r){return t=v.B(t,De.a._astNodes[0]),r=v.B(r,De.a._astNodes[1]),t=w(t),r=w(r),0===t||0===r?0:t>0&&r<0?m.l.num:t<0&&r>0?(r=-r,e?vt(t/r)*r:gt(t/r)*r):e?gt(t/r)*r:vt(t/r)*r}function br(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return""===(t=v.B(t,De.a._astNodes[0],!0))&&(t=0),""===(r=v.B(r,De.a._astNodes[1],!0))&&(r=1),t=w(t),r=w(r),0===t||0===r?0:e?gt(t/_t(r))*_t(r):vt(t/_t(r))*_t(r)}var Ar={ORIGIN:function(e,t){return _r(!0,e,t)},MATH:function(e,t,r){return yr(e,t,r,!0)},PRECISE:function(e,t){return br(!0,e,t)}},Er={};function jr(e,t,r,n,o){if(r=void 0===r?1:r,n=void 0===n||n,o=void 0===o?"":o,e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),r=v.B(r,De.a._astNodes[2]),isNaN(e)||isNaN(t)||isNaN(r))return m.l.value;if("string"!==typeof o&&De.a._astNodes[4]&&(o=De.a._astNodes[4].originValue),"string"===typeof n)return m.l.value;if(n=Boolean(n),o=String(o),Number.isNaN(e)||Number.isNaN(t))return m.l.value;if(Number.isNaN(r))return m.l.value;if(e<1||e>ft.MAX_ROW_COUNT||t<1||t>ft.MAX_COLUMN_COUNT||r<1||4<r)return m.l.value;var a=3===r||4===r,s=2===r||4===r,i="";return i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;if(t&&0<yt(t)){var r,n=!ft._isLetter(t[0])&&"_"!==t[0];for(r=1;!n&&r<yt(t);r++)n=!ft._isLetterOrDigit(t[r])&&"_"!==t[r];/^(true)|(false)$/i.test(t)&&(n=!0),n?(e+="'",e+=t.replace("'","''"),e+="'"):e+=t,e+="!"}return e}(i,o),n?i=function(e,t,r){r||(e+="$");return e+=t}(i=function(e,t,r){r||(e+="$");for(var n=e.length;t>.1;t=parseInt((t-1)/26),10)e=A.a._insert(e,n,String.fromCharCode("A".charCodeAt(0)+(t-1)%26));return e}(i,t,s),e,a):(i=Rr(i,"R",e,a),i=Rr(i,"C",t,s)),i}function Rr(e,t,r,n){return e+=t,n?0!==r&&(e+="[",e+=r.toString(),e+="]"):e+=r,e}function Sr(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n;"[object Object]"===Object.prototype.toString.call(t[t.length-1])&&t[t.length-1].isHiddenCells&&(n=t[t.length-1],t=t.slice(0,-1));for(var o=1,a=0,s=0;s<t.length;s++){var i=t[s],u=v.m(i)||Array.isArray(i);if(u){var l=n&&n[s],c=x(i);if(c.error&&c.error.length>0)throw new Error(c.error[0]);for(var d=0;d<c.length;d++){var f=c.row+Math.floor(d/c.colCount),h=c.col+d%c.colCount;if(!(l&&l[f]&&l[f][h])){var p=c[d];"number"!==typeof p||isNaN(p)||(o*=p,a++)}}}else{var g=v.A(i);if(Object(m.v)(g))return g;o*=g,a++}}return 0===a&&(o=0),o}function Cr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),Array.isArray(e)||Array.isArray(t)?m.l.value:t?(e=w(e),1===(t=w(t))?m.l.div0:M(ie._log(e,t))):m.l.num}function Tr(e,t){return t=w(t=v.B(t,De.a._astNodes[0])),isNaN(t)?m.l.value:M(Math[e](t))}function wr(e){return Tr("sin",e)}function Or(e){return Tr("cos",e)}function Ir(e){return Tr("tan",e)}function Nr(e){return Tr("asin",e)}function kr(e){return Tr("acos",e)}function Mr(e){return Tr("atan",e)}function Dr(){return Math.PI}function xr(e){return""===(e=v.B(e,De.a._astNodes[0]))&&(e=0),e=parseFloat(e),isNaN(e)?m.l.value:180*e/Math.PI}function Fr(e){return e=w(e=v.B(e,De.a._astNodes[0])),isNaN(e)?m.l.value:Math.PI*e/180}function Pr(e,t){if(e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),e=Number(e),t=Number(t),isNaN(e)||isNaN(t))return m.l.value;if(0===e&&0===t)return m.l.num;var r=Math.pow(e,t);return isNaN(r)?m.l.num:r}function Lr(e){return e=w(e=v.B(e,De.a._astNodes[0])),isNaN(e)?m.l.value:M(ie._log(e,10))}function Ur(e){return e=w(e=v.B(e,De.a._astNodes[0])),isNaN(e)?m.l.value:M(Math.exp(e))}function Br(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var n=0,o=t.length;n<o;n++){var a=t[n];if(Array.isArray(a))a=(a=v.i(a)).filter((function(e){return"number"===typeof e})),t[n]=a;else{var s=De.a._astNodes[n];if(a=v.B(a,s),v.p(s)&&"number"!==typeof a&&(a=0),a=Number(a),isNaN(a))return m.l.value;t[n]=[a]}}var i,u,l,c,d=0;for(u=0;u<yt(t);u++)for(c=t[u],l=0;l<yt(c);l++)(i=c[l])!==P&&(d+=i*i);return M(d)}function Hr(e,t){for(var r=0,n=t.length;r<n;r++){var o=t[r];if(Array.isArray(o))o=(o=v.i(o)).filter((function(e){return"number"===typeof e})),t[r]=o;else{var a=De.a._astNodes[r];if(o=v.B(o,a),v.p(a)&&"number"!==typeof o&&(o=0),o=Number(o),isNaN(o))return m.l.value;t[r]=[o]}}var s,i,u,l,c,d=0,f=0,h=0,p=[];for(u=0;u<yt(t);u++)for(c=t[u],p.push(c),l=0;l<yt(c);l++)(s=c[l])!==P&&(d+=s,h++);for(i=d/h,u=0;u<yt(t);u++)for(c=p[u],l=0;l<yt(c);l++)(s=c[l])!==P&&(f+=e?(s-i)*(s-i):Math.abs(s-i));return e?M(f):0===h?m.l.div0:M(f/h)}function Gr(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Hr(!1,t)}function Vr(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Hr(!0,t)}function Wr(e,t){if(e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),e=T(e),t=T(t),isNaN(e)||isNaN(t))return m.l.value;if(e<0||e>3999)return m.l.value;if(t<0||t>4)return m.l.value;var r,n,o=["M","D","C","L","X","V","I"],a=[1e3,500,100,50,10,5,1],s=[];for(r=Me._isBoolean(t)?t?0:4:t,n=0;n<7;n+=2){if(2<=n&&a[n-2]-a[n]<=e){var i,u=n,l=n-2;for(i=0;i<r&&u+1<7&&a[l]-a[u+1]<=e;i++)u++;s.push(o[u]),s.push(o[l]),e+=a[u],e-=a[l]}if(1<=n&&a[n-1]<=e&&(s.push(o[n-1]),e-=a[n-1]),1<=n&&a[n-1]-a[n]<=e){var c,d=n,f=n-1;for(c=0;c<r&&d+1<7&&a[f]-a[d+1]<=e;c++)d++;s.push(o[d]),s.push(o[f]),e+=a[d],e-=a[f]}for(;a[n]<=e;)s.push(o[n]),e-=a[n]}return s.join("")}function Yr(e){return e=w(e=v.B(e,De.a._astNodes[0])),isNaN(e)?m.l.value:M(ie._sinhCosh(e,!0))}function zr(e,t){return e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),e=w(e),t=w(t),isNaN(e)||isNaN(t)?m.l.value:0===e&&0===t?m.l.div0:M(Math.atan2(t,e))}function Kr(e){return e=w(e=v.B(e,De.a._astNodes[0])),isNaN(e)?m.l.value:M(jt(e+bt(e*e+1)))}function qr(e){return e=w(e=v.B(e,De.a._astNodes[0])),isNaN(e)?m.l.value:M(jt(e+bt(e*e-1)))}function Qr(e){if(e=w(e=v.B(e,De.a._astNodes[0])),isNaN(e))return m.l.value;var t=Et(e),r=Et(-e);return M(t-r)/(t+r)}function Xr(e){return e=w(e=v.B(e,De.a._astNodes[0])),isNaN(e)?m.l.value:_t(e)>=1?m.l.num:M(jt((1+e)/(1-e))/2)}function Jr(e){return e=w(e=v.B(e,De.a._astNodes[0])),isNaN(e)?m.l.value:M(ie._sinhCosh(e,!1))}function $r(e){return e=w(e=v.B(e,De.a._astNodes[0])),isNaN(e)?m.l.value:_t(e)>=134217728?m.l.num:0===e?m.l.div0:M(1/Math.tan(e))}function Zr(e){return e=w(e=v.B(e,De.a._astNodes[0])),isNaN(e)?m.l.value:0===e?m.l.div0:e>10?1:e<-10?-1:1/Qr(e)}function en(e){return e=w(e=v.B(e,De.a._astNodes[0])),isNaN(e)?m.l.value:M(e<0?Math.PI+Math.atan(1/e):Math.atan(1/e))}function tn(e){return e=w(e=v.B(e,De.a._astNodes[0])),isNaN(e)?m.l.value:Xr(1/e)}function rn(e){return"boolean"===typeof e?m.l.value:(e=w(e=v.B(e,De.a._astNodes[0])),isNaN(e)?m.l.value:e<0?m.l.num:M(bt(e*Rt)))}function nn(e,t){return e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),e=w(e),t=w(t),isNaN(e)||isNaN(t)?m.l.value:e<0&&t>0||t<0&&e>0?m.l.num:0===e||0===t?0:vt(e/t+.5)*t}function on(e,t){return t=v.B(t,De.a._astNodes[0]),t=Number(t),isNaN(t)?m.l.value:(t=t<0?At(t):Math.ceil(t),(e&&t%2===0||!e&&t%2!==0)&&(t+=t<0?-1:1),t)}function an(e){return on(!0,e)}function sn(e){return on(!1,e)}function un(e,t){return Me._isBoolean(e)||Me._isBoolean(t)||v.l(e,De.a._astNodes[0])||v.l(t,De.a._astNodes[1])?m.l.value:(e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),e=T(e),t=T(t),isNaN(e)||isNaN(t)?m.l.value:t<e?m.l.num:T(e+St()*(t-e+1)))}Er.ORIGIN=function(e,t){return _r(!1,e,t)},Er.MATH=function(e,t,r){return yr(e,t,r,!1)},Er.PRECISE=function(e,t){return br(!1,e,t)};var ln=v.i;function cn(e,t){try{return t[0][0].join(e)}catch(r){}}var dn=L.a._getLength,fn=Math.pow,hn=Math.sqrt;function mn(){var e,t=arguments;t[t.length-1].isHiddenCells&&"[object Object]"===Object.prototype.toString.call(t[t.length-1])&&(e=t[t.length-1],t=Object(p.a)(t).slice(0,-1));var r,n=0,o=0;for(r=0;r<t.length;r++){var a,s=t[r],i=void 0,u=!1;if(v.m(s)){if(i=e&&e[r],(a=s.toArray()).error&&a.error.length>0)return a.error[0]}else if(Array.isArray(s)){if((a=x(s)).error&&a.error.length>0)return a.error[0]}else u=!0,a=x(s);for(var l=0;l<a.length;l++){if(i){var c=a.row+Math.floor(l/a.colCount),d=a.col+l%a.colCount;if(i[c]&&i[c][d])continue}var f=a[l];if("number"===typeof f)n+=f,o++;else if(u&&"string"===typeof f){var h=parseFloat(f);if(isNaN(h))throw new Error(m.l.value);n+=h,o++}else u&&"boolean"===typeof f&&(n+=Number(f),o++)}}if(0===o)throw new Error(m.l.div0);return n/o}function pn(e){var t,r,n,o,a=arguments,s=0,i=0,u=(e=x(e)).length,l=a.length,c=[];for(c.push(e),n=1;n<l;n+=2){if((o=x(a[n])).error&&o.error.length>0)return o.error[0];c.push(o);var d=a[n+1],f=ie._parseCriteria(d);c.push(f)}for(r=0;r<u;r++)if("number"===typeof(t=e[r])){var h=!0;for(n=1;n<l&&(h=(f=c[n+1])(c[n][r]));n+=2);h&&(s+=t,i++)}return 0===i?m.l.div0:M(s/i)}function vn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n;"[object Object]"===Object.prototype.toString.call(t[t.length-1])&&t[t.length-1].isHiddenCells&&(n=t[t.length-1],t=t.slice(0,-1));for(var o=[],a=0;a<t.length;a++){var s=t[a],i=void 0,u=void 0,l=!1;if(v.m(s))i=n&&n[a],u=s.toArray();else if(Array.isArray(s)){if((u=x(s)).error&&u.error.length>0)return u.error[0]}else l=!0,u=x(s);for(var c=0;c<u.length;c++){var d=u.row+Math.floor(c/u.colCount),f=u.col+c%u.colCount;if(!(i&&i[d]&&i[d][f])){var h=u[c];l&&"number"!==typeof h&&(h=parseFloat(h)),"number"!==typeof h||isNaN(h)||o.push(h)}}}return o.length}function gn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n,o=De.a._instance;"[object Object]"===Object.prototype.toString.call(t[t.length-1])&&t[t.length-1].isHiddenCells&&(n=t[t.length-1],t=t.slice(0,-1));for(var a=0,s=0;s<t.length;s++){var i=t[s],u=Object(H.a)(i);if(u)for(var l=n&&n[s],c=i.identities,d=0;d<c.length;d++)for(var f=c[d],h=0;h<f.rowCount;h++)for(var m=0;m<f.colCount;m++){var p=f.row+h,v=f.col+m;if(!(l&&l[p]&&l[p][v])){var g=o.custom.cellEditValue(h+f.row,m+f.col,f.sheetId);null!==g&&""!==g&&a++}}else{var y=x(i);a+=y.length}}return a}function yn(e){var t=De.a._astNodes[0];if(Array.isArray(e)){if(v.x(t))return m.l.value;e=v.i(e)}else{if(!v.p(t))return m.l.value;e=[e]}for(var r=0,n=0;n<dn(e);n++)null!==e[n]&&""!==e[n]||r++;return r}var _n={};function bn(e,t){var r=0===t||"*"===t,n=_n[t];return n||(n=ie._parseCriteria(t)),!(r&&null===e||!n||!n(e))}function An(e,t){for(var r=0,n=0;n<L.a._getLength(e);n++)bn(e[n],t)&&r++;return M(r)}function En(e,t){var r,n,o,a=0;if(e=x(e),Array.isArray(t)||Object(H.a)(t)){for(t=x(t),o=0;o<L.a._getLength(t);o++){if(n=An(e,t[o]),Object(m.v)(n))return n;if(r=w(n),isNaN(r))return m.l.value;a+=r}return a}return An(e,t)}function jn(){for(var e,t=0,r=[],n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];if(o.length%2!==0)throw new Error(m.l.paramsLack);Array.isArray(o[0])||(o[0]=[[[o[0]]]]);for(var s=0;s<o.length;s+=2){var i=o[s][0],u=i.length+"-"+i[0].length;if(void 0===e)e=u;else if(e!==u)throw new Error(m.l.value);o[s]=o[s][0];var l=o[s+1];r.push({values:o[s],criteria:l})}for(var c=r[0].values.length,d=r[0].values[0].length,f=function(e){for(var n=function(n){r.every((function(t){var r=t.values,o=t.criteria;return bn(r[e][n],o)}))&&t++},o=0;o<d;o++)n(o)},h=0;h<c;h++)f(h);return t}function Rn(){return(void 0).apply(null,v.i(arguments)).length}function Sn(e,t){var r=De.a._instance.helper.getRangeValue;if(v.m(e)){var n=e.getIdentities(0);e=r({newLine:n.colCount},n)}if(v.m(t)){var o=t.getIdentities(0);t=r({newLine:o.colCount},o)}var a,s,i,u=0,l=t.rowCount,c=t.colCount;for(a=0;a<l;a++)for(s=0;s<c;s++)"number"===typeof t[a][s]&&u++;var d=e.rowCount,f=e.colCount,h=[],m=[],p=u+1;for(u=0,a=0;a<l;a++)for(s=0;s<c;s++)(i=t[a][s])!==P&&(h[u++]=w(i));var g=h.slice(0);for(h.sort((function(e,t){return e-t})),a=0;a<p;a++)m[a]=[0];for(a=0;a<d;a++)for(s=0;s<f;s++)if(R(i=e[a][s])){for(var y=w(i),_=!1,b=0;!_&&b<u;b++)y<=h[b]&&(m[g.indexOf(h[b])][0]++,_=!0);_||m[u][0]++}return[m]}function Cn(e){var t;"[object Object]"===Object.prototype.toString.call(e[e.length-1])&&e[e.length-1].isHiddenCells&&(t=e[e.length-1],e=e.slice(0,-1));for(var r=[],n=0;n<e.length;n++){var o=t&&t[n],a=x(e[n]);if(a.error&&a.error.length>0)throw new Error(a.error[0]);for(var s=0;s<a.length;s++){var i=a.row+Math.floor(s/a.colCount),u=a.col+s%a.colCount;if(!(o&&o[i]&&o[i][u])){var l=a[s];"number"!==typeof l||isNaN(l)||r.push(l)}}}return r}function Tn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=Cn(t);return 0===n.length?0:Math.max.apply(Math,n)}function wn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=Cn(t);return 0===n.length?0:Math.min.apply(Math,n)}var On={};function In(e){if(!e)throw new Error(m.l.na);for(var t=[],r=e[0],n=0;n<r.length;n++)for(var o=0;o<r[n].length;o++)Array.isArray(t[o])||(t[o]=[]),t[o].push(r[n][o]);return[t]}On.P=function(){var e=Nn.P.apply(this,arguments);return v.b(e)?e:Math.sqrt(e)},On.S=function(){var e=Nn.S.apply(this,arguments);return v.b(e)?e:Math.sqrt(e)};var Nn={};function kn(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(r)||""===r)return m.l.value;if(r=w(r=v.B(r,De.a._astNodes[0])),isNaN(r))return m.l.value;if(Array.isArray(t)&&!v.x(De.a._astNodes[1]))t=v.i(t);else{if(!v.p(De.a._astNodes[1]))return m.l.value;t=[t]}if(t=t.filter((function(e){return"number"===typeof e})),v.v(n,De.a._astNodes[2]))return m.l.value;if("string"===typeof n){var o=n.toLowerCase();switch(o){case"true":n=1;break;case"false":case"":n=0}}if("number"!==typeof n)return m.l.value;var a,s,i,u=0,l=0,c=0;for(a=0,i=dn(t);a<i;a++)(s=t[a])!==P&&(s<r?u++:r<s?c++:l++);if(0===l)return m.l.na;var d=(0===n?c:u)+1;return e?d:d+(l-1)/2}Nn.P=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var n=Cn(t),o=n.length,a=0,s=mn.apply(void 0,t),i=0;i<o;i++)a+=Math.pow(n[i]-s,2);return a/o},Nn.S=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var n=Cn(t),o=n.length,a=0,s=mn.apply(void 0,t),i=0;i<o;i++)a+=Math.pow(n[i]-s,2);return a/(o-1)};var Mn={};function Dn(e,t,r){var n=0,o=0,a=ie._parseCriteria(t);if(e.rowCount!==r.rowCount||e.colCount!==r.colCount)return m.l.value;for(var s=0;s<L.a._getLength(e);s++){var i=e[s];if(a&&a(i)){var u=r[s];"number"===typeof u&&(n=v.k(n,u),o++)}}return 0===o?m.l.div0:M(n/o)}function xn(e,t,r,n){var o,a,s,i=e?t.length:t.getRowCount(0),u=e?t[0].length:t.getColumnCount(0),l=[];for(e||(s=t.toArray()),o=0;o<i;o++)for(l[o]=[],a=0;a<u;a++){var c=e?t[o][a]:s[o*u+a];l[o][a]=Dn(r,c,n)}return[l]}function Fn(e,t,r){if(!v.m(e)||!v.m(r)&&void 0!==r)throw new Error(m.l.paramsErr);if(void 0!==r){var n=De.a._instance.helper.getRangeValue,o=e.identities[0];e=n(void 0,o);var a=r.identities[0];if((r=n(void 0,{sheetId:a.sheetId,row:a.row,col:a.col,rowCount:o.rowCount,colCount:o.colCount,refType:o.refType})).error&&r.error.length>0)return r.error[0]}else{if((e=x(e)).error&&e.error.length>0)return e.error[0];r=e}return v.m(t)?xn(!1,t,e,r):Array.isArray(t)?xn(!0,t=t[0],e,r):Dn(e,t,r)}function Pn(){for(var e,t,r,n,o=0,a=0,s=arguments.length,i=new Array(s),u=0;u<s;u++)i[u]=arguments[u];var l=function(){var s=De.a._astNodes[e];if(n=i[e],Array.isArray(n))n=v.i(n),v.x(s)||(n=n.filter((function(e){return null!==e}))),n=n.map((function(e){return e=v.y(e,s,!0),Me._isString(e)?0:e}));else{if(n=v.B(n,s),Me._isString(n)&&!v.p(s))return{v:m.l.value};n=null===n?[]:[n]}for(t=0;t<dn(n);t++)r=n[t],Me._isNumber(r)||Me._isBoolean(r)?(o+=w(r),a++):(null===r||Me._isString(r))&&a++};for(e=0;e<dn(i);e++){var c=l();if("object"===Object(h.a)(c))return c.v}return 0===a?m.l.div0:M(o/a)}function Ln(e,t,r){return e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),""===e?m.l.num:(e=(e=Array.isArray(e)?v.i(e):[e]).filter((function(e){return"number"===typeof e})),Me._st_includeAggregateMulti([e,t],r))}function Un(e,t){return Ln(e,t,15)}function Bn(e,t){return Ln(e,t,14)}function Hn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var n=0,o=t.length;n<o;n++){var a=t[n],s=De.a._astNodes[n];if(Array.isArray(a))a=(a=v.i(a)).filter((function(e){return"number"===typeof e})),t[n]=a;else{if(v.p(s)&&"number"!==typeof a){a=P,t[n]=[a];continue}if(a=v.B(a,s),a=Number(a),isNaN(a))return m.l.value;t[n]=[a]}}return Me._st_includeAggregateMulti(t,12)}Mn.EQ=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return kn(!0,t,e,r)},Mn.AVG=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return kn(!1,t,e,r)};var Gn={};function Vn(e,t,r){for(var n=0,o=e.length;n<o;n++){var a=e[n];Array.isArray(a)?(a=(a=v.i(a)).filter((function(e){return"number"===typeof e})),e[n]=a):(""===(a=v.B(a,De.a._astNodes[n]))&&(a={}),e[n]=[a])}var s={_sumx:0,_sumx2:0,n:0},i=function(e,t){var r,n,o,a,s;for(a=0;a<dn(e);a++)for(r=e[a],s=0;s<dn(r);s++)if(null===(o=r[s]))t.n++;else if(Me._isString(o)){var i={value:0};if(I(o,i))n=i.value,t._sumx+=n,t._sumx2+=n*n;else if(!Array.isArray(r))return m.l.value;t.n++}else{if(S(o))return o;R(o)&&(n=w(o),t._sumx+=n,t._sumx2+=n*n,t.n++)}}(e,s);if(S(i))return i;if(s.n<=t)return m.l.div0;var u=Math.max(0,(s.n*s._sumx2-s._sumx*s._sumx)/(s.n*(s.n-t)));return M(u=r?Math.sqrt(u):u)}function Wn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Vn(t,1,!0)}function Yn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Vn(t,0,!0)}function zn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Vn(t,1,!1)}function Kn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Vn(t,0,!1)}function qn(e,t){if(!Array.isArray(e)||!Array.isArray(t))return m.l.div0;e=(e=v.i(e)).map((function(e){return"number"!==typeof e&&(e=P),e})),t=(t=v.i(t)).map((function(e){return"number"!==typeof e&&(e=P),e}));var r,n,o,a,s=0,i=0,u=0,l=0,c=0,d=dn(t);if(d!==dn(e))return m.l.na;var f,h,p,g=0;for(f=0;f<d;f++)h=e[f],p=t[f],h!==P&&p!==P&&(s+=h,i+=p,u+=h*h,l+=p*p,g++);if(g<=1)return m.l.div0;if(r=s/g,n=i/g,o=Math.sqrt((g*u-s*s)/(g*(g-1))),a=Math.sqrt((g*l-i*i)/(g*(g-1))),0===o||0===a)return m.l.div0;for(f=0;f<d;f++)h=e[f],p=t[f],h!==P&&p!==P&&(c+=(h-r)*(p-n));return M(c/w((g-1)*o*a))}function Qn(e,t){for(var r=0,n=t.length;r<n;r++){var o=t[r];if(Array.isArray(o))o=(o=v.i(o)).filter((function(e){return"number"===typeof e})),t[r]=o;else{var a=De.a._astNodes[r];if(o=v.B(o,a),v.p(a)&&"number"!==typeof o&&(o=0),o=Number(o),isNaN(o))return m.l.value;t[r]=[o]}}var s,i,u,l,c=e?1:0,d=0;for(u=0;u<dn(t);u++)for(s=t[u],l=0;l<dn(s);l++)if((i=s[l])!==P){if(i<=0)return m.l.num;c=e?c*i:c+1/i,d++}return e?d<=0?m.l.div0:M(Math.pow(c,1/d)):0===c?m.l.div0:M(d/c)}function Xn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Qn(!0,t)}function Jn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Qn(!1,t)}function $n(e,t){if(e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),e=w(e),t=w(t),isNaN(e)||isNaN(t))return m.l.value;if(t=Math.floor(t),e<0)return m.l.num;if(t<1||t>1e10)return m.l.num;var r,n,o,a,s=Math.log(Math.sqrt(Math.PI)),i=1/Math.sqrt(Math.PI),u=0,l=e,c=.5*l,d=t%2===0;t>1&&(u=Math.exp(-c));var f=Me._st_normsdist(-Math.sqrt(l));if(S(f))return f;var h=w(f);if(n=d?u:2*h,t>2){if(l=.5*(t-1),o=d?1:.5,c>20){for(r=d?0:s,a=Math.log(c);o<=l;)r=Math.log(o)+r,n+=Math.exp(a*o-c-r),o+=1;return n}for(r=d?1:i/Math.sqrt(c),a=0;o<=l;)a+=r*=c/o,o+=1;return a*u+n}return n}function Zn(){for(var e,t=[],r=0,n=arguments.length;r<n;r++){var o=r<0||arguments.length<=r?void 0:arguments[r];if(Array.isArray(o))o=(o=v.i(o)).filter((function(e){return"number"===typeof e})),t=t.concat(o);else{var a=De.a._astNodes[r];if(o=v.B(o,a),v.p(a)&&"number"!==typeof o)continue;if(o=Number(o),isNaN(o))return m.l.value;t.push(o)}}var s,i,u,l,c,d=0,f=0,h=0,p=0,g=dn(t),y=[];if(g>0){for(c=t,y.push(c),u=0;u<dn(c);u++)(e=c[u])!==P&&(d+=e,f+=e*e,p++);if(p<=3)return m.l.div0;if(s=d/p,0===(i=hn((p*f-d*d)/(p*(p-1)))))return m.l.div0;for(l=0;l<g;l++)for(c=y[l],u=0;u<dn(c);u++)(e=c[u])!==P&&(h+=fn((e-s)/i,4));return M(p*(p+1)*h/((p-1)*(p-2)*(p-3))-3*(p-1)*(p-1)/((p-2)*(p-3)))}}function eo(){return Zn.apply(void 0,arguments)}function to(e,t){Array.isArray(e)&&(e=(e=v.i(e)).map((function(e){return"number"!==typeof e?P:e}))),Array.isArray(t)&&(t=(t=v.i(t)).map((function(e){return"number"!==typeof e?P:e})));var r,n,o,a=0,s=0,i=0,u=0,l=0,c=dn(e);if(c!==dn(t))return m.l.na;for(o=0;o<c;o++)r=e[o],(n=t[o])!==P&&r!==P&&(a+=r,s+=n,i+=n*n,u+=n*r,l++);return 0===l||l*i-s*s===0?m.l.div0:M(a/l-(l*u-s*a)/(l*i-s*s)*(s/l))}function ro(e,t){Array.isArray(e)&&(e=(e=v.i(e)).map((function(e){return"number"!==typeof e?P:e}))),Array.isArray(t)&&(t=(t=v.i(t)).map((function(e){return"number"!==typeof e?P:e})));var r=0,n=0,o=0,a=0,s=0,i=dn(e);if(i!==dn(t))return m.l.na;for(var u=0,l=0;l<i;l++){var c=e[l],d=t[l];Me._isNumber(c)&&Me._isNumber(d)&&(r+=c,n+=d,o+=c*c,a+=d*d,s+=c*d,u++)}return u*o-r*r===0||u*a-n*n===0?m.l.div0:(u*s-r*n)/Math.sqrt((u*o-r*r)*(u*a-n*n))}function no(e,t){Array.isArray(e)&&(e=(e=v.i(e)).map((function(e){return"number"!==typeof e?P:e}))),Array.isArray(t)&&(t=(t=v.i(t)).map((function(e){return"number"!==typeof e?P:e})));var r=0,n=0,o=0,a=0,s=0,i=0,u=dn(t);if(u!==dn(e))return m.l.na;for(var l=0;l<u;l++){var c=t[l],d=e[l];Me._isNumber(c)&&Me._isNumber(d)&&(r+=c,n+=d,o+=c*c,a+=d*d,s+=c*d,i++)}var f=hn((i*o-r*r)*(i*a-n*n));if(0===f)return m.l.div0;var h=(i*s-r*n)/f;return M(h*h)}Gn.SNGL=function(){for(var e=[],t=0,r=arguments.length;t<r;t++){var n=t<0||arguments.length<=t?void 0:arguments[t];De.a._astNodes[t];if(Array.isArray(n))n=(n=v.i(n)).filter((function(e){return"number"===typeof e})),e=e.concat(n);else{if("number"!==typeof n)return m.l.value;e.push(n)}}return Me._st_includeAggregateMulti(e,13)};var oo={};function ao(e,t){var r=Array.isArray(e)?v.i(e):[e],n=Array.isArray(t)?v.i(t):[t],o=0,a=0,s=0,i=0,u=0,l=dn(n);if(l!==dn(r))return m.l.na;for(var c=0;c<l;c++){var d=r[c],f=n[c];if(f!==P&&d!==P&&!S(f)&&!S(d)&&"number"===typeof d&&"number"===typeof f){var h=w(d),p=w(f);o+=h,a+=p,s+=p*p,i+=p*h,u++}}return u*s-a*a===0?m.l.div0:M((u*i-a*o)/(u*s-a*a))}function so(){return ao.apply(void 0,arguments)}function io(e,t){if("number"!==typeof t||t<0||t>=1)throw new Error(m.l.num);var r=0,n=[];Te(v.i(e).filter((function(e){return"number"===typeof e})),n);for(var o=function(e){for(var t=0,r=0;r<e.length;r++)e[r]!==P&&t++;return t}(n),a=parseInt((o*t/2).toString(),10),s=a;s<o-a;s++)r+=w(n[s]);return r/(o-2*a)}function uo(){return io.apply(void 0,arguments)}function lo(e,t){for(var r=[],n=function(e,n){var o=t[n],a=De.a._astNodes[n];if(Array.isArray(o))o=(o=(o=v.i(o)).map((function(e){return v.x(a)||(e=v.y(e,a,!0),Me._isString(e)&&(e=0)),e}))).filter((function(e){return Me._isNumber(e)})),r=r.concat(o);else{if(""===(o=v.B(o,a)))return"continue";if(o=w(o),isNaN(o))return{v:m.l.value};r.push(o)}},o=0,a=t.length;o<a;o++){var s=n(0,o);if("continue"!==s&&"object"===Object(h.a)(s))return s.v}var i,u,l,c=!1,d=0;for(u=0;u<dn(r);u++)if(R(l=r[u])||Me._isBoolean(l)||Me._isString(l))i=Me._isString(l)?0:w(l),(!c||e&&i>d||!e&&i<d)&&(d=i),c=!0;else if(S(l))return l;return d}function co(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return lo(!0,t)}function fo(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return lo(!1,t)}function ho(e,t,r){var n,o,a=dn(e);if(t!==e[0]){var s=0,i=e[0];for(o=1;o<a&&e[o]<t;o++)e[o]!==i&&(s=o,i=e[o]);if(e[o]!==i&&(s=o),t===e[o])n=r?s/(a-1):(o+1)/(a+1);else if(0===s)n=0;else{var u=(t-e[s-1])/(e[s]-e[s-1]);n=r?(s-1+u)/(a-1):(s+u)/(a+1)}}else n=r?0:1/(a+1);return n}function mo(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n=arguments.length>3?arguments[3]:void 0;if(e=Array.isArray(e)?(e=v.i(e)).filter((function(e){return"number"===typeof e})):[e=v.B(e,De.a._astNodes[0])],t=v.B(t,De.a._astNodes[1]),r=v.B(r,De.a._astNodes[2],!0),t=w(t),isNaN(t))return m.l.value;if(""===r&&(r=3),(r=T(r))<1)return m.l.num;var o=[];Te(e,o);var a=dn(o);if(0===a||t<o[0]||t>o[a-1])return m.l.na;var s=1===a?1:ho(o,t,n);return 0!==s?Math.floor(s*fn(10,r))/fn(10,r):s}oo.ORIGIN=function(){for(var e=[],t=0,r=arguments.length;t<r;t++){var n=t<0||arguments.length<=t?void 0:arguments[t];if(Array.isArray(n))n=(n=v.i(n)).filter((function(e){return"number"===typeof e})),e.push(n);else{var o=De.a._astNodes[t];if(n=v.B(n,o),v.p(o)&&"number"!==typeof n)continue;if(n=Number(n),isNaN(n))return m.l.value;e.push([n])}}var a,s,i,u,l,c,d=0,f=0,h=0,p=0,g=[];for(i=0;i<dn(e);i++)for(c=e[i],g.push(c),u=0;u<dn(c);u++)(l=c[u])!==P&&(d+=l,f+=l*l,p++);if(p<=2)return m.l.div0;if(a=d/p,0===(s=hn((p*f-d*d)/(p*(p-1)))))return m.l.div0;for(i=0;i<dn(g);i++)for(c=g[i],u=0;u<dn(c);u++)(l=c[u])!==P&&(h+=fn((l-a)/s,3));return M(p*h/((p-1)*(p-2)))},oo.P=function(){for(var e=[],t=0,r=arguments.length;t<r;t++){var n=t<0||arguments.length<=t?void 0:arguments[t];if(Array.isArray(n))n=(n=v.i(n)).filter((function(e){return"number"===typeof e})),e.push(n);else{var o=De.a._astNodes[t];if(n=v.B(n,o),v.p(o)&&"number"!==typeof n)continue;if(n=w(n),isNaN(n))return m.l.value;e.push([n])}}var a,s,i,u,l,c,d=0,f=0,h=[];for(i=0;i<dn(e);i++){if(c=e[i],1===dn(e)&&0===dn(c))return m.l.null;for(u=0;u<dn(c);u++){var p={value:0};(l=c[u])!==P&&"boolean"!==typeof l&&I(l,p)&&(d+=p.value,f++,h.push(p.value))}}if(f<=2)return m.l.div0;a=d/f;var g=0,y=0,_=0;for(i=0;i<h.length;i++)_=h[i]-a,y+=fn(_,2),g+=fn(_,3);return 0===(s=hn(y/f))?m.l.div0:M(g/f/s/s/s)};var po,vo,go,yo,_o,bo,Ao={INC:function(e,t,r){return mo(e,t,r,!0)},EXC:function(e,t,r){return mo(e,t,r,!1)}},Eo=B.a._isNullOrUndefined,jo=Me._isBoolean,Ro=Me._isString,So=b.default._parseInvariant,Co=L.a._getLength,To=L.a._getLength,wo=U.default._getWildcardCriteriaFullMatch,Oo=U.default._getRegIgnoreCase;function Io(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=!1;if(Object(H.a)(r)){var o=De.a._element,a=De.a._instance,s=o.row,i=o.col;r=a.custom.getValueByTopCellPosition(r,s,i),n=!0}if("number"!==typeof r)throw n?new Error(m.l.ref):new Error(m.l.value);function u(e,t){var r,n=To(e);for(r=1;r<n;r++){if(2===xo(e[r-1],e[r],!1)&&!t)return!1}return!0}var l=x(e),c=x(t);if(!c.isArray&&!c.isReference)return m.l.na;var d=c.colCount,f=c.rowCount,h=-1;return d>1&&f>1||1===r&&!u(c,!0)||-1===r&&!u(c,!1)?m.l.na:(1===r?h=Po(l,c,1,f>1):0===r?h=Lo(l,c,0,f>1):-1===r&&(h=Po(l,c,-1,f>1)),-1===h?m.l.na:h+1)}function No(e,t,r,n,o){if(e<0||t<0||t<e||r<e||r>t)return-1;if(o)return po=e,vo=t,yo=r,_o=n,bo=n,go=r;if(_o){if(++go>vo){if(_o!==bo)return-1;go=yo-1,_o=!1}}else if(--go<po){if(_o!==bo)return-1;go=yo+1,_o=!0}return go}function ko(e,t){return!Eo(t)&&(!!((Eo(e)||R(e,!0))&&R(t,!0)||jo(e)&&jo(t))||!(!Ro(e)||!Ro(t)))}function Mo(e,t,r){if(Eo(e))return null;if(e.isArray||e.isReference){var n=e.colCount;if(t>n){var o=t;t=r,r=o}return e[r*n+t]}return e[0]}function Do(e,t,r){var n=So(e),o=r;return n===t?o=0:n>t?o=1:n<t&&(o=2),o}function xo(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e===t)return 0;if(Ro(e)){if(!t&&0===Co(e.toString()))return 0;if(R(t)&&!R(e))return 1;if(jo(t))return 2;if(Ro(t)){if(escape(e).indexOf("%u")>=0||escape(t).indexOf("%u")>=0)var n=v.h(e,t);else n=r?e.toString().localeCompare(t.toString()):e.toLowerCase().localeCompare(t.toLowerCase());return 0===n?0:n>0?1:2}return t instanceof Date?Do(e,t,1):-1}if(Ro(t))return e||0!==Co(t.toString())?R(e)?2:jo(e)?1:e instanceof Date?Do(e,t,2):-1:0;if(jo(e)&&R(t))return 1;if(jo(t)&&R(e))return 2;var o=w(e),a=w(t);return o===a?0:o<a?2:1}function Fo(e,t,r){var n=Mo(e,t,r);return Eo(n)?0:n}function Po(e,t,r,n){var o,a=-1,s=0,i=-1,u=-1;if(o=n?t.rowCount:t.colCount,--o<s)return-1;for(;s<=o;){var l,c=null,d=e[0];for(r>=1!==(2===a)&&(i=u),l=u=No(s,o,u=T((s+o)/2),r>=0,!0);!ko(d,c)&&-1!==u&&!ko(d,c=n?Mo(t,0,u):Mo(t,u,0));)u=No(0,0,0,!1,!1),r>=0&&u<l?o=u:r<0&&u>l&&(s=u);if(-1===u&&r>=1!==(2===a))return i;if(-1===u)return-1;if(a=xo(d,c,!1),r>=1&&1===a)s=u+1;else if(r>=1&&2===a)o=u-1;else if(r<=-1&&1===a)o=u-1;else if(r<=-1&&2===a)s=u+1;else if(0===a){for(;r<=-1&&u>s||r>=0&&u<o;){var f;if(f=r>=0?u+1:u-1,null===(c=n?Fo(t,0,f):Fo(t,f,0)))return-1;if(!ko(d,c))break;if(0!==(a=xo(d,c,!1)))break;u=f}return u}}return r>=1!==(2===a)?u:i}function Lo(e,t,r,n){var o,a,s,i,u,l=null,c=-1,d=e[0],f=Ro(d),h=wo(d);for(a=n?t.rowCount:t.colCount,f&&h&&(i=Oo(h)),s=0;s<a;s++)if(ko(d,u=n?Mo(t,0,s):Mo(t,s,0))){var m=Ro(u);if(f&&m&&h?(i.lastIndex=0,o=i.test(u)?0:1):o=xo(d,u,!1),r>=1&&1===o)o=-1,c>=0&&(o=xo(u,l,!1)),(c<0||c>=0&&1===o)&&(c=s,l=u);else if(r<=-1&&2===o)o=-1,c>=0&&(o=xo(u,l,!1)),(c<0||c>=0&&2===o)&&(c=s,l=u);else if(0===o)return s}return c}function Uo(e,t,r,n,o){if(o&&r>t.colCount||!o&&r>t.rowCount)return m.l.ref;var a=n?Po(e,t,1,o):Lo(e,t,0,o);return a>=0?o?Fo(t,r-1,a):Fo(t,a,r-1):m.l.na}function Bo(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=Uo(e=x(e),t=x(t),r=(r=x(r))&&r[0],n=(n=x(n))&&n[0],!0);return o}function Ho(e,t,r,n){return Uo(e=x(e),t=x(t),r=(r=x(r))&&r[0],n=(n=x(n))&&n[0],!1)}function Go(e,t,r){if("object"!==Object(h.a)(t))return m.l.value;if(!0===t.isCell)return m.l.value;e=x(e);var n=[];if(t=x(t))for(var o=0;o<t.length;o++)n.push(t[o]);t.colCount<=t.rowCount?(n.colCount=t.colCount,n.rowCount=Math.ceil(n.length/n.colCount)):(n.rowCount=t.rowCount,n.colCount=Math.ceil(n.length/n.rowCount)),Eo(t.isReference)||(n.isReference=t.isReference),Eo(t.isArray)||(n.isArray=t.isArray),n.rangeCount=t.rangeCount;var a,s,i=n.colCount,u=n.rowCount,l=e;if(void 0===r){var c=i>u?Ho(l,n,u,!0):Bo(l,n,i,!0);return Object(m.v)(c)?m.l.na:c}if(s=x(r)){if(s.colCount>1&&s.rowCount>1)return m.l.na}else s=n;return(a=Po(l,n,1,!(i>u)))>=0?(i=s.colCount)>(u=s.rowCount)?Fo(s,a,u-1):Fo(s,i-1,a):m.l.na}r("../node_modules/core-js/modules/es.number.to-fixed.js");var Vo=b.default._parseLocale,Wo=b.default._toOADate,Yo=L.a._getLength,zo=B.a._inArray,Ko=m.v,qo=T,Qo=v.a,Xo=new Date("1970/01/01 00:00:00"),Jo=[[],[1,2,3,4,5,6,7],[7,1,2,3,4,5,6],[6,0,1,2,3,4,5],[],[],[],[],[],[],[],[7,1,2,3,4,5,6],[6,7,1,2,3,4,5],[5,6,7,1,2,3,4],[4,5,6,7,1,2,3],[3,4,5,6,7,1,2],[2,3,4,5,6,7,1],[1,2,3,4,5,6,7]];function $o(e,t,r){var n,o=De.a._instance.custom.isNumeric;if(v.b(e,t,r)||!o(e)||!o(t)||!o(r))throw new Error(m.l.value);if((e=v.A(e))<0||e>=1e4)throw new Error(m.l.num);return e<=1899&&e>=0&&(e=1900+e),(t=v.A(t))>12?(e+=parseInt(t/12),t%=12):t<1&&(e=e-parseInt(Math.abs(t/12))-1,t=12-Math.abs(t%12)),r=v.A(r),n=new Date("".concat(e,"/").concat(t,"/").concat(r)).getTime()<0?Date.parse(parseInt(e,10)+"/"+parseInt(t,10)+"/1 00:00:00"):Date.parse(parseInt(e,10)+"/"+parseInt(t,10)+"/1 08:00:00"),parseInt((n-Xo)/864e5,10)+r+25567}function Zo(e){if(Array.isArray(e)&&(e=e[0]),Array.isArray(e)){if(e.length>1)throw new Error(m.l.value);if(e[0]&&e[0].length>1)throw new Error(m.l.value);e=v.c(e)}if(/\d{4},\d{1,2},\d{1,2}/.test(e))throw new Error(m.l.value);if(Ve(e)&&(e=Number(e))>2958465)throw new Error(m.l.num);if(Qo){if(v.t(e))return 29;parseInt(e,10).toString()===e.toString()&&parseInt(e,10)>60&&(e=parseInt(e,10)-1)}"string"===typeof e&&(e=e.replace(/-/g,"/"));var t=v.z(e||0);return t instanceof Date?1899===t.getFullYear()?0:t.getDate():t}function ea(e){if(Array.isArray(e)){if(e.length>1)throw new Error(m.l.value);e[0]&&e[0].length>1&&(e=e[0]),e=v.c(e)}if(/\d{4},\d{1,2},\d{1,2}/.test(e))throw new Error(m.l.value);if(Qo){if(v.t(e))return 2;parseInt(e,10).toString()===e.toString()&&parseInt(e,10)>60&&(e=parseInt(e,10)-1)}return(e=v.z(e||0))instanceof Date?1899===e.getFullYear()?1:e.getMonth()+1:e}function ta(e,t,r,n,o,a){var s={value:void 0};if(!F(t,s))throw new Error(m.l.value);if(t=s.value,!F(r,s={value:void 0}))throw new Error(m.l.value);r=s.value;var i=T(Wo(t)),u=T(Wo(r)),l=!1;if(i>u){var c=t;t=r,r=c;var d=i;i=u,u=d,l=!0}var f=u-i+1;return f=a(t,r,f,n),e&&Object(m.v)(f)?f:f<=0?0:(f=function(e,t,r,n,o,a){var s,i;if(a&&(i=fa(e=void 0!==e?e:"0000011"),Object(m.v)(i)))return i;if(void 0!==t&&(s=x(t)),!s)return o;if(s.isError)return s[0];var u,l=Yo(s),c=[];for(u=0;u<l;u++){var d=s[u],f=b.default._fromOADate(d),h=f.getDay(),p=Yo(i)?i[sa(f,3)]:6===h||0===h;-1===c.indexOf(d)&&!p&&d>=r&&d<=n&&c.push(d)}return o-=Yo(c)}(n,o,i,u,f,e),f=l?-f:f)}function ra(e,t,r,n){var o,a=fa(n=void 0!==n?n:"0000011"),s=0,i=0;if(Ko(a))return a;for(o=0;o<Yo(a);o++)1===a[o]&&s++;if(r<30){for(o=0;o<r;o++)a[(qo(sa(e,3))+o)%7]&&i++;return r-=i}var u=r,l=0,c=0;for(o=0;o<u&&qo(sa(e,3)+o)%7!==0;o++)l++;for(o=0;o<l;o++)a[(qo(sa(e,3))+o)%7]&&i++;for(o=0;o<u&&(qo(sa(t,3))+7-o)%7!==6;o++)c++;for(o=0;o<c;o++)a[(qo(sa(t,3))+7-o)%7]&&i++;return r-=qo((u=u-l-c)/7)*s,r-=i}var na={};function oa(){var e,t=new Date;e=t.getFullYear(),e+="/",e+=t.getMonth()+1,e+="/",e+=t.getDate(),e+=" ",e+=t.getHours(),e+=":",e+=t.getMinutes(),e+=":",e+=t.getSeconds();var r=(Date.parse(e)-Xo)/864e5;return Number((r+25568).toFixed(4))}function aa(){var e=new Date;return parseInt((Date.parse(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()+" 00:00:00")-Xo)/864e5,10)+25568}function sa(e,t){if(void 0===t&&(t=1),!Ve(t))throw new Error(m.l.value);if([1,2,3,11,12,13,14,15,16,17].indexOf(t)<0)throw new Error(m.l.num);e=v.c(e);var r=v.u(e);if(Qo&&(parseInt(e).toString()!==e.toString()||r||(e=parseInt(e)-1)),e=v.z(e),0===Number(t))throw new Error(m.l.num);if(!(e instanceof Date))return e;if(1899===e.getFullYear())return 7;var n=e.getDay();return isNaN(n)&&(n=6),Qo&&r&&(n=(n+6)%7),Jo[t][n]}function ia(e){if(Array.isArray(e)){if(e.length>1)throw new Error(m.l.value);if(e[0]&&e[0].length>1)throw new Error(m.l.value);e=v.c(e)}if(/\d{4},\d{1,2},\d{1,2}/.test(e))throw new Error(m.l.value);if(Qo){if(v.t(e))return 1900;parseInt(e).toString()===e.toString()&&parseInt(e)>60&&(e=parseInt(e)-1)}return(e=v.z(e||0))instanceof Date?Math.max(e.getFullYear(),1900):e}function ua(e){return 1===new Date(e,1,29).getMonth()}function la(e){var t,r,n,o,a=new Date;return"string"!==typeof e?e:(t=e.match(/^(\d*)\u5e74(\d*)\u6708(\d*)\u65e5$/))?(r=t[1],n=t[2],o=t[3],"".concat(r,"/").concat(n,"/").concat(o)):(t=e.match(/^(\d*)\u5e74(\d*)\u6708$/))?(r=t[1],n=t[2],o=1,"".concat(r,"/").concat(n,"/").concat(o)):(t=e.match(/^(\d*)\u6708(\d*)\u65e5$/))||(t=e.match(/^(\d*)[-/](\d*)$/))?(r=a.getFullYear(),n=t[1],o=t[2],"".concat(r,"/").concat(n,"/").concat(o)):e}function ca(e){if(""===(e=v.B(e,De.a._astNodes[0])))return m.l.value;var t=D(e);return(60*(60*t.getHours()+t.getMinutes())+t.getSeconds())/86400}function da(e,t){var r=e.getDay();switch(t){case 1:return r+1;case 2:return 0===r?7:r;case 3:return 0===r?6:r-1;default:return m.l.num}}function fa(e){if(Me._isString(e)){if(7!==Yo(e)||isNaN(parseInt(e)))return m.l.value}else if(!isNaN(e)){if(Math.floor(e)<1||Math.floor(e)>17)return m.l.num;e=e.toString()}var t,r=["1","2","3","4","5","6","7"],n=[0,0,0,0,0,0,0];switch(Yo(e)){case 1:if(zo(e,r)>=0){n[((t=parseInt(e))+4)%7]=1,n[(t+5)%7]=1;break}return m.l.num;case 2:if("1"===e[0]&&zo(e[1],r)>=0){n[((t=parseInt(e[1]))+5)%7]=1;break}return m.l.num;case 7:for(t=0;t<7;t++)n[t]=parseInt(e[t]);break;default:return m.l.value}return n}function ha(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=arguments.length>4?arguments[4]:void 0;t=D(t=T(t)),r=T(r);var a=da(t,3);if(S(a))return a;for(var s=T(a);r<0;++r)t.setDate(t.getDate()-1),s=0===s?6:--s,(e&&(5===s||6===s)||!e&&o[s]||n.indexOf(Wo(t))>=0)&&r--;for(;r>0;--r)t.setDate(t.getDate()+1),s=6===s?0:++s,(e&&(5===s||6===s)||!e&&o[s]||n.indexOf(Wo(t))>=0)&&r++;return t.getFullYear()<1900?m.l.num:Wo(t)}function ma(e,t){e=Array.isArray(e)?v.i(e):[e];for(var r=v.x(t),n=0,o=e.length;n<o;n++){var a=e[n];if(r&&""===a)return m.l.value;"number"!==typeof a&&(a=D(la(a)),e[n]=Wo(a))}return e}na.ORIGIN=function(e,t,r){return ta(!1,e,t,void 0,r,(function(e,t,r){var n=T(Wo(t)-Wo(e))%7,o=T(sa(e,2)+n),a=0===e.getDay()?1:2;return r-=n=(n=o>5?o-5:0)>a?a:n,r-=2*Math.floor(r/7)}))},na.INTL=function(e,t,r,n){return ta(!0,e,t,r,n,ra)};var pa={};function va(e){return v.v(e,De.a._astNodes[0])?m.l.value:(e=D(e)).getMinutes()}function ga(e){return v.v(e,De.a._astNodes[0])?m.l.value:(e=D(e)).getHours()}function ya(e){return v.v(e,De.a._astNodes[0])?m.l.value:(e=D(e)).getSeconds()}function _a(e,t,r){if("boolean"===typeof t||"boolean"===typeof r)return m.l.value;if(v.v(t,De.a._astNodes[0]))return m.l.na;if(v.v(r,De.a._astNodes[1]))return m.l.na;if(t=v.B(t,De.a._astNodes[0]),r=v.B(r,De.a._astNodes[1]),""!==t&&0!==t||(t=new Date(1900,0,1)).setHours(0,0,0,0),""===r&&(r=0),r=T(r),isNaN(r))return m.l.value;t=D(t);var n=new Date(t.getFullYear(),t.getMonth(),1);n.setMonth(n.getMonth()+r);var o=Me._getDaysInMonth(n.getFullYear(),n.getMonth());return n.setDate(e?o:Math.min(t.getDate(),o)),Wo(n)}function ba(e,t){return _a(!0,e,t)}function Aa(e,t){return _a(!1,e,t)}function Ea(e){if(e=D(e=v.B(e,De.a._astNodes[0])),isNaN(e))return m.l.num;function t(e){var t=new Date(e,0,4),r=t.getDay();return 0===r&&(r=7),t.setDate(t.getDate()+1-r),t}var r,n=new Date(1900,1,28);e.getTime()<=n.getTime()&&e.setDate(e.getDate()-1),1900===(r=e.getFullYear())?r+=400:9999===r&&(r-=400),e.setYear(r),e.getTime()<new Date(r,11,29).getTime()&&r--;var o=t(r+1);return e.getTime()<o.getTime()&&(o=t(r)),parseInt((e.getTime()-o.getTime())/864e5/7)+1}pa.ORIGIN=function(e,t,r){return e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),S(r=ma(r,De.a._astNodes[2]))?r:ha(!0,e,t,r)},pa.INTL=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3?arguments[3]:void 0;e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),""===(r=v.B(r,De.a._astNodes[2],!0))&&(r=1);var o=fa(r);return S(o)?o:S(n=ma(n,De.a._astNodes[3]))?n:"1111111"===o.join("")?m.l.value:ha(!1,e,t,n,o)};var ja=[void 0,0,1,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,1,2,3,4,5,6,0];function Ra(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1],!0),e=D(e),v.p(De.a._astNodes[1])||""!==t||(t=1),t=T(t),isNaN(t))return m.l.value;if(21===t)return Ea(e);if(void 0!==ja[t]){var r=ja[t],n=new Date(e.getFullYear(),0,1),o=(7-(r-n.getDay()))%7,a=n-24*o*60*60*1e3;return Math.floor((e-a)/864e5/7+1)}return m.l.num}function Sa(e,t,r){e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),r=v.B(r,De.a._astNodes[2]),e=T(e),t=T(t),r=T(r);var n=b.default._fromOADate(0);if(n.setHours(e),n.setMinutes(t),n.setSeconds(r),n.setMilliseconds(0),n.getHours()<0&&n.getMinutes()<0&&n.getSeconds()<0)return m.l.num;var o=Wo(n);return o<0?m.l.num:(De.a._funcNode.setFormatType("[$-409]h:mm AM/PM;@"),o)}function Ca(e){var t,r;v.B(e,De.a._astNodes[0]);if(Me._isString(e)&&(e=la(e),(t=Vo(e))||(t=new Date(e))&&!isNaN(t.valueOf())||(t=null)),!t)return m.l.value;var n=t.getFullYear(),o=function(e){var t,r=e.getFullYear(),n=e.getMonth(),o=e.getDate();for(t=0;t<n;t++)o+=Me._getDaysInMonth(r,t);return o}(t);if(n<1900)return m.l.value;for(r=1900;r<n;r++)o+=365,ua(r)&&o++;return o}function Ta(e){var t,r={value:0};return I(e,r)?(t=r.value)>=0&&t<2958466?r:m.l.num:m.l.value}function wa(e,t){e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]);var r=Ta(e);if(S(r))return r;var n=Ta(t);return S(n)?n:r.value-n.value}function Oa(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),e=D(e),t=D(t),v.v(r,De.a._astNodes[2]))return m.l.value;var n=Ta(e);if(S(n))return n;var o=Ta(t);return S(o)?o:Me._days360(e,t,r)}function Ia(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),e=D(e),t=D(t),v.v(r,De.a._astNodes[2]))return m.l.value;var n=Ta(e);if(S(n))return n;var o=Ta(t);return S(o)?o:(r=T(r),Me._yearfrac(e,t,r))}r("../node_modules/core-js/modules/es.array.from.js"),r("../node_modules/core-js/modules/es.string.iterator.js");var Na=r("./src/core/feature/formula/lib/spreadjs/common/culture.js"),ka=(r("../node_modules/core-js/modules/es.array.some.js"),r("../node_modules/core-js/modules/es.array.splice.js"),r("../node_modules/core-js/modules/es.regexp.constructor.js"),r("./src/core/feature/formula/lib/spreadjs/common/numHelper.js")),Ma=Math.abs,Da=A.a,xa=b.default,Fa=ka.default,Pa=B.a._isType,La=B.a._isArray,Ua=Fa._generalNumberInt+"."+Fa._generalNumberDec,Ba=Fa._formatObjectToSrting,Ha=Fa._customCultureFormat,Ga=Fa._fixNumber,Va=B.a._isNullOrUndefined,Wa=function(e){return Na.a._getCultureInfo(e)},Ya=function(e){return Wa(e).DateTimeFormat},za=function(e){return Wa(e).NumberFormat},Ka=function(e){return e&&e.toLowerCase()},qa=function(){throw new Error(_.a.Exp_FormatIllegal)},Qa={_Empty:"",_format:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0===arguments.length)return null;for(var r=e[0],n=1;n<arguments.length;n++){var o=new RegExp("\\{"+(n-1)+"\\}","gm");r=r.replace(o,arguments[n])}return r},_isNullOrEmpty:function(e){return!e||e===Qa._Empty}},Xa=function(e){var t=e.charCodeAt(0);return t>=48&&t<=57},Ja=function(e){var t=e.charCodeAt(0);return t>=9&&t<=13||32===t||133===t||160===t},$a=function(){function e(e,t){Ss.call(this,t);this._content=e;var r=this._content,n=bs(r[0],"$",!1),o=r.indexOf("-");if(!(n&&o>-1))throw new Error(_.a.Exp_TokenIllegal);this._currencySymbol=cs(r,1,o-1),(r=Da._remove(r,0,o+1)).length>0&&(this._locateID=parseInt(r,16))}return e.Name="LocaleIDFormatPart",e.prototype={cultureInfo:function(){return this._cultureInfo||(this._cultureInfo=Wa(this._locateID),this._currencySymbol&&this._currencySymbol!==Qa._Empty&&!this._cultureInfo.NumberFormat.isReadOnly&&(this._cultureInfo.NumberFormat.currencySymbol=this._currencySymbol)),this._cultureInfo},currencySymbol:function(){return this._currencySymbol?Da._replace(this._currencySymbol,"\\.",'"."'):Qa._Empty},allowScience:function(){if(this._cultureInfo)return!(0===this._cultureInfo.name().indexOf("ja"))&&!(0===this._cultureInfo.name().indexOf("zh"))},toString:function(){return this._content?ps(this._content):Qa._Empty}},e}(),Za=function(){function e(e,t){this.formatCached=e,this.cultureName=t,this.typeName=""}return e.prototype={format:function(e,t){return null},parse:function(e){return null},formatString:function(){return this.formatCached},toJSON:function(){var e={};for(var t in this)this.hasOwnProperty(t)&&(e[t]=this[t]);return e},fromJSON:function(e){if(e)for(var t in e)void 0!==e[t]&&(this[t]=e[t])}},e}(),es={_yearTwoDigit:"yy",_yearSingleDigit:"y",_yearFourDigit:"yyyy",_monthSingleDigit:"m",_monthTwoDigit:"mm",_monthAbbreviation:"mmm",_monthUnabbreviated:"mmmm",_monthJD:"mmmmm",_daySingleDigit:"d",_dayTwoDigit:"dd",_dayWeekDayAbbreviation:"aaa",_dayWeekDayUnabbreviated:"aaaa",_hoursSingleDigit:"h",_hoursTwoDigit:"hh",_minuteSingleDigit:"m",_minuteTwoDigit:"mm",_secondSingleDigit:"s",_secondTwoDigit:"ss",_eraYear:"e",_aMPMTwoDigit:"AM/PM",_aMPMSingleDigit:"A/P",_placeholderMonthJD:"@mmmmm",_defaultAbsoluteTime:new Date(1899,11,30,0,0,0,0)},ts=[es._yearSingleDigit,es._yearTwoDigit,es._yearFourDigit,es._monthSingleDigit,es._monthTwoDigit,es._monthAbbreviation,es._monthUnabbreviated,es._monthJD,es._daySingleDigit,es._dayTwoDigit,es._dayWeekDayAbbreviation,es._dayWeekDayUnabbreviated,es._hoursSingleDigit,es._hoursTwoDigit,es._minuteSingleDigit,es._minuteTwoDigit,es._secondSingleDigit,es._secondTwoDigit,"ggg","gg","g","ee","e"],rs=function(){function e(e,t){Ss.call(this,t);for(var r,n,o,a=["<=","<>",">=",">","<","="],s=0,i=a.length;s<i;s++)if(r=a[s],Da._startsWith(e,r,!0)){n=Da._remove(e,0,r.length);var u=parseFloat(n);isNaN(u)||(o=u);break}if(null===o&&void 0===o)throw new Error(_.a.Exp_TokenIllegal);this.value=o,this._compareOperator=r,this.isMeetCondition=function(e){var t="var self = this;",r=e._compareOperator;return r="="===(r="<>"===r?"!=":r)?"===":r,new Function(["value"],t+="return value "+r+" self.value;")}(this)}return e.Name="ConditionalFormatPart",e.prototype={toString:function(){return ps(this._compareOperator+this.value.toString())}},e}(),ns=function(){function e(e,t){Ss.call(this,t);if(this.token=e,this.type=parseInt(Da._remove(e,0,"dbnum".length),10),this.type<0||this.type>3)throw new Error(_.a.Exp_TokenIllegal)}function t(e,t,n){var o=e.split(".");if(o){if(1===o.length)return r(o[0],t.numbers,n?t.letters:null);if(2===o.length)return r(o[0],t.numbers,n?t.letters:null)+"."+r(o[1],t.numbers)}throw new Error(_.a.Exp_ValueIllegal)}function r(e,t,n){var o,a=e,s=0,i=0;if(2===arguments.length){var u="";for(s=0;s<a.length;s++)o=cs(a,s,1),u+=t[i=parseInt(o,10)];return u}if(3===arguments.length){if(!n)return r(e,t);var l=0,c="",d=a.length,f=!1,h=[];for(s=0;s<d;s++){var m=n.length-1-s;m>-1?h.push(n[m].toString()):h.push(Qa._Empty)}for(var p=[],v=h.length-1;v>=0;v--)p[h.length-v-1]=h[v];h=p;var g=!1;for(v=0;v<d;v++){var y;o=cs(a,v,1),i=parseInt(o,10);var _=Qa._Empty;d-v-16>0?(y=t[i],_="",g=!0):v!==d-1&&v!==d-5&&v!==d-9&&v!==d-13?"0"===o?(y="",_="",l+=1):"0"!==o&&0!==l?(y=t[0]+t[i],_=h[v],l=0):(y=t[i],_=h[v],l=0):"0"!==o&&0!==l?(y=t[0]+t[i],_=h[v],l=0):"0"!==o&&0===l||g?(y=t[i],_=h[v],l=0,g=!1):"0"===o&&l>=3?(y="",_="",l+=1):d>=11?(y="",l+=1):(y="",_=h[v],l+=1);var b=y+_===Qa._Empty;b||(f=!1),v!==d-13||f||(_=h[v],f=!0),v!==d-9||f||(_=h[v],f=!0),v===d-1&&(_=h[v],f=!0),c=c+y+_}var A=parseInt(e,10);return 0===A?t[0]:c}}return e.Name="DBNumberFormatPart",e.prototype={_replaceNumberString:function(e,r,n){if(!e||e===Qa._Empty)return e;for(var o,a,s,i=e,u=e,l=-1,c=-1,d=!1,f=e.length-1;f>=0;f--){var h=u[f];!isNaN(h)&&!bs(h," ",!1)||bs(h,".",!1)&&!d?(bs(h,".",!1)&&(d=!0),-1===l&&(l=f),c=f):c>-1&&l>-1&&(o=cs(u,c,l-c+1),a=parseFloat(o),isNaN(a)||(s=t(o,r,n),i=Da._remove(i,c,l-c+1),i=Da._insert(i,c,s)),l=-1,c=-1,d=!1)}return c>-1&&l>-1&&(o=cs(u,c,l-c+1),a=parseFloat(o),isNaN(a)||(s=t(o,r,n),i=Da._remove(i,c,l-c+1),i=Da._insert(i,c,s))),i},toString:function(){if(this.type>-1)return ps("DBNum"+this.type);throw new Error}},e}(),os=function(){function e(e,t,r,n,o){Rs.call(this,t,r,n);this._formatString=this._fixFormat(As(e)),this._absTimeParts=o,this._formatType=2,this._init()}function t(e){return Da._indexOf(e,es._hoursSingleDigit[0],!0)>-1||Da._indexOf(e,es._secondSingleDigit[0],!0)>-1}function r(e){return Da._indexOf(e,es._yearTwoDigit[0],!0)>-1||Da._indexOf(e,es._daySingleDigit[0],!0)>-1}return e.prototype={_init:function(){var t={_value:this._formatString};if(e._evaluateFormat(t._value)){var r=this._processAMPM(t);if(this.hasJD=this._replace(t._value,es._monthJD,'"'+es._placeholderMonthJD+'"',!0,!1,t,!1),this._replace(t._value,es._monthUnabbreviated,"MMMM",!0,!1,t,!1),this._replace(t._value,es._monthAbbreviation,"MMM",!0,!1,t,!1),this._replace(t._value,es._monthTwoDigit,"MM",!0,!1,t,!1),this._replace(t._value,es._monthSingleDigit,"M",!0,!1,t,!1),this._replace(t._value,es._dayWeekDayAbbreviation,"ddd",!0,!0,t,!0),this._replace(t._value,es._dayWeekDayUnabbreviated,"dddd",!0,!0,t,!0),r||(this._replace(t._value,es._hoursSingleDigit,"H",!0,!0,t,!1),this._replace(t._value,es._hoursTwoDigit,"HH",!0,!0,t,!1)),this._partDBNumberFormat&&this._partLocaleID&&(this._hasYearDelay=this._hasYearDelay||this._replace(t._value,es._yearFourDigit,'"@'+es._yearFourDigit+'"',!0,!1,t,!0),this._hasYearDelay=this._hasYearDelay||this._replace(t._value,es._yearTwoDigit,'"@'+es._yearTwoDigit+'"',!0,!1,t,!0)),this._absTimeParts)for(var n=0;n<this._absTimeParts.length;n++){var o=this._absTimeParts[n];this._replace(t._value,o._originalToken,"@"+o._originalToken,!0,!0,t,!0)}this._validDateTimeFormatString=t._value}else qa()},formatString:function(){return this._formatString},format:function(e){var t=Qa._Empty,r=null,n=this._validDateTimeFormatString,o=this._formatString.match(/(am\/pm|a\/p)/i);n=(n=n.replace(/H/gi,o?"h":"H")).replace(/(h{2})h+/i,"$1");var a=this.cultureName;n.match(/ddd/i)&&(a="zh-cn");try{if((r=xa._DT(e))&&isNaN(r.valueOf())&&(r=null),r?e=r:t=e.toString(),r){if(t=xa._customCultureFormat(r,n,this._partLocaleID&&this._partLocaleID.cultureInfo()||Wa(a)),this.hasJD){var s=Wa(a).DateTimeFormat.monthNames[r.getMonth()];t=Da._replace(t,es._placeholderMonthJD,cs(s,0,1))}if(this._absTimeParts)for(var i=24*(xa._toOADate(r)-xa._toOADate(es._defaultAbsoluteTime))*60*60*1e3,u=0;u<this._absTimeParts.length;u++){var l=this._absTimeParts[u],c=l._getTimeSpan(i);if(!Va(c)){var d=l._originalToken.replace("[","\\[").replace("]","\\]");t=Da._replace(t,"@"+d,c)}}}}catch(f){t=ds(e)}return function(e,t,r,n,o){var a=e;if(!Va(n)&&t instanceof Date){var s=Ts(r,n.type,o);a=n._replaceNumberString(a,s,!0),1===n.type&&(a=a.replace(new RegExp("\u4e00\u5341","g"),"\u5341")),a=(a=a.replace("@"+es._yearFourDigit,xa._localeFormat(t,es._yearFourDigit))).replace("@"+es._yearTwoDigit,xa._localeFormat(t,es._yearTwoDigit)),a=n._replaceNumberString(a,s,!1)}return a}(t,e,this._partLocaleID,this._partDBNumberFormat,a)},parse:function(e){if(!e||e===Qa._Empty)return null;var t=e,r=Ka(t);if("true"===r)return!0;if("false"===r)return!1;if(this._validDateTimeFormatString){var n=xa._parseExact(t,this._validDateTimeFormatString,Wa(this.cultureName));if(n)return n}try{var o=xa._DT(t);return o&&!isNaN(o)?o:(o=new Date(t),isNaN(o.valueOf())?t:o)}catch(a){return t}},_fixFormat:function(e){for(var t=e,r="",n=!1,o=0;o<t.length;o++){var a=t[o];if('"'===a)n=!n;else if(!n)if("Y"===a||"D"===a||"S"===a||"E"===a||"G"===a)a=Ka(a);else if("M"===a){var s=t[o-1];bs("A",s,!0)||bs("P",s,!0)||(a=Ka(a))}r+=a}return r},_processAMPM:function(e){for(var t=[es._aMPMTwoDigit,Ya(this.cultureName).amDesignator+"/"+Ya(this.cultureName).pmDesignator,es._aMPMSingleDigit],r=["tt","tt","t"],n=0;n<3;n++)if(Da._contains(e._value,t[n],1))return e._value=Da._replace(e._value,t[n],r[n],!0),!0;return!1},_replace:function(e,n,o,a,s,i,u){if(a||s){var l=[],c=!0;!r(e)&&t(e)&&(c=!1);for(var d=!1,f=0;f<e.length;f++){var h=e[f];if(t(h)?c=!1:r(h)&&(c=!0),a&&bs(h,n[0],u)&&c||s&&bs(h,n[0],u)&&!c){for(var m=!0,p=0;p<n.length;p++)if(p+f>=e.length||!bs(n[p],e[p+f],u)){m=!1;break}var v=f+n.length-1;if(m&&v+1<e.length){var g=e[v],y=-1;for(y=v+1;y<e.length&&bs(g,e[y],u);y++);y>v+1&&(f=y,m=!1)}m&&!d&&l.splice(0,0,f)}'"'===h&&(d=!d)}if(i._value=e,l.length>0){for(f=0;f<l.length;f++){var _=l[f];i._value=Da._remove(i._value,_,n.length),i._value=Da._insert(i._value,_,o)}return!0}return!1}return!1}},e._evaluateFormat=function(e){return Es(e,ts)},e}(),as=function(e,t){Ss.call(this,t);var r,n=Ka(e)[0];if("h"===n)r=3600;else if("m"===n)r=60;else{if("s"!==n)throw new Error(_.a.Exp_TokenIllegal);r=1}this._getTimeSpan=function(e){var t=e/1e3/r;return Math.abs(t-Math.round(t))<1e-6?Math.round(t):Math.floor(t)}};as.Name="ABSTimeFormatPart";var ss=function(){function e(e,t){Ss.call(this,t),this.foreColor=e}return e.Name="ColorFormatPart",e.prototype.toString=function(){return ps(this.foreColor)},e}(),is=function(){function e(e,t,r,n){Rs.call(this,t,r,n);this._isGeneralNumber=!1,this._formatType=1,this._fullFormatString=vs(e);var o=As(e);if(t&&(o=ys(o,this._partLocaleID._originalToken,this._partLocaleID.currencySymbol())),(o=vs(o)).indexOf("/")>-1){var a=function(e,t){var r=[];if(null===e||""===e)return r;var n,o,a=!1,s=[],i=!1;for(n=0;n<e.length;n++)'"'!==(o=e[n])||a||(i=!i),a||i||o!==t?s.push(o):(r.push(s.join("")),s=[]),a="\\"===o&&!a;return r.push(s.join("")),r}(o,"/");if(a&&2===a.length){this._fractionDenominatorFormat=a[1];var s=a[0];if(s){var i=s.lastIndexOf(" ");i>-1?(this._fractionIntegerFormat=cs(s,0,i),this._fractionNumeratorFormat=cs(s,i+1,s.length-i-1)):this._fractionNumeratorFormat=s}}}this._numberFormatString=o}return e.prototype={formatString:function(){return this._fullFormatString},format:function(e){if(Pa(e,"boolean"))return e.toString().toUpperCase();var t=B.a._toDouble(e);if(isNaN(t)||!isFinite(t)||isNaN(e))return"string"===typeof e?e:null;var r,n,o,a,s,i=Wa(this.cultureName);if(this._fractionNumeratorFormat&&this._fractionDenominatorFormat){var u={value:0},l={value:0},c={value:0};if(function(e,t,r,n,o,a){var s=!!a.match(/^#\s+/),i=Math.abs(e),u=Math.min(7,t),l=function(e,t){for(var r,n=t.maxDenominatorLength,o=void 0===n?7:n,a=[0,1],s=[1,0],i=e-parseInt(e),u=parseInt(i.toString().replace("0.","")),l=e,c=NaN,d=2;d<1e3;d++){var f=Math.floor(l),h=f*a[d-1]+a[d-2];if(Math.abs(a[d])>u)break;var m=f*s[d-1]+s[d-2];if(o&&m.toString().length>o)break;if(a[d]=h,s[d]=m,(r=a[d]/s[d])===c||r===e)break;c=r,l=1/(l-f)}var p=a.length-1;if(p<2)return{numerator:e,denominator:1};return{numerator:a[p],denominator:s[p]}}(i,{maxDenominatorLength:u}),c=l.numerator,d=l.denominator,f=parseInt(c/d);e<0&&(f=-f);return r.value=s&&1!==d?f:0,n.value=s&&1!==d?c%d:c,o.value=d,!0}(t,this._getDenominatorLength(),u,l,c,this._numberFormatString)){if(this._fractionIntegerFormat){s="",1===c.value&&(u.value+=l.value,l.value=0,c.value=0),0===u.value&&t<0&&(s+=i.NumberFormat.negativeSign);var d=Ba(Ha(u.value,this._fractionIntegerFormat,i));d&&"0"!==d?(s+=d,s+=" "):0===u.value&&this._numberFormatString.match(/^#\s\?/)&&(s+=" "),0===t&&(s+="0"),r=this._fractionDenominatorFormat,n=parseFloat(r),!isNaN(n)&&n>0&&(0!==l.value&&0!==c.value&&(l.value*=n/c.value),c.value=n,r=r.replace(/^\d+/,function(e){return e.toString().replace(/\d/g,"?")}(n)),a=(o=Math.ceil(l.value))-l.value,l.value=a<=.5&&a>=0?parseFloat(o.toString()):parseFloat((o-1).toString()));var f=this._fractionNumeratorFormat,h=parseFloat(f);if(!isNaN(h)&&0===h){var m=f.length,p=l.value.toString(),v=p.length;m>v?f=f.substr(0,m-(m-v)):m<v&&(p=p.substr(0,v-(v-m)),l.value=parseInt(p,10))}var g=this._getFormattedFractionString(l.value,c.value,f,r,i);return 0===l.value&&(g=g.replace(/./g," "),""===d)?"0 "+g:""===(s+=g)?"0":s}s="",0===u.value&&t<0&&(s+=i.NumberFormat.negativeSign);var y=u.value*c.value+l.value;return r=this._fractionDenominatorFormat,(n=parseFloat(r))>0?(y*=n/c.value,c.value=n,s+=(y=(a=(o=Math.ceil(y))-y)<=.5&&a>=0?parseFloat(o.toString()):parseFloat((o-1).toString()))+"/"+c.value):s+=this._getFormattedFractionString(y,c.value,this._fractionNumeratorFormat,this._fractionDenominatorFormat,i),0===y?"0":s}return t.toString()}return function(e,t,r,n,o){if(!Va(n)){var a=Ts(r,n.type,o);if(!Va(a)){for(var s,i,u=!1,l=Wa(o),c=0,d=e.length;c<d;c++)"decimalSeparator"===e[c].type&&(u=!0,e[c].value=n._replaceNumberString(e[c].value,a,t),s=e[c].value),"number"===e[c].type&&(e[c].value=u?n._replaceNumberString(s+e[c].value,a,t).slice(1):n._replaceNumberString(e[c].value,a,t),"ja-JP"===l.name()&&e[c].value.length>1&&("\u4e00\u5343"===(i=e[c].value.substr(0,2))||"\u4e00\u767e"===i||"\u4e00\u5341"===i)&&(e[c].value=e[c].value.substr(1)));return e}}return e}(Ha(t,this._numberFormatString,i),this._isGeneralNumber,this._partLocaleID,this._partDBNumberFormat,this.cultureName)},parse:function(e){if(!e||e===Qa._Empty)return null;var t=Ka(e);if("true"===t)return!0;if("false"===t)return!1;e=this._trimSpecialSymbol(e),e=this._trimCurrencySymbol(e);var r=this._trimPercentSign(e),n=r._isPer,o=r._str;if(this._isValidaNumberString(o)){o=Da._replaceAllNoReg(o,za(this.cultureName).numberGroupSeparator,"");var a=Fa._parseFloat(o,this.cultureName);if(!isNaN(a)&&isFinite(a))return n&&(a=Ga(a/100,15)),a}return null},_getDenominatorLength:function(){var e=this._fractionDenominatorFormat,t=0;if(e)for(var r=e.length,n=0;n<r&&e[n].match(/[#?0\d]/);n++)t++;return t},_isValidaNumberString:function(e){for(var t="",r=0,n=0,o=0,a=!0,s=za(this.cultureName),i=e.length-1;i>-1;i--){if(e[i]===s.numberDecimalSeparator)r++,o>0&&(a=!1),t="";else if("e"===Ka(e[i])){if(n++,t="",i===e.length-1)return!1}else if(e[i]===s.numberGroupSeparator)a=3===t.length,o++,t="";else if("-"===e[i]||"+"===e[i]){if(i>0&&"e"!==Ka(e[i-1]))return!1}else{if(!Xa(e[i]))return!1;t+=e[i]}if(r>1||n>1||!a)return!1}return!0},_trimSpecialSymbol:function(e){for(var t=e,r=[],n=0;n<t.length;n++)Xa(t[n])&&r.push(n);for(var o=za(this.cultureName),a=[o.currencyDecimalSeparator,o.currencyGroupSeparator,o.currencySymbol,o.nanSymbol,o.negativeInfinitySymbol,o.negativeSign,o.numberDecimalSeparator,o.numberGroupSeparator,o.percentDecimalSeparator,o.percentGroupSeparator,o.percentSymbol,o.perMilleSymbol,o.positiveInfinitySymbol,o.positiveSign],s=t.length-1;s>-1;s--){var i=t[s];if(!Ja(i)||a.indexOf(i.toString())>-1){if("-"===i||"+"===i){var u=s>0?t[s-1].toString():null;if(["e","E","(",za(this.cultureName).currencySymbol].indexOf(u)<0)break}}else(s<r[0]||r[r.length-1]<s)&&(t=Da._remove(t,s,1))}return t},_trimCurrencySymbol:function(e){var t=za(this.cultureName).currencySymbol,r=Da._startsWith(e,t)?Da._remove(e,0,t.length):e;return r.indexOf(t)<0?r:e},_trimPercentSign:function(e){var t=za(this.cultureName).percentSymbol,r=!0,n=e;return Da._startsWith(e,t)?n=Da._remove(e,0,t.length):Da._endsWith(e,t)?n=Da._remove(e,e.length-t.length,t.length):r=!1,Da._contains(n,t)&&(r=!1),{_str:n,_isPer:r}},_getFormattedFractionString:function(e,t,r,n,o){var a=Ba(Ha(e,r,o)),s=Ba(Ha("0."+t,"#."+n,o,!0)),i=a+"/"+s.substr(s.indexOf(".")+1);return""===r&&(i=e+i),""===n&&(i+=t),i}},e}(),us=function(){function e(e,t,r,n){Rs.call(this,t,r,n),arguments.length>0?((e.indexOf("0")>=0||e.indexOf("#")>=0||e.indexOf(".")>=0||e.indexOf("@")>=0)&&qa(),this._fullFormatString=e):this._fullFormatString="General",this._formatType=0}return e.prototype={_getDigitalFormat:function(){if(!this._digitalFormat){var e=this._fullFormatString;e=ys(e,"General",Ua),this._digitalFormat=new is(e,this._partLocaleID,this._partDBNumberFormat,this.cultureName),this._digitalFormat._isGeneralNumber=!0}return this._digitalFormat},_getExponentialDigitalFormat:function(){return this._exponentialDigitalFormat||(this._exponentialDigitalFormat=new is("0.#####E+00",this._partLocaleID,this._partDBNumberFormat,this.cultureName),this._exponentialDigitalFormat._isGeneralNumber=!0),this._exponentialDigitalFormat},formatString:function(){return Da._replace(this._fullFormatString,"@NumberFormat","General")},format:function(e){if(B.a._isNumber(e,this.cultureName)){var t=!this._partLocaleID||this._partLocaleID.allowScience(),r=B.a._toDouble(e);if(void 0!==r&&null!==r)return Ma(r)>99999999999&&t||Ma(r)<1e-11&&0!==r?this._getExponentialDigitalFormat().format(e):this._getDigitalFormat().format(e)}else{if(Pa(e,"string")){var n=Da._replace(this.formatString(),'"',"");return(n=_s(n))?Da._replace(n,"General",e):e}if(Pa(e,"boolean"))return e.toString().toUpperCase()}return""},parse:function(e){if(Qa._isNullOrEmpty(e))return null;if("number"===typeof e)return e;var t,r=!1,n=Da._indexOf(e,"-");if(n>0&&!bs(e.charAt(n-1),"E",!0)&&(r=!0),Da._contains(e,"/")||r||Da._contains(e,":")||Da._contains(e,"-")){var o=xa._parseLocale(e);if(o)return o}var a="-"===e.charAt(0),s=a?Da._remove(e,0,1):e,i="("===s.charAt(0)&&")"===e.charAt(e.length-1);return null!==(t=this._getDigitalFormat().parse(s))&&void 0!==t?(i||a)&&Pa(t,"number")?-1*Ma(t):t:e}},e}(),ls=function(){function e(e,t,r,n){Rs.call(this,t,r,n);var o=As(e,!1);t&&(o=ys(o,this._partLocaleID._originalToken,this._partLocaleID.currencySymbol())),o=_s(o=vs(o)),this._formatString=o,this._formatType=3}return e.prototype={format:function(e){try{var t;t=e instanceof Date?xa._toOADate(e).toString():ds(e);var r=this._parseFormat(this._formatString);return this._toFormattedObject(t,r)}catch(n){return""}},parse:function(e){return e||""},formatString:function(){return this._formatString},_parseFormat:function(e){for(var t,r="",n=!1,o=null,a=[],s=0;s<e.length;s++)t=e.charAt(s),n?('"'!==t?r+=t:(r+=t,a.push(r),r="",n=!1),o=t):"*"!==o&&"_"!==o&&"\\"!==o||""===r?"*"!==t&&"_"!==t&&"\\"!==t?"@"!==t?'"'!==t?(r+=t,o=t):(o=t,""!==r&&a.push(r),r=t,n=!0):(o=t,""!==r&&(a.push(r),r=""),a.push(t)):(o=t,""!==r&&(a.push(r),r=""),r+=t):(r+=t,a.push(r),r="");return""!==r&&a.push(r),a},_toFormattedObject:function(e,t){for(var r=[],n=!1,o=t.length-1;o>=0;o--){var a=t[o];"*"===a[0]?n||(n=!0,r.push({type:"fillingChar",value:a[1]})):"_"===a[0]?r.push({type:"placeholder",value:a[1]}):'"'===a[0]&&'"'===a[a.length-1]?a.length>2&&r.push({type:"text",value:a.substr(1,a.length-2)}):"@"===a[0]?r.push({type:"text",value:e}):r.push({type:"text",value:a})}return r.reverse()}},e}();function cs(e,t,r){return e.substr(t,r)}function ds(e){return B.a._isNullOrUndefined(e)?"":"boolean"===typeof e?e?"TRUE":"FALSE":"string"===typeof e?e:e.toString()}var fs={_positive:0,_negative:1,_zero:2,_text:3},hs=new RegExp("([.+?*$^\\[\\](){}|/])","g");function ms(e,t){if("\\"===e[t])throw new Error(_.a.Exp_InvalidBackslash);if(t-1>0&&t-1<e.length&&"\\"===e[t-1]){if(t-2<0)return!0;if(t-2>0&&t-2<e.length)return"\\"!==e[t-2]}return!1}function ps(e){if(!e)throw new Error(_.a.Exp_TokenIsNull);return"["+e+"]"}function vs(e){if(void 0===e||null===e||""===e)return e;for(var t="",r=0,n=0;n<e.length;n++){var o=e[n];"["===o?r++:"]"===o?--r<0&&(r=0):0===r&&(t+=o)}return t.toString()}function gs(e){return e=ys(e,"[",""),ys(e,"]","")}function ys(e,t,r){return!e||e===Qa._Empty||bs(t,r,!0)?e:(t=t.replace(hs,"\\$1"),e.replace(new RegExp(t,"g"),r))}function _s(e){for(var t=e.length,r=!1,n="",o=0;o<t;o++){var a=e.charAt(o);"\\"===a?(r=!r)||(n+=a):(r=!1,n+=a)}return n}function bs(e,t,r){return r?Ka(e)===Ka(t):e===t}function As(e,t){1===arguments.length&&(t=!0);for(var r=!1,n="",o=0;o<e.length;o++){var a=e[o];if('"'===a)r=!r;else if(!r&&!t&&"/"===a&&!ms(e,o)){"_"===a&&o++;continue}n+=a}return n}function Es(e,t){if(!e||e===Qa._Empty)return!1;for(var r=function(e){for(var t="",r=!1,n=0,o=e.length;n<o;n++){var a=e[n];'"'===a&&(r=!r),"E"===a||r||(t+=Ka(a))}return t}(As(e)),n=0;n<t.length;n++){var o=r.indexOf(t[n]);if(0===o)return!0;if(o>0&&"_"!==r[o-1]&&"*"!==r[o-1])return!0}return!1}var js=[["M/d","MMM/d","MMMM/d","d/M","d/MMM","d/MMMM","M-d","MMM-d","MMMM-d","d-M","d-MMM","d-MMMM"],["M/y","MMM/y","M/yyyy","MMM/yyyy","M-y","MMM-y","M-yyyy","MMM-yyyy"],["M/d/y","MMM/d/y","MMMM/d/y","M/d/yyyy","MMM/d/yyyy","MMMM/d/yyyy","d/M/y","d/MMM/y","d/MMMM/y","d/M/yyyy","d/MMM/yyyy","d/MMMM/yyyy","yyyy/M/d","M-d-y","MMM-d-y","MMMM-d-y","M-d-yyyy","MMM-d-yyyy","MMMM-d-yyyy","d-M-y","d-MMM-y","d-MMMM-y","d-M-yyyy","d-MMM-yyyy","d-MMMM-yyyy","yyyy-M-d"],["H:m","h:m tt"],["H:m:s","h:m:s tt","H:m:s","h:mm:ss tt"],["H:m:s.FFF","h:m:s.FFF tt"],["M/d H:m","MMM/d H:m","MMMM/d H:m","d/M H:m","d/MMM H:m","d/MMMM H:m","M/y H:m","MMM/y H:m","M/yyyy H:m","MMM/yyyy H:m","M/d/y H:m","MMM/d/y H:m","MMMM/d/y H:m","M/d/yyyy H:m","MMM/d/yyyy H:m","MMMM/d/yyyy H:m","M-d H:m","MMM-d H:m","MMMM-d H:m","d-M H:m","d-MMM H:m","d-MMMM H:m","M-y H:m","MMM-y H:m","M-yyyy H:m","MMM-yyyy H:m","M-d-y H:m","MMM-d-y H:m","MMMM-d-y H:m","M-d-yyyy H:m","MMM-d-yyyy H:m","MMMM-d-yyyy H:m","M/d h:m tt","MMM/d h:m tt","MMMM/d h:m tt","d/M h:m tt","d/MMM h:m tt","d/MMMM h:m tt","M/y h:m tt","MMM/y h:m tt","M/yyyy h:m tt","MMM/yyyy h:m tt","M/d/y h:m tt","MMM/d/y h:m tt","MMMM/d/y h:m tt","M/d/yyyy h:m tt","MMM/d/yyyy h:m tt","MMMM/d/yyyy h:m tt","M-d h:m tt","MMM-d h:m tt","MMMM-d h:m tt","d-M h:m tt","d-MMM h:m tt","d-MMMM h:m tt","M-y h:m tt","MMM-y h:m tt","M-yyyy h:m tt","MMM-yyyy h:m tt","M-d-y h:m tt","MMM-d-y h:m tt","MMMM-d-y h:m tt","M-d-yyyy h:m tt","MMM-d-yyyy h:m tt","MMMM-d-yyyy h:m tt"],["M/d H:m:s","MMM/d H:m:s","MMMM/d H:m:s","d/M H:m:s","d/MMM H:m:s","d/MMMM H:m:s","M/y H:m:s","MMM/y H:m:s","M/yyyy H:m:s","MMM/yyyy H:m:s","M/d/y H:m:s","MMM/d/y H:m:s","MMMM/d/y H:m:s","M/d/yyyy H:m:s","MMM/d/yyyy H:m:s","MMMM/d/yyyy H:m:s","d/M/y H:m:s","d/MMM/y H:m:s","d/MMMM/y H:m:s","d/M/yyyy H:m:s","d/MMM/yyyy H:m:s","d/MMMM/yyyy H:m:s","yyyy/M/d H:m:s","M-d H:m:s","MMM-d H:m:s","MMMM-d H:m:s","d-M H:m:s","d-MMM H:m:s","d-MMMM H:m:s","M-y H:m:s","MMM-y H:m:s","M-yyyy H:m:s","MMM-yyyy H:m:s","M-d-y H:m:s","MMM-d-y H:m:s","MMMM-d-y H:m:s","M-d-yyyy H:m:s","MMM-d-yyyy H:m:s","MMMM-d-yyyy H:m:s","d-M-y H:m:s","d-MMM-y H:m:s","d-MMMM-y H:m:s","d-M-yyyy H:m:s","d-MMM-yyyy H:m:s","d-MMMM-yyyy H:m:s","yyyy-M-d H:m:s","M/d h:m:s tt","MMM/d h:m:s tt","MMMM/d h:m:s tt","d/M h:m:s tt","d/MMM h:m:s tt","d/MMMM h:m:s tt","M/y h:m:s tt","MMM/y h:m:s tt","M/yyyy h:m:s tt","MMM/yyyy h:m:s tt","M/d/y h:m:s tt","MMM/d/y h:m:s tt","MMMM/d/y h:m:s tt","M/d/yyyy h:m:s tt","MMM/d/yyyy h:m:s tt","MMMM/d/yyyy h:m:s tt","d/M/y h:m:s tt","d/MMM/y h:m:s tt","d/MMMM/y h:m:s tt","d/M/yyyy h:m:s tt","d/MMM/yyyy h:m:s tt","d/MMMM/yyyy h:m:s tt","yyyy/M/d h:m:s tt","M/d/yyyy h:mm:ss tt","M-d h:m:s tt","MMM-d h:m:s tt","MMMM-d h:m:s tt","d-M h:m:s tt","d-MMM h:m:s tt","d-MMMM h:m:s tt","M-y h:m:s tt","MMM-y h:m:s tt","M-yyyy h:m:s tt","MMM-yyyy h:m:s tt","M-d-y h:m:s tt","MMM-d-y h:m:s tt","MMMM-d-y h:m:s tt","M-d-yyyy h:m:s tt","MMM-d-yyyy h:m:s tt","MMMM-d-yyyy h:m:s tt","d-M-y h:m:s tt","d-MMM-y h:m:s tt","d-MMMM-y h:m:s tt","d-M-yyyy h:m:s tt","d-MMM-yyyy h:m:s tt","d-MMMM-yyyy h:m:s tt","yyyy-M-d h:m:s tt"],["M/d H:m:s.FFF","MMM/d H:m:s.FFF","MMMM/d H:m:s.FFF","d/M H:m:s.FFF","d/MMM H:m:s.FFF","d/MMMM H:m:s.FFF","M/y H:m:s.FFF","MMM/y H:m:s.FFF","M/yyyy H:m:s.FFF","MMM/yyyy H:m:s.FFF","d/M/y H:m","d/MMM/y H:m","d/MMMM/y H:m","d/M/yyyy H:m","d/mmm/yyyy H:m","d/MMMM/yyyy H:m","yyyy/M/d H:m","M/d/y H:m:s.FFF","MMM/d/y H:m:s.FFF","MMMM/d/y H:m:s.FFF","M/d/yyyy H:m:s","MMM/d/yyyy H:m:s.FFF","MMMM/d/yyyy H:m:s.FFF","d/M/y H:m:s.FFF","d/MMM/y H:m:s.FFF","d/MMMM/y H:m:s.FFF","d/M/yyyy H:m:s.FFF","d/MMM/yyyy H:m:s.FFF","d/MMMM/yyyy H:m:s.FFF","yyyy/M/d H:m:s.FFF","M-d H:m:s.FFF","MMM-d H:m:s.FFF","MMMM-d H:m:s.FFF","d-M H:m:s.FFF","d-MMM H:m:s.FFF","d-MMMM H:m:s.FFF","M-y H:m:s.FFF","MMM-y H:m:s.FFF","M-yyyy H:m:s.FFF","MMM-Yyyy H:m:s.FFF","d-M-y H:m","d-MMM-y H:m","d-MMMM-y H:m","d-M-yyyy H:m","d-MMM-yyyy H:m","d-MMMM-yyyy H:m","yyyy-M-d H:m","M-d-y H:m:s.FFF","MMM-d-y H:m:s.FFF","MMMM-d-y H:m:s.FFF","M-d-yyyy H:m:s","MMM-d-yyyy H:m:s.FFF","MMMM-d-yyyy H:m:s.FFF","D-M-y H:m:s.FFF","d-MMM-y H:m:s.FFF","d-MMMM-y H:m:s.FFF","D-M-yyyy H:m:s.FFF","d-MMM-yyyy H:m:s.FFF","d-MMMM-yyyy H:m:s.FFF","yyyy-M-d H:m:s.FFF","M/d h:m:s.FFF tt","MMM/d h:m:s.FFF tt","MMMM/d h:m:s.FFF tt","d/M h:m:s.FFF tt","d/MMM h:m:s.FFF tt","d/MMMM h:m:s.FFF tt","M/y h:m:s.FFF tt","MMM/y h:m:s.FFF tt","M/yyyy h:m:s.FFF tt","MMM/yyyy h:m:s.FFF tt","d/M/y h:m tt","d/MMM/y h:m tt","d/MMMM/y h:m tt","d/M/yyyy h:m tt","d/mmm/yyyy h:m tt","d/MMMM/yyyy h:m tt","yyyy/M/d h:m tt","M/d/y h:m:s.FFF tt","MMM/d/y h:m:s.FFF tt","MMMM/d/y h:m:s.FFF tt","M/d/yyyy h:m:s tt","MMM/d/yyyy h:m:s.FFF tt","MMMM/d/yyyy h:m:s.FFF tt","d/M/y h:m:s.FFF tt","d/MMM/y h:m:s.FFF tt","d/MMMM/y h:m:s.FFF tt","d/M/yyyy h:m:s.FFF tt","d/MMM/yyyy h:m:s.FFF tt","d/MMMM/yyyy h:m:s.FFF tt","yyyy/M/d h:m:s.FFF tt","M-d h:m:s.FFF tt","MMM-d h:m:s.FFF tt","MMMM-d h:m:s.FFF tt","d-M h:m:s.FFF tt","d-MMM h:m:s.FFF tt","d-MMMM h:m:s.FFF tt","M-y h:m:s.FFF tt","MMM-y h:m:s.FFF tt","M-yyyy h:m:s.FFF tt","MMM-Yyyy h:m:s.FFF tt","d-M-y h:m tt","d-MMM-y h:m tt","d-MMMM-y h:m tt","d-M-yyyy h:m tt","d-MMM-yyyy h:m tt","d-MMMM-yyyy h:m tt","yyyy-M-d h:m tt","M-d-y h:m:s.FFF tt","MMM-d-y h:m:s.FFF tt","MMMM-d-y h:m:s.FFF tt","M-d-yyyy H:m:s tt","MMM-d-yyyy H:m:s.FFF tt","MMMM-d-yyyy h:m:s.FFF tt","d-M-y h:m:s.FFF tt","d-MMM-y h:m:s.FFF tt","d-MMMM-y h:m:s.FFF tt","d-M-yyyy h:m:s.FFF tt","d-MMM-yyyy h:m:s.FFF tt","d-MMMM-yyyy h:m:s.FFF tt","yyyy-M-d h:m:s.FFF tt"]];function Rs(e,t,r){this._partLocaleID=e,this._partDBNumberFormat=t,this.cultureName=r}function Ss(e){this._originalToken=e}function Cs(e){var t,r=gs(e);if(!r||r===Qa._Empty)return t;var n=r[0];return["<",">","="].indexOf(n)>-1?(t=rs).Name="ConditionalFormatPart":Da._startsWith(r,"DBNum",!0)?(t=ns).Name="DBNumberFormatPart":bs(r[0],"$",!1)&&r.indexOf("-")>-1?(t=$a).Name="LocaleIDFormatPart":!function(e){var t=Ka(e),r=t[0];if("h"!==r&&"m"!==r&&"s"!==r)return!1;for(var n=1;n<t.length;n++)if(r!==t[n])return!1;return!0}(r)?r.indexOf("$")<0&&r.length>=3&&((t=ss).Name="ColorFormatPart"):(t=as).Name="ABSTimeFormatPart",t}function Ts(e,t,r){var n=(e?e.cultureInfo():Wa(r)).NumberFormat.dbNumber;return n?n[t]:null}var ws=function(){function e(e,t){var r=this;0===arguments.length?(r.formatCached="General",r._numberFormat=new us):r._init(e,t)}var t=["colorFormatPart","conditionalFormatPart","dbNumberFormatPart","localeIDFormatPart"];function r(e){if(!e||e===Qa._Empty)throw new Error(_.a.Exp_TokenIllegal)}function n(e){r(e);var t=gs(e);return r(t),t}function o(e){var t=n(e);return"$"===t[0]&&(t=t.slice(1)),'"'+t+'"'}return e.prototype={_init:function(e,t){null!==e&&void 0!==e||qa();var r=e;this.formatCached=e;for(var a="",s="",i=!1,u=[],l=0;l<e.length;l++){var c=e[l];if("["===c)i&&qa(),s&&(a||(a=""),a+=s),s=c.toString(),i=!0;else if("]"===c){if(i||qa(),s){var d=(s+=c).toString(),f=Cs(s.toString());if(f)"ABSTimeFormatPart"===f.Name?(u.push(new f(n(d),d)),a+=s):this.addPart(f,d);else{var h=o(d);a+=h,r=ys(e,d,h)}s=""}else qa();i=!1}else s+=c}s?i?qa():a+=s:a||(a=this._getDBNumberDefaultFormat()),this.localeIDFormatPart&&(t=this.localeIDFormatPart.cultureInfo().name());var m=function(e,t){var r,n=!1;return Es(e=e?e.toString():Qa._Empty,["general"])?r=us:os._evaluateFormat(e)?r=os:Es(e,["E+","E-","#",".",",","%","0","/","?"])||t?(n=!0,r=is):(n=!0,r=ls),{_isDigitalOrText:n,_type:r}}(a,this.conditionalFormatPart),p=m._type,v=m._isDigitalOrText?r:a;p?this._numberFormat=new p(v,this.localeIDFormatPart,this.dbNumberFormatPart,t,u.length>0?u:null):qa()},_getDBNumberDefaultFormat:function(){var e=this,r="";e.dbNumberFormatPart&&(t.some((function(t){return"dbNumberFormatPart"!==t&&e[t]}))||(r="General"));return r},formatString:function(){for(var e="",r=0,n=t.length;r<n;r++){var o=t[r];this[o]&&(e+=this[o].toString())}return e+=this._numberFormat.formatString(),e},addPart:function(e,r){for(var o=n(r),a=0,s=t.length;a<s;a++){var i=t[a];if(bs(i,e.Name,!0)){if(this[i])throw new Error(_.a.Exp_DuplicatedDescriptor);this[i]=new e(o,r)}}},format:function(e){return this._numberFormat.format(e)},parse:function(e){return this._numberFormat.parse(e)}},e}(),Os=function(e){function t(e,t){this._isSingleFormatterInfo=!0,this.PropertyChanged=[],Qa._isNullOrEmpty(e)&&(e="General"),this.formatCached=e,this.cultureName=t,this.init()}function r(e){var r=t[e];return r||(r=new t(e),t[e]=r),r}return B.a._inherit(t,e),t.prototype={toJSON:function(){var e={formatCached:this.formatCached};return this.cultureName&&(e.customerCultureName=this.cultureName),"general"===Ka(this.formatCached)&&delete e.formatCached,e},hasFormatedColor:function(){for(var e in fs)if(fs.hasOwnProperty(e)){var t=this.getFormatter(fs[e]);if(t&&t.colorFormatPart)return!0}return!1},formatString:function(e){var t=this;if(0===arguments.length){for(var r=Qa._Empty,n=0,o=t.formatters.length;n<o;n++){var a=t.formatters[n];r+=a.formatString(),n!==o-1&&(r+=";")}return r}if(!e)throw new Error(_.a.Exp_ValueIsNull);return t.formatters=null,t.formatCached=e,t.init(),t._raisePropertyChanged("formatString"),t},getFormatter:function(e){return this.formatters&&this.formatters[e]},getPreferredEditingFormatter:function(e){var t=Ya(this.cultureName);if(Pa(e,"DateTime")){var n=0===e.getHours()&&0===e.getMinutes()&&0===e.getSeconds()&&0===e.getMilliseconds()?"":" h:mm:ss";return r(t.shortDatePattern+n)}if(Pa(e,"TimeSpan"))return r(t.longTimePattern);if(B.a._isNumber(e,this.cultureName)){var o=B.a._toDouble(e);return r(o>=1e20||o<=1e-17&&o>0||o<=-1e20||o<0&&o>=-1e-17?"0.##E+00":Ua)}return r("General")},getPreferredDisplayFormatter:function(e,n){if(n||(n={value:null}),n.value=null,Qa._isNullOrEmpty(e))return new t;var o=e,a=n.value=this.parse(o);if(Pa(a,"DateTime")||Pa(a,"TimeSpan"))for(var s={pattern:js,formatter:["d-mmm","mmm-yy",Ya().shortDatePattern,"h:mm","h:mm:ss","h:mm:ss.0",Ya().shortDatePattern+" h:mm",Ya().shortDatePattern+" h:mm:ss",Ya().shortDatePattern+" h:mm:ss.0"]},i=s.pattern,u=s.formatter,l=0;l<i.length;l++)for(var c=i[l],d=0;d<c.length;d++){var f=c[d],h=xa._parseLocale(e,f);if(h&&h-a===0)return new t(u[l])}else if(B.a._isNumber(a,this.cultureName)){var m=za(this.cultureName),p=m.currencySymbol,v=m.numberDecimalSeparator,g=m.percentSymbol,y=m.numberGroupSeparator,_=Da._contains,b=_(o,v)?".00":"";if(o[0]===p)return r(Qa._format("{0}#,##0{1};[Red]({0}#,##0{1})",p,b));if(_(o,"E",1))return r("0.00E+00");if(o[0].toString()===g||o[o.length-1].toString()===g)return r(Qa._format("0{0}%",b));if(_(o,y))return r(Qa._format("#,##0{0}",b))}return r("General")},format:function(e,t){if(Pa(e,"boolean"))return e.toString().toUpperCase();var r=this._getFormatInfo(e);if(r){var n=r.colorFormatPart;t&&n&&(t.conditionalForeColor=t.value=n.foreColor);var o=0,a=B.a._isNumber(e,self.cultureName);a&&(o=B.a._toDouble(e));var s=Qa._Empty;try{a&&r===this.getFormatter(fs._negative)?s=r.format(Ma(o)):void 0===(s=r.value)&&(s=r.format(e)),t&&(t.content=La(s)?s:[{type:"text",value:s}]),La(s)&&(s=Fa._formatObjectToSrting(s))}catch(i){Pa(e,"string")&&(s=e.toString())}return s}return a&&o<0?"-".toString():Pa(e,"string")?e.toString():void 0===e||null===e?Qa._Empty:e.toString()},parse:function(e){return this.formatters&&this.formatters.length>0?this.formatters[0].parse(e):null},init:function(){var e=this.formatCached;Qa._isNullOrEmpty(e)&&qa(),this.formatters=[];var t=e.split(";");this._isSingleFormatterInfo=1===t.length,(!t||t.length<1||t.length>4)&&qa();for(var r=0;r<t.length;r++){var n=new ws(t[r],this.cultureName);this.formatters.push(n)}this.getFormatter(fs._positive)||qa()},_getFormatInfo:function(e){var t=this.getFormatter(fs._positive),r=t&&t.conditionalFormatPart,n=this.getFormatter(fs._text);if("string"===typeof e&&isNaN(e))return n||(r?e:t);if(B.a._isNumber(e,this.cultureName)||Pa(e,"boolean")){var o,a=this.getFormatter(fs._negative),s=this.getFormatter(fs._zero),i=B.a._toDouble(e),u=r&&t.conditionalFormatPart.isMeetCondition(i),l=a&&a.conditionalFormatPart,c=l&&a.conditionalFormatPart.isMeetCondition(i);if(this._isSingleFormatterInfo||(r?u:i>0||0===i&&!s))o=t;else if(l?c:i<0)o=a;else if(s)o=s;else if(a){if(r&&l)return{value:""===s?"":i+""};o=a}return o}return null},_raisePropertyChanged:function(e){if(this.PropertyChanged)for(var t=0;t<this.PropertyChanged.length;t++){var r=this.PropertyChanged[t];"function"===typeof r&&r(this,e)}}},t}(Za),Is=B.a._isNullOrUndefined,Ns=b.default._parseLocale,ks=b.default._toOADate,Ms=L.a._getLength;function Ds(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(r<=0)throw new Error(m.l.value);if(Array.isArray(e)){if(v.i(e).length>1)throw new Error(m.l.value);e=String(v.i(e)[0])}else e=String(e);if(Array.isArray(t)){if(v.i(t).length>1)throw new Error(m.l.value);t=String(v.i(t)[0])}else t=String(t);if(!t)throw new Error(m.l.value);if(""===e)return 1;var n=t.replace(/[\u200B-\u200D\uFEFF]/g,"").indexOf(e.replace(/[\u200B-\u200D\uFEFF]/g,""),r-1);if(-1===n)throw new Error(m.l.value);return n+1}function xs(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Ps(!0,e,t)}function Fs(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Ps(!1,e,t)}function Ps(e,t,r){if(r<0||isNaN(r))throw new Error(m.l.value);return r>=Ms(t)?t:("string"!==typeof t&&(t=t.toString()),t.substr(e?0:Ms(t)-r,r))}function Ls(e){if(v.b(e))return e;if(!(e=k(e)))return 0;if("string"===typeof e)return e?e.length:0;if(e.length)return e.length;throw new Error(m.l.value)}function Us(e,t,r){if(""===r&&(r=0),null===e&&(e=""),t<=0||r<0)throw new Error(m.l.value);if("number"===typeof e&&(e=String(e)),t=v.A(t),r=v.A(r),v.b(t,r)||"string"!==typeof e)return r;var n=t-1,o=n+r;return e.substring(n,o)}function Bs(e,t,r,n){var o,a=k(e),s=k(t),i=Ms(s);if(Ms(arguments)>3){var u,l=T(n),c=0;if(l<1)return m.l.value;for(u=0;u<l;u++){if(-1===(c=a.indexOf(s,c)))return a;c+=i}var d=a.substring(0,c-i),f=a.substr(c);o=d.concat(r).concat(f)}else{if(""===s)return a;o=A.a._join(a,s,r)}return o}function Hs(e){if(Array.isArray(e))return m.l.value;var t=k(e);t=t.trim();var r,n,o=[],a=!0,s=String.fromCharCode(160);for(r=0,n=Ms(t);r<n;r++){var i=t.charAt(r),u=" "===i||"\t"===i||i===s,l="\n"===i;l||u&&!a||o.push(i),a=l||!u}return o.join("")}function Gs(e,t){var r,n,o=[],a=Ms(e);for(r=0;r<a;r++){if(Array.isArray(e[r]))return m.l.value;var s=k(e[r]),i=Ms(s);if(0===i&&"concat"===t)return m.l.nil;for(n=0;n<i;n++)Is(s[n])||o.push(k(s[n]))}return o.join("")}function Vs(){return Gs(arguments,"concatenate")}function Ws(){for(var e=[],t=0,r=arguments.length;t<r;t++){var n=t<0||arguments.length<=t?void 0:arguments[t];Array.isArray(n)?(n=v.i(n),e=e.concat(n)):e.push(n)}return Gs(e,"concat")}function Ys(e){if(!(e=v.B(e,De.a._astNodes[0])))return 0;e=k(e);var t,r=Ns(e);return Is(r)?function(e){var t=Na.a._getCultureInfo().NumberFormat,r=ft.isDigit,n=!1;"$"!==e[0]&&e[0]!==t.currencySymbol||(e=e.substring(1),n=!0);var o=parseFloat(e);if(!e||isNaN(o)||!n&&isNaN(e)||!r(e[0].charCodeAt(0))&&"."!==e[0]&&"-"!==e[0])return m.l.value;"."===e[0]&&(e="0"+e);for(var a,s=e.length,i=0,u=0,l=0;i<s;i++){for(a=e[i];i<s&&r(a.charCodeAt(0));)a=e[++i];if(i===s){if(u&&i-u<=3)return m.l.value;break}if(a===t.numberGroupSeparator){if(l||u&&i-u<=3)return m.l.value;u=i}else if(a===t.numberDecimalSeparator){if(l||u&&i-u<=3)return m.l.value;l=i}}return e=A.a._replace(e,",",""),parseFloat(e)}(e):S(t=ks(r))?ca(r):t}function zs(e){var t,r=e.toString(),n="",o=[];e<0&&(r=r.substr(1),n="-");var a=r.split("."),s=Ms(a);if(s<1||s>2)return m.l.value;for(2===s&&(o.push(a[1]),o.push(".")),r=a[0],t=Ms(r)-3;t>=0;t-=3)o.push(r.substr(t,3)),t>0&&o.push(",");return o.push(r.substring(0,t+3)),o.reverse(),n+o.join("")}function Ks(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e=v.B(e,De.a._astNodes[0],!0),""===(t=v.B(t,De.a._astNodes[1],!0))&&v.p(De.a._astNodes[1])&&(t=0),""===t&&(t=2),"string"===typeof r){var n=r.toLowerCase();switch(n){case"true":r=!0;break;case"false":case"":r=!1;break;default:return m.l.value}}var o=0;t<0&&(e/=o=T(Math.pow(10,Math.abs(t)))),e=w(vr(e,Math.max(0,t))),t<0&&(e*=o),(e=r?e.toString():zs(e)).indexOf(".")<0&&t>0&&(e+=".");for(var a=e.length-e.indexOf(".");a<=t;a++)e+="0";return e}var qs={12449:65383,12451:65384,12453:65385,12455:65386,12457:65387,12540:65392,12450:65393,12452:65394,12454:65395,12456:65396,12458:65397,12459:65398,12461:65399,12463:65400,12465:65401,12467:65402,12469:65403,12471:65404,12473:65405,12475:65406,12477:65407,12479:65408,12481:65409,12484:65410,12486:65411,12488:65412,12490:65413,12491:65414,12492:65415,12493:65416,12494:65417,12495:65418,12498:65419,12501:65420,12504:65421,12507:65422,12510:65423,12511:65424,12512:65425,12513:65426,12514:65427,12516:65428,12518:65429,12520:65430,12521:65431,12522:65432,12523:65433,12524:65434,12525:65435,12527:65436,12530:65382,12531:65437,12483:65391};function Qs(e){e=k(e);for(var t=[],r=!1,n=0,o=Ms(e);n<o;n++){var a=e.charCodeAt(n);12288!==a?a>65280&&a<65375?(t.push(String.fromCharCode(a-65248)),r=!0):qs[a]?(t.push(String.fromCharCode(qs[a])),r=!0):t.push(e[n]):(t.push(String.fromCharCode(32)),r=!0)}return r?t.join(""):e}function Xs(e){return(e=k(e)).toUpperCase()}function Js(e){return(e=T(e))<1||e>255?m.l.value:String.fromCharCode(e)}function $s(e,t){if(Array.isArray(e))return m.l.value;""===(t=v.B(t,De.a._astNodes[1],!0))&&(t=0);var r,n=[];if((t=parseInt(t))<0||t*Ms(e)>32767)return m.l.value;for(r=0;r<t;r++)n.push(e);return n.join("")}function Zs(e){if("boolean"===typeof e&&(e=e.toString()),"string"!==typeof e)return e;var t=Ms(e),r=[];if(t>0){var n=e.toUpperCase(),o=e.toLowerCase(),a=1;for(r[0]=n[0];a<t;)r[a]=ft._isLetter(e[a-1])?o[a]:n[a],a++}return r.join("")}function ei(e,t){return"string"!==typeof e&&(e=e.toString()),"string"!==typeof t&&(t=t.toString()),e===t}function ti(e,t){var r=Array.isArray(e)?v.j(e):[e];if(r.isReference&&0===r.length)return CalcErrorsNull;var n={value:!1},o=!!Is(t)||t;if(!N(o,n))return m.l.value;o=n.value;var a,s,i=Array.from(arguments).map((function(e,t){return t<2?e:Array.isArray(e)?v.j(e):[e]})),u=[],l=Ms(i);for(a=2;a<l;a++){var c=i[a],d=Ms(c);if(0===d)return m.l.null;for(s=0;s<d;s++)Is(c[s])||""===c[s]?o||u.push(""):u.push(k(c[s]))}if(Array.isArray(r)){if(0===r.length)return m.l.null;var f=u[0];for(s=0,a=1;a<u.length;a++)s===r.length&&(s=0),f+=r[s++]+u[a];return f}return u.join(r)}function ri(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return ti.apply(this,t)}function ni(e){if(e=v.B(e,De.a._astNodes[0])){var t=e;return t<=0||t>1114111?m.l.value:t>=55296&&t<=57343?m.l.na:t<1048576?String.fromCharCode(t):(t-=1048576,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}return m.l.value}function oi(e){var t,r,n=k(e);return""===n||null===n?m.l.value:(t=n.charCodeAt(0))>=55296&&t<=56319?1===n.length?m.l.value:(r=n.charCodeAt(1))>=56320&&r<=57343?t|r<<8:1:t>=56320&&t<=57343?t-53248+53248:t}function ai(e){return(e=k(e)).toLowerCase()}function si(e){return function(e){var t=e;if(Array.isArray(e)){if(!e.__isUserWrite)return m.l.value;t=e[0][0]}var r=k(t);return""===r?m.l.value:r.charCodeAt(0)}(e)}function ii(e,t,r,n){if(e=k(e),t=T(t=v.B(t,De.a._astNodes[1])),isNaN(t)||t<1)return m.l.value;if(""===(r=v.B(r,De.a._astNodes[2]))&&(r=0),r=T(r),isNaN(r)||r<0)return m.l.value;n=k(n);var o=Ms(e);t=Math.min(t,o+1),r=Math.min(r||0,o-t+1);var a=e.substring(0,t-1),s=e.substr(t-1+r);return a.concat(n).concat(s)}function ui(e){e=k(e);var t,r,n=[];for(t=0;t<Ms(e);t++)0<=(r=e.charCodeAt(t))&&r<=31||127===r||128<=r&&r<=159||n.push(e[t]);return n.join("")}function li(e){var t=zs(e),r=[];return e<0&&(t=t.substr(1)),r.push("\xa5"),r.push(t),e<0&&(r.push(")"),r.unshift("(")),r.join("")}function ci(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(""===(e=v.B(e,De.a._astNodes[0],!0))&&(e=0),""===(t=v.B(t,De.a._astNodes[1],!0))&&(t=2),e=w(e),t=T(t),isNaN(e)||isNaN(t))return m.l.value;if((e=k(e=w(vr(e,t)))).indexOf(".")>-1)for(var r=e.length-e.indexOf(".");r<=t;r++)e+="0";return li(e)}function di(e){return Array.isArray(e)&&(e=(e=v.i(e))[0]),e=v.y(e,De.a._astNodes[0]),Me._isString(e)?e:""}function fi(e,t){if(""===(t=k(t)))return k(e);Is(e)&&(e=0);try{return Os?new Os(t).format(e):e.toString()}catch(r){return m.l.value}}function hi(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(e=k(e),t=k(t),""===(r=v.B(r,De.a._astNodes[0]))&&(r=0),(r=T(r))<=0)return m.l.value;var n,o,a=-1;return(n=U.default._getWildcardCriteria(e))?(o=U.default._getRegIgnoreCase(n).exec(t),a=Is(o)?-1:o.index):a=t.toLowerCase().indexOf(e.toLowerCase(),--r),-1===a?m.l.value:a+1}var mi={version:"1.0.2"},pi=Math;function vi(e,t){for(var r=0,n=0;r<e.length;++r)n=t*n+e[r];return n}function gi(e,t,r,n,o){if(0===t)return r;if(1===t)return n;for(var a=2/e,s=n,i=1;i<t;++i)s=n*i*a+o*r,r=n,n=s;return s}function yi(e,t,r,n,o){return function(r,a){if(n){if(0===r)return 1==n?-1/0:1/0;if(r<0)return NaN}return 0===a?e(r):1===a?t(r):a<0?NaN:gi(r,a|=0,e(r),t(r),o)}}var _i=function(){var e=.636619772,t=[57568490574,-13362590354,651619640.7,-11214424.18,77392.33017,-184.9052456].reverse(),r=[57568490411,1029532985,9494680.718,59272.64853,267.8532712,1].reverse(),n=[1,-.001098628627,2734510407e-14,-2073370639e-15,2.093887211e-7].reverse(),o=[-.01562499995,.0001430488765,-6911147651e-15,7.621095161e-7,-9.34935152e-8].reverse();function a(a){var s=0,i=0,u=0,l=a*a;if(a<8)s=(i=vi(t,l))/(u=vi(r,l));else{var c=a-.785398164;i=vi(n,l=64/l),u=vi(o,l),s=pi.sqrt(e/a)*(pi.cos(c)*i-pi.sin(c)*u*8/a)}return s}var s=[72362614232,-7895059235,242396853.1,-2972611.439,15704.4826,-30.16036606].reverse(),i=[144725228442,2300535178,18583304.74,99447.43394,376.9991397,1].reverse(),u=[1,.00183105,-3516396496e-14,2457520174e-15,-2.40337019e-7].reverse(),l=[.04687499995,-.0002002690873,8449199096e-15,-8.8228987e-7,1.05787412e-7].reverse();function c(t){var r=0,n=0,o=0,a=t*t,c=pi.abs(t)-2.356194491;return Math.abs(t)<8?r=(n=t*vi(s,a))/(o=vi(i,a)):(n=vi(u,a=64/a),o=vi(l,a),r=pi.sqrt(e/pi.abs(t))*(pi.cos(c)*n-pi.sin(c)*o*8/pi.abs(t)),t<0&&(r=-r)),r}return function e(t,r){if(r=Math.round(r),!isFinite(t))return isNaN(t)?t:0;if(r<0)return(r%2?-1:1)*e(t,-r);if(t<0)return(r%2?-1:1)*e(-t,r);if(0===r)return a(t);if(1===r)return c(t);if(0===t)return 0;var n=0;if(t>r)n=gi(t,r,a(t),c(t),-1);else{for(var o=!1,s=0,i=0,u=1,l=0,d=2/t,f=2*pi.floor((r+pi.floor(pi.sqrt(40*r)))/2);f>0;f--)l=f*d*u-s,s=u,u=l,pi.abs(u)>1e10&&(u*=1e-10,s*=1e-10,n*=1e-10,i*=1e-10),o&&(i+=u),o=!o,f==r&&(n=s);n/=i=2*i-u}return n}}(),bi=function(){var e=.636619772,t=[-2957821389,7062834065,-512359803.6,10879881.29,-86327.92757,228.4622733].reverse(),r=[40076544269,745249964.8,7189466.438,47447.2647,226.1030244,1].reverse(),n=[1,-.001098628627,2734510407e-14,-2073370639e-15,2.093887211e-7].reverse(),o=[-.01562499995,.0001430488765,-6911147651e-15,7.621095161e-7,-9.34945152e-8].reverse();var a=[-4900604943e3,127527439e4,-51534381390,734926455.1,-4237922.726,8511.937935].reverse(),s=[249958057e5,424441966400,3733650367,22459040.02,102042.605,354.9632885,1].reverse(),i=[1,.00183105,-3516396496e-14,2457520174e-15,-2.40337019e-7].reverse(),u=[.04687499995,-.0002002690873,8449199096e-15,-8.8228987e-7,1.05787412e-7].reverse();return yi((function(a){var s=0,i=0,u=0,l=a*a,c=a-.785398164;return a<8?s=(i=vi(t,l))/(u=vi(r,l))+e*_i(a,0)*pi.log(a):(i=vi(n,l=64/l),u=vi(o,l),s=pi.sqrt(e/a)*(pi.sin(c)*i+pi.cos(c)*u*8/a)),s}),(function(t){var r=0,n=0,o=0,l=t*t,c=t-2.356194491;return t<8?r=(n=t*vi(a,l))/(o=vi(s,l))+e*(_i(t,1)*pi.log(t)-1/t):(n=vi(i,l=64/l),o=vi(u,l),r=pi.sqrt(e/t)*(pi.sin(c)*n+pi.cos(c)*o*8/t)),r}),0,1,-1)}(),Ai=function(){var e=[1,3.5156229,3.0899424,1.2067492,.2659732,.0360768,.0045813].reverse(),t=[.39894228,.01328592,.00225319,-.00157565,.00916281,-.02057706,.02635537,-.01647633,.00392377].reverse();var r=[.5,.87890594,.51498869,.15084934,.02658733,.00301532,32411e-8].reverse(),n=[.39894228,-.03988024,-.00362018,.00163801,-.01031555,.02282967,-.02895312,.01787654,-.00420059].reverse();return function o(a,s){if(0===(s=Math.round(s)))return function(r){return r<=3.75?vi(e,r*r/14.0625):pi.exp(pi.abs(r))/pi.sqrt(pi.abs(r))*vi(t,3.75/pi.abs(r))}(a);if(1===s)return function(e){return e<3.75?e*vi(r,e*e/14.0625):(e<0?-1:1)*pi.exp(pi.abs(e))/pi.sqrt(pi.abs(e))*vi(n,3.75/pi.abs(e))}(a);if(s<0)return NaN;if(0===pi.abs(a))return 0;if(a==1/0)return 1/0;var i,u=0,l=2/pi.abs(a),c=0,d=1,f=0;for(i=2*pi.round((s+pi.round(pi.sqrt(40*s)))/2);i>0;i--)f=i*l*d+c,c=d,d=f,pi.abs(d)>1e10&&(d*=1e-10,c*=1e-10,u*=1e-10),i==s&&(u=c);return u*=o(a,0)/d,a<0&&s%2?-u:u}}(),Ei=function(){var e=[-.57721566,.4227842,.23069756,.0348859,.00262698,1075e-7,74e-7].reverse(),t=[1.25331414,-.07832358,.02189568,-.01062446,.00587872,-.0025154,53208e-8].reverse();var r=[1,.15443144,-.67278579,-.18156897,-.01919402,-.00110404,-4686e-8].reverse(),n=[1.25331414,.23498619,-.0365562,.01504268,-.00780353,.00325614,-68245e-8].reverse();return yi((function(r){return r<=2?-pi.log(r/2)*Ai(r,0)+vi(e,r*r/4):pi.exp(-r)/pi.sqrt(r)*vi(t,2/r)}),(function(e){return e<=2?pi.log(e/2)*Ai(e,1)+1/e*vi(r,e*e/4):pi.exp(-e)/pi.sqrt(e)*vi(n,2/e)}),0,2,1)}();mi.besselj=_i,mi.bessely=bi,mi.besseli=Ai,mi.besselk=Ei;var ji=mi,Ri=Me._Complex,Si=B.a._isNullOrUndefined,Ci=L.a._getLength,Ti=function(e,t){return!!I(e,t)&&(E(t.value)<1e21&&(t.value=parseInt(t.value,10),!0))},wi=T;v.a;function Oi(e,t,r,n){function o(e,t,r,n,o,a){var s,i=e,u=[];n=n<0?0:n,o=(r=r<0?0:r)+o>t.rowCount?t.rowCount-r:o,a=n+a>t.colCount?t.colCount-n:a;for(var l=0;l<o;l++){s=[],u.push(s);for(var c=0;c<a;c++)s.push(i[l+r][c+n])}return[u]}function a(e){return!Si(e)&&!e._error}v.m(t)&&(t=t.toArray()[0]),v.m(r)&&(r=r.toArray()[0]);var s=De.a._element,i=De.a._instance,u=i.helper.getCalcRef,l=!0;if(v.m(e)){var c,d,f={value:-1},h=e,p=h.getRowCount(0),g=h.getColumnCount(0),y=h.getRow(0),_=h.getColumn(0),b=h.getSheetId(0);if(2===Ci(arguments)){if(1!==h.getRangeCount()||1!==p&&1!==g)return m.l.ref;var A=a(t)&&Ti(t,f)?f.value:0;if(0!==A||l||(A=p>0?s.row:s.col),A<0)return m.l.value;if(p*g<A)return m.l.ref;if(0===A){var E=1===p&&1===g;return u([{sheetId:b,row:y,col:_,refType:E?i.NODE_TYPE.CELL_RANGE_TYPE.CELL:i.NODE_TYPE.CELL_RANGE_TYPE.NORMAL,rowCount:p,colCount:g}],E)}return u([{sheetId:b,row:c=Math.floor((A-1)/g)+y,col:d=(A-1)%g+_,refType:i.NODE_TYPE.CELL_RANGE_TYPE.CELL,rowCount:1,colCount:1}],!0)}if(t=a(t)&&Ti(t,f)?f.value-1:-1,r=a(r)&&Ti(r,f)?f.value-1:-1,(n=a(n)&&Ti(n,f)?f.value-1:0)>=h.getRangeCount())return m.l.ref;p=h.getRowCount(n),g=h.getColumnCount(n);var j=h.getRow(n),R=h.getColumn(n);if(-1===t&&!l&&p>1&&null!==s&&(t=s.row),-1===r&&!l&&g>1&&null!==s&&(r=s.col),c=t+j,d=r+R,t<-1||r<-1||n<0)return m.l.value;if(p<=t||g<=r||h.getRangeCount()<=n)return m.l.ref;if(-1===t&&-1===r){var S=1===p&&1===g;return u([{sheetId:b,row:j,col:R,refType:S?i.NODE_TYPE.CELL_RANGE_TYPE.CELL:i.NODE_TYPE.CELL_RANGE_TYPE.NORMAL,rowCount:p,colCount:g}],S)}if(-1===t){var C=1===p;return u([{sheetId:b,row:j,col:d,refType:C?i.NODE_TYPE.CELL_RANGE_TYPE.CELL:i.NODE_TYPE.CELL_RANGE_TYPE.NORMAL,rowCount:p,colCount:1}],C)}if(-1===r){var T=1===g;return u([{sheetId:b,row:c,col:R,refType:T?i.NODE_TYPE.CELL_RANGE_TYPE.CELL:i.NODE_TYPE.CELL_RANGE_TYPE.NORMAL,rowCount:1,colCount:g}],T)}return u([{sheetId:b,row:c,col:d,refType:i.NODE_TYPE.CELL_RANGE_TYPE.CELL,rowCount:1,colCount:1}],!0)}if(Array.isArray(e)){var w=x(e),O=w.rowCount;if(t=void 0!==t?wi(t):-1,r=void 0!==r?wi(r):-1,1!==(n=void 0!==n?wi(n)-1:1))return m.l.ref;-1===t&&-1===r?t=r=0:-1===r&&1===O&&(r=t,t=1),t=-1===t?0:t,r=-1===r?0:r,O=w.rowCount;var I=w.colCount;return t<0||r<0||n<0?m.l.value:(t>O&&1===O&&void 0===r&&(r=t,t=0),O<t||I<r?m.l.ref:0===t&&0===r?o(e[0],w,0,0,O,I):0===t?o(e[0],w,0,r-1,O,1):0===r?o(e[0],w,t-1,0,1,I):e[0][t-1][r-1])}if(t>=0&&t<=1&&r>=0&&r<=1)return e;throw new Error(m.l.ref)}function Ii(e,t){var r,n=e;v.m(e)&&(n=x(e)[0],r=e.getSheetId(0)),v.m(t)&&(t=x(t)[0]);var o=De.a._element,a=De.a._instance;if(r=r||o.sheetId,""===n||"string"!==typeof n)throw new Error(m.l.ref);if(!n)throw new Error(m.l.na);void 0===t&&(t=!0);var s=n,i=s=(s=s.toUpperCase()).replace(/\$/g,"");if(!v.o(s)&&!v.q(s)&&!v.s(s)&&!v.w(s))throw new Error(m.l.ref);function u(){var e=s.lastIndexOf("!");if(-1!==e){var t=s.slice(0,e);r=a.helper.getSheetIdBySheetName(t),s=s.slice(e+1)}}if(t){var l=De.a._funcNode,c=(l.calculateParentFunctionNode&&l.calculateParentFunctionNode.funcName,{row:o.row,col:o.col,sheetId:o.sheetId}),d=!1;if(v.o(s)){u();var f=v.e(s),h=f.row,p=f.col,g={endRow:h,startRow:h,endCol:p,startCol:p,startSheetId:r,endSheetId:r};d=!a.custom.addDependency(c,g,ht.c.CELL)}else if(v.q(s)){u();var _=s.split(":"),b=Object(y.a)(_,2),A=b[0],E=b[1],j=v.e(A),R=j.row,S=j.col,C=v.e(E),T={endRow:C.row,startRow:R,endCol:C.col,startCol:S,startSheetId:r,endSheetId:r};d=!a.custom.addDependency(c,T,ht.c.CELL_RANGE)}else if(v.s(s)){u();var w=s.split(":"),O=Object(y.a)(w,2),I=O[0],N=O[1],k=v.f(I),M=v.f(N),D={endRow:m.d,startRow:0,endCol:M,startCol:k,startSheetId:r,endSheetId:r};d=!a.custom.addDependency(c,D,ht.c.CELL_RANGE)}else if(v.w(s)){u();var F=s.split(":"),P=Object(y.a)(F,2),L=P[0],U=P[1],B=Number(L),H={endRow:Number(U),startRow:B,endCol:m.d,startCol:0,startSheetId:r,endSheetId:r};d=!a.custom.addDependency(c,H,ht.c.CELL_RANGE)}if(d){var G={id:o.id,sheetId:o.sheetId,row:o.row,col:o.col,rowCount:o.rowCount,colCount:o.colCount},V=a.custom.parse(i,G);return a.calculate(V,G)}return""}if("string"===typeof s){var W=s.match(/^R([\d])+C([\d])+/);if(W){var Y=W[1],z=W[2],K=a.custom.cellValue(Y,z,o.sheetId);return K||0}throw new Error(m.l.na)}throw new Error(m.l.na)}function Ni(e,t,r,n,o){""===t?t=0:v.m(t)&&(t=x(t)[0]),""===r?r=0:v.m(r)&&(r=x(r)[0]),""===n?n=1:v.m(n)&&(n=x(n)[0]),""===o?o=1:v.m(o)&&(o=x(o)[0]);var a=De.a._instance,s=a.helper.getCalcRef,i=e.getSheetId(0);if(!e||!v.m(e)||1!==e.getRangeCount())return m.l.value;n=void 0!==n?wi(n):e.getRowCount(0),o=void 0!==o?wi(o):e.getColumnCount(0);var u=e.getRow(0)+t,l=e.getColumn(0)+r;if(n<=0||o<=0||u<0||l<0)return m.l.ref;var c=1===n&&1===o,d=De.a._element;return a.custom.addDependency({row:d.row,col:d.col,sheetId:d.sheetId},{endRow:u+n-1,startRow:u,endCol:l+o-1,startCol:l,startSheetId:i,endSheetId:i},ht.c.CELL_RANGE),s([{sheetId:i,row:u,col:l,refType:c?a.NODE_TYPE.CELL_RANGE_TYPE.CELL:a.NODE_TYPE.CELL_RANGE_TYPE.NORMAL,rowCount:n,colCount:o}],c)}function ki(e,t){var r=Number.POSITIVE_INFINITY,n=e._getReal(),o=e._getImag();return isNaN(n)||n===r||isNaN(o)||o===r?m.l.num:e._toString(t)}function Mi(e,t){return Me._isBoolean(e)||Me._isBoolean(t)?m.l.value:(e=v.B(e,De.a._astNodes[0],!0),t=v.B(t,De.a._astNodes[1],!0),e=Me.convertArgToComplex(e),t=Me.convertArgToComplex(t),v.b(e,t)||e._suffix!==t._suffix?m.l.num:ki(new Ri(e._real-t._real,e._imag-t._imag,e._suffix)))}function Di(e){return Me._isBoolean(e)?m.l.value:(e=v.B(e,De.a._astNodes[0],!0),v.n(De.a._astNodes[0])||""!==e?(e=Me.convertArgToComplex(e),v.b(e)?m.l.num:ki(new Ri(e._real,-e._imag,e._suffix))):m.l.num)}function xi(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"i";return Me._isBoolean(e)||Me._isBoolean(t)||v.l(e,De.a._astNodes[0])||v.l(t,De.a._astNodes[1])?m.l.value:(e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),e=w(e),t=w(t),isNaN(e)||isNaN(t)?m.l.value:(""===(r=k(r))&&(r="i"),"i"!==r&&"j"!==r?m.l.value:ki(new Ri(e,t),r)))}function Fi(e,t,r){return e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),e=w(e),t=T(t),isNaN(e)||isNaN(t)?m.l.value:t<0?m.l.num:M(r?ji.besseli(e,t):ji.besselj(e,t))}function Pi(e,t,r){return e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),e=w(e),t=T(t),isNaN(e)||isNaN(t)?m.l.value:e<=0||t<0?m.l.num:M(r?ji.besselk(e,t):ji.bessely(e,t))}function Li(e,t){return Fi(e,t,!0)}function Ui(e,t){return Fi(e,t,!1)}function Bi(e,t){return Pi(e,t,!0)}function Hi(e,t){return Pi(e,t,!1)}function Gi(e,t){var r=Math.pow(t,10),n=Number({2:"0b",8:"0o",16:"0x",10:""}[t]+e);return isNaN(n)?m.l.num:r/2<=n?n-r:n}function Vi(e,t,r){e<0&&(e+=Math.pow(t,10));var n,o=e.toString(t),a=r-Ci(o);for(n=0;n<a;n++)o="0"+o;return o.toUpperCase()}function Wi(e,t){if(Me._isBoolean(e)||v.l(e,De.a._astNodes[0]))return m.l.value;if(S(e=k(e)))return e;if("0"===e||""===e)return 0;if(e.length>10)return m.l.num;var r=Gi(e,t);return Ci(r)<Ci(e)?m.l.num:r}function Yi(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;if(Me._isBoolean(e)||Me._isBoolean(t)||v.l(e,De.a._astNodes[0])||v.l(t,De.a._astNodes[1]))return m.l.value;if(!v.p(De.a._astNodes[0])&&""===e)return m.l.na;if(""===(e=v.B(e,De.a._astNodes[0]))&&(e=0),e=w(e),isNaN(e))return m.l.value;e=parseInt(e,10);var n=!0;if(t=v.B(t,De.a._astNodes[1],!0),v.p(De.a._astNodes[1])||""!==t||(t=1,n=!1),t=T(t),isNaN(t))return m.l.value;if(t<1||t>10)return m.l.num;var o=Vi(e,r,t);return 0<=o&&t<Ci(o)&&n?m.l.num:o}function zi(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;if(Me._isBoolean(e)||Me._isBoolean(t)||v.l(e,De.a._astNodes[0])||v.l(t,De.a._astNodes[1]))return m.l.value;if(S(e=k(e)))return e;if("0"===e||""===e)return 0;if(e.length>10)return m.l.num;var a=!0;if(t=v.B(t,De.a._astNodes[1],!0),v.p(De.a._astNodes[1])||""!==t||(t=1,a=!1),t=T(t),isNaN(t))return m.l.value;if(t<1||t>10)return m.l.num;var s=Gi(e,r);if(Ci(s)<Ci(e))return m.l.num;if(o&&(s<-o||o-1<s))return m.l.num;var i=Vi(s,n,t);return 0<=s&&t<Ci(i)&&a?m.l.num:i}function Ki(e){return Wi(e,2)}function qi(e,t){return zi(e,t,2,8)}function Qi(e,t){return zi(e,t,2,16)}function Xi(e){return Wi(e,8)}function Ji(e,t){return zi(e,t,8,2,512)}function $i(e,t){return zi(e,t,8,16,549755813888)}function Zi(e){return Wi(e,16)}function eu(e,t){return zi(e,t,16,2,512)}function tu(e,t){return zi(e,t,16,8,536870912)}function ru(e,t){return Yi(e,t,2)}function nu(e,t){return Yi(e,t,16)}function ou(e,t){return Yi(e,t,8)}function au(e,t,r){e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),e=D(e),t=D(t),r=k(r),e.setHours(0,0,0,0),t.setHours(0,0,0,0),r=r.toLocaleUpperCase();var n=function(){var e=[];return e[0]=function(e,t){return t.getFullYear()-e.getFullYear()+(t.getMonth()<e.getMonth()||t.getMonth()===e.getMonth()&&t.getDate()<e.getDate()?-1:0)},e[1]=function(e,t){return 12*(t.getFullYear()-e.getFullYear())+(t.getMonth()-e.getMonth())+(t.getDate()<e.getDate()?-1:0)},e[2]=function(e,t){return(t.getTime()-e.getTime())/864e5},e[3]=function(e,t){var r=new Date(t.getFullYear(),t.getMonth()+(t.getDate()<e.getDate()?-1:0),e.getDate());return(t.getTime()-r.getTime())/864e5},e[4]=function(e,t){return t.getMonth()-e.getMonth()+(t.getMonth()<e.getMonth()||t.getMonth()===e.getMonth()&&t.getDate()<e.getDate()?12:0)+(t.getDate()<e.getDate()?-1:0)},e[5]=function(e,t){var r=t.getFullYear()+(t.getMonth()<e.getMonth()||t.getMonth()===e.getMonth()&&t.getDate()<e.getDate()?-1:0),n=e.getMonth(),o=e.getDate(),a=ua(e.getFullYear());return 1!==n||29!==o||ua(r)||o--,!a&&1===n&&28===o&&ua(r)&&o++,(t-new Date(r,n,o))/864e5},e}(),o=B.a._inArray(r,["Y","M","D","MD","YM","YD"]),a=!1;if(t<e){var s=e;e=t,t=s,a=!0}if(o<0)return m.l.num;var i=(0,n[o])(e,t);return a?-1*i:i}var su={ORIGIN:function(e,t){if(Me._isBoolean(e)||Me._isBoolean(t)||v.l(e,De.a._astNodes[0])||v.l(t,De.a._astNodes[1]))return m.l.value;var r=!0;if(e=v.B(e,De.a._astNodes[0]),""===(t=v.B(t,De.a._astNodes[1]))&&(t=0),"undefined"===typeof t&&(t=0,r=!1),e=w(e),t=w(t),isNaN(e)||isNaN(t))return m.l.value;var n=Me._st_normsdist(e*Math.sqrt(2)),o=2*parseFloat(n)-1;r&&(n=Me._st_normsdist(t*Math.sqrt(2)),o=2*parseFloat(n)-1-o);return o},PRECISE:function(e){return su.ORIGIN(e)}},iu={};function uu(e,t){for(var r=0,n=Ci(t);r<n;r++)for(var o=t[r],a=0;o[a];a++)if(0===e.localeCompare(o[a]))return!1;return!0}function lu(e,t,r,n){var o,a=0,s=1;for(o=0;e[o]._str;o++)if(0===r.localeCompare(e[o]._str))return{_hasUnit:!0,_prefix:s,_constant:a=e[o]._c};if(t)for(o=0;t[o]._str;o++){r.substr(0,1)===t[o]._str.substr(0,1)&&uu(r,n)&&(s=t[o]._c)}for(o=0;e[o]._str;o++){var i=Ci(e[o]._str);if(r.substr(1,Ci(r))===e[o]._str.substr(0,i)&&uu(r,n))return{_hasUnit:!0,_prefix:s,_constant:a=e[o]._c}}return{_hasUnit:!1,_prefix:s,_constant:a}}function cu(e,t){return{_str:e,_c:t}}function du(e,t){var r,n=[];for(r=0;r<Ci(e);r++)n.push(new cu(e[r],t[r]));return n.push(new cu(null,0)),n}iu.PRECISE=function(e){return 1-su.ORIGIN(e)};var fu=du(["g","sg","lbm","u","ozm","grain","cwt","shweight","uk_cwt","lcwt","hweight","stone","ton","uk_ton","LTON","brton"],[1,6852205001e-14,.002204622915,602217e18,.035273972,1e8/6479891,173/7847148,173/7847148,55/2794129,55/2794129,55/2794129,1129/7169481,4/3628739,1/1016047,1/1016047]),hu=du(["m","mi","Nmi","in","ft","yd","ang","ell","ly","parsec","pc","Picapt","Pica","pica","survey_mi","km"],[1,1e4/254/12/3/1760,1/1852,1e4/254,1e4/254/12,1e4/254/12/3,1e10,1e3/1143,1057e-19,324078e-22,324078e-22,2834.645669,2834.645669,3e4/127,3937/6336e3,.001]),mu=du(["yr","day","d","hr","mn","min","s","sec"],[1,365.25,365.25,8766,525960,525960,31557600,31557600]),pu=du(["Pa","atm","mmHg","p","at","psi","Torr"],[1,9869233e-12,.00750061708,1,.00750061708,857/5908807,152/20265]),vu=du(["N","dyn","lbf","dy","pond"],[1,1e5,.224808924,1e5,2e7/196133]),gu=du(["HP","W","h","w","PS"],[1,745.6998715822702,1,745.6998715822702,5567865/5491697]),yu=du(["J","e","c","cal","eV","HPh","Wh","flb","BTU","ev","hh","wh","btu"],[1,9999995.193,.239006249,.238846191,62146e14,1/2684519.537696173,1/3600,23.73042222,947815e-9,62146e14,1/2684519.537696173,1/3600,947815e-9]),_u=du(["T","gs","ga"],[1,1e4,1e4]),bu=du(["tsp","tspm","tbs","oz","cup","pt","qt","gal","l","uk_pt","us_pt","lt","L","uk_gal","ang3","ang^3","barrel","bushel","ft3","ft^3","in3","in^3","ly3","ly^3","m3","m^3","mi3","mi^3","yd3","yd^3","Nmi3","Nmi^3","Picapt3","Picapt^3","Pica3","Pica^3","GRT","regton","MTON"],[1,6636025/6731721,1/3,1/6,1/48,1/96,1/192,1/768,.0049289216,.008675585,1/96,.0049289216,.0049289216,8530/7867471,492892e19,492892e19,1/32256,977/6985011,77/442368,77/442368,77/256,77/256,582074e-59,582074e-59,22/4463451,22/4463451,118251e-20,118251e-20,19/2947205,19/2947205,775941e-21,775941e-21,112266,112266,112266,112266,10/5745039,10/5745039,34/7813253]),Au=du(["bit","byte"],[1,1/8]),Eu=du(["kn","m/s","m/sec","m/h","m/hr","admkn","mph"],[1,463/900,463/900,1852,1852,57875/57912,57875/50292]),ju=du(["uk_acre","us_acre","ang2","ang^2","ar","ft2","ft^2","ha","in2","in^2","ly2","ly^2","m2","m^2","Morgen","mi2","mi^2","Nmi2","Nmi^2","Picapt2","Pica2","Pica^2","Picapt^2","yd2","yd^2"],[1,.999996000004,404686e18,404686e18,40.468564224,43560,43560,3870320/9563769,6272640,6272640,452135e-34,452135e-34,4046.8564224,4046.8564224,15481280/9563769,1/640,10558/8948409,10558/8948409,32517365760,32517365760,32517365760,32517365760,4840,4840]),Ru=du(["Y","Z","E","P","T","G","M","k","h","e","d","c","m","u","n","p","f","a","z","y"],[1e24,1e21,1e18,1e15,1e12,1e9,1e6,1e3,100,10,.1,.01,.001,1e-6,1e-9,1e-12,1e-15,1e-18,1e-21,1e-24]);function Su(e,t,r){if(Me._isBoolean(e)||v.l(e,De.a._astNodes[0]))return m.l.value;if(e=v.B(e,De.a._astNodes[0]),e=Number(e),isNaN(e))return m.l.value;function n(e,t){return e===t}t=k(t),r=k(r);if(!t||!r)return m.l.na;var o=n(t,"C")||n(t,"cel"),a=n(r,"C")||n(r,"cel"),s=n(t,"F")||n(t,"fah"),i=n(r,"F")||n(r,"fah"),u=n(t,"K")||n(t,"kel"),l=n(r,"K")||n(r,"kel"),c=n(t,"Rank"),d=n(r,"Rank"),f=n(t,"Reau"),h=n(r,"Reau");if(o&&a||s&&i||u&&l||c&&d||f&&h)return e;if(o&&i)return 9*e/5+32;if(s&&a)return 5*(e-32)/9;if(s&&l)return 5*(e-32)/9+273.15;if(u&&i)return 9*(e-273.15)/5+32;if(o&&l)return e+273.15;if(u&&a)return e-273.15;if(o&&d)return 9*e/5+32+459.67;if(s&&d)return e+459.67;if(u&&d)return 9*e/5;if(f&&d)return 9*e/4+32+459.67;if(c&&a)return(e-32-459.67)/1.8;if(c&&i)return e-459.67;if(c&&l)return e/1.8;if(c&&h)return(e-459.67-32)/(9/4);if(o&&h)return 4*e/5;if(s&&h)return(e-32)/(9/4);if(u&&h)return.8*(e-273.15);if(f&&a)return 5*e/4;if(f&&i)return 9*e/4+32;if(f&&l)return 5*e/4+273.15;for(var p=[fu,hu,mu,pu,vu,yu,gu,_u,bu,Au,Eu,ju],g=0;g<Ci(p);g++){var y=p[g],_=lu(y,Ru,t,p),b=_._hasUnit,A=_._constant,E=_._prefix,j=(_=lu(y,Ru,r,p))._hasUnit,R=_._prefix,S=_._constant;if(b&&j&&0!==A&&0!==R)return e*E/A*S/R}return m.l.na}function Cu(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Me._isBoolean(e)||Me._isBoolean(t)||v.l(e,De.a._astNodes[0])||v.l(t,De.a._astNodes[1])?m.l.value:(e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),e=w(e),t=w(t),isNaN(e)||isNaN(t)?m.l.value:re(e,t)?1:0)}function Tu(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Me._isBoolean(e)||Me._isBoolean(t)||v.l(e,De.a._astNodes[0])||v.l(t,De.a._astNodes[1])?m.l.value:(e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),e=w(e),t=w(t),isNaN(e)||isNaN(t)?m.l.value:e>=t?1:0)}r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.symbol.description.js"),r("../node_modules/core-js/modules/es.symbol.iterator.js"),r("../node_modules/core-js/modules/es.number.parse-float.js");var wu=B.a._isNullOrUndefined,Ou=B.a._inArray,Iu=B.a._isArray,Nu=L.a._getLength,ku=ie._pow1p,Mu=Me._MAX_DOUBLE_VALUE,Du=Me._daysBetweenBasis,xu=Me._getDaysInMonth,Fu=Me._compareDateTime,Pu=Me._days360,Lu=b.default._toOADate,Uu=isFinite;function Bu(e,t,r,n){if(e>-1&&0!==e){var o=r,a=Math.pow(1+e,o._nper-(n?1:0)),s=(Math.pow(1+e,o._nper)-1)/e;return[!0,t=n?-o._pmt*s/e+a*o._nper*(o._pv+o._pmt*(o._type+1/e)):o._pv*a+o._pmt*(1+e*o._type)*s+o._fv,r]}return[!1,t,r]}function Hu(e,t,r){return t>0?(r._havexpos?r._havexneg?Math.abs(e-r._xneg)<Math.abs(r._xpos-r._xneg)&&(r._xpos=e,r._ypos=t):t<r._ypos&&(r._xpos=e,r._ypos=t):(r._xpos=e,r._ypos=t,r._havexpos=!0),[!1,r]):t<0?(r._havexneg?r._havexpos?Math.abs(e-r._xpos)<Math.abs(r._xpos-r._xneg)&&(r._xneg=e,r._yneg=t):-t<-r._yneg&&(r._xneg=e,r._yneg=t):(r._xneg=e,r._yneg=t,r._havexneg=!0),[!1,r]):(r._root=e,[!0,r])}function Gu(e,t,r,n,o,a,s,i,u,l,c,d,f,h,m){var p,v,g,y,_=0,b=0,A=r-o,E=r+o,j=2===e;if(A<a._xmin&&(A=r),E>a._xmax&&(E=r),A===E)return j?[!1,n,a,s]:[!1,n,a];if(0===e?(p=t(s,i,u,A,c,d,f,h,m)-l,v=t(s,i,u,E,c,d,f,h,m)-l):1===e?(p=t(A,s,_,i),v=t(E,s,b,i)):(p=Bu(A,_,s),v=Bu(E,b,s)),Iu(p)){if(y=p[2],_=p[1],!(g=p[0]))return j?[g,n,a,y]:[g,n,a]}else _=p;if(Iu(v)){if(y=v[2],b=v[1],!(g=v[0]))return j?[g,n,a,y]:[g,n,a]}else b=v;return n=(b-_)/(E-A),j?[!0,n,a,y]:[!0,n,a]}function Vu(e,t,r){var n=0;if(t<e._xmin||t>e._xmax)return[!1,e,r];var o=Bu(t,n,r);if(r=o[2],n=o[1],!o[0])return[o[0],e,r];var a=Hu(t,n,e);return e=a[1],[!!a[0],e,r]}function Wu(e,t,r,n,o,a,s,i,u,l){var c,d=0,f=e?15:2;if(!r._havexpos||!r._havexneg)return e?[!1,r,n]:[!1,r];var h=Math.abs(r._xpos-r._xneg)/(Math.abs(r._xpos)+Math.abs(r._xneg));for(c=0;c<100+4*f;c++){var m,p;if(m=c%4===0?1:c%4===2?2:3,r=(p=e?zu(r,n,h,d,0,m):t?Ku(!0,r,d,0,0,m,Yu,h,o,n,Gu):Ku(!1,r,d,0,0,m,ul,h,a,s,i,n,o,u,l))[1],n=p[2],d=e?p[3]:p[2],p[0])return e?[!0,r,n]:[!0,r]}return e?[!1,r,n]:[!1,r]}function Yu(e,t,r,n){for(var o=0,a=Nu(t),s=0;s<a;s++){var i=il(n[s])-il(n[0]);if(i<0)return[!1,r];o+=t[s]/ku(e,i/365)}return Uu(o)?r=isNaN(o)?5e-324:o:o===Number.POSITIVE_INFINITY?r=Mu:o===Number.NEGATIVE_INFINITY&&(r=-Mu),[!0,r]}function zu(e,t,r,n,o,a){var s;if(1===a){var i=Bu(s=(e._xpos+e._xneg)/2,o,t);if(t=i[2],o=i[1],!i[0])return[null,e,t,n];if(0===o)return[!0,e=Hu(s,o,e)[1],t,n];if(0===Math.sqrt(o*o-e._ypos*e._yneg))return[null,e,t,n]}else if(2===a){var u,l=0,c=0;if(r>.1)return zu(e,t,r,n,o,a=3);var d=n++%4;if(0===d)u=e._xpos,l=e._ypos;else if(2===d)u=e._xneg,l=e._yneg;else if(t=(i=Bu(u=(e._xpos+e._xneg)/2,l,t))[2],l=i[1],!i[0])return[null,e,t,n];var f=Gu(2,void 0,u,c,Math.abs(e._xpos-e._xneg)/1e6,e,t);if(t=f[3],e=f[2],c=f[1],!f[0]||0===c)return[null,e,t,n];if((s=u-1.01*l/c)<e._xpos&&s<e._xneg||s>e._xpos&&s>e._xneg)return[null,e,t,n]}return[!1,e,t,n]}function Ku(e,t,r,n,o,a,s,i,u,l,c,d,f,h,m,p,v){var g;switch(a){case 0:n=t._xpos-t._ypos*((t._xneg-t._xpos)/(t._yneg-t._ypos));break;case 1:if(n=(t._xpos+t._xneg)/2,g=e?s(n,l,o,u):s(d,f,u,n,c,h,m,p,v)-l,Iu(g)){if(o=g[1],!g[0])return[null,t,r,n,o,a]}else o=g;if(0===o)return[!0,t=Hu(n,o,t)[1],r,n,o,a];var y=Math.sqrt(o*o-t._ypos*t._yneg);if(0===y)return[null,t,r,n,o,a];n+=(n-t._xpos)*o/y;break;case 3:n=(t._xpos+t._xneg)/2;break;case 2:var _,b,A=0,E=0;if(i>.1)return Ku(e,t,r,n,o,a=3,s,i,u,l,c,d,f,h,m);var j=r++%4;if(0===j)_=t._xpos,A=t._ypos;else if(2===j)_=t._xneg,A=t._yneg;else if(_=(t._xpos+t._xneg)/2,g=e?s(_,l,A,u):s(d,f,u,_,c,h,m,p,v)-l,Iu(g)){if(A=g[1],!g[0])return[null,t,r,n,o,a]}else A=g;b=Math.abs(t._xpos-t._xneg)/1e6;var R=e?c(1,s,_,E,b,t,l,u):Gu(0,s,_,E,b,t,d,f,u,l,c,h,m,p,v);if(t=R[2],E=R[1],!R[0]||0===E)return[null,t,r,n,o,a];if((n=_-1.01*A/E)<t._xpos&&n<t._xneg||n>t._xpos&&n>t._xneg)return[null,t,r,n,o,a]}return[!1,t,r,n,o,a]}function qu(e,t,r,n,o,a,s,i,u,l,c,d,f){if(n<r._xmin||n>r._xmax)return[!1,r];var h=Hu(n,e?Qu(n,o):t(o,a,s,n,u,l,c,d,f)-i,r);return r=h[1],[!!h[0],r]}function Qu(e,t,r){var n,o=Nu(t),a=0;for(n=0;n<o;n++)a+=(r?-n:1)*t[n]*Math.pow(1+e,-n-1-(r?1:0));return a}function Xu(e,t,r,n,o,a,s,i,u){var l=Du(i,e,s),c=Du(e,u,s),d=Du(i,u,s),f=el(e,t,a,s),h=parseInt(rl(e,t,a).toString()),m=100*r/a,p=1+n/a;if(c>f)switch(s){case 0:case 4:var v=Du(u,t,s);h=1+parseInt(Math.ceil(v/f).toString());break;default:var g=new Date(nl(u),ol(u),al(u));for(h=0;h<32767;h++){var y=new Date(nl(g),ol(g),al(g));if(g.setMonth(ol(g)+12/a),Fu(g,t)>=0){h+=parseInt((Math.ceil(Du(y,t,s))/el(y,g,a,s)).toString())+1;break}}l=f*Ju(i,e,u,a,s),c=f*Ju(e,u,u,a,s),d=f*Ju(i,u,u,a,s)}return o/Math.pow(p,h-1+c/f)+m*(d/f/Math.pow(p,c/f)+Math.pow(p,-c/f)*(Math.pow(p,-h)-1/p)/(1/p-1)-l/f)}function Ju(e,t,r,n,o){var a=tl(e,r,n,!0),s=tl(e,r,n,!1);if(Fu(a,t)>=0)return Du(e,t,o)/el(s,a,n,o);for(var i=Du(e,a,o)/el(s,a,n,o);;){if(s=new Date(nl(a),ol(a),al(a)),a.setMonth(ol(a)+12/n),Fu(a,t)>=0)return i+=Du(s,t,o)/el(s,a,n,o);i+=1}}function $u(e,t,r,n){return Du(tl(e,t,r,!1),e,n)}function Zu(e,t,r,n){return Du(e,tl(e,t,r,!0),n)}function el(e,t,r,n){return Ou(n,[0,2,4,5])>=0?360/r:3===n?365/r:Du(tl(e,t,r,!1),tl(e,t,r,!0),1)}function tl(e,t,r,n){var o=nl(t),a=ol(t),s=al(t),i=new Date(1,0,1),u=(xu(o,a),12/r),l=o-nl(e);i.setFullYear(1),l>0&&(l=(l-1)*r);do{l++,(i=new Date(o,a,s)).setMonth(a-l*u),al(i)!==s&&i.setDate(0)}while(Fu(e,i)<0);n&&(l--,(i=new Date(o,a,s)).setMonth(a-l*u),al(i)!==s&&i.setDate(0));return i}function rl(e,t,r){var n=nl(t),o=ol(t),a=al(t),s=new Date(n,o,a),i=o-ol(e)+12*(n-nl(e));if(s.setMonth(ol(s)-i),a===xu(n,o))for(;al(s)!==xu(nl(s),ol(s));)s.setDate(al(s)+1);return al(e)>=al(s)&&i--,parseInt((1+i/(12/r)).toString())}function nl(e){return e.getFullYear()}function ol(e){return e.getMonth()}function al(e){return e.getDate()}function sl(e,t,r){var n=nl(t)-nl(e),o=ol(t)-ol(e)+12*n,a=al(t)-al(e),s=-1;return 0===r?s=Pu(e,t):Ou(r,[1,2,3])>=0?s=il(t)-il(e):4===r&&(s=30*o+a),s}function il(e){return e instanceof Date?Lu(e):e}function ul(e,t,r,n,o,a,s){for(var i=$u(e,t,a,s),u=Zu(e,t,a,s),l=el(e,t,a,s),c=parseInt(rl(e,t,a).toString(),10),d=0,f=100*r/a,h=1+n/a,m=u/l,p=0;p<c;p++)d+=f/Math.pow(h,m+p);return o/Math.pow(h,c-1+u/l)+d-i/l*f}function ll(e,t){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"===typeof e)return cl(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return cl(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){i=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(i)throw a}}}}function cl(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var dl=B.a._inArray,fl=Me._MAX_DOUBLE_VALUE,hl=Me._compareDateTime,ml=Me._annualYearBasis,pl=Me._yearfrac;function vl(e,t){if("boolean"===typeof e)return m.l.value;if(!Array.isArray(t)&&"boolean"===typeof t)return m.l.value;if(e=v.B(e,De.a._astNodes[0]),isNaN(e))return m.l.value;t=v.i(t);var r,n=ll(t=v.x(De.a._astNodes[1])?t.map((function(e){if(Object(m.v)(e))return e;var t=Number.parseFloat(e);return isNaN(t)?m.l.value:t})):t.map((function(e){if(Object(m.v)(e))return e;if(null===e)return 0;var t=Number.parseFloat(e);return isNaN(t)?m.l.value:t})));try{for(n.s();!(r=n.n()).done;){var o=r.value;if(Object(m.v)(o))return o}}catch(u){n.e(u)}finally{n.f()}for(var a=t.length,s=e,i=0;i<a;i++)s*=1+t[i];return s}function gl(e,t,r,n,o){if(n=n||0,o=void 0===o?0:o,e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),r=v.B(r,De.a._astNodes[2]),n=v.B(n,De.a._astNodes[3]),o=v.B(o,De.a._astNodes[4]),isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n)||isNaN(o))return m.l.value;o=0===o?0:1;var a=Math.pow(1+e,t);return M(-(a=0===e?(r+n)/t:(r*a+n)/((1+e*o)*(a-1)/e)))}function yl(e,t,r,n,o){var a=gl(e,t,r,n,o);return Object(m.v)(a)||wl(De.a,[2,3]),a}function _l(e,t,r,n,o,a){if(n=void 0===n?0:n,o=void 0===o?0:o,a=void 0===a?.1:a,e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),r=v.B(r,De.a._astNodes[2]),n=v.B(n,De.a._astNodes[3]),o=v.B(o,De.a._astNodes[4]),a=v.B(a,De.a._astNodes[5]),isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n)||isNaN(o)||isNaN(a))return m.l.value;o=0===o?0:1;var s={_precision:1e-10,_havexpos:!1,_xpos:0,_ypos:0,_havexneg:!1,_xneg:0,_yneg:0,_root:0},i=Math.pow(17976931348623157e282,1/e);s._xmin=Math.max(-1e10,1-i),s._xmax=Math.min(1e10,i-1);var u={_nper:e,_pmt:t,_pv:r,_fv:n,_type:o},l=function(e,t,r){var n,o=e._precision/2;for(n=0;n<100;n++){var a,s,i,u=0,l=0;if(r<e._xmin||r>e._xmax)return[!1,e,t];var c=Bu(r,u,t);if(t=c[2],u=c[1],!(i=c[0]))return[i,e,t];var d=Hu(r,u,e);if(e=d[1],d[0])return[!0,e,t];if(t=(c=Bu(r,l,t,!0))[2],l=c[1],!(i=c[0]))return[i,e,t];if(0===l)return[!1,e,t];if((a=r-1.000001*u/l)===r)return e._root=r,[!0,e,t];if(s=Math.abs(a-r)/(Math.abs(r)+Math.abs(a)),r=a,s<o)return e._root=r,[!0,e,t]}return[!1,e,t]}(s,u,a);u=l[2],s=l[1];var c,d=l[0];if(!d){for(c=2;(!s._havexneg||!s._havexpos)&&c<100;c*=2)u=(l=Vu(s,a*c,u))[2],u=(l=Vu(s=l[1],a/c,u))[2],s=l[1];s=(l=Wu(!0,!1,s,u))[1],d=l[0]}return d?s._root:m.l.num}function bl(e,t,r,n,o,a){var s=_l(e,t,r,n,o,a);return Object(m.v)(s)||De.a._funcNode.setFormatType("0.00%"),s}function Al(e,t,r,n,o,a){var s=function(e,t,r,n,o,a){return o=void 0===o?0:o,a=void 0===a?0:a,e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),r=v.B(r,De.a._astNodes[2]),n=v.B(n,De.a._astNodes[3]),o=v.B(o,De.a._astNodes[4]),a=v.B(a,De.a._astNodes[5]),isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n)||isNaN(o)||isNaN(a)?m.l.value:(a=0===a?0:1,t>=r+1?m.l.num:1===t&&1===a?0:Tl(n,Cl(e,r,n,o,a),e,t-1,a))}(e,t,r,n,o,a);return Object(m.v)(s)||wl(De.a,[3,4]),s}function El(e,t,r,n,o,a){var s=function(e,t,r,n,o,a){if(o=void 0===o?0:o,a=void 0===a?0:a,e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),r=v.B(r,De.a._astNodes[2]),n=v.B(n,De.a._astNodes[3]),o=v.B(o,De.a._astNodes[4]),a=v.B(a,De.a._astNodes[5]),isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n)||isNaN(o)||isNaN(a))return m.l.value;if(a=0===a?0:1,t>=r+1)return m.l.num;var s=Cl(e,r,n,o,a);return s-Tl(n,s,e,t-1,a)}(e,t,r,n,o,a);return Object(m.v)(s)||wl(De.a,[3,4]),s}function jl(e,t,r,n,o){if(n=void 0===n?0:n,o=void 0===o?0:o,e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),r=v.B(r,De.a._astNodes[2]),n=v.B(n,De.a._astNodes[3]),o=v.B(o,De.a._astNodes[4]),isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n)||isNaN(o))return m.l.value;o=0===o?0:1;var a=Math.pow(1+e,t);return M(-(a=0===e?r*t+n:n*a+r*(1+e*o)*(a-1)/e))}function Rl(e,t,r,n,o){var a=jl(e,t,r,n,o);return Object(m.v)(a)||wl(De.a,[2,3]),a}function Sl(e,t,r,n,o){var a=function(e,t,r,n,o){if(n=void 0===n?0:n,o=void 0===o?0:o,e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),r=v.B(r,De.a._astNodes[2]),n=v.B(n,De.a._astNodes[3]),o=v.B(o,De.a._astNodes[4]),isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n)||isNaN(o))return m.l.value;if(o=0===o?0:1,0===e)return M(-(r*t+n));var a=Math.pow(1+e,t);return-1===e?m.l.div0:M(-(n+r*(1+e*o)*(a-1)/e)/a)}(e,t,r,n,o);return Object(m.v)(a)||wl(De.a,[2,3]),a}function Cl(e,t,r,n,o){var a=Math.pow(1+e,t),s=isFinite(a)?a:m.l.num;return 0===e?t:(a=(a-1)/e,a=(-r*s-n)/((1+e*o)*(isFinite(a)?a:m.l.num)),isFinite(a)?a:m.l.num)}function Tl(e,t,r,n,o){if(1===o){var a=-(e*(s=Math.pow(1+r,n-1))*r+t*(1+r)*(s-1))-t*r;return isFinite(a)?a:m.l.num}var s;a=-(e*(s=Math.pow(1+r,n))*r+t*(s-1));return isFinite(a)?a:m.l.num}function wl(e,t){var r=e._funcNode,n=t.map((function(t){return e._astNodes[t]})).filter(v.p),o=!1;n.forEach((function(t){if(!o){var n=t.cellId,a=t.sheetId,s=e._instance,i=v.e(n),u=s.custom.cellFormat(i.row,i.col,a);u&&"currency"===u.type&&(r.setFormatType(u.pattern),o=!0)}})),o||r.setFormatType('"\xa5"#,##0.00_);[Red]\\("\xa5"#,##0.00\\)')}function Ol(e,t){if(!Array.isArray(e))return m.l.num;if(e=v.i(e),t=void 0===t?.1:t,t=v.B(t,De.a._astNodes[1]),isNaN(t))return m.l.value;Math.abs(t)>1&&(t=.1);var r=e,n=L.a._getLength(r),o=[],a=!1,s=!1,i={_xmin:-1,_xmax:1e10,_precision:1e-10,_havexpos:!1,_xpos:0,_ypos:0,_havexneg:!1,_xneg:0,_yneg:0,_root:0};if(n<2)return m.l.num;i._xmax=Math.min(i._xmax,Math.pow(fl/1e10,1/n)-1);for(var u=0;u<n;u++){var l=r[u];if(Object(m.v)(l))return m.l.value;o[u]=l,l>0&&(a=!0),l<0&&(s=!0)}if(!a||!s)return m.l.num;var c=function(e,t,r){var n,o=e._precision/2;for(n=0;n<20;n++){var a,s,i,u;if(r<e._xmin||r>e._xmax)return[!1,e];var l=Hu(r,i=Qu(r,t),e);if(e=l[1],l[0])return[!0,e];if(0===(u=Qu(r,t,!0)))return[!1,e];if((a=r-1.000001*i/u)===r)return e._root=r,[!0,e];if(s=Math.abs(a-r)/(Math.abs(r)+Math.abs(a)),r=a,s<o)return e._root=r,[!0,e]}return[!1,e]}(i,o,t);i=c[1];var d,f=c[0];if(!f){for(d=2;(!i._havexneg||!i._havexpos)&&d<100;d*=2)i=qu(!0,void 0,i,t*d,o)[1],i=qu(!0,void 0,i,t/d,o)[1];c=function(e,t,r,n,o,a,s,i,u,l,c){var d,f,h=0,m=e?15:2;if(!t._havexpos||!t._havexneg)return[!1,t];for(f=Math.abs(t._xpos-t._xneg)/(Math.abs(t._xpos)+Math.abs(t._xneg)),d=0;d<100+4*m;d++){var p,v=0,g=0;p=d%4===0?1:d%4===2?2:3;var y=e?Ku(!0,t,h,v,g,p,Qu,f,void 0,r,Gu):Ku(!1,t,h,v,g,p,Xu,f,s,i,u,r,n,l,c,o,a);if(t=y[1],h=y[2],v=y[3],!(e&&null===y[0]||!e&&wu(y[0]))){if(y[0])return[!0,t];var _=Hu(v,g=e?Qu(v,r):Xu(r,n,s,v,u,l,c,o,a)-i,t);if(t=_[1],_[0])return[!0,t];if((f=Math.abs(t._xpos-t._xneg)/(Math.abs(t._xpos)+Math.abs(t._xneg)))<t._precision)return t._yneg<g&&(g=t._yneg,v=t._xneg),t._ypos<g&&(v=t._xpos),t._root=v,[!0,t]}}return[!1,t]}(!0,i,o),i=c[1],f=c[0]}return f?i._root:m.l.num}function Il(e,t){var r=Ol(e,t);return Object(m.v)(r)||De.a._funcNode.setFormatType("0.00%"),r}function Nl(e,t,r,n,o,a,s){if(t=v.B(t,De.a._astNodes[1]),r=v.B(r,De.a._astNodes[2]),n=v.B(n,De.a._astNodes[3]),o=v.B(o,De.a._astNodes[4]),a=v.B(a,De.a._astNodes[5]),s=v.B(s,De.a._astNodes[6]),isNaN(t)||isNaN(r)||isNaN(o)||isNaN(a)||isNaN(s))return m.l.value;if(t<=0||r<=0||n<=0)return m.l.num;if(o<1||a<1)return m.l.num;if(a<o||a>r||0!==s&&1!==s)return m.l.num;var i,u,l=gl(t,r,n,0,s),c=0;for(1===o&&(e&&(c=l),s<=0&&(c+=e?n*t:-n),o++),i=o;i<=a;i++)u=s>0?jl(t,i-2,l,n,1)-l:jl(t,i-1,l,n,0),c+=e?l-u*t:u;return e?c:c*t}function kl(e,t,r,n,o,a){var s=function(e,t,r,n,o,a){return Nl(!1,e,t,r,n,o,a)}(e,t,r,n,o,a);return Object(m.v)(s)||wl(De.a,[2]),s}function Ml(e,t,r,n,o,a){var s=function(e,t,r,n,o,a){return Nl(!0,e,t,r,n,o,a)}(e,t,r,n,o,a);return Object(m.v)(s)||wl(De.a,[2]),s}function Dl(e,t){var r=function(e,t){return"boolean"===typeof e||"boolean"===typeof t?m.l.value:(e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),isNaN(e)||isNaN(t)?m.l.value:e<=0||t<1?m.l.num:(t=T(t),Math.pow(1+e/t,t)-1))}(e,t);return Object(m.v)(r)||De.a._funcNode.setFormatType("0.00%"),r}function xl(e,t){var r=function(e,t){return"boolean"===typeof e||"boolean"===typeof t?m.l.value:(e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),isNaN(e)||isNaN(t)?m.l.value:e<=0||t<1?m.l.num:t*(Math.pow(1+e,1/t)-1))}(e,t);return Object(m.v)(r)||De.a._funcNode.setFormatType("0.00%"),r}function Fl(e,t,r,n){var o=function(e,t,r,n){return e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),r=v.B(r,De.a._astNodes[2]),n=v.B(n,De.a._astNodes[3]),isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n)?m.l.value:t<0||r<=0||n<=0||n>r?m.l.num:(e-t)*(r-n+1)*2/(r*(r+1))}(e,t,r,n);return Object(m.v)(o)||wl(De.a,[1,2]),o}function Pl(e,t,r){var n=function(e,t,r){return e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),r=v.B(r,De.a._astNodes[2]),isNaN(e)||isNaN(t)||isNaN(r)?m.l.value:0===r?m.l.div0:(e-t)/r}(e,t,r);return Object(m.v)(n)||wl(De.a,[1,2]),n}function Ll(e,t,r,n,o,a,s){var i=function(e,t,r,n,o,a,s){return s=void 0===s?0:s,e=D(e),t=D(t),e instanceof Date&&e.setHours(0,0,0),t instanceof Date&&t.setHours(0,0,0),r=v.B(r,De.a._astNodes[2]),n=v.B(n,De.a._astNodes[3]),o=v.B(o,De.a._astNodes[4]),a=v.B(a,De.a._astNodes[5]),s=v.B(s,De.a._astNodes[6]),isNaN(r)||isNaN(n)||isNaN(o)||isNaN(a)||isNaN(s)?m.l.value:(a=a>=0?Math.floor(a):Math.ceil(a),s=s>=0?Math.floor(s):math.ceil(s),r<0||n<0||o<=0||dl(a,[1,2,4])<0||dl(s,[0,1,2,3,4])<0||hl(e,t)>=0?m.l.num:ul(e,t,r,n,o,a,s))}(e,t,r,n,o,a,s);return Object(m.v)(i)||wl(De.a,[4]),i}function Ul(e,t,r,n,o){var a=function(e,t,r,n,o){if(o=void 0===o?0:o,e=D(e),t=D(t),e instanceof Date&&e.setHours(0,0,0),t instanceof Date&&t.setHours(0,0,0),r=v.B(r,De.a._astNodes[2]),n=v.B(n,De.a._astNodes[3]),o=v.B(o,De.a._astNodes[4]),isNaN(r)||isNaN(n)||isNaN(o))return m.l.value;if(o=o>=0?Math.floor(o):math.ceil(o),r<=0)return m.l.num;if(n<=0)return m.l.num;if(dl(o,[0,1,2,3,4])<0)return m.l.num;if(hl(e,t)>=0)return m.l.num;var a=sl(e,t,o),s=ml(e,o);return a<=0||s<=0?m.l.num:n-r*n*a/s}(e,t,r,n,o);return Object(m.v)(a)||wl(De.a,[3]),a}function Bl(e,t,r,n,o,a){var s=function(e,t,r,n,o,a){if(a=void 0===a?0:a,e=D(e),t=D(t),r=D(r),e instanceof Date&&e.setHours(0,0,0),t instanceof Date&&t.setHours(0,0,0),r instanceof Date&&r.setHours(0,0,0),n=v.B(n,De.a._astNodes[3]),o=v.B(o,De.a._astNodes[4]),a=v.B(a,De.a._astNodes[5]),isNaN(n)||isNaN(o)||isNaN(a))return m.l.value;if(a=a>=0?Math.floor(a):math.ceil(a),n<0)return m.l.num;if(o<0)return m.l.num;if(dl(a,[0,1,2,3,4])<0)return m.l.num;if(hl(e,t)>=0)return m.l.num;if(hl(r,e)>=0)return m.l.num;if(hl(r,t)>=0)return m.l.num;var s=sl(e,t,a),i=sl(r,t,a),u=sl(r,e,a),l=ml(r,a);if(u<=0||l<=0||s<=0||i<=0)return m.l.num;var c=1+s/l*o;return 0===c?m.l.num:(100+i/l*n*100)/c-u/l*n*100}(e,t,r,n,o,a);return Object(m.v)(s)||De.a._funcNode.setFormatType('"\xa5"#,##0.00_);[Red]\\("\xa5"#,##0.00\\)'),s}function Hl(e,t,r,n,o,a,s){if(s=void 0===s?0:s,e=D(e),t=D(t),e instanceof Date&&e.setHours(0,0,0),t instanceof Date&&t.setHours(0,0,0),r=v.B(r,De.a._astNodes[2]),n=v.B(n,De.a._astNodes[3]),o=v.B(o,De.a._astNodes[4]),a=v.B(a,De.a._astNodes[5]),s=v.B(s,De.a._astNodes[6]),isNaN(r)||isNaN(n)||isNaN(o)||isNaN(a)||isNaN(s))return m.l.value;if(a=a>=0?Math.floor(a):Math.ceil(a),s=s>=0?Math.floor(s):math.ceil(s),r<0)return m.l.num;if(n<=0)return m.l.num;if(o<=0)return m.l.num;if(dl(a,[1,2,4])<0)return m.l.num;if(dl(s,[0,1,2,3,4])<0)return m.l.num;if(hl(e,t)>=0)return m.l.num;if(rl(e,t,a)<=1){var i=$u(e,t,a,s),u=Zu(e,t,a,s),l=el(e,t,a,s);return(o/100+r/a-(n/100+i/l*r/a))/(n/100+i/l*r/a)*(a*l/u)}var c,d=.1,f={_xmin:0,_xmax:1e3,_precision:1e-10,_havexpos:!1,_xpos:0,_ypos:0,_havexneg:!1,_xneg:0,_yneg:0,_root:0},h=function(e,t,r,n,o,a,s,i,u,l,c,d,f){var h,m,p,v=r._precision/2;for(h=0;h<20;h++){if(n<r._xmin||n>r._xmax)return[!1,r];var g=e?Yu(n,o,0,a):t(o,a,s,n,u,l,c,d,f)-i;if(Iu(g)){if(p=g[1],!(m=g[0]))return[m,r]}else p=g;var y=Hu(n,p,r);if(r=y[1],y[0])return[!0,r];var _=r._havexneg&&r._havexpos?Math.abs(r._xpos-r._xneg):r._xmax-r._xmin,b=(Math.abs(n)<1e-10?_:Math.abs(n))/1e6,A=0;if(r=(y=e?Gu(1,Yu,n,A,b,r,o,a):Gu(0,t,n,A,b,r,o,a,s,i,u,l,c,d,f))[2],A=y[1]<0?y[1]:-y[1],!(m=y[0]))return[m,r];if(0===A)return[!1,r];var E=n-1.000001*p/A;if(E===n)return r._root=n,[!0,r];var j=Math.abs(E-n)/(Math.abs(n)+Math.abs(E));if(n=E,j<v)return r._root=n,[!0,r]}return[!1,r]}(!1,ul,f,d,e,t,r,n,o,a,s);if(f=h[1],!(c=h[0])){for(d=1e-10;d<f._xmax;d*=2)f=qu(!1,ul,f,d,e,t,r,n,o,a,s)[1];f=(h=Wu(!1,!1,f,e,t,r,n,o,a,s))[1],c=h[0]}return c?f._root:m.l.num}function Gl(e,t,r,n,o,a,s){var i=Hl(e,t,r,n,o,a,s);return Object(m.v)(i)||De.a._funcNode.setFormatType("0.00%"),i}function Vl(e,t,r,n,o,a){var s=function(e,t,r,n,o,a){if(a=void 0===a?0:a,e=D(e),t=D(t),r=D(r),e instanceof Date&&e.setHours(0,0,0),t instanceof Date&&t.setHours(0,0,0),r instanceof Date&&r.setHours(0,0,0),n=v.B(n,De.a._astNodes[3]),o=v.B(o,De.a._astNodes[4]),a=v.B(a,De.a._astNodes[5]),isNaN(n)||isNaN(o)||isNaN(a))return m.l.value;if(a=a>=0?Math.floor(a):math.ceil(a),n<0)return m.l.num;if(o<=0)return m.l.num;if(dl(a,[0,1,2,3,4])<0)return m.l.num;if(hl(e,t)>=0)return m.l.num;if(hl(r,e)>=0)return m.l.num;if(hl(r,t)>=0)return m.l.num;var s=1+pl(r,t,a)*n;return s/=o/100+pl(r,e,a)*n,s--,s/=pl(e,t,a)}(e,t,r,n,o,a);return Object(m.v)(s)||De.a._funcNode.setFormatType("0.00%"),s}function Wl(e,t,r,n,o){var a=function(e,t,r,n,o){return o=void 0===o?0:o,e=D(e),t=D(t),e instanceof Date&&e.setHours(0,0,0),t instanceof Date&&t.setHours(0,0,0),r=v.B(r,De.a._astNodes[2]),n=v.B(n,De.a._astNodes[3]),o=v.B(o,De.a._astNodes[4]),isNaN(r)||isNaN(n)||isNaN(o)?m.l.value:(o=o>=0?Math.floor(o):math.ceil(o),r<=0||n<=0||dl(o,[0,1,2,3,4])<0||hl(e,t)>=0?m.l.num:(n/r-1)/pl(e,t,o))}(e,t,r,n,o);return Object(m.v)(a)||De.a._funcNode.setFormatType("0.00%"),a}function Yl(e,t,r,n,o){var a=function(e,t,r,n,o){if(o=void 0===o?12:o,e=v.B(e,De.a._astNodes[0]),t=v.B(t,De.a._astNodes[1]),r=v.B(r,De.a._astNodes[2]),n=v.B(n,De.a._astNodes[3]),o=v.B(o,De.a._astNodes[4]),isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n)||isNaN(o))return m.l.value;if(e<0||t<0)return m.l.num;if(r<=0||n<=0)return m.l.num;if(dl(o,[1,2,3,4,5,6,7,8,9,10,11,12])<0)return m.l.num;if(r+(o<12?1:0)<n)return m.l.num;if(0===e)return 0;for(var a=ie._round(1-Math.pow(t/e,1/r),3),s=0,i=0,u=1;u<=n;u++)s+=i=1===u?e*a*o/12:u===r+1?(e-s)*a*(12-o)/12:(e-s)*a;return i}(e,t,r,n,o);return Object(m.v)(a)||wl(De.a,[1,2]),a}var zl=B.a._isNullOrUndefined,Kl=L.a._getLength;function ql(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t=v.i(t);for(var n=!0,o=0;o<t.length;o++)t[o]||(n=!1),""!==t[o]&&"string"!==typeof t[o]||(n=m.l.value);return n}function Ql(){return!1}function Xl(e,t,r){return v.m(e)&&(e=e.toArray()[0]),v.b(e)?e:e?t:"undefined"!==typeof r&&r}function Jl(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t=v.i(t);for(var n=!1,o=0;o<t.length;o++)if(null===t[o]&&(n=m.l.value),t[o]){n=!0;break}return n}function $l(){return!0}function Zl(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t[0];if(v.m(n)&&(n=x(n)[0]),Ue(n))return n;var o=T(n);return o<1||Kl(t)<=o?m.l.value:zl(t[o])?0:t[o]}function ec(e){if(v.v(e,De.a._astNodes[0]))return m.l.value;if("string"===typeof e)switch(e.toLowerCase()){case"true":e=!0;break;case"false":case"":e=!1;break;default:return m.l.value}var t={};return N(e,t),!t.value}function tc(){for(var e=[],t=0,r=arguments.length;t<r;t++){var n=t<0||arguments.length<=t?void 0:arguments[t];if(Array.isArray(n))n=(n=v.i(n)).filter((function(e){return"number"===typeof e||"boolean"===typeof e})),e=e.concat(n);else{if("number"!==typeof n&&"boolean"!==typeof n)return m.l.value;e.push(n)}}var o,a=0;for(o=0;o<Kl(e);o++)e[o]&&a++;return!!(a%2)}var rc,nc=r("./src/core/feature/formula/func-config.ts"),oc=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js");function ac(e,t){var r=t._element.row,n=t._element.col;return e=De.a._instance.custom.getValueByTopCellPosition(e,r,n)}var sc=(rc={},Object(oc.a)(rc,nc.b.BOOL,(function(e,t){return Object(v.m)(e)&&!e.isCell&&(e=ac(e,t)),e})),Object(oc.a)(rc,nc.b.STRING,(function(e,t){return Object(v.m)(e)&&!e.isCell&&(e=ac(e,t)),e})),Object(oc.a)(rc,nc.b.NUMBER,(function(e,t){return Object(v.m)(e)&&!e.isCell&&(e=ac(e,t)),e})),Object(oc.a)(rc,nc.b.DATE,(function(e,t){return Object(v.m)(e)&&!e.isCell&&(e=ac(e,t)),e})),Object(oc.a)(rc,nc.b.ARRAY,(function(e){return e})),Object(oc.a)(rc,nc.b.NOT_ARRAY,(function(e,t){return Object(v.m)(e)&&!e.isCell&&(e=ac(e,t)),e})),Object(oc.a)(rc,nc.b.ANY,(function(e){return e})),rc),ic=r("./src/core/feature/formula/ast_node/index.ts"),uc=r("./src/core/feature/formula/ast_node/NODE_TYPE.ts");function lc(e,t,r){if(!nc.k[e])for(var n=t._funcNode.calculateParentFunctionNode,o=0;o<r.length;o++){var a=r[o];if(!Object(v.m)(a))if(n&&nc.g[n.funcName]){if(Object(m.v)(n.expandValue))throw new Error(node.expandValue)}else if(Object(m.v)(a))throw new Error(a)}}function cc(e,t,r,n,o,a){if(!(a!==nc.b.ARRAY&&a!==nc.b.ANY||nc.a[e]))return!1;var s=!1,i=r[n],u=Object(v.x)(t)||!Object(v.r)(t)&&Array.isArray(i);if(s=u,!u&&Object(v.m)(i)&&!i.isCell){var l=De.a._instance,c=l.helper.getRangeValue;o=o&&o.calculateParentFunctionNode;for(var d=1e3;o&&d-- >0;){var f=o&&o.funcName;if(nc.g[f]){for(var h=[],m=nc.a[e],p=0;p<i.identities.length;p++){var g=i.getIdentities(p);if(m){for(var y=l.helper.cellValueCalcFunc,_=0;_<g.rowCount;_++){h[_]=h[_]||[];for(var b=0;b<g.colCount;b++){var A={row:_+g.row,col:b+g.col,rowCount:1,colCount:1,sheetId:g.sheetId,refType:uc.b.NORMAL};h[_].push(new ic.b([A],!0,y))}}h=[h]}else{var E=c({newLine:g.colCount},g);h.push(E)}}r[n]=h,s=!0;break}o=o&&o.calculateParentFunctionNode}}return s}function dc(e,t){if(Object(v.m)(e)&&(!t||!t.acceptRef)){var r=De.a._instance.helper.getRangeValue,n=e.getIdentities(0),o=r({newLine:n.colCount},n);e=e.isCell?o[0]:[o]}return e}function fc(e,t,r){var n=De.a._instance.helper.getRangeValue,o=De.a,a=nc.f[t],s=[],i=function(e,t,r,n){var o=r,a=0,s=0,i=!1;if(t){!function(e,t){var r=Object(v.C)(t,{min:e.min,max:e.max});if(r)throw new Error(r)}(t,r);var u=t.argumentsType;if(Array.isArray(u)){o=[];for(var l=0;l<r.length;l++){var c=u[l]||nc.b.ANY,d=n._astNodes[l];if(cc(e,d,r,l,n._funcNode,c)){var f=r[l][0];if(s=s>f[0].length?s:f[0].length,a=a>f.length?a:f.length,nc.i[e]){o.push(r[l][0][0][0]);continue}i=!0,f.isUserRange=!0,o.push(f)}else{var h=r[l],m=sc[c];"function"===typeof m&&(h=m(h,n)),nc.j[e]||(h=Object(v.d)(h)),null!==(h=dc(h,t))||nc.e[e]||(h=""),o.push(h)}}}}return{newArgs:o,canExpand:i,rowCount:a,colCount:s}}(t,a,r,o),u=i.newArgs,l=i.canExpand,c=i.rowCount,d=i.colCount;if(l){var f;!function(e,t,r){for(var n=0;n<e.length;n++){var o=m.l.na,a=e[n],s=1===a.length,i=a[0]&&1===a[0].length&&a.length>1;a.isUserRange||(o=a,e[n]=[[a]],a=e[n]);for(var u=0;u<t;u++){void 0===a[u]&&(a[u]=[]);for(var l=0;l<r;l++)if(void 0===a[u][l]){var c=void 0;void 0===(c=s?a[0][l]:i?a[u][0]:a[u][l])&&(c=o),e[n][u][l]=c}}}}(u,c,d);for(var h=!1,p=0;p<u[0].length;p++)for(var g=0;g<u[0][p].length;g++){for(var y=[],_=0;_<u.length;_++)y.push(u[_][p][g]);void 0===s[p]&&(s[p]=[]),lc(t,o,y);var b=void 0;try{b=e.apply(void 0,y)}catch(w){b=w&&w.message||m.l.error}!f&&Object(m.v)(b)&&(f=b),h||!Array.isArray(b)&&!Object(v.m)(b)||(h=!0),s[p][g]=b}if(h){for(var A=[],E=0;E<s.length;E++)for(var j=0;j<s[E].length;j++){var R=s[E][j];if(Array.isArray(R))A.push(R[0]);else if(Object(v.m)(R)){var S=R.getIdentities(0);A.push([n({newLine:S.colCount},S)])}else A.push([[R]])}s=A}else s=[s];s.errorValue=f}else{for(var C=0;C<u.length;C++){var T=u[C];nc.j[t]||(T=Object(v.d)(T)),T=dc(T,a),nc.e[t]||null!==T||(T=""),u[C]=T}lc(t,o,u),s=e.apply(void 0,u)}return s}var hc={};[i,u,c,d,n,f,o,a,s,l].forEach((function(e){Object.keys(e).forEach((function(t){if("object"===Object(h.a)(e[t])){var r=e[t];Object.keys(r).forEach((function(e){var n=t+"."+e;hc[n]||(hc[n]=fc.bind(void 0,r[e],n))}))}else hc[t]||(hc[t]=fc.bind(void 0,e[t],t))}))}));var mc={RANK:hc["RANK.EQ"],NETWORKDAYS:hc["NETWORKDAYS.ORIGIN"],CONFIDENCE:hc["CONFIDENCE.NORM"],POISSON:hc["POISSON.DIST"],QUARTILE:hc["QUARTILE.INC"],STDEV:hc["STDEV.S"],VAR:hc["VAR.S"],WORKDAY:hc["WORKDAY.ORIGIN"],SKEW:hc["SKEW.ORIGIN"],CEILING:hc["CEILING.ORIGIN"],FLOOR:hc["FLOOR.ORIGIN"],MODE:hc["MODE.SNGL"],PERCENTRANK:hc["PERCENTRANK.INC"],ERF:hc["ERF.ORIGIN"],ERFC:hc["ERFC.PRECISE"]};Object.assign(hc,mc);t.default=hc},"./src/core/feature/formula/lib/spreadjs/common/arrayHelper.js":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.array.splice.js");var n=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),o=function(){function e(){}return e._insert=function(e,t,r){e.splice(t,0,r)},e._add=function(e,t){e.push(t)},e._contains=function(e,t){return e.indexOf(t)>-1},e._remove=function(e,t){var r=e.indexOf(t);r>-1&&e.splice(r,1)},e._removeByIndex=function(e,t){return e.slice(0,t).concat(e.slice(t+1))},e._indexOf=function(e,t,r){return e.indexOf(t,r)},e._clear=function(e,t,r){if(!(t<0))for(var n=0;n<r&&t+n<e.length;n++)e[t+n]=null},e._nextNonEmptyIndex=function(e,t){t<0&&(t=-1);for(var r=t+1;r<e.length;r++)if(void 0!==e[r]&&null!==e[r])return r;return-1},e._getLength=function(e){return e&&e.length},e._clone=function(e){var t=[];return function e(t,r){for(var o in r)if(r.hasOwnProperty(o)){var a=r[o];Array.isArray(a)?(t[o]=[],e(t[o],r[o])):"object"===Object(n.a)(a)?(t[o]={},e(t[o],r[o])):t[o]=r[o]}}(t,e),t},e}();t.a=o},"./src/core/feature/formula/lib/spreadjs/common/culture.js":function(e,t,r){"use strict";r.d(t,"a",(function(){return b}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/es.function.name.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.string.split.js");var n=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),o=r("./src/core/feature/formula/lib/spreadjs/common/resource.js"),a=r("./src/core/feature/formula/lib/spreadjs/common/types.js"),s=a.a._inherit,i=a.a._each,u=(window,["MM/dd/yyyy","MM/d/yyyy","M/dd/yyyy","M/d/yyyy","yy/MM/dd","yy/MM/d","yy/M/dd","yy/M/d","yyyy/MM/dd","yyyy/MM/d","yyyy/M/dd","yyyy/M/d"]),l=["hh:mm:ss","hh:mm:s","hh:m:ss","hh:m:s","h:mm:ss","h:mm:s","h:m:ss","h:m:s","hh:mm:ss tt","hh:mm:s tt","hh:m:ss tt","hh:m:s tt","h:mm:ss tt","h:mm:s tt","h:m:ss tt","h:m:s tt","hh:mm","hh:m","h:mm","h:m","hh:mm tt","hh:m tt","h:mm tt","h:m tt"],c=["MM-dd-yyyy","MM-d-yyyy","M-dd-yyyy","M-d-yyyy","yy-MM-dd","yy-MM-d","yy-M-dd","yy-M-d","yyyy-MM-dd","yyyy-MM-d","yyyy-M-dd","yyyy-M-d","dd-MMMM-yy","dd-MMM-yy"],d=u.concat(l);i(u,(function(e,t){i(l,(function(e,r){e<l.length-4&&d.push(t+" "+r)}))})),d=d.concat(c),i(c,(function(e,t){i(l,(function(e,r){e<l.length-4&&d.push(t+" "+r)}))}));var f=function(){function e(){this.NumberFormat={currencyDecimalDigits:2,currencyDecimalSeparator:".",currencyGroupSeparator:",",currencyGroupSizes:[3],currencyNegativePattern:0,currencyPositivePattern:0,currencySymbol:"\xa4",digitSubstitution:1,isReadOnly:!0,numberGroupSizes:[3],nanSymbol:"NaN",nativeDigits:["0","1","2","3","4","5","6","7","8","9"],numberNegativePattern:1,negativeInfinitySymbol:"-Infinity",negativeSign:"-",numberDecimalDigits:2,numberDecimalSeparator:".",numberGroupSeparator:",",positiveInfinitySymbol:"Infinity",positiveSign:"+",percentDecimalDigits:2,percentDecimalSeparator:".",percentGroupSeparator:",",percentGroupSizes:[3],percentNegativePattern:0,percentPositivePattern:0,percentSymbol:"%",perMilleSymbol:"\u2030",listSeparator:",",arrayListSeparator:",",arrayGroupSeparator:";",dbNumber:{}},this.DateTimeFormat={abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],abbreviatedMonthGenitiveNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec",""],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec",""],amDesignator:"AM",calendarIsReadOnly:!0,calendarWeekRule:0,Calendar:{MinSupportedDateTime:"@-62135568000000@",MaxSupportedDateTime:"@253402300799999@",AlgorithmType:1,CalendarType:1,Eras:[1],TwoDigitYearMax:2029,isReadOnly:!0},dateSeparator:"/",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],firstDayOfWeek:0,fullDateTimePattern:"dddd, dd MMMM yyyy HH:mm:ss",longDatePattern:"dddd, dd MMMM yyyy",longTimePattern:"HH:mm:ss",monthDayPattern:"MMMM dd",monthGenitiveNames:["January","February","March","April","May","June","July","August","September","October","November","December",""],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December",""],nativeCalendarName:"Gregorian Calendar",pmDesignator:"PM",rfc1123Pattern:"ddd, dd MMM yyyy HH':'mm':'ss 'GMT'",shortDatePattern:"MM/dd/yyyy",shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],shortTimePattern:"HH:mm",sortableDateTimePattern:"yyyy'-'MM'-'dd'T'HH':'mm':'ss",timeSeparator:":",universalSortableDateTimePattern:"yyyy'-'MM'-'dd HH':'mm':'ss'Z'",yearMonthPattern:"yyyy MMMM",filterDialogDateFormatter:"yyyy/mmmm/dd"},this.name=function(){return""},this.id=-1}function t(e){return e.split("\xa0").join(" ").toUpperCase()}function r(e){for(var r=[],n=0,o=e.length;n<o;n++)r[n]=t(e[n]);return r}function n(e,r,n){var o=t(e),a=r.indexOf(o);return-1===a&&(a=n.indexOf(o)),a}return e.prototype={constructor:e,_getDateTimePattern:function(){if(!this._dateTimeFormatPattern){var e=this.DateTimeFormat.shortDatePattern.replace(/m/g,"M"),t=[e,e+" h:mm",e+" h:mm:ss",e+" h:mm:ss.0","MMMdd","MMMd","MMM dd","MMM d"];this._dateTimeFormatPattern=t.concat(d)}return this._dateTimeFormatPattern},_getMonthIndex:function(e){return this._upperMonths||(this._upperMonths=r(this.DateTimeFormat.monthNames),this._upperMonthsGenitive=r(this.DateTimeFormat.monthGenitiveNames)),n(e,this._upperMonths,this._upperMonthsGenitive)},_getAbbrMonthIndex:function(e){return this._upperAbbrMonths||(this._upperAbbrMonths=r(this.DateTimeFormat.abbreviatedMonthNames),this._upperAbbrMonthsGenitive=r(this.DateTimeFormat.abbreviatedMonthGenitiveNames)),n(e,this._upperAbbrMonths,this._upperAbbrMonthsGenitive)},_getDayIndex:function(e){return this._upperDays||(this._upperDays=r(this.DateTimeFormat.dayNames)),this._upperDays.indexOf(t(e))},_getAbbrDayIndex:function(e){return this._upperAbbrDays||(this._upperAbbrDays=r(this.DateTimeFormat.abbreviatedDayNames)),this._upperAbbrDays.indexOf(t(e))}},e}(),h=function(){function e(){}return e._isValidEraDate=function(e){return e>=this._getEraMin()&&e<=this._getEraMax()},e._getEraDates=function(){var e=f.eras;if(void 0!==e){for(var t=[],r=0;r<e.length;r++)t[r]=new Date(e[r].startDate.replace(/-/g,"/"));return t}return this._EraDates},e._getEraPropByFormat=function(e){var t,r;switch(e){case"g":t="symbol",r=this._symbols;break;case"gg":t="abbreviation",r=this._abbreviations;break;case"ggg":t="name",r=this._names;break;default:return[]}var n=f.eras,o=[];if(void 0!==n){for(var a=0;a<n.length;a++)o[a]=n[a][t];return o}return r},e._getEraMax=function(){var e=f.eras;if(void 0!==e&&e.length>0){var t=new Date(e[e.length-1].startDate.replace(/-/g,"/"));return t.setFullYear(t.getFullYear()+99),t}return this._EraMax},e._getEraMin=function(){var e=f.eras;return void 0!==e&&e.length>0?new Date(e[0].startDate.replace(/-/g,"/")):this._EraMin},e._getEraCount=function(){var e=f.eras;return void 0!==e?e.length:this._EraCount},e._getEraYears=function(){var e=f.eras;if(void 0!==e){for(var t=[],r=1;r<e.length;r++){var n=new Date(e[r-1].startDate.replace(/-/g,"/")),o=new Date(e[r].startDate.replace(/-/g,"/"));t[r-1]=o.getFullYear()-n.getFullYear()+1}return t[r-1]=99,t}return this._EraYears},e._getEraDate=function(e){var t={_era:-1,_eraYear:-1};if(!this._isValidEraDate(e))return t;for(var r=0;r<this._getEraCount();r++){if(e<(r+1!==this._getEraCount()?this._getEraDates()[r+1]:this._addMilliseconds(this._getEraMax(),1))){t._era=r,t._eraYear=e.getFullYear()-this._getEraDates()[r].getFullYear()+1;break}}return t},e._addMilliseconds=function(e,t){var r=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds());return r.setMilliseconds(r.getMilliseconds()+t),new Date(r.valueOf())},e._getYearFromEra=function(t,r){return e._getEraDates()[t].getFullYear()+r-1},e._parseEraPart=function(t,r){r=r.toUpperCase();for(var n=e._getEraPropByFormat(t),o=0;o<n.length;o++)if(n[o]===r)return o;return-1},e._formatEraPart=function(t,r){var n=e,o=n._getEraDate(r),a=o._era;if(a>=0){var s=n._getEraPropByFormat(t);if(s.length>0)return s[a]}var i=o._eraYear;if(i>=0){var u=i.toString();if("ee"===t)return 1===u.length&&(u="0"+u),u;if("e"===t)return u}return""},e._EraDates=[new Date(1868,8,8),new Date(1912,6,30),new Date(1926,11,25),new Date(1989,0,8)],e._EraCount=4,e._EraYears=[45,15,64,99],e._EraMax=new Date(2087,11,31,23,59,59),e._EraMin=new Date(1868,8,8),e._shortcuts=["1,m","2,t","3,s","4,h"],e._EraIndices=[0,1,2,3,0,1,2,3],e._names=["\u660e\u6cbb","\u5927\u6b63","\u662d\u548c","\u5e73\u6210"],e._symbols=["M","T","S","H"],e._abbreviations=["\u660e","\u5927","\u662d","\u5e73"],e._EraYearMax=99,e}(),m=function(e){function t(){e.apply(this,arguments),_.call(this,"NumberFormat",["currencySymbol","isReadOnly"],["$",!1]),_.call(this,"DateTimeFormat",["fullDateTimePattern","longDatePattern","longTimePattern","shortDatePattern","shortTimePattern","yearMonthPattern","calendarIsReadOnly"],["dddd, MMMM dd, yyyy h:mm:ss tt","dddd, MMMM dd, yyyy","h:mm:ss tt","M/d/yyyy","h:mm tt","MMMM, yyyy",!1]),this.name=function(){return"en-US"},this.id=1033}return s(t,e),t}(f),p=function(e){function t(){e.apply(this,arguments);var t={1:{letters:["\u5146","\u5343","\u767e","\u5341","\u4ebf","\u5343","\u767e","\u5341","\u4e07","\u5343","\u767e","\u5341",""],numbers:["\u3007","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d","\u4e03","\u516b","\u4e5d"]},2:{letters:["\u5146","\u9621","\u767e","\u62fe","\u5104","\u9621","\u767e","\u62fe","\u842c","\u9621","\u767e","\u62fe",""],numbers:["\u3007","\u58f1","\u5f10","\u53c2","\u56db","\u4f0d","\u516d","\u4e03","\u516b","\u4e5d"]},3:{letters:null,numbers:["\uff10","\uff11","\uff12","\uff13","\uff14","\uff15","\uff16","\uff17","\uff18","\uff19"]}};_.call(this,"NumberFormat",["currencyDecimalDigits","currencyNegativePattern","currencySymbol","isReadOnly","nanSymbol","negativeInfinitySymbol","percentNegativePattern","percentPositivePattern","positiveInfinitySymbol","dbNumber"],[0,1,"\xa5",!1,"NaN (\u975e\u6570\u5024)","-\u221e",1,1,"+\u221e",t]);var r=["1","2","3","4","5","6","7","8","9","10","11","12",""],n=["1\u6708","2\u6708","3\u6708","4\u6708","5\u6708","6\u6708","7\u6708","8\u6708","9\u6708","10\u6708","11\u6708","12\u6708",""];_.call(this,"DateTimeFormat",["abbreviatedDayNames","abbreviatedMonthGenitiveNames","abbreviatedMonthNames","amDesignator","calendarIsReadOnly","dayNames","fullDateTimePattern","longDatePattern","longTimePattern","monthDayPattern","monthGenitiveNames","monthNames","nativeCalendarName","pmDesignator","shortDatePattern","shortestDayNames","shortTimePattern","yearMonthPattern","filterDialogDateFormatter","EraFilterDialogDateFormatter"],[["\u65e5","\u6708","\u706b","\u6c34","\u6728","\u91d1","\u571f"],r,r,"\u5348\u524d",!1,["\u65e5\u66dc\u65e5","\u6708\u66dc\u65e5","\u706b\u66dc\u65e5","\u6c34\u66dc\u65e5","\u6728\u66dc\u65e5","\u91d1\u66dc\u65e5","\u571f\u66dc\u65e5"],"yyyy'\u5e74'M'\u6708'd'\u65e5' H:mm:ss","yyyy'\u5e74'M'\u6708'd'\u65e5'","H:mm:ss","M'\u6708'd'\u65e5'",n,n,"\u897f\u66a6 (\u65e5\u672c\u8a9e)","\u5348\u5f8c","yyyy/MM/dd",["\u65e5","\u6708","\u706b","\u6c34","\u6728","\u91d1","\u571f"],"H:mm","yyyy'\u5e74'M'\u6708'","yyyy\u5e74/mmmm/d\u65e5","ggge/mmmm/d\u65e5"]),this.DateTimeFormat.eras=h,this.name=function(){return"ja-JP"},this.id=1041,this.isJCKCulture=!0}return s(t,e),t}(f),v=function(e){function t(){e.apply(this,arguments);var t={1:{letters:["\u5146","\u5343","\u767e","\u5341","\u4ebf","\u5343","\u767e","\u5341","\u4e07","\u5343","\u767e","\u5341",""],numbers:["\u25cb","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d","\u4e03","\u516b","\u4e5d"]},2:{letters:["\u5146","\u4edf","\u4f70","\u62fe","\u4ebf","\u4edf","\u4f70","\u62fe","\u4e07","\u4edf","\u4f70","\u62fe",""],numbers:["\u96f6","\u58f9","\u8d30","\u53c1","\u8086","\u4f0d","\u9646","\u67d2","\u634c","\u7396"]},3:{letters:null,numbers:["\uff10","\uff11","\uff12","\uff13","\uff14","\uff15","\uff16","\uff17","\uff18","\uff19"]}};_.call(this,"NumberFormat",["currencyNegativePattern","currencySymbol","isReadOnly","nanSymbol","negativeInfinitySymbol","percentNegativePattern","percentPositivePattern","positiveInfinitySymbol","dbNumber"],[2,"\xa5",!1,"\u975e\u6570\u5b57","\u8d1f\u65e0\u7a77\u5927",1,1,"\u6b63\u65e0\u7a77\u5927",t]);var r=["1\u6708","2\u6708","3\u6708","4\u6708","5\u6708","6\u6708","7\u6708","8\u6708","9\u6708","10\u6708","11\u6708","12\u6708",""],n=["\u4e00\u6708","\u4e8c\u6708","\u4e09\u6708","\u56db\u6708","\u4e94\u6708","\u516d\u6708","\u4e03\u6708","\u516b\u6708","\u4e5d\u6708","\u5341\u6708","\u5341\u4e00\u6708","\u5341\u4e8c\u6708",""];_.call(this,"DateTimeFormat",["abbreviatedDayNames","abbreviatedMonthGenitiveNames","abbreviatedMonthNames","amDesignator","calendarIsReadOnly","dayNames","firstDayOfWeek","fullDateTimePattern","longDatePattern","longTimePattern","monthDayPattern","monthGenitiveNames","monthNames","nativeCalendarName","pmDesignator","shortDatePattern","shortestDayNames","shortTimePattern","yearMonthPattern","filterDialogDateFormatter"],[["\u5468\u65e5","\u5468\u4e00","\u5468\u4e8c","\u5468\u4e09","\u5468\u56db","\u5468\u4e94","\u5468\u516d"],r,r,"\u4e0a\u5348",!1,["\u661f\u671f\u65e5","\u661f\u671f\u4e00","\u661f\u671f\u4e8c","\u661f\u671f\u4e09","\u661f\u671f\u56db","\u661f\u671f\u4e94","\u661f\u671f\u516d"],1,"yyyy'\u5e74'M'\u6708'd'\u65e5' H:mm:ss","yyyy'\u5e74'M'\u6708'd'\u65e5'","H:mm:ss","M'\u6708'd'\u65e5'",n,n,"\u516c\u5386","\u4e0b\u5348","yyyy/M/d",["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"],"H:mm","yyyy'\u5e74'M'\u6708'","yyyy\u5e74/mmmm/d\u65e5"]),this.name=function(){return"zh-cn"},this.id=2052,this.isJCKCulture=!0}return s(t,e),t}(f),g=function(e){function t(){e.apply(this,arguments);var t={1:{letters:["\u5146","\u5343","\u767e","\u5341","\u5104","\u5343","\u767e","\u5341","\u4e07","\u5343","\u767e","\u5341",""],numbers:["\uff10","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\uf9d1","\u4e03","\u516b","\u4e5d"]},2:{letters:["\u5146","\u9621","\u767e","\uf973","\u5104","\u9621","\u767e","\uf973","\u842c","\u9621","\u767e","\uf973",""],numbers:["\uf9b2","\u58f9","\u8cb3","\uf96b","\u56db","\u4f0d","\uf9d1","\u4e03","\u516b","\u4e5d"]},3:{letters:["\u5146","\u5343","\u767e","\u5341","\u5104","\u5343","\u767e","\u5341","\u4e07","\u5343","\u767e","\u5341",""],numbers:["\uff10","\uff11","\uff12","\uff13","\uff14","\uff15","\uff16","\uff17","\uff18","\uff19"]}};_.call(this,"NumberFormat",["currencyDecimalDigits","currencyNegativePattern","currencySymbol","isReadOnly","dbNumber"],[0,1,"\u20a9",!1,t]);var r=["1","2","3","4","5","6","7","8","9","10","11","12",""],n=["1\uc6d4","2\uc6d4","3\uc6d4","4\uc6d4","5\uc6d4","6\uc6d4","7\uc6d4","8\uc6d4","9\uc6d4","10\uc6d4","11\uc6d4","12\uc6d4",""];_.call(this,"DateTimeFormat",["abbreviatedDayNames","abbreviatedMonthGenitiveNames","abbreviatedMonthNames","amDesignator","calendarIsReadOnly","dayNames","firstDayOfWeek","fullDateTimePattern","longDatePattern","longTimePattern","monthDayPattern","monthGenitiveNames","monthNames","nativeCalendarName","pmDesignator","shortDatePattern","shortestDayNames","shortTimePattern","yearMonthPattern","filterDialogDateFormatter"],[["\uc77c","\uc6d4","\ud654","\uc218","\ubaa9","\uae08","\ud1a0"],r,r,"\uc624\uc804",!1,["\uc77c\uc694\uc77c","\uc6d4\uc694\uc77c","\ud654\uc694\uc77c","\uc218\uc694\uc77c","\ubaa9\uc694\uc77c","\uae08\uc694\uc77c","\ud1a0\uc694\uc77c"],1,"yyyy'\ub144' M'\uc6d4' d'\uc77c' dddd h:mm:ss","yyyy'\ub144' M'\uc6d4' d'\uc77c' dddd","h:mm:ss","M'\uc6d4' d'\uc77c'",n,n,"\uc11c\uae30","\uc624\ud6c4","yyyy-MM-dd",["\uc77c","\uc6d4","\ud654","\uc218","\ubaa9","\uae08","\ud1a0"],"tt h:mm","yyyy'\ub144' M'\uc6d4'","yyyy\ub144/mmmm/d\uc77c"]),this.name=function(){return"ko-kr"},this.id=1042,this.isJCKCulture=!0}return s(t,e),t}(f),y={invariant:new f,"en-us":new m,"ja-jp":new p,"zh-cn":new v,"ko-kr":new g};function _(e,t,r){for(var n,o=0,a=t.length;o<a;o++)n=t[o],this[e][n]=r[o]}var b=new(function(){if("object"===Object(n.a)(e.instance))return e.instance;function e(){var t="en-us";this.culture=function(e){if(0===arguments.length)return t;e&&t!==e&&(t=e.toLowerCase())},this.addCultureInfo=function(e,t){var r=t.NumberFormat.numberDecimalSeparator,n=t.NumberFormat.arrayListSeparator,a=t.NumberFormat.arrayGroupSeparator;if(r===t.NumberFormat.listSeparator||a===n)throw new Error(o.b.Exp_Separator);y[e.toLowerCase()]=t},this.getCultureInfo=function(e){if(0===arguments.length)return y[t];var r="string"===typeof e;e=r?e.toLowerCase():e;var n=y,o=null;for(var a in n)if(a===e||void 0!==n[a].id&&n[a].id===e){o=n[a];break}return o},this._getCultureInfo=function(e){var r=this.getCultureInfo(e);return r||(r=y[t])||(r=new f),r},this._getFilterDialogFormatterStr=function(e,t){var r=(this.getCultureInfo(e)||this.getCultureInfo("en-US")).DateTimeFormat,n=r.filterDialogDateFormatter;return(t.indexOf("g")>=0||t.indexOf("e")>=0)&&(n=r.EraFilterDialogDateFormatter||n),n},e.instance=this}return e}())},"./src/core/feature/formula/lib/spreadjs/common/dateTimeHelper.js":function(e,t,r){"use strict";r.r(t);r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.function.name.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.constructor.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/core-js/modules/es.string.trim.js"),r("../node_modules/core-js/modules/esnext.array.last-index.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("./src/core/feature/formula/lib/spreadjs/common/resource.js"),o=r("./src/core/feature/formula/lib/spreadjs/common/stringHelper.js"),a=r("./src/core/feature/formula/lib/spreadjs/common/arrayHelper.js"),s=r("./src/core/feature/formula/lib/spreadjs/common/culture.js"),i=r("./src/core/feature/formula/lib/spreadjs/common/types.js").a._isNullOrUndefined,u=o.a._padZeroLeft,l=parseInt,c=Math.floor,d=Math.abs,f={},h=function(){function e(e,t,r){var n,o,a,s,i,u=!1;for((i=r).slice(1).forEach((function(e){e&&(u=!0)})),u||(i=i.concat(t._getDateTimePattern())),n=1,o=i.length;n<o;n++)if((s=i[n])&&(u=!0,a=p(e,s,t)))return a;return null}function t(e,o,a){var s=a.DateTimeFormat,i=s.Calendar.convert;if(!o||!o.length)return a&&a.name.length?i?t(e,s.fullDateTimePattern,a):e.toLocaleString():e.toString();var l,f,h,m=s.eras,p="",v=/([^d]|^)(d|dd)([^d]|$)/g;function g(){return f||h||(f=v.test(o),h=!0),f}var y,_=0,b=/\/|dddd|ddd|dd|d|MMMM|MMM|MM|M|yyyy|yyy|yy|y|hh|h|HH|H|mm|m|ss|s|tt|t|fff|ff|f|000|00|0|zzz|zz|z|ggg|gg|g|ee|e|\[H\]|\[HH\]|\[h\]|\[hh\]|\[mm\]|\[ss\]/g;function A(e,t){if(y)return y[t];switch(t){case 0:return e.getFullYear();case 1:return e.getMonth();case 2:return e.getDate();default:return}}!("s"===o)&&i&&(y=i.fromGregorian(e));for(var E=-2,j=-2,R={_value:""},S=0;;S++){var C=b.lastIndex,T=b.exec(o),w=o.slice(C,T?T.index:o.length);if(R._value="",_+=r(w,R),p+=R._value,!T)break;if(_%2!==1){var O=e.getFullYear(),I=e.getDay(),N=e.getHours(),k=e.getMinutes(),M=e.getSeconds(),D=e.getMilliseconds(),x=e.getTimezoneOffset();switch(e>=new Date("1900/1/1")&&e<=new Date("1900/1/7")&&(I=(I+6)%7),T[0]){case"dddd":p+=s.dayNames[I];break;case"ddd":p+=s.abbreviatedDayNames[I];break;case"dd":f=!0,p+=u(A(e,2),2);break;case"d":f=!0,p+=A(e,2);break;case"MMMM":p+=s.monthGenitiveNames&&g()?s.monthGenitiveNames[A(e,1)]:s.monthNames[A(e,1)];break;case"MMM":p+=s.abbreviatedMonthGenitiveNames&&g()?s.abbreviatedMonthGenitiveNames[A(e,1)]:s.abbreviatedMonthNames[A(e,1)];break;case"MM":p+=u(A(e,1)+1,2);break;case"M":p+=A(e,1)+1;break;case"yyyy":case"yyy":p+=E>=0?m._formatEraPart("ee",e):u(y?y[0]:O,4);break;case"yy":p+=E>=0?m._formatEraPart("ee",e):u((y?y[0]:O)%100,2);break;case"y":p+=E>=0?m._formatEraPart("e",e):((y?y[0]:O)%100).toString();break;case"hh":0===(l=N%12)&&(l=12),p+=u(l,2);break;case"h":0===(l=N%12)&&(l=12),p+=l;break;case"HH":p+=u(N,2);break;case"H":p+=N.toString();break;case"mm":p+=u(k,2);break;case"m":p+=k.toString();break;case"ss":p+=u(M,2);break;case"s":p+=M.toString();break;case"tt":p+=N<12?s.amDesignator:s.pmDesignator;break;case"t":p+=(N<12?s.amDesignator:s.pmDesignator).charAt(0);break;case"f":case"0":p+=u(D,3).charAt(0);break;case"ff":case"00":p+=u(D,3).substr(0,2);break;case"fff":case"000":p+=u(D,3);break;case"z":p+=((l=x/60)<=0?"+":"-")+c(d(l));break;case"zz":p+=((l=x/60)<=0?"+":"-")+u(c(d(l)),2);break;case"zzz":p+=((l=x/60)<=0?"+":"-")+u(c(d(l)),2)+":"+u(d(x%60),2);break;case"g":case"gg":case"ggg":if(!m)break;if(E===S-1){E=S;break}p+=m._formatEraPart(T[0],e),E=S;break;case"e":case"ee":if(!m){p+=u(y?y[0]:O,4);break}if(j===S-1){j=S;break}p+=m._formatEraPart(T[0],e),j=S;break;case"/":p+=s.dateSeparator;break;case"[h]":case"[hh]":case"[H]":case"[HH]":case"[mm]":case"[ss]":p+=T[0];break;default:throw new Error(n.b.Exp_InvalidDateFormat)}}else p+=T[0]}return p.toString()}function r(e,t){for(var r=0,n=!1,o=0,a=e.length;o<a;o++){var s=e.charAt(o);switch(s){case'"':n?t._value+="'":r++,n=!1;break;case"\\":n&&(t._value+="\\"),n=!n;break;default:t._value+=s,n=!1}}return r}function m(e,t){var r=new Date,n=e.DateTimeFormat.eras;if(n&&t<100){var o=n._getEraDate(r)._eraYear;(t+=o-o%100)>e.DateTimeFormat.Calendar.TwoDigitYearMax&&(t-=100)}return t}function p(e,t,s){e=e.trim();var i=s.DateTimeFormat,u=function(e,t){if(e._parseRegExp){if(e._parseRegExp[t])return e._parseRegExp[t]}else e._parseRegExp={};var o=t;o=(o=o.replace("%M","M")).replace(/([\^\$\.\*\+\?\|\[\]\(\)\{\}])/g,"\\\\$1");for(var s,i="^",u={_value:""},l=[],c=0,d=0,f=/\/|dddd|ddd|dd|d|MMMM|MMM|MM|M|yyyy|yyy|yy|y|hh|h|HH|H|mm|m|ss|s|tt|t|fff|ff|f|000|00|0|zzz|zz|z|ggg|gg|g|ee|e|\[H\]|\[HH\]|\[h\]|\[hh\]|\[mm\]|\[ss\]/g;null!==(s=f.exec(o));){u._value="";var h=o.slice(c,s.index);if(c=f.lastIndex,d+=r(h,u),i+=u._value,d%2!==1){switch(s[0]){case"dddd":case"ddd":case"MMMM":case"MMM":case"gggg":case"ggg":case"gg":case"g":i+="(\\D+)";break;case"tt":case"t":i+="(\\D*)";break;case"dd":case"d":case"MM":case"M":case"yy":case"y":case"eee":case"ee":case"e":case"HH":case"H":case"hh":case"h":case"mm":case"m":case"ss":case"s":i+="(\\d\\d?)";break;case"yyy":case"yyyy":i+="(\\d{2}|\\d{4})";break;case"fff":case"000":i+="(\\d{3})";break;case"ff":case"00":i+="(\\d{2})";break;case"f":case"0":i+="(\\d)";break;case"zzz":i+="([+-]?\\d\\d?:\\d{2})";break;case"zz":case"z":i+="([+-]?\\d\\d?)";break;case"/":i+="(\\"+e.dateSeparator+")";break;default:throw new Error(n.b.Exp_InvalidDateFormat)}a.a._add(l,s[0])}else i+=s[0]}u._value="",r(o.slice(c),u),i+=u._value;var m=(i+="$").toString().replace(/\s+/g,"\\s+"),p={_regExp:m,_groups:l,_exp:new RegExp(m)};return e._parseRegExp[t]=p,p}(i,t),c=u._exp.exec(e);if(null===c)return null;for(var d,f=!1,h=u._groups,p=null,v=null,g=null,y=null,_=null,b=0,A=0,E=0,j=0,R=null,S=!1,C=0,T=h.length;C<T;C++){var w=c[C+1];if(w)switch(h[C]){case"dd":case"d":if((y=l(w,10))<1||y>31)return null;break;case"MMMM":if((g=s._getMonthIndex(w))<0||g>11)return null;break;case"MMM":if((g=s._getAbbrMonthIndex(w))<0||g>11)return null;break;case"M":case"MM":case"%M":if((g=l(w,10)-1)<0||g>11)return null;break;case"e":case"ee":if((v=m(s,l(w,10)))<0||v>9999)return null;break;case"y":case"yy":case"yyy":case"yyyy":if((v=l(w,10))<0||v>9999)return null;break;case"h":case"hh":case"H":case"HH":if((b=l(w,10))<0)return null;break;case"m":case"mm":if((A=l(w,10))<0||A>59)return null;break;case"s":case"ss":if((E=l(w,10))<0||E>59)return null;break;case"tt":case"t":var O=w.toUpperCase();if(!(S=O===i.pmDesignator.toUpperCase()||"PM"===O)&&O!==i.amDesignator.toUpperCase()&&"AM"!==O)return null;f=!0;break;case"f":case"0":if((j=100*l(w,10))<0||j>999)return null;break;case"ff":case"00":if((j=10*l(w,10))<0||j>999)return null;break;case"fff":case"000":if((j=l(w,10))<0||j>999)return null;break;case"dddd":if((_=s._getDayIndex(w))<0||_>6)return null;break;case"ddd":if((_=s._getAbbrDayIndex(w))<0||_>6)return null;break;case"zzz":var I=w.split(/:/);if(2!==I.length)return null;if((d=l(I[0],10))<-12||d>13)return null;var N=l(I[1],10);if(N<0||N>59)return null;R=60*d+(o.a._startsWith(w,"-")?-N:N);break;case"z":case"zz":if((d=l(w,10))<-12||d>13)return null;R=60*d;break;case"g":case"gg":case"ggg":var k=w;if(!k||!i.eras)return null;if((p=i.eras._parseEraPart(h[C],k))<0)return null}}var M,D=/^(\d|\d\d):/.test(e),x=new Date("1970/01/01 00:00:00 +0800"),F=D?new Date(x.getTime()+-22090752e5):new Date,P=i.Calendar.convert;if(P&&(M=P.fromGregorian(F)),P||(M=[F.getFullYear(),F.getMonth(),F.getDate()]),null===v?v=M[0]:v<100&&(i.eras&&null!==p?v=i.eras._getYearFromEra(p||0,v):v+=v>=30?1900:2e3),null===g&&(g=M[1]),null===y&&(y=M[2]),P){if(null===(F=P.toGregorian(v,g,y)))return null}else{if(F.setFullYear(v,g,y),F.getDate()!==y)return null;if(null!==_&&F.getDay()!==_)return null}if(f&&b>12)return null;if(S&&b<12&&(b+=12),f&&!S&&12===b&&(b=0),F.setHours(b,A,E,j),null!==R){var L=F.getMinutes()-(R+F.getTimezoneOffset());F.setHours(F.getHours()+L/60,L%60)}return F}function v(e){var t=e.getTimezoneOffset();return-485===t&&(t=-485-43/60),t}return{_customCultureFormat:function(e,r,n){return n||(n=s.a._getCultureInfo()),t(e,r,n)},_localeFormat:function(e,r,n){return t(e,r,n||s.a._getCultureInfo())},_parseLocale:function(t,r,n){var o,a;return r||n||void 0===(a=f[t])?(o=r?[t,r]:[t],a=e(t,n||s.a._getCultureInfo(),o),r||n||(f[t]=a),a?new Date(a):a):a?new Date(a):a},_parseInvariant:function(t,r){return e(t,s.a._getCultureInfo("invariant"),[t,r])},_parseExact:p,_fromOADate:function(e){var t=e-25568,r=t>=0?1:-1,n=v(new Date(864e5*t)),o=(864e5*e*1440+r-3181068288e6+864e5*n)/1440,a=new Date(o),s=n>=0?1:-1,i=v(new Date(o+36e5*s));if(n!==i&&366!==e){var u=new Date(o+60*(i-n)*1e3);if(n>i){if(-1===s||i===v(a))return u=999===u.getMilliseconds()?new Date(u.valueOf()+1):u}else if(n<i&&(1===s||i===v(a)))return u=999===u.getMilliseconds()?new Date(u.valueOf()+1):u}return a=999===a.getMilliseconds()?new Date(a.valueOf()+1):a},_fromOADateString:function(e){if("/OADate("===e.substr(0,8)){var t=parseFloat(e.substr(8,e.length-10));return this._fromOADate(t)}},_toOADateString:function(e){return"/OADate("+this._toOADate(e)+")/"},_toOADate:function(e){if(i(e))return 0;"number"===typeof e&&(e=new Date(e));var t=v(e);return(1440*e.getTime()+3181068288e6-864e5*t)/124416e6},_DT:function(e){var t=null,r=!0;if(i(e))t=this._fromOADate(0);else if(e instanceof Date)t=new Date(e.valueOf());else if("string"===typeof e){var o=this._parseLocale(e);if(!o)if(isNaN(e))if(this._isInvalidDateString(e))r=!1;else{o=new Date(e),isNaN(o.valueOf())&&(r=!1);var a=/^[-+=\s]*(\d+)\W+(\d+)\W+(\d+)$/.exec(e.replace(/ |\n/g,"").trim());a&&4===a.length&&(-1!==a.indexOf(o.getFullYear().toString())&&-1!==a.indexOf((o.getMonth()+1).toString())&&-1!==a.indexOf(o.getDate().toString())||(r=!1))}else(o=h._fromOADate(parseFloat(e)))||(r=!1);t=o}else"number"===typeof e?t=this._fromOADate(e):r=!1;if(r)return t;throw n.b.Exp_InvalidCast},_isInvalidDateString:function(e){var t=s.a._getCultureInfo().DateTimeFormat,r=function(e,t){var r=0;return t.forEach((function(t){t&&e.indexOf(t)>-1&&r++})),r>1};return r(e,t.monthNames)||r(e,t.abbreviatedMonthNames)||r(e,t.dayNames)||r(e,t.abbreviatedDayNames)},_isDate:function(e){return e&&(e.constructor===Date||e.getUTCDate&&e.setFullYear)}}}();t.default=h},"./src/core/feature/formula/lib/spreadjs/common/numHelper.js":function(e,t,r){"use strict";r.r(t);r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.array.splice.js"),r("../node_modules/core-js/modules/es.function.name.js"),r("../node_modules/core-js/modules/es.number.to-fixed.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.match.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.string.search.js"),r("../node_modules/core-js/modules/es.string.split.js");var n=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),o=r("./src/core/feature/formula/lib/spreadjs/common/resource.js"),a=r("./src/core/feature/formula/lib/spreadjs/common/stringHelper.js"),s=(r("./src/core/feature/formula/lib/spreadjs/common/arrayHelper.js"),r("./src/core/feature/formula/lib/spreadjs/common/culture.js")),i=r("./src/core/feature/formula/lib/spreadjs/common/types.js").a._isNullOrUndefined,u=a.a._padZeroLeft,l=a.a._padZeroRight,c=parseInt,d=parseFloat,f=Math.floor,h=Math.abs,m=Math.pow,p=Math.min;function v(e,t,r){return e.substr(t,r)}var g=function(){var e={1:"+",0:"","-1":"-"},t=["0","#","?"],r={"\xa4":"\xa4",Br:"Br",Fdj:"Fdj",Nfk:"Nfk",R:"R",$:"$",FCFA:"FCFA","GH\u20b5":"GH\u20b5","\u1265\u122d":"\u1265\u122d","\u0631.\u0633.\u200f":"\u0631.\u0633.\u200f",XDR:"XDR","\u062f.\u0625.\u200f":"\u062f.\u0625.\u200f","\u062f.\u0628.\u200f":"\u062f.\u0628.\u200f","\u062f.\u062c.\u200f":"\u062f.\u062c.\u200f","\u062c.\u0645.\u200f":"\u062c.\u0645.\u200f","\u20aa":"\u20aa","\u062f.\u0639.\u200f":"\u062f.\u0639.\u200f","\u062f.\u0627.\u200f":"\u062f.\u0627.\u200f","\u0641.\u062c.\u0642.\u200f":"\u0641.\u062c.\u0642.\u200f","\u062f.\u0643.\u200f":"\u062f.\u0643.\u200f","\u0644.\u0644.\u200f":"\u0644.\u0644.\u200f","\u062f.\u0644.\u200f":"\u062f.\u0644.\u200f","\u062f.\u0645.\u200f":"\u062f.\u0645.\u200f","\u0623.\u0645.\u200f":"\u0623.\u0645.\u200f","\u0631.\u0639.\u200f":"\u0631.\u0639.\u200f","\u0631.\u0642.\u200f":"\u0631.\u0642.\u200f","\u062c.\u0633.":"\u062c.\u0633.",S:"S","\xa3":"\xa3","\u0644.\u0633.\u200f":"\u0644.\u0633.\u200f","\u062f.\u062a.\u200f":"\u062f.\u062a.\u200f","\u0631.\u064a.\u200f":"\u0631.\u064a.\u200f","\u20b9":"\u20b9",TSh:"TSh","\u20ac":"\u20ac","\u20bc":"\u20bc","\u20bd":"\u20bd",K:"K","\u043b\u0432.":"\u043b\u0432.","\u20a6":"\u20a6",CFA:"CFA","\u09f3":"\u09f3","\xa5":"\xa5",KM:"KM","\u041a\u041c":"\u041a\u041c",USh:"USh","K\u010d":"K\u010d","kr.":"kr.",Ksh:"Ksh",CHF:"CHF","\u0783.":"\u0783.","Nu.":"Nu.",EC$:"EC$",P:"P",US$:"US$",D:"D",Rp:"Rp",Ar:"Ar",MOP$:"MOP$",Rs:"Rs",MK:"MK",RM:"RM","\u20b1":"\u20b1",RF:"RF",SR:"SR",SDG:"SDG",Le:"Le","NAf.":"NAf.",E:"E",T$:"T$",VT:"VT",WS$:"WS$",Bs:"Bs","\u20a1":"\u20a1",Q:"Q",L:"L",C$:"C$","B/.":"B/.","S/.":"S/.","\u20b2":"\u20b2","Bs.":"Bs.","\u0631\u064a\u0627\u0644":"\u0631\u064a\u0627\u0644",FG:"FG",UM:"UM",kr:"kr",FBu:"FBu",FC:"FC",DA:"DA",G:"G",CF:"CF",DH:"DH",FCFP:"FCFP",LS:"LS",DT:"DT",kn:"kn",HUF:"HUF","\u058f":"\u058f",ISK:"ISK","\u20be":"\u20be","\u200b":"\u200b","\u20b8":"\u20b8","\u17db":"\u17db","\u20a9":"\u20a9","\u0441\u043e\u043c":"\u0441\u043e\u043c",Kz:"Kz","\u20ad":"\u20ad",MTn:"MTn","\u0434\u0435\u043d":"\u0434\u0435\u043d","\u20ae":"\u20ae","\u0930\u0941":"\u0930\u0941","Afl.":"Afl.","\u07d6\u07d5.":"\u07d6\u07d5.","\u0440\u0443\u0431.":"\u0440\u0443\u0431.","z\u0142":"z\u0142","\u060b":"\u060b",R$:"R$",Db:"Db",RON:"RON","\u20b4":"\u20b4",MAD:"MAD","\u0dbb\u0dd4.":"\u0dbb\u0dd4.","Lek\xeb":"Lek\xeb",den:"den",RSD:"RSD","\u0434\u0438\u043d.":"\u0434\u0438\u043d.","\u0720.\u0723.\u200f":"\u0720.\u0723.\u200f","Rs.":"Rs.","\u0441\u043c\u043d":"\u0441\u043c\u043d","\u0e3f":"\u0e3f","m.":"m.","\u20ba":"\u20ba","\u2d37\u2d54":"\u2d37\u2d54","so\u02bbm":"so\u02bbm","\u0441\u045e\u043c":"\u0441\u045e\u043c","\u20ab":"\u20ab",HK$:"HK$",MOP:"MOP",NT$:"NT$"};function g(e,t,r,n){return t&&0!==t.length&&"i"!==t?function(e,t,r,n){var o=A(t,r);return S(e,o,r,n)}(e,t,r.NumberFormat,n):r&&r.name.length>0?e.toLocaleString():e.toString()}function _(e,t){for(var r=f(h(e)),n={_integer:1,_decimal:0};r>=10;)r/=10,n._integer++;var o,a=e.toString(),s=a.search(/e/gi),i=a.indexOf(t);if(-1!==s){var u=v(a,0,s),l=v(a,s+1),c=0;-1!==i&&(c=v(u,i+1).length),(o=c-d(l))<0&&(o=0),n._decimal=o}else o=0,-1!==i&&(o=v(a,i+1).length),n._decimal=o;return n}function b(e){for(var t={_symbol:e.charAt(0),_sign:0,_exp:0},r="",n=1;n<e.length;n++)if("+"===(r=e.charAt(n)))t._sign=1;else{if("-"!==r){if("0"===r){t._exp=e.length-n;break}throw new Error(o.b.Exp_InvalidExponentFormat)}t._sign=-1}return t}function A(e,r){for(var n,o={_intPart:null,_decPart:null,_group:!1,_scale:0,_percent:0,_permille:0,_exponent:null},a="",s=!1,i=!1,u=!1,l=!1,c=!1,d=!1,f=null,h=[],m=0;m<e.length;m++){if(n=e.charAt(m),s)a+=n,'"'===n&&(h.push(a),a="",s=!1);else if(i){if("E"===f||"e"===f){if(!(["+","-","0"].indexOf(n)>=0)){i=!1,m--;continue}a+=n}else if("+"===f||"-"===f){if("0"!==n){i=!1,m--;continue}a+=n}else if("0"===f){if("0"!==n){i=!1,c||(c=!0,o._exponent=b(a)),m--;continue}a+=n}}else if("*"!==f&&"_"!==f&&"\\"!==f||""===a)if("*"===n||"_"===n||"\\"===n)d=!1,""!==a&&(h.push(a),a=""),a+=n;else if("'"===n)d=!1,""!==a&&(h.push(a),a=""),h.push(n);else if('"'===n)d=!1,s=!0,""!==a&&(h.push(a),a=""),a+=n;else if(t.indexOf(n)>=0)d=!0,t.indexOf(f)<0&&""!==a&&(h.push(a),a=""),a+=n;else if("."!==n||u)if(n===r.percentSymbol)d=!1,o._percent++,""!==a&&(h.push(a),a=""),h.push(n);else if(n===r.perMilleSymbol)d=!1,o._permille++,""!==a&&(h.push(a),a=""),h.push(n);else if(n===r.percentGroupSeparator)if(d){""!==a&&(h.push(a),a="");for(var p=!0,v="",g=m+1;g<e.length;g++){var y=e.charAt(g);if(""===v)if('"'===y)v=y;else{if(t.indexOf(y)>=0){p=!1;break}if(y===r.numberDecimalSeparator||";"===y)break}else'"'===y&&(v="")}p?o._scale++:u||(y=e.charAt(m+1))&&t.indexOf(y)>=0&&(l=!0)}else a+=n;else"E"===n||"e"===n?(d=!1,i=!0,""!==a&&(h.push(a),a=""),a+=n):(d=!1,t.indexOf(f)>=0&&""!==a&&(h.push(a),a=""),a+=n);else""!==a&&(h.push(a),a=""),o._intPart=h,h=[],u=!0,d=!1;else a+=n,h.push(a),a="";f=n}return""!==a&&(i&&!c&&(o._exponent=b(a)),h.push(a)),l&&(o._group=!0),u?o._decPart=h:o._intPart=h,o}function E(e,t,r,o,a,s){var i=function(e,t){if(void 0===Object(n.a)(t)||0===+t)return Math.round(e);if(e=+e,t=+t,isNaN(e)||!(t%1===0))return NaN;var r=e<0;return e=(e=r?-e:e).toString().split("e"),e=Math.round(+(e[0]+"e"+(e[1]?+e[1]-t:-t))),+((e=(e=r?-e:e).toString().split("e"))[0]+"e"+(e[1]?+e[1]+t:t))}(e,-t);isFinite(i)||(i=e);var d,f,h=(e=i).toString(),m=h.split(/e/i);return h=m[0],f=m.length>1?c(m[1],10):0,m=h.split("."),h=m[0],d=m.length>1?m[1]:"",f>0?(h+=(d=l(d,f)).slice(0,f),d=v(d,f)):f<0&&(f=-f,d=(h=e<0?s+u(h.replace(s,""),f+1):u(h,f+1)).slice(-f,h.length)+d,h=h.slice(0,-f)),h+(d=t>0?a+(d=d.length>t?d.slice(0,t):l(d,t)):"")}function j(e){var t=null;if(e){t="";for(var r=0;r<e.length;r++){var n=e[r];/^(0|#|\?)+/g.test(n)&&(t+=n)}}return t}function R(t,n,a,s,i,l,c,d){var f=d.numberGroupSizes,h=d.numberGroupSeparator,m=d.negativeSign,p=d.percentSymbol,g=d.perMilleSymbol,y=s._exponent,_=v(n,0,1);_===m&&(n=v(n,1));var b=1===n.length&&"0"===n?0:n.length;n=0===b?"":n;for(var A=0,E="",j=t.length-1;j>=0;j--){var R="",S=t[j];if(/^(0|#|\?)+/g.test(S)){if(E!==a){for(var C=S.length,T=b-A-1;T>=0&&C>0;T--){R=n.charAt(T)+R,C--,A++}for(var w=C-1;w>=0;w--){var O=S[w];A++,"0"===O?R=O+R:"?"===O&&(""!==R&&(l.push({type:"number",value:R}),R=""),l.push({type:"numberPlaceholder",value:O}))}(E=S+E)===a&&A<b&&(R=n.substr(0,b-A)+R),""!==R&&l.push({type:"number",value:R})}}else if(s._exponent&&!c.replaceExponent&&/^((E(\+|-)?|e(\+|-)?)\d+)/g.test(S)){c.replaceExponent=!0;var I="";I+=y._symbol,I+=e[y._sign],I+=u(i.toString(),y._exp),l.push({type:"exponent",value:I})}else"_"===S[0]?l.push({type:"placeholder",value:S[1]}):"*"===S[0]?c.hasInfilling||(l.push({type:"fillingChar",value:S[1]}),c.hasInfilling=!0,c.infillIndex=l.length-1):"\\"===S[0]?2===S.length&&l.push({type:"text",value:S[1]}):'"'===S[0]&&'"'===S[S.length-1]?S.length>2&&l.push({type:"text",value:S.substr(1,S.length-2)}):S===p?l.push({type:"percent",value:S}):S===g?l.push({type:"permille",value:S}):r[S]?l.push({type:"currency",value:S}):l.push({type:"text",value:S})}_===m&&l.push({type:"text",value:_}),!0===s._group&&function(e,t,r,n){for(var a=t[0],s=1,i=0,u=!1,l=e.length,c=0;c<l;c++){var d=e[c].type;if("number"===d){for(var f="",h=e[c].value,m=h.length-1;m>=0;){if(a<1||a>9)throw new Error(o.b.Exp_InvalidNumberGroupSize);/\d/gi.test(h[m])?(u&&(f&&e.push({type:"number",value:f}),e.push({type:"groupSeparator",value:r}),f="",u=!1),i++):i=0,f=h[m]+f,i===a&&(u=!0,i=0,s<t.length&&(a=t[s],s++)),m--}f&&e.push({type:d,value:f})}else"fillingChar"===d&&(n.infillIndex=e.length-l),e.push({type:d,value:e[c].value})}e.splice(0,l)}(l,f,h,c),l=l.reverse(),c.infillIndex=l.length-1-c.infillIndex}function S(t,n,o,a){var s=[];t=function(e,t,r,n){var o=e;return t>0&&(o=e*m(100,t)),r>0&&(o=e*m(1e3,r)),n>0&&(o=e/m(1e3,n)),o}(t,n._percent,n._permille,n._scale);var i=n._intPart,l=n._decPart;if(!i&&!l)return s;var c,d=j(i),f=j(l);if(f||(f=""),n._exponent){var v=function(e,t,r){var n={value:e,exponentValue:0},o=_(e,".")._integer,a=h(e),s=r?r.length:1;if(a>=1)o>s?(o-=s,n.value=e/m(10,o),n.exponentValue=o):n.exponentValue=0,-1===t._sign&&(t._sign=0);else if(a<1&&a>0){t._sign=-1;for(var i=m(10,s);10*a<i;)a*=10,n.exponentValue++;n.value*=m(10,n.exponentValue)}return n}(t,n._exponent,d);t=v.value,c=v.exponentValue}var g=_(t,"."),y=(o.numberGroupSizes,o.numberGroupSeparator,o.numberDecimalSeparator),b=o.negativeSign,A=E(t,p(g._decimal,f.length),0,0,y,b);if(a||(A=function(e,t){var r=e;return-1!==e.indexOf(t)&&(r=e.replace(/0+$/,"")),r}(A,y)),""===A)return s.push({type:"text",value:(i?i.join(""):"")+(l?l.join(""):"")}),s;var S={hasInfilling:!1,infillIndex:-1,replaceExponent:!1},C=A.split(y)[0];return i&&R(i,C,d,n,c,s,S,o),"0"!==C&&""===d&&l&&s.push({type:"number",value:C}),l&&function(t,n,o,a,s,i,l,c,d){var f=d.numberDecimalSeparator,h=d.percentSymbol,m=d.perMilleSymbol,p=n.indexOf(f),v=s._exponent;(p>0||"##################0"!==a||"################"!==o)&&l.push({type:"decimalSeparator",value:f});for(var g=-1!==p?n.substring(p+1):"",y=0,_="",b=0;b<t.length;b++){var A=t[b];if(/^(0|#|\?)+/g.test(A)){var E="";if(_!==o){for(var j=A.length,R=0,S=y;j>0&&g.length-y>0;){E+=g.charAt(S),j--,y++,R++,S++}for(var C=R;j>0;){var T=A[C];C++,y++,j--,"0"===T?E+=T:"?"===T&&(""!==E&&(l.push({type:"number",value:E}),E=""),l.push({type:"numberPlaceholder",value:T}))}""!==E&&l.push({type:"number",value:E}),_+=A}}else if(v&&!c.replaceExponent&&/^((E(\+|-)?|e(\+|-)?)\d+)/g.test(A)){c.replaceExponent=!0;var w="";w+=v._symbol,w+=e[v._sign],w+=u(i.toString(),v._exp),l.push({type:"exponent",value:w})}else"_"===A[0]?l.push({type:"placeholder",value:A[1]}):"*"===A[0]?(l.push({type:"fillingChar",value:A[1]}),c.hasInfilling&&l.splice(c.infillIndex,1),c.hasInfilling=!0,c.infillIndex=l.length-1):"\\"===A[0]?2===A.length&&l.push({type:"text",value:A[1]}):'"'===A[0]&&'"'===A[A.length-1]?A.length>2&&l.push({type:"text",value:A.substr(1,A.length-2)}):A===h?l.push({type:"percent",value:A}):A===m?l.push({type:"permille",value:A}):r[A]?l.push({type:"currency",value:A}):l.push({type:"text",value:A})}}(l,A,f,d,n,c,s,S,o),s}function C(e,t){if((e=i(e)?"":a.a._trimEnd(e,"")).match(/^[+-]?infinity$/i))return d(e);if(e.match(/^0x[a-f0-9]+$/i))return c(e,10);var r,n,o=t.NumberFormat,s=o.numberNegativePattern,u=T(e,o,s),l=u[0],f=u[1];""===l&&1!==s&&(l=(u=T(e,o,1))[0],f=u[1]),""===l&&(l="+"),f[0]===o.currencySymbol&&(f=v(f,1));var h,m,p=f.indexOf("e");p<0&&(p=f.indexOf("E")),p<0?(n=f,r=null):(n=v(f,0,p),r=v(f,p+1));var g=n.indexOf(".");g<0?(h=n,m=null):(h=v(n,0,g),m=v(n,g+".".length)),h=h.split(",").join("");var y=",".replace(/\u00A0/g," ");","!==y&&(h=h.split(y).join(""));var _=l+h;if(null!==m&&(_+="."+m),_[_.length-1]===o.percentSymbol){_=v(_,0,_.length-1);var b=(_=a.a._trimEnd(_,"")).indexOf(".");-1===b&&(b=_.length);var A="";A+=v(_,0,b-2),A+=".",A+=v(_,b-2,2),_=A+=v(_,b+1)}if(null!==r){var E=T(r,o,1);""===E[0]&&(E[0]="+"),_+="e"+E[0]+E[1]}return _.match(/^[+-]?\d*\.?\d*(e[+-]?\d+)?$/)?d(_):NaN}function T(e,t,r){var n=t.negativeSign,o=t.positiveSign,s=a.a;if(4!==r&&2!==r||(n=" "+n,o=" "+o),4===r||3===r){if(s._endsWith(e,n))return["-",v(e,0,e.length-n.length)];if(s._endsWith(e,o))return["+",v(e,0,e.length-o.length)]}else if(2===r||1===r){if(s._startsWith(e,n))return["-",v(e,n.length)];if(s._startsWith(e,o))return["+",v(e,o.length)]}else{if(0!==r)throw new Error("");if(s._startsWith(e,"(")&&s._endsWith(e,")"))return["-",v(e,1,e.length-2)]}return["",e]}function w(e){var t=s.a._getCultureInfo().NumberFormat;return"string"===typeof e&&(t=s.a._getCultureInfo(e).NumberFormat),t}return{_parseLocale:function(e){return C(e,s.a._getCultureInfo())},_parseInvariant:function(e){return C(e,s.a._getCultureInfo("invariant"))},_customCultureFormat:function(e,t,r,n){return r||(r=s.a._getCultureInfo()),g(e,t,r,n)},_replaceNormalToCultureSymbol:function(e,t){if("string"!==typeof e)return e;var r=w(t),n=r.numberDecimalSeparator,o=r.numberGroupSeparator;return"."!==n&&(e=e.replace(y("[.]"),"#dot#")),","!==o&&(e=e.replace(y("[,]"),"#group#")),"."!==n&&(e=e.replace(y("#dot#"),n)),","!==o&&(e=e.replace(y("#group#"),o)),e},_replaceCultureSymbolToNormal:function(e,t){if("string"!==typeof e)return e;var r=w(t),n=r.numberDecimalSeparator,o=r.numberGroupSeparator;return"."!==n&&(e=e.replace(y("["+n+"]"),"#dot#")),","!==o&&(e=e.replace(y("["+o+"]"),"#group#")),"."!==n&&(e=e.replace(y("#dot#"),".")),","!==o&&(e=e.replace(y("#group#"),",")),e},_isValidCultureNumberString:function(e,t){if("string"===typeof e){var r=w(t),n=r.numberDecimalSeparator,o=r.numberGroupSeparator;if("."!==n&&"."!==o&&e.indexOf(".")>=0||","!==n&&","!==o&&e.indexOf(",")>=0)return!1}return!0},_parseFloat:function(e,t){return d(this._replaceCultureSymbolToNormal(e,t))},_toHexString:function(e,t,r){if(0!==h(f(e)-e))throw new Error(o.b.Exp_BadFormatSpecifier);var n=e>=0?e.toString(16):(4294967295+e+1).toString(16);return n=t?n.toLowerCase():n.toUpperCase(),!i(r)&&n.length<r?u(n,r):n},_parseCustomNumberFormatter:A,_formatNumber:S,_formatObjectToSrting:function(e){var t="";if(Array.isArray(e)&&e.length>0)for(var r=0;r<e.length;r++){var n=e[r].type,o=e[r].value;if("placeholder"===n)t+=" ";else{if("fillingChar"===n)continue;t+="numberPlaceholder"===n?" ":o}}return t},_generalNumberInt:"##################0",_generalNumberDec:"################",_fixNumber:function(e,t){return"number"===typeof e&&e.toString().length>=t&&(e=e<1&&e>-1?+e.toFixed(t):+e.toPrecision(t)),e}}}();function y(e){return RegexHelper._getReg(e)}t.default=g},"./src/core/feature/formula/lib/spreadjs/common/regexHelper.js":function(e,t,r){"use strict";r.r(t);r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/es.regexp.constructor.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/core-js/modules/esnext.array.last-index.js");var n=r("./src/core/feature/formula/lib/spreadjs/common/stringHelper.js"),o=function(){function e(){}return e._getReg=function(t){var r=e._regDict[t];return r||(r=e._regDict[t]=new RegExp(t,"g")),r.lastIndex=0,r},e._getRegIgnoreCase=function(t){var r=e._regDictIgnoreCase[t];return r||(r=e._regDictIgnoreCase[t]=new RegExp(t,"gi")),r.lastIndex=0,r},e._getRegWithConditions=function(t,r){var n=e._regDictIgnoreCase[t];return n||(n=e._regDictIgnoreCase[t]=new RegExp(t,r)),n.lastIndex=0,n},e._getWildcardCriteria=function(t,r,n){if(e._wildcardParseRecord[t])return e._wildcardParseResultBuffer[t];if(e._getReg("[~?*]+").test(t)){for(var o,a=[],s=t.split(""),i={".":!0,"+":!0,$:!0,"^":!0,"[":!0,"]":!0,"(":!0,")":!0,"{":!0,"}":!0,"|":!0,"/":!0},u=0;u<s.length;u++)"~"===(o=s[u])&&u<s.length-1?("*"===(o=s[++u])||"?"===o?a.push("\\"):r&&a.push("~"),a.push(o)):"?"===o?a.push("."):"*"===o?(a.push("."),n?a.push("+"):a.push("*")):i[o]?(a.push("\\"),a.push(o)):"\\"===o?a.push("\\\\"):a.push(o);return a.join("")}return null},e._getWildcardCriteriaFullMatch=function(t,r,n){var o=e._getWildcardCriteria(t,r,n);return o&&(o="^"+o+"$"),o},e._getReplaceSymbol=function(e,t){for(var r="#"+e+"0#",o=1;t.indexOf(r)>0;)r=n.a._join(r,"#"+e+(o-1)+"#","#"+e+o+"#"),o++;return r},e._regDict={},e._regDictIgnoreCase={},e._wildcardParseRecord={},e._wildcardParseResultBuffer={},e._replaceRegString2NormalString=function(e){return e.replace(/([\~\!\@\#\$\%\^\&\*\(\)\-\_\+\=\[\]\{\}\|\\\;\:\'\"\,\.\/\<\>\?])/,"\\$1")},e}();t.default=o},"./src/core/feature/formula/lib/spreadjs/common/resource.js":function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return o}));var n={Exp_InvalidDateFormat:"\u65e0\u6548\u65e5\u671f\u683c\u5f0f",Exp_InvalidExponentFormat:"\u65e0\u6548\u6307\u6570\u683c\u5f0f",Exp_InvalidSemicolons:"\u65e0\u6548\u683c\u5f0f : \u8fc7\u591a\u5206\u53f7",Exp_InvalidNumberGroupSize:"\u6570\u503c\u7ec4\u5927\u5c0f\u8303\u56f4\u5fc5\u987b\u5728 1 \u5230 9 \u4e4b\u95f4\u3002",Exp_BadFormatSpecifier:"\u9519\u8bef\u7684\u683c\u5f0f\u6307\u793a\u7b26",Exp_InvalidNumberFormat:"\u65e0\u6548\u6570\u503c\u683c\u5f0f",Exp_InvalidCast:"\u65e0\u6548\u8f6c\u6362\u5f02\u5e38",Exp_Separator:"\u5728\u6587\u5316\u4fe1\u606f\u4e2d\uff0c\u5c0f\u6570\u70b9\u5206\u9694\u7b26, \u6570\u7ec4\u5206\u9694\u7b26\u548c\u5217\u5206\u9694\u7b26\u5fc5\u987b\u4e0d\u76f8\u540c\u3002"},o={Exp_TokenIsNull:"token is null",Exp_InvalidBackslash:"the '\\' cannot be evaluated",Exp_FormatIllegal:"format is illegal.",Exp_ValueIsNull:"value is null",Exp_DuplicatedDescriptor:"The type of descriptor was added.",Exp_TokenIllegal:"token is illegal.",Exp_ValueIllegal:"value is illegal.",Exp_InvalidCast:"InvalidCastException"}},"./src/core/feature/formula/lib/spreadjs/common/stringHelper.js":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.constructor.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.string.split.js");var n=r("./src/core/feature/formula/lib/spreadjs/common/types.js").a._isNullOrUndefined;function o(e,t,r){return e.substr(t,r)}var a={_contains:function(e,t,r){return r&&(e=e.toLowerCase(),t=t.toLowerCase()),""===t||e.indexOf(t)>=0},_indexOf:function(e,t,r){if(r){var n=e.toLowerCase(),o=t.toLowerCase();return n.indexOf(o)}return e.indexOf(t)},_trimStart:function(e,t){if(!t)return e;for(var r=e;o(r,0,t.length)===t;)r=o(r,t.length);return r},_trimEnd:function(e,t){if(!t)return e;for(var r=e;o(r,r.length-t.length,t.length)===t;)r=o(r,0,r.length-t.length);return r},_insert:function(e,t,r){if(t<0||t>e.length||n(r))throw new Error;return o(e,0,t)+r+o(e,t,e.length-t)},_remove:function(e,t,r){if(n(r)&&(r=e.length-t),t<0||r<0||t+r>e.length)throw new Error;return o(e,0,t)+o(e,t+r,e.length-t-r)},_startsWith:function(e,t,r){return s(e,t,r,(function(e,t){return e.slice(0,t.length)===t}))},_endsWith:function(e,t,r){return s(e,t,r,(function(e,t){return e.slice(-t.length)===t}))},_replace:function(e,t,r,n){if(!t)throw new Error;return r=(""+r).replace(/\$/g,"$$$$"),e.replace(new RegExp(t,"g"+(n?"i":"")),r)},_replaceAllNoReg:function(e,t,n,o){return t=r("./src/core/feature/formula/lib/spreadjs/common/regexHelper.js").default._replaceRegString2NormalString(t),this._replace(e,t,n,o)},_leftBefore:function(e,t){var r=e.indexOf(t);return r<0||r>=e.length?e:o(e,0,r)},_count:function(e,t){for(var r=0,n=e.indexOf(t);n>=0;)r+=1,n=e.indexOf(t,n+1);return r},_join:function(e,t,r){return e.split(t).join(r)},_format:function(e,t){for(var r=e,n=0;n<t.length;n++){var o=new RegExp("\\{"+n+"\\}","g");r=r.replace(o,t[n])}return r},_padZero:function(e,t,r){for(var n=e.toString(),o=n.length;o<t;o++)n=r?"0"+n:n+"0";return n},_padZeroLeft:function(e,t){return a._padZero(e,t,!0)},_padZeroRight:function(e,t){return a._padZero(e,t,!1)},_compareStringIgnoreCase:function(e,t){return e===t||!e&&!t||e&&t&&e.toLowerCase()===t.toLowerCase()},_toUpperCase:function(e){return e.toUpperCase()},_escapeHtml:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},n=r("./src/core/feature/formula/lib/spreadjs/common/regexHelper.js").default._getReg("(?:&|<|>|\"|'|`)");return n.test(e)?e.replace(n,(function(e){return t[e]})):e},_unescapeHtml:function(e){var t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#x27;":"'","&#x60;":"`"},n=r("./src/core/feature/formula/lib/spreadjs/common/regexHelper.js").default._getReg("(?:&amp;|&lt;|&gt;|&quot;|&#x27;|&#x60;)");return n.test(e)?e.replace(n,(function(e){return t[e]})):e}};function s(e,t,r,o){if(n(t))throw new Error;if(""===t)return!0;if(t.length>e.length)return!1;var a=e,s=t;return r&&(a=a.toLowerCase(),s=s.toLowerCase()),o(a,s)}t.a=a},"./src/core/feature/formula/lib/spreadjs/common/types.js":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js");var n=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),o={_each:function(e,t){if(o._isArraylike(e))for(var r=0,n=e.length;r<n&&!1!==t.call(e[r],r,e[r]);r++);else for(var a in e)if(e.hasOwnProperty(a)&&!1===t.call(e[a],a,e[a]))break;return e},_isEmptyObject:function(e){return!e||"object"===Object(n.a)(e)&&0===Object.keys(e).length},_isFunction:function(e){return"function"===o._getType(e)},_isArray:function(e){return Array.isArray?Array.isArray(e):"array"===o._getType(e)},_isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},_getType:function(e){if(null===e)return"null";var t=o._class2type;if(!t){t=o._class2type={};for(var r=["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"],a=0,s=r.length;a<s;a++)t["[object "+r[a]+"]"]=r[a].toLowerCase()}var i=t.toString,u=Object(n.a)(e);return"object"===u||"function"===u?t[i.call(e)]||"object":u},_inArray:function(e,t,r){var n;if(t){var a=[].indexOf;if(a)return a.call(t,e,r);for(n=t.length,o._isNullOrUndefined(r)&&(r=0),r=r<0?Math.max(0,n+r):r;r<n;r++)if(r in t&&t[r]===e)return r}return-1},_merge:function(e,t){var r=t.length,n=e.length,o=0;if("number"===typeof r)for(;o<r;o++)e[n++]=t[o];else for(;void 0!==t[o];)e[n++]=t[o++];return e.length=n,e},_map:function(e,t,r){var n,a=0,s=e.length,i=[];if(o._isArraylike(e))for(;a<s;a++)null!==(n=t(e[a],a,r))&&(i[i.length]=n);else for(a in e)e.hasOwnProperty(a)&&null!==(n=t(e[a],a,r))&&(i[i.length]=n);return[].concat.apply([],i)},_extend:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,a,s,i,u,l,c=arguments[0]||{},d=1,f=arguments.length,h=!1;for("boolean"===typeof c&&(h=c,c=arguments[1]||{},d=2),"object"===Object(n.a)(c)||o._isFunction(c)||(c={}),f===d&&(c=this,--d);d<f;d++)if(u=arguments[d],!o._isNullOrUndefined(u))for(i in u)r=c[i],c!==(s=u[i])&&(a=o._isArray(s),h&&s&&(o._isPlainObject(s)||a)?(l=a?r&&o._isArray(r)?r:[]:r&&o._isPlainObject(r)?r:{},c[i]=o._extend(h,l,s)):void 0!==s&&(c[i]=s));return c},_inherit:function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n},_isWindow:function(e){return null!==e&&e===e.window},_isPlainObject:function(e){if(!e||"object"!==o._getType(e)||e.nodeType||o._isWindow(e))return!1;var t,r={}.hasOwnProperty;try{if(e.constructor&&!r.call(e,"constructor")&&!r.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}for(t in e);return void 0===t||r.call(e,t)},_isArraylike:function(e){if(o._isNullOrUndefined(e))return!1;var t=e.length,r=o._getType(e);return!o._isWindow(e)&&(!(1!==e.nodeType||!t)||("array"===r||"function"!==r&&(0===t||"number"===typeof t&&t>0&&t-1 in e)))},_makeArray:function(e,t){var r=t||[];return null!==e&&(o._isArraylike(Object(e))?o._merge(r,"string"===typeof e?[e]:e):[].push.call(r,e)),r},_isType:function(e,t){return o._isNullOrUndefined(e)?"null"===t:!!t&&(t instanceof Function&&e instanceof t||(Object(n.a)(e)===t||(!("function"!==t||!/^\s*\bfunction\b/.test(""+e))||(Object.prototype.toString.call(e).slice(8,-1).toLowerCase()===t.toLowerCase()||("DateTime"===t||"TimeSpan"===t?e instanceof Date:("string"===typeof t&&"undefined number boolean string".indexOf(t),!1))))))},_isNullOrUndefined:function(e){return void 0===e||null===e},_isNumber:function(e,t){var n=r("./src/core/feature/formula/lib/spreadjs/common/numHelper.js").default;return!!n._isValidCultureNumberString(e,t)&&(e=n._replaceCultureSymbolToNormal(e,t),o._isType(e,"number")||o._isType(e,"DateTime")||o._isType(e,"TimeSpan")||e&&!o._isType(e,"boolean")&&!isNaN(e)&&!isNaN(parseFloat(e))&&!(e.length>=2&&"0"===e[0]&&"x"===e[1]))},_toDouble:function(e){var t=r("./src/core/feature/formula/lib/spreadjs/common/dateTimeHelper.js").default;return o._isNullOrUndefined(e)||""===e?0:o._isType(e,"number")?e:o._isType(e,"string")&&!isNaN(e)?r("./src/core/feature/formula/lib/spreadjs/common/numHelper.js").default._parseLocale(e):o._isType(e,"boolean")?e?1:0:o._isType(e,"DateTime")?t._toOADate(e):o._isType(e,"TimeSpan")?Math.floor(t._toOADate(e)):parseFloat(e)},_cloneObject:function(e){if(!e)return e;if("number"===typeof e||"string"===typeof e||"boolean"===typeof e||o._isNullOrUndefined(e))return e;if(e.clone)return e.clone();if(e instanceof Date)return new Date(e);var t,r,a;for(r in t=e instanceof Object?new e.constructor:new e.constructor(e.valueOf()),e)e.hasOwnProperty(r)&&(a=e[r],e.hasOwnProperty(r)&&t[r]!==a&&("object"===Object(n.a)(a)?t[r]=o._cloneObject(a):t[r]=a));return t.toString=e.toString,t.valueOf=e.valueOf,t}};t.a=o},"./src/core/feature/formula/lib/utils.js":function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"i",(function(){return m})),r.d(t,"j",(function(){return p})),r.d(t,"c",(function(){return v})),r.d(t,"k",(function(){return y})),r.d(t,"C",(function(){return _})),r.d(t,"A",(function(){return b})),r.d(t,"z",(function(){return E})),r.d(t,"u",(function(){return j})),r.d(t,"t",(function(){return R})),r.d(t,"b",(function(){return S})),r.d(t,"g",(function(){return C})),r.d(t,"h",(function(){return T})),r.d(t,"d",(function(){return I})),r.d(t,"v",(function(){return N})),r.d(t,"l",(function(){return k})),r.d(t,"y",(function(){return M})),r.d(t,"B",(function(){return D}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.reduce.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.number.constructor.js"),r("../node_modules/core-js/modules/es.number.to-fixed.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/core-js/modules/es.string.trim.js");var n=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),o=r("../packages/model/src/utils/numberFormat/FormatParseEngine.ts"),a=r("./src/core/feature/formula/utils.ts"),s=r("../node_modules/decimal.js/decimal.js"),i=r.n(s),u=r("../node_modules/pinyin/lib/web-pinyin.js"),l=r.n(u),c=(r("./src/core/feature/formula/ast_node/index.ts"),r("./src/core/feature/formula/ast_node/utils.ts"));r.d(t,"p",(function(){return c.c})),r.d(t,"n",(function(){return c.b})),r.d(t,"r",(function(){return c.f})),r.d(t,"x",(function(){return c.l})),r.d(t,"m",(function(){return c.a})),r.d(t,"o",(function(){return a.x})),r.d(t,"q",(function(){return a.y})),r.d(t,"s",(function(){return a.B})),r.d(t,"w",(function(){return a.H})),r.d(t,"f",(function(){return a.i})),r.d(t,"e",(function(){return a.f}));var d=!1;function f(e){return e&&e.reduce?e.reduce((function(e,t){var r=Array.isArray(e),n=Array.isArray(t);return r&&n?(e=e.concat(),t=t.concat(),e.concat(t)):r?((e=e.concat()).push(t),e):n?(t=t.concat(),[e].concat(t)):[e,t]})):e}function h(e){if(!e)return!1;for(var t=0;t<e.length;++t)if(Array.isArray(e[t]))return!1;return!0}function m(){for(var e=g.apply(null,arguments);!h(e);)e=f(e);return e}function p(e){for(var t=e[0],r=[],n=t.length,o=t[0].length,a=0;a<o;a++)for(var s=0;s<n;s++)r.push(t[s][a]);return r}function v(e){return Array.isArray(e)&&e.length>0?e=v(e[0]):e}function g(e){return(t=e)&&"object"===Object(n.a)(t)&&isFinite(t.length)&&t.length>=0&&t.length===Math.floor(t.length)&&t.length<4294967296?Array.prototype.slice.call(e,0):[e];var t}function y(e,t){var r=e+t,n=r.toString();if(n.length<15||n.replace(/[^\d]/g,"").length<15)return r;var o=new i.a(e),a=new i.a(t),s=o.plus(a).toPrecision(15).toString();return parseFloat(s)}function _(e,t){var r=(t=t||{}).min,n=t.max,o=e.length,s="";return void 0!==r&&o<r&&(s=a.l.paramsLack),void 0!==n&&o>n&&(s=a.l.paramsOver),s}function b(e){if(void 0===e||""===e)return a.l.value;if("boolean"===typeof e)return+e;if(!isNaN(e))return parseFloat(e);if(/^(\d+\/\d+\/\d+|\d+\/\d+\/\d+\s*?\d+:\d+:\d+)$/.test(e)){var t=new Date(e+" 00:00:00 +0800"),r=new Date("1970/1/1 00:00:00 +0800");return(t.getTime()-r.getTime())/864e5+25568}if(/^\d+\/\d+\/\d+ \d+:\d+:\d+$/.test(e)){var n=new Date(e+" +0800"),o=new Date("1970/1/1 00:00:00 +0800");return(n.getTime()-o.getTime())/864e5+25568}return a.l.value}var A=new Date("1970/01/01 00:00:00");function E(e,t){var r=(t=t||{}).baseYear||1900;if(!isNaN(e)){if(e instanceof Date)return new Date(e);var n=parseInt(e,10);return 1900===r&&(n-=25567),n<-25567?a.l.num:new Date(A.getTime()+864e5*(n-1))}return"string"!==typeof e||(e=e.replace(/[\u5e74-]/,"/").replace(/[\u6708-]/,"/").replace(/[\u65e5-]/,""),e=new Date(e),isNaN(e))?a.l.value:e}function j(e){if(R(e))return!0;var t=E(e);return t instanceof Date&&(1900===t.getFullYear()&&t.getMonth()<2)}function R(e){return!("string"!==typeof e||!/1900(?:-|\/)0?2(?:-|\/)29/.test(e))||60===parseInt(e)}function S(){for(var e=arguments.length;e--;)if(Object(a.v)(arguments[e]))return!0;return!1}function C(e,t){var r=Object(n.a)(e),o=Object(n.a)(t);return r===o?"string"===r?T(e,t):e===t?0:e>t?1:-1:"boolean"===r||"string"===r&&"number"===o||null===t?1:-1}function T(e,t){if((e=e.toLowerCase())===(t=t.toLowerCase()))return 0;if(0===e.length||0===t.length)return e>t?1:-1;var r=O(e[0]),n=O(t[0]);if(1===(r^n))return r?-1:1;if(r&&n){var o=e.split("").reduce((function(e,t,r){return e.length!==r||O(t)&&(e="".concat(e).concat(t)),e}),""),a=t.split("").reduce((function(e,t,r){return e.length!==r||O(t)&&(e="".concat(e).concat(t)),e}),"");return o.length===e.length&&a.length===t.length?e>t?1:-1:o.length!==a.length?o>a?1:-1:o===a?T(e.replace(o,""),t.replace(a,"")):o>a?1:-1}if("a".localeCompare("z")==="z".localeCompare("a")){var s={style:1,segment:!1,heteronym:!1},i=l.a.convert(e,s),u=l.a.convert(t,s);return String(i)>String(u)?1:-1}var c=l.a.compare(e,t);return 0===c?e>t?1:-1:c/Math.abs(c)}function w(e){return e<=127}function O(e){var t=e.charCodeAt(0);if(!w(t))return!1;var r=32|t;return r>=97&&r<=122}function I(e){return"boolean"===typeof e&&(e=e?1:0),e}function N(e,t){return!Object(c.c)(t)&&"string"===typeof e&&""===e.trim()}function k(e,t){var r="";return"string"===typeof e&&!Object(c.l)(t)&&(Object(c.c)(t)||Object(c.f)(t)||Object(c.e)(t))&&(r=e.toLowerCase()),"true"===r||"false"===r}function M(e,t,r){return k(e,t)?(e=e.toLowerCase(),r?"true"===e?1:0:"true"===e):e}function D(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("number"===typeof e)return e;if(!r&&N(e,t))throw new Error(a.l.value);return"string"===typeof(e=M(e,t,!0))&&(e=(e=Object(o.parseValue)(e)).numericValue),e}},"./src/core/feature/formula/mutationUtil.ts":function(e,t,r){"use strict";r.d(t,"b",(function(){return u})),r.d(t,"a",(function(){return l}));var n=r("../packages/model/src/cell/CellDataDelta.ts"),o=r("../packages/model/src/cell/CellDataSlot.ts"),a=r("../packages/model/src/cell/CellFormatSlot.ts"),s=r("../packages/model/src/cell/CellFormatDelta.ts"),i=r("../packages/mutation/src/cell/SetCellPropertiesMutation.ts");function u(e){var t=l(e);return new i.a({gridRange:e.gridRange,cellDataDelta:t})}function l(e){var t=new n.a;if(null===e.effectiveValue?t.clearSlot(o.b.SLOT_EFFIECTIVE_VALUE):"undefined"!==typeof e.effectiveValue&&t.setSlot(o.b.SLOT_EFFIECTIVE_VALUE,e.effectiveValue),"undefined"!==typeof e.userEnteredNumberFormat){var r=new s.a;null===e.userEnteredNumberFormat?r.clearSlot(a.b.NUMBER_FORMAT):r.setSlot(a.b.NUMBER_FORMAT,e.userEnteredNumberFormat),t.setSlot(o.b.SLOT_USER_ENTERED_FORMAT_DELTA,r)}if("undefined"!==typeof e.effectiveFormatNumberFormat){var i=new s.a;null===e.effectiveFormatNumberFormat?i.clearSlot(a.b.NUMBER_FORMAT):i.setSlot(a.b.NUMBER_FORMAT,e.effectiveFormatNumberFormat),t.setSlot(o.b.SLOT_EFFIECTIVE_FORMAT_DELTA,i)}return null===e.formula?t.clearSlot(o.b.SLOT_FORMULA):"undefined"!==typeof e.formula&&t.setSlot(o.b.SLOT_FORMULA,e.formula),t}},"./src/core/feature/formula/report.ts":function(e,t,r){"use strict";r.d(t,"d",(function(){return B})),r.d(t,"j",(function(){return H})),r.d(t,"n",(function(){return V})),r.d(t,"m",(function(){return W})),r.d(t,"f",(function(){return Y})),r.d(t,"l",(function(){return z})),r.d(t,"e",(function(){return K})),r.d(t,"k",(function(){return Q})),r.d(t,"c",(function(){return X})),r.d(t,"o",(function(){return J})),r.d(t,"p",(function(){return $})),r.d(t,"g",(function(){return Z})),r.d(t,"a",(function(){return te})),r.d(t,"h",(function(){return re})),r.d(t,"b",(function(){return oe})),r.d(t,"i",(function(){return ae}));r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.reduce.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.object.assign.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n,o=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=r("../packages/report/src/index.ts"),s=r("./src/base/index.ts"),i=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),u=r.n(i);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){Object(o.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var d,f=window,h=f.location.href.indexOf("showLog=1")>=0;!function(e){e.PC="PC",e.ANDROID="Android",e.IOS="IOS"}(d||(d={})),f.formulaReportInfo={},f.allFormulaReportInfo={};var m,p,v=90,g=91,y=92,_=93,b=94,A=95,E=96,j=109,R=110,S=111,C=112,T=113,w=103,O=104,I=105,N=106,k=107,M=108,D=48,x={90:"INIT_KEYFRAME_PARSE",91:"INIT_GRAPH_AND_CALC",92:"INIT_GRAPH",93:"INIT_CALC",94:"INIT_SORT",95:"INIT_PARSE",96:"INIT_RUN",109:"INIT_INHERIT_FORMA",110:"INIT_FORMAT",111:"INIT_SYNCMUTATION",112:"INIT_RESULTTOSPREADSHEET",113:"INIT_SYNCRANGERESULT"},F=(n={},Object(o.a)(n,v,"[\u6253\u5f00][\u51fd\u6570][worker]keyframe\u89e3\u6790\u6784\u56fe\u65f6\u95f4"),Object(o.a)(n,g,"[\u6253\u5f00][\u51fd\u6570][worker]\u51fd\u6570\u6a21\u5757\u603b\u65f6\u95f4"),Object(o.a)(n,y,"[\u6253\u5f00][\u51fd\u6570][worker]\u4f9d\u8d56\u56fe\u6784\u5efa\u65f6\u95f4"),Object(o.a)(n,_,"[\u6253\u5f00][\u51fd\u6570][worker]\u51fd\u6570\u8ba1\u7b97\u65f6\u95f4"),Object(o.a)(n,b,"[\u6253\u5f00][\u51fd\u6570][worker]\u76ee\u6807\u8282\u70b9\u6392\u5e8f\u65f6\u95f4"),Object(o.a)(n,A,"[\u6253\u5f00][\u51fd\u6570][worker]\u51fd\u6570\u89e3\u6790\u65f6\u95f4"),Object(o.a)(n,E,"[\u6253\u5f00][\u51fd\u6570][worker]\u51fd\u6570\u8fd0\u884c\u65f6\u95f4"),Object(o.a)(n,w,"[\u7f16\u8f91][\u51fd\u6570][worker]\u6536\u5230mutation\u5230\u7ed3\u675f"),Object(o.a)(n,O,"[\u7f16\u8f91][\u51fd\u6570][worker]\u5355\u6279\u6b21\u8ba1\u7b97\u65f6\u95f4"),Object(o.a)(n,I,"[\u7f16\u8f91][\u51fd\u6570][worker]\u5355\u6279\u6b21\u56fe\u66f4\u65b0\u65f6\u95f4"),Object(o.a)(n,N,"[\u7f16\u8f91][\u51fd\u6570][worker]\u5355\u6279\u6b21\u51fd\u6570\u89e3\u6790\u65f6\u95f4"),Object(o.a)(n,k,"[\u7f16\u8f91][\u51fd\u6570][worker]\u5355\u4e2a\u51fd\u6570\u89e3\u6790\u65f6\u95f4"),Object(o.a)(n,M,"[\u7f16\u8f91][\u51fd\u6570][worker]\u5355\u4e2a\u51fd\u6570\u8fd0\u884c\u65f6\u95f4"),Object(o.a)(n,D,"[\u7f16\u8f91][\u51fd\u6570]\u5173\u952e\u51fd\u6570calculateSingleCellFormula"),Object(o.a)(n,j,"[\u6253\u5f00][\u51fd\u6570][worker]\u51fd\u6570\u683c\u5f0f\u7ee7\u627f\u65f6\u95f4"),Object(o.a)(n,R,"[\u6253\u5f00][\u51fd\u6570][worker]\u51fd\u6570\u7ed3\u679c\u683c\u5f0f\u5316\u65f6\u95f4"),Object(o.a)(n,S,"[\u6253\u5f00][\u51fd\u6570][worker]\u51fd\u6570\u6570\u636e\u5e8f\u5217\u5316\u548c\u540c\u6b65\u7ed9\u4e3b\u7ebf\u7a0b\u65f6\u95f4"),Object(o.a)(n,C,"[\u6253\u5f00][\u51fd\u6570][worker]\u51fd\u6570\u7ed3\u679c\u66f4\u65b0\u5230\u6570\u636e\u5c42\u65f6\u95f4"),Object(o.a)(n,T,"[\u6253\u5f00][\u51fd\u6570][worker]\u51fd\u6570\u7ed3\u679c\u901a\u8fc7setRange\u8fdb\u884c\u540c\u6b65\u7684\u65f6\u95f4"),n),P={mutationSubscribeTime:0,generateFromKeyFrameStart:0,generateFromKeyFrameEnd:0,calculateSingleStart:0,mutationsCount:0},L={},U={};function B(e){return void 0===L[e]&&(L[e]={asyncFormulaCount:0,formulaCount:0,calculateCount:0,nodeSortDuration:0,parseDuration:0,calculateDuration:0,calculateSingleDuration:0,inheritFormatDuration:0,formatDuration:0,syncMutationDuration:0,resultToSpreadsheetDuration:0,syncRangeResultDuration:0}),L[e]}function H(e,t){void 0===L[e]&&(L[e]={asyncFormulaCount:0,formulaCount:0,calculateCount:0,nodeSortDuration:0,parseDuration:0,calculateDuration:0,calculateSingleDuration:0,inheritFormatDuration:0,formatDuration:0,syncMutationDuration:0,resultToSpreadsheetDuration:0,syncRangeResultDuration:0}),L[e]=c(c({},L[e]),t)}function G(e){delete L[e]}function V(e,t){U[e]=t}function W(){m=Date.now()}function Y(){return m}function z(){p=Date.now()}function K(){return p}function q(e){s.a.util.timer.wait(0).run((function(){a.b.huatuo({appid:20533,flag1:22213,flag2:1,flag3:1,speedTime:e,platform:u.a.isMobilePhone||u.a.isAndroidPad?u.a.isAndroid?d.ANDROID:d.IOS:d.PC},!0),Object.keys(e).forEach((function(t){var r=x[t];r&&(r=r.toLocaleLowerCase(),a.b.tdwReport({opername:"excel_performance",module:"formula_worker",action:r,ver5:e[t]}))})),h&&Object.keys(e).forEach((function(t){console.warn("%c".concat(F[t],": ").concat(e[t]),"color: green; font-size: 14px;")}))}))}function Q(e){P.mutationSubscribeTime=e||Date.now()}function X(){var e=P.mutationSubscribeTime;return P.mutationSubscribeTime=0,e}function J(e){var t=e.mutationSubscribeTime,r=e.isInitSheet;if(e.isAfterMutationRun&&!r&&(P.mutationsCount=P.mutationsCount+1,!(P.mutationsCount>=2)&&0!==t)){var n=Date.now()-t;q(Object(o.a)({},I,n))}}function $(e){var t=e.calculateDuration,r=e.graphUpdateTimes,n=e.isInitSheet,a=e.mutationSubscribeTime,s=e.isAfterMutationRun;try{if(n)return;if(!s)return void G(r);if(P.mutationsCount>=2)return void(P.mutationsCount=P.mutationsCount-1);P.mutationsCount=P.mutationsCount-1;var i=B(r);if(i.asyncFormulaCount>0)return void G(r);if(i.calculateCount>0){var u=i.parseDuration/i.calculateCount,l=i.calculateDuration/i.calculateCount,c=i.calculateSingleDuration/i.calculateCount;q(Object(o.a)({},k,u)),q(Object(o.a)({},M,l)),q(Object(o.a)({},D,c))}if(q(Object(o.a)({},N,i.parseDuration)),q(Object(o.a)({},O,t)),0!==a){var d=Date.now()-a;q(Object(o.a)({},w,d))}G(r)}catch(f){return}}function Z(e){var t,r=e.hasFormula,n=e.graphAndCalculateDuration,s=e.buildGraphDuration,i=e.calculateDuration,u=e.sheetId,l=U[u];if(l)if(r){var c,d=B(l);if(0===d.asyncFormulaCount)q((c={},Object(o.a)(c,g,n),Object(o.a)(c,_,i),c)),f.formulaReportInfo["[\u51fd\u6570]\u51fd\u6570\u6a21\u5757\u603b\u65f6\u95f4"]=n,f.formulaReportInfo["[\u51fd\u6570]\u51fd\u6570\u8ba1\u7b97\u65f6\u95f4"]=i,f.allFormulaReportInfo["[\u51fd\u6570]\u51fd\u6570\u6a21\u5757\u603b\u65f6\u95f4"]=n+(f.allFormulaReportInfo["[\u51fd\u6570]\u51fd\u6570\u6a21\u5757\u603b\u65f6\u95f4"]||0),f.allFormulaReportInfo["[\u51fd\u6570]\u51fd\u6570\u8ba1\u7b97\u65f6\u95f4"]=i+(f.allFormulaReportInfo["[\u51fd\u6570]\u51fd\u6570\u8ba1\u7b97\u65f6\u95f4"]||0);if(q((t={},Object(o.a)(t,y,s),Object(o.a)(t,b,d.nodeSortDuration),Object(o.a)(t,A,d.parseDuration),Object(o.a)(t,E,d.calculateDuration),Object(o.a)(t,j,d.inheritFormatDuration),Object(o.a)(t,R,d.formatDuration),Object(o.a)(t,S,d.syncMutationDuration),Object(o.a)(t,C,d.resultToSpreadsheetDuration),Object(o.a)(t,T,d.syncRangeResultDuration),t)),f.formulaReportInfo["[\u51fd\u6570]\u4f9d\u8d56\u56fe\u6784\u5efa\u65f6\u95f4"]=s,f.formulaReportInfo["[\u51fd\u6570]\u76ee\u6807\u8282\u70b9\u6392\u5e8f\u65f6\u95f4"]=d.nodeSortDuration,f.formulaReportInfo["[\u51fd\u6570]\u51fd\u6570\u89e3\u6790\u65f6\u95f4"]=d.parseDuration,f.formulaReportInfo["[\u51fd\u6570]\u51fd\u6570\u8fd0\u884c\u65f6\u95f4"]=d.calculateDuration,f.allFormulaReportInfo["[\u51fd\u6570]\u4f9d\u8d56\u56fe\u6784\u5efa\u65f6\u95f4"]=(f.allFormulaReportInfo["[\u51fd\u6570]\u4f9d\u8d56\u56fe\u6784\u5efa\u65f6\u95f4"]||0)+s,f.allFormulaReportInfo["[\u51fd\u6570]\u76ee\u6807\u8282\u70b9\u6392\u5e8f\u65f6\u95f4"]=d.nodeSortDuration+(f.allFormulaReportInfo["[\u51fd\u6570]\u76ee\u6807\u8282\u70b9\u6392\u5e8f\u65f6\u95f4"]||0),f.allFormulaReportInfo["[\u51fd\u6570]\u51fd\u6570\u89e3\u6790\u65f6\u95f4"]=d.parseDuration+(f.allFormulaReportInfo["[\u51fd\u6570]\u51fd\u6570\u89e3\u6790\u65f6\u95f4"]||0),f.allFormulaReportInfo["[\u51fd\u6570]\u51fd\u6570\u8fd0\u884c\u65f6\u95f4"]=d.calculateDuration+(f.allFormulaReportInfo["[\u51fd\u6570]\u51fd\u6570\u8fd0\u884c\u65f6\u95f4"]||0),0===d.asyncFormulaCount){!function(e){e.graphAndCalculateDuration;var t=e.buildGraphDuration,r=e.calculateDuration,n=0;t>=4e3?n=33614222:t>=3e3?n=33614223:t>=2e3?n=33614234:t>=1e3&&(n=33614235);0!==n&&a.b.monitor(n);var o=0;r>=4e3?o=33614569:r>=3e3?o=33614570:r>=2e3?o=33614572:r>=1e3&&(o=33614574);0!==o&&a.b.monitor(o)}({graphAndCalculateDuration:n,buildGraphDuration:s,calculateDuration:i});var h={graphAndCalculateDuration:n,buildGraphDuration:s,calculateDuration:i,formulaCount:d.formulaCount,calculateCount:d.calculateCount,nodeSortDuration:d.nodeSortDuration,parseDuration:d.parseDuration,calculateSingleDuration:d.calculateSingleDuration,inheritFormatDuration:d.inheritFormatDuration,formatDuration:d.formatDuration,syncMutationDuration:d.syncMutationDuration,resultToSpreadsheetDuration:d.resultToSpreadsheetDuration,syncRangeResultDuration:d.syncRangeResultDuration};!function(e){var t=e.graphAndCalculateDuration,r=e.buildGraphDuration,n=e.calculateDuration,o=e.formulaCount,s=e.calculateCount,i=e.nodeSortDuration,u=e.parseDuration,l=e.calculateSingleDuration,c=e.inheritFormatDuration,d=e.formatDuration,f=e.syncMutationDuration,h=e.resultToSpreadsheetDuration,m=e.syncRangeResultDuration;a.b.tdwReport({opername:"doc_excel",module:"formula_worker",action:"formula_sheet_open",ver5:JSON.stringify({graphAndCalculateDuration:t,buildGraphDuration:r,calculateDuration:n,formulaCount:o,calculateCount:s,nodeSortDuration:i,parseDuration:u,calculateSingleDuration:l,inheritFormatDuration:c,formatDuration:d,syncMutationDuration:f,resultToSpreadsheetDuration:h,syncRangeResultDuration:m})})}(h),Object.assign(f.formulaReportInfo,h),Object.keys(h).forEach((function(e){Object.prototype.hasOwnProperty.call(h,e)&&(f.allFormulaReportInfo[e]=h[e]+(f.allFormulaReportInfo[e]||0))}))}G(l)}else G(l)}var ee={};function te(e,t){ee[e]&&Object.prototype.hasOwnProperty.call(ee,e)?ee[e].push(t):ee[e]=[t]}function re(e){var t=e.isInitSheet,r=Object.keys(ee);if(0!==r.length){var n=r.reduce((function(e,t){return e[t]=ee[t].length,e}),{});r.forEach((function(e){ee[e].length>2&&(ee[e]=ee[e].slice(0,2))})),a.b.tdwReport({opername:"doc_excel",module:"formula_worker",action:"error_type_new",ver5:JSON.stringify({reportFormulaError:ee,isInitSheet:t,errorTypeCount:n})}),ee={}}}var ne=[];function oe(e){ne.push(e)}function ae(e){var t=e.isInitSheet,r=ne.length;0!==r&&(r>10&&(ne=ne.slice(0,10)),a.b.tdwReport({opername:"doc_excel",module:"formula_worker",action:"parser_error",ver5:JSON.stringify({reportFormulaParserError:ne,isInitSheet:t,reportLength:r})}),ne=[])}},"./src/core/feature/formula/type.ts":function(e,t,r){"use strict";r.d(t,"c",(function(){return n})),r.d(t,"d",(function(){return o})),r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s})),r.d(t,"e",(function(){return i}));var n,o,a,s,i;r("../node_modules/core-js/modules/es.function.name.js");!function(e){e.CELL="CELL",e.SHEET_RANGE="SHEET_RANGE",e.CELL_RANGE="CELL_RANGE",e.STATIC_RANGE="STATIC_RANGE",e.POSITION_RELY="POSITION_RELY",e.CUSTOM_NODE="CUSTOM_NODE"}(n||(n={})),function(e){e.UNLOAD="UNLOAD",e.LOADED="LOADED",e.DYE="DYE",e.SEARCH="SEARCH",e.CYCLE="CYCLE"}(o||(o={})),function(e){e.FORMULA="FORMULA",e.CONST="CONST"}(a||(a={})),function(e){e.customTypeFormulaModelChange="customTypeFormulaModelChange",e.customTypeResultChange="customTypeResultChange"}(s||(s={})),function(e){e.null="#NULL!",e.div0="#DIV/0!",e.value="#VALUE!",e.ref="#REF!",e.circle="#CIRCLE!",e.name="#NAME?",e.num="#NUM!",e.na="#N/A",e.error="#ERROR!",e.data="#GETTING_DATA",e.paramsErr="#PARAMS!",e.paramsLack="#PARAMS_LACK",e.paramsOver="#PARAMS_OVER",e.needUpdate="#NEED_UPDATE"}(i||(i={}))},"./src/core/feature/formula/utils.ts":function(e,t,r){"use strict";r.d(t,"n",(function(){return m.a})),r.d(t,"C",(function(){return m.b})),r.d(t,"g",(function(){return p})),r.d(t,"d",(function(){return A})),r.d(t,"E",(function(){return E})),r.d(t,"J",(function(){return R})),r.d(t,"K",(function(){return S})),r.d(t,"u",(function(){return w})),r.d(t,"F",(function(){return O})),r.d(t,"Q",(function(){return I})),r.d(t,"N",(function(){return N})),r.d(t,"P",(function(){return k})),r.d(t,"f",(function(){return M})),r.d(t,"q",(function(){return D})),r.d(t,"i",(function(){return x})),r.d(t,"e",(function(){return F})),r.d(t,"h",(function(){return P})),r.d(t,"O",(function(){return L})),r.d(t,"t",(function(){return U})),r.d(t,"k",(function(){return B})),r.d(t,"R",(function(){return H})),r.d(t,"r",(function(){return G})),r.d(t,"c",(function(){return W})),r.d(t,"l",(function(){return Y})),r.d(t,"p",(function(){return K})),r.d(t,"v",(function(){return q})),r.d(t,"b",(function(){return Q})),r.d(t,"a",(function(){return X})),r.d(t,"M",(function(){return $})),r.d(t,"L",(function(){return ee})),r.d(t,"o",(function(){return te})),r.d(t,"j",(function(){return re})),r.d(t,"s",(function(){return ne})),r.d(t,"I",(function(){return oe})),r.d(t,"x",(function(){return ae})),r.d(t,"y",(function(){return se})),r.d(t,"D",(function(){return ie})),r.d(t,"H",(function(){return ue})),r.d(t,"B",(function(){return le})),r.d(t,"G",(function(){return ce})),r.d(t,"A",(function(){return de})),r.d(t,"m",(function(){return he})),r.d(t,"w",(function(){return me})),r.d(t,"z",(function(){return pe}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.every.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.includes.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/es.array.last-index-of.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.function.name.js"),r("../node_modules/core-js/modules/es.number.constructor.js"),r("../node_modules/core-js/modules/es.number.parse-int.js"),r("../node_modules/core-js/modules/es.number.to-fixed.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.object.values.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/core-js/modules/es.regexp.constructor.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.match.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),o=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),a=r("../packages/model/src/cell/ExtendedValueType.ts"),s=r("../packages/model/src/cell/ErrorType.ts"),i=(r("../packages/model/src/cell/ErrorValue.ts"),r("../packages/model/src/utils/numberFormat/FormatParseEngine.ts")),u=r("../packages/model/src/range/hexRangeUtils.ts"),l=r("../node_modules/axios/index.js"),c=r.n(l),d=(r("../node_modules/nanoid/generate.js"),r("./src/core/feature/formula/ast_node/utils.ts")),f=r("./src/core/feature/formula/type.ts"),h=r("./src/core/feature/formula/ast_node/NODE_TYPE.ts"),m=r("./src/core/feature/formula/UIUtils.ts");r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");function p(e,t){var r=e.sheetManager.getSheetBySheetId(t),n=function(e){var t=!1,r=!1;if(e)for(var n=e.getRowCount(),o=e.getColCount(),a=0;a<n&&(!t||!r);a++){var s=e.data.rowData[a];if(s)for(var i=0;i<o;i++){var u;if(t&&r)break;var l=s.values[i];l&&(t=t||Object(m.b)(l.getEditValue()),r=r||!!(null===(u=l.getUserEnteredFormat())||void 0===u?void 0:u.getDataValidation()))}}return{hasFormula:t,hasDataValidation:r}}(r),o=n.hasFormula,a=n.hasDataValidation,s=!!r&&r.conditionalFormatRuleManager.rules.length>0,i=function(e,t){var r=!1;e.size>0&&e.forEach((function(e){r||e.range&&e.range.sheetId===t&&(r=!0)}));return r}(e.workbookRangeManager.chartWorkbookRangeMap,t);return{hasFormula:o,hasDataValidation:a,hasChart:i,hasConditionalFormat:s,needLoadInWorker:o||a||i||s}}r("../packages/model/src/factory/index.ts"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.find.js"),r("../node_modules/core-js/modules/es.array.find-index.js");var v=r("./src/core/feature/formula/func-config.ts");function g(e,t,r){var n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(e+="").replace(/-/gi,"")}(r),o=[];return e.slice(-t.length).forEach((function(e,r){var a=e;if(Object(d.m)(e)&&Object(d.j)(e.originValueNode)){var s=e.originValueNode.args.find((function(e){return Object(d.c)(e)||Object(d.f)(e)}));s&&(a=s)}if(Object(d.c)(a))o.push({customTypeId:n,row:a.row,col:a.col,sheetId:a.sheetId,graphNodeId:D(a.row,a.col,a.sheetId),value:t[r][0]});else if(Object(d.f)(a)){var i,u=a.scope,l=u.row,c=void 0===l?0:l,f=u.col,m=void 0===f?0:f,p=t[r].length,v=a.scope,g=v.rowCount,y=void 0===g?0:g,_=v.colCount,b=void 0===_?0:_;a.cellRangeType===h.b.COL&&(y=p/b),a.cellRangeType===h.b.ROW&&(b=p/y);var A=a.startSheetId,E=null===(i=SpreadsheetApp.spreadsheet)||void 0===i?void 0:i.sheetManager.getSheetBySheetId(A);E&&(y=Math.min(y,E.getRowCount()),b=Math.min(b,E.getColCount()));for(var j=0,R=c;R<c+y;R++)for(var S=m;S<m+b;S++)o.push({customTypeId:n,row:R,col:S,sheetId:a.sheetIds[0],graphNodeId:D(R,S,a.sheetIds[0]),value:t[r][j]}),j+=1}})),o.filter((function(e,t,r){return r.findIndex((function(t){return t.graphNodeId===e.graphNodeId}))===t}))}var y=[1,26,676],_=[1,10,100,1e3,1e4,1e5,1e6,1e6];function b(e){return e<=127}var A=1048576;function E(e){var t=e.charCodeAt(0);return b(t)?t>=48&&t<=57:8===V[t]||10===V[t]}function j(e){var t=e.charCodeAt(0);return!function(e){return e<=255}(t)||(b(t)?(t|=32)>=96&&t<=122:0===V[t]||1===V[t])}var R=function(e){return!!e&&!!e.match(/ID\(|STOCK\(/gi)},S=function(e){return!!e&&/\#error|\#PARAMS_LACK|\#PARAMS_OVER/gi.test(e)};function C(e){return e<10?"0".concat(e):e}var T={};function w(e,t,r){var n=e,o={error:"#ERROR!",result:"#ERROR!",currencyFormat:""},a=(n=n.toString()).split("."),s=a[a.length-1]||"",i=s=s.toLowerCase(),u=a.slice(0,a.length-1).join(".")||"",l=s+u;-1!==["sh","sz"].indexOf(s)&&(s=""),function(e){if(T[e])return T[e];var t=c.a.get(e).then((function(t){return delete T[e],t})).catch((function(t){return delete T[e],t}));return T[e]=t,t}("/ifzq/appstock/app/".concat(s,"fqkline/get?param=").concat(l,",day,,,3,qfq")).then((function(e){var n=e.headers.date,a=e.data,s=n;try{var c=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e&&t)return new Date;var r=C(e.getMonth()+1),n=C(e.getDate()),o=[e.getFullYear(),r,n].join("-");return o}(s=s?new Date(s):new Date),d=a.data[l],f=d&&(d.qfqday||d.day),h=[];if(f&&f.length>=2&&(f.forEach((function(e){e[0]!==c&&h.push(e)})),h.length>1)){var m=h[h.length-1],p=h[h.length-2],v=(m[2]-p[2]).toFixed(2),g="".concat((v/p[2]*100).toFixed(2),"%"),y="";switch(i){case"sh":case"sz":y='"\xa5"#,##0.00_);[Red]\\("\xa5"#,##0.00\\)',/^(900)|^(20(0|1))/.test(u)&&(y="[$HK$-C04]#,##0.00_);[Red]\\([$HK$-C04]#,##0.00\\)");break;case"hk":y="[$HK$-C04]#,##0.00_);[Red]\\([$HK$-C04]#,##0.00\\)";break;case"us":y="\\$#,##0.00_);[Red]\\(\\$#,##0.00\\)";break;default:y="General"}var _={lastClosePrice:Number(m[2]),company:d.qt[l][1],risingPrice:Number(v),risingRate:fe(g),todayOpenDay:Number(m[1]),todayHighestPrice:Number(m[3]),todayLowestPrice:Number(m[4]),todayVolume:Number.parseInt(m[5],10),realTimePrice:Number(f[f.length-1][2])},b=[_.lastClosePrice,_.company,_.risingPrice,_.risingRate,_.todayOpenDay,_.todayHighestPrice,_.todayLowestPrice,_.todayVolume,_.realTimePrice];"undefined"!==typeof b[t]&&(o={error:null,result:b[t],currencyFormat:"General"},[0,2,4,5,6,8].includes(t)&&(o.currencyFormat=y),3===t&&"string"!==typeof _.risingRate&&(o.currencyFormat="0.00%"))}}catch(A){console.error("get stock data error!")}r(o)})).catch((function(){r(o)}))}function O(e){return!!e&&("object"===Object(o.a)(e)||"function"===typeof e)&&"function"===typeof e.then}!function(){var e,t,r;function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,r=e,n=t;return n=n||{"\uff1d":"=","\uff0c":",","\uff08":"(","\uff09":")"},Object.keys(n).forEach((function(e){var t=new RegExp(e,"g");r=r.replace(t,n[e])})),r}}();function I(e,t){return Object(u.colIndex2ColChar)(t)+(e+1)}function N(e){var t=e.lastIndexOf("!"),r=e;return t>-1&&(r=e.slice(t+1)),r}function k(e,t){var r,n,o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=null,i=0,u=function(){i=!1===a.leading?0:new Date,s=null,o=e.apply(r,n)};return function(){var l=new Date;i||!1!==a.leading||(i=l);var c=t-(l-i);r=this;for(var d=arguments.length,f=new Array(d),h=0;h<d;h++)f[h]=arguments[h];return n=f,c<=0?(clearTimeout(s),s=null,i=l,o=e.apply(r,n)):s||!1===a.trailing||(s=setTimeout(u,c)),o}}function M(e){for(var t=e.length,r={row:-1,col:-1},n=!1,o=!1,a=0;a<t;++a){var s=a,i=e[a],u=0;if(j(i)&&!n){do{(a+=1)<t&&(i=e[a])}while(a<t&&j(i));if(a-s>3)return{row:-1,col:-1};for(var l=a-1,c=l;c>=s;--c)u+=((32|e[c].charCodeAt(0))-96)*y[l-c];if(!(u<=16384))return{row:-1,col:-1};r.col=u-1,n=!0,a-=1}else{if(!E(i)||"0"===i||o){if("$"===i)continue;return{row:-1,col:-1}}do{(a+=1)<t&&(i=e[a])}while(a<t&&E(i));if(a-s>7)return{row:-1,col:-1};for(var d=a-1,f=0;d>=s;--d,++f)u+=(e[d].charCodeAt(0)-48)*_[f];u<=1048576&&(r.row=u-1),o=!0,a-=1}}return r}function D(e,t,r){var n=I(e,t);return n.indexOf("!")>-1?n:(n=n.toUpperCase(),"".concat(r,"!").concat(n))}function x(e){var t=e;"$"===t[0]&&(t=e.slice(1));var r,n=-1,o=0,a=t.length;do{r=t[n+=1]}while(n<a&&j(r));for(var s=n-1,i=s;i>=0;--i)o+=((32|t[i].charCodeAt(0))-96)*y[s-i];return o-1}function F(e,t,r){var n,o,a,s,i=e,u=t;switch(r){case h.b.NORMAL:var l=M(i),c=M(u),d=l.row,f=l.col,m=c.row,p=c.col;if(d>m){var v=[m,d];d=v[0],m=v[1]}if(f>p){var g=[p,f];f=g[0],p=g[1]}n=d,a=m-d+1,o=f,s=p-f+1;break;case h.b.ROW:"$"===i[0]&&(i=i.slice(1)),"$"===u[0]&&(u=u.slice(1));var y=Number(i),_=Number(u);if(y>_){var b=[_,y];y=b[0],_=b[1]}n=y-1,a=_-y+1,o=0,s=void 0;break;case h.b.COL:"$"===i[0]&&(i=i.slice(1)),"$"===u[0]&&(u=u.slice(1));var A=x(i),E=x(u);if(A>E){var j=[E,A];A=j[0],E=j[1]}n=0,a=void 0,o=A,s=E-A+1}return{row:n,col:o,rowCount:a,colCount:s}}function P(e){if(""===e)return e;var t=0,r=e.length;return"'"===e[0]&&(t+=1,r-=1),e.slice(t,r)}function L(e){if(-1===e.indexOf("$"))return parseInt(e,10)-1;var t=e;return t=t.replace(/\$/g,""),parseInt(t,10)-1}function U(e){var t=e.replace(/\$/g,""),r=t.match(/^([A-Za-z]+)(\d+)$/);if(!r)throw new Error("".concat(t," \u5e76\u4e0d\u662f\u4e00\u4e2a cellId"));var o=Object(n.a)(r,3),a=o[1];return{row:L(o[2]),col:x(a),isRowRelative:!/.+\$.+/.test(e),isColRelative:!/^\$/.test(e)}}function B(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(t){return setTimeout(t,e)}))}function H(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.pollingInterval,o=void 0===n?1e3:n;if(e())return t();setTimeout((function(){return H(e,t,{pollingInterval:o})}),o)}function G(e){if("string"===typeof e){var t=Object(i.parseValueWithStyle)(e);if(t)return{oriValue:e,result:t.value,format:t.numberFormat}}return{result:e}}var V=[14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,11,24,24,24,26,24,24,24,20,21,24,25,24,19,24,24,8,8,8,8,8,8,8,8,8,8,24,24,25,25,25,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,20,24,21,27,18,27,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,20,25,21,25,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,11,24,26,26,26,26,28,28,27,28,1,22,25,19,28,27,28,25,10,10,27,1,28,24,27,10,1,23,10,10,10,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,25,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,25,1,1,1,1,1,1,1,1],W={number:a.a.NUMBER,string:a.a.STRING,boolean:a.a.BOOL,error:a.a.ERROR},Y={null:f.e.null,div0:f.e.div0,value:f.e.value,ref:f.e.ref,circle:f.e.circle,name:f.e.name,num:f.e.num,na:f.e.na,error:f.e.error,data:f.e.data,paramsErr:f.e.paramsErr,paramsLack:f.e.paramsLack,paramsOver:f.e.paramsOver,needUpdate:f.e.needUpdate},z={};function K(e){var t=e;return q(t)||(t=Y.error),t}function q(e){return!("string"!==typeof e||!Object.prototype.hasOwnProperty.call(z,e))&&z[e]}Object.values(Y).forEach((function(e){z[e]=!0}));var Q={"#NULL!":s.a.NULL_VALUE,"#DIV/0!":s.a.DIVIDE_BY_ZERO,"#VALUE!":s.a.VALUE,"#REF!":s.a.REF,"#NAME?":s.a.NAME,"#NUM!":s.a.NUM,"#N/A":s.a.N_A,"#ERROR!":s.a.ERROR,"#NEED_UPDATE":s.a.LOADING},X={"#NULL":"\u7a7a\u503c\u9519\u8bef\u3002","#DIV/0!":"\u9664\u6570\u4e3a\u96f6\u3002","#VALUE!":"\u8ba1\u7b97\u503c\u9519\u8bef","#REF!":"\u4e0d\u5141\u8bb8\u5b58\u5728\u5faa\u73af\u5f15\u7528\u3002","#NAME?":"\u65e0\u6548\u7684\u8303\u56f4\u540d\u79f0\u3002","#NUM!":"\u6570\u503c\u9519\u8bef\u3002","#N/A":"\u53c2\u6570\u4e0d\u53ef\u4e3a\u7a7a\u3002","#ERROR!":"\u516c\u5f0f\u89e3\u6790\u9519\u8bef\u3002","#PARAMS!":"\u53c2\u6570\u8f93\u5165\u9519\u8bef\u3002","#PARAMS_LACK":"\u53c2\u6570\u4e2a\u6570\u4e0d\u8db3\u3002","#PARAMS_OVER":"\u53c2\u6570\u4e2a\u6570\u592a\u591a\u3002"},J=/^\s*$/;function $(e){if("string"===typeof e&&(n=e,!J.test(n))){var t=e.indexOf(".");if((-1===t?e.length:t)>=16)return e;var r=Number(e).valueOf();return isFinite(r)?r:e}var n;return e}var Z=["\u96f6","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d","\u4e03","\u516b","\u4e5d"];function ee(e){return e.toString().split("").map((function(e){return Z[parseInt(e,10)]})).join("")}function te(e,t,r){return e+(r?t:0)}function re(e,t,r){var a,s,i=t.error;if(Object(d.c)(e)&&e.body&&Object(d.j)(e.body)&&(s=e.body,void 0!==v.d[s.funcName])&&e.body&&Object(d.j)(e.body))return{result:a=g(e.body.args,t.result,e.cellId),error:i};if(Array.isArray(t.result))try{var u=Object(n.a)(t.result,1),l=Object(n.a)(u[0],1);a=Object(n.a)(l[0],1)[0]}catch(h){a=Y.value}else if(Object(d.a)(t.result)&&Object(d.c)(e)){try{var c=t.result;if(t.result.isCell){var f=c.toArray();a=Object(n.a)(f,1)[0]}else a=r(c,e.row,e.col)}catch(m){a="object"===Object(o.a)(m)?m.message:Y.error}null===a&&(a=0)}else a=t.result;return{result:a,error:i}}function ne(){var e=function(){},t=function(){};return{promise:new Promise((function(r,n){e=r,t=n})),resolve:e,reject:t}}function oe(e){return"[object Undefined]"===Object.prototype.toString.call(e)}function ae(e){var t=e;if("string"!==typeof t)return!1;var r=t.lastIndexOf("!");t=t.slice(r+1);return/^\$?([A-Za-z]{1,3})\$?([1-9][0-9]{0,5})$/g.test(t)}function se(e){var t=e.split(":");return 2===t.length&&t.every((function(e){return ae(e)}))}function ie(e){return"[object Null]"===Object.prototype.toString.call(e)}function ue(e){return/(^|!)\d+:\d+$/.test(e)}function le(e){return/(^|!)[A-Za-z]+:[A-Za-z]+$/.test(e)}function ce(e){return e===Y.ref}function de(e){return e===Y.circle}function fe(e){return/^-?\d+\.?\d*%$/.test(e)?parseFloat(e)/100:e}function he(e,t){var r=e;return"number"===typeof r&&r.toString().length>=t&&(r=r<1&&r>-1?+r.toFixed(t):+r.toPrecision(t)),r}function me(e){return/^=?(ASC|CLEAN|CONCAT|DBCS|DOLLAR|EXACT|FIXED|LEFT|LEFTB|LOWER|MID|MIDB|PROPER|REPLACE|REPLACEB|REPT|RIGHT|RIGHTB|SUBSTITUTE|TEXT|TEXTJOIN|TRIM|UPPER|USDOLLAR)\(.*\)$/i.test(e)}function pe(){return/Chrome/.test(navigator.userAgent)}},"./src/core/feature/formula/utils/parseUtil.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"c",(function(){return h})),r.d(t,"b",(function(){return m}));r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.string.trim.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n,o=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=r("./src/core/feature/formula/utils.ts"),s=r("./src/core/feature/formula/ast_node/utils.ts"),i=r("./src/core/feature/formula/ast_node/NODE_TYPE.ts"),u=r("../packages/model/src/cell/formula/CellRangeWithFixedInfo.ts"),l=r("../packages/model/src/cell/formula/FormulaModel.ts"),c=r("../packages/model/src/cell/index.ts"),d=[];function f(e){n=e,d.forEach((function(e){p(e)})),d=[]}function h(e,t,r,c){var d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},f=d.customGraphNodeId,h=n.parse,m=e.replace(/^=/,"").trim(),p=f||Object(a.q)(t,r,c),v=(Date.now(),h(m,{row:t,col:r,sheetId:c,id:p}));Date.now();if(Object(s.c)(v)){var g,y=(g={},Object(o.a)(g,i.a.CELL,(function(e,n,o){var i=n.cellId,l="",c="";Object(s.d)(n)&&(l=n.sheetId,c=n.sheetId);var d=Object(s.i)(n,o),f=Object(a.t)(i),h=f.row,m=f.col,p=f.isRowRelative,v=f.isColRelative,g=p?h-t:h,y=v?m-r:m;e.push(new u.a({startColIndex:y,endColIndex:y,startRowIndex:g,endRowIndex:g,isStartColRelative:v,isEndColRelative:v,isStartRowRelative:p,isEndRowRelative:p,isPositionRely:d,startSheetId:l,endSheetId:c}))})),Object(o.a)(g,i.a.CELL_RANGE,(function(e,n,o){var i=n.originValue,l=n.cellRangeType,c=n.start,d=n.end,f="",h="",m=Object(s.i)(n,o);if(Object(s.g)(n)&&(f=n.startSheetId,h=n.endSheetId),"COL"===l){var p=!/\$/.test(c),v=!/\$/.test(d),g=Object(a.i)(c)-(p?r:0),y=Object(a.i)(d)-(v?r:0);e.push(new u.a({startColIndex:g,endColIndex:y,startRowIndex:0,endRowIndex:0,isStartColRelative:p,isEndColRelative:v,isStartRowRelative:!0,isEndRowRelative:!0,isColArray:!0,isPositionRely:m,startSheetId:f,endSheetId:h}))}else if("ROW"===l){var _=!/\$/.test(c),b=!/\$/.test(d),A=Object(a.O)(c)-(_?t:0),E=Object(a.O)(d)-(b?t:0);e.push(new u.a({startColIndex:0,endColIndex:0,startRowIndex:A,endRowIndex:E,isStartColRelative:!0,isEndColRelative:!0,isStartRowRelative:_,isEndRowRelative:b,isRowArray:!0,isPositionRely:m,startSheetId:f,endSheetId:h}))}else if("NORMAL"===l){var j=Object(a.t)(c),R=j.row,S=j.col,C=j.isRowRelative,T=j.isColRelative,w=Object(a.t)(d),O=w.row,I=w.col,N=w.isRowRelative,k=w.isColRelative,M=Math.min(S,I),D=Math.max(S,I),x=Math.min(O,R),F=Math.max(R,O),P=C?x-t:x,L=T?M-r:M,U=N?F-t:F,B=k?D-r:D;e.push(new u.a({startColIndex:L,endColIndex:B,startRowIndex:P,endRowIndex:U,isStartColRelative:T,isEndColRelative:k,isStartRowRelative:C,isEndRowRelative:N,isPositionRely:m,startSheetId:f,endSheetId:h}))}else e.push(i)})),g),_=[];v.body&&(_=v.body.toFormulaModel(y));for(var b=[],A="=",E=0;E<_.length;E++){var j=_[E];j instanceof u.a?(""!==A&&(b.push(A),A=""),b.push(j)):A+=j,E===_.length-1&&""!==A&&b.push(A)}return new l.a({parts:b})}return new l.a({parts:[e]})}function m(e){var t=e.cellDataDelta;0!==(t.setSlots&1<<c.CELL_DATA_SLOT.SLOT_FORMULA)&&t.delta.formula&&(n?p(e):d.push(e))}function p(e){var t=e.cellDataDelta,r=e.spreadsheet,n=e.sheetId,o=e.rowIndex,a=e.colIndex,s=t.delta.formula,i=!1,u=!1;if(s.getParts().forEach((function(e){if("string"===typeof e){var t=e.toLowerCase();(t.indexOf("row")>-1||t.indexOf("offset")>-1)&&(i=!0)}else Array.isArray(e)&&e.isPositionRely&&(u=!0)})),i&&!u){var l,c=h(s.toString(5e3,5e3,r.sheetManager),5e3,5e3,"NOEXIST"),d=null===(l=r.sheetManager.getSheetBySheetId(n))||void 0===l?void 0:l.getCellDataAtPosition(o,a);d&&d.setFormula(c)}}},"./src/core/feature/smartSplit/utils.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r("../node_modules/@babel/runtime/helpers/esm/typeof.js");function o(e,t){var r=t;if("string"===typeof e)try{r=JSON.parse(e)}catch(o){}else"object"===Object(n.a)(e)&&(r=e);return r}},"./src/core/ui/alert/index.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"showAlert",(function(){return o}));var n=r("./src/core/ui/lazyLoad.ts"),o=function(e){Object(n.a)().then((function(t){new t.default(e).show()}))}},"./src/core/ui/dialog/index.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"DIALOG_TYPE",(function(){return l})),r.d(t,"DefaultButtons",(function(){return c})),r.d(t,"Custom_Dialog",(function(){return f})),r.d(t,"showDialog",(function(){return h})),r.d(t,"showDialog1",(function(){return m})),r.d(t,"showDialog2",(function(){return p})),r.d(t,"showDialog3",(function(){return v})),r.d(t,"showDialog4",(function(){return g})),r.d(t,"showDialog5",(function(){return y})),r.d(t,"showDialog6",(function(){return _})),r.d(t,"showMobileDialog1",(function(){return b})),r.d(t,"showMobileDialog2",(function(){return A})),r.d(t,"showMobileDialog3",(function(){return E})),r.d(t,"showMobileDialog4",(function(){return j})),r.d(t,"showMobileDialog5",(function(){return R})),r.d(t,"showMobileDialog6",(function(){return S})),r.d(t,"standardInformationDialogM",(function(){return C})),r.d(t,"dialog",(function(){return T})),r.d(t,"inputDialog",(function(){return w}));var n=r("./src/core/ui/alert/index.ts"),o=r("./src/core/ui/lazyLoad.ts"),a=r("./src/base/util/html.ts"),s=r("./src/base/event/event.ts"),i=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),u=r.n(i),l={Confirmation:"confirmation",Error:"error",Question:"question",Information:"information",StandardConfirm:"standardConfirm",Warning:"warning",Waiting:"waiting"},c={OK:"\u786e\u5b9a",Cancel:"\u53d6\u6d88"},d=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];Object(o.b)().then((function(t){t[e].apply(t,r)}))};function f(e,t){d("Custom_Dialog",e,t)}var h=function(e){d("showDialog",e)},m=function(e,t,r){d("showDialog1",e,t,r)};function p(e,t,r,n){d("showDialog2",e,t,r,n)}function v(e,t,r,n,o,a){d("showDialog3",e,t,r,n,o,a)}function g(e,t,r,n){d("showDialog4",e,t,r,n)}function y(e,t,r,n,o,a){d("showDialog5",e,t,r,n,o,a)}function _(e,t,r,n,o,a){d("showDialog6",e,t,r,n,o,a)}function b(e,t,r){d("showMobileDialog1",e,t,r)}function A(e,t,r,n){d("showMobileDialog2",e,t,r,n)}function E(e,t,r,n,o){d("showMobileDialog3",e,t,r,n,o)}function j(e,t,r,n){d("showMobileDialog4",e,t,r,n)}function R(e,t,r,n,o){d("showMobileDialog5",e,t,r,n,o)}function S(e,t,r,n,o){d("showMobileDialog6",e,t,r,n,o)}function C(e){d("standardInformationDialogM",e)}var T={delSheet:function(e,t,r){var o=t&&""!==t?t:"\u786e\u5b9a\u8981\u5220\u9664\u8be5\u5de5\u4f5c\u8868\u5417\uff1f\u5220\u9664\u540e\u5c06\u65e0\u6cd5\u6062\u590d\u3002";u.a.isMobilePhone||u.a.isAndroidPad||u.a.isIPad?Object(n.showAlert)({type:"MessageBox",title:"\u5220\u9664\u5de5\u4f5c\u8868",content:o,isAria:r,buttons:[{type:"default",label:"\u53d6\u6d88",onclick:function(e,t){e&&e.close()}},{type:"primary",label:"\u786e\u5b9a",onclick:function(t,r){e(),t&&t.close()}}]}):h({title:"\u5220\u9664\u5de5\u4f5c\u8868",content:o,cancelText:"\u53d6\u6d88",maskClosable:!1,onOk:function(){e()}})},info:function(e){u.a.isMobilePhone||u.a.isAndroidPad||u.a.isIPad?Object(n.showAlert)({type:"MessageBox",title:e.title,content:e.content?e.content:"",buttons:[{type:"primary",label:"\u786e\u5b9a",onclick:function(t,r){e.onOk&&e.onOk(r),t.close()}}]}):h(e),s.c.view.trigger("showInfoDialog")},alert:function(e,t,r){u.a.isMobilePhone||u.a.isAndroidPad||u.a.isIPad?Object(n.showAlert)({type:"MessageBox",title:e,content:t,buttons:[{type:"primary",label:"\u786e\u5b9a",onclick:function(e,t){r&&r(t),e.close()}}]}):p(e,t,"confirmation",r),s.c.view.trigger("showAlertDialog")},confirm:function(e){u.a.isMobilePhone||u.a.isAndroidPad||u.a.isIPad?Object(n.showAlert)({type:"MessageBox",title:e.title,content:e.content?e.content:"",onClose:e.onClose,buttons:[{type:"default",label:"\u53d6\u6d88",onclick:function(t,r){e.onCancel&&e.onCancel(r),t&&t.close()}},{type:"primary",label:"\u786e\u5b9a",onclick:function(t,r){e.onOk&&e.onOk(r),t&&t.close()}}]}):h(e),s.c.view.trigger("showConfirmDialog")},waiting:function(e,t){return u.a.isMobilePhone||u.a.isAndroidPad?f(e,{show_close_button:!1,overlay_close:!1,border_top:!1,buttons:!1,type:"waiting",overlay_class:"CustomDialogOverlay-Waiting",custom_class:"operate-waiting",only_mobile:!0,onClose:t}):f(e,{show_close_button:!1,overlay_close:!1,border_top:!1,buttons:!1,type:"waiting",overlay_class:"CustomDialogOverlay-Waiting",custom_class:"operate-waiting",onClose:t})},report:function(e,t,r,n,o){u.a.isMobilePhone||u.a.isAndroidPad?R(Object(a.c)(e),Object(a.c)(t),"confirmation",r,n):y(Object(a.c)(e),Object(a.c)(t),"confirmation",r,n,o)},tucao:function(e,t,r,n,o){u.a.isMobilePhone||u.a.isAndroidPad?S(Object(a.c)(e),Object(a.c)(t),"confirmation",r,n):_(Object(a.c)(e),Object(a.c)(t),"confirmation",r,n,o)}};function w(e){Object(o.b)().then((function(t){t.InputDialog.create(e)}))}},"./src/core/ui/lazyLoad.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return d})),r.d(t,"d",(function(){return f})),r.d(t,"e",(function(){return h}));r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/core-js/modules/es.array.find.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("./src/base/util/browser.ts"),s=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),i=r.n(s),u=function(){function e(t){Object(n.a)(this,e),this.buttonMenuDom=$(".hp-ui-button-menu"),this.menuDom=$(".hp-ui-button-menu-wrapper a"),this.type=t.type,this.title=t.title,this.content=t.content,this.inputMaxLength=t.inputMaxLength,this.inputOverflowTips=t.inputOverflowTips,this.buttons=t.buttons,this.onClose=t.onClose,this.dialogDom=null,this.dialogInputDom=null,this.dialogInputErrorDom=null,this.init()}return Object(o.a)(e,[{key:"createDom",value:function(e,t,r){var n=$(document.createElement(t));return n.addClass(r),e.append(n),n}},{key:"show",value:function(){var e=this;this.dialogDom=this.createDom($(document.body),"div","m-component-dialog"),this.dialogDom.on("touchmove",(function(e){e.preventDefault()})),this.createDom(this.dialogDom,"div","m-component-dialog-mask").on("touchstart touchend",(function(e){e.preventDefault()}));var t=this.createDom(this.dialogDom,"div","m-component-dialog-body"),r=this.createDom(t,"div","m-component-dialog-title");this.title&&this.title.length>0&&r.text(this.title),r.on("touchstart touchend",(function(e){e.preventDefault()}));var n=this.createDom(t,"div","m-component-dialog-content");if("InputBox"===this.type){t.addClass("m-component-dialog-body-input"),document.body.clientHeight<500&&(Object(a.d)()?t.css("top",96):t.css("top",72));var o=this.createDom(n,"div","m-component-dialog-input-box"),s=o[0].clientWidth-28;this.dialogInputDom=this.createDom(o,"input","m-component-dialog-input"),this.dialogInputDom.css("width",s),this.dialogInputDom.attr("spellcheck","false"),this.dialogInputDom.attr("required","required"),this.content&&this.content.length>0&&this.dialogInputDom.val(this.content),this.bindInputListener(this.dialogInputDom);var i=this.createDom(o,"div","m-component-dialog-input-clear");this.addTap(i,(function(){e.dialogInputDom.val(""),e.inputBoxValChange()})),this.dialogInputErrorDom=this.createDom(n,"div","m-component-dialog-input-error-hidden");var u=document.createElement("p");this.dialogInputErrorDom.append(u),n.append(this.dialogInputErrorDom)}else if(this.content&&this.content.length>0){this.createDom(n,"div","m-component-dialog-message").text(this.content)}for(var l=this.createDom(t,"div","m-component-dialog-footer"),c=0;c<this.buttons.length;c++){var d=this.buttons[c];if(d.label&&d.label.length>0){var f=$(document.createElement("a"));f.addClass("m-component-dialog-button");var h="m-component-dialog-btn-default";"primary"===d.type?h="m-component-dialog-btn-primary":"danger"===d.type&&(h="m-component-dialog-btn-danger"),f.addClass(h),f.text(d.label),l.append(f),this.bindButtonListener(f,d)}}"InputBox"===this.type&&this.focusInputBox()}},{key:"close",value:function(){var e;null===(e=this.onClose)||void 0===e||e.call(this),this.dialogDom.remove()}},{key:"getInputText",value:function(){return this.dialogInputDom.val()}},{key:"showInputErrorTips",value:function(e){this.dialogInputErrorDom.addClass("m-component-dialog-input-error"),this.dialogInputErrorDom.children("p").text(e),this.focusInputBox()}},{key:"checkInputError",value:function(){var e=!1;if(this.inputMaxLength&&this.inputMaxLength>0&&this.dialogInputDom.val().length>this.inputMaxLength){var t="\u8f93\u5165\u5185\u5bb9\u8fc7\u957f\u3002";this.inputOverflowTips&&this.inputOverflowTips.length>0&&(t=this.inputOverflowTips),this.showInputErrorTips(t),e=!0}return e}},{key:"focusInputBox",value:function(){var e=this;i.a.isIOS?this.dialogInputDom.focus():setTimeout((function(){e.dialogInputDom.focus().click()}),100)}},{key:"inputBoxValChange",value:function(){this.checkInputError()&&this.dialogInputErrorDom.removeClass("m-component-dialog-input-error")}},{key:"bindInputListener",value:function(e){var t=this;e.on("input propertychange change",(function(){t.inputBoxValChange()})),e.blur((function(){if(i.a.isIOS)for(var e=0;e<t.buttons.length;e++){var r=t.buttons[e];if("primary"===r.type){r.onclick&&"function"===typeof r.onclick&&r.onclick(t);break}}}))}},{key:"bindButtonListener",value:function(e,t){var r=this,n=!1,o=function(e){n||(n=!0,t.onclick&&"function"===typeof t.onclick?t.onclick(r,e):r.close())};e.on("touchend",o),e.on("click",o)}},{key:"addTap",value:function(e,t){e.on("touchstart",(function(e){var t=e.originalEvent.touches[0];this.touchX=t.clientX,this.touchY=t.clientY,this.touchT=Date.now()})),e.on("touchend",(function(e){e.preventDefault();var r=e.originalEvent.changedTouches[0],n=r.clientX,o=r.clientY;void 0===this.touchT||Date.now()>this.touchT+400||Math.abs(o-this.touchY)>30||Math.abs(n-this.touchX)>30||t()}))}},{key:"init",value:function(){var e=this;this.buttonMenuDom.on("click",(function(){var t=e.buttonMenuDom;if(!t.attr("disabled")){$("#tooltip").remove();var r=t.hasClass("hp-ui-button-menu-reverse"),n=t.find(".hp-ui-button-menu-wrapper"),o=t.find(".hp-ui-button-list-ul"),a=t.find(".hp-ui-button-list-ul li"),s=-1;if(t.data("close",e.buttonCloseMenu),n.is(":visible"))e.buttonCloseMenu(t);else{o.css("min-width","".concat(t.outerWidth(),"px")),n.show(),t.addClass("hp-ui-button-active");var i=Math.max(200,Math.min($("body").height()-o.offset().top-50,435));o.css("max-height","".concat(i,"px")),r&&o.css("top","-".concat(o.outerHeight()+t.outerHeight()+10,"px")),window.setTimeout((function(){$("body").on("keydown.hp-ui-button-menu",(function(r){if(n.is(":hidden"))return!0;var i=s;switch(r.keyCode){case 13:return o.find("li.hp-ui-button-menuitem-selected > a").trigger("click"),!1;case 27:return e.buttonCloseMenu(t),!1;case 38:s=s-1<0?a.length-1:s-1;break;case 40:s=(s+1)%a.length;break;default:return!0}return o.find("li:nth-child(".concat(i+1,")")).removeClass("hp-ui-button-menuitem-selected"),o.find("li:nth-child(".concat(s+1,")")).addClass("hp-ui-button-menuitem-selected"),!1})).on("click.hp-ui-button-menu",(function(){e.buttonCloseMenu(t)}))}),0)}}})),this.menuDom.on("click",(function(){if(!e.menuDom.hasClass("hp-ui-button-menu-disabled")){var t=e.menuDom.closest(".hp-ui-button");t.find(".hp-ui-button-menuitem-selected").removeClass("hp-ui-button-menuitem-selected"),e.buttonCloseMenu(t)}}))}},{key:"buttonCloseMenu",value:function(e){$("body").off(".hp-ui-button-menu"),e.find(".hp-ui-button-menu-wrapper").hide(),e.removeClass("hp-ui-button-active"),e.find(".hp-ui-button-menuitem-selected").removeClass("hp-ui-button-menuitem-selected"),e.trigger("menu-closed")}}]),e}(),l=function(){return Promise.resolve().then((function(){return{default:u}}))},c=function(){return r.e("bundle_ui_dialog").then(r.bind(null,"./src/core/ui/dialog/dialog.ts"))},d=function(){return r.e("bundle_ui_padmodal").then(r.bind(null,"./src/core/ui/modal/pad-modals.js"))},f=function(){return Promise.resolve().then(r.bind(null,"./src/core/ui/toast/toast.tsx"))},h=function(){return r.e("bundle_ui_tooltip").then(r.bind(null,"./src/core/ui/tooltip/tooltip.js"))}},"./src/core/ui/loading/index.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.includes.js"),r("../node_modules/core-js/modules/es.object.assign.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.string.includes.js"),r("../node_modules/regenerator-runtime/runtime.js");var n,o=r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),s=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=r("./src/core/view/spreadsheet-view/utils.ts");!function(e){e.CENTER="CENTER",e.LEFT="LEFT"}(n||(n={}));var u={LEFT:8},l=function(){function e(t){var r=this;Object(a.a)(this,e),this.translateX=0,this.translateY=0,this.show=Object(o.a)(regeneratorRuntime.mark((function e(){var t,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.app.feature.getCopyPasteBase();case 2:t=e.sent,o=(new t.CopyIconSource).iconsList.spinner,r.initPosition(),a=r.loadingAlign===n.LEFT?"".concat(u[r.loadingAlign],"px center"):"center center",Object.assign(r.loadingView.style,{position:"absolute",backgroundColor:"E2E2E2",borderColor:"#E2E2E2",zIndex:1,background:'url("'.concat(o,'") no-repeat'),backgroundPosition:a,display:"flex",alignItems:"center",justifyContent:"center"}),r.visibile=!0,r.valid=!0,r.loadingView.onclick=r.setInputEdit,r.container.appendChild(r.loadingView);case 11:case"end":return e.stop()}}),e)}))),this.hide=function(){r.visibile=!1,r.container.contains(r.loadingView)&&r.container.removeChild(r.loadingView),r.handleEvent(!1)},this.cancelUpload=function(){r.valid=!1,r.hide()},this.getPositionInfo=function(){return{row:r.row,col:r.col}},this.setVisible=function(){r.visibile=!0,r.loadingView.style.display="flex"},this.setHidden=function(){r.visibile=!1,r.loadingView.style.display="none"},this.toggleVisible=function(e){if(e===r.sheetId)return r.setVisible();r.setHidden()},this.handleEvent=function(e){var t=e?"on":"off",n=e?"listen":"remove",o=r.app.view.canvas,a=o.inputManager,s=o.areaData;a.emitter[t](a.EVENT.VALUE_CHANGE,r.cancelUpload),s.onUpdateOffset(r.updatePosition),r.app.event.sheetsBar[n]("switchSheet",r.toggleVisible)},this.setInputEdit=function(){var e=r.app.view.canvas.inputManager;e.handleEnterInput(r.row,r.col),e.focus()},this.initPosition=function(){var e=r.app.view.canvas,t=e.tableView,n=e.areaData,o=e.headSize,a=e.rowcolAccessor,s=e.clientRect,u=t.getCellViewAtPosition(r.row,r.col),l=r.col,c=r.row,d=Object(i.a)(a,u,r.row),f=Object(i.b)(a,u,r.col),h=n.getDisplayViewTopByRow(c);(null===u||void 0===u?void 0:u.mergeData)&&(c+=u.mergeData.rowCount-1);var m=n.getDisplayViewBottomByRow(c),p=s.height-o.displayColHeadHeight;r.loadingView.style.bottom="".concat(p-h,"px"),r.loadingView.style.top="".concat(m-d,"px");var v=n.getDisplayViewLeftByCol(l);r.loadingView.style.left="".concat(v,"px"),r.loadingView.style.width="".concat(f,"px"),r.loadingView.style.height="".concat(d,"px"),r.translateX=n.getDisplayViewLeftByCol(l),r.translateY=n.getDisplayViewTopByRow(c)},this.updatePosition=function(){var e=r.app.view.canvas,t=e.tableView,n=e.areaData,o=t.getCellViewAtPosition(r.row,r.col),a=r.col,s=r.row;(null===o||void 0===o?void 0:o.mergeData)&&(s+=o.mergeData.rowCount-1);var i=n.getDisplayViewLeftByCol(a),u=n.getDisplayViewTopByRow(s);r.loadingView.style.transform="translate(".concat(i-r.translateX,"px, ").concat(u-r.translateY,"px)")},this.app=t.app,this.container=t.app.view.canvas.mainBoard.element,this.row=t.row,this.col=t.col,this.sheetId=t.sheetId,this.visibile=!1,this.loadingView=document.createElement("div"),this.loadingView.id="loading-".concat(this.sheetId,"-").concat(this.row,"-").concat(this.col),this.loadingView.classList.add("copy-paste-loading"),this.loadingAlign=t.align,this.handleEvent(!0)}return Object(s.a)(e,[{key:"getLoadingView",value:function(){return this.loadingView}},{key:"isVisible",get:function(){return this.visibile}},{key:"isValid",get:function(){return this.valid}}]),e}(),c=function(){function e(){Object(a.a)(this,e)}return Object(s.a)(e,null,[{key:"createInstance",value:function(t,r,o,a){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n.CENTER,i=t.view.getSelection();if(null===i)return null;var u=new l({app:t,row:r,col:o,sheetId:a,align:s});return e.value["".concat(a,"-").concat(r,"-").concat(o)]=u}},{key:"getInstance",value:function(t,r,n){return e.value["".concat(n,"-").concat(t,"-").concat(r)]}},{key:"removeInstance",value:function(t,r,n){Object.keys(e.value).includes("".concat(n,"-").concat(t,"-").concat(r))&&delete e.value["".concat(n,"-").concat(t,"-").concat(r)]}}]),e}();c.value={},t.b=c},"./src/core/ui/toast/index.ts":function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"showVipToast",(function(){return i})),r.d(t,"initToast",(function(){return l})),r.d(t,"showToast",(function(){return c})),r.d(t,"hideToast",(function(){return d}));r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js");var n=r("./src/core/ui/lazyLoad.ts"),o=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),a=r.n(o),s=null;function i(t){return new Promise((function(r,n){var o,a;(null===(o=e.SLR)||void 0===o?void 0:o.assetLoaded)?u(t,r):null===(a=e.SLR)||void 0===a||a.listen("SL-INIT",(function(){u(t,r)}))}))}function u(t,r){if(s){var n=s.showToast(t);r(n)}else a.a.isMobilePhone||a.a.isAndroidPad||a.a.isIPad?e.SLR.load("VipToastMobile",(function(e){e.init();var n=(s=e.MobileVipToast).showToast(t);r(n)})):e.SLR.load("VipToast",(function(e){e.init();var n=(s=e.PcVipToast).showToast(t);r(n)}))}e.showVipToast=i;var l=n.d,c=function(e,t,r,o){Object(n.d)().then((function(n){n.showToast(e,t,r,o)}))},d=function(){Object(n.d)().then((function(e){e.hideToast()}))}}.call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/ui/toast/toast.tsx":function(e,t,r){"use strict";r.r(t),r.d(t,"hideToast",(function(){return l})),r.d(t,"showToast",(function(){return c})),r.d(t,"changeToastInnerText",(function(){return d}));r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.replace.js");var n=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),o=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),a=r.n(o),s=r("../node_modules/@tencent/dui/lib/components/Snackbar/index.js"),i=r.n(s),u=null;function l(e){if(u)return u.close(),u=null,void setTimeout((function(){e&&e()}),300);e&&e()}function c(e,t,r,o){var s=r||{},d=s.toastType,f=void 0===d?"typeNotice":d,h=s.isWarnning,m=s.toolToastCloseTime,p=s.btnText,v=s.btnCallBack,g=s.btnCallback,y=s.toolToastRemoveCallBack,_=s.showCloseBtn,b=Boolean(m)||(a.a.isMobilePhone||a.a.isAndroidPad)&&!p,A="boolean"===typeof _?_:!b,E="object"===Object(n.a)(t)&&null!==t?t.zIndex:10100,j=h?"error":{typeSuccess:"success",typeWarning:"error",typeNotice:"info",typeNoticeWhite:"info"}[f],R="function"===typeof e?e():e;"string"===typeof R&&(R=R.replace(/[,\uff0c]$/,"")),u?l((function(){c(e,t,r,o)})):(u=i.a.show({style:{zIndex:E},message:R,closable:A,type:j,action:p,onClickAction:v||g,onClose:function(){u&&(u=null,y&&y())},containerDom:o,duration:m,autoClose:b}),b&&setTimeout((function(){y&&y()}),m))}function d(e,t){if(u){var r={message:e};t&&(r.type=t),u.update(r)}}},"./src/core/utils/ImageLoader.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/regenerator-runtime/runtime.js");var n=r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=(r("../node_modules/core-js/modules/es.object.keys.js"),function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(o.a)(this,e),this.max=t,this.ttl=r,this.first=null,this.last=null,this.items=Object.create(null),this.size=0}return Object(a.a)(e,[{key:"has",value:function(e){return e in this.items}},{key:"clear",value:function(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}},{key:"delete",value:function(e){if(this.has(e)){var t=this.items[e];delete this.items[e],this.size-=1,null!==t.prev&&(t.prev.next=t.next),null!==t.next&&(t.next.prev=t.prev),this.first===t&&(this.first=t.next),this.last===t&&(this.last=t.prev)}return this}},{key:"evict",value:function(){var e=this.first;return e?(delete this.items[e.key],this.first=e.next,this.first&&(this.first.prev=null),this.size-=1,this):this}},{key:"get",value:function(e){var t;if(this.has(e)){var r=this.items[e];this.ttl>0&&r.expiry<=(new Date).getTime()?this.delete(e):(t=r.value,this.set(e,t,!0))}return t}},{key:"keys",value:function(){return Object.keys(this.items)}},{key:"set",value:function(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n||this.has(e)){if((r=this.items[e]).value=t,!1===n&&(r.expiry=this.ttl>0?(new Date).getTime()+this.ttl:this.ttl),this.last!==r){var o=this.last,a=r,s=a.next,i=a.prev;this.first===r&&(this.first=r.next),r.next=null,r.prev=this.last,o&&(o.next=r),null!==i&&(i.next=s),null!==s&&(s.prev=i)}}else this.max>0&&this.size===this.max&&this.evict(),r={expiry:this.ttl>0?(new Date).getTime()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:t},this.items[e]=r,this.size+=1,1===this.size?this.first=r:this.last&&(this.last.next=r);return this.last=r,this}}]),e}()),i=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),u=r.n(i),l=u.a.isMobilePhone&&200,c=(u.a.isIPad||u.a.isAndroidPad)&&600,d=l||c||1500,f=new(function(){function e(){Object(o.a)(this,e),this.maxCount=16,this.loadingCount=0,this.tasks=[],this.imageCache=new s(d),this.loadedCount=0,this.errorCount=0}return Object(a.a)(e,[{key:"loadImage",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(t){var r,n,o,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=a.length>1&&void 0!==a[1]&&a[1])||!(n=this.getCachedImage(t))){e.next=3;break}return e.abrupt("return",n);case 3:if(!(this.loadingCount<this.maxCount)){e.next=5;break}return e.abrupt("return",this.request(t,r));case 5:return e.next=7,this.waitingTask(t,r);case 7:return o=e.sent,e.abrupt("return",o);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getCachedImage",value:function(e){return this.imageCache.get(e)}},{key:"clearCache",value:function(){this.imageCache.clear()}},{key:"addToCache",value:function(e,t){return this.imageCache.set(e,t),t}},{key:"waitingTask",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(t,r){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,o){n.tasks.push({url:t,callback:function(t){e(t)},skipCache:r})})));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"runTask",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.tasks.pop()){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.request(t.url,t.skipCache);case 5:r=e.sent,t.callback(r);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"idle",value:function(){this.loadingCount-=1,this.tasks.length>0&&this.runTask()}},{key:"request",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(t,r){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,o){var a=new Image;a.onload=function(){n.loadedCount+=1,n.idle(),e(a),!r&&n.addToCache(t,a)},a.onerror=function(){n.errorCount+=1,a.onload=null,a.onerror=null,a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAACcCAMAAAANmRRNAAAAV1BMVEW7u7u7u7u7u7sAAAD///+7u7v9/f2+vr74+PjDw8POzs7o6OjR0dHz8/P6+vrw8PDf39/IyMji4uL19fXk5OTV1dXAwMDt7e3FxcXT09Pc3NzKysrZ2dlJiXC2AAAABHRSTlPxrSYAnzdaTwAABDJJREFUeNrs2A2OmzAQhmGSnc82xkCA8Jvc/5ytqiqKgHYhjGGs5bnBq8HInujreongnaORJxhFl+tXdI2wg4JGjAan3xkX7CGmsRqsLlGEXSgaqcBqrw4YGuvBaq+QnMZSMNovJKEJBz77hZQ0kYPPfiEDTVmw2S+kJ78jeQ+hAJ0h0pwh0pwh0pwh0pwh0pwh0pwh0pwh0pwh0vzYEHOzsdadvVUky7oQ0+OlNyTJqpBE441OSJA1ISVGSpJjRUiCCUEzWR5iNCa0nHOyPKTHDEdSLA4xmCVmJItDbph1I26qLr2GWMyy7B09MPgMiTEr5u5wAFArfyEaszRzh8UfToUdkj3w1yML+dPKCrwUJtzDbgq86apQf7+mGw079RJSYVZFXKoYI03uI4Sc3ytKGmNCt+FdGtMGc+6hXePzBvNKnw8r/pPeavzLENJT99Uxp1Y+lg8OL84Qk0Tjf5zytQ4CYs510B3fsCqIBd0d3ypMACElFuiM+JAbFolT4SFPLNTkokNqLKZbuSGqxwo6kRqiHNYpZYYoi7UGiSHKYr1aiQvJHviEU8JCsgKfsUpUiOnwqSITFLKhA+iMmJAqxhZxKiQkbbBNk4sI2dwB6FZASK6xnU4OD2k1WJTrQsR2AMOhIYkGm6c6LuQOTk4dFVKClz0opAI3lhBDaz1Fhvxq72ySG4TBGJp2Ihvnh4TGIQRy/3N2kUU6Ax5QR+bzgneDt9AAEuBL+yI9XFuiyMPTG3IEyhM5eoDdkAcApYlEvDkQJme8KUnk0w4ONV9hoRiRFz4sXsOdx4ciRNwdfwm3f10M7UVGrdrCNbzBPHoRoo1auIZfQKATYVqcZWv4EwQ6EbL9mF9Faw8CnQjdfkRJ1PUi5KiP2cW9A4FQhH5Kndn1HyDQivBPqXeXFjlBgEgkYo5T0qQCgVyET+shZXKFAI1Ij3mSt5AuQIBCxN2xhNQt5BEcehF+tAw3xd9b9CL82BfOivJEL8KPfe3IpIcAgUgDCl9pyhO9CDh6UdStRdpaU56Yi1xF5Ym1SHCantRc5EdUnliLBKfpSc1Foqg8sRZpnKZ0MBc57ke4DjzWIsNkd+3BYi7yEM0i5iJR1M2Zi/jzlAcfE3MRdG4viYm5CJ6intFcBLHgXgsEqZjUARzmIujqSZNLAW08OE6imJiL4EcUE3MRf9HExFwEodasiOYiOImqbHOR1Hx1AIm5CFQxMRdRxcRcBAdRTMxFcBV9xWMukohJFUBiLhIqzVBtLpKaRnuQmIugn47JABJzkUSrUrVgmRcx/1Y3yfbnzE2kGDaR0thESmMTKY1NpDTGInr8bb/em3U5RdC41b6NQVYR3CdFXAM9eUVwnDS5ecjJLOLPa8Ukr8iqMdnlNFkxJrvcx9HGlbbrr7wHBCdjEqFl9539yObO5X7F431k8y/KRTTv64XxkAAAAABJRU5ErkJggg==",n.idle(),e(a)},a.src=t,n.loadingCount+=1})));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}]),e}());t.a=f},"./src/core/utils/cell.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"hasBasicFilter",(function(){return u})),r.d(t,"getCellFormat",(function(){return l})),r.d(t,"getTextFormat",(function(){return c})),r.d(t,"cellIsBold",(function(){return d})),r.d(t,"cellIsItalic",(function(){return f})),r.d(t,"cellIsUnderline",(function(){return h})),r.d(t,"cellIsStrikethrough",(function(){return m})),r.d(t,"isSingleCellBlank",(function(){return p})),r.d(t,"isRangeCellBlank",(function(){return v})),r.d(t,"isMergeCellBlank",(function(){return g})),r.d(t,"getCellDataDVAtPosition",(function(){return y})),r.d(t,"getMergedValue",(function(){return _})),r.d(t,"getMergedFormat",(function(){return b})),r.d(t,"getMergedFormatValue",(function(){return A}));r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.string.bold.js");var n=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),o=r("../packages/model/src/index.ts"),a=r("./src/core/utils/selection.ts"),s=r("../packages/model/src/spreadsheet/SpreadsheetProperties.ts"),i=r("../node_modules/@tencent/tdocs-format-render/lib/index.js");function u(e){var t=e.spreadsheet.activeSheet;return!!(null===t||void 0===t?void 0:t.getBasicFilter())}function l(e){var t,r=Object(a.getActiveCell)(e),n=s.a.defaultDefaultFormat;return r?null==(t=o.Cell.cellDataUtils.getExportFormat(r))&&(t=this.defaultProperties.defaultFormat):t=n,t}function c(e){var t=l(e),r=s.a.defaultDefaultFormat.getTextFormat();t.getTextFormat();return t.getTextFormat()||r}function d(e){var t=c(e);return!!(null===t||void 0===t?void 0:t.bold)}function f(e){var t=c(e);return!!(null===t||void 0===t?void 0:t.italic)}function h(e){var t=c(e);return!!(null===t||void 0===t?void 0:t.underline)}function m(e){var t=c(e);return!!(null===t||void 0===t?void 0:t.strikethrough)}function p(e,t,r){var n=e.spreadsheet.activeSheet.getCellDataAtPosition(t,r),o=null===n||void 0===n?void 0:n.getEditValue();return!o||""===o.toString().replace(/[\u200B-\u200D\uFEFF]/g,"")}function v(e,t,r){return function(e,t,r){var n=e.spreadsheet.activeSheet.getCellDataAtPosition(t,r);if(null===n||void 0===n?void 0:n.getMergeReference())return!0;return!1}(e,t,r)?g(e,t,r):p(e,t,r)}function g(e,t,r){var n=e.spreadsheet.activeSheet.getCellDataAtPosition(t,r),o=null===n||void 0===n?void 0:n.getMergeReference();return!!o&&p(e,o.startRowIndex,o.startColIndex)}function y(e,t,r){var n=e.spreadsheet.activeSheet.getCellDataAtPosition(t,r),o=null===n||void 0===n?void 0:n.getUserEnteredFormat();return null===o||void 0===o?void 0:o.getDataValidation()}function _(e){var t,r=e.getEffectiveValue(),a=e.getFormattedValue();if(r&&r.type===o.Cell.EXTENDED_VALUE_TYPE.ERROR&&"object"===Object(n.a)(r.value))return(null===(t=r.value)||void 0===t?void 0:t.displayText)||"";var s=null;return a&&(a.type===o.Cell.FORMATTED_VALUE_TYPE.NORMAL||a.type===o.Cell.FORMATTED_VALUE_TYPE.ERROR)&&(s=a.value),s||""}function b(e,t){var r,n,a=[e.getConditionalFormatResult(),e.getEffectiveFormat(),e.getUserEnteredFormat()];switch(t){case"textAlign":if(null!=(n=A(a,"getHorizontalAlign")))r=n===o.Cell.Format.HORIZONTAL_ALIGN.LEFT?"left":n===o.Cell.Format.HORIZONTAL_ALIGN.CENTER?"center":"right";else if(!n&&e.getEffectiveValue()){var s=o.Cell.cellDataUtils.getExportFormat(e);r=s&&Object(i.isTextCell)(s.getNumberFormat())?"left":e.getEffectiveValue().type===o.Cell.EXTENDED_VALUE_TYPE.BOOL||e.getEffectiveValue().type===o.Cell.EXTENDED_VALUE_TYPE.ERROR?"center":e.getEffectiveValue().type===o.Cell.EXTENDED_VALUE_TYPE.NUMBER?"right":"left"}else r=null;return r;case"verticalAlign":return r=null!=(n=A(a,"getVerticalAlign"))?n===o.Cell.Format.VERTICAL_ALIGN.TOP?"top":n===o.Cell.Format.VERTICAL_ALIGN.MIDDLE?"middle":"bottom":null;default:return""}}function A(e,t){var r,n,o,a;for(r=0,n=e.length;r<n;r++)if((o=e[r])&&null!=(a=o[t]()))return a;return null}},"./src/core/utils/formula.ts":function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"isFormula",(function(){return o})),r.d(t,"isFormulaString",(function(){return a})),r.d(t,"isFormulaAndError",(function(){return s})),r.d(t,"isLegalFormula",(function(){return i})),r.d(t,"isFromulaError",(function(){return u})),r.d(t,"moveEqualChar",(function(){return l})),r.d(t,"getRelativeFormulaWithFormula",(function(){return d})),r.d(t,"getFormulaWithRelativeFormula",(function(){return f})),r.d(t,"fixRightBracket",(function(){return h}));r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.match.js"),r("../node_modules/core-js/modules/es.string.replace.js");var n=r("../packages/model/src/range/hexRangeUtils.ts");function o(e){return"string"===typeof e&&"="===e[0]&&e.length>1}function a(e){return!!(e&&"="===e.slice(0,1)&&e.length>1)}function s(e){return!!a(e)&&!i(e)}var i=function(t){var r=e.SpreadsheetApp;if(r){var n=r.spreadsheet.activeSheet.getSheetId();return!r.calcController.getResultBySingleFormula(t,n).isError}return null},u=function(e){return e&&e.length>1?"#"===e[1]||"#"===e[0]:null},l=function(e){return e?e.length>=1&&"="===e[0]?e.substr(1,e.length):e:""},c=function(e){var t,r,n="ABCDEFGHIJKLMNOPQRSTUVWXYZ",o=0;for(t=0,r=(e=e.replace(/\$/g,"")).length-1;t<e.length;t+=1,r-=1)o+=Math.pow(n.length,r)*(n.indexOf(e[t])+1);return o&&(o-=1),o};function d(e,t,r){return"string"===typeof e&&"="===e[0]?e.replace(/(\$?[A-Za-z]+\$?[0-9]+)/g,(function(e){var n=function(e){var t=(e="string"===typeof e?e:String(e)).match(/\d+$/),r=e.replace(/\d+$/,"");return{row:parseInt((null===t||void 0===t?void 0:t[0])||"",10)-1,col:c(r)}}(e.toUpperCase());if(n.row<0||n.col<0)return e;var o=function(e){var t=e.match(/\d+$/);return{alpha:e.replace(/\d+$/,""),num:parseInt((null===t||void 0===t?void 0:t[0])||"",10)}}(e).alpha,a="$"===o[0]||!1;return("$"===o[o.length-1]||!1?"R".concat(n.row.toString()):"R[".concat((n.row-t).toString(),"]"))+(a?"C".concat(n.col.toString()):"C[".concat((n.col-r).toString(),"]"))})):""}function f(e,t,r){return"string"===typeof e&&"="===e[0]?e.replace(/(R\[?-?[0-9]+\]?C\[?-?[0-9]+\]?)/g,(function(e){var o,a,s=e.indexOf("C"),i=!("["===e[1]&&"]"===e[s-1])||!1,u=!("["===e[s+1]&&"]"===e[e.length-1])||!1;if(i)o="$".concat((parseInt(e.substring(1,s),10)+1).toString());else{if(o=e.substring(2,s-1),(o=parseInt(o,10)+t+1)<=0)return"#REF!";o=o.toString()}if(u)a=e.substring(s+1),a="$".concat(Object(n.colIndex2ColChar)(parseInt(a,10)));else{if(a=e.substring(s+2,e.length-1),(a=parseInt(a,10)+r)<0)return"#REF!";a=Object(n.colIndex2ColChar)(a)}return o&&a?a+o:"#REF!"})):""}function h(e){if("string"===typeof e&&o(e)){var t=e.replace(/(")[^"]*?\1/g,"");t=(t=t.replace(/'.*?'!/g,"")).replace(/\n$/g,"");for(var r=0,n=0,a=0;a<t.length;a++)"("===t[a]?r+=1:")"===t[a]&&(n+=1);r-n===1&&(e+=")")}return e}}.call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/utils/index.ts":function(e,t,r){"use strict";var n={};r.r(n),r.d(n,"calcFrozenRowColmn",(function(){return u})),r.d(n,"generateFreezeRequestOption",(function(){return l})),r.d(n,"generateFreezeBtnText",(function(){return c})),r.d(n,"cancelFreezePreview",(function(){return d})),r.d(n,"firstRowFreezePreview",(function(){return f})),r.d(n,"firstColumnFreezePreview",(function(){return h})),r.d(n,"freezePreview",(function(){return m})),r.d(n,"doFreeze",(function(){return p})),r.d(n,"reportFreezeApplyStatus",(function(){return v}));var o={};r.r(o),r.d(o,"getAllSheets",(function(){return E})),r.d(o,"getFilterSyncStatus",(function(){return j}));var a=r("./src/core/utils/cell.ts"),s=(r("../node_modules/core-js/modules/es.array.concat.js"),r("../packages/model/src/range/hexRangeUtils.ts")),i=r("../packages/report/src/index.ts"),u=function(e){var t=e.spreadsheet.activeSheet,r=t.getFrozenRowCount(),n=t.getFrozenColCount(),o=e.view.getSelection().rangeSelections,a=o[0];if(1!==o.length)return{isError:!0,row:0,column:0,isForzenRow:!1,isForzenColumn:!1};var s=-1,i=-1,u=!0,l=!0,c=a.startRowIndex,d=a.startColIndex,f=function(e,t,r,n){var o=!1,a=r.endRowIndex-t,s=r.endColIndex-e;if(0===a&&0===s)o=!0;else{var i=n.getCellDataAtPosition(t,e);if(null===i||void 0===i?void 0:i.getMergeReference()){var u=i.getMergeReference();u&&u.endRowIndex===r.endRowIndex&&u.endColIndex===r.endColIndex&&(o=!0)}}return o}(d,c,a,t),h=function(e,t,r){return 0===t&&r.endRowIndex===e.spreadsheet.activeSheet.getRowCount()-1}(e,c,a),m=function(e,t,r){return 0===t&&r.endColIndex===e.spreadsheet.activeSheet.getColCount()-1}(e,d,a);return f?(s=a.startRowIndex-1<0?a.endRowIndex:a.startRowIndex-1,i=a.startColIndex-1<0?a.endColIndex:a.startColIndex-1):m&&!h?(s=a.endRowIndex,n&&0===r?i=n-1:l=!1):!m&&h?(i=a.endColIndex,r&&0===n?s=r-1:u=!1):(s=a.endRowIndex,i=a.endColIndex),{isError:!function(e,t,r){var n=!1,o=e.view.canvas.clientRect.width-e.view.canvas.headSize.displayRowHeadWidth,a=e.view.canvas.clientRect.height-e.view.canvas.headSize.displayColHeadHeight;t&&t>0&&(e.view.canvas.areaData.getDisplayGlobalRightByCol(t)>o&&(n=!0));r&&r>0&&(e.view.canvas.areaData.getDisplayGlobalBottomByRow(r)>a&&(n=!0));return!n}(e,i,s),row:s,column:i,isForzenRow:u,isForzenColumn:l}},l=function(e){var t=u(e),r=t.row,n=t.column,o=t.isForzenRow;return{column:t.isForzenColumn?n+1:0,row:o?r+1:0}},c=function(e){var t=u(e),r=t.isError,n=t.row,o=t.column,a=t.isForzenRow,i=t.isForzenColumn;if(r||"number"!==typeof n||"number"!==typeof o)return"\u51bb\u7ed3\u7a97\u683c";var l=(-1==n?0:n)+1,c=Object(s.colIndex2ColChar)(-1==o?0:o);return"\u51bb\u7ed3\u81f3\u7b2c".concat(a?"".concat(l,"\u884c"):"").concat(i?"".concat(c,"\u5217"):"")};function d(e){e.requestApi.cancelFreezePreview()}function f(e){e.requestApi.freezePreview({row:1})}function h(e){e.requestApi.freezePreview({column:1})}function m(e){if(u(e).isError)return d(e);var t=l(e);e.requestApi.freezePreview(t)}function p(e,t){var r={};switch(t){case"firstRow":r={row:1,column:0};break;case"firstColumn":r={column:1,row:0};break;case"currentCell":r=l(e);break;case"cancelFreeze":r={row:-1,column:-1}}e.requestApi.freeze(r)}var v=function(e,t){var r=t.row,n=t.column;if(r&&r>0&&0===n)i.b.tdwReport({opername:"doc_excel_editor",module:"excel_freeze",action:"row_freeze"});else if(n&&n>0&&0===r)i.b.tdwReport({opername:"doc_excel_editor",module:"excel_freeze",action:"col_freeze"});else if(n&&n>0&&r&&r>0){var o=e.spreadsheet.activeSheet,a=o.getFrozenRowCount(),s=o.getFrozenColCount();0!==a&&0!==s?i.b.tdwReport({opername:"doc_excel_editor",module:"excel_freeze",action:"re-row+col_freeze"}):0!==a&&0!==s||i.b.tdwReport({opername:"doc_excel_editor",module:"excel_freeze",action:"row+col_freeze"})}},g=r("./src/core/utils/selection.ts"),y=r("./src/core/utils/range.ts"),_=r("./src/core/utils/numberFromat.ts"),b=r("./src/core/utils/formula.ts"),A=r("./src/core/utils/util.ts");function E(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];n&&t.push({id:n.getSheetId(),name:n.getTitle(),type:n.getSheetType(),hidden:n.getDisplayHidden()})}return[t]}function j(e){return!e.spreadsheet||e.spreadsheet.isFilterSync}var R,S,C,T,w;r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.match.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");!function(e){e[e.SINGLE_ROW=1]="SINGLE_ROW",e[e.SINGLE_COL=2]="SINGLE_COL",e[e.MULTI_ROW_COL=3]="MULTI_ROW_COL"}(C||(C={})),function(e){e[e.LAST_CELL=1]="LAST_CELL",e[e.NEXT_COL_CELL=2]="NEXT_COL_CELL",e[e.NEXT_ROW_CELL=3]="NEXT_ROW_CELL",e[e.LAST_WHOLE_COL_AND_ROW_CELL=4]="LAST_WHOLE_COL_AND_ROW_CELL",e[e.LAST_WHOLE_COL_CELL=5]="LAST_WHOLE_COL_CELL",e[e.LAST_WHOLE_ROW_CELL=6]="LAST_WHOLE_ROW_CELL",e[e.NEXT_WHOLE_ROW_CELL=7]="NEXT_WHOLE_ROW_CELL",e[e.SELECTED_CELL=8]="SELECTED_CELL"}(T||(T={}));var O,I,N,k={init:function(e){R=(w=e).spreadsheet.activeSheet.getRowCount(),S=w.spreadsheet.activeSheet.getColCount()},selHandler:function(e,t){if(w){var r=function(e,t){var r=[];return e.forEach((function(e){var n=function(e){var t=e.startRowIndex,r=e.startColIndex,n=e.endRowIndex,o=e.endColIndex;if(t===n)return C.SINGLE_ROW;if(r===o)return C.SINGLE_COL;if(t<n&&r<o)return C.MULTI_ROW_COL;return C.MULTI_ROW_COL}(e),o=function(e,t,r,n){switch(e){case T.SELECTED_CELL:return D(n);case T.LAST_CELL:return P(t,r,n);case T.NEXT_ROW_CELL:return x(r,n);case T.NEXT_COL_CELL:return F(r,n);case T.NEXT_WHOLE_ROW_CELL:return L(r,n);case T.LAST_WHOLE_COL_CELL:return U(r,n);case T.LAST_WHOLE_ROW_CELL:return B(r,n);case T.LAST_WHOLE_COL_AND_ROW_CELL:return H(r,n)}}(function(e,t,r){var n=t.endRowIndex,o=t.endColIndex,a=w.spreadsheet.activeSheet.getCellDataAtPosition(n,o),s=a;if(a){var i=a.getMergeReference();if(i){var u=w.spreadsheet.activeSheet.getCellDataAtPosition(i.startRowIndex,i.startColIndex);s=u}}var l="";s&&(l=s.getEditValue());var c=r.replace(/sheet-formula-/,"");switch(e){case C.SINGLE_ROW:return function(e,t,r){var n=t.endColIndex;if(""===e||null===e)return T.LAST_CELL;if(e&&"="===e[0]){var o=e.match(/=([a-zA-Z]+)\(/),a=null===o||void 0===o?void 0:o[1];return(null===a||void 0===a?void 0:a.toLowerCase)&&a.toLowerCase()===r?T.LAST_CELL:n+1>=S?T.SELECTED_CELL:T.NEXT_COL_CELL}if(n+1>=S)return T.SELECTED_CELL;return T.NEXT_COL_CELL}(l,t,c);case C.SINGLE_COL:return function(e,t,r){var n=t.endRowIndex;if(""===e||null===e)return T.LAST_CELL;if(e&&"="===e[0]){var o=e.match(/=([a-zA-Z]+)\(/),a=null===o||void 0===o?void 0:o[1];return(null===a||void 0===a?void 0:a.toLowerCase)&&a.toLowerCase()===r?T.LAST_CELL:n+1>=R?T.SELECTED_CELL:T.NEXT_ROW_CELL}if(n+1>=R)return T.SELECTED_CELL;return T.NEXT_ROW_CELL}(l,t,c);case C.MULTI_ROW_COL:return function(e,t,r){var n,o,a=t.startRowIndex,s=t.startColIndex,i=t.endRowIndex,u=t.endColIndex;if(function(e){var t=e.startRowIndex,r=e.startColIndex,n=e.endRowIndex,o=e.endColIndex;if(0===r&&0===t&&o===S-1&&n===R-1)return!0;return!1}(t))return T.SELECTED_CELL;for(n=a;n<=i;n++){var l=w.spreadsheet.activeSheet.getCellDataAtPosition(n,u),c=l?l.getEditValue():"";if(M(c)){if(!c||"="!==c[0])break;var d=c.match(/=([a-zA-Z]+)\(/);if((null===d||void 0===d?void 0:d[1])!==r)break}}if(n===i+1){for(o=s;o<=u;o++){var f=w.spreadsheet.activeSheet.getCellDataAtPosition(i,o),h=f?f.getEditValue():"";if(M(h)){if(!h||"="!==h[0])break;var m=h.match(/=([a-zA-Z]+)\(/);if((null===m||void 0===m?void 0:m[1])!==r)break}}return o===u+1?T.LAST_WHOLE_COL_AND_ROW_CELL:T.LAST_WHOLE_COL_CELL}for(o=s;o<=u;o++){var p=w.spreadsheet.activeSheet.getCellDataAtPosition(i,o),v=p?p.getEditValue():"";if(M(v)){if(!v||"="!==v[0])break;var g=v.match(/=([a-zA-Z]+)\(/);if((null===g||void 0===g?void 0:g[1])!==r)break}}if(o===u+1)return T.LAST_WHOLE_ROW_CELL;if(i+1===R)return T.SELECTED_CELL;return T.NEXT_WHOLE_ROW_CELL}(0,t,c)}}(n,e,t.toLocaleLowerCase()),n,e,t);o&&(Array.isArray(o)?r=r.concat(o):r.push(o))})),r}(e,t);r.length&&w.requestApi.userRangeEnter(r)}else console.warn("\u672a\u521d\u59cb\u5316spreatsheet")}};function M(e){return""!==e&&null!==e}function D(e){var t=w.view.getSelection().activeCell;null===t||void 0===t||t.rowIndex,null===t||void 0===t||t.colIndex;!function(e,t,r){r.replace(/sheet-formula-/,"").toUpperCase()}(0,0,e)}function x(e,t){var r={row:e.startRowIndex,col:e.startColIndex},n={row:e.endRowIndex,col:e.startColIndex},o=W(n.row+1);return w.view.canvas.selectApi.selectCells({xRange:[r.col,n.col],yRange:[r.row,o]}),G(o,n.col,r,n,t)}function F(e,t){var r={col:e.startColIndex,row:e.startRowIndex},n={col:e.endColIndex,row:e.endRowIndex};return w.view.canvas.selectApi.selectCells({xRange:[r.col,n.col+1],yRange:[r.row,n.row]}),G(n.row,n.col+1,r,n,t)}function P(e,t,r){var n,o;return n={col:0,row:0},o={col:0,row:0},e===C.SINGLE_ROW?(n={row:t.startRowIndex,col:t.startColIndex},o={row:t.endRowIndex,col:t.endColIndex-1}):e===C.SINGLE_COL&&(n={row:t.startRowIndex,col:t.startColIndex},o={row:t.endRowIndex-1,col:t.endColIndex}),t.endRowIndex,t.endColIndex,G(t.endRowIndex,t.endColIndex,n,o,r)}function L(e,t){for(var r,n={col:e.startColIndex,row:e.startRowIndex},o={col:e.endColIndex,row:e.endRowIndex},a=[],s=W(o.row+1),i=n.col;i<=o.col;i++){var u=V(s,i,{row:n.row,col:i},{row:o.row,col:i},t);u&&(r={rowIndex:u.row,colIndex:u.col,userEnterValue:u.value},a.push(r))}return w.view.canvas.selectApi.selectCells({xRange:[n.col,o.col],yRange:[n.row,s]}),a}function U(e,t){for(var r,n={col:e.startColIndex,row:e.startRowIndex},o={col:e.endColIndex,row:e.endRowIndex},a=[],s=n.row;s<=o.row;s++){var i=V(s,o.col,{row:s,col:n.col},{row:s,col:o.col-1},t);i&&(r={rowIndex:i.row,colIndex:i.col,userEnterValue:i.value},a.push(r))}return a}function B(e,t){for(var r,n={col:e.startColIndex,row:e.startRowIndex},o={col:e.endColIndex,row:e.endRowIndex},a=[],s=n.col;s<=o.col;s++){var i=V(o.row,s,{row:n.row,col:s},{row:o.row-1,col:s},t);i&&(r={rowIndex:i.row,colIndex:i.col,userEnterValue:i.value},a.push(r))}return a}function H(e,t){for(var r,n={col:e.startColIndex,row:e.startRowIndex},o={col:e.endColIndex,row:e.endRowIndex},a=[],s=n.row;s<=o.row;s++){var i=V(s,o.col,{row:s,col:n.col},{row:s,col:o.col-1},t);i&&(r={rowIndex:i.row,colIndex:i.col,userEnterValue:i.value},a.push(r))}for(var u=n.col;u<=o.col;u++){var l=V(o.row,u,{row:n.row,col:u},{row:o.row-1,col:u},t);l&&(r={rowIndex:l.row,colIndex:l.col,userEnterValue:l.value},a.push(r))}return a}function G(e,t,r,n,o){var a=Object(s.cellCoords2CellChar)([r.row,r.col]),i=Object(s.cellCoords2CellChar)([n.row,n.col]),u=o.replace(/sheet-formula-/,"").toUpperCase();u="=".concat(u,"(").concat(a,":").concat(i,")");var l=w.spreadsheet.activeSheet.getCellDataAtPosition(e,t);if(l){var c=l.getFormula();if(c)if(u===c.toString(e,t,w.spreadsheet.sheetManager))return}return{rowIndex:e,colIndex:t,userEnterValue:u}}function V(e,t,r,n,o){var a=Object(s.cellCoords2CellChar)([r.row,r.col]),i=Object(s.cellCoords2CellChar)([n.row,n.col]),u=o.replace(/sheet-formula-/,"").toUpperCase();u="=".concat(u,"(").concat(a,":").concat(i,")");var l=w.spreadsheet.activeSheet.getCellDataAtPosition(e,t);if(l){var c=l.getFormula();if(c)if(u===c.toString(e,t,w.spreadsheet.sheetManager))return}return{row:e,col:t,value:u}}function W(e){var t=w.spreadsheet.activeSheet.getBasicFilter();if(!t)return e;for(var r=t.getHiddenRows();-1!==r.indexOf(e);)e+=1;return e}(N=O||(O={})).cell=a,N.selection=g,N.range=y,N.freeze=n,N.util=A,N.numberFormat=_,N.sheet=o,(I=N.formula||(N.formula={})).FormulaInsert=k,I.util=b;t.a=O},"./src/core/utils/numberFromat.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"isLeagalNumber",(function(){return d})),r.d(t,"stringToNumber",(function(){return f}));var n=r("../packages/model/src/index.ts").Utils.numberFormatUtils.formatParseEngine,o=n.parseNumber,a=n.parsePercentage,s=n.parseCurrency,i=n.parseExponential,u=n.parseThousandNumber,l=n.parseFractionValue,c=n.parseDateTimeValue;function d(e,t){return!!f(e,t)}function f(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.fractionFirst,n=void 0!==r&&r;return o(e,{})||a(e,{})||s(e,{})||i(e,{})||u(e,{})||l(e,n?{numberFormat:"fraction"}:{})||c(e,{})}},"./src/core/utils/range.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"select2RelativeHex",(function(){return s})),r.d(t,"select2AbsoluteHex",(function(){return i})),r.d(t,"mergeMultiRanges",(function(){return u}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.map.js");var n=r("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),o=r("../packages/model/src/index.ts"),a=r("../packages/model/src/range/hexRangeUtils.ts");function s(e,t){var r;if(t.selectCol){var o=Object(n.a)(t.xRange,2),s=o[0],i=o[1];r="".concat(Object(a.colIndex2ColChar)(s),":").concat(Object(a.colIndex2ColChar)(i))}else if(t.selectRow){var u=Object(n.a)(t.yRange,2),l=u[0],c=u[1];r="".concat(l+1,":").concat(c+1)}else if(t.selectAll){var d=e.getRowCount()-1,f=e.getColCount()-1;r="".concat(Object(a.colIndex2ColChar)(0)).concat(1,":").concat(Object(a.colIndex2ColChar)(f)).concat(d+1)}else{var h=Object(n.a)(t.xRange,2),m=h[0],p=h[1],v=Object(n.a)(t.yRange,2),g=v[0],y=v[1];r="".concat(Object(a.colIndex2ColChar)(m)).concat(g+1,":").concat(Object(a.colIndex2ColChar)(p)).concat(y+1)}return r}function i(e,t){var r;if(t.selectCol){var o=Object(n.a)(t.xRange,2),s=o[0],i=o[1];r="$".concat(Object(a.colIndex2ColChar)(s),":$").concat(Object(a.colIndex2ColChar)(i))}else if(t.selectRow){var u=Object(n.a)(t.yRange,2),l=u[0],c=u[1];r="$".concat(l+1,":$").concat(c+1)}else if(t.selectAll){var d=e.getRowCount()-1,f=e.getColCount()-1;r="$".concat(Object(a.colIndex2ColChar)(0),"$").concat(1,":$").concat(Object(a.colIndex2ColChar)(f),"$").concat(d+1)}else{var h=Object(n.a)(t.xRange,2),m=h[0],p=h[1],v=Object(n.a)(t.yRange,2),g=v[0],y=v[1];r="$".concat(Object(a.colIndex2ColChar)(m),"$").concat(g+1,":$").concat(Object(a.colIndex2ColChar)(p),"$").concat(y+1)}return r}function u(e){var t=e.map((function(e){return e.clone()})),r=[];t.sort((function(e,t){return e.startColIndex-t.startColIndex}));for(var n=t.length,a=null,s=0;s<n;s++){var i=t[s],u=!1;a?(a.contain(i)||(i.contain(a)?a=i:i.startRowIndex===a.startRowIndex&&i.endRowIndex===a.endRowIndex?i.startColIndex>=a.startColIndex&&i.startColIndex<=a.endColIndex?(a=new o.Range.GridRange(a.sheetId,a.startRowIndex,a.endRowIndex,a.startColIndex,Math.max(a.endColIndex,i.endColIndex)),u=!0):a.startColIndex===i.endColIndex+1?(a=new o.Range.GridRange(a.sheetId,a.startRowIndex,a.endRowIndex,i.startColIndex,a.endColIndex),u=!0):a.endColIndex===i.startColIndex-1&&(a=new o.Range.GridRange(a.sheetId,a.startRowIndex,a.endRowIndex,a.startColIndex,i.endColIndex),u=!0):i.startColIndex===a.startColIndex&&i.endColIndex===a.endColIndex&&(i.startRowIndex>=a.startRowIndex&&i.startRowIndex<=a.endRowIndex?(a=new o.Range.GridRange(a.sheetId,a.startRowIndex,Math.max(a.endRowIndex,i.endRowIndex),a.startColIndex,a.endColIndex),u=!0):a.startRowIndex===i.endRowIndex+1?(a=new o.Range.GridRange(a.sheetId,i.startRowIndex,a.endRowIndex,a.startColIndex,a.endColIndex),u=!0):a.endRowIndex===i.startRowIndex-1&&(a=new o.Range.GridRange(a.sheetId,a.startRowIndex,i.endRowIndex,a.startColIndex,a.endColIndex),u=!0))),u?s===n-1&&r.push(a):(r.push(a,i),a=null)):(s===n-1&&r.push(i),a=i)}return r}},"./src/core/utils/selection.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"getActiveCell",(function(){return o})),r.d(t,"isMergeCell",(function(){return a})),r.d(t,"hasMergeCell",(function(){return s})),r.d(t,"singleRange",(function(){return i})),r.d(t,"isLinkCell",(function(){return u})),r.d(t,"isSelectRow",(function(){return l})),r.d(t,"isSelectColoumn",(function(){return c})),r.d(t,"getSelectCLs",(function(){return d})),r.d(t,"selectImage",(function(){return f})),r.d(t,"singleColumn",(function(){return h})),r.d(t,"isSelectedAll",(function(){return m})),r.d(t,"hasSelect",(function(){return p})),r.d(t,"isPickShape",(function(){return v})),r.d(t,"isMergeCellBlank",(function(){return g})),r.d(t,"isRangeDataBlank",(function(){return y})),r.d(t,"isCellDataBlank",(function(){return _})),r.d(t,"isRangeCellBlank",(function(){return b})),r.d(t,"allBlank",(function(){return A})),r.d(t,"getFirstRowInSelection",(function(){return E})),r.d(t,"getFirstColInSelection",(function(){return j}));r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.replace.js");var n=r("../packages/model/src/index.ts");function o(e){var t=e.view.getSelection().activeCell;return t.colIndex<0||t.colIndex<0?null:e.spreadsheet.activeSheet?e.spreadsheet.activeSheet.getCellDataAtPosition(t.rowIndex,t.colIndex):null}function a(e){var t=e.view.getSelection().rangeSelections;if(t.length<=0)return!1;var r=t[0],n=e.spreadsheet.activeSheet.getCellDataAtPosition(r.startRowIndex,r.startColIndex),o=null===n||void 0===n?void 0:n.getMergeReference();return!!o&&r.equals(o)}function s(e){var t=e.view.getSelection().rangeSelections;if(t.length<=0)return!1;var r=t[0],o=e.spreadsheet.activeSheet.mergeManager.mergeList;if(!o)return!1;for(var a=0;a<o.length;a++){var s=new n.Range.GridRange(o[a].sheetId,o[a].startRowIndex,o[a].endRowIndex,o[a].startColIndex,o[a].endColIndex);if(r.contain(s))return!0}return!1}function i(e){var t=e.view.getSelection().rangeSelections;if(t.length<=0)return!1;var r=t[0];return r.startColIndex===r.endColIndex&&r.startRowIndex===r.endRowIndex||!!a(e)}function u(e){var t=e.view.getSelection().rangeSelections;if(t.length<=0)return!1;var r=t[0],n=e.spreadsheet.activeSheet.getCellDataAtPosition(r.startRowIndex,r.startColIndex);return!!n&&!(!n.getHyperlink()&&!n.getHyperlinkRuns())}function l(e){if(!e.view.canvas.normalSelectData)return!1;for(var t=e.view.canvas.normalSelectData.selectQueue,r=0;r<t.length;r++)if(t[r].selectRow)return!0;return!1}function c(e){if(!e.view.canvas.normalSelectData)return!1;for(var t=e.view.canvas.normalSelectData.selectQueue,r=0;r<t.length;r++)if(t[r].selectCol)return!0;return!1}function d(e){var t=e.view.getSelection().rangeSelections;if(t.length<=0)return!1;var r=t[0];return{rows:r.endRowIndex-r.startRowIndex+1,cols:r.endColIndex-r.startColIndex+1}}function f(e){try{var t=e.view.canvas.shapeEdit;return!!t&&t.focusing}catch(r){return!1}}function h(e){var t=e.view.getSelection();if(null===t)return null;var r=t.rangeSelections[0];return r.startColIndex===r.endColIndex}function m(e){var t=e.view.getSelection().rangeSelections;if(t.length<=0)return!1;var r=t[0],n=e.spreadsheet.activeSheet.getRowCount(),o=e.spreadsheet.activeSheet.getColCount();return 0===r.startColIndex&&r.endColIndex===o-1&&0===r.startRowIndex&&r.endRowIndex===n-1}function p(e){return!!e.view.canvas.normalSelectData&&e.view.canvas.normalSelectData.selectQueue.length>0}function v(e){var t=e.view.canvas.shapeEdit;return!!t&&t.focusing}function g(e,t,r){var n=e.spreadsheet.activeSheet.getCellDataAtPosition(t,r),o=null===n||void 0===n?void 0:n.getMergeReference();return!!o&&_(e,o.startRowIndex,o.startColIndex)}function y(e,t){for(var r=t.startRowIndex;r<=t.endRowIndex;r++)for(var n=t.startColIndex;n<=t.endColIndex;n++)if(!_(e,r,n))return!1;return!0}function _(e,t,r){var n=e.spreadsheet.activeSheet.getCellDataAtPosition(t,r),o=null===n||void 0===n?void 0:n.getEditValue();return!o||""===o.toString().replace(/[\u200B-\u200D\uFEFF]/g,"")}function b(e,t,r){return function(e,t,r){var n=e.spreadsheet.activeSheet.getCellDataAtPosition(t,r);return!!(null===n||void 0===n?void 0:n.getMergeReference())}(e,t,r)?g(e,t,r):_(e,t,r)}var A=function(e,t){for(var r=t,n=r.startRowIndex;n<=r.endRowIndex;n++)for(var o=r.startColIndex;o<=r.endColIndex;o++)if(!b(e,n,o))return!1;return!0};function E(e){var t=e.view.getSelection();if(0===t.rangeSelections.length)throw new Error("\u9009\u533a\u4e0d\u5b58\u5728");return t.rangeSelections[0].startRowIndex}function j(e){var t=e.view.getSelection();if(0===t.rangeSelections.length)throw new Error("\u9009\u533a\u4e0d\u5b58\u5728");return t.rangeSelections[0].startColIndex}},"./src/core/utils/sheetClip/SheetClip.js":function(e,t,r){r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.last-index-of.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.last-index-of.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.string.split.js"),function(e){"use strict";function r(e){return e.split('"').length-1}var n=function(e){var t,n,o,a,s,i,u,l=[],c=0;for((o=(e=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n")).split("\n")).length>1&&""===o[o.length-1]&&o.pop(),t=0,n=o.length;t<n;t+=1){for(o[t]=o[t].split("\t"),a=0,s=o[t].length;a<s;a+=1)l[c]||(l[c]=[]),i&&0===a?(u=l[c].length-1,l[c][u]=l[c][u]+"\n"+o[t][0],i&&1&r(o[t][0])&&(i=!1,l[c][u]=l[c][u].substring(0,l[c][u].length-1))):a===s-1&&0===o[t][a].indexOf('"')&&1&r(o[t][a])?(l[c].push(o[t][a].substring(1)),i=!0):i?(1&r(o[t][a])&&i&&0!=o[t][a].length&&o[t][a].lastIndexOf('"')===o[t][a].length-1&&(i=!1),u=l[c].length-1,l[c][u]=l[c][u]+"\n"+o[t][0]):(l[c].push(o[t][a]),i=!1);i||(c+=1)}return l},o=function(e){var t,r,n,o,a,s="";for(t=0,r=e.length;t<r;t+=1){for(o=e[t].length,n=0;n<o;n+=1)n>0&&(s+="\t"),"string"===typeof(a=e[t][n])?a.indexOf("\n")>-1||a.indexOf("\r")>-1||a.indexOf("\t")>-1?s+='"'+a.replace(/"/g,'""')+'"':s+=a:s+=null===a||void 0===a?"":a;r-1!=t&&(s+="\n")}return s};t.parse=n,t.stringify=o}(window)},"./src/core/utils/util.ts":function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"throttle",(function(){return s})),r.d(t,"timeChunk",(function(){return i})),r.d(t,"inArray",(function(){return u})),r.d(t,"setHash",(function(){return l})),r.d(t,"CalcInputWidth",(function(){return d})),r.d(t,"getValueWithDefault",(function(){return f})),r.d(t,"checkEnumValue",(function(){return h})),r.d(t,"clone",(function(){return m})),r.d(t,"isSame",(function(){return p})),r.d(t,"arrToObjectKey",(function(){return g})),r.d(t,"API_CONFIG",(function(){return c})),r.d(t,"checkExecuteForMultiSelection",(function(){return y})),r.d(t,"getOutScopeControlledPromise",(function(){return _}));r("../node_modules/core-js/modules/es.array.reduce.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.replace.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("./src/base/util/html.ts");function s(e,t,r,n){var o;return n="undefined"===typeof n||n,function(){for(var a=arguments.length,s=new Array(a),i=0;i<a;i++)s[i]=arguments[i];var u=this;return"undefined"!==typeof r&&(u=r),n?(e.apply(u,s),n=!1):!o&&void(o=setTimeout((function(){clearTimeout(o),o=null,e.apply(u,s)}),t))}}function i(e,t,r){e.length;var n,o=0;return function(){n=setInterval((function(){if(0===e.length)return clearInterval(n);!function(){for(var n=0;n<Math.min(r||1,e.length);n++){var a=e.shift();t(a,o),o+=1}}()}),19)}}function u(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return!0;return!1}function l(e){location.hash=e}var c,d=function(){function e(t){Object(n.a)(this,e),this.font=t,this.init()}return Object(o.a)(e,[{key:"init",value:function(){var e=document.createElement("pre");e.style.fontSize="".concat(this.font,"px"),e.style.position="absolute",e.style.top="9999px",e.style.left="9999px",e.style.zIndex="-1",e.style.backgroundColor="transparent",e.style.fontFamily="Microsoft YaHei, Verdana, sans-serif",e.style.whiteSpace="pre",document.body.appendChild(e),this.dom=e}},{key:"calc",value:function(e,t){if(this.dom.style.display="block",t)for(var r=Object.keys(t),n=0;n<r.length;n++)this.dom.style[r[n]]=t[r[n]];this.dom.innerHTML=Object(a.c)(e),this.dom.style.display="";var o=this.dom.offsetWidth;return this.dom.style.display="none",o}},{key:"destroy",value:function(){this.dom&&this.dom.remove()}}]),e}();function f(e,t){return null!=e?e:t}function h(e,t){for(var r=Object.keys(t),n=0;n<r.length;n++)if(t[r[n]]===e)return e;return null}function m(e){return JSON.parse(JSON.stringify(e))}function p(e,t){return v(e)===v(t)}function v(e){return null==e?null:e}function g(e){return e.reduce((function(e,t,r){return e[t]=1,e}),{})}function y(t){if(e.SpreadsheetApp.view.getSelection().rangeSelections.length<=1)return!0;switch(t){case c.reorder:case c.setBasicFilter:case c.insideSheetCopyPaste:case c.applyPasteData:case c.moveRows:case c.moveColumns:return!1}return!0}function _(){var e=function(){},t=function(){};return{promise:new Promise((function(r,n){e=r,t=n})),resolve:e,reject:t}}!function(e){e[e.resizeColumns=0]="resizeColumns",e[e.mergeCells=1]="mergeCells",e[e.unmergeCells=2]="unmergeCells",e[e.insertRows=3]="insertRows",e[e.insertColumns=4]="insertColumns",e[e.hideRows=5]="hideRows",e[e.hideColumns=6]="hideColumns",e[e.showRows=7]="showRows",e[e.showColumns=8]="showColumns",e[e.deleteRows=9]="deleteRows",e[e.deleteColumns=10]="deleteColumns",e[e.resizeRows=11]="resizeRows",e[e.resizeRowsColumns=12]="resizeRowsColumns",e[e.moveRows=13]="moveRows",e[e.moveColumns=14]="moveColumns",e[e.setRowFormData=15]="setRowFormData",e[e.setColFormData=16]="setColFormData",e[e.reorder=17]="reorder",e[e.freeze=18]="freeze",e[e.userEnter=19]="userEnter",e[e.userEnterToSheetId=20]="userEnterToSheetId",e[e.userRangeEnter=21]="userRangeEnter",e[e.addImage=22]="addImage",e[e.updateImage=23]="updateImage",e[e.deleteImage=24]="deleteImage",e[e.insertLink=25]="insertLink",e[e.fontBold=26]="fontBold",e[e.autoWrap=27]="autoWrap",e[e.numberFormat=28]="numberFormat",e[e.formatPainter=29]="formatPainter",e[e.decreaceDecimal=30]="decreaceDecimal",e[e.increaceDecimal=31]="increaceDecimal",e[e.clearLink=32]="clearLink",e[e.clearFormat=33]="clearFormat",e[e.setLink=34]="setLink",e[e.clearContent=35]="clearContent",e[e.replace=36]="replace",e[e.redo=37]="redo",e[e.undo=38]="undo",e[e.smartSelection=39]="smartSelection",e[e.setBasicFilter=40]="setBasicFilter",e[e.clearBasicFilter=41]="clearBasicFilter",e[e.updateFilterCriteria=42]="updateFilterCriteria",e[e.applyPasteData=43]="applyPasteData",e[e.reorderWithFilter=44]="reorderWithFilter",e[e.insideSheetCopyPaste=45]="insideSheetCopyPaste",e[e.defineFormRange=46]="defineFormRange",e[e.insertImage=47]="insertImage",e[e.defineCommentRange=48]="defineCommentRange",e[e.deleteCommentRange=49]="deleteCommentRange",e[e.dataValidation=50]="dataValidation",e[e.clearDataValidation=51]="clearDataValidation",e[e.doPaste=52]="doPaste",e[e.inserRowWithLogic=53]="inserRowWithLogic",e[e.insertColWithLogic=54]="insertColWithLogic",e[e.freezePreview=55]="freezePreview",e[e.cancelFreezePreview=56]="cancelFreezePreview",e[e.addConditionFormat=57]="addConditionFormat",e[e.deleteConditionFormat=58]="deleteConditionFormat",e[e.updateConditionFormat=59]="updateConditionFormat",e[e.setSheet=60]="setSheet",e[e.setHorizontalAlign=61]="setHorizontalAlign",e[e.setVerticalAlign=62]="setVerticalAlign",e[e.inserFunction=63]="inserFunction",e[e.setBackgroundColor=64]="setBackgroundColor",e[e.setHideGridlines=65]="setHideGridlines",e[e.setBorder=66]="setBorder",e[e.setFontColor=67]="setFontColor",e[e.fontStrike=68]="fontStrike",e[e.setFontFamily=69]="setFontFamily",e[e.setFontSize=70]="setFontSize",e[e.fontItalics=71]="fontItalics",e[e.fontUnderLine=72]="fontUnderLine",e[e.formatPainterSetCache=73]="formatPainterSetCache",e[e.formatPainterApply=74]="formatPainterApply",e[e.formatPainterClear=75]="formatPainterClear",e[e.insertSheet=76]="insertSheet",e[e.delSheet=77]="delSheet",e[e.moveSheet=78]="moveSheet",e[e.hideSheet=79]="hideSheet",e[e.showSheet=80]="showSheet",e[e.renameSheet=81]="renameSheet",e[e.copySheet=82]="copySheet"}(c||(c={}))}.call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/worker/common/action-types.ts":function(e,t,r){"use strict";var n,o,a,s,i,u,l,c,d;r.d(t,"i",(function(){return n})),r.d(t,"h",(function(){return o})),r.d(t,"b",(function(){return a})),r.d(t,"e",(function(){return s})),r.d(t,"g",(function(){return i})),r.d(t,"f",(function(){return u})),r.d(t,"d",(function(){return l})),r.d(t,"a",(function(){return c})),r.d(t,"c",(function(){return d})),function(e){e.MessageTest="MESSAGETEST",e.HeartBeatTest="HEARTBEATTEST"}(n||(n={})),function(e){e.InitSpreadsheetApp="INITSPREADSHEETAPP",e.InitSpreadsheet="INITSPREADSHEET",e.InitSheet="INITSHEET",e.LoadSheet="LOADSHEET",e.LoadSheetToWorker="LoadSheetToWorker",e.FetchSheetOnMainThread="FETCHSHEETONMAINTHREAD",e.UpdateSpreadsheet="UPDATESPREADSHEET",e.waittingForWorkerSpreadsheetReady="WAITTINGFORWORKERSPREADSHEETREADY",e.syncVisibleAreaToWorker="SYNCVISIBLEAREATOWORKER",e.resetSheetOnWorkerFormula="RESETSHEETONWORKERFORMULA",e.ClearAndReInitSheets="CLEARANDREINITSHEETS",e.ClearAndReInitOneSheet="ClearAndReInitOneSheet",e.TransformSpreadsheetBySheetId="TRANSFORMSPREADSHEETBYSHEETID",e.InformNetworkChange="InformNetworkChange",e.CheckSheetFormulaLayerStatusBetweenThreads="CheckSheetFormulaLayerStatusBetweenThreads"}(o||(o={})),function(e){e.Xsrf="XSRFTOKEN"}(a||(a={})),function(e){e.SyncNonPersistentMutationsToMainThread="SYNCNONPERSISTENTMUTATIONSTOMAINTHREAD",e.CompleteMutationQueue="CompleteMutationQueue"}(s||(s={})),function(e){e.MonitorReport="MONITORREPORT",e.TdwReport="TDWREPORT",e.HuatuoReport="HUATUOREPORT",e.TdwSingleReport="TDWSINGLEREPORT",e.DebuggerAlert="DEBUGGERALERT",e.RunReport="RunReport",e.FlowLogReport="FlowLogReport",e.SpeedRunReport="SpeedRunReport",e.SpeedHasDonePagePerformanceReport="SpeedHasDonePagePerformanceReport",e.WebLog="WebLog"}(i||(i={})),function(e){e.CaptureException="CAPTUREEXCEPTION",e.CaptureWorkerPromiseException="CAPTUREWORKERPROMISEEXCEPTION"}(u||(u={})),function(e){e.Commit="COMMIT",e.AcceptCommit="ACCEPT_COMMIT",e.ApplyNewChanges="APPLY_NEW_CHANGES"}(l||(l={})),function(e){e.DATA_CHANGE="DATA_CHANGE",e.WORKBOOK_RANGE_CHANGE="WORKBOOK_RANGE_CHANGE"}(c||(c={})),function(e){e.Service="Service"}(d||(d={}))},"./src/core/worker/common/base-controller.ts":function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return i}));r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("./src/base/util/timer.ts"),s=r("./src/core/worker/util.ts"),i=function(){function t(){Object(n.a)(this,t),this.isDebugMode=!1,this.actionHandlerMap={}}return Object(o.a)(t,[{key:"request",value:function(e,t){if(this.channel)return this.channel.request(e,t);console.error("\u6ca1\u6709\u901a\u4fe1 Channel.")}},{key:"requestPromise",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;return this.channel?this.channel.requestPromise(e,t,r):Promise.reject(new Error("no Channel."))}},{key:"addActionHandler",value:function(e,t){if(this.isDebugMode&&"%cAdd actionType `".concat(e,"`"),this.hasActionHandler(e))throw new Error("\u5df2\u6ce8\u518c\u4e8b\u52a1 `".concat(e,"` \u7684\u5904\u7406\u5668, \u4e0d\u80fd\u91cd\u590d\u6ce8\u518c"));this.actionHandlerMap[e]=t}},{key:"actionHandler",value:function(t){var r=this,n=t.actionType,o=t.payload;if(!this.hasActionHandler(n))throw new Error("\u6ca1\u6709\u627e\u5230\u4e8b\u52a1 `".concat(n,"` \u7684\u5904\u7406\u5668, \u662f\u5426\u5df2\u6ce8\u518c."));try{var i=this.actionHandlerMap[n](o);return Object(s.c)(i)?i.catch((function(e){return a.a.wait(0).run((function(){r.reportActionHandlerError(n,e)})),Promise.reject(e)})):Promise.resolve(i)}catch(l){var u;return this.reportActionHandlerError(n,l),null===(u=e.log)||void 0===u||u.error("worker action ".concat(n," handler error.")),Promise.reject(l)}}},{key:"addOnmessageListener",value:function(e){var t=this;return this.worker.addEventListener("message",e),function(){t.worker.removeEventListener("message",e)}}},{key:"hasActionHandler",value:function(e){return!!this.actionHandlerMap[e]}},{key:"reportActionHandlerError",value:function(e,t){}}]),t}()}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/worker/common/channel-report.ts":function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return u}));r("../node_modules/core-js/modules/es.function.name.js"),r("../node_modules/core-js/modules/es.object.keys.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../packages/report/src/index.ts"),s=r("./src/base/util/timer.ts"),i=r("./src/core/worker/util.ts"),u=function(){function t(e){var r=this;Object(n.a)(this,t),this.actionLetencyCountMap={},this.isDebugMode=e,s.a.wait(6e4).run((function(){r.letencyReport()}))}return Object(o.a)(t,[{key:"letencyLog",value:function(e){Object(i.a)()-e.time<150||(this.actionLetencyCountMap[e.actionType]=(this.actionLetencyCountMap[e.actionType]||0)+1)}},{key:"timeoutReport",value:function(e){a.b.tdwReport({opername:"tech_doc",module:"webworker",action:"channel_time_out",ver5:JSON.stringify(e)})}},{key:"requestDurationReport",value:function(e,t,r){if(e>t){var n={actionType:r,duration:e,inWorker:!1};a.b.tdwReport({opername:"tech_doc",module:"webworker",action:"channel_long_time",ver5:JSON.stringify(n)})}}},{key:"onmesssageDebugLog",value:function(e){0}},{key:"postMessageDebugLog",value:function(e){0}},{key:"letencyReport",value:function(){var t;if(0!==Object.keys(this.actionLetencyCountMap).length){var r={worker:!1,letency:this.actionLetencyCountMap};null===(t=e.log)||void 0===t||t.info("worker channel letency",r),a.b.tdwReport({opername:"tech_doc",module:"webworker",action:"channel_letency",ver5:JSON.stringify(r)}),this.actionLetencyCountMap={}}}}]),t}()}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/worker/common/channel.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array-buffer.constructor.js"),r("../node_modules/core-js/modules/es.array-buffer.slice.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n,o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=r("../node_modules/nanoid/non-secure.js"),i=r.n(s),u=r("./src/base/util/timer.ts");!function(e){e.REQUEST="REQUEST",e.REPLY="REPLY"}(n||(n={}));var l=r("./src/core/worker/config.ts"),c=r("./src/core/worker/util.ts"),d=r("./src/core/worker/common/channel-report.ts"),f=function(){function e(t,r){Object(o.a)(this,e),this.worker=t,this.controller=r,this.sessionHandlerMap={},this.channelReport=new d.a(this.controller.isDebugMode),this.worker.addEventListener("message",this.onmessage.bind(this))}return Object(a.a)(e,[{key:"request",value:function(e,t){var r=this.generateSessionId();this.postMessage({messageType:n.REQUEST,actionType:e,payload:t,sessionId:r,time:Object(c.a)()}),this.addSessionHandler(r,(function(){}))}},{key:"requestPromise",value:function(e,t){var r=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.a,a=Date.now(),s=this.generateSessionId(),i={messageType:n.REQUEST,actionType:e,payload:t,sessionId:s,time:Object(c.a)()},d=0,f=function(t){r.addSessionHandler(s,(function(n){r.deleteSessionHandler(n.sessionId),u.a.erase(d);var s=Date.now()-a;r.channelReport.requestDurationReport(s,o,e),t(n.payload)})),r.postMessage(i)};return d=u.a.wait(o).run((function(){u.a.erase(d),r.channelReport.timeoutReport({actionType:e,isInWorker:!1})})),new Promise(f)}},{key:"onmessage",value:function(e){var t=this,r=e.data,o=r.messageType,a=r.sessionId,s=r.actionType;if(this.channelReport.letencyLog(r),this.channelReport.onmesssageDebugLog(r),o===n.REQUEST)this.controller.actionHandler(r).then((function(e){t.response(a,s,e)}));else if(o===n.REPLY){if(!this.hasSessionHandler(a))throw new Error("\u6ca1\u6709\u627e\u5230\u4f1a\u8bdd `".concat(a,"` \u7684\u54cd\u5e94\u5668."));this.sessionHandlerMap[a](r)}}},{key:"response",value:function(e,t,r){this.postMessage({messageType:n.REPLY,actionType:t,payload:r,sessionId:e,time:Object(c.a)()})}},{key:"postMessage",value:function(e){var t=e.payload,r=[];(null===t||void 0===t?void 0:t.transferProps)&&t.transferProps.forEach((function(e){Object.prototype.hasOwnProperty.call(t,e)?t[e]instanceof ArrayBuffer?r.push(t[e]):t[e].buffer?t[e].buffer instanceof ArrayBuffer&&r.push(t[e].buffer):console.error("Payload porps ".concat(e," without buffer")):console.error("Payload without porps ".concat(e))})),this.worker.postMessage(e,r),this.channelReport.postMessageDebugLog(e)}},{key:"addSessionHandler",value:function(e,t){if(this.hasSessionHandler(e))throw new Error("\u4f1a\u8bdd Id `".concat(e,"` \u5df2\u7ecf\u5b58\u5728, \u8fd9\u4e0d\u53ef\u80fd!"));this.sessionHandlerMap[e]=t}},{key:"deleteSessionHandler",value:function(e){this.hasSessionHandler(e)&&delete this.sessionHandlerMap[e]}},{key:"generateSessionId",value:function(){return"w_".concat(i()(14))}},{key:"hasSessionHandler",value:function(e){return!!this.sessionHandlerMap[e]}}]),e}();t.a=f},"./src/core/worker/config.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return o})),r.d(t,"d",(function(){return a})),r.d(t,"c",(function(){return s}));var n=3e4,o=5e3,a=3e4,s=1e4},"./src/core/worker/index.ts":function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return l}));r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=r("./src/base/util/timer.ts"),a=r("./src/core/worker/config.ts"),s=r("./src/core/worker/main-thread/index.ts");function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(t){var r=e.location.href.indexOf("debugWorker=1")>=0,n=new s.a(u(u({},t),{},{isDebugMode:t.isDebugMode||r,workerUrl:c()}));return n.canNewWorker?function(e){var t=o.a.wait(a.a).run((function(){e.reportWorkerStatus()}));e.workerAbilityTest.runTest().then((function(r){var n=Date.now();o.a.erase(t),e.controller.isDebugMode&&"%cFirst comunication duration: ".concat(r,"ms");var s=r>a.a;e.reportWorkerStatus(s,n)})).catch((function(t){e.controller.isDebugMode&&console.error("%cFirst communication timeout: ".concat(t),"color: orange")})),o.a.wait(a.c).run((function(){e.startHeartBeatCheck()}))}(n):n.reportWorkerStatus(),n}function c(){var t=e,r=t.__globalWorkerFilePath,n="";return t.location.href.indexOf("showLog=1")>=0&&(n+="showLog=1"),t.location.href.indexOf("showFormulaLog=1")>=0&&(n+="&showFormulaLog=1"),n&&(r="".concat(r,"?").concat(n)),r}}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/worker/main-thread/charts.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),s=r("../packages/mutation/src/workbook/workbookRange/UpdateWorkbookRangeMutation.ts"),i=r("../packages/model/src/workbookRange/WorkbookRangeDelta.ts"),u=r("../packages/model/src/workbookRange/WorkbookRangeType.ts"),l=r("../packages/model/src/range/GridRange.ts"),c=r("../packages/model/src/range/hexRangeUtils.ts"),d=r("./src/base/util/timer.ts"),f=r("./src/core/worker/common/action-types.ts"),h=r("./src/core/worker/main-thread/interfaces/controller.interface.ts"),m=function(e,t,r,n){var o,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(a.a)(Reflect))&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(s<3?o(i):s>3?o(t,r,i):o(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},p=function(e,t){return function(r,n){t(r,n,e)}},v=function(){function t(e){Object(n.a)(this,t),this.controller=e,this.controller=e,this.addActionListener()}return Object(o.a)(t,[{key:"listenDataChange",value:function(e){var t=e.workbookRangeId;this.reRenderChart(t)}},{key:"listenWorkbookRangeChange",value:function(e){var t=e.workbookRangeId,r=e.rangeStr,n=e.sheetId,o=e.isRef;this.updateWorkbookRange(t,r,n,o),this.reRenderChart(t)}},{key:"updateWorkbookRange",value:function(e,t,r,n){var o=n?new l.b(r,-1,-1,-1,-1):Object(c.hex2Range)(t,r),a=this.generateUpdateWorkbookRangeMutation(e,o);a&&this.applyMutation(a,r)}},{key:"generateUpdateWorkbookRangeMutation",value:function(t,r){var n=e.SpreadsheetApp,o=n.spreadsheet.workbookRangeManager.getChartWorkbookRangeById(t);if(!o)return null;var a=o.embeddedObjectId,l=n.spreadsheet.embeddedObjectManager.getEmbeddedObject(a);if(!l)return null;var c=new i.a;return c.setEmbeddedObjectId(l.objectId),new s.a({gridRange:r,workbookRangeId:t,workbookRangeType:u.a.CHART,workbookRangePropertiesDelta:c})}},{key:"applyMutation",value:function(t,r){var n=e.SpreadsheetApp,o=n.spreadsheet.sheetManager.getSheetBySheetId(r);(null===o||void 0===o?void 0:o.isLoaded)&&n.mutationBehavior.applyMutation(t,{isLocal:!0,isFromFormula:!1})}},{key:"addActionListener",value:function(){this.controller.addActionHandler(f.a.DATA_CHANGE,this.listenDataChange.bind(this)),this.controller.addActionHandler(f.a.WORKBOOK_RANGE_CHANGE,this.listenWorkbookRangeChange.bind(this))}},{key:"reRenderChart",value:function(t){var r=e.SpreadsheetApp;d.a.wait(0).run((function(){r.view.canvas.dataCallView.reRenderChart({workbookRangeId:t})}))}}]),t}();v=m([p(0,h.a)],v),t.a=v}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/worker/main-thread/controller.ts":function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return m}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),s=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),i=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),u=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),l=r("../packages/report/src/index.ts"),c=r("./src/base/config/report.ts"),d=r("./src/core/worker/common/base-controller.ts"),f=r("./src/core/worker/common/channel.ts");function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(u.a)(e);if(t){var o=Object(u.a)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var m=function(t){Object(s.a)(u,t);var r=h(u);function u(t){var o;Object(n.a)(this,u),(o=r.call(this)).canNewWorker=u.hasWorkerClass;try{if(!o.canNewWorker)return Object(i.a)(o);o.timeBeforeNewWorker=Date.now();var s=t.workerUrl;if(t.isDebugMode){o.isDebugMode=!0;s=s.indexOf("?")>0?"".concat(s,"&").concat("debugWorker=1"):"".concat(s,"?").concat("debugWorker=1")}o.worker=new Worker(s,{name:t.workerName}),o.worker.onerror=function(t){var r;console.error("worker onerror",t),null===(r=e.log)||void 0===r||r.error("worker onerror",t),l.b.monitor(34945353)},o.timeAfterNewWorker=Date.now(),o.channel=new f.a(o.worker,Object(a.a)(o))}catch(h){var d;console.error("worker init error:",h),null===(d=e.log)||void 0===d||d.error("worker onerror",h),o.canNewWorker=!1,l.b.run(c.CONFIG.CREATE_WORKER_ERROR,h)}return o}return Object(o.a)(u,[{key:"terminate",value:function(){this.worker.terminate()}},{key:"reportActionHandlerError",value:function(t,r){var n;throw console.error("Worker aciton ".concat(t," error:"),r),null===(n=e.log)||void 0===n||n.error(t,r),l.b.monitor(34094592),new Error(r)}}]),u}(d.a);m.hasWorkerClass=!!window.Worker}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/worker/main-thread/cookie.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),s=r("./src/core/worker/main-thread/interfaces/controller.interface.ts"),i=r("./src/core/worker/common/action-types.ts"),u=r("../packages/utils/src/safe.ts"),l=function(e,t,r,n){var o,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(a.a)(Reflect))&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(s<3?o(i):s>3?o(t,r,i):o(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},c=function(e,t){return function(r,n){t(r,n,e)}},d=function(){function e(t){Object(n.a)(this,e),this.controller=t,this.addActionListener()}return Object(o.a)(e,[{key:"getXsrf",value:function(){return Object(u.b)()}},{key:"addActionListener",value:function(){this.controller.addActionHandler(i.b.Xsrf,this.getXsrf.bind(this))}}]),e}();d=l([c(0,s.a)],d),t.a=d},"./src/core/worker/main-thread/dynamic.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/regenerator-runtime/runtime.js");var n=r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),i=r("./src/core/worker/main-thread/interfaces/controller.interface.ts"),u=r("../packages/report/src/index.ts"),l=r("./src/base/util/timer.ts"),c=r("./src/core/worker/common/action-types.ts"),d=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(s.a)(Reflect))&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},f=function(e,t){return function(r,n){t(r,n,e)}},h=function(){function t(e){Object(o.a)(this,t),this.controller=e,this.LoadServiceTimeout=2e4,this.loadedServicesMap={}}return Object(a.a)(t,[{key:"service",value:function(){var t=Object(n.a)(regeneratorRuntime.mark((function t(r){var n,o,a,s,i,u=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=r.replace("?.*$",""),!this.loadedServicesMap[o]){t.next=3;break}return t.abrupt("return",this.loadedServicesMap[o]);case 3:return null===(n=e.log)||void 0===n||n.info("Worker service start, ".concat(r)),a=l.a.wait(this.LoadServiceTimeout).run((function(){l.a.erase(a),u.loadServiceTimeoutReport(r)})),t.next=7,this.controller.requestPromise(c.c.Service,{serviceUrl:r});case 7:return s=t.sent,l.a.erase(a),i=this.getServiceFromServiceInfo(s),this.loadedServicesMap[o]=i,this.loadServiceSuccessReport(r),t.abrupt("return",i);case 13:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getServiceFromServiceInfo",value:function(e){var t=this,r=e.serviceName,n=e.serviceActionNameList,o={name:r};return n.forEach((function(e){var n="".concat(r,".").concat(e);o[e]=function(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return t.controller.requestPromise(n,r)}})),o}},{key:"loadServiceTimeoutReport",value:function(t){var r,n="Worker service timeout, ".concat(t);console.error(n),u.b.monitor(35444981),u.b.tdwReport({opername:"tech_doc",module:"webworker",action:"main_worker_service_timeout",ver5:t}),null===(r=e.log)||void 0===r||r.error(n)}},{key:"loadServiceSuccessReport",value:function(t){var r;u.b.monitor(35445032),null===(r=e.log)||void 0===r||r.info("Worker service success, ".concat(t))}}]),t}();h=d([f(0,i.a)],h),t.a=h}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/worker/main-thread/heart-beat-check.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),s=r("../packages/report/src/index.ts"),i=r("./src/base/util/timer.ts"),u=r("./src/base/error/errorCodeModalProxy.ts"),l=r("./src/core/worker/config.ts"),c=r("./src/core/worker/main-thread/interfaces/controller.interface.ts"),d=r("../packages/services/src/instantiation.ts"),f=Object(d.c)("IMainThreadWorkerAbilityTest"),h=function(e,t,r,n){var o,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(a.a)(Reflect))&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(s<3?o(i):s>3?o(t,r,i):o(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},m=function(e,t){return function(r,n){t(r,n,e)}},p=function(){function e(t,r){Object(n.a)(this,e),this.controller=t,this.workerAbilityTest=r,this.isHeartBeatTesting=!1,this.heartBeatNow=0,this.sickHeartBeats=[]}return Object(o.a)(e,[{key:"start",value:function(){var e=this;this.checkInterValHandle=setInterval((function(){e.checkHeartBeat()}),l.b),this.removeOnmessageListener=this.controller.addOnmessageListener(this.onmessageAsHealthHeartBeat.bind(this))}},{key:"stop",value:function(){var e;clearInterval(this.checkInterValHandle),i.a.erase(this.checkTimeoutHandle),null===(e=this.removeOnmessageListener)||void 0===e||e.call(this),this.removeOnmessageListener=null}},{key:"checkHeartBeat",value:function(){var e=this;if(!this.isHeartBeatTesting){this.isHeartBeatTesting=!0,this.heartBeatNow+=1;var t=Date.now();this.workerAbilityTest.heartBeatTest(this.heartBeatNow).then((function(){e.isHeartBeatTesting=!1,i.a.erase(e.checkTimeoutHandle);var r=Date.now()-t;e.durationReport(r)})),i.a.erase(this.checkTimeoutHandle),this.checkTimeoutHandle=i.a.wait(l.d).run((function(){e.isHeartBeatTesting=!1,i.a.erase(e.checkTimeoutHandle),e.sickHeartBeats.push(e.heartBeatNow),e.checkHealth()}))}}},{key:"onmessageAsHealthHeartBeat",value:function(){this.isHeartBeatTesting&&(this.isHeartBeatTesting=!1,i.a.erase(this.checkTimeoutHandle))}},{key:"checkHealth",value:function(){var e=this.sickHeartBeats.length;e>=2&&this.sickHeartBeats[e-2]+1===this.sickHeartBeats[e-1]&&(this.stop(),this.deadReport(),this.showDeadTip())}},{key:"showDeadTip",value:function(){u.b.showFormulaLayerCalcErrorTips()}},{key:"durationReport",value:function(e){e>3e4&&(s.b.monitor(33969412),s.b.tdwReport({opername:"tech_doc",module:"webworker",action:"worker_heartbeat_duration",ver5:e}))}},{key:"deadReport",value:function(){s.b.monitor(33969414),s.b.tdwReport({opername:"tech_doc",module:"webworker",action:"worker_heartbeat_dead",ver5:this.sickHeartBeats[this.checkHeartBeat.length-1]})}}]),e}();p=h([m(0,c.a),m(1,f)],p);t.a=p},"./src/core/worker/main-thread/index.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../node_modules/@babel/runtime/helpers/esm/get.js"),s=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),i=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),u=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),l=r("./src/core/worker/main-thread/message-center-data.ts"),c=r("./src/core/feature/formula/utils.ts"),d=r("./src/core/worker/main-thread/controller.ts"),f=r("./src/core/worker/main-thread/heart-beat-check.ts"),h=r("./src/core/worker/main-thread/worker-ability-test.ts"),m=r("./src/core/worker/main-thread/report.ts"),p=r("./src/core/worker/main-thread/raven.ts"),v=r("./src/core/worker/main-thread/cookie.ts"),g=r("./src/core/worker/main-thread/sheet-data.ts"),y=r("./src/core/worker/main-thread/mutation-data.ts"),_=r("./src/core/worker/main-thread/charts.ts"),b=r("../packages/report/src/index.ts"),A=r("./src/core/app/tool.ts"),E=r("../packages/services/src/dispose.ts"),j=r("./src/core/worker/main-thread/dynamic.ts");function R(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(u.a)(e);if(t){var o=Object(u.a)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var S=function(t){Object(s.a)(i,t);var r=R(i);function i(t){var o;return Object(n.a)(this,i),(o=r.call(this)).isTerminated=!1,o.loadSheetToWorkerIfNeeded=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{checked:!1,defaultNeedLoadInWorker:!1},n=r.checked,a=r.defaultNeedLoadInWorker;if(o.workerHasInitSheetMap[t])return!1;var s=e.SpreadsheetApp,i=!1;if(n)i=a;else{var u=Object(c.g)(s.spreadsheet,t);i=u.needLoadInWorker}if(i){var l=[],d=[];return s.spreadsheet.embeddedObjectManager.each((function(e){e.location.sheetId===t&&(d.push(e.serialize()),e.properties.chart.workbookRangeId.forEach((function(e){var t=s.spreadsheet.workbookRangeManager.getChartWorkbookRangeById(e);t&&l.push(t.serialize())})))})),o.sheetData.loadSheetToWorker({sheetId:t,serializeData:s.spreadsheet.sheetManager.getSheetBySheetId(t).serialize(),newWorkbookRanges:l,newEmbeddedObjects:d}),o.workerHasInitSheetMap[t]=!0,!0}return!1},o.handleCommit=function(e){var t=e.userChange.sheetId;e.userChange.mutations.length>1&&console.warn("\u6b64\u6b21\u7f51\u7edc\u5c42\u540c\u6b65\u5305\u542b\u591a\u6b21\u8bf7\u6c42\u7684 mutation."),o.messageCenterData.handleCommit(e),o.loadSheetToWorkerIfNeeded(t)},o.handleApplyNewChanges=function(e){var t=e.changeInfo.sheetId;o.messageCenterData.handleApplyNewChanges(e),o.loadSheetToWorkerIfNeeded(t)},o.initListeners=function(){var t=e.SpreadsheetApp;o._register(t.messageCenter.sendMessageCenter.onUserChangeNew((function(e){return o.handleCommit(e)}))),o._register(t.messageCenter.sendMessageCenter.onUserChangeUpdate((function(e){return o.handleCommit(e)}))),o._register(t.messageCenter.sendMessageCenter.onAcceptCommit((function(e){return o.messageCenterData.handleAcceptCommit(e)}))),o._register(t.messageCenter.receiveMessageCenter.onAfterApplyCollabMutations((function(e){return o.handleApplyNewChanges(e)})))},o.controller=new d.a(t),o.workerAbilityTest=new h.a(o.controller),o.report=new m.a(o.controller),o.raven=new p.a(o.controller),o.cookie=new v.a(o.controller),o.sheetData=new g.a(o.controller),o.mutationData=new y.a(o.controller),o.charts=new _.a(o.controller),o.heartBeatCheck=new f.a(o.controller,o.workerAbilityTest),o.messageCenterData=new l.a(o.controller,o.mutationData),o.dynamic=new j.a(o.controller),o.workerHasInitSheetMap={},e.SpreadsheetApp.emitter.on(e.SpreadsheetApp.EVENT.SPREAD_SHEET_EDITABLE,o.initListeners),o}return Object(o.a)(i,[{key:"clearWorkerHasInitSheetMap",value:function(e){this.workerHasInitSheetMap[e]&&(this.workerHasInitSheetMap[e]=!1)}},{key:"startHeartBeatCheck",value:function(){this.isTerminated||this.heartBeatCheck.start()}},{key:"dispose",value:function(){var t;Object(a.a)(Object(u.a)(i.prototype),"dispose",this).call(this),null===(t=e.log)||void 0===t||t.debug("flow MainThreadWorker destroy()"),A.a.window.SpreadsheetApp.emitter.off(A.a.window.SpreadsheetApp.EVENT.SPREAD_SHEET_EDITABLE,this.initListeners),this.heartBeatCheck.stop(),this.controller.terminate(),this.isTerminated=!0}},{key:"reportWorkerStatus",value:function(){var t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(r&&b.b.monitor(34097396),!0!==i.hasReportWorkerStatus){i.hasReportWorkerStatus=!0;var o=d.a.hasWorkerClass,a=this.controller.canNewWorker,s=!!n,u=-1;s&&n&&(u=n-this.controller.timeBeforeNewWorker);var l=NaN;this.controller.timeAfterNewWorker&&this.controller.timeBeforeNewWorker&&(l=this.controller.timeAfterNewWorker-this.controller.timeBeforeNewWorker),this.workerStatus={hasWorkerClass:o,canNewWorker:a,canPostMessage:s,workerReadyDuration:u,newWorkerDuration:l},b.b.tdwReport({opername:"tech_doc",module:"formula_worker",action:"worker_status",ver5:JSON.stringify(this.workerStatus)}),a||b.b.monitor(33848585),s||b.b.monitor(33848586),null===(t=e.log)||void 0===t||t.info("workerStatus",this.workerStatus)}}},{key:"canNewWorker",get:function(){return this.controller.canNewWorker}}]),i}(E.a);S.hasReportWorkerStatus=!1,t.a=S}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/worker/main-thread/interfaces/controller.interface.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r("../packages/services/src/instantiation.ts"),o=Object(n.c)("IMainThreadController")},"./src/core/worker/main-thread/message-center-data.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),a=r("./src/core/worker/main-thread/interfaces/controller.interface.ts"),s=r("./src/core/worker/common/action-types.ts"),i=r("./src/core/network/message-center/model/userChange-helper.ts"),u=r("./src/core/network/message-center/model/missChange-helper.ts"),l=r("../packages/services/src/instantiation.ts"),c=Object(l.c)("IMainThreadMutationData"),d=function(e,t){return function(r,n){t(r,n,e)}},f=function e(t,r){var o=this;Object(n.a)(this,e),this.controller=t,this.mutationData=r,this.handleCommit=function(e){var t=[];e.userChange.mutations.forEach((function(e){t=t.concat(e)}));var r=o.mutationData.updateMutationQueue(t,e.userChange.taskId),n={userChangeOptions:Object(i.b)(e.userChange),mutationQueueId:r};o.controller.requestPromise(s.d.Commit,n)},this.handleAcceptCommit=function(e){o.controller.requestPromise(s.d.AcceptCommit,{sheetId:e.sheetId,newVersion:e.newVersion})},this.handleApplyNewChanges=function(e){var t=o.mutationData.updateMutationQueue(e.mutations,e.changeInfo.commitId),r={changeInfoOptions:Object(u.b)(e.changeInfo),mutationQueueId:t};o.controller.requestPromise(s.d.ApplyNewChanges,r)}};f=function(e,t,r,n){var a,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(o.a)(Reflect))&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(a=e[u])&&(i=(s<3?a(i):s>3?a(t,r,i):a(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i}([d(0,a.a),d(1,c)],f);t.a=f},"./src/core/worker/main-thread/mutation-data.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.reduce.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),i=r("../packages/report/src/index.ts"),u=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),l=r.n(u),c=r("./src/core/ui/toast/index.ts"),d=r("./src/core/worker/main-thread/mutation-queue.ts"),f=r("./src/core/feature/formula/calcControllerTaskQueue.ts"),h=r("./src/base/util/timer.ts"),m=r("./src/core/worker/main-thread/interfaces/controller.interface.ts"),p=r("./src/core/worker/common/action-types.ts"),v=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(s.a)(Reflect))&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},g=function(e,t){return function(r,n){t(r,n,e)}},y=!1,_=148,b=149,A=150,E=152,j=153,R=154,S=function(){function t(e){var r=this;Object(o.a)(this,t),this.controller=e,this.workerHasFirstResult=!1,this.workerHasVisibleResult=!1,this.workerHasFullResult=!1,this.workerResultTime={hasFirstResult:0,hasVisibleResult:0,hasFullResult:0,isCrossResult:!1},this.workerResultHasReport=!1,this.mutationQueue=new d.a,this.addListenActions(),this.mutationHandleStartTimeMap={},l.a.isPC&&this.showCalculatingToast(),h.a.wait(12e4).run((function(){r.workerResultHasReport=!0}))}return Object(a.a)(t,[{key:"syncNonPersistentMutationsToMainThread",value:function(t){var r=t.serializedMutations,n=t.isFromFormula,o=t.latestMutationQueueIdInWorker,a=t.needToSetIntializedDone,s=void 0!==a&&a,u=t.isInVisibleArea,l=void 0!==u&&u,c=t.relatedSheetIds,d=t.canCheckUnfinishedCalculationNode,h=void 0!==d&&d,m=t.muationQueueRunnedIndex;this.getWorkerResultTime({serializedMutationsLength:r.length,isFromFormula:n,needToSetIntializedDone:s,canCheckUnfinishedCalculationNode:h,isInVisibleArea:l,relatedSheetIds:c||[]});var p=e.SpreadsheetApp,v=r.reduce((function(e,t){var r=p.mutationBehavior.deserializeMutation(t);return r&&e.push(r),e}),[]);if(this.mutationQueue.transform(o,v,m).forEach((function(e){var t,r=e.getAffectedSheetId(),o=((null===(t=p.preview)||void 0===t?void 0:t.isActive)?p.preview.previewsheet:p.spreadsheet).sheetManager.getSheetBySheetId(r);(null===o||void 0===o?void 0:o.isLoaded)&&p.mutationBehavior.applyMutation(e,{isLocal:!0,isFromFormula:n})})),this.mutationQueue.complete(o),null===c||void 0===c||c.forEach((function(e){p.calcController?s&&p.calcController.sheetFormulaLayerStatusMap.isSheetCalculating(e)&&p.calcController.sheetFormulaLayerStatusMap.setInitializedDone(e):Object(f.a)((function(){s&&p.calcController.sheetFormulaLayerStatusMap.isSheetCalculating(e)&&p.calcController.sheetFormulaLayerStatusMap.setInitializedDone(e)}))})),!y){var g="undefined"!==typeof this.mutationHandleStartTimeMap[o]?this.mutationHandleStartTimeMap[o]:p.getCurrentMainThreadWorker().sheetData.initSheetDataTime;if("number"===typeof g){var _,b=Date.now()-g;if(h?b>2e4:b>5e3)null===(_=i.b.tdwReport)||void 0===_||_.call(i.b,{opername:"doc_excel",module:"formula_worker",action:"worker_handle_mutation_timeout",ver5:JSON.stringify({duration:b,type:h?0:1})}),i.b.monitor(h?33969191:33969190),y=!0}}return this.workerResultTimeReport(),!0}},{key:"updateMutationQueue",value:function(){var e,t=(e=this.mutationQueue).push.apply(e,arguments);return this.mutationHandleStartTimeMap[t]=Date.now(),t}},{key:"addListenActions",value:function(){this.controller.addActionHandler(p.e.CompleteMutationQueue,this.completeMutationQueue.bind(this)),this.controller.addActionHandler(p.e.SyncNonPersistentMutationsToMainThread,this.syncNonPersistentMutationsToMainThread.bind(this))}},{key:"completeMutationQueue",value:function(e){var t=e.mutationQueueId;this.mutationQueue.complete(t)}},{key:"getWorkerResultTime",value:function(t){var r=t.serializedMutationsLength,n=t.canCheckUnfinishedCalculationNode,o=t.isInVisibleArea,a=t.relatedSheetIds;if(!this.workerResultHasReport&&!(this.workerHasFirstResult&&this.workerHasVisibleResult&&this.workerHasFullResult)&&(!this.workerHasFirstResult&&r>0&&(this.workerHasFirstResult=!0,this.workerResultTime.hasFirstResult=Date.now()),!this.workerHasVisibleResult&&this.workerHasFirstResult&&o&&(this.workerResultTime.hasVisibleResult=Date.now()),this.workerHasVisibleResult||!this.workerHasFirstResult||o||(this.workerHasVisibleResult=!0,this.workerResultTime.hasVisibleResult=this.workerResultTime.hasVisibleResult||Date.now()),!this.workerHasFullResult&&n)){this.workerHasFullResult=!0,this.workerResultTime.hasFullResult=Date.now();var s=e.SpreadsheetApp.spreadsheet.activeSheetId;(1===a.length&&a[0]!==s||a.length>1)&&(this.workerResultTime.isCrossResult=!0)}}},{key:"workerResultTimeReport",value:function(){if(!this.workerResultHasReport&&this.workerHasFirstResult&&this.workerHasVisibleResult&&this.workerHasFullResult){var t,r=null===(t=e.performanceData)||void 0===t?void 0:t.jsStartRun;if(r){var o,a,s;this.workerResultTime={hasFirstResult:this.workerResultTime.hasFirstResult-r,hasVisibleResult:this.workerResultTime.hasVisibleResult-r,hasFullResult:this.workerResultTime.hasFullResult-r,isCrossResult:this.workerResultTime.isCrossResult},null===(o=i.b.tdwReport)||void 0===o||o.call(i.b,{opername:"doc_excel",module:"formula_worker",action:"worker_result_time",ver5:JSON.stringify(this.workerResultTime)});var u=this.workerResultTime.isCrossResult?(a={},Object(n.a)(a,E,this.workerResultTime.hasFirstResult),Object(n.a)(a,j,this.workerResultTime.hasVisibleResult),Object(n.a)(a,R,this.workerResultTime.hasFullResult),a):(s={},Object(n.a)(s,_,this.workerResultTime.hasFirstResult),Object(n.a)(s,b,this.workerResultTime.hasVisibleResult),Object(n.a)(s,A,this.workerResultTime.hasFullResult),s);i.b.huatuo({appid:20533,flag1:22213,flag2:1,flag3:1,speedTime:u},!0)}this.workerResultHasReport=!0}}},{key:"showCalculatingToast",value:function(){var t=e.SpreadsheetApp.spreadsheet.activeSheetId;h.a.wait(1e4).run((function(){var r,n,o=e.SpreadsheetApp;if(!(null===(r=o.preview)||void 0===r?void 0:r.isActive)&&o.spreadsheet.activeSheetId===t){var a=null===(n=o.calcController)||void 0===n?void 0:n.sheetFormulaLayerStatusMap.isSheetInitialized(t);"boolean"!==typeof a||a||(Object(c.hideToast)(),Object(c.showToast)("\u51fd\u6570\u6b63\u5728\u8ba1\u7b97\u4e2d\uff0c\u82e5\u52a0\u8f7d\u65f6\u95f4\u8fc7\u957f\uff0c\u8bf7\u5237\u65b0\u8bd5\u8bd5\u3002",void 0,{btnTextAfter:"",toolToastCloseTime:3e3}),i.b.monitor(35328652))}}))}}]),t}();S=v([g(0,m.a)],S),t.a=S}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/worker/main-thread/mutation-queue.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.array.splice.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../packages/report/src/index.ts"),s=r("./src/base/config/report.ts"),i=-1,u=!1,l=function(){function t(){Object(n.a)(this,t),this.queue=[]}return Object(o.a)(t,[{key:"push",value:function(e,t){var r=t;return this.queue.push({mutations:e,id:r,isComplete:!1,startTime:Date.now()}),this.queue.length<=200||(this.queue.splice(0,this.queue.length-200),this.queueMaxLengthReport(r)),r}},{key:"transform",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,o=[],a=[r],s=!1,i=!1;-1===t&&(s=!0,i=!0);for(var u=0,l=this.queue.length;u<l;u++)s?o.push(this.queue[u].mutations):this.queue[u].id===t&&(n>=0&&n<this.queue[u].mutations.length-1&&o.push(this.queue[u].mutations.slice(n+1)),s=!0,i=!0);if(i){var c=e.SpreadsheetApp.mutationBehavior.followRequestMutations(o,a,!0);return c[0]}return r}},{key:"complete",value:function(e){if(-1!==e){for(var t=0,r=0,n=this.queue.length;r<n;r++)if(this.queue[r].id===e){this.queue[r].isComplete||(this.queue[r].isComplete=!0,t=r,this.completeTimeoutReport(this.queue[r]));break}this.queue.splice(0,t)}}},{key:"queueMaxLengthReport",value:function(t){i<6&&(a.b.run(s.CONFIG.MUTATION_QUEUE_MAX_SIZE,[t,JSON.stringify(this.queue[this.queue.length-1]).substring(0,100)]),i+=1),u||(e.SpreadsheetApp.getCurrentMainThreadWorker().sheetData.checkSheetFormulaLayerStatusBetweenThreads().then((function(e){e||a.b.monitor(34277139)})),u=!0)}},{key:"completeTimeoutReport",value:function(e){Date.now()-e.startTime<=3e4||a.b.run(s.CONFIG.MUTATION_QUEUE_COMPLETE_TIMEOUT,[e.id,JSON.stringify(e).substring(0,100)])}}]),t}();t.a=l}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/worker/main-thread/raven.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.object.assign.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),s=r("./src/core/worker/main-thread/interfaces/controller.interface.ts"),i=r("./src/core/worker/common/action-types.ts"),u=function(e,t,r,n){var o,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(a.a)(Reflect))&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(s<3?o(i):s>3?o(t,r,i):o(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},l=function(e,t){return function(r,n){t(r,n,e)}},c=function(){function e(t){Object(n.a)(this,e),this.controller=t,this.addActionListener()}return Object(o.a)(e,[{key:"captureException",value:function(e){var t,r=e.errorString,n=e.params;null===(t=window.Raven)||void 0===t||t.captureException("from-worker: ".concat(r),n)}},{key:"captureWorkerPromiseException",value:function(e){var t=e.message,r=e.stack;try{var n,o=Object.assign(new Error,{message:t,stack:r});null===(n=window.Raven)||void 0===n||n.captureException(o)}catch(a){console.error(a)}}},{key:"addActionListener",value:function(){this.controller.addActionHandler(i.f.CaptureException,this.captureException.bind(this)),this.controller.addActionHandler(i.f.CaptureWorkerPromiseException,this.captureWorkerPromiseException.bind(this))}}]),e}();c=u([l(0,s.a)],c),t.a=c},"./src/core/worker/main-thread/report.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js");var n=r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),i=r("../packages/report/src/index.ts"),u=r("./src/core/worker/main-thread/interfaces/controller.interface.ts"),l=r("./src/core/worker/common/action-types.ts"),c=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(s.a)(Reflect))&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},d=function(e,t){return function(r,n){t(r,n,e)}},f=function(){function t(e){Object(o.a)(this,t),this.controller=e,this.controller=e,this.addActionListener()}return Object(a.a)(t,[{key:"monitor",value:function(e){i.b.monitor(e)}},{key:"tdw",value:function(e){i.b.tdwReport(e)}},{key:"huatuo",value:function(e){i.b.huatuo(e,!0)}},{key:"tdwSingleReport",value:function(e){var t=e.data,r=e.disableParam;i.b.tdwSingleReport(t,r)}},{key:"run",value:function(e){var t=e.args;i.b.run.apply(i.b,Object(n.a)(t))}},{key:"speedRunReport",value:function(e){var t,r=e.args;(t=i.b.speed).runReport.apply(t,Object(n.a)(r))}},{key:"speedHasDonePagePerformanceReport",value:function(e){var t,r=e.args;(t=i.b.speed).hasDonePagePerformanceReport.apply(t,Object(n.a)(r))}},{key:"flowLog",value:function(e){var t=e.args;i.b.flowlog.apply(i.b,Object(n.a)(t))}},{key:"debuggerAlert",value:function(e){alert(e)}},{key:"weblog",value:function(t){var r,o,a=t.level,s=t.args;null===(r=e.log)||void 0===r||null===(o=r[a])||void 0===o||o.call.apply(o,[r,"[worker]"].concat(Object(n.a)(s)))}},{key:"addActionListener",value:function(){this.controller.addActionHandler(l.g.MonitorReport,this.monitor.bind(this)),this.controller.addActionHandler(l.g.TdwReport,this.tdw.bind(this)),this.controller.addActionHandler(l.g.HuatuoReport,this.huatuo.bind(this)),this.controller.addActionHandler(l.g.TdwSingleReport,this.tdwSingleReport.bind(this)),this.controller.addActionHandler(l.g.DebuggerAlert,this.debuggerAlert.bind(this)),this.controller.addActionHandler(l.g.RunReport,this.run.bind(this)),this.controller.addActionHandler(l.g.FlowLogReport,this.flowLog.bind(this)),this.controller.addActionHandler(l.g.SpeedRunReport,this.speedRunReport.bind(this)),this.controller.addActionHandler(l.g.SpeedHasDonePagePerformanceReport,this.speedHasDonePagePerformanceReport.bind(this)),this.controller.addActionHandler(l.g.WebLog,this.weblog.bind(this))}}]),t}();f=c([d(0,u.a)],f),t.a=f}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/worker/main-thread/sheet-data.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.object.assign.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js");var n=r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),o=(r("../node_modules/regenerator-runtime/runtime.js"),r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js")),a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),s=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),u=r("../packages/utils/src/safe.ts"),l=r("./src/core/data/configService/spreadConfig.ts"),c=r("./src/core/worker/main-thread/interfaces/controller.interface.ts"),d=r("./src/core/worker/common/action-types.ts"),f=function(e,t,r,n){var o,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(i.a)(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(s=(a<3?o(s):a>3?o(t,r,s):o(t,r))||s);return a>3&&s&&Object.defineProperty(t,r,s),s},h=function(e,t){return function(r,n){t(r,n,e)}},m=function(){function t(e){Object(a.a)(this,t),this.controller=e,this.isSheetDataReady=!1,this.controller.addActionHandler(d.h.FetchSheetOnMainThread,this.fetchSheet.bind(this))}return Object(s.a)(t,[{key:"checkSheetFormulaLayerStatusBetweenThreads",value:function(){var t=e.SpreadsheetApp.calcController.sheetFormulaLayerStatusMap.getCurrentStatusMap();return this.controller.requestPromise(d.h.CheckSheetFormulaLayerStatusBetweenThreads,{currentStatusMap:t})}},{key:"informNetworkChange",value:function(e){return this.controller.requestPromise(d.h.InformNetworkChange,e)}},{key:"initSpreadsheetApp",value:function(e){var t=this,r={padId:l.a.getConfig("padId")};return this.controller.requestPromise(d.h.InitSpreadsheetApp,Object.assign(e,{clientVars:r})).then((function(e){return t.isSheetDataReady=!0,t.initSheetDataTime=Date.now(),e}))}},{key:"initSheet",value:function(e){return this.controller.requestPromise(d.h.InitSheet,e)}},{key:"loadSheet",value:function(e){return this.controller.requestPromise(d.h.LoadSheet,e)}},{key:"loadSheetToWorker",value:function(e){return this.controller.requestPromise(d.h.LoadSheetToWorker,e)}},{key:"resetSheetOnWorkerFormula",value:function(e){return this.controller.requestPromise(d.h.resetSheetOnWorkerFormula,e)}},{key:"syncVisibleAreaToWorker",value:function(e){return this.controller.requestPromise(d.h.syncVisibleAreaToWorker,e)}},{key:"updateSpreadsheet",value:function(e){return this.controller.requestPromise(d.h.UpdateSpreadsheet,e)}},{key:"clearAndReInitSheets",value:function(e){return this.controller.requestPromise(d.h.ClearAndReInitSheets,e)}},{key:"clearAndReInitOneSheet",value:function(e){return this.controller.requestPromise(d.h.ClearAndReInitOneSheet,e)}},{key:"transformSpreadsheetBySheetId",value:function(e){return this.controller.requestPromise(d.h.TransformSpreadsheetBySheetId,e)}},{key:"fetchSheet",value:function(e){var t=this;return new Promise((function(r){var n=Object(u.b)();t.fetch(e.sheetId,e.spreadsheetId,n,(function(e){r(e)}))}))}},{key:"fetch",value:function(){var t=Object(o.a)(regeneratorRuntime.mark((function t(r,o,a,s){var i,u,l=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return l.length>4&&void 0!==l[4]?l[4]:0,i=e.SpreadsheetApp,u=void 0,t.next=5,i.dataCenter.loaderManager.loadSheetData({sheetId:r,ignoreChunk:!0,baseVersion:i.messageCenter.currentVersion,onSuccess:function(e){var t;e.isFinished&&s([].concat(Object(n.a)((null===(t=u)||void 0===t?void 0:t.chunkData)||[]),Object(n.a)(e.chunkData||[])))},onFail:function(t){var n;null===(n=e.log)||void 0===n||n.error("worker \u5728\u4e3b\u7ebf\u7a0b\u62c9\u5b50\u8868\u5931\u8d25",r,t.error),s("fail")}}).catch((function(t){var n;null===(n=e.log)||void 0===n||n.error("worker \u5728\u4e3b\u7ebf\u7a0b\u62c9\u5b50\u8868\u5931\u8d25",r,t),s("fail")}));case 5:u=t.sent;case 6:case"end":return t.stop()}}),t)})));return function(e,r,n,o){return t.apply(this,arguments)}}()}]),t}();m=f([h(0,c.a)],m),t.a=m}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/worker/main-thread/worker-ability-test.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),s=r("./src/core/worker/main-thread/interfaces/controller.interface.ts"),i=r("./src/core/worker/common/action-types.ts"),u=function(e,t,r,n){var o,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(a.a)(Reflect))&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(s<3?o(i):s>3?o(t,r,i):o(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},l=function(e,t){return function(r,n){t(r,n,e)}},c=function(){function e(t){Object(n.a)(this,e),this.controller=t}return Object(o.a)(e,[{key:"runTest",value:function(){var e=Date.now();return this.controller.requestPromise(i.i.MessageTest,e)}},{key:"heartBeatTest",value:function(e){return this.controller.requestPromise(i.i.HeartBeatTest,e)}}]),e}();c=u([l(0,s.a)],c),t.a=c},"./src/core/worker/override/message-center/WorkerMessageCenter.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),i=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),u=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),l=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),c=r("./src/core/network/message-center/base/BaseMessageCenter.ts"),d=r("./src/core/worker/override/message-center/WorkerSendMessageCenter.ts"),f=r("./src/core/worker/override/message-center/WorkerReceiveMessageCenter.ts"),h=r("./src/core/network/message-center/model/PendingControl.ts"),m=r("./src/base/event/event.ts"),p=r("../packages/model/src/spreadsheet/SpreadsheetType.ts"),v=r("./src/core/app/SpreadsheetApp.interface.ts");function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(u.a)(e);if(t){var o=Object(u.a)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var y=function(e,t,r,n){var o,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(l.a)(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(s=(a<3?o(s):a>3?o(t,r,s):o(t,r))||s);return a>3&&s&&Object.defineProperty(t,r,s),s},_=function(e,t){return function(r,n){t(r,n,e)}},b=function(t){Object(s.a)(i,t);var r=g(i);function i(t,n){var a,s;return Object(o.a)(this,i),(s=r.call(this,n)).app=t,s.handleStartLoadData=function(e){var t=e.sheetId;s._pendingControl.startLoadSheet(t)&&(s.halfReplaySheets=s._pendingControl.sheet,1===s._pendingControl.loadingCount&&s._taskQueue.pause())},s.handleAfterLoadData=function(e){var t=e.sheetId;s._pendingControl.finishLoadSheet(t)&&0===s._pendingControl.loadingCount&&(s._taskQueue.resume(),s.applyFormulaModel())},null===(a=e.log)||void 0===a||a.info("\u521d\u59cb\u5316worker messageCenter"),s._pendingControl=new h.a,s._init(),s}return Object(a.a)(i,[{key:"_init",value:function(){var e=this;this._sendMessageCenter=this._register(new d.a(this.app,{parent:this,version:this._version,taskQueue:this._taskQueue})),this._receiveMessageCenter=new f.a(this.app,{version:this._version,taskQueue:this._taskQueue}),this._register(this._receiveMessageCenter.onBeforeApplyCollabMutations((function(t){return e._sendMessageCenter.handleBeforeApplyCollabMutations(t)}))),m.c.default.listen("startLoadData",this.handleStartLoadData),m.c.default.listen("afterLoadData",this.handleAfterLoadData)}},{key:"applyFormulaModel",value:function(){var e,t=this,r=this._sendMessageCenter.commitingQueue,o=this._sendMessageCenter.waitingQueue,a=[];r&&(null===(e=r.mutations)||void 0===e?void 0:e.length)>0&&r.mutations.forEach((function(e){a.push.apply(a,Object(n.a)(e))})),o.forEach((function(e){e.mutations&&e.mutations.length>0&&e.mutations.forEach((function(e){a.push.apply(a,Object(n.a)(e))}))})),a.forEach((function(e){m.c.spreadsheetEvent.trigger("afterMutationRun",{sheetId:t.halfReplaySheets,mutation:e,sType:p.a.NORMAL,isLocal:!0,isFromFormula:!1,isCollab:!1,isReplay:!1})}))}},{key:"sendMessageCenter",get:function(){return this._sendMessageCenter}},{key:"receiveMessageCenter",get:function(){return this._receiveMessageCenter}},{key:"currentVersion",get:function(){return this._version.version}}]),i}(c.a);b=y([_(0,v.a)],b),t.a=b}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/worker/override/message-center/WorkerReceiveMessageCenter.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),s=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),i=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),u=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),l=r("./src/core/network/message-center/base/BaseReceiveMessageCenter.ts"),c=r("../packages/mutation/src/MutationOperationType.ts"),d=r("./src/core/worker/worker-thread/index.ts"),f=r("../packages/lib/index.ts"),h=r("./src/core/app/SpreadsheetApp.interface.ts");function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(i.a)(e);if(t){var o=Object(i.a)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var p=function(e,t,r,n){var o,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(u.a)(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(s=(a<3?o(s):a>3?o(t,r,s):o(t,r))||s);return a>3&&s&&Object.defineProperty(t,r,s),s},v=function(e,t){return function(r,n){t(r,n,e)}},g=function(e){Object(a.a)(r,e);var t=m(r);function r(e,o){var a;return Object(n.a)(this,r),(a=t.call(this,e,o)).app=e,a._onBeforeApplyCollabMutations=new f.a,a.onBeforeApplyCollabMutations=a._onBeforeApplyCollabMutations.event,a}return Object(o.a)(r,[{key:"applyNewChanges",value:function(e){d.a.workerThreadWorker.sheetData.spreadsheetApp.behavior.apply({type:"collab",sheetId:e.sheetId,requestId:-1,canUndoRedo:!1,opt:e}).catch((function(e){console.error("worker apply collab error")})).then((function(e){}))}},{key:"onApplyNewChanges",value:function(e){var t=e.changeInfo,r=e.mutations;try{t.revert||this.applyCollabMutations(r,t),this._version.update(t.newVersion)}catch(n){console.error("worker alloyCollabMutations error")}}},{key:"applyCollabMutations",value:function(e,t){var r={newVersion:t.newVersion,requestMutations:d.a.workerThreadWorker.sheetData.spreadsheetApp.mutationBehavior.deSerializeRequests(e)};this._onBeforeApplyCollabMutations.fire(r);var n=[];r.requestMutations.forEach((function(e){n=n.concat(e)})),this.applyInDataAndView(n)}},{key:"applyInDataAndView",value:function(e){e.forEach((function(e,t){var r=e;d.a.workerThreadWorker.mutationData.setMuationQueueRunnedIndex(t),r.operationType=c.a.COLLAB,d.a.workerThreadWorker.sheetData.spreadsheetApp.mutationBehavior.applyMutation(r,{isLocal:!1,isCollab:!0})}))}},{key:"currentVersion",get:function(){return this._version.version},set:function(e){this._version.update(e)}}]),r}(l.a);g=p([v(0,h.a)],g),t.a=g},"./src/core/worker/override/message-center/WorkerSendMessageCenter.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),s=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),i=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),u=r("./src/core/network/message-center/base/BaseSendMessageCenter.ts"),l=r("./src/core/network/message-center/model/task/AcceptTask.ts"),c=r("./src/core/worker/worker-thread/index.ts");function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(i.a)(e);if(t){var o=Object(i.a)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Object(s.a)(this,r)}}var f=function(e){Object(a.a)(r,e);var t=d(r);function r(e,o){var a;return Object(n.a)(this,r),(a=t.call(this,e,o)).handleBeforeApplyCollabMutations=function(e){var t,r,n=e.newVersion,o=e.requestMutations,s=[];(null===(t=a._commitingQueue)||void 0===t||null===(r=t.mutations)||void 0===r?void 0:r.length)&&(s=c.a.workerThreadWorker.sheetData.spreadsheetApp.mutationBehavior.followRequestMutations(o,a._commitingQueue.mutations,!1),c.a.workerThreadWorker.sheetData.spreadsheetApp.mutationBehavior.followRequestMutations(a._commitingQueue.mutations,o,!0),a._commitingQueue.baseVersion=n,a._commitingQueue.mutations=s),a._waitingQueue.forEach((function(e){var t,r=e;(null===r||void 0===r||null===(t=r.mutations)||void 0===t?void 0:t.length)>0&&(s=c.a.workerThreadWorker.sheetData.spreadsheetApp.mutationBehavior.followRequestMutations(o,r.mutations,!1),c.a.workerThreadWorker.sheetData.spreadsheetApp.mutationBehavior.followRequestMutations(r.mutations,o,!0),r.mutations=s,r.baseVersion=n)}))},a._parent=o.parent,a}return Object(o.a)(r,[{key:"commit",value:function(e){e.mutations&&e.mutations.length>0&&(e.mutations.forEach((function(e){e.forEach((function(e,t){c.a.workerThreadWorker.mutationData.setMuationQueueRunnedIndex(t),c.a.workerThreadWorker.sheetData.spreadsheetApp.mutationBehavior.applyMutation(e,{isLocal:!0})}))})),null===this._commitingQueue?this._commitingQueue=e:this._waitingQueue.push(e))}},{key:"handleAcceptCommit",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=new l.a(this._taskQueue,{sheetId:e,to:t,isNeedKeyframe:r,parent:this._parent,taskId:-1});this._taskQueue.pushTask(n)}},{key:"acceptCommit",value:function(e,t){this._version.update(t),this._commitingQueue=this._waitingQueue.shift()||null}},{key:"commitingQueue",get:function(){return this._commitingQueue}}]),r}(u.a);t.a=f},"./src/core/worker/util.ts":function(e,t,r){"use strict";r.d(t,"b",(function(){return o})),r.d(t,"d",(function(){return a})),r.d(t,"c",(function(){return s})),r.d(t,"e",(function(){return i})),r.d(t,"a",(function(){return u}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.match.js");var n=r("../node_modules/@babel/runtime/helpers/esm/typeof.js");function o(){return-1!==navigator.userAgent.indexOf("msie")||-1!==navigator.userAgent.indexOf("rv:11")||!!window.ActiveXObject||"ActiveXObject"in window}function a(){var e=navigator.userAgent.match(/_tdocFlag\/(\d+)/);return!!(null===e||void 0===e?void 0:e[1])&&!!(2&parseInt(e[1],10))}function s(e){return!!e&&("object"===Object(n.a)(e)||"function"===typeof e)&&"function"===typeof e.then}function i(e,t){return(null===t||void 0===t?void 0:t())||null}function u(){return"undefined"===typeof performance?Date.now():performance.timeOrigin&&performance.now?performance.timeOrigin+performance.now():Date.now()}},"./src/core/worker/worker-thread/controller.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js");var t=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),n=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=r("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),a=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),s=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),i=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),u=r("../packages/report/src/index.ts"),l=r("./src/core/worker/common/base-controller.ts"),c=r("./src/core/worker/common/channel.ts");function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(i.a)(e);if(t){var o=Object(i.a)(this).constructor;Reflect.construct(n,arguments,o)}else n.apply(this,arguments);return Object(s.a)(this,r)}}l.a}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/worker/worker-thread/dynamic.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),r("../node_modules/core-js/modules/es.object.get-own-property-names.js"),r("../node_modules/core-js/modules/es.object.get-prototype-of.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.match.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var t=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),o=(r("../node_modules/regenerator-runtime/runtime.js"),r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js")),a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),s=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),u=r("../node_modules/axios/index.js"),l=r.n(u),c=r("../packages/report/src/index.ts"),d=r("../packages/services/src/instantiation.ts"),f=r("../packages/services/src/descriptors.ts"),h=r("./src/core/worker/common/action-types.ts"),m=r("./src/core/worker/worker-thread/interfaces/controller.interface.ts");function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function v(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?p(Object(n),!0).forEach((function(r){Object(t.a)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var g=function(e,t,r,n){var o,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(i.a)(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(s=(a<3?o(s):a>3?o(t,r,s):o(t,r))||s);return a>3&&s&&Object.defineProperty(t,r,s),s},y=function(e,t){return function(r,n){t(r,n,e)}},_=function(){function t(e,r){Object(a.a)(this,t),this.workerInstantiationService=e,this.controller=r,this.loadedServicesMap={},this.LoadScriptRetryTimes=2,this.addActionHandler()}return Object(s.a)(t,[{key:"addActionHandler",value:function(){this.controller.addActionHandler(h.c.Service,this.service.bind(this))}},{key:"service",value:function(){var t=Object(o.a)(regeneratorRuntime.mark((function t(r){var n,o,a,s,i,u,l,d,f,h,m,p,v,g,y,_;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o={startLoad:Date.now(),endLoad:-1,endInvoke:-1,ready:-1},a=r.serviceUrl,s=a.replace("?.*$",""),!this.loadedServicesMap[s]){t.next=5;break}return t.abrupt("return",this.loadedServicesMap[s]);case 5:return t.next=7,this.loadScript(a);case 7:if(i=t.sent,u=i.error,l=i.data,!u){t.next=13;break}throw this.loadScriptFailReport(a,u),u;case 13:o.endLoad=Date.now(),t.prev=14,h="__workerModule".concat(Date.now()),new Function("self['".concat(h,"']=").concat(l))(),d=self[h],delete self[h],d=(null===(f=d)||void 0===f?void 0:f.default)||d,t.next=27;break;case 23:throw t.prev=23,t.t0=t.catch(14),this.invokeScriptFailReport(a,t.t0),t.t0;case 27:if(o.endInvoke=Date.now(),m=this.getServiceNameFromServiceUrl(a)){t.next=32;break}throw this.serviceWithoutNameReport(a),new Error("Service ".concat(a," without serviceName"));case 32:return t.next=34,this.addServiceToDI(d,m);case 34:return p=t.sent,null===(n=e.log)||void 0===n||n.info("Worker DI add service success, ".concat(m)),0===(v=this.getServiceActionNameList(d,p)).length&&(y="Worker service ".concat(m," without action"),c.b.monitor(35445236),console.error(y),null===(g=e.log)||void 0===g||g.error(y)),this.addServiceActionToController(p,m,v),_={serviceName:m,serviceActionNameList:v},this.loadedServicesMap[s]=_,o.ready=Date.now(),this.loadServiceSuccessReport(_,o),t.abrupt("return",Promise.resolve(_));case 44:case"end":return t.stop()}}),t,this,[[14,23]])})));return function(e){return t.apply(this,arguments)}}()},{key:"loadScript",value:function(){var e=Object(o.a)(regeneratorRuntime.mark((function e(t){var r,n,o=this,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:0,e.next=3,l.a.get(t).then((function(e){return{error:null,data:e.data}})).catch((function(e){return r>=o.LoadScriptRetryTimes?{error:e,data:""}:o.loadScript(t,r+1)}));case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"addServiceActionToController",value:function(e,t,r){var o=this;r.forEach((function(r){if(e[r]instanceof Function){var a="".concat(t,".").concat(r);o.controller.addActionHandler(a,(function(t){return e[r].apply(e,Object(n.a)(t))}))}else console.error("Service ".concat(t," action ").concat(r," no function."))}))}},{key:"addServiceToDI",value:function(){var e=Object(o.a)(regeneratorRuntime.mark((function e(t,r){var n,o,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(d.c)(r),t instanceof Function?this.workerInstantiationService.addService(n,new f.a(t)):this.workerInstantiationService.addService(n,t),e.next=4,new Promise((function(e){a.workerInstantiationService.invokeFunction((function(t){var r=t.get(n);e(r)}))}));case 4:return o=e.sent,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getServiceNameFromServiceUrl",value:function(e){var t,r=e.match(/(worker-.*?)(-[0-9a-f]+)?\.js$/i);return r?(t=r[1],t=this.normalizeServiceName(t)):(r=e.match(/\.(com|cn)\/.*\/(.*?)\.js$/i))?(t=r[2],t=this.normalizeServiceName(t)):e}},{key:"normalizeServiceName",value:function(e){return e.replace(/(^\w|[-_/.]\w)/gi,(function(e){return e[e.length-1].toUpperCase()}))}},{key:"getServiceActionNameList",value:function(e,t){var r=e instanceof Function?Object.getPrototypeOf(t):t;return Object.getOwnPropertyNames(r).filter((function(e){return r[e]instanceof Function})).filter((function(e){return"constructor"!==e}))}},{key:"loadScriptFailReport",value:function(t,r){var n,o="Worker load script fail, ".concat(t);console.error(o,r),c.b.monitor(35445052),c.b.tdwReport({opername:"tech_doc",module:"webworker",action:"worker_load_script_fail",ver5:t}),null===(n=e.log)||void 0===n||n.error(o)}},{key:"invokeScriptFailReport",value:function(t,r){var n,o="Worker invoke script fail, ".concat(t);console.error(o,r),c.b.monitor(35445183),c.b.tdwReport({opername:"tech_doc",module:"webworker",action:"worker_invoke_script_fail",ver5:t}),null===(n=e.log)||void 0===n||n.error(o)}},{key:"serviceWithoutNameReport",value:function(t){var r,n="Service ".concat(t," without serviceName");c.b.monitor(35445235),c.b.tdwReport({opername:"tech_doc",module:"webworker",action:"worker_service_without_name",ver5:t}),null===(r=e.log)||void 0===r||r.error(n)}},{key:"loadServiceSuccessReport",value:function(t,r){var n;c.b.monitor(35445233);var o=v(v({},t),{},{loadTime:r.endLoad-r.startLoad,invokeTime:r.endInvoke-r.endLoad,readyTime:r.ready-r.endInvoke});c.b.tdwReport({opername:"tech_doc",module:"webworker",action:"worker_service_success",ver5:JSON.stringify(o)}),null===(n=e.log)||void 0===n||n.info("Worker service is loaded",o)}}]),t}();_=g([y(0,d.a),y(1,m.a)],_)}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/core/worker/worker-thread/index.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=(r("./src/core/worker/worker-thread/polyfill.ts"),r("../packages/services/src/serviceCollection.ts")),i=r("../packages/services/src/instantiationService.ts"),u=r("../packages/services/src/extensions.ts"),l=r("./src/core/worker/worker-thread/interfaces/controller.interface.ts"),c=(r("./src/core/worker/worker-thread/controller.ts"),r("./src/core/worker/worker-thread/interfaces/cookie.interface.ts")),d=(r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/@babel/runtime/helpers/esm/typeof.js")),f=r("./src/core/worker/common/action-types.ts"),h=function(e,t,r,n){var o,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(d.a)(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(s=(a<3?o(s):a>3?o(t,r,s):o(t,r))||s);return a>3&&s&&Object.defineProperty(t,r,s),s},m=function(e,t){return function(r,n){t(r,n,e)}},p=function(){function e(t){Object(o.a)(this,e),this.controller=t}return Object(a.a)(e,[{key:"getXsrf",value:function(){return this.controller.requestPromise(f.b.Xsrf,"")}}]),e}(),v=(p=h([m(0,l.a)],p),r("../packages/services/src/instantiation.ts")),g=Object(v.c)("IWorkerThreadCharts"),y=function(e,t,r,n){var o,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(d.a)(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(s=(a<3?o(s):a>3?o(t,r,s):o(t,r))||s);return a>3&&s&&Object.defineProperty(t,r,s),s},_=function(e,t){return function(r,n){t(r,n,e)}},b=function(){function e(t){Object(o.a)(this,e),this.controller=t}return Object(a.a)(e,[{key:"triggerDataChange",value:function(e){var t=e.workbookRangeId;return this.controller.requestPromise(f.a.DATA_CHANGE,{workbookRangeId:t})}},{key:"triggerWorkbookRangeChange",value:function(e){var t=e.workbookRangeId,r=e.rangeStr,n=e.sheetId,o=e.isRef;return this.controller.requestPromise(f.a.WORKBOOK_RANGE_CHANGE,{workbookRangeId:t,rangeStr:r,sheetId:n,isRef:o})}}]),e}(),A=(b=y([_(0,l.a)],b),Object(v.c)("IWorkerThreadMessageCenterData")),E=(r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../packages/mutation/src/MutationId.ts")),j=r("./src/core/network/message-center/model/userChange-helper.ts"),R=r("./src/core/network/message-center/model/missChange-helper.ts"),S=r("./src/core/worker/worker-thread/interfaces/mutation-data.interface.ts"),C=Object(v.c)("IWorkerThreadSheetData"),T=Object(v.c)("IFormulaResultCacheCommit"),w=function(e,t,r,n){var o,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(d.a)(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(s=(a<3?o(s):a>3?o(t,r,s):o(t,r))||s);return a>3&&s&&Object.defineProperty(t,r,s),s},O=function(e,t){return function(r,n){t(r,n,e)}},I=function(){function e(t,r,n,a){var s=this;Object(o.a)(this,e),this.controller=t,this.mutationData=r,this.sheetData=n,this.formulaResultCacheCommit=a,this.handleCommit=function(e){var t=Object(j.a)(e.userChangeOptions),r=t.mutations,n=t.sheetId,o=t.isWorkbook;if(s.mutationData.setMutationQueueId(e.mutationQueueId),s.formulaResultCacheCommit.changeToCommitStatus(e.userChangeOptions.baseVersion),!o&&!s.sheetData.isSheetLoadedInSpreadsheet(n)){var a=s.filterMultiSheetMutations(r);return a.length&&(t.mutations=a,s.sheetData.spreadsheetApp.messageCenter.sendMessageCenter.commit(t),s.mutationData.setMuationQueueRunnedIndex(-1)),void s.mutationData.completeMutationQueue({mutationQueueId:e.mutationQueueId})}s.sheetData.spreadsheetApp.messageCenter.sendMessageCenter.commit(t)},this.handleAcceptCommit=function(e){s.sheetData.spreadsheetApp.messageCenter.sendMessageCenter.handleAcceptCommit(e.sheetId,e.newVersion),s.formulaResultCacheCommit.changeToAcceptStatus(e.newVersion)},this.handleApplyNewChanges=function(e){var t=Object(R.c)(e.changeInfoOptions);void 0!==e.mutationQueueId&&s.mutationData.setMutationQueueId(e.mutationQueueId);var r=t.sheetId;if(!t.isWorkbook&&!s.sheetData.isSheetLoadedInSpreadsheet(r)&&!t.head)return s.sheetData.spreadsheetApp.messageCenter.receiveMessageCenter.currentVersion=t.newVersion,void s.mutationData.completeMutationQueue({mutationQueueId:e.mutationQueueId});s.formulaResultCacheCommit.addIgnoreVersion(t.newVersion),s.sheetData.spreadsheetApp.messageCenter.receiveMessageCenter.applyNewChanges(t)},this.addActionListener()}return Object(a.a)(e,[{key:"addActionListener",value:function(){this.controller.addActionHandler(f.d.Commit,this.handleCommit),this.controller.addActionHandler(f.d.AcceptCommit,this.handleAcceptCommit),this.controller.addActionHandler(f.d.ApplyNewChanges,this.handleApplyNewChanges)}},{key:"filterMultiSheetMutations",value:function(e){var t=e.map((function(e){return e.filter((function(e){return!!e.isMultiSheetMutation()||e.id===E.b.SET_SHEET_PROPERTIES_MUTATION}))}));return t=t.filter((function(e){return e.length}))}}]),e}(),N=(I=w([O(0,l.a),O(1,S.a),O(2,C),O(3,T)],I),r("../node_modules/lodash/debounce.js")),k=r.n(N),M=r("./src/core/app/spreadsheet-app-worker.interface.ts"),D=function(e,t,r,n){var o,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(d.a)(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(s=(a<3?o(s):a>3?o(t,r,s):o(t,r))||s);return a>3&&s&&Object.defineProperty(t,r,s),s},x=function(e,t){return function(r,n){t(r,n,e)}},F=function(){function e(t,r,n){Object(o.a)(this,e),this.controller=t,this.app=r,this.formulaResultCacheCommit=n,this.debounceCacheFormulaResult=k()(this.cacheFormulaResult,3e3),this.muationQueueRunnedIndex=-1}return Object(a.a)(e,[{key:"setMutationQueueId",value:function(e){this.mutationQueueId=e}},{key:"getMutationQueueId",value:function(){var e=this.mutationQueueId;return"number"===typeof e?e:-1}},{key:"setMuationQueueRunnedIndex",value:function(e){this.muationQueueRunnedIndex=e}},{key:"completeMutationQueue",value:function(e){return this.controller.requestPromise(f.e.CompleteMutationQueue,e)}},{key:"syncNonPersistentMutationsToMainThread",value:function(e){var t=this,r=e.mutations,n=e.isFromFormula,o=e.needToSetIntializedDone,a=e.isInVisibleArea,s=e.relatedSheetIds,i=e.canCheckUnfinishedCalculationNode,u={serializedMutations:r.map((function(e){return t.app.mutationBehavior.serializeMutation(e)})),isFromFormula:n,latestMutationQueueIdInWorker:this.getMutationQueueId(),needToSetIntializedDone:o,isInVisibleArea:a,relatedSheetIds:s,canCheckUnfinishedCalculationNode:i,muationQueueRunnedIndex:this.muationQueueRunnedIndex};return this.controller.requestPromise(f.e.SyncNonPersistentMutationsToMainThread,u)}},{key:"cacheFormulaResult",value:function(e){var t=this.app.messageCenter.currentVersion;0!==t&&this.formulaResultCacheCommit.commit(t,e)}}]),e}(),P=(F=D([x(0,l.a),x(1,M.a),x(2,T)],F),Object(v.c)("IWorkerThreadRaven")),L=function(e,t,r,n){var o,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(d.a)(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(s=(a<3?o(s):a>3?o(t,r,s):o(t,r))||s);return a>3&&s&&Object.defineProperty(t,r,s),s},U=function(e,t){return function(r,n){t(r,n,e)}},B=function(){function e(t){Object(o.a)(this,e),this.controller=t,self.Raven=this}return Object(a.a)(e,[{key:"captureException",value:function(e,t){var r={errorString:"object"===Object(d.a)(e)?e.message:"string"!==typeof e?"no-message":e,params:t};this.controller.request(f.f.CaptureException,r)}},{key:"captureWorkerPromiseException",value:function(e,t){this.controller.request(f.f.CaptureWorkerPromiseException,{message:e,stack:t})}}]),e}(),H=(B=L([U(0,l.a)],B),Object(v.c)("IWorkerThreadReport")),G=r("../packages/report/src/index.ts"),V=function(e,t,r,n){var o,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(d.a)(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(s=(a<3?o(s):a>3?o(t,r,s):o(t,r))||s);return a>3&&s&&Object.defineProperty(t,r,s),s},W=function(e,t){return function(r,n){t(r,n,e)}},Y=function(){function e(t){var r=this;Object(o.a)(this,e),this.controller=t;var n={};["debug","info","warn","error","log","config"].forEach((function(e){n[e]=function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];r.controller.request(f.g.WebLog,{level:e,args:n})}})),this.log=n,self.log=this.log,self.reportProxy=G.b,e.loadRealReport(this)}return Object(a.a)(e,[{key:"monitor",value:function(e){this.controller.request(f.g.MonitorReport,e)}},{key:"tdwReport",value:function(e){this.controller.request(f.g.TdwReport,e)}},{key:"huatuo",value:function(e){this.controller.request(f.g.HuatuoReport,e)}},{key:"tdwSingleReport",value:function(e){this.controller.request(f.g.TdwSingleReport,e)}},{key:"run",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.controller.request(f.g.RunReport,{args:t})}},{key:"speedHasDonePagePerformanceReport",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.controller.request(f.g.SpeedHasDonePagePerformanceReport,{args:t})}},{key:"flowLog",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.controller.request(f.g.FlowLogReport,{args:t})}},{key:"debuggerAlert",value:function(e){this.controller.request(f.g.DebuggerAlert,e)}}],[{key:"loadRealReport",value:function(e){G.a.eachLoad({run:e.run.bind(e),speed:{runReport:function(){},hasDonePagePerformanceReport:function(){return!0}},jank:{log:function(){},startMonitor:function(){}},tdwReport:e.tdwReport.bind(e),tdwSingleReport:e.tdwSingleReport.bind(e),monitor:e.monitor.bind(e),huatuo:e.huatuo.bind(e),retcode:function(){},tam:{reportTime:function(){},reportEvent:function(){}}})}}]),e}(),z=(Y=V([W(0,l.a)],Y),Object(v.c)("IWorkerThreadWorkerAbilityTest")),K=function(e,t,r,n){var o,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(d.a)(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(s=(a<3?o(s):a>3?o(t,r,s):o(t,r))||s);return a>3&&s&&Object.defineProperty(t,r,s),s},q=function(e,t){return function(r,n){t(r,n,e)}},Q=function(){function e(t){Object(o.a)(this,e),this.controller=t,this.addActionListener()}return Object(a.a)(e,[{key:"addActionListener",value:function(){this.controller.addActionHandler(f.i.MessageTest,this.messageTestHandler.bind(this)),this.controller.addActionHandler(f.i.HeartBeatTest,this.heartBeatTestHandler.bind(this))}},{key:"messageTestHandler",value:function(e){return Date.now()-e}},{key:"heartBeatTestHandler",value:function(e){return e}}]),e}(),X=(Q=K([q(0,l.a)],Q),Object(v.c)("IWorkerThreadWorker")),J=Object(v.c)("IDynamic"),$=function(e,t){return function(r,n){t(r,n,e)}},Z=function e(t,r,n,a,s,i,u,l,c,d){Object(o.a)(this,e),this.controller=t,this.workerAbilityTest=r,this.report=n,this.raven=a,this.cookie=s,this.charts=i,this.mutationData=u,this.sheetData=l,this.messageCenterData=c,this.dynamic=d},ee=(Z=function(e,t,r,n){var o,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(d.a)(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(s=(a<3?o(s):a>3?o(t,r,s):o(t,r))||s);return a>3&&s&&Object.defineProperty(t,r,s),s}([$(0,l.a),$(1,z),$(2,H),$(3,P),$(4,c.a),$(5,g),$(6,S.a),$(7,C),$(8,A),$(9,J)],Z),r("./src/core/worker/worker-thread/sheet-data.ts"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/@babel/runtime/helpers/esm/inherits.js")),te=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),re=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),ne=r("./src/core/app/BaseSpreadsheetApp.ts"),oe=(r("../node_modules/core-js/modules/es.promise.js"),r("./src/base/event/event.ts")),ae=r("./src/base/config/report.ts"),se=r("./src/base/event/eventName.ts"),ie=function(){function e(t){Object(o.a)(this,e),this.parent=t}return Object(a.a)(e,[{key:"apply",value:function(e){var t,r=this;switch(e.type){case"collab":t=new Promise((function(t,n){r.applyCollabMutations(e.opt,t,n)}));break;default:t=new Promise((function(e,t){t()}))}return t}},{key:"applyCollabMutations",value:function(e,t,r){try{var n,o,a=JSON.parse(e.changeset),s=-1;a.length>0&&a[0]&&a[0].length>0&&a[0][0]&&(s=a[0][0].r),G.b.jank.log({moduleValue:"applyMutation",actionValue:"collab_".concat(s)});var i=null===(n=this.parent)||void 0===n||null===(o=n.feature)||void 0===o?void 0:o.relateForm;(null===i||void 0===i?void 0:i.isRelated(e.sheetId))&&i.updateFromSyncMutations(a,e.sheetId),this.parent.messageCenter.receiveMessageCenter.onApplyNewChanges({changeInfo:e,mutations:a}),t(a),oe.c.spreadsheetEvent.trigger(se.a.DATA_CHANGE,{type:"syncndoredoStack"})}catch(u){G.b.run(ae.CONFIG.APPLY_NEW_CHANGES_ERROR,[null===u||void 0===u?void 0:u.stack]),r()}}}]),e}(),ue=r("../packages/mutation/src/api.ts"),le=r("./src/core/app/event-init.ts");function ce(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(re.a)(e);if(t){var o=Object(re.a)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Object(te.a)(this,r)}}ne.a,r("./src/core/worker/worker-thread/dynamic.ts"),r("./src/core/feature/formula/formula-result-cache-service/commit.ts");var de=new u.a,fe=new(function(){function e(){Object(o.a)(this,e)}return Object(a.a)(e,[{key:"initWorkerService",value:function(){var e=new s.a;de.getServiceDescriptors().forEach((function(t){var r=Object(n.a)(t,2),o=r[0],a=r[1];e.set(o,a)})),this.workerInstantiationService=new i.a(e)}},{key:"initWorkerThreadWorker",value:function(){var e=this;this.workerInstantiationService.invokeFunction((function(t){var r=t.get(X);e.workerThreadWorker=r}))}}]),e}());t.a=fe},"./src/core/worker/worker-thread/interfaces/controller.interface.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r("../packages/services/src/instantiation.ts"),o=Object(n.c)("IWorkerThreadController")},"./src/core/worker/worker-thread/interfaces/cookie.interface.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r("../packages/services/src/instantiation.ts"),o=Object(n.c)("IWorkerThreadCookie")},"./src/core/worker/worker-thread/interfaces/mutation-data.interface.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r("../packages/services/src/instantiation.ts"),o=Object(n.c)("IWorkerThreadMutationData")},"./src/core/worker/worker-thread/polyfill.ts":function(e,t,r){r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.function.name.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),self.Promise=Promise},"./src/core/worker/worker-thread/sheet-data.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.every.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/regenerator-runtime/runtime.js");var t=r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),s=r("../packages/services/src/instantiation.ts"),i=r("./src/flow/phase/services/interface/workerService.interface.ts"),u=r("../node_modules/axios/index.js"),l=r.n(u),c=r("../packages/model/src/spreadsheet/Spreadsheet.ts"),d=r("./src/base/event/event.ts"),f=r("./src/core/worker/common/action-types.ts"),h=r("./src/base/util/timer.ts"),m=r("./src/core/worker/util.ts"),p=r("./src/core/feature/formula/controller.ts"),v=r("../packages/model/src/spreadsheet/SpreadsheetType.ts"),g=r("../packages/model/src/workbookRange/ChartWorkbookRange.ts"),y=r("../packages/model/src/new-embedded/EmbeddedObject.ts"),_=r("../packages/model/src/workbookRange/WorkbookRangeType.ts"),b=r("../packages/model/src/spreadsheet/Spreadsheet.interface.ts"),A=r("../packages/report/src/index.ts"),E=r("../packages/services/src/dispose.ts"),j=r("./src/core/data/converter/tencentdoc/keyframeToSheetConverter.ts"),R=r("./src/core/data/converter/tencentdoc/handleKeyframe/keyframeOne.ts"),S=r("./src/core/app/spreadsheet-app-worker.interface.ts"),C=r("./src/base/config/version.ts"),T=r("./src/core/worker/override/message-center/WorkerMessageCenter.ts"),w=r("./src/core/worker/worker-thread/interfaces/controller.interface.ts"),O=r("./src/core/worker/worker-thread/interfaces/cookie.interface.ts"),I=r("./src/core/worker/worker-thread/interfaces/mutation-data.interface.ts"),N=function(e,t,r,n){var o,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(a.a)(Reflect))&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(s<3?o(i):s>3?o(t,r,i):o(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},k=function(e,t){return function(r,n){t(r,n,e)}},M=function(){function r(e,t,o,a,s){var i=this;Object(n.a)(this,r),this.instantiationService=e,this.spreadsheetApp=t,this.controller=o,this.cookie=a,this.mutationData=s,this.isSheetDataReady=!1,this.isSheetLoadedInSpreadsheet=function(e){if(!i.spreadsheetApp)return!1;if(!i.spreadsheetApp.spreadsheet)return!1;var t=i.spreadsheetApp.spreadsheet.sheetManager.getSheetBySheetId(e);return!!t&&t.isLoaded},this.addListenActions(),this.loadSheetPromiseMap={},self.SpreadsheetApp=this.spreadsheetApp}return Object(o.a)(r,[{key:"destroy",value:function(){var e,t,r;this.isSheetDataReady&&(null===(e=this.calcController)||void 0===e||e.destroy(),delete this.calcController,delete this.spreadsheet,null===(t=this.spreadsheetApp)||void 0===t||null===(r=t.messageCenter)||void 0===r||r.dispose(),delete this.spreadsheetApp.calcController,delete this.spreadsheetApp.spreadsheet,delete this.spreadsheetApp.messageCenter,this.isSheetDataReady=!1)}},{key:"checkSheetFormulaLayerStatusBetweenThreads",value:function(e){var t=e.currentStatusMap,r=this.calcController.sheetFormulaLayerStatusMap.getCurrentStatusMap(),n=!0;return Object.keys(t).every((function(e){return t[e]===r[e]||(n=!1,!1)})),n}},{key:"loadSheet",value:function(e){var r=this,n=e.sheetId,o=e.waitForFormulaLayerToBeInitialized;if(!this.spreadsheet)return!1;var a=this.spreadsheet.sheetManager.getSheetBySheetId(n);if(!a)return Promise.resolve(!1);if(a.isFetching=!0,null===a||void 0===a?void 0:a.isLoaded)return a.isFetching=!1,Object(t.a)(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.calcController.sheetFormulaLayerStatusMap,a=o?t.getInitialPromise(n):t.getWaitingPromise(n),!Object(m.c)(a)){e.next=5;break}return e.next=5,a;case 5:return r.calcController.syncAllFormulaResultToMainThread(n),e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e)})))();if(this.loadSheetPromiseMap[n])return this.loadSheetPromiseMap[n];var s=new Promise(function(){var e=Object(t.a)(regeneratorRuntime.mark((function e(s){var i,u,l,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=function(){var e=Object(t.a)(regeneratorRuntime.mark((function e(t){var i,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("fail"===t){e.next=12;break}if(r.transformSpreadsheet(a,t),a.isLoaded=!0,a.isFetching=!1,i=r.calcController.sheetFormulaLayerStatusMap,u=o?i.getInitialPromise(n):i.getWaitingPromise(n),!Object(m.c)(u)){e.next=9;break}return e.next=9,u;case 9:s(!0),e.next=15;break;case 12:a.isFetching=!1,delete r.loadSheetPromiseMap[n],s(!1);case 15:d.c.default.trigger("afterLoadData",{sheetId:n,oldSheetId:"",isThreeDimensionClick:!1});case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d.c.default.trigger("startLoadData",{sheetId:n,oldSheetId:""}),u=r.spreadsheet.getSpreadsheetId(),!Object(m.b)()&&!Object(m.d)()){e.next=10;break}return e.next=6,r.fetchSheet({sheetId:n,spreadsheetId:u});case 6:l=e.sent,Array.isArray(l)?i(l):(delete r.loadSheetPromiseMap[n],s(!1)),e.next=14;break;case 10:return e.next=12,r.cookie.getXsrf();case 12:c=e.sent,r.fetch(n,u,c,i);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());return this.loadSheetPromiseMap[n]=s,s}},{key:"loadSheetToWorker",value:function(r){var n,o=this;if(!this.isSheetDataReady)return null===(n=e.log)||void 0===n||n.error("worker \u8868\u683c\u521d\u59cb\u5316\u5931\u8d25"),!1;var a=r.sheetId,s=r.serializeData,i=r.newWorkbookRanges,u=r.newEmbeddedObjects;if(!this.spreadsheet)return!1;var l=this.spreadsheet.sheetManager.getSheetBySheetId(a);if(!l||l.isLoaded)return Object(t.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.calcController.sheetFormulaLayerStatusMap.getInitialPromise(a),!Object(m.c)(t)){e.next=4;break}return e.next=4,t;case 4:o.calcController.syncAllFormulaResultToMainThread(a);case 5:case"end":return e.stop()}}),e)})))(),!1;var c=JSON.stringify(s);Object(R.a)(l,c,0,0,C.a.KEYFRAME_VER);for(var d=l.getRowCount(),f=l.getColCount(),h=!1,p=0;p<d;p++)for(var b=0;b<f;b++)if(this.spreadsheet.autoUpdateCellData(a,p,b),!h){var A=l.getCellDataAtPosition(p,b);A&&A.getFormula()&&A.getEffectiveValue()&&(h=!0)}return i.forEach((function(e){var t=g.a.deserialize(e);o.spreadsheet.workbookRangeManager.getWorkbookRangeById(t.id)||(o.spreadsheet.workbookRangeManager.addWorkbookRange(t),o.spreadsheetApp.calcController.chartsApi.add(_.a.CHART,t.id))})),u.forEach((function(e){o.spreadsheet.embeddedObjectManager.addEmbeddedObject(y.a.deserialize(e))})),l.isLoaded=!0,this.calcController.keyframeHandler({sType:v.a.NORMAL,sheetId:a}),this.calcController.sheetFormulaLayerStatusMap.setWaitingStart(a),this.calcController.sheetFormulaLayerStatusMap.setWaitingDone(a),this.calcController.startReCalculateAfterSheetInitial([a]),this.backEndFormulaResultCacheReport(h,a),!0}},{key:"informNetworkChange",value:function(e){d.c.default.trigger(e.type,void 0)}},{key:"syncVisibleAreaToWorker",value:function(e){var t=e.visibleArea;return!!this.isSheetDataReady&&(this.calcController.visibleArea=t,!0)}},{key:"updateSpreadsheet",value:function(e){return!!this.spreadsheet&&(this.spreadsheet.sheetManager.setSheets(e.sheetList),!0)}},{key:"fetchSheet",value:function(e){return this.controller.requestPromise(f.h.FetchSheetOnMainThread,e)}},{key:"resetSheetOnWorkerFormula",value:function(e){var t=e.sheetId;this.calcController.resetSheet(t)}},{key:"transformSpreadsheetBySheetId",value:function(e){if(!this.isSheetDataReady)return!1;var t=e.sheetId,r=e.text,n=this.spreadsheet.sheetManager.getSheetBySheetId(t);return!!n&&(n.isFetching=!0,this.transformSpreadsheet(n,r),n.isLoaded=!0,n.isFetching=!1,!e.waitForFormulaLayerToBeInitialized||this.calcController.sheetFormulaLayerStatusMap.getInitialPromise(t))}},{key:"fetch",value:function(){var e=Object(t.a)(regeneratorRuntime.mark((function e(t,r,n,o){var a,s,i,u,c,d=this,f=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=f.length>4&&void 0!==f[4]?f[4]:0,s=3,i=2e3,u="/dop-api/get/sheet?padId=".concat(r,"&subId=").concat(t,"&xsrf=").concat(n,"&_r=").concat(Math.random(),"&startrow=0&endrow=-1&outformat=1&nowb=1"),e.next=6,l()({method:"get",url:u,responseType:"json"}).catch((function(){a>=s?o("fail"):h.a.wait(i).run((function(){d.fetch(t,r,n,o,a+1)}))}));case 6:if(c=e.sent,"fail"!==this.checkRespose(c)){e.next=13;break}if(!(a>=s)){e.next=11;break}return o("fail"),e.abrupt("return");case 11:return h.a.wait(i).run((function(){d.fetch(t,r,n,o,a+1)})),e.abrupt("return");case 13:o(c.data.data.initialAttributedText.text);case 14:case"end":return e.stop()}}),e,this)})));return function(t,r,n,o){return e.apply(this,arguments)}}()},{key:"checkRespose",value:function(e){return e.status&&200===e.status&&e.data&&0===e.data.retcode?"succ":"fail"}},{key:"initSpreadsheetApp",value:function(t){var r,n=new T.a(this.spreadsheetApp,{baseVersion:t.baseVersion});Object(E.f)(n);var o=t.activeSheetId,a=t.header,s=t.spreadsheetId,u=t.title,l=t.clientVars;return window.clientVars=l,this.spreadsheet=this.initSpreadsheet({spreadsheetId:s,type:v.a.NORMAL,title:u,sheetList:a,activeSheetId:o}),this.spreadsheetApp.spreadsheet=this.spreadsheet,this.calcController=new p.a(this.spreadsheetApp,{isInWorker:!0}),this.spreadsheetApp.calcController=this.calcController,this.spreadsheetApp.messageCenter=n,this.instantiationService.addService(i.a,{calcController:this.calcController}),this.instantiationService.addService(b.a,this.spreadsheet),n.taskQueue.resume(),this.mutationData.setMutationQueueId(-1),this.isSheetDataReady=!0,null===(r=e.log)||void 0===r||r.log("worker \u8868\u683c\u521d\u59cb\u5316\u6210\u529f"),!0}},{key:"initSpreadsheet",value:function(e){return new c.a(this.spreadsheetApp,e)}},{key:"initSheet",value:function(e){var t=e.sheetId,r=this.spreadsheet.sheetManager.getSheetBySheetId(t);return!!r&&(r.isFetching=!0,this.transformSpreadsheet(r,e.sheetData),r.isLoaded=!0,r.isFetching=!1,!0)}},{key:"clearAndReInitSheets",value:function(e){var t=this;return!!this.isSheetDataReady&&(this.spreadsheet.sheetManager.sheetList.forEach((function(e){t.calcController.resetSheet(e.getSheetId())})),this.loadSheetPromiseMap={},this.spreadsheet.workbookRangeManager.clear(),this.spreadsheet.embeddedObjectManager.clear(),this.spreadsheet.sheetManager.setSheets(e.sheetList),!0)}},{key:"clearAndReInitOneSheet",value:function(e){if(!this.isSheetDataReady)return!1;var t=e.sheetId;return delete this.loadSheetPromiseMap[t],this.spreadsheet.sheetManager.reInitSheetBySheetId(t),!0}},{key:"transformSpreadsheet",value:function(e,t){var r=e.getSheetId();Object(j.a)(this.spreadsheetApp.spreadsheet,r,t,{})}},{key:"backEndFormulaResultCacheReport",value:function(t,r){var n,o;if(t)return A.b.monitor(35406905),void(null===(o=e.log)||void 0===o||o.log("\u5b50\u8868 ".concat(r," \u51fb\u4e2d\u540e\u53f0\u51fd\u6570\u7ed3\u679c\u7f13\u5b58")));A.b.monitor(35406906),null===(n=e.log)||void 0===n||n.log("\u5b50\u8868 ".concat(r," \u672a\u51fb\u4e2d\u540e\u53f0\u51fd\u6570\u7ed3\u679c\u7f13\u5b58"))}},{key:"addListenActions",value:function(){this.controller.addActionHandler(f.h.InitSpreadsheetApp,this.initSpreadsheetApp.bind(this)),this.controller.addActionHandler(f.h.InitSheet,this.initSheet.bind(this)),this.controller.addActionHandler(f.h.LoadSheet,this.loadSheet.bind(this)),this.controller.addActionHandler(f.h.LoadSheetToWorker,this.loadSheetToWorker.bind(this)),this.controller.addActionHandler(f.h.UpdateSpreadsheet,this.updateSpreadsheet.bind(this)),this.controller.addActionHandler(f.h.syncVisibleAreaToWorker,this.syncVisibleAreaToWorker.bind(this)),this.controller.addActionHandler(f.h.resetSheetOnWorkerFormula,this.resetSheetOnWorkerFormula.bind(this)),this.controller.addActionHandler(f.h.ClearAndReInitSheets,this.clearAndReInitSheets.bind(this)),this.controller.addActionHandler(f.h.ClearAndReInitOneSheet,this.clearAndReInitOneSheet.bind(this)),this.controller.addActionHandler(f.h.TransformSpreadsheetBySheetId,this.transformSpreadsheetBySheetId.bind(this)),this.controller.addActionHandler(f.h.InformNetworkChange,this.informNetworkChange.bind(this)),this.controller.addActionHandler(f.h.CheckSheetFormulaLayerStatusBetweenThreads,this.checkSheetFormulaLayerStatusBetweenThreads.bind(this))}}]),r}();M=N([k(0,s.a),k(1,S.a),k(2,w.a),k(3,O.a),k(4,I.a)],M)}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/entry/browser/pc.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"pcEntry",(function(){return D}));r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/regenerator-runtime/runtime.js");var n=r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),i=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),u=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),l=(r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.number.constructor.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../packages/lib/global.ts"),r("../node_modules/@tencent/dui/lib/utils/polyfill.js"),r("../packages/report/src/index.ts"));window.log?(log.config({pid:2,release:"20210310-1144-sheet-release-20210311-26922464"}),log.record=function(){},l.b.monitor(33712847)):(window.log={isFake:!0,listeners:[],var:{},namespace:"",version:0,_pid:0,_sessionId:"",_startTime:"",_uid:""},["invokeWk","config","deleteDatabase","dispatch","getDBLog","getDBLogByTime","getUUID","getWorkerVar","hideConsole","listen","loadAsset","loadAssetLoader","query","raven","record","report","reportLog","showConsole","ws","debug","error","info","log","warn"].forEach((function(e){log[e]=function(){}})),window.WebLog=function(){return window.log},l.b.monitor(33712848),console.warn("[wl]log undefined"));r("../node_modules/core-js/modules/es.string.match.js");var c=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),d=r.n(c),f=r("../packages/common-utils/src/url.ts"),h=r("../packages/common-utils/src/cookie.ts"),m=Object(f.getQuery)("currentEnv"),p=[{test:function(e){var t=null===e||void 0===e?void 0:e.culprit;return!(!t||!/s1\.url\.cn\/tim\/docs\/components\//.test(t))},dsn:"https://a3ab7140dcb24d5b8106842ad06454c7@report.url.cn/sentry/334",project:"334"},{test:function(){return!0},dsn:"https://543ee0b890614ca79c9b184e26e37927@report.url.cn/sentry/1833",project:"1833"}];try{m?window.Raven&&Raven.setTagsContext({plantform:d.a.isMobilePhone||d.a.isAndroidPad?"mobile":"pc",uid:Object(h.getCookie)("uid"),currentEnv:m}):window.Raven&&Raven.setTagsContext({plantform:d.a.isMobilePhone||d.a.isAndroidPad?"mobile":"pc",uid:Object(h.getCookie)("uid")})}catch(x){console.warn(x)}var v=d.a.isMobilePhone||d.a.isAndroidPad?33710522:33710521;m&&(v=d.a.isMobilePhone||d.a.isAndroidPad?33715453:33715452),window.__jsErrorCount=0,window.addEventListener("error",(function(e){var t=(null===e||void 0===e?void 0:e.message)||"";l.b.monitor,l.b.monitor&&(t.match("cefQuery")?l.b.monitor(33715741):t.match("playBackgroundMusic")?l.b.monitor(33715742):t.match("setKeyboardHeight")?l.b.monitor(33715743):t.match("test")?l.b.monitor(33715744):t.match("showTips")?l.b.monitor(33938728):t.match("ExecuteJsInterface")?l.b.monitor(34594185):(l.b.monitor(v),window.__jsErrorCount=window.__jsErrorCount+1,1===window.__jsErrorCount&&(l.b.tdwSingleReport({opername:"quality_doc",module:"excel_detail",action:"js_error"}),l.b.tam.reportEvent("js_error"))))})),window.Raven&&Raven.config("https://543ee0b890614ca79c9b184e26e37927@report.url.cn/sentry/1833",{release:window.__globalReleaseVersion,ignoreErrors:["cefQuery","playBackgroundMusic","setKeyboardHeight","Cannot read property 'test' of undefined","setKeyboardHeight","showTips","ExecuteJsInterface","Changeset"],shouldSendCallback:function(){return!(window.__jsErrorCount>9)},dataCallback:function(e){var t;if(p&&p.length>0)for(var r=0;r<p.length;r++){var n,o=p[r];if(null===(n=o.test)||void 0===n?void 0:n.call(o,e)){e.project!==o.project&&(window.Raven.setDSN(o.dsn),e.project=o.project);break}}return e=null===(t=window.log)||void 0===t?void 0:t.raven(e)}}).install();var g=r("./src/flow/flowlog.ts"),y=(r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/axios/index.js")),_=r.n(y),b=r("./src/base/event/event.ts"),A=r("./src/base/event/eventName.ts"),E=r("../node_modules/@tencent/tencent_doc_net/dist/index.js");Object(E.Interceptor)({urlWhiteList:["report.idqqimg.com","tam/report"]});var j=[11e3,11005,11004,11007,11008,1e5,100001,100003,100004,100100,100101,100012,111111,99999,99992,1007,1e4,10001,30001,30002,30003,40001,40002,40003,40004,40005,40006,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115];_.a.interceptors.request.use((function(e){return window.global_multi_user,window.nowUserIndex,e.metadata={startTime:new Date},e.url&&!Object(E.isInUrlWhiteList)(e.url)&&(e.url=Object(E.getMultUrl)(e.url)),e}),(function(e){return Promise.reject(e)})),_.a.interceptors.response.use((function(e){e.config.metadata.endTime=new Date;var t=e.config.metadata.endTime-e.config.metadata.startTime,r=null,n=e.data;if(void 0!==(null===n||void 0===n?void 0:n.retCode)?r=n.retCode:void 0!==(null===n||void 0===n?void 0:n.retcode)?r=n.retcode:n&&(r=n.ret),null!==r&&void 0!==r||(r=-998),0===(r=parseInt(r,10)))window.AlloyReport&&window.AlloyReport.retcode({url:e.config.url,type:1,code:0,time:t});else{var o=2;-1!==j.indexOf(r)&&(o=3),window.AlloyReport&&window.AlloyReport.retcode({url:e.config.url,type:o,code:r,time:t})}return e}),(function(e){e.config.metadata.endTime=new Date;var t=e.config.metadata.endTime-e.config.metadata.startTime;return window.AlloyReport&&window.AlloyReport.retcode({url:e.config.url,type:2,code:0,time:t}),Promise.reject(e)})),b.c.init.listen(A.a.AFTER_ALL_RENDER,(function(){window.AlloyReport&&window.AlloyReport.retcode({url:"https://".concat(location.host,"/dop-api/opendoc"),type:1,code:0,time:window._openDocEndTime-window._openDocStartTime})}));_.a;var R,S,C=r("./src/base/config/report.ts"),T=(r("../core-sheet/js/lazy/script-loader/script-loader.js"),r("../node_modules/core-js/modules/es.object.assign.js"),{Model:r("../packages/model/src/index.ts")});if("test"===Object(f.getQuery)("mode")){var w=window.T_SHEET||{};Object.assign(w,T),window.T_SHEET=w}g.a.info("AppLoadSuccess"),window.__isOfflinePkg&&g.a.info("\u547d\u4e2d\u79bb\u7ebf\u5305".concat(window.__globalCodeVersion)),window.ssrReport&&g.a.info("\u547d\u4e2dSSR".concat(window.__globalCodeVersion));var O=/\d+\.\d+\.(\d+)/.exec(window.__globalCodeVersion);if(null===O||void 0===O?void 0:O[1]){var I=new Date(1e3*Number(O[1])*60);g.a.info("\u4ee3\u7801\u6784\u5efa\u65f6\u95f4\uff1a".concat(I))}var N=function(){function e(){Object(o.a)(this,e)}return Object(a.a)(e,[{key:"run",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.beforeStart(),e.prev=1,e.next=4,this.start();case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),console.error(e.t0);case 9:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"beforeStart",value:function(){window.performanceData=window.performanceData||{},window.performanceData.jsStartRun=Date.now(),window._grayVersion="2.7.26922464",this.replaceConsole();try{window.__console.log("%c\u3010\u7248\u672c\u4fe1\u606f\u3011"),window.__console.log("%c\u5f53\u524d\u6570\u636e\u7248\u672c\uff1a".concat(window._grayVersion),"color: green; font-size: 16px;"),window.__console.log("%c\u5f53\u524d\u7248\u672c\uff1a".concat(window.__globalReleaseVersion),"color: blue; font-size: 16px;"),window.__console.log("%c\u5f53\u524dcommit\uff1a".concat("26a066d52d\n"),"color: pink; font-size: 16px;"),window.__isOfflinePkg&&window.__console.log("%c\u5f53\u524d\u4ee3\u7801\u4f7f\u7528\u4e86\u79bb\u7ebf\u5305","color: pink; font-size: 16px;")}catch(e){}l.b.run(C.CONFIG.RESET_DEFAULT_TDW_DATA),l.b.run(C.CONFIG.REPORT_FOR_PV),l.b.run(C.CONFIG.REPORT_FOR_QL_PV),l.b.run(C.CONFIG.PAGE_LOAD,window.__globalCodeVersion),l.b.run(C.CONFIG.REPORT_FOR_SSR),l.b.run(C.CONFIG.REPORT_FOR_JSONP)}},{key:"replaceConsole",value:function(){window.__console={};["log","error","warn","debug"].forEach((function(e){window.__console[e]=window.console[e]}))}}]),e}();null===(R=window.__ws)||void 0===R||R.trigger("setLoadData",{type:"coresheet"}),null===(S=window.__ws)||void 0===S||S.trigger("setLoadData",{type:"spreadsheet"});var k=r("./src/flow/index.ts");function M(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(x){return!1}}();return function(){var r,n=Object(u.a)(e);if(t){var o=Object(u.a)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var D=new(function(e){Object(s.a)(r,e);var t=M(r);function r(){return Object(o.a)(this,r),t.call(this)}return Object(a.a)(r,[{key:"initFlow",value:function(){this.flow=new k.a}},{key:"start",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.initFlow(),this.flow.startSheetLife();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),r}(N));D.run()},"./src/external/errorUI/collector.ts":function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return n}));r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n={doms:[],destroy:function(){var t;null===(t=e.log)||void 0===t||t.debug("flow errorUICollector destroy()"),this.doms.forEach((function(e){e&&e.close&&e.close()})),this.doms=[]}}}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/external/resetLocation/resetLocation.interface.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r("../packages/services/src/instantiation.ts"),o=Object(n.c)("IResetLocation")},"./src/external/titleSync/titleSync.interface.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r("../packages/services/src/instantiation.ts"),o=Object(n.c)("ITitleSync")},"./src/external/view/mobile/header/native-header/api.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.set.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/esnext.set.add-all.js"),r("../node_modules/core-js/modules/esnext.set.delete-all.js"),r("../node_modules/core-js/modules/esnext.set.difference.js"),r("../node_modules/core-js/modules/esnext.set.every.js"),r("../node_modules/core-js/modules/esnext.set.filter.js"),r("../node_modules/core-js/modules/esnext.set.find.js"),r("../node_modules/core-js/modules/esnext.set.intersection.js"),r("../node_modules/core-js/modules/esnext.set.is-disjoint-from.js"),r("../node_modules/core-js/modules/esnext.set.is-subset-of.js"),r("../node_modules/core-js/modules/esnext.set.is-superset-of.js"),r("../node_modules/core-js/modules/esnext.set.join.js"),r("../node_modules/core-js/modules/esnext.set.map.js"),r("../node_modules/core-js/modules/esnext.set.reduce.js"),r("../node_modules/core-js/modules/esnext.set.some.js"),r("../node_modules/core-js/modules/esnext.set.symmetric-difference.js"),r("../node_modules/core-js/modules/esnext.set.union.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=r("../node_modules/lodash/clone.js"),i=r.n(s),u=r("./src/external/view/mobile/header/native-header/const.ts");function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function d(e){var t=i()(e),r=t.position,n=t.state,o=t.onClick;return t.state=void 0!==n?u.b[n]:u.b.disable,void 0!==r&&(t.position=u.a[r]),void 0!==o&&(t.onclick=window.mqq.callback(e.onClick)),t}var f=function(){function e(){Object(o.a)(this,e)}return Object(a.a)(e,null,[{key:"show",value:function(){var e;null===(e=window.mqq)||void 0===e||e.invoke("titlebar","setState",{state:1})}},{key:"hide",value:function(){var e;null===(e=window.mqq)||void 0===e||e.invoke("titlebar","setState",{state:0})}},{key:"setActionButtons",value:function(e){var t;null===(t=window.mqq)||void 0===t||t.invoke("titlebar","setActionButtons",{buttons:e.map(d)})}},{key:"updateActionButton",value:function(t,r){e.updateActionButtons([d(c({id:t},r))])}},{key:"updateActionButtons",value:function(e){var t;null===(t=window.mqq)||void 0===t||t.invoke("titlebar","updateActionButtonsById",{buttons:e.map(d)})}},{key:"showDialog",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t.id,o=t.event,a=t.content,s=t.button,i=t.onClick;e.dialogExisting.has(n)||(!0===r&&e.dialogExisting.add(n),window.mqq.invoke("titlebar","showDialogById",{id:n,event:o,msg:a,btnText:s,onclick:window.mqq.callback((function(t){i(t),e.dialogExisting.delete(n)}))}))}},{key:"hideButtonsBeforeJump",value:function(){e.setActionButtons([{id:"back",state:"show",type:"image",position:"left",url:u.c.BACK}])}}]),e}();f.dialogExisting=new Set},"./src/external/view/mobile/header/native-header/const.ts":function(e,t,r){"use strict";r.d(t,"c",(function(){return n})),r.d(t,"b",(function(){return o})),r.d(t,"a",(function(){return a})),r.d(t,"d",(function(){return s})),r.d(t,"e",(function(){return i}));var n={SHARE:"0",MENU:"1",STAR_OFF:"2",STAR_ON:"3",BACK:"4",UNDO:"5",REDO:"6",EXPAND:"7"},o={show:0,hide:1,disable:2},a={left:0,right:1,middle:2},s="nv_types",i="sheet"},"./src/external/view/mobile/header/native-header/utils.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.match.js");var n=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),o=r.n(n),a=r("../packages/common-utils/src/cookie.ts"),s=r("./src/external/view/mobile/header/native-header/const.ts");var i=void 0;function u(){return void 0!==i?i:i=!(!o.a.isTencentDocsApp||null===Object(a.getCookie)(s.d).match(s.e))}},"./src/external/view/workbench/workbench.interface.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r("../packages/services/src/instantiation.ts"),o=Object(n.c)("IWorkBenchMain")},"./src/flow/contributions.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.symbol.description.js"),r("../node_modules/core-js/modules/es.symbol.iterator.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.from.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.function.name.js"),r("../node_modules/core-js/modules/es.map.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/esnext.map.delete-all.js"),r("../node_modules/core-js/modules/esnext.map.every.js"),r("../node_modules/core-js/modules/esnext.map.filter.js"),r("../node_modules/core-js/modules/esnext.map.find.js"),r("../node_modules/core-js/modules/esnext.map.find-key.js"),r("../node_modules/core-js/modules/esnext.map.includes.js"),r("../node_modules/core-js/modules/esnext.map.key-of.js"),r("../node_modules/core-js/modules/esnext.map.map-keys.js"),r("../node_modules/core-js/modules/esnext.map.map-values.js"),r("../node_modules/core-js/modules/esnext.map.merge.js"),r("../node_modules/core-js/modules/esnext.map.reduce.js"),r("../node_modules/core-js/modules/esnext.map.some.js"),r("../node_modules/core-js/modules/esnext.map.update.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../packages/services/src/instantiation.ts"),s=r("./src/flow/lifecycle.ts"),i=r("../packages/services/src/registry.ts"),u=r("../core-sheet/js/report/whitescreen.js"),l=r("./src/flow/index.ts");function c(e,t){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"===typeof e)return d(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return d(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){i=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(i)throw a}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var f="sheet.lifecycle",h=function(){function e(){Object(n.a)(this,e),this.toBeInstantiated=new Map}return Object(o.a)(e,[{key:"init",value:function(){this.instantiationService=void 0,this.lifecycleService=void 0,this.toBeInstantiated.clear()}},{key:"registerSheetContribution",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.b.PAGE_LOAD_START;if(this.instantiationService&&this.lifecycleService&&this.lifecycleService.phase>=t)this.instantiationService.createInstance(e);else{var r=this.toBeInstantiated.get(t);r||(r=[],this.toBeInstantiated.set(t,r)),r.push(e)}}},{key:"start",value:function(e){var t=this;this.instantiationService=e.get(a.a),this.lifecycleService=e.get(s.a);var r=this.instantiationService,n=this.lifecycleService;[s.b.PAGE_LOAD_START,s.b.SPREAD_SHEET_SDK_CORE_START,s.b.SPREAD_SHEET_SDK_CORE_END,s.b.SPREAD_SHEET_PART_INTERACTIVE_START,s.b.SPREAD_SHEET_PART_INTERACTIVE_END,s.b.SPREAD_SHEET_WORKER_SATRT,s.b.SPREAD_SHEET_WORKER_END,s.b.SPREAD_SHEET_MESSAGE_START,s.b.SPREAD_SHEET_MESSAGE_END,s.b.SPREAD_SHEET_REQUEST_API_READY,s.b.SPREAD_SHEET_PLUGINS_START,s.b.SPREAD_SHEET_PLUGINS_END,s.b.PAGE_LOAD_FINISHED].forEach((function(e){t.instantiateByPhase(r,n,e)}))}},{key:"instantiateByPhase",value:function(e,t,r){var n=this;t.phase>=r?this.doInstantiateByPhase(e,r):t.when(r).then((function(){return n.doInstantiateByPhase(e,r)}))}},{key:"doInstantiateByPhase",value:function(e,t){var r=this.toBeInstantiated.get(t);if(r){this.toBeInstantiated.delete(t);var n,o=c(r);try{for(o.s();!(n=o.n()).done;){var a=n.value;this.safeCreateInstance(e,a,t)}}catch(s){o.e(s)}finally{o.f()}}}},{key:"safeCreateInstance",value:function(e,t,r){r===s.b.PAGE_LOAD_START&&u.c.start();try{e.createInstance(t),r===s.b.SPREAD_SHEET_REQUEST_API_READY&&u.c.end()}catch(n){console.error("Unable to instantiate workbench contribution ".concat(t.name,"."),n),n&&n!==l.b.NO_WHITE_SCREEN_ERROR?u.c.endWithError(n):r===s.b.SPREAD_SHEET_REQUEST_API_READY&&u.c.end()}}}]),e}();i.a.add(f,new h)},"./src/flow/flowlog.ts":function(e,t,r){"use strict";r("../node_modules/core-js/modules/es.array.for-each.js");var n,o=window;function a(){}o.log?(n=o.log,o.log.config({pid:2,release:o.RAVEN_VERSION})):(n={isFake:!0,listeners:[],var:{},namespace:"",version:0,_pid:0,_sessionId:"",_startTime:"",_uid:""},["invokeWk","config","deleteDatabase","dispatch","getDBLog","getDBLogByTime","getUUID","getWorkerVar","hideConsole","listen","loadAsset","loadAssetLoader","query","raven","record","report","reportLog","showConsole","ws","debug","error","info","log","warn"].forEach((function(e){n[e]=a}))),t.a=n},"./src/flow/index.ts":function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return A})),r.d(t,"b",(function(){return n}));r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n,o=r("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),s=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),u=r("./src/flow/phase/pc.ts"),l=r("../packages/services/src/instantiationService.ts"),c=r("../packages/services/src/serviceCollection.ts"),d=r("./src/core/app/SpreadsheetApp.interface.ts"),f=r("../packages/lib/EventEmitter.ts"),h=r("./src/external/errorUI/collector.ts"),m=r("./src/base/util/timer.ts"),p=r("./src/flow/phase/common.ts"),v=r("./src/flow/contributions.ts"),g=r("../packages/services/src/registry.ts"),y=r("./src/flow/utils.ts"),_=r("../packages/services/src/standaloneServices.ts"),b=function(e,t,r,n){var o,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(i.a)(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(s=(a<3?o(s):a>3?o(t,r,s):o(t,r))||s);return a>3&&s&&Object.defineProperty(t,r,s),s},A=function(){function t(){Object(a.a)(this,t),e.performanceData.fetchStart=Date.now(),this.initAppService(),this.initSpreadsheetApp(),this.initCoreService()}return Object(s.a)(t,[{key:"restartSheetLife",value:function(){var t;null===(t=e.log)||void 0===t||t.info("flow: restartSheetLife()"),this.coreInstantiationService&&this.coreInstantiationService.dispose(),this.startSheetLife()}},{key:"startSheetLife",value:function(){var t;null===(t=e.log)||void 0===t||t.info("flow: startSheetLife()"),Object(u.a)(),this.coreInstantiationService.invokeFunction((function(e){g.a.as(v.a).start(e)}))}},{key:"destroy",value:function(){var t;e.performanceData.navigationStart=Date.now(),e.__originUrl=location.href,e.__loadedModules&&(e.__loadedModules.length=0),e.SpreadsheetAppInitComplete=!1,h.a.destroy(),this.app.serviceCollection.destroyItializedService(),this.app.calcController.destroy(),this.app.offlineEdit.destroy(),this.app.socket.destroy(),this.app.networkStatus.destroy(),this.app.view.canvas.dataCallView.stop(),this.app.dataCenter.destroy(),this.app.mainThreadWorker.dispose(),this.app.setDidEditable(!1),window.SLR.removeAllEvent(),this.app.event.destroy(),m.a.clear(),null===(t=e.log)||void 0===t||t.info("flow destroy() end")}},{key:"initAppService",value:function(){var t;null===(t=e.log)||void 0===t||t.debug("flow: initAppService()");var r=new c.a;p.a.getServiceDescriptors().forEach((function(e){var t=Object(o.a)(e,2),n=t[0],a=t[1];r.set(n,a)})),this.appInstantiationService=new l.a(r)}},{key:"initCoreService",value:function(){var t;null===(t=e.log)||void 0===t||t.debug("flow: initCoreService()");var r=new c.a;p.b.getServiceDescriptors().forEach((function(e){var t=Object(o.a)(e,2),n=t[0],a=t[1];r.set(n,a)})),this.coreInstantiationService&&_.a.pluginInstantiationService.remove(),this.coreInstantiationService=this.appInstantiationService.createChild(r)}},{key:"initSpreadsheetApp",value:function(){var t,r=this;null===(t=e.log)||void 0===t||t.debug("flow: initSpreadsheetApp()"),this.appInstantiationService.invokeFunction((function(t){var n=t.get(d.a);r.app=n,e.SpreadsheetApp=n;var o=r.app.emitter||new f.a;r.app.initEmitter(o),r.initListenLifeCycle()}))}},{key:"initListenLifeCycle",value:function(){var t,r=this;null===(t=e.log)||void 0===t||t.debug("flow: initListenLifeCycle()"),this.app.emitter.on(this.app.EVENT.PAGE_LOAD_START,(function(){r.app.setLifeCycle(r.app.EVENT.PAGE_LOAD_START)})),this.app.emitter.on(this.app.EVENT.SPREAD_SHEET_SDK_CORE_END,(function(){r.app.setLifeCycle(r.app.EVENT.SPREAD_SHEET_SDK_CORE_END)})),this.app.emitter.on(this.app.EVENT.SPREAD_SHEET_PART_INTERACTIVE_END,(function(){r.app.setLifeCycle(r.app.EVENT.SPREAD_SHEET_PART_INTERACTIVE_END)})),this.app.emitter.on(this.app.EVENT.SPREAD_SHEET_MESSAGE_END,(function(){r.app.setLifeCycle(r.app.EVENT.SPREAD_SHEET_MESSAGE_END)})),this.app.emitter.on(this.app.EVENT.SPREAD_SHEET_PLUGINS_END,(function(){r.app.setLifeCycle(r.app.EVENT.SPREAD_SHEET_PLUGINS_END)})),this.app.emitter.on(this.app.EVENT.PAGE_LOAD_FINISHED,(function(){r.app.setLifeCycle(r.app.EVENT.PAGE_LOAD_FINISHED)}))}}]),t}();b([Object(y.a)("F_Restart_Sheet_Life")],A.prototype,"restartSheetLife",null),b([Object(y.a)("F_Start_Sheet_Life")],A.prototype,"startSheetLife",null),b([Object(y.a)("F_Destroy")],A.prototype,"destroy",null),b([Object(y.a)("F_Init_App_Service")],A.prototype,"initAppService",null),b([Object(y.a)("F_Init_Core_Service")],A.prototype,"initCoreService",null),b([Object(y.a)("F_Init_Spreadsheet_App")],A.prototype,"initSpreadsheetApp",null),b([Object(y.a)("F_Init_Listen_Life_Cycle")],A.prototype,"initListenLifeCycle",null),A=b([Object(y.a)("M_FLOW")],A),function(e){e.WHITE_SCREEN_ERROR="WHITE_SCREEN_ERROR",e.NO_WHITE_SCREEN_ERROR="NO_WHITE_SCREEN_ERROR"}(n||(n={}))}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/flow/lifecycle.ts":function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return l}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.map.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/esnext.map.delete-all.js"),r("../node_modules/core-js/modules/esnext.map.every.js"),r("../node_modules/core-js/modules/esnext.map.filter.js"),r("../node_modules/core-js/modules/esnext.map.find.js"),r("../node_modules/core-js/modules/esnext.map.find-key.js"),r("../node_modules/core-js/modules/esnext.map.includes.js"),r("../node_modules/core-js/modules/esnext.map.key-of.js"),r("../node_modules/core-js/modules/esnext.map.map-keys.js"),r("../node_modules/core-js/modules/esnext.map.map-values.js"),r("../node_modules/core-js/modules/esnext.map.merge.js"),r("../node_modules/core-js/modules/esnext.map.reduce.js"),r("../node_modules/core-js/modules/esnext.map.some.js"),r("../node_modules/core-js/modules/esnext.map.update.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/regenerator-runtime/runtime.js");var n,o=r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),a=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),s=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=r("../packages/services/src/instantiation.ts"),u=Object(i.c)("ILifecycleService");!function(e){e[e.PAGE_LOAD_START=1]="PAGE_LOAD_START",e[e.SPREAD_SHEET_SDK_CORE_START=2]="SPREAD_SHEET_SDK_CORE_START",e[e.SPREAD_SHEET_SDK_CORE_END=3]="SPREAD_SHEET_SDK_CORE_END",e[e.SPREAD_SHEET_PART_INTERACTIVE_START=4]="SPREAD_SHEET_PART_INTERACTIVE_START",e[e.SPREAD_SHEET_PART_INTERACTIVE_END=5]="SPREAD_SHEET_PART_INTERACTIVE_END",e[e.SPREAD_SHEET_WORKER_SATRT=6]="SPREAD_SHEET_WORKER_SATRT",e[e.SPREAD_SHEET_WORKER_END=7]="SPREAD_SHEET_WORKER_END",e[e.SPREAD_SHEET_MESSAGE_START=8]="SPREAD_SHEET_MESSAGE_START",e[e.SPREAD_SHEET_MESSAGE_END=9]="SPREAD_SHEET_MESSAGE_END",e[e.SPREAD_SHEET_REQUEST_API_READY=10]="SPREAD_SHEET_REQUEST_API_READY",e[e.SPREAD_SHEET_PLUGINS_START=11]="SPREAD_SHEET_PLUGINS_START",e[e.SPREAD_SHEET_PLUGINS_END=12]="SPREAD_SHEET_PLUGINS_END",e[e.PAGE_LOAD_FINISHED=13]="PAGE_LOAD_FINISHED"}(n||(n={}));var l=function(){function t(){Object(a.a)(this,t),this._phase=n.PAGE_LOAD_START,this.phaseWhen=new Map}return Object(s.a)(t,[{key:"when",value:function(){var e=Object(o.a)(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t<=this._phase)){e.next=2;break}return e.abrupt("return");case 2:return(r=this.phaseWhen.get(t))||(r=new c,this.phaseWhen.set(t,r)),e.next=6,r.wait();case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"phase",get:function(){return this._phase},set:function(t){var r;if(t<this.phase)throw null===(r=e.log)||void 0===r||r.error("Lifecycle cannot go backwards from ".concat(this.phase," to ").concat(t)),new Error("Lifecycle cannot go backwards from ".concat(this.phase," to ").concat(t));if(this._phase!==t){this._phase=t;var n=this.phaseWhen.get(this._phase);n&&(n.open(),this.phaseWhen.delete(this._phase))}}}]),t}(),c=function(){function e(){var t=this;Object(a.a)(this,e),this._isOpen=!1,this._promise=new Promise((function(e,r){t._completePromise=e}))}return Object(s.a)(e,[{key:"isOpen",value:function(){return this._isOpen}},{key:"open",value:function(){this._isOpen=!0,this._completePromise(!0)}},{key:"wait",value:function(){return this._promise}}]),e}()}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/flow/phase/common.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return O})),r.d(t,"b",(function(){return I}));r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/regenerator-runtime/runtime.js");var n=r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),i=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),u=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),l=r("../packages/services/src/extensions.ts"),c=r("./src/core/app/SpreadsheetApp.ts"),d=r("./src/core/app/SpreadsheetApp.interface.ts"),f=r("../packages/mutation/src/index.ts"),h=r("../packages/undoRedoStack/src/index.ts"),m=r("./src/core/app/permissions/index.ts"),p=r("./src/flow/lifecycle.ts"),v=r("./src/core/app/sheetStatus/index.ts"),g=r("./src/core/behavior/api.interface.ts"),y=r("../packages/services/src/dynamicLoader.ts"),_=r("./src/base/event/event.ts"),b=r("../packages/model/src/spreadsheet/Spreadsheet.interface.ts"),A=r("../packages/model/src/spreadsheet/Spreadsheet.ts"),E=r("./src/core/view/layout/pcView.ts"),j=r("./src/core/app/contributes/interface.ts"),R=(r("../node_modules/core-js/modules/es.function.name.js"),r("../node_modules/@tencent/doc-contribute/dist/contributes.js")),S=r.n(R),C=function(){function e(){Object(o.a)(this,e)}return Object(a.a)(e,[{key:"getContribute",value:function(e){return S.a.getContribute(e)}},{key:"setContribute",value:function(e){var t=e.name,r=e.json,n=e.context;return S.a.setContribute({name:t,json:r,context:n})}},{key:"updateContribute",value:function(e){var t=e.name,r=e.context;return S.a.updateContribute({name:t,context:r})}}]),e}(),T=r("./src/core/data/configService/appfeatureConfigService.ts");function w(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(u.a)(e);if(t){var o=Object(u.a)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}var O=new l.a,I=new l.a;O.register(d.a,c.a),O.register(b.a,A.a),O.register(E.a,E.b),O.register(v.a,v.b),I.register(f.d,f.f,[],!0),I.register(h.a,h.b),I.register(m.a,m.b),I.register(p.a,p.c),I.register(_.b,_.a),I.register(g.a,function(e){Object(s.a)(i,e);var t=w(i);function i(){return Object(o.a)(this,i),t.apply(this,arguments)}return Object(a.a)(i,[{key:"getModule",value:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e("bundle_module_behavior_api").then(r.bind(null,"./src/core/behavior/api.ts"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),i}(y.a)),I.register(j.a,C),I.register(T.a,T.b)},"./src/flow/phase/pc.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return Q}));r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),o=r("./src/flow/phase/common.ts"),a=r("../packages/services/src/registry.ts"),s=r("./src/flow/contributions.ts"),i=r("./src/flow/lifecycle.ts"),u=r("./src/flow/phase/services/sdkCoreService.ts"),l=r("./src/flow/phase/services/partInteractable.ts"),c=(r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/regenerator-runtime/runtime.js"),r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js")),d=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),f=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),h=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),m=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),p=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),v=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),g=r("../packages/services/src/dynamicLoader.ts"),y=r("../packages/services/src/instantiation.ts");function _(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(p.a)(e);if(t){var o=Object(p.a)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Object(m.a)(this,r)}}var b=function(e,t,r,n){var o,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(v.a)(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(s=(a<3?o(s):a>3?o(t,r,s):o(t,r))||s);return a>3&&s&&Object.defineProperty(t,r,s),s},A=function(e,t){return function(r,n){t(r,n,e)}},E=Object(y.c)("IMessageService");o.b.register(E,function(e){Object(h.a)(n,e);var t=_(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"getModule",value:function(){var e=Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e("bundle_messageService").then(r.bind(null,"./src/flow/phase/services/messageService.ts"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(g.a));var j=function(){function e(t){Object(d.a)(this,e),this.messageService=t,this.init()}return Object(f.a)(e,[{key:"init",value:function(){var e=Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.messageService.getInstance();case 2:e.sent;case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),R=j=b([A(0,E)],j),S=r("./src/flow/phase/services/workerService.ts"),C=r("./src/flow/phase/services/interface/workerService.interface.ts");function T(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(p.a)(e);if(t){var o=Object(p.a)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Object(m.a)(this,r)}}var w=function(e,t,r,n){var o,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(v.a)(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(s=(a<3?o(s):a>3?o(t,r,s):o(t,r))||s);return a>3&&s&&Object.defineProperty(t,r,s),s},O=function(e,t){return function(r,n){t(r,n,e)}};o.b.register(C.a,function(e){Object(h.a)(n,e);var t=T(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"getModule",value:function(){var e=Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(r.bind(null,"./src/flow/phase/services/workerService.ts"));case 2:return e.abrupt("return",e.sent.CalculationService);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(g.a)),o.b.register(S.IWorkerService,function(e){Object(h.a)(n,e);var t=T(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"getModule",value:function(){var e=Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(r.bind(null,"./src/flow/phase/services/workerService.ts"));case 2:return e.abrupt("return",e.sent.WorkerService);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(g.a));var I=function(){function e(t,r){Object(d.a)(this,e),this.calculationService=t,this.workerService=r,this.init()}return Object(f.a)(e,[{key:"init",value:function(){var e=Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.calculationService.getInstance();case 2:return e.sent,e.next=5,this.workerService.getInstance();case 5:e.sent;case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),N=I=w([O(0,C.a),O(1,S.IWorkerService)],I);function k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(p.a)(e);if(t){var o=Object(p.a)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Object(m.a)(this,r)}}var M=function(e,t,r,n){var o,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(v.a)(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(s=(a<3?o(s):a>3?o(t,r,s):o(t,r))||s);return a>3&&s&&Object.defineProperty(t,r,s),s},D=function(e,t){return function(r,n){t(r,n,e)}},x=Object(y.c)("IEditableService");o.b.register(x,function(e){Object(h.a)(n,e);var t=k(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"getModule",value:function(){var e=Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e("bundle_editableService").then(r.bind(null,"./src/flow/phase/services/editableService.ts"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(g.a));var F=function(){function e(t){Object(d.a)(this,e),this.editableService=t,this.init()}return Object(f.a)(e,[{key:"init",value:function(){var e=Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.editableService.getInstance();case 2:e.sent;case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),P=F=M([D(0,x)],F),L=r("./src/external/titleSync/titleSync.interface.ts"),U=r("./src/external/view/workbench/workbench.interface.ts"),B=r("./src/core/feature/Feature.interface.ts"),H=r("./src/external/resetLocation/resetLocation.interface.ts");function G(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(p.a)(e);if(t){var o=Object(p.a)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Object(m.a)(this,r)}}function V(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(p.a)(e);if(t){var o=Object(p.a)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Object(m.a)(this,r)}}o.b.register(L.a,function(e){Object(h.a)(n,e);var t=G(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"getModule",value:function(){var e=Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e("bundle_plugin_titlesync").then(r.bind(null,"./src/external/titleSync/titleSync.ts"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(g.a)),o.b.register(U.a,function(e){Object(h.a)(n,e);var t=G(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"getModule",value:function(){var e=Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e("bundle_view_workbench").then(r.bind(null,"./src/external/view/workbench/workbench.ts"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(g.a)),o.b.register(B.a,function(e){Object(h.a)(n,e);var t=G(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"getModule",value:function(){var e=Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e("bundle_feature").then(r.bind(null,"./src/core/feature/Feature.ts"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(g.a)),o.b.register(H.a,function(e){Object(h.a)(n,e);var t=G(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"getModule",value:function(){var e=Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e("bundle_reset_location").then(r.bind(null,"./src/external/resetLocation/index.ts"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(g.a));var W=function(e,t,r,n){var o,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(v.a)(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(s=(a<3?o(s):a>3?o(t,r,s):o(t,r))||s);return a>3&&s&&Object.defineProperty(t,r,s),s},Y=function(e,t){return function(r,n){t(r,n,e)}},z=Object(y.c)("IPcPluginService");o.b.register(z,function(e){Object(h.a)(n,e);var t=V(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"getModule",value:function(){var e=Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e("bundle_pcPluginService").then(r.bind(null,"./src/flow/phase/services/plugins/pc.ts"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(g.a));var K=function(){function e(t){Object(d.a)(this,e),this.pcPluginService=t,this.init()}return Object(f.a)(e,[{key:"init",value:function(){var e=Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pcPluginService.getInstance();case 2:e.sent;case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),q=K=W([Y(0,z)],K);function Q(){var e=a.a.as(s.a);e.init(),[[u.a,i.b.PAGE_LOAD_START],[l.a,i.b.SPREAD_SHEET_SDK_CORE_END],[N,i.b.SPREAD_SHEET_PART_INTERACTIVE_END],[R,i.b.SPREAD_SHEET_WORKER_END],[P,i.b.SPREAD_SHEET_MESSAGE_END],[q,i.b.SPREAD_SHEET_REQUEST_API_READY]].forEach((function(t){e.registerSheetContribution.apply(e,Object(n.a)(t))}))}},"./src/flow/phase/services/interface/workerService.interface.ts":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r("../packages/services/src/instantiation.ts"),o=Object(n.c)("ICalculationService")},"./src/flow/phase/services/partInteractable.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/regenerator-runtime/runtime.js");var n,o,a=r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),s=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),i=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),u=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),l=r("./src/core/app/SpreadsheetApp.interface.ts"),c=r("./src/core/view/layout/pcView.ts"),d=r("./src/core/data/configService/spreadConfig.ts"),f=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),h=r.n(f),m=r("../core-sheet/js/report/whitescreen.js"),p=r("../packages/services/src/instantiation.ts"),v=r("./src/flow/lifecycle.ts"),g=r("./src/flow/utils.ts"),y=function(e,t,r,n){var o,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(u.a)(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(s=(a<3?o(s):a>3?o(t,r,s):o(t,r))||s);return a>3&&s&&Object.defineProperty(t,r,s),s},_=function(e,t){return function(r,n){t(r,n,e)}},b=n=function(){function t(e,r,n){Object(s.a)(this,t),this.lifecycle=e,this.app=r,this.instantiationService=n,this.initPartInteractable()}return Object(i.a)(t,[{key:"initPartInteractable",value:function(){var t=Object(a.a)(regeneratorRuntime.mark((function t(){var r,n,o,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===(r=e.log)||void 0===r||r.info("flow PartInteractableService initPartInteractable()",!!this.app.view),this.app.emitter.emit(this.app.EVENT.SPREAD_SHEET_PART_INTERACTIVE_START,this.app.spreadsheet.activeSheetId),this.lifecycle.phase=v.b.SPREAD_SHEET_PART_INTERACTIVE_START,this.initTitleDom(),this.app.initInstantiationService(this.instantiationService),m.a.start(),this.initCanvasDom(),!this.app.view){t.next=13;break}return null===(n=e.log)||void 0===n||n.debug("flow PartInteractableService reset view & Canvas"),t.next=11,this.app.view.resetAndRefreshExcelView(this.app.spreadsheet.activeSheetId);case 11:t.next=17;break;case 13:return null===(o=e.log)||void 0===o||o.debug("flow PartInteractableService init view & Canvas"),this.initView(),t.next=17,this.app.view.initCanvas();case 17:m.a.end(),this.removeSSRDom(),e.firstLoading&&e.firstLoading.hide(),e.snackLoading&&(null===(a=e.log)||void 0===a||a.info("flow PartInteractableService 2s\u540e\u663e\u793a\u6b63\u5728\u540c\u6b65loading"),e.snackLoading.show(2e3)),this.app.emitter.emit(this.app.EVENT.SPREAD_SHEET_PART_INTERACTIVE_END,this.app.spreadsheet.activeSheetId),this.lifecycle.phase=v.b.SPREAD_SHEET_PART_INTERACTIVE_END;case 23:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"initTitleDom",value:function(){var t;null===(t=e.log)||void 0===t||t.debug("flow PartInteractableService initTitleDom()");var r,n,o,a=document.getElementById("padAloneTitle"),s=d.a.getConfig("title");(a&&a.setAttribute("value",s),document.title=s,h.a.isIOS)&&(null===(r=e.mqq)||void 0===r||null===(n=r.ui)||void 0===n||null===(o=n.refreshTitle)||void 0===o||o.call(n))}},{key:"initCanvasDom",value:function(){var t,r;(null===(t=e.log)||void 0===t||t.debug("flow PartInteractableService initCanvasDom()",!!this.app.view),this.app.view)||(!h.a.isMobilePhone&&!h.a.isAndroidPad||h.a.isIPad?(n.initEditorDom(),/mozilla/.test(navigator.userAgent)&&!/(compatible|webkit)/.test(navigator.userAgent)&&(document.documentElement.style.position="fixed")):null===(r=e.log)||void 0===r||r.info("\u79fb\u52a8\u7aef\u4e3a\u4e86\u652f\u6301\u5168\u5c4f\u6a21\u5f0f\uff0c\u6240\u4ee5\u6574\u4f53\u7ed3\u6784\u4f1a\u6709\u4e0d\u540c\uff0c\u4e0d\u9700\u8981\u8fd9\u91cc\u7684\u63d2\u5165\u5bb9\u5668"))}},{key:"initView",value:function(){var t,r=this;null===(t=e.log)||void 0===t||t.debug("flow PartInteractableService initView()"),this.instantiationService.invokeFunction((function(e){var t=e.get(c.a);r.app.initView(t)}))}},{key:"removeSSRDom",value:function(){var e=document.querySelector("#ssrContainerWrapper");e&&setTimeout((function(){document.body.removeChild(e)}))}}],[{key:"initEditorDom",value:function(){var e=document.getElementById("mainEditor");if(e){for(var t=n.initCanvasContainer(e),r={};e.firstChild;)r.node=e.removeChild(e.lastChild),delete r.node;e.appendChild(t)}}},{key:"initCanvasContainer",value:function(e){var t=e?e.getBoundingClientRect().top:0,r=document.createElement("div");return r.id="canvasContainer",r.innerHTML="",r.style.width="100%",r.style.height="".concat(window.innerHeight-t,"px"),r.style.zIndex="500",r.style.display="block",r}}]),t}();y([Object(g.a)("F_Init_Part_Interactable")],b.prototype,"initPartInteractable",null),y([Object(g.a)("F_Init_Title_Dom")],b.prototype,"initTitleDom",null),y([Object(g.a)("F_Init_Canvas_Dom")],b.prototype,"initCanvasDom",null),y([Object(g.a)("F_Init_View")],b.prototype,"initView",null),b=n=y([Object(g.a)("M_Part_Interactable_Service"),_(0,v.a),_(1,l.a),_(2,p.a)],b),t.a=b,function(e){e.WHITE_SCREEN_ERROR="WHITE_SCREEN_ERROR",e.NO_WHITE_SCREEN_ERROR="NO_WHITE_SCREEN_ERROR"}(o||(o={}))}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/flow/phase/services/sdkCoreService.ts":function(e,t,r){"use strict";(function(e){r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/core-js/modules/web.url.js"),r("../node_modules/regenerator-runtime/runtime.js");var n=r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),i=r("./src/core/app/event-init.ts"),u=r("../packages/common-utils/src/url.ts"),l=r("./src/core/network/datacenter/datacenter.ts"),c=r("./src/core/app/permissions/index.ts"),d=r("./src/core/app/sheetStatus/index.ts"),f=r("../packages/mutation/src/api.interface.ts"),h=r("./src/core/data/converter/tencentdoc/keyframeToSheetConverter.ts"),m=r("./src/base/config/report.ts"),p=r("../packages/report/src/index.ts"),v=r("./src/base/event/eventName.ts"),g=r("../packages/services/src/instantiation.ts"),y=r("./src/flow/lifecycle.ts"),_=r("./src/core/app/SpreadsheetApp.interface.ts"),b=r("./src/core/network/datacenter/loader/loaderErrorType.ts"),A=r("./src/core/app/utils.ts"),E=r("../packages/model/src/spreadsheet/Spreadsheet.interface.ts"),j=r("./src/flow/utils.ts"),R=r("../node_modules/@tencent/tdocs_support_bridge/lib/index.js"),S=r("./src/core/data/configService/appfeatureConfigService.ts"),C=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(s.a)(Reflect))&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},T=function(e,t){return function(r,n){t(r,n,e)}};function w(){var e=location.href;return new URL(e).pathname.split("/").pop()||""}var O,I=function(){function t(e,r,n){Object(o.a)(this,t),this.lifecycle=e,this.app=r,this.instantiationService=n,this.initSdkCore()}return Object(a.a)(t,[{key:"initSdkCore",value:function(){var t=Object(n.a)(regeneratorRuntime.mark((function t(){var r,n,o,a,s,i,h,m,p,v,g,_,b,A=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return null===(r=e.log)||void 0===r||r.debug("flow SdkCoreService initSdkCore()"),this.initFlowEventListener(),this.initSpeedReportEvent(),this.app.emitter.emit(this.app.EVENT.SPREAD_SHEET_SDK_CORE_START),this.lifecycle.phase=y.b.SPREAD_SHEET_SDK_CORE_START,this.app.data={initMutations:[]},this.instantiationService.invokeFunction((function(e){if(A.app.sheetStatus)A.app.sheetStatus.update();else{var t=e.get(d.a);A.app.initSheetStatus(t)}var r=e.get(c.a);A.app.initPermissions(r);var n=e.get(E.a);A.app.initSpreadsheet(n);var o=e.get(f.a);A.app.initMutationBehavior(o);var a=e.get(S.a);A.app.initAppFeatureConfigService(a)})),this.initEvent(),this.initDataCenter(),t.prev=9,e.performanceData&&(e.performanceData.spreadInitDataStart=+new Date),t.next=13,this.getDocumentData();case 13:if(n=t.sent,e.performanceData&&(e.performanceData.spreadInitDataEnd=+new Date),o=n.spreadConfig,a=n.firstData,s=n.isFinished,i=o.getConfig("dver"),h=e.__globalCodeVersion,this.checkDver(i,h)){t.next=21;break}return null===(m=e.log)||void 0===m||m.error("flow SdkCoreService checkDver false"),t.abrupt("return");case 21:if(e.performanceData&&(e.performanceData.dataStart=+new Date),p=o.getConfig("defaultSheetId"),v=j.c.deduplication(o.getConfig("sheetList")),!j.c.checkAllHidden(v)){t.next=28;break}v=j.c.showOnlySheet(v,p),t.next=33;break;case 28:if(!j.c.checkCurrHidden(v,p)){t.next=33;break}return _=j.c.showNextSheet(v,p),null===(g=e.log)||void 0===g||g.error("flow SdkCoreService \u5f53\u524dsheet\u662f\u9690\u85cf\u7684\uff0c\u8df3\u8f6c\u5230\u5176\u4ed6sheet. currentSheetId=".concat(p," nextSheetId=").concat(_)),e.location.href=Object(u.updateURLParameters)(e.location.href,{tab:_}),t.abrupt("return");case 33:this.updateSpreadsheet({sheetList:v,defaultSheetId:p,spreadsheetId:o.getConfig("globalPadId"),title:o.getConfig("title"),baseVersion:o.getConfig("rev")},a,s),e.performanceData&&(e.performanceData.dataEnd=+new Date),this.app.permissions.update(o),t.next=45;break;case 38:if(t.prev=38,t.t0=t.catch(9),console.error("flow SdkCoreService initSdkCore error: ",t.t0),null===(b=e.log)||void 0===b||b.error("flow SdkCoreService initSdkCore error",null===t.t0||void 0===t.t0?void 0:t.t0.stack),!t.t0||t.t0!==l.b.LOAD_DOCUMENT_DATA_ERROR){t.next=44;break}throw O.NO_WHITE_SCREEN_ERROR;case 44:throw t.t0;case 45:return this.app.setInited(!0),this.app.emitter.emit(this.app.EVENT.SPREAD_SHEET_SDK_CORE_END),this.lifecycle.phase=y.b.SPREAD_SHEET_SDK_CORE_END,t.abrupt("return",!0);case 49:case"end":return t.stop()}}),t,this,[[9,38]])})));return function(){return t.apply(this,arguments)}}()},{key:"onAllChunkReady",value:function(){var t,r=this;null===(t=e.log)||void 0===t||t.info("flow SdkCoreService onAllChunkReady()"),this.app.emitter.emit(this.app.EVENT.SPREAD_SHEET_ALL_CHUNK_READY),e.SpreadsheetAppInitComplete=!0,this.app.emitter.on(this.app.EVENT.PAGE_LOAD_FINISHED,(function(){var t;r.app.dataCenter.preloadSheetsData({leftCount:1,rightCount:1});var n=Object(j.b)(e.__loadedModules);null===(t=e.log)||void 0===t||t.info("reportLoadFlow",n,e.isContainer,e.__isOfflinePkg),p.b.tdwReport({opername:"excel_performance",module:"start",action:"moduleLoadFlow",ver5:n,ver9:JSON.stringify({container:e.isContainer?1:0,offline_package:e.__isOfflinePkg?1:0})})}))}},{key:"initFlowEventListener",value:function(){var t,r=this;null===(t=e.log)||void 0===t||t.debug("flow SdkCoreService initFlowEventListener()"),this.listenAppEvents([this.app.EVENT.SPREAD_SHEET_REQUEST_API_READY,this.app.EVENT.SPREAD_SHEET_ALL_CHUNK_READY],(function(){var t;null===(t=e.log)||void 0===t||t.info("SPREAD_SHEET_EDITABLE \u5b8c\u6574\u53ef\u7f16\u8f91"),r.app.emitter.emitSync(r.app.EVENT.SPREAD_SHEET_EDITABLE),r.app.messageCenter.taskQueue.resume(),r.app.setDidEditable(!0)}))}},{key:"listenAppEvents",value:function(e,t){var r=this,n=e.map((function(e){return new Promise((function(t,n){r.app.emitter.once(e,t)}))}));Promise.all(n).then((function(){t()}))}},{key:"initSpeedReportEvent",value:function(){var t,r=this;null===(t=e.log)||void 0===t||t.debug("flow SdkCoreService initSpeedReportEvent()"),this.app.event.init.listen(v.a.AFTER_FIRST_RENDER,(function(){R.a.sendEvent("sheet","fcp"),e.performanceData&&(e.performanceData.afterFirstRender=+new Date)})),this.app.event.init.listen(v.a.AFTER_ALL_RENDER,(function(){e.performanceData&&(e.performanceData.afterAllRender=+new Date),r.app.emitter.emit(r.app.EVENT.PAGE_LOAD_FINISHED),r.lifecycle.phase=y.b.PAGE_LOAD_FINISHED})),this.app.emitter.on(this.app.EVENT.SPREAD_SHEET_PART_INTERACTIVE_END,(function(){R.a.sendEvent("sheet","tti"),e.performanceData&&(e.performanceData.interactable=+new Date)})),this.app.emitter.on(this.app.EVENT.SPREAD_SHEET_SDK_CORE_START,(function(){e.performanceData&&(e.performanceData.spreadInitStart=+new Date)})),this.app.emitter.on(this.app.EVENT.SPREAD_SHEET_SDK_CORE_END,(function(){e.performanceData&&(e.performanceData.spreadInitEnd=+new Date)})),this.app.emitter.on(this.app.EVENT.SPREAD_SHEET_PART_INTERACTIVE_START,(function(){e.performanceData&&(e.performanceData.viewStart=+new Date)})),this.app.emitter.on(this.app.EVENT.SPREAD_SHEET_PART_INTERACTIVE_END,(function(){e.performanceData&&(e.performanceData.viewEnd=+new Date)})),this.app.emitter.on(this.app.EVENT.PAGE_LOAD_FINISHED,(function(){R.a.sendEvent("sheet","pageLoadFinished"),e.performanceData&&(e.performanceData.pageLoadFinished=+new Date)}))}},{key:"initEvent",value:function(){var t;null===(t=e.log)||void 0===t||t.debug("flow SdkCoreService initEvent()"),new i.a(this.app)}},{key:"initDataCenter",value:function(){var t,r=this;null===(t=e.log)||void 0===t||t.debug("flow SdkCoreService initDataCenter()");var n=new l.a({app:this.app,handleClientVars:function(t,r){window.spreadConfig=r;var n=!!Object(u.getQuery)("inToastPreview"),o=!n&&t.isCreator&&!!Object(u.getQuery)("uniquefileid");t.preview=!o&&(t.preview||n),window.clientVars=t;var a=t.collab_client_vars.padSubId;a&&e.history.replaceState(a,"",Object(u.updateURLParameters)(e.location.href,{tab:a}))},getBaseVersion:function(){var e;return null===(e=r.app.messageCenter)||void 0===e?void 0:e.currentVersion}});this.app.initDataCenter(n)}},{key:"getDocumentData",value:function(){var t=Object(n.a)(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return null===(r=e.log)||void 0===r||r.info("flow SdkCoreService getDocumentData()"),t.next=3,this.initData(w(),Object(u.getQuery)("tab")||"");case 3:return n=t.sent,t.abrupt("return",n);case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"initData",value:function(e,t){var r=this,o=+new Date;return this.app.dataCenter.loadDocumentData({secretId:e,sheetId:t,onSuccess:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.app.dataCenter.applyChunkData(t,{isLazy:!0,switchSheetTimeStart:o,isInit:!0,onFinished:function(){r.onAllChunkReady()}});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onFail:function(e){var n;console.error("initData\u9519\u8bef".concat(JSON.stringify(e))),r.app.dataCenter.handleLoadError({sheetId:t||"BB08J2",message:(null===e||void 0===e?void 0:e.error.message)||"\u6570\u636e\u62c9\u53d6\u5931\u8d25",type:(null===e||void 0===e||null===(n=e.error)||void 0===n?void 0:n.type)||b.b.LOAD_ONLINE_SHEET_DATA_FAIL,code:(null===e||void 0===e?void 0:e.code)||-1,error:e})}})}},{key:"updateSpreadsheet",value:function(t,r,n){var o,a=t.sheetList,s=t.spreadsheetId,i=t.defaultSheetId,u=t.title,l=t.baseVersion;null===(o=e.log)||void 0===o||o.debug("flow SdkCoreService updateSpreadsheet()",t,n);var c={spreadsheetId:s,title:u,sheetList:a,activeSheetId:i,baseVersion:l};this.app.initOptions=c,this.app.spreadsheet.reInit({spreadsheetId:s,title:u,sheetList:a,activeSheetId:i}),function(e){for(var t={},r=0;r<e.length;r++){var n=e[r].id;if(t[n])return!0;t[n]=!0}return!1}(a)&&p.b.run(m.CONFIG.DUPLICATE_SHEET_ID,[a]);var d=this.app.spreadsheet.sheetManager.getSheetBySheetId(i);null===d||void 0===d||d.startLoading(),Object(h.a)(this.app.spreadsheet,i,r),this.app.setInited(!0)}},{key:"checkDver",value:function(t,r){return!e.isContainer||(!!Object(A.a)(t,r)||(null===(n=e.log)||void 0===n||n.error("flow checkDver \u6570\u636e\u7684\u7248\u672c\u53f7\u548c\u4ee3\u7801\u7684\u7248\u672c\u53f7\u4e0d\u4e00\u81f4\uff0c\u8d70\u7ebf\u4e0a",r,t),window.location.replace(location.href),!1));var n}}]),t}();C([Object(j.a)("F_Init_SDK_Core")],I.prototype,"initSdkCore",null),C([Object(j.a)("F_On_All_Chunk_Ready")],I.prototype,"onAllChunkReady",null),C([Object(j.a)("F_Init_Speed_Report_Event")],I.prototype,"initSpeedReportEvent",null),C([Object(j.a)("F_Init_Event")],I.prototype,"initEvent",null),C([Object(j.a)("F_Init_Data_Center")],I.prototype,"initDataCenter",null),C([Object(j.a)("F_Get_Document_Data")],I.prototype,"getDocumentData",null),C([Object(j.a)("F_Init_Data")],I.prototype,"initData",null),C([Object(j.a)("F_Update_Spreadsheet")],I.prototype,"updateSpreadsheet",null),I=C([Object(j.a)("M_SDK_Core_Service"),T(0,y.a),T(1,_.a),T(2,g.a)],I),t.a=I,function(e){e.WHITE_SCREEN_ERROR="WHITE_SCREEN_ERROR",e.NO_WHITE_SCREEN_ERROR="NO_WHITE_SCREEN_ERROR"}(O||(O={}))}).call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/flow/phase/services/workerService.ts":function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"IWorkerService",(function(){return b})),r.d(t,"CalculationService",(function(){return A})),r.d(t,"WorkerService",(function(){return E}));r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/regenerator-runtime/runtime.js");var n=r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=r("../node_modules/@babel/runtime/helpers/esm/typeof.js"),i=r("../packages/services/src/instantiation.ts"),u=r("../packages/services/src/dispose.ts"),l=r("../packages/report/src/index.ts"),c=r("./src/core/app/SpreadsheetApp.interface.ts"),d=r("./src/core/feature/formula/calcControllerTaskQueue.ts"),f=r("./src/core/feature/formula/utils.ts"),h=r("./src/core/feature/formula/controller.ts"),m=r("./src/core/worker/index.ts"),p=r("./src/flow/lifecycle.ts"),v=r("./src/flow/utils.ts"),g=r("./src/flow/phase/services/interface/workerService.interface.ts"),y=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(s.a)(Reflect))&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},_=function(e,t){return function(r,n){t(r,n,e)}},b=Object(i.c)("IWorkerService"),A=function(){function e(t){Object(o.a)(this,e),this.app=t,this.initCalcController()}return Object(a.a)(e,[{key:"initCalcController",value:function(){var e=new h.a(this.app);this.calcController=e,e.initEdit(this.app.data.initMutations),this.app.data.initMutations.length=0,this.app.initCalcController(e),Object(d.b)()}}]),e}();A=y([_(0,c.a)],A);var E=function(){function t(e,r,n){Object(o.a)(this,t),this.lifecycle=e,this.app=r,this.calculationService=n,this.initWorker()}return Object(a.a)(t,[{key:"initWorker",value:function(){var t=Object(n.a)(regeneratorRuntime.mark((function t(){var r,n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.lifecycle.phase=p.b.SPREAD_SHEET_WORKER_SATRT,null===(r=e.log)||void 0===r||r.info("flow WorkerService initWorker()",e.SpreadsheetAppInitComplete),this.initMainThreadWorker(),e.SpreadsheetAppInitComplete?this.initSpreadsheetAppInWorker():this.app.emitter.once(this.app.EVENT.SPREAD_SHEET_ALL_CHUNK_READY,(function(){var t;null===(t=e.log)||void 0===t||t.info("flow WorkerService on SPREAD_SHEET_ALL_CHUNK_READY"),n.initSpreadsheetAppInWorker()})),this.lifecycle.phase=p.b.SPREAD_SHEET_WORKER_END;case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"initMainThreadWorker",value:function(){var e=Object(m.a)({workerName:"defaultWorker"});this.mainThreadWorker=e,this.app.initMainThreadWorker(e),Object(u.f)(e)}},{key:"initSpreadsheetAppInWorker",value:function(){var t=Object(n.a)(regeneratorRuntime.mark((function t(r){var n,o,a,s,i,u,c,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o=this.app.initOptions,a=o.activeSheetId,s=o.title,i=o.sheetList,u=o.spreadsheetId,c=o.baseVersion,null===(n=e.log)||void 0===n||n.debug("flow WorkerService initSpreadsheetAppInWorker()"),d=Object(f.g)(this.app.spreadsheet,a),this.app.mainThreadWorker.sheetData.initSpreadsheetApp({activeSheetId:a,header:i,spreadsheetId:u,title:s,waitForFormulaLayerToBeInitialized:!0,baseVersion:c}),this.mainThreadWorker.loadSheetToWorkerIfNeeded(a,{checked:!0,defaultNeedLoadInWorker:d.needLoadInWorker}),d.needLoadInWorker?l.b.tdwReport({opername:"tech_doc",module:"webworker",action:"need_worker_when_init",ver5:JSON.stringify(d)}):this.app.calcController.sheetFormulaLayerStatusMap.setInitializedDone(a);case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),t}();y([Object(v.a)("F_Init_Worker")],E.prototype,"initWorker",null),y([Object(v.a)("F_Init_Main_Thread_Worker")],E.prototype,"initMainThreadWorker",null),y([Object(v.a)("F_Init_Spreadsheet_App_In_Worker")],E.prototype,"initSpreadsheetAppInWorker",null),E=y([Object(v.a)("M_Worker_Service"),_(0,p.a),_(1,c.a),_(2,g.a)],E)}.call(this,r("../node_modules/webpack/buildin/global.js"))},"./src/flow/utils.ts":function(e,t,r){"use strict";(function(e){r.d(t,"c",(function(){return a})),r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return i}));r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.for-each.js"),r("../node_modules/core-js/modules/es.array.index-of.js"),r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),o=r.n(n),a={deduplication:function(e){var t=[],r={};return e.forEach((function(e){r[e.id]||(t.push(e),r[e.id]=1)})),t},checkAllHidden:function(e){var t=!0;return e.forEach((function(e){!1!==e.hidden&&void 0!==e.hidden||(t=!1)})),t},checkCurrHidden:function(e,t){var r=!1;return e.forEach((function(e){e.id===t&&(r=!!e.hidden)})),r},showOnlySheet:function(e,t){return e.map((function(e){var r=e;return e.id===t&&(r.hidden=!1),r}))},showNextSheet:function(e,t){var r=e.filter((function(e){return!1===e.hidden||void 0===e.hidden||e.id===t})).map((function(e){return e.id}));if(r.length<=1)return r[0];var n=r.indexOf(t);return 0===n?r[1]:r[n-1]}};function s(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];e.__loadedModules=e.__loadedModules||[];var a=n.length;if(1===a)e.__loadedModules.push({moduleName:r[0],step:"LOADED"});else if(3===a){var s=n[2],i=s.value;e.__loadedModules.push({moduleName:r[0],step:"LOADED"}),s.value=function(){var t;null===(t=e.__loadedModules)||void 0===t||t.push({moduleName:r[0],step:r[1]||"START"});var n=i.apply(this,arguments);return n}}}}function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map((function(e){var t="PC";o.a.isPC?t="PC":o.a.isMobile||o.a.isAndroidPad?t="MOBILE":o.a.isIPad&&(t="PAD");var r=u[t]["".concat(e.moduleName,"_").concat(e.step)];return void 0===r?"":String(r)})).filter((function(e){return""!==e})).join("_")}var u={PC:{F_Init_App_Service_START:49,F_Init_Spreadsheet_App_START:50,F_Init_Emitter_END:51,F_Init_Listen_Life_Cycle_START:52,F_Init_Core_Service_START:53,F_Init_SDK_Core_START:55,F_Init_Speed_Report_Event_START:56,F_Init_Sheet_Status_END:57,F_Init_Permissions_END:58,F_Init_Spreadsheet_END:59,F_Init_Mutation_Behavior_END:60,F_Init_Event_START:61,F_Init_Data_Center_START:62,F_Get_Document_Data_START:64,F_Init_Data_START:65,F_Update_Spreadsheet_START:66,F_Set_Inited_END:67,F_Init_Part_Interactable_START:69,F_Init_Title_Dom_START:70,F_Init_Canvas_Dom_START:71,F_Init_View_START:72,F_Init_Worker_START:77,F_Init_Main_Thread_Worker_END:79,F_Init_Calc_Controller_END:81,F_Init_Network_Status_END:86,F_Init_MessageCenter_END:87,F_Init_Socket_END:88,F_Init_Offline_Edit_END:89,F_On_All_Chunk_Ready_START:90,F_Init_Spreadsheet_App_In_Worker_START:91,F_Init_Editable_START:94,F_Init_Undo_Redo_Stack_START:95,F_Init_Service_Collection_START:98,F_Init_Tools_START:117,F_Init_Plugins_START:118,F_Init_Core_Sheet_START:119,F_Init_Feature_START:120,F_Init_Error_Code_START:121,F_Init_UI_Manager_START:122,F_Init_Title_Sync_START:123,F_Init_Full_Member_START:124,F_Init_Record_Modal_START:125,F_Init_User_Guide_START:126,F_Init_Report_START:127,F_Init_Error_Code_Modal_START:128,F_Init_Range_Auth_START:129,F_Init_Preview_START:130,F_Init_File_START:131,F_Init_Reset_Location_START:132,F_Init_Mention_START:133,F_Init_Work_Bench_START:137,F_Init_Sheetbar_START:138,F_Load_Toc_Config_LOADED:139,F_Load_Toc_Config_START:140},MOBILE:{F_Init_App_Service_START:58,F_Init_Spreadsheet_App_START:59,F_Init_Emitter_END:60,F_Init_Listen_Life_Cycle_START:61,F_Init_Core_Service_START:62,F_Init_Document_Manager_END:63,F_Init_SDK_Core_START:65,F_Init_Speed_Report_Event_START:66,F_Init_Sheet_Status_END:67,F_Init_Permissions_END:68,F_Init_Spreadsheet_END:69,F_Init_Mutation_Behavior_END:70,F_Init_Event_START:71,F_Init_Data_Center_START:72,F_Get_Document_Data_START:74,F_Init_Data_START:75,F_Update_Spreadsheet_START:76,F_Set_Inited_END:77,F_Init_Part_Interactable_START:79,F_Init_Title_Dom_START:80,F_Init_Canvas_Dom_START:81,F_Init_View_START:82,F_Init_Worker_START:87,F_Init_Main_Thread_Worker_END:89,F_Init_Calc_Controller_END:91,F_Init_Network_Status_END:96,F_Init_MessageCenter_END:97,F_Init_Socket_END:98,F_Init_Offline_Edit_END:99,F_Init_Editable_START:102,F_Init_Undo_Redo_Stack_START:103,F_On_All_Chunk_Ready_START:105,F_Init_Spreadsheet_App_In_Worker_START:106,F_Init_Service_Collection_START:108,F_Document_Manager_onReady_START:110,F_Init_Start_Init_Mobile_Plugins_START:111,F_Init_Tools_START:112,F_Init_Feature_END:113,F_Init_File_END:114,F_Init_Plugins_END:115,F_Document_Manager_replaceUrl:116},PAD:{F_Init_App_Service_START:58,F_Init_Spreadsheet_App_START:59,F_Init_Emitter_END:60,F_Init_Listen_Life_Cycle_START:61,F_Init_Core_Service_START:62,F_Init_Document_Manager_END:63,F_Init_SDK_Core_START:65,F_Init_Speed_Report_Event_START:66,F_Init_Sheet_Status_END:67,F_Init_Permissions_END:68,F_Init_Spreadsheet_END:69,F_Init_Mutation_Behavior_END:70,F_Init_Event_START:71,F_Init_Data_Center_START:72,F_Get_Document_Data_START:74,F_Init_Data_START:75,F_Update_Spreadsheet_START:76,F_Set_Inited_END:77,F_Init_Part_Interactable_START:79,F_Init_Title_Dom_START:80,F_Init_Canvas_Dom_START:81,F_Init_View_START:82,F_Init_Worker_START:87,F_Init_Main_Thread_Worker_END:89,F_Init_Calc_Controller_END:91,F_Init_Network_Status_END:96,F_Init_MessageCenter_END:97,F_Init_Socket_END:98,F_Init_Offline_Edit_END:99,F_Init_Editable_START:102,F_Init_Undo_Redo_Stack_START:103,F_Init_Service_Collection_START:106,F_Start_Init_Pad_Plugins_START:108,F_Init_Tools_START:109,F_On_All_Chunk_Ready_START:110,F_Init_Spreadsheet_App_In_Worker_START:111,F_Document_Manager_onReady_START:112,F_Document_Manager_replaceUrl:117}}}).call(this,r("../node_modules/webpack/buildin/global.js"))},jquery:function(e,t){e.exports=jQuery},react:function(e,t){e.exports=window.React},"react-dom":function(e,t){e.exports=window.ReactDOM}});
//# sourceMappingURL=pc-spread-sheet-pc-c2668361d8.js.map